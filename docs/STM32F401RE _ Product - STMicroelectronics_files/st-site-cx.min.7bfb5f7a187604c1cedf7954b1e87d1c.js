!function (a, b, c, d) { "use strict"; function e(a) { return ("string" == typeof a || a instanceof String) && (a = a.replace(/^['\\/"]+|(;\s?})+|['\\/"]+$/g, "")), a } var f = function (b) { for (var c = b.length, d = a("head"); c--;)0 === d.has("." + b[c]).length && d.append('<meta class="' + b[c] + '" />') }; f(["foundation-mq-small", "foundation-mq-medium", "foundation-mq-large", "foundation-mq-xlarge", "foundation-mq-xxlarge", "foundation-data-attribute-namespace"]), a(function () { "undefined" != typeof FastClick && "undefined" != typeof c.body && FastClick.attach(c.body) }); var g = function (b, d) { if ("string" == typeof b) { if (d) { var e; if (d.jquery) { if (e = d[0], !e) return d } else e = d; return a(e.querySelectorAll(b)) } return a(c.querySelectorAll(b)) } return a(b, d) }, h = function (a) { var b = []; return a || b.push("data"), this.namespace.length > 0 && b.push(this.namespace), b.push(this.name), b.join("-") }, i = function (a) { for (var b = a.split("-"), c = b.length, d = []; c--;)0 !== c ? d.push(b[c]) : this.namespace.length > 0 ? d.push(this.namespace, b[c]) : d.push(b[c]); return d.reverse().join("-") }, j = function (b, c) { var d = this, e = !g(this).data(this.attr_name(!0)); return g(this.scope).is("[" + this.attr_name() + "]") ? (g(this.scope).data(this.attr_name(!0) + "-init", a.extend({}, this.settings, c || b, this.data_options(g(this.scope)))), e && this.events(this.scope)) : g("[" + this.attr_name() + "]", this.scope).each(function () { var e = !g(this).data(d.attr_name(!0) + "-init"); g(this).data(d.attr_name(!0) + "-init", a.extend({}, d.settings, c || b, d.data_options(g(this)))), e && d.events(this) }), "string" == typeof b ? this[b].call(this, c) : void 0 }, k = function (a, b) { function c() { b(a[0]) } function d() { if (this.one("load", c), /MSIE (\d+\.\d+);/.test(navigator.userAgent)) { var a = this.attr("src"), b = a.match(/\?/) ? "&" : "?"; b += "random=" + (new Date).getTime(), this.attr("src", a + b) } } return a.attr("src") ? void (a[0].complete || 4 === a[0].readyState ? c() : d.call(a)) : void c() }; b.matchMedia = b.matchMedia || function (a) { var b, c = a.documentElement, d = c.firstElementChild || c.firstChild, e = a.createElement("body"), f = a.createElement("div"); return f.id = "mq-test-1", f.style.cssText = "position:absolute;top:-100em", e.style.background = "none", e.appendChild(f), function (a) { return f.innerHTML = '&shy;<style media="' + a + '"> #mq-test-1 { width: 42px; }</style>', c.insertBefore(e, d), b = 42 === f.offsetWidth, c.removeChild(e), { matches: b, media: a } } }(c), function () { function a() { c && (f(a), h && jQuery.fx.tick()) } for (var c, d = 0, e = ["webkit", "moz"], f = b.requestAnimationFrame, g = b.cancelAnimationFrame, h = "undefined" != typeof jQuery.fx; d < e.length && !f; d++)f = b[e[d] + "RequestAnimationFrame"], g = g || b[e[d] + "CancelAnimationFrame"] || b[e[d] + "CancelRequestAnimationFrame"]; f ? (b.requestAnimationFrame = f, b.cancelAnimationFrame = g, h && (jQuery.fx.timer = function (b) { b() && jQuery.timers.push(b) && !c && (c = !0, a()) }, jQuery.fx.stop = function () { c = !1 })) : (b.requestAnimationFrame = function (a) { var c = (new Date).getTime(), e = Math.max(0, 16 - (c - d)), f = b.setTimeout(function () { a(c + e) }, e); return d = c + e, f }, b.cancelAnimationFrame = function (a) { clearTimeout(a) }) }(jQuery), b.Foundation = { name: "Foundation", version: "5.4.6", media_queries: { small: g(".foundation-mq-small").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, ""), medium: g(".foundation-mq-medium").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, ""), large: g(".foundation-mq-large").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, ""), xlarge: g(".foundation-mq-xlarge").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, ""), xxlarge: g(".foundation-mq-xxlarge").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g, "") }, stylesheet: a("<style></style>").appendTo("head")[0].sheet, global: { namespace: d }, init: function (a, c, d, e, f) { var h = [a, d, e, f], i = []; if (this.rtl = /rtl/i.test(g("html").attr("dir")), this.scope = a || this.scope, this.set_namespace(), c && "string" == typeof c && !/reflow/i.test(c)) this.libs.hasOwnProperty(c) && i.push(this.init_lib(c, h)); else for (var j in this.libs) i.push(this.init_lib(j, c)); return g(b).load(function () { g(b).trigger("resize.fndtn.clearing").trigger("resize.fndtn.dropdown").trigger("resize.fndtn.equalizer").trigger("resize.fndtn.interchange").trigger("resize.fndtn.joyride").trigger("resize.fndtn.magellan").trigger("resize.fndtn.topbar").trigger("resize.fndtn.slider") }), a }, init_lib: function (b, c) { return this.libs.hasOwnProperty(b) ? (this.patch(this.libs[b]), c && c.hasOwnProperty(b) ? ("undefined" != typeof this.libs[b].settings ? a.extend(!0, this.libs[b].settings, c[b]) : "undefined" != typeof this.libs[b].defaults && a.extend(!0, this.libs[b].defaults, c[b]), this.libs[b].init.apply(this.libs[b], [this.scope, c[b]])) : (c = c instanceof Array ? c : new Array(c), this.libs[b].init.apply(this.libs[b], c))) : function () { } }, patch: function (a) { a.scope = this.scope, a.namespace = this.global.namespace, a.rtl = this.rtl, a.data_options = this.utils.data_options, a.attr_name = h, a.add_namespace = i, a.bindings = j, a.S = this.utils.S }, inherit: function (a, b) { for (var c = b.split(" "), d = c.length; d--;)this.utils.hasOwnProperty(c[d]) && (a[c[d]] = this.utils[c[d]]) }, set_namespace: function () { var b = this.global.namespace === d ? a(".foundation-data-attribute-namespace").css("font-family") : this.global.namespace; this.global.namespace = b === d || /false/i.test(b) ? "" : b }, libs: {}, utils: { S: g, throttle: function (a, b) { var c = null; return function () { var d = this, e = arguments; null == c && (c = setTimeout(function () { a.apply(d, e), c = null }, b)) } }, debounce: function (a, b, c) { var d, e; return function () { var f = this, g = arguments, h = function () { d = null, c || (e = a.apply(f, g)) }, i = c && !d; return clearTimeout(d), d = setTimeout(h, b), i && (e = a.apply(f, g)), e } }, data_options: function (b, c) { function d(a) { return !isNaN(a - 0) && null !== a && "" !== a && a !== !1 && a !== !0 } function e(b) { return "string" == typeof b ? a.trim(b) : b } c = c || "options"; var f, g, h, i = {}, j = function (a) { var b = Foundation.global.namespace; return a.data(b.length > 0 ? b + "-" + c : c) }, k = j(b); if ("object" == typeof k) return k; for (h = (k || ":").split(";"), f = h.length; f--;)g = h[f].split(":"), g = [g[0], g.slice(1).join(":")], /true/i.test(g[1]) && (g[1] = !0), /false/i.test(g[1]) && (g[1] = !1), d(g[1]) && (g[1] = -1 === g[1].indexOf(".") ? parseInt(g[1], 10) : parseFloat(g[1])), 2 === g.length && g[0].length > 0 && (i[e(g[0])] = e(g[1])); return i }, register_media: function (b, c) { Foundation.media_queries[b] === d && (a("head").append('<meta class="' + c + '"/>'), Foundation.media_queries[b] = e(a("." + c).css("font-family"))) }, add_custom_rule: function (a, b) { if (b === d && Foundation.stylesheet) Foundation.stylesheet.insertRule(a, Foundation.stylesheet.cssRules.length); else { var c = Foundation.media_queries[b]; c !== d && Foundation.stylesheet.insertRule("@media " + Foundation.media_queries[b] + "{ " + a + " }") } }, image_loaded: function (a, b) { var c = this, d = a.length; 0 === d && b(a), a.each(function () { k(c.S(this), function () { d -= 1, 0 === d && b(a) }) }) }, random_str: function () { return this.fidx || (this.fidx = 0), this.prefix = this.prefix || [this.name || "F", (+new Date).toString(36)].join("-"), this.prefix + (this.fidx++).toString(36) } } }, a.fn.foundation = function () { var a = Array.prototype.slice.call(arguments, 0); return this.each(function () { return Foundation.init.apply(Foundation, [this].concat(a)), this }) } }(jQuery, window, window.document), function (a, b, c) { "use strict"; Foundation.libs.abide = { name: "abide", version: "5.4.6", settings: { live_validate: !0, focus_on_invalid: !0, error_labels: !0, timeout: 1e3, patterns: { alpha: /^[a-zA-Z]+$/, alpha_numeric: /^[a-zA-Z0-9]+$/, integer: /^[-+]?\d+$/, number: /^[-+]?\d*(?:[\.\,]\d+)?$/, card: /^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/, cvv: /^([0-9]){3,4}$/, email: /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/, url: /^(https?|ftp|file|ssh):\/\/(((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/, domain: /^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}$/, datetime: /^([0-2][0-9]{3})\-([0-1][0-9])\-([0-3][0-9])T([0-5][0-9])\:([0-5][0-9])\:([0-5][0-9])(Z|([\-\+]([0-1][0-9])\:00))$/, date: /(?:19|20)[0-9]{2}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-9])|(?:(?!02)(?:0[1-9]|1[0-2])-(?:30))|(?:(?:0[13578]|1[02])-31))$/, time: /^(0[0-9]|1[0-9]|2[0-3])(:[0-5][0-9]){2}$/, dateISO: /^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/, month_day_year: /^(0[1-9]|1[012])[- \/.](0[1-9]|[12][0-9]|3[01])[- \/.]\d{4}$/, day_month_year: /^(0[1-9]|[12][0-9]|3[01])[- \/.](0[1-9]|1[012])[- \/.]\d{4}$/, color: /^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/ }, validators: { equalTo: function (a) { var b = c.getElementById(a.getAttribute(this.add_namespace("data-equalto"))).value, d = a.value, e = b === d; return e } } }, timer: null, init: function (a, b, c) { this.bindings(b, c) }, events: function (b) { var c = this, d = c.S(b).attr("novalidate", "novalidate"), e = d.data(this.attr_name(!0) + "-init") || {}; this.invalid_attr = this.add_namespace("data-invalid"), d.off(".abide").on("submit.fndtn.abide validate.fndtn.abide", function (a) { var b = /ajax/i.test(c.S(this).attr(c.attr_name())); return c.validate(c.S(this).find("input, textarea, select").get(), a, b) }).on("reset", function () { return c.reset(a(this)) }).find("input, textarea, select").off(".abide").on("blur.fndtn.abide change.fndtn.abide", function (a) { c.validate([this], a) }).on("keydown.fndtn.abide", function (a) { e.live_validate === !0 && (clearTimeout(c.timer), c.timer = setTimeout(function () { c.validate([this], a) }.bind(this), e.timeout)) }) }, reset: function (b) { b.removeAttr(this.invalid_attr), a(this.invalid_attr, b).removeAttr(this.invalid_attr), a(".error", b).not("small").removeClass("error") }, validate: function (a, b, c) { for (var d = this.parse_patterns(a), e = d.length, f = this.S(a[0]).closest("form"), g = /submit/.test(b.type), h = 0; e > h; h++)if (!d[h] && (g || c)) return this.settings.focus_on_invalid && a[h].focus(), f.trigger("invalid"), this.S(a[h]).closest("form").attr(this.invalid_attr, ""), !1; return (g || c) && f.trigger("valid"), f.removeAttr(this.invalid_attr), c ? !1 : !0 }, parse_patterns: function (a) { for (var b = a.length, c = []; b--;)c.push(this.pattern(a[b])); return this.check_validation_and_apply_styles(c) }, pattern: function (a) { var b = a.getAttribute("type"), c = "string" == typeof a.getAttribute("required"), d = a.getAttribute("pattern") || ""; return this.settings.patterns.hasOwnProperty(d) && d.length > 0 ? [a, this.settings.patterns[d], c] : d.length > 0 ? [a, new RegExp(d), c] : this.settings.patterns.hasOwnProperty(b) ? [a, this.settings.patterns[b], c] : (d = /.*/, [a, d, c]) }, check_validation_and_apply_styles: function (b) { var c = b.length, d = [], e = this.S(b[0][0]).closest("[data-" + this.attr_name(!0) + "]"); for (e.data(this.attr_name(!0) + "-init") || {}; c--;) { var f, g, h = b[c][0], i = b[c][2], j = h.value.trim(), k = this.S(h).parent(), l = h.getAttribute(this.add_namespace("data-abide-validator")), m = "radio" === h.type, n = "checkbox" === h.type, o = this.S('label[for="' + h.getAttribute("id") + '"]'), p = i ? h.value.length > 0 : !0, q = []; if (h.getAttribute(this.add_namespace("data-equalto")) && (l = "equalTo"), f = k.is("label") ? k.parent() : k, l && (g = this.settings.validators[l].apply(this, [h, i, f]), q.push(g)), m && i) q.push(this.valid_radio(h, i)); else if (n && i) q.push(this.valid_checkbox(h, i)); else if (q.push(b[c][1].test(j) && p || !i && h.value.length < 1 || a(h).attr("disabled") ? !0 : !1), q = [q.every(function (a) { return a })], q[0]) this.S(h).removeAttr(this.invalid_attr), h.setAttribute("aria-invalid", "false"), h.removeAttribute("aria-describedby"), f.removeClass("error"), o.length > 0 && this.settings.error_labels && o.removeClass("error").removeAttr("role"), a(h).triggerHandler("valid"); else { this.S(h).attr(this.invalid_attr, ""), h.setAttribute("aria-invalid", "true"); var r = f.find("small.error, span.error"), s = r.length > 0 ? r[0].id : ""; s.length > 0 && h.setAttribute("aria-describedby", s), f.addClass("error"), o.length > 0 && this.settings.error_labels && o.addClass("error").attr("role", "alert"), a(h).triggerHandler("invalid") } d.push(q[0]) } return d = [d.every(function (a) { return a })] }, valid_checkbox: function (a, b) { var a = this.S(a), c = a.is(":checked") || !b; return c ? a.removeAttr(this.invalid_attr).parent().removeClass("error") : a.attr(this.invalid_attr, "").parent().addClass("error"), c }, valid_radio: function (a) { for (var b = a.getAttribute("name"), c = this.S(a).closest("[data-" + this.attr_name(!0) + "]").find("[name='" + b + "']"), d = c.length, e = !1, f = 0; d > f; f++)c[f].checked && (e = !0); for (var f = 0; d > f; f++)e ? this.S(c[f]).removeAttr(this.invalid_attr).parent().removeClass("error") : this.S(c[f]).attr(this.invalid_attr, "").parent().addClass("error"); return e }, valid_equal: function (a, b, d) { var e = c.getElementById(a.getAttribute(this.add_namespace("data-equalto"))).value, f = a.value, g = e === f; return g ? (this.S(a).removeAttr(this.invalid_attr), d.removeClass("error"), label.length > 0 && settings.error_labels && label.removeClass("error")) : (this.S(a).attr(this.invalid_attr, ""), d.addClass("error"), label.length > 0 && settings.error_labels && label.addClass("error")), g }, valid_oneof: function (a, b, c, d) { var a = this.S(a), e = this.S("[" + this.add_namespace("data-oneof") + "]"), f = e.filter(":checked").length > 0; if (f ? a.removeAttr(this.invalid_attr).parent().removeClass("error") : a.attr(this.invalid_attr, "").parent().addClass("error"), !d) { var g = this; e.each(function () { g.valid_oneof.call(g, this, null, null, !0) }) } return f } } }(jQuery, window, window.document), function (a) { "use strict"; Foundation.libs.accordion = { name: "accordion", version: "5.4.6", settings: { active_class: "active", multi_expand: !1, toggleable: !0, callback: function () { } }, init: function (a, b, c) { this.bindings(b, c) }, events: function () { var b = this, c = this.S; c(this.scope).off(".fndtn.accordion").on("click.fndtn.accordion", "[" + this.attr_name() + "] > dd > a", function (d) { var e = c(this).closest("[" + b.attr_name() + "]"), f = b.attr_name() + "=" + e.attr(b.attr_name()), g = e.data(b.attr_name(!0) + "-init"), h = c("#" + this.href.split("#")[1]), i = a("> dd", e), j = i.children(".content"), k = j.filter("." + g.active_class); return d.preventDefault(), e.attr(b.attr_name()) && (j = j.add("[" + f + "] dd > .content"), i = i.add("[" + f + "] dd")), g.toggleable && h.is(k) ? (h.parent("dd").toggleClass(g.active_class, !1), h.toggleClass(g.active_class, !1), g.callback(h), h.triggerHandler("toggled", [e]), void e.triggerHandler("toggled", [h])) : (g.multi_expand || (j.removeClass(g.active_class), i.removeClass(g.active_class)), h.addClass(g.active_class).parent().addClass(g.active_class), g.callback(h), h.triggerHandler("toggled", [e]), void e.triggerHandler("toggled", [h])) }) }, off: function () { }, reflow: function () { } } }(jQuery, window, window.document), function (a) { "use strict"; Foundation.libs.alert = { name: "alert", version: "5.4.6", settings: { callback: function () { } }, init: function (a, b, c) { this.bindings(b, c) }, events: function () { var b = this, c = this.S; a(this.scope).off(".alert").on("click.fndtn.alert", "[" + this.attr_name() + "] .close", function (a) { var d = c(this).closest("[" + b.attr_name() + "]"), e = d.data(b.attr_name(!0) + "-init") || b.settings; a.preventDefault(), Modernizr.csstransitions ? (d.addClass("alert-close"), d.on("transitionend webkitTransitionEnd oTransitionEnd", function () { c(this).trigger("close").trigger("close.fndtn.alert").remove(), e.callback() })) : d.fadeOut(300, function () { c(this).trigger("close").trigger("close.fndtn.alert").remove(), e.callback() }) }) }, reflow: function () { } } }(jQuery, window, window.document), function (a, b, c, d) { "use strict"; Foundation.libs.clearing = { name: "clearing", version: "5.4.6", settings: { templates: { viewing: '<a href="#" class="clearing-close">&times;</a><div class="visible-img" style="display: none"><div class="clearing-touch-label"></div><img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D" alt="" /><p class="clearing-caption"></p><a href="#" class="clearing-main-prev"><span></span></a><a href="#" class="clearing-main-next"><span></span></a></div>' }, close_selectors: ".clearing-close, div.clearing-blackout", open_selectors: "", skip_selector: "", touch_label: "", init: !1, locked: !1 }, init: function (a, b, c) { var d = this; Foundation.inherit(this, "throttle image_loaded"), this.bindings(b, c), d.S(this.scope).is("[" + this.attr_name() + "]") ? this.assemble(d.S("li", this.scope)) : d.S("[" + this.attr_name() + "]", this.scope).each(function () { d.assemble(d.S("li", this)) }) }, events: function (d) { var e = this, f = e.S, g = a(".scroll-container"); g.length > 0 && (this.scope = g), f(this.scope).off(".clearing").on("click.fndtn.clearing", "ul[" + this.attr_name() + "] li " + this.settings.open_selectors, function (a, b, c) { var b = b || f(this), c = c || b, d = b.next("li"), g = b.closest("[" + e.attr_name() + "]").data(e.attr_name(!0) + "-init"), h = f(a.target); a.preventDefault(), g || (e.init(), g = b.closest("[" + e.attr_name() + "]").data(e.attr_name(!0) + "-init")), c.hasClass("visible") && b[0] === c[0] && d.length > 0 && e.is_open(b) && (c = d, h = f("img", c)), e.open(h, b, c), e.update_paddles(c) }).on("click.fndtn.clearing", ".clearing-main-next", function (a) { e.nav(a, "next") }).on("click.fndtn.clearing", ".clearing-main-prev", function (a) { e.nav(a, "prev") }).on("click.fndtn.clearing", this.settings.close_selectors, function (a) { Foundation.libs.clearing.close(a, this) }), a(c).on("keydown.fndtn.clearing", function (a) { e.keydown(a) }), f(b).off(".clearing").on("resize.fndtn.clearing", function () { e.resize() }), this.swipe_events(d) }, swipe_events: function () { var a = this, b = a.S; b(this.scope).on("touchstart.fndtn.clearing", ".visible-img", function (a) { a.touches || (a = a.originalEvent); var c = { start_page_x: a.touches[0].pageX, start_page_y: a.touches[0].pageY, start_time: (new Date).getTime(), delta_x: 0, is_scrolling: d }; b(this).data("swipe-transition", c), a.stopPropagation() }).on("touchmove.fndtn.clearing", ".visible-img", function (c) { if (c.touches || (c = c.originalEvent), !(c.touches.length > 1 || c.scale && 1 !== c.scale)) { var d = b(this).data("swipe-transition"); if ("undefined" == typeof d && (d = {}), d.delta_x = c.touches[0].pageX - d.start_page_x, Foundation.rtl && (d.delta_x = -d.delta_x), "undefined" == typeof d.is_scrolling && (d.is_scrolling = !!(d.is_scrolling || Math.abs(d.delta_x) < Math.abs(c.touches[0].pageY - d.start_page_y))), !d.is_scrolling && !d.active) { c.preventDefault(); var e = d.delta_x < 0 ? "next" : "prev"; d.active = !0, a.nav(c, e) } } }).on("touchend.fndtn.clearing", ".visible-img", function (a) { b(this).data("swipe-transition", {}), a.stopPropagation() }) }, assemble: function (b) { var c = b.parent(); if (!c.parent().hasClass("carousel")) { c.after('<div id="foundationClearingHolder"></div>'); var d = c.detach(), e = ""; if (null != d[0]) { e = d[0].outerHTML; var f = this.S("#foundationClearingHolder"), g = c.data(this.attr_name(!0) + "-init"), h = { grid: '<div class="carousel">' + e + "</div>", viewing: g.templates.viewing }, i = '<div class="clearing-assembled"><div>' + h.viewing + h.grid + "</div></div>", j = this.settings.touch_label; Modernizr.touch && (i = a(i).find(".clearing-touch-label").html(j).end()), f.after(i).remove() } } }, open: function (b, d, e) { function f() { setTimeout(function () { this.image_loaded(m, function () { 1 !== m.outerWidth() || o ? g.call(this, m) : f.call(this) }.bind(this)) }.bind(this), 100) } function g(b) { var c = a(b); c.css("visibility", "visible"), i.css("overflow", "hidden"), j.addClass("clearing-blackout"), k.addClass("clearing-container"), l.show(), this.fix_height(e).caption(h.S(".clearing-caption", l), h.S("img", e)).center_and_label(b, n).shift(d, e, function () { e.closest("li").siblings().removeClass("visible"), e.closest("li").addClass("visible") }), l.trigger("opened.fndtn.clearing") } var h = this, i = a(c.body), j = e.closest(".clearing-assembled"), k = h.S("div", j).first(), l = h.S(".visible-img", k), m = h.S("img", l).not(b), n = h.S(".clearing-touch-label", k), o = !1; a("body").on("touchmove", function (a) { a.preventDefault() }), m.error(function () { o = !0 }), this.locked() || (l.trigger("open.fndtn.clearing"), m.attr("src", this.load(b)).css("visibility", "hidden"), f.call(this)) }, close: function (b, d) { b.preventDefault(); var e, f, g = function (a) { return /blackout/.test(a.selector) ? a : a.closest(".clearing-blackout") }(a(d)), h = a(c.body); return d === b.target && g && (h.css("overflow", ""), e = a("div", g).first(), f = a(".visible-img", e), f.trigger("close.fndtn.clearing"), this.settings.prev_index = 0, a("ul[" + this.attr_name() + "]", g).attr("style", "").closest(".clearing-blackout").removeClass("clearing-blackout"), e.removeClass("clearing-container"), f.hide(), f.trigger("closed.fndtn.clearing")), a("body").off("touchmove"), !1 }, is_open: function (a) { return a.parent().prop("style").length > 0 }, keydown: function (b) { var c = a(".clearing-blackout ul[" + this.attr_name() + "]"), d = this.rtl ? 37 : 39, e = this.rtl ? 39 : 37, f = 27; b.which === d && this.go(c, "next"), b.which === e && this.go(c, "prev"), b.which === f && this.S("a.clearing-close").trigger("click").trigger("click.fndtn.clearing") }, nav: function (b, c) { var d = a("ul[" + this.attr_name() + "]", ".clearing-blackout"); b.preventDefault(), this.go(d, c) }, resize: function () { var b = a("img", ".clearing-blackout .visible-img"), c = a(".clearing-touch-label", ".clearing-blackout"); b.length && (this.center_and_label(b, c), b.trigger("resized.fndtn.clearing")) }, fix_height: function (a) { var b = a.parent().children(), c = this; return b.each(function () { var a = c.S(this), b = a.find("img"); a.height() > b.outerHeight() && a.addClass("fix-height") }).closest("ul").width(100 * b.length + "%"), this }, update_paddles: function (a) { a = a.closest("li"); var b = a.closest(".carousel").siblings(".visible-img"); a.next().length > 0 ? this.S(".clearing-main-next", b).removeClass("disabled") : this.S(".clearing-main-next", b).addClass("disabled"), a.prev().length > 0 ? this.S(".clearing-main-prev", b).removeClass("disabled") : this.S(".clearing-main-prev", b).addClass("disabled") }, center_and_label: function (a, b) { return this.rtl ? (a.css({ marginRight: -(a.outerWidth() / 2), marginTop: -(a.outerHeight() / 2), left: "auto", right: "50%" }), b.length > 0 && b.css({ marginRight: -(b.outerWidth() / 2), marginTop: -(a.outerHeight() / 2) - b.outerHeight() - 10, left: "auto", right: "50%" })) : (a.css({ marginLeft: -(a.outerWidth() / 2), marginTop: -(a.outerHeight() / 2) }), b.length > 0 && b.css({ marginLeft: -(b.outerWidth() / 2), marginTop: -(a.outerHeight() / 2) - b.outerHeight() - 10 })), this }, load: function (a) { var b; return b = "A" === a[0].nodeName ? a.attr("href") : a.parent().attr("href"), this.preload(a), b ? b : a.attr("src") }, preload: function (a) { this.img(a.closest("li").next()).img(a.closest("li").prev()) }, img: function (a) { if (a.length) { var b = new Image, c = this.S("a", a); b.src = c.length ? c.attr("href") : this.S("img", a).attr("src") } return this }, caption: function (a, b) { var c = b.attr("data-caption"); return c ? a.html(c).show() : a.text("").hide(), this }, go: function (a, b) { var c = this.S(".visible", a), d = c[b](); this.settings.skip_selector && 0 != d.find(this.settings.skip_selector).length && (d = d[b]()), d.length && this.S("img", d).trigger("click", [c, d]).trigger("click.fndtn.clearing", [c, d]).trigger("change.fndtn.clearing") }, shift: function (a, b, c) { var d, e = b.parent(), f = this.settings.prev_index || b.index(), g = this.direction(e, a, b), h = this.rtl ? "right" : "left", i = parseInt(e.css("left"), 10), j = b.outerWidth(), k = {}; b.index() === f || /skip/.test(g) ? /skip/.test(g) && (d = b.index() - this.settings.up_count, this.lock(), d > 0 ? (k[h] = -(d * j), e.animate(k, 300, this.unlock())) : (k[h] = 0, e.animate(k, 300, this.unlock()))) : /left/.test(g) ? (this.lock(), k[h] = i + j, e.animate(k, 300, this.unlock())) : /right/.test(g) && (this.lock(), k[h] = i - j, e.animate(k, 300, this.unlock())), c() }, direction: function (a, b, c) { var d, e = this.S("li", a), f = e.outerWidth() + e.outerWidth() / 4, g = Math.floor(this.S(".clearing-container").outerWidth() / f) - 1, h = e.index(c); return this.settings.up_count = g, d = this.adjacent(this.settings.prev_index, h) ? h > g && h > this.settings.prev_index ? "right" : h > g - 1 && h <= this.settings.prev_index ? "left" : !1 : "skip", this.settings.prev_index = h, d }, adjacent: function (a, b) { for (var c = b + 1; c >= b - 1; c--)if (c === a) return !0; return !1 }, lock: function () { this.settings.locked = !0 }, unlock: function () { this.settings.locked = !1 }, locked: function () { return this.settings.locked }, off: function () { this.S(this.scope).off(".fndtn.clearing"), this.S(b).off(".fndtn.clearing") }, reflow: function () { this.init() } } }(jQuery, window, window.document), function (a, b) { "use strict"; Foundation.libs.dropdown = { name: "dropdown", version: "5.4.6", settings: { active_class: "open", disabled_class: "disabled", mega_class: "mega", align: "bottom", is_hover: !1, opened: function () { }, closed: function () { } }, init: function (a, b, c) { Foundation.inherit(this, "throttle"), this.bindings(b, c) }, events: function () { var c = this, d = c.S; d(this.scope).off(".dropdown").on("click.fndtn.dropdown", "[" + this.attr_name() + "]", function (b) { var e = d(this).data(c.attr_name(!0) + "-init") || c.settings; (!e.is_hover || Modernizr.touch) && (b.preventDefault(), c.toggle(a(this))) }).on("mouseenter.fndtn.dropdown", "[" + this.attr_name() + "], [" + this.attr_name() + "-content]", function (a) { var b, e, f = d(this); clearTimeout(c.timeout), f.data(c.data_attr()) ? (b = d("#" + f.data(c.data_attr())), e = f) : (b = f, e = d("[" + c.attr_name() + "='" + b.attr("id") + "']")); var g = e.data(c.attr_name(!0) + "-init") || c.settings; d(a.target).data(c.data_attr()) && g.is_hover && c.closeall.call(c), g.is_hover && c.open.apply(c, [b, e]) }).on("mouseleave.fndtn.dropdown", "[" + this.attr_name() + "], [" + this.attr_name() + "-content]", function () { var a = d(this); c.timeout = setTimeout(function () { if (a.data(c.data_attr())) { var b = a.data(c.data_attr(!0) + "-init") || c.settings; b.is_hover && c.close.call(c, d("#" + a.data(c.data_attr()))) } else { var e = d("[" + c.attr_name() + '="' + d(this).attr("id") + '"]'), b = e.data(c.attr_name(!0) + "-init") || c.settings; b.is_hover && c.close.call(c, a) } }.bind(this), 150) }).on("click.fndtn.dropdown", function (b) { var e = d(b.target).closest("[" + c.attr_name() + "-content]"); if (!(d(b.target).closest("[" + c.attr_name() + "]").length > 0)) return !d(b.target).data("revealId") && e.length > 0 && (d(b.target).is("[" + c.attr_name() + "-content]") || a.contains(e.first()[0], b.target)) ? void b.stopPropagation() : void c.close.call(c, d("[" + c.attr_name() + "-content]")) }).on("opened.fndtn.dropdown", "[" + c.attr_name() + "-content]", function () { c.settings.opened.call(this) }).on("closed.fndtn.dropdown", "[" + c.attr_name() + "-content]", function () { c.settings.closed.call(this) }), d(b).off(".dropdown").on("resize.fndtn.dropdown", c.throttle(function () { c.resize.call(c) }, 50)), this.resize() }, close: function (b) { var c = this; b.each(function () { var d = a("[" + c.attr_name() + "=" + b[0].id + "]") || a("aria-controls=" + b[0].id + "]"); d.attr("aria-expanded", "false"), c.S(this).hasClass(c.settings.active_class) && (c.S(this).css(Foundation.rtl ? "right" : "left", "-99999px").attr("hidden", "true").removeClass(c.settings.active_class).prev("[" + c.attr_name() + "]").removeClass(c.settings.active_class).removeData("target"), c.S(this).trigger("closed").trigger("closed.fndtn.dropdown", [b])) }) }, closeall: function () { var b = this; a.each(b.S("[" + this.attr_name() + "-content]"), function () { b.close.call(b, b.S(this)) }) }, open: function (a, b) { this.css(a.addClass(this.settings.active_class), b), a.prev("[" + this.attr_name() + "]").addClass(this.settings.active_class), a.data("target", b.get(0)).trigger("opened").trigger("opened.fndtn.dropdown", [a, b]), a.removeAttr("hidden"), b.attr("aria-expanded", "true"), a.focus() }, data_attr: function () { return this.namespace.length > 0 ? this.namespace + "-" + this.name : this.name }, toggle: function (a) { if (!a.hasClass(this.settings.disabled_class)) { var b = this.S("#" + a.data(this.data_attr())); 0 !== b.length && (this.close.call(this, this.S("[" + this.attr_name() + "-content]").not(b)), b.hasClass(this.settings.active_class) ? (this.close.call(this, b), b.data("target") !== a.get(0) && this.open.call(this, b, a)) : this.open.call(this, b, a)) } }, resize: function () { var a = this.S("[" + this.attr_name() + "-content].open"), b = this.S("[" + this.attr_name() + "='" + a.attr("id") + "']"); a.length && b.length && this.css(a, b) }, css: function (a, b) { var c = Math.max((b.width() - a.width()) / 2, 8), d = b.data(this.attr_name(!0) + "-init") || this.settings; if (this.clear_idx(), this.small()) { var e = this.dirs.bottom.call(a, b, d); a.attr("style", "").removeClass("drop-left drop-right drop-top").css({ position: "absolute", width: "95%", "max-width": "none", top: e.top }), a.css(Foundation.rtl ? "right" : "left", c) } else this.style(a, b, d); return a }, style: function (b, c, d) { var e = a.extend({ position: "absolute" }, this.dirs[d.align].call(b, c, d)); b.attr("style", "").css(e) }, dirs: { _base: function (a) { var b = this.offsetParent(), c = b.offset(), d = a.offset(); return d.top -= c.top, d.left -= c.left, d }, top: function (a, b) { var c = Foundation.libs.dropdown, d = c.dirs._base.call(this, a); return this.addClass("drop-top"), (a.outerWidth() < this.outerWidth() || c.small() || this.hasClass(b.mega_menu)) && c.adjust_pip(this, a, b, d), Foundation.rtl ? { left: d.left - this.outerWidth() + a.outerWidth(), top: d.top - this.outerHeight() } : { left: d.left, top: d.top - this.outerHeight() } }, bottom: function (a, b) { var c = Foundation.libs.dropdown, d = c.dirs._base.call(this, a); return (a.outerWidth() < this.outerWidth() || c.small() || this.hasClass(b.mega_menu)) && c.adjust_pip(this, a, b, d), c.rtl ? { left: d.left - this.outerWidth() + a.outerWidth(), top: d.top + a.outerHeight() } : { left: d.left, top: d.top + a.outerHeight() } }, left: function (a) { var b = Foundation.libs.dropdown.dirs._base.call(this, a); return this.addClass("drop-left"), { left: b.left - this.outerWidth(), top: b.top } }, right: function (a) { var b = Foundation.libs.dropdown.dirs._base.call(this, a); return this.addClass("drop-right"), { left: b.left + a.outerWidth(), top: b.top } } }, adjust_pip: function (a, b, c, d) { var e = Foundation.stylesheet, f = 8; a.hasClass(c.mega_class) ? f = d.left + b.outerWidth() / 2 - 8 : this.small() && (f += d.left - 8), this.rule_idx = e.cssRules.length; var g = ".f-dropdown.open:before", h = ".f-dropdown.open:after", i = "left: " + f + "px;", j = "left: " + (f - 1) + "px;"; e.insertRule ? (e.insertRule([g, "{", i, "}"].join(" "), this.rule_idx), e.insertRule([h, "{", j, "}"].join(" "), this.rule_idx + 1)) : (e.addRule(g, i, this.rule_idx), e.addRule(h, j, this.rule_idx + 1)) }, clear_idx: function () { var a = Foundation.stylesheet; this.rule_idx && (a.deleteRule(this.rule_idx), a.deleteRule(this.rule_idx), delete this.rule_idx) }, small: function () { return matchMedia(Foundation.media_queries.small).matches && !matchMedia(Foundation.media_queries.medium).matches }, off: function () { this.S(this.scope).off(".fndtn.dropdown"), this.S("html, body").off(".fndtn.dropdown"), this.S(b).off(".fndtn.dropdown"), this.S("[data-dropdown-content]").off(".fndtn.dropdown") }, reflow: function () { } } }(jQuery, window, window.document), function (a, b) { "use strict"; Foundation.libs.equalizer = { name: "equalizer", version: "5.4.6", settings: { use_tallest: !0, before_height_change: a.noop, after_height_change: a.noop, equalize_on_stack: !1 }, init: function (a, b, c) { Foundation.inherit(this, "image_loaded"), this.bindings(b, c), this.reflow() }, events: function () { this.S(b).off(".equalizer").on("resize.fndtn.equalizer", function () { this.reflow() }.bind(this)) }, equalize: function (b) { var c = !1, d = b.find("[" + this.attr_name() + "-watch]:visible"), e = b.data(this.attr_name(!0) + "-init"); if (0 !== d.length) { var f = d.first().offset().top; if (e.before_height_change(), b.trigger("before-height-change").trigger("before-height-change.fndth.equalizer"), d.height("inherit"), d.each(function () { var b = a(this); b.offset().top !== f && (c = !0) }), e.equalize_on_stack !== !1 || !c) { var g = d.map(function () { return a(this).outerHeight(!1) }).get(); if (e.use_tallest) { var h = Math.max.apply(null, g); d.css("height", h) } else { var i = Math.min.apply(null, g); d.css("height", i) } e.after_height_change(), b.trigger("after-height-change").trigger("after-height-change.fndtn.equalizer") } } }, reflow: function () { var b = this; this.S("[" + this.attr_name() + "]", this.scope).each(function () { var c = a(this); b.image_loaded(b.S("img", this), function () { b.equalize(c) }) }) } } }(jQuery, window, window.document), function (a, b) {
    "use strict"; Foundation.libs.interchange = {
        name: "interchange", version: "5.4.6", cache: {}, images_loaded: !1, nodes_loaded: !1, settings: {
            load_attr: "interchange", named_queries: { "default": "only screen", small: Foundation.media_queries.small, medium: Foundation.media_queries.medium, large: Foundation.media_queries.large, xlarge: Foundation.media_queries.xlarge, xxlarge: Foundation.media_queries.xxlarge, landscape: "only screen and (orientation: landscape)", portrait: "only screen and (orientation: portrait)", retina: "only screen and (-webkit-min-device-pixel-ratio: 2),only screen and (min--moz-device-pixel-ratio: 2),only screen and (-o-min-device-pixel-ratio: 2/1),only screen and (min-device-pixel-ratio: 2),only screen and (min-resolution: 192dpi),only screen and (min-resolution: 2dppx)" }, directives: {
                replace: function (b, c, d) {
                    if (/IMG/.test(b[0].nodeName)) {
                        var e = b[0].src;
                        if (new RegExp(c, "i").test(e)) return; return b[0].src = c, d(b[0].src)
                    } var f = b.data(this.data_attr + "-last-path"), g = this; if (f != c) return /\.(gif|jpg|jpeg|tiff|png)([?#].*)?/i.test(c) ? (a(b).css("background-image", "url(" + c + ")"), b.data("interchange-last-path", c), d(c)) : a.get(c, function (a) { b.html(a), b.data(g.data_attr + "-last-path", c), d() })
                }
            }
        }, init: function (b, c, d) { Foundation.inherit(this, "throttle random_str"), this.data_attr = this.set_data_attr(), a.extend(!0, this.settings, c, d), this.bindings(c, d), this.load("images"), this.load("nodes") }, get_media_hash: function () { var a = ""; for (var b in this.settings.named_queries) a += matchMedia(this.settings.named_queries[b]).matches.toString(); return a }, events: function () { var c, d = this; return a(b).off(".interchange").on("resize.fndtn.interchange", d.throttle(function () { var a = d.get_media_hash(); a !== c && d.resize(), c = a }, 50)), this }, resize: function () { var b = this.cache; if (!this.images_loaded || !this.nodes_loaded) return void setTimeout(a.proxy(this.resize, this), 50); for (var c in b) if (b.hasOwnProperty(c)) { var d = this.results(c, b[c]); d && this.settings.directives[d.scenario[1]].call(this, d.el, d.scenario[0], function () { if (arguments[0] instanceof Array) var a = arguments[0]; else var a = Array.prototype.slice.call(arguments, 0); d.el.trigger(d.scenario[1], a) }) } }, results: function (a, b) { var c = b.length; if (c > 0) for (var d = this.S("[" + this.add_namespace("data-uuid") + '="' + a + '"]'); c--;) { var e, f = b[c][2]; if (e = matchMedia(this.settings.named_queries.hasOwnProperty(f) ? this.settings.named_queries[f] : f), e.matches) return { el: d, scenario: b[c] } } return !1 }, load: function (a, b) { return ("undefined" == typeof this["cached_" + a] || b) && this["update_" + a](), this["cached_" + a] }, update_images: function () { var a = this.S("img[" + this.data_attr + "]"), b = a.length, c = b, d = 0, e = this.data_attr; for (this.cache = {}, this.cached_images = [], this.images_loaded = 0 === b; c--;) { if (d++, a[c]) { var f = a[c].getAttribute(e) || ""; f.length > 0 && this.cached_images.push(a[c]) } d === b && (this.images_loaded = !0, this.enhance("images")) } return this }, update_nodes: function () { var a = this.S("[" + this.data_attr + "]").not("img"), b = a.length, c = b, d = 0, e = this.data_attr; for (this.cached_nodes = [], this.nodes_loaded = 0 === b; c--;) { d++; var f = a[c].getAttribute(e) || ""; f.length > 0 && this.cached_nodes.push(a[c]), d === b && (this.nodes_loaded = !0, this.enhance("nodes")) } return this }, enhance: function (c) { for (var d = this["cached_" + c].length; d--;)this.object(a(this["cached_" + c][d])); return a(b).trigger("resize").trigger("resize.fndtn.interchange") }, convert_directive: function (a) { var b = this.trim(a); return b.length > 0 ? b : "replace" }, parse_scenario: function (a) { var b = a[0].match(/(.+),\s*(\w+)\s*$/), c = a[1]; if (b) var d = b[1], e = b[2]; else var f = a[0].split(/,\s*$/), d = f[0], e = ""; return [this.trim(d), this.convert_directive(e), this.trim(c)] }, object: function (a) { var b = this.parse_data_attr(a), c = [], d = b.length; if (d > 0) for (; d--;) { var e = b[d].split(/\((.*?)(\))$/); if (e.length > 1) { var f = this.parse_scenario(e); c.push(f) } } return this.store(a, c) }, store: function (a, b) { var c = this.random_str(), d = a.data(this.add_namespace("uuid", !0)); return this.cache[d] ? this.cache[d] : (a.attr(this.add_namespace("data-uuid"), c), this.cache[c] = b) }, trim: function (b) { return "string" == typeof b ? a.trim(b) : b }, set_data_attr: function (a) { return a ? this.namespace.length > 0 ? this.namespace + "-" + this.settings.load_attr : this.settings.load_attr : this.namespace.length > 0 ? "data-" + this.namespace + "-" + this.settings.load_attr : "data-" + this.settings.load_attr }, parse_data_attr: function (a) { for (var b = a.attr(this.attr_name()).split(/\[(.*?)\]/), c = b.length, d = []; c--;)b[c].replace(/[\W\d]+/, "").length > 4 && d.push(b[c]); return d }, reflow: function () { this.load("images", !0), this.load("nodes", !0) }
    }
}(jQuery, window, window.document), function (a, b, c, d) { "use strict"; Foundation.libs.joyride = { name: "joyride", version: "5.4.6", defaults: { expose: !1, modal: !0, keyboard: !0, tip_location: "bottom", nub_position: "auto", scroll_speed: 1500, scroll_animation: "linear", timer: 0, start_timer_on_click: !0, start_offset: 0, next_button: !0, prev_button: !0, tip_animation: "fade", pause_after: [], exposed: [], tip_animation_fade_speed: 300, cookie_monster: !1, cookie_name: "joyride", cookie_domain: !1, cookie_expires: 365, tip_container: "body", abort_on_close: !0, tip_location_patterns: { top: ["bottom"], bottom: [], left: ["right", "top", "bottom"], right: ["left", "top", "bottom"] }, post_ride_callback: function () { }, post_step_callback: function () { }, pre_step_callback: function () { }, pre_ride_callback: function () { }, post_expose_callback: function () { }, template: { link: '<a href="#close" class="joyride-close-tip">&times;</a>', timer: '<div class="joyride-timer-indicator-wrap"><span class="joyride-timer-indicator"></span></div>', tip: '<div class="joyride-tip-guide"><span class="joyride-nub"></span></div>', wrapper: '<div class="joyride-content-wrapper"></div>', button: '<a href="#" class="small button joyride-next-tip"></a>', prev_button: '<a href="#" class="small button joyride-prev-tip"></a>', modal: '<div class="joyride-modal-bg"></div>', expose: '<div class="joyride-expose-wrapper"></div>', expose_cover: '<div class="joyride-expose-cover"></div>' }, expose_add_class: "" }, init: function (b, c, d) { Foundation.inherit(this, "throttle random_str"), this.settings = this.settings || a.extend({}, this.defaults, d || c), this.bindings(c, d) }, go_next: function () { this.settings.$li.next().length < 1 ? this.end() : this.settings.timer > 0 ? (clearTimeout(this.settings.automate), this.hide(), this.show(), this.startTimer()) : (this.hide(), this.show()) }, go_prev: function () { this.settings.$li.prev().length < 1 || (this.settings.timer > 0 ? (clearTimeout(this.settings.automate), this.hide(), this.show(null, !0), this.startTimer()) : (this.hide(), this.show(null, !0))) }, events: function () { var c = this; a(this.scope).off(".joyride").on("click.fndtn.joyride", ".joyride-next-tip, .joyride-modal-bg", function (a) { a.preventDefault(), this.go_next() }.bind(this)).on("click.fndtn.joyride", ".joyride-prev-tip", function (a) { a.preventDefault(), this.go_prev() }.bind(this)).on("click.fndtn.joyride", ".joyride-close-tip", function (a) { a.preventDefault(), this.end(this.settings.abort_on_close) }.bind(this)).on("keyup.fndtn.joyride", function (a) { if (this.settings.keyboard && this.settings.riding) switch (a.which) { case 39: a.preventDefault(), this.go_next(); break; case 37: a.preventDefault(), this.go_prev(); break; case 27: a.preventDefault(), this.end(this.settings.abort_on_close) } }.bind(this)), a(b).off(".joyride").on("resize.fndtn.joyride", c.throttle(function () { if (a("[" + c.attr_name() + "]").length > 0 && c.settings.$next_tip && c.settings.riding) { if (c.settings.exposed.length > 0) { var b = a(c.settings.exposed); b.each(function () { var b = a(this); c.un_expose(b), c.expose(b) }) } c.is_phone() ? c.pos_phone() : c.pos_default(!1) } }, 100)) }, start: function () { var b = this, c = a("[" + this.attr_name() + "]", this.scope), d = ["timer", "scrollSpeed", "startOffset", "tipAnimationFadeSpeed", "cookieExpires"], e = d.length; !c.length > 0 || (this.settings.init || this.events(), this.settings = c.data(this.attr_name(!0) + "-init"), this.settings.$content_el = c, this.settings.$body = a(this.settings.tip_container), this.settings.body_offset = a(this.settings.tip_container).position(), this.settings.$tip_content = this.settings.$content_el.find("> li"), this.settings.paused = !1, this.settings.attempts = 0, this.settings.riding = !0, "function" != typeof a.cookie && (this.settings.cookie_monster = !1), (!this.settings.cookie_monster || this.settings.cookie_monster && !a.cookie(this.settings.cookie_name)) && (this.settings.$tip_content.each(function (c) { var f = a(this); this.settings = a.extend({}, b.defaults, b.data_options(f)); for (var g = e; g--;)b.settings[d[g]] = parseInt(b.settings[d[g]], 10); b.create({ $li: f, index: c }) }), !this.settings.start_timer_on_click && this.settings.timer > 0 ? (this.show("init"), this.startTimer()) : this.show("init"))) }, resume: function () { this.set_li(), this.show() }, tip_template: function (b) { var c, d; return b.tip_class = b.tip_class || "", c = a(this.settings.template.tip).addClass(b.tip_class), d = a.trim(a(b.li).html()) + this.prev_button_text(b.prev_button_text, b.index) + this.button_text(b.button_text) + this.settings.template.link + this.timer_instance(b.index), c.append(a(this.settings.template.wrapper)), c.first().attr(this.add_namespace("data-index"), b.index), a(".joyride-content-wrapper", c).append(d), c[0] }, timer_instance: function (b) { var c; return c = 0 === b && this.settings.start_timer_on_click && this.settings.timer > 0 || 0 === this.settings.timer ? "" : a(this.settings.template.timer)[0].outerHTML }, button_text: function (b) { return this.settings.tip_settings.next_button ? (b = a.trim(b) || "Next", b = a(this.settings.template.button).append(b)[0].outerHTML) : b = "", b }, prev_button_text: function (b, c) { return this.settings.tip_settings.prev_button ? (b = a.trim(b) || "Previous", b = 0 == c ? a(this.settings.template.prev_button).append(b).addClass("disabled")[0].outerHTML : a(this.settings.template.prev_button).append(b)[0].outerHTML) : b = "", b }, create: function (b) { this.settings.tip_settings = a.extend({}, this.settings, this.data_options(b.$li)); var c = b.$li.attr(this.add_namespace("data-button")) || b.$li.attr(this.add_namespace("data-text")), d = b.$li.attr(this.add_namespace("data-button-prev")) || b.$li.attr(this.add_namespace("data-prev-text")), e = b.$li.attr("class"), f = a(this.tip_template({ tip_class: e, index: b.index, button_text: c, prev_button_text: d, li: b.$li })); a(this.settings.tip_container).append(f) }, show: function (b, c) { var e = null; this.settings.$li === d || -1 === a.inArray(this.settings.$li.index(), this.settings.pause_after) ? (this.settings.paused ? this.settings.paused = !1 : this.set_li(b, c), this.settings.attempts = 0, this.settings.$li.length && this.settings.$target.length > 0 ? (b && (this.settings.pre_ride_callback(this.settings.$li.index(), this.settings.$next_tip), this.settings.modal && this.show_modal()), this.settings.pre_step_callback(this.settings.$li.index(), this.settings.$next_tip), this.settings.modal && this.settings.expose && this.expose(), this.settings.tip_settings = a.extend({}, this.settings, this.data_options(this.settings.$li)), this.settings.timer = parseInt(this.settings.timer, 10), this.settings.tip_settings.tip_location_pattern = this.settings.tip_location_patterns[this.settings.tip_settings.tip_location], /body/i.test(this.settings.$target.selector) || this.scroll_to(), this.is_phone() ? this.pos_phone(!0) : this.pos_default(!0), e = this.settings.$next_tip.find(".joyride-timer-indicator"), /pop/i.test(this.settings.tip_animation) ? (e.width(0), this.settings.timer > 0 ? (this.settings.$next_tip.show(), setTimeout(function () { e.animate({ width: e.parent().width() }, this.settings.timer, "linear") }.bind(this), this.settings.tip_animation_fade_speed)) : this.settings.$next_tip.show()) : /fade/i.test(this.settings.tip_animation) && (e.width(0), this.settings.timer > 0 ? (this.settings.$next_tip.fadeIn(this.settings.tip_animation_fade_speed).show(), setTimeout(function () { e.animate({ width: e.parent().width() }, this.settings.timer, "linear") }.bind(this), this.settings.tip_animation_fade_speed)) : this.settings.$next_tip.fadeIn(this.settings.tip_animation_fade_speed)), this.settings.$current_tip = this.settings.$next_tip) : this.settings.$li && this.settings.$target.length < 1 ? this.show(b, c) : this.end()) : this.settings.paused = !0 }, is_phone: function () { return matchMedia(Foundation.media_queries.small).matches && !matchMedia(Foundation.media_queries.medium).matches }, hide: function () { this.settings.modal && this.settings.expose && this.un_expose(), this.settings.modal || a(".joyride-modal-bg").hide(), this.settings.$current_tip.css("visibility", "hidden"), setTimeout(a.proxy(function () { this.hide(), this.css("visibility", "visible") }, this.settings.$current_tip), 0), this.settings.post_step_callback(this.settings.$li.index(), this.settings.$current_tip) }, set_li: function (a, b) { a ? (this.settings.$li = this.settings.$tip_content.eq(this.settings.start_offset), this.set_next_tip(), this.settings.$current_tip = this.settings.$next_tip) : (this.settings.$li = b ? this.settings.$li.prev() : this.settings.$li.next(), this.set_next_tip()), this.set_target() }, set_next_tip: function () { this.settings.$next_tip = a(".joyride-tip-guide").eq(this.settings.$li.index()), this.settings.$next_tip.data("closed", "") }, set_target: function () { var b = this.settings.$li.attr(this.add_namespace("data-class")), d = this.settings.$li.attr(this.add_namespace("data-id")), e = function () { return d ? a(c.getElementById(d)) : b ? a("." + b).first() : a("body") }; this.settings.$target = e() }, scroll_to: function () { var c, d; c = a(b).height() / 2, d = Math.ceil(this.settings.$target.offset().top - c + this.settings.$next_tip.outerHeight()), 0 != d && a("html, body").stop().animate({ scrollTop: d }, this.settings.scroll_speed, "swing") }, paused: function () { return -1 === a.inArray(this.settings.$li.index() + 1, this.settings.pause_after) }, restart: function () { this.hide(), this.settings.$li = d, this.show("init") }, pos_default: function (a) { var b = this.settings.$next_tip.find(".joyride-nub"), c = Math.ceil(b.outerWidth() / 2), d = Math.ceil(b.outerHeight() / 2), e = a || !1; if (e && (this.settings.$next_tip.css("visibility", "hidden"), this.settings.$next_tip.show()), /body/i.test(this.settings.$target.selector)) this.settings.$li.length && this.pos_modal(b); else { var f = this.settings.tip_settings.tipAdjustmentY ? parseInt(this.settings.tip_settings.tipAdjustmentY) : 0, g = this.settings.tip_settings.tipAdjustmentX ? parseInt(this.settings.tip_settings.tipAdjustmentX) : 0; this.bottom() ? (this.settings.$next_tip.css(this.rtl ? { top: this.settings.$target.offset().top + d + this.settings.$target.outerHeight() + f, left: this.settings.$target.offset().left + this.settings.$target.outerWidth() - this.settings.$next_tip.outerWidth() + g } : { top: this.settings.$target.offset().top + d + this.settings.$target.outerHeight() + f, left: this.settings.$target.offset().left + g }), this.nub_position(b, this.settings.tip_settings.nub_position, "top")) : this.top() ? (this.settings.$next_tip.css(this.rtl ? { top: this.settings.$target.offset().top - this.settings.$next_tip.outerHeight() - d + f, left: this.settings.$target.offset().left + this.settings.$target.outerWidth() - this.settings.$next_tip.outerWidth() } : { top: this.settings.$target.offset().top - this.settings.$next_tip.outerHeight() - d + f, left: this.settings.$target.offset().left + g }), this.nub_position(b, this.settings.tip_settings.nub_position, "bottom")) : this.right() ? (this.settings.$next_tip.css({ top: this.settings.$target.offset().top + f, left: this.settings.$target.outerWidth() + this.settings.$target.offset().left + c + g }), this.nub_position(b, this.settings.tip_settings.nub_position, "left")) : this.left() && (this.settings.$next_tip.css({ top: this.settings.$target.offset().top + f, left: this.settings.$target.offset().left - this.settings.$next_tip.outerWidth() - c + g }), this.nub_position(b, this.settings.tip_settings.nub_position, "right")), !this.visible(this.corners(this.settings.$next_tip)) && this.settings.attempts < this.settings.tip_settings.tip_location_pattern.length && (b.removeClass("bottom").removeClass("top").removeClass("right").removeClass("left"), this.settings.tip_settings.tip_location = this.settings.tip_settings.tip_location_pattern[this.settings.attempts], this.settings.attempts++, this.pos_default()) } e && (this.settings.$next_tip.hide(), this.settings.$next_tip.css("visibility", "visible")) }, pos_phone: function (b) { var c = this.settings.$next_tip.outerHeight(), d = (this.settings.$next_tip.offset(), this.settings.$target.outerHeight()), e = a(".joyride-nub", this.settings.$next_tip), f = Math.ceil(e.outerHeight() / 2), g = b || !1; e.removeClass("bottom").removeClass("top").removeClass("right").removeClass("left"), g && (this.settings.$next_tip.css("visibility", "hidden"), this.settings.$next_tip.show()), /body/i.test(this.settings.$target.selector) ? this.settings.$li.length && this.pos_modal(e) : this.top() ? (this.settings.$next_tip.offset({ top: this.settings.$target.offset().top - c - f }), e.addClass("bottom")) : (this.settings.$next_tip.offset({ top: this.settings.$target.offset().top + d + f }), e.addClass("top")), g && (this.settings.$next_tip.hide(), this.settings.$next_tip.css("visibility", "visible")) }, pos_modal: function (a) { this.center(), a.hide(), this.show_modal() }, show_modal: function () { if (!this.settings.$next_tip.data("closed")) { var b = a(".joyride-modal-bg"); b.length < 1 && a("body").append(this.settings.template.modal).show(), /pop/i.test(this.settings.tip_animation) ? b.show() : b.fadeIn(this.settings.tip_animation_fade_speed) } }, expose: function () { var c, d, e, f, g, h = "expose-" + this.random_str(6); if (arguments.length > 0 && arguments[0] instanceof a) e = arguments[0]; else { if (!this.settings.$target || /body/i.test(this.settings.$target.selector)) return !1; e = this.settings.$target } return e.length < 1 ? (b.console && console.error("element not valid", e), !1) : (c = a(this.settings.template.expose), this.settings.$body.append(c), c.css({ top: e.offset().top, left: e.offset().left, width: e.outerWidth(!0), height: e.outerHeight(!0) }), d = a(this.settings.template.expose_cover), f = { zIndex: e.css("z-index"), position: e.css("position") }, g = null == e.attr("class") ? "" : e.attr("class"), e.css("z-index", parseInt(c.css("z-index")) + 1), "static" == f.position && e.css("position", "relative"), e.data("expose-css", f), e.data("orig-class", g), e.attr("class", g + " " + this.settings.expose_add_class), d.css({ top: e.offset().top, left: e.offset().left, width: e.outerWidth(!0), height: e.outerHeight(!0) }), this.settings.modal && this.show_modal(), this.settings.$body.append(d), c.addClass(h), d.addClass(h), e.data("expose", h), this.settings.post_expose_callback(this.settings.$li.index(), this.settings.$next_tip, e), void this.add_exposed(e)) }, un_expose: function () { var c, d, e, f, g, h = !1; if (arguments.length > 0 && arguments[0] instanceof a) d = arguments[0]; else { if (!this.settings.$target || /body/i.test(this.settings.$target.selector)) return !1; d = this.settings.$target } return d.length < 1 ? (b.console && console.error("element not valid", d), !1) : (c = d.data("expose"), e = a("." + c), arguments.length > 1 && (h = arguments[1]), h === !0 ? a(".joyride-expose-wrapper,.joyride-expose-cover").remove() : e.remove(), f = d.data("expose-css"), "auto" == f.zIndex ? d.css("z-index", "") : d.css("z-index", f.zIndex), f.position != d.css("position") && ("static" == f.position ? d.css("position", "") : d.css("position", f.position)), g = d.data("orig-class"), d.attr("class", g), d.removeData("orig-classes"), d.removeData("expose"), d.removeData("expose-z-index"), void this.remove_exposed(d)) }, add_exposed: function (b) { this.settings.exposed = this.settings.exposed || [], b instanceof a || "object" == typeof b ? this.settings.exposed.push(b[0]) : "string" == typeof b && this.settings.exposed.push(b) }, remove_exposed: function (b) { var c, d; for (b instanceof a ? c = b[0] : "string" == typeof b && (c = b), this.settings.exposed = this.settings.exposed || [], d = this.settings.exposed.length; d--;)if (this.settings.exposed[d] == c) return void this.settings.exposed.splice(d, 1) }, center: function () { var c = a(b); return this.settings.$next_tip.css({ top: (c.height() - this.settings.$next_tip.outerHeight()) / 2 + c.scrollTop(), left: (c.width() - this.settings.$next_tip.outerWidth()) / 2 + c.scrollLeft() }), !0 }, bottom: function () { return /bottom/i.test(this.settings.tip_settings.tip_location) }, top: function () { return /top/i.test(this.settings.tip_settings.tip_location) }, right: function () { return /right/i.test(this.settings.tip_settings.tip_location) }, left: function () { return /left/i.test(this.settings.tip_settings.tip_location) }, corners: function (c) { var d = a(b), e = d.height() / 2, f = Math.ceil(this.settings.$target.offset().top - e + this.settings.$next_tip.outerHeight()), g = d.width() + d.scrollLeft(), h = d.height() + f, i = d.height() + d.scrollTop(), j = d.scrollTop(); return j > f && (j = 0 > f ? 0 : f), h > i && (i = h), [c.offset().top < j, g < c.offset().left + c.outerWidth(), i < c.offset().top + c.outerHeight(), d.scrollLeft() > c.offset().left] }, visible: function (a) { for (var b = a.length; b--;)if (a[b]) return !1; return !0 }, nub_position: function (a, b, c) { a.addClass("auto" === b ? c : b) }, startTimer: function () { this.settings.$li.length ? this.settings.automate = setTimeout(function () { this.hide(), this.show(), this.startTimer() }.bind(this), this.settings.timer) : clearTimeout(this.settings.automate) }, end: function (b) { this.settings.cookie_monster && a.cookie(this.settings.cookie_name, "ridden", { expires: this.settings.cookie_expires, domain: this.settings.cookie_domain }), this.settings.timer > 0 && clearTimeout(this.settings.automate), this.settings.modal && this.settings.expose && this.un_expose(), a(this.scope).off("keyup.joyride"), this.settings.$next_tip.data("closed", !0), this.settings.riding = !1, a(".joyride-modal-bg").hide(), this.settings.$current_tip.hide(), ("undefined" == typeof b || b === !1) && (this.settings.post_step_callback(this.settings.$li.index(), this.settings.$current_tip), this.settings.post_ride_callback(this.settings.$li.index(), this.settings.$current_tip)), a(".joyride-tip-guide").remove() }, off: function () { a(this.scope).off(".joyride"), a(b).off(".joyride"), a(".joyride-close-tip, .joyride-next-tip, .joyride-modal-bg").off(".joyride"), a(".joyride-tip-guide, .joyride-modal-bg").remove(), clearTimeout(this.settings.automate), this.settings = {} }, reflow: function () { } } }(jQuery, window, window.document), function (a, b) { "use strict"; Foundation.libs["magellan-expedition"] = { name: "magellan-expedition", version: "5.4.6", settings: { active_class: "active", threshold: 0, destination_threshold: 20, throttle_delay: 30, fixed_top: 0 }, init: function (a, b, c) { Foundation.inherit(this, "throttle"), this.bindings(b, c) }, events: function () { var c = this, d = c.S, e = c.settings; c.set_expedition_position(), d(c.scope).off(".magellan").on("click.fndtn.magellan", "[" + c.add_namespace("data-magellan-arrival") + '] a[href^="#"]', function (b) { b.preventDefault(); var d = a(this).closest("[" + c.attr_name() + "]"), e = d.data("magellan-expedition-init"), f = this.hash.split("#").join(""), g = a("a[name='" + f + "']"); 0 === g.length && (g = a("#" + f)); var h = g.offset().top - e.destination_threshold + 1; h -= d.outerHeight(), a("html, body").stop().animate({ scrollTop: h }, 700, "swing", function () { history.pushState ? history.pushState(null, null, "#" + f) : location.hash = "#" + f }) }).on("scroll.fndtn.magellan", c.throttle(this.check_for_arrivals.bind(this), e.throttle_delay)), a(b).on("resize.fndtn.magellan", c.throttle(this.set_expedition_position.bind(this), e.throttle_delay)) }, check_for_arrivals: function () { var a = this; a.update_arrivals(), a.update_expedition_positions() }, set_expedition_position: function () { var b = this; a("[" + this.attr_name() + "=fixed]", b.scope).each(function () { var c, d, e = a(this), f = e.data("magellan-expedition-init"), g = e.attr("styles"); e.attr("style", ""), c = e.offset().top + f.threshold, d = parseInt(e.data("magellan-fixed-top")), isNaN(d) || (b.settings.fixed_top = d), e.data(b.data_attr("magellan-top-offset"), c), e.attr("style", g) }) }, update_expedition_positions: function () { var c = this, d = a(b).scrollTop(); a("[" + this.attr_name() + "=fixed]", c.scope).each(function () { var b = a(this), e = b.data("magellan-expedition-init"), f = b.attr("style"), g = b.data("magellan-top-offset"); if (d + c.settings.fixed_top >= g) { var h = b.prev("[" + c.add_namespace("data-magellan-expedition-clone") + "]"); 0 === h.length && (h = b.clone(), h.removeAttr(c.attr_name()), h.attr(c.add_namespace("data-magellan-expedition-clone"), ""), b.before(h)), b.css({ position: "fixed", top: e.fixed_top }).addClass("fixed") } else b.prev("[" + c.add_namespace("data-magellan-expedition-clone") + "]").remove(), b.attr("style", f).css("position", "").css("top", "").removeClass("fixed") }) }, update_arrivals: function () { var c = this, d = a(b).scrollTop(); a("[" + this.attr_name() + "]", c.scope).each(function () { var b = a(this), e = b.data(c.attr_name(!0) + "-init"), f = c.offsets(b, d), g = b.find("[" + c.add_namespace("data-magellan-arrival") + "]"), h = !1; f.each(function (a, d) { if (d.viewport_offset >= d.top_offset) { var f = b.find("[" + c.add_namespace("data-magellan-arrival") + "]"); return f.not(d.arrival).removeClass(e.active_class), d.arrival.addClass(e.active_class), h = !0, !0 } }), h || g.removeClass(e.active_class) }) }, offsets: function (b, c) { var d = this, e = b.data(d.attr_name(!0) + "-init"), f = c; return b.find("[" + d.add_namespace("data-magellan-arrival") + "]").map(function () { var c = a(this).data(d.data_attr("magellan-arrival")), g = a("[" + d.add_namespace("data-magellan-destination") + "=" + c + "]"); if (g.length > 0) { var h = Math.floor(g.offset().top - e.destination_threshold - b.outerHeight()); return { destination: g, arrival: a(this), top_offset: h, viewport_offset: f } } }).sort(function (a, b) { return a.top_offset < b.top_offset ? -1 : a.top_offset > b.top_offset ? 1 : 0 }) }, data_attr: function (a) { return this.namespace.length > 0 ? this.namespace + "-" + a : a }, off: function () { this.S(this.scope).off(".magellan"), this.S(b).off(".magellan") }, reflow: function () { var b = this; a("[" + b.add_namespace("data-magellan-expedition-clone") + "]", b.scope).remove() } } }(jQuery, window, window.document), function (a) { "use strict"; Foundation.libs.offcanvas = { name: "offcanvas", version: "5.4.6", settings: { open_method: "move", close_on_click: !1 }, init: function (a, b, c) { this.bindings(b, c) }, events: function () { var b = this, c = b.S, d = "", e = "", f = ""; "move" === this.settings.open_method ? (d = "move-", e = "right", f = "left") : "overlap_single" === this.settings.open_method ? (d = "offcanvas-overlap-", e = "right", f = "left") : "overlap" === this.settings.open_method && (d = "offcanvas-overlap"), c(this.scope).off(".offcanvas").on("click.fndtn.offcanvas", ".left-off-canvas-toggle", function (f) { b.click_toggle_class(f, d + e), "overlap" !== b.settings.open_method && c(".left-submenu").removeClass(d + e), a(".left-off-canvas-toggle").attr("aria-expanded", "true") }).on("click.fndtn.offcanvas", ".left-off-canvas-menu a", function (f) { var g = b.get_settings(f), h = c(this).parent(); !g.close_on_click || h.hasClass("has-submenu") || h.hasClass("back") ? c(this).parent().hasClass("has-submenu") ? (f.preventDefault(), c(this).siblings(".left-submenu").toggleClass(d + e)) : h.hasClass("back") && (f.preventDefault(), h.parent().removeClass(d + e)) : (b.hide.call(b, d + e, b.get_wrapper(f)), h.parent().removeClass(d + e)), a(".left-off-canvas-toggle").attr("aria-expanded", "true") }).on("click.fndtn.offcanvas", ".right-off-canvas-toggle", function (e) { b.click_toggle_class(e, d + f), "overlap" !== b.settings.open_method && c(".right-submenu").removeClass(d + f), a(".right-off-canvas-toggle").attr("aria-expanded", "true") }).on("click.fndtn.offcanvas", ".right-off-canvas-menu a", function (e) { var g = b.get_settings(e), h = c(this).parent(); !g.close_on_click || h.hasClass("has-submenu") || h.hasClass("back") ? c(this).parent().hasClass("has-submenu") ? (e.preventDefault(), c(this).siblings(".right-submenu").toggleClass(d + f)) : h.hasClass("back") && (e.preventDefault(), h.parent().removeClass(d + f)) : (b.hide.call(b, d + f, b.get_wrapper(e)), h.parent().removeClass(d + f)), a(".right-off-canvas-toggle").attr("aria-expanded", "true") }).on("click.fndtn.offcanvas", ".exit-off-canvas", function (g) { b.click_remove_class(g, d + f), c(".right-submenu").removeClass(d + f), e && (b.click_remove_class(g, d + e), c(".left-submenu").removeClass(d + f)), a(".right-off-canvas-toggle").attr("aria-expanded", "true") }).on("click.fndtn.offcanvas", ".exit-off-canvas", function (c) { b.click_remove_class(c, d + f), a(".left-off-canvas-toggle").attr("aria-expanded", "false"), e && (b.click_remove_class(c, d + e), a(".right-off-canvas-toggle").attr("aria-expanded", "false")) }) }, toggle: function (a, b) { b = b || this.get_wrapper(), b.is("." + a) ? this.hide(a, b) : this.show(a, b) }, show: function (a, b) { b = b || this.get_wrapper(), b.trigger("open").trigger("open.fndtn.offcanvas"), b.addClass(a) }, hide: function (a, b) { b = b || this.get_wrapper(), b.trigger("close").trigger("close.fndtn.offcanvas"), b.removeClass(a) }, click_toggle_class: function (a, b) { a.preventDefault(); var c = this.get_wrapper(a); this.toggle(b, c) }, click_remove_class: function (a, b) { a.preventDefault(); var c = this.get_wrapper(a); this.hide(b, c) }, get_settings: function (a) { var b = this.S(a.target).closest("[" + this.attr_name() + "]"); return b.data(this.attr_name(!0) + "-init") || this.settings }, get_wrapper: function (a) { var b = this.S(a ? a.target : this.scope).closest(".off-canvas-wrap"); return 0 === b.length && (b = this.S(".off-canvas-wrap")), b }, reflow: function () { } } }(jQuery, window, window.document), function (a, b, c, d) {
    "use strict"; var e = function () { }, f = function (e, f) {
        if (e.hasClass(f.slides_container_class)) return this; var j, k, l, m, n, o, p = this, q = e, r = 0, s = !1; p.slides = function () { return q.children(f.slide_selector) }, p.slides().first().addClass(f.active_slide_class), p.update_slide_number = function (b) { f.slide_number && (k.find("span:first").text(parseInt(b) + 1), k.find("span:last").text(p.slides().length)), f.bullets && (l.children().removeClass(f.bullets_active_class), a(l.children().get(b)).addClass(f.bullets_active_class)) }, p.update_active_link = function (b) { var c = a('[data-orbit-link="' + p.slides().eq(b).attr("data-orbit-slide") + '"]'); c.siblings().removeClass(f.bullets_active_class), c.addClass(f.bullets_active_class) }, p.build_markup = function () { q.wrap('<div class="' + f.container_class + '"></div>'), j = q.parent(), q.addClass(f.slides_container_class), f.stack_on_small && j.addClass(f.stack_on_small_class), f.navigation_arrows && (j.append(a('<a href="#"><span></span></a>').addClass(f.prev_class)), j.append(a('<a href="#"><span></span></a>').addClass(f.next_class))), f.timer && (m = a("<div>").addClass(f.timer_container_class), m.append("<span>"), m.append(a("<div>").addClass(f.timer_progress_class)), m.addClass(f.timer_paused_class), j.append(m)), f.slide_number && (k = a("<div>").addClass(f.slide_number_class), k.append("<span></span> " + f.slide_number_text + " <span></span>"), j.append(k)), f.bullets && (l = a("<ol>").addClass(f.bullets_container_class), j.append(l), l.wrap('<div class="orbit-bullets-container"></div>'), p.slides().each(function (b) { var c = a("<li>").attr("data-orbit-slide", b).on("click", p.link_bullet); l.append(c) })) }, p._goto = function (b, c) { if (b === r) return !1; "object" == typeof o && o.restart(); var d = p.slides(), e = "next"; if (s = !0, r > b && (e = "prev"), b >= d.length) { if (!f.circular) return !1; b = 0 } else if (0 > b) { if (!f.circular) return !1; b = d.length - 1 } var g = a(d.get(r)), h = a(d.get(b)); g.css("zIndex", 2), g.removeClass(f.active_slide_class), h.css("zIndex", 4).addClass(f.active_slide_class), q.trigger("before-slide-change.fndtn.orbit"), f.before_slide_change(), p.update_active_link(b); var i = function () { var a = function () { r = b, s = !1, c === !0 && (o = p.create_timer(), o.start()), p.update_slide_number(r), q.trigger("after-slide-change.fndtn.orbit", [{ slide_number: r, total_slides: d.length }]), f.after_slide_change(r, d.length) }; q.height() != h.height() && f.variable_height ? q.animate({ height: h.height() }, 250, "linear", a) : a() }; if (1 === d.length) return i(), !1; var j = function () { "next" === e && n.next(g, h, i), "prev" === e && n.prev(g, h, i) }; h.height() > q.height() && f.variable_height ? q.animate({ height: h.height() }, 250, "linear", j) : j() }, p.next = function (a) { a.stopImmediatePropagation(), a.preventDefault(), p._goto(r + 1) }, p.prev = function (a) { a.stopImmediatePropagation(), a.preventDefault(), p._goto(r - 1) }, p.link_custom = function (b) { b.preventDefault(); var c = a(this).attr("data-orbit-link"); if ("string" == typeof c && "" != (c = a.trim(c))) { var d = j.find("[data-orbit-slide=" + c + "]"); -1 != d.index() && p._goto(d.index()) } }, p.link_bullet = function () { var b = a(this).attr("data-orbit-slide"); if ("string" == typeof b && "" != (b = a.trim(b))) if (isNaN(parseInt(b))) { var c = j.find("[data-orbit-slide=" + b + "]"); -1 != c.index() && p._goto(c.index() + 1) } else p._goto(parseInt(b)) }, p.timer_callback = function () { p._goto(r + 1, !0) }, p.compute_dimensions = function () { var b = a(p.slides().get(r)), c = b.height(); f.variable_height || p.slides().each(function () { a(this).height() > c && (c = a(this).height()) }), q.height(c) }, p.create_timer = function () { var a = new g(j.find("." + f.timer_container_class), f, p.timer_callback); return a }, p.stop_timer = function () { "object" == typeof o && o.stop() }, p.toggle_timer = function () { var a = j.find("." + f.timer_container_class); a.hasClass(f.timer_paused_class) ? ("undefined" == typeof o && (o = p.create_timer()), o.start()) : "object" == typeof o && o.stop() }, p.init = function () {
            p.build_markup(), f.timer && (o = p.create_timer(), Foundation.utils.image_loaded(this.slides().children("img"), o.start)), n = new i(f, q), "slide" === f.animation && (n = new h(f, q)), j.on("click", "." + f.next_class, p.next), j.on("click", "." + f.prev_class, p.prev), f.next_on_click && j.on("click", "." + f.slides_container_class + " [data-orbit-slide]", p.link_bullet), j.on("click", p.toggle_timer), f.swipe && j.on("touchstart.fndtn.orbit", function (a) { a.touches || (a = a.originalEvent); var b = { start_page_x: a.touches[0].pageX, start_page_y: a.touches[0].pageY, start_time: (new Date).getTime(), delta_x: 0, is_scrolling: d }; j.data("swipe-transition", b), a.stopPropagation() }).on("touchmove.fndtn.orbit", function (a) {
                if (a.touches || (a = a.originalEvent), !(a.touches.length > 1 || a.scale && 1 !== a.scale)) {
                    var b = j.data("swipe-transition"); if ("undefined" == typeof b && (b = {}), b.delta_x = a.touches[0].pageX - b.start_page_x, "undefined" == typeof b.is_scrolling && (b.is_scrolling = !!(b.is_scrolling || Math.abs(b.delta_x) < Math.abs(a.touches[0].pageY - b.start_page_y))), !b.is_scrolling && !b.active) {
                        a.preventDefault();
                        var c = b.delta_x < 0 ? r + 1 : r - 1; b.active = !0, p._goto(c)
                    }
                }
            }).on("touchend.fndtn.orbit", function (a) { j.data("swipe-transition", {}), a.stopPropagation() }), j.on("mouseenter.fndtn.orbit", function () { f.timer && f.pause_on_hover && p.stop_timer() }).on("mouseleave.fndtn.orbit", function () { f.timer && f.resume_on_mouseout && o.start() }), a(c).on("click", "[data-orbit-link]", p.link_custom), a(b).on("load resize", p.compute_dimensions), Foundation.utils.image_loaded(this.slides().children("img"), p.compute_dimensions), Foundation.utils.image_loaded(this.slides().children("img"), function () { j.prev("." + f.preloader_class).css("display", "none"), p.update_slide_number(0), p.update_active_link(0), q.trigger("ready.fndtn.orbit") })
        }, p.init()
    }, g = function (a, b, c) { var d, e, f = this, g = b.timer_speed, h = a.find("." + b.timer_progress_class), i = -1; this.update_progress = function (a) { var b = h.clone(); b.attr("style", ""), b.css("width", a + "%"), h.replaceWith(b), h = b }, this.restart = function () { clearTimeout(e), a.addClass(b.timer_paused_class), i = -1, f.update_progress(0) }, this.start = function () { return a.hasClass(b.timer_paused_class) ? (i = -1 === i ? g : i, a.removeClass(b.timer_paused_class), d = (new Date).getTime(), h.animate({ width: "100%" }, i, "linear"), e = setTimeout(function () { f.restart(), c() }, i), void a.trigger("timer-started.fndtn.orbit")) : !0 }, this.stop = function () { if (a.hasClass(b.timer_paused_class)) return !0; clearTimeout(e), a.addClass(b.timer_paused_class); var c = (new Date).getTime(); i -= c - d; var h = 100 - i / g * 100; f.update_progress(h), a.trigger("timer-stopped.fndtn.orbit") } }, h = function (b) { var c = b.animation_speed, d = 1 === a("html[dir=rtl]").length, e = d ? "marginRight" : "marginLeft", f = {}; f[e] = "0%", this.next = function (a, b, d) { a.animate({ marginLeft: "-100%" }, c), b.animate(f, c, function () { a.css(e, "100%"), d() }) }, this.prev = function (a, b, d) { a.animate({ marginLeft: "100%" }, c), b.css(e, "-100%"), b.animate(f, c, function () { a.css(e, "100%"), d() }) } }, i = function (b) { { var c = b.animation_speed; 1 === a("html[dir=rtl]").length } this.next = function (a, b, d) { b.css({ margin: "0%", opacity: "0.01" }), b.animate({ opacity: "1" }, c, "linear", function () { a.css("margin", "100%"), d() }) }, this.prev = function (a, b, d) { b.css({ margin: "0%", opacity: "0.01" }), b.animate({ opacity: "1" }, c, "linear", function () { a.css("margin", "100%"), d() }) } }; Foundation.libs = Foundation.libs || {}, Foundation.libs.orbit = { name: "orbit", version: "5.4.6", settings: { animation: "slide", timer_speed: 1e4, pause_on_hover: !0, resume_on_mouseout: !1, next_on_click: !0, animation_speed: 500, stack_on_small: !1, navigation_arrows: !0, slide_number: !0, slide_number_text: "of", container_class: "orbit-container", stack_on_small_class: "orbit-stack-on-small", next_class: "orbit-next", prev_class: "orbit-prev", timer_container_class: "orbit-timer", timer_paused_class: "paused", timer_progress_class: "orbit-progress", slides_container_class: "orbit-slides-container", preloader_class: "preloader", slide_selector: "*", bullets_container_class: "orbit-bullets", bullets_active_class: "active", slide_number_class: "orbit-slide-number", caption_class: "orbit-caption", active_slide_class: "active", orbit_transition_class: "orbit-transitioning", bullets: !0, circular: !0, timer: !0, variable_height: !1, swipe: !0, before_slide_change: e, after_slide_change: e }, init: function (a, b, c) { this.bindings(b, c) }, events: function (a) { var b = new f(this.S(a), this.S(a).data("orbit-init")); this.S(a).data(this.name + "-instance", b) }, reflow: function () { var a = this; if (a.S(a.scope).is("[data-orbit]")) { var b = a.S(a.scope), c = b.data(a.name + "-instance"); c.compute_dimensions() } else a.S("[data-orbit]", a.scope).each(function (b, c) { var d = a.S(c), e = (a.data_options(d), d.data(a.name + "-instance")); e.compute_dimensions() }) } }
}(jQuery, window, window.document), function (a, b, c, d) { "use strict"; function e(a) { var b = /fade/i.test(a), c = /pop/i.test(a); return { animate: b || c, pop: c, fade: b } } Foundation.libs.reveal = { name: "reveal", version: "5.4.6", locked: !1, settings: { animation: "fadeAndPop", animation_speed: 250, close_on_background_click: !0, close_on_esc: !0, dismiss_modal_class: "close-reveal-modal", bg_class: "reveal-modal-bg", root_element: "body", open: function () { }, opened: function () { }, close: function () { }, closed: function () { }, bg: a(".reveal-modal-bg"), css: { open: { opacity: 0, visibility: "visible", display: "block" }, close: { opacity: 1, visibility: "hidden", display: "none" } } }, init: function (b, c, d) { a.extend(!0, this.settings, c, d), this.bindings(c, d) }, events: function () { var a = this, b = a.S; return b(this.scope).off(".reveal").on("click.fndtn.reveal", "[" + this.add_namespace("data-reveal-id") + "]:not([disabled])", function (c) { if (c.preventDefault(), !a.locked) { var d = b(this), e = d.data(a.data_attr("reveal-ajax")); if (a.locked = !0, "undefined" == typeof e) a.open.call(a, d); else { var f = e === !0 ? d.attr("href") : e; a.open.call(a, d, { url: f }) } } }), b(c).on("click.fndtn.reveal", this.close_targets(), function (c) { if (c.preventDefault(), !a.locked) { var d = b("[" + a.attr_name() + "].open").data(a.attr_name(!0) + "-init"), e = b(c.target)[0] === b("." + d.bg_class)[0]; if (e) { if (!d.close_on_background_click) return; c.stopPropagation() } a.locked = !0, a.close.call(a, e ? b("[" + a.attr_name() + "].open") : b(this).closest("[" + a.attr_name() + "]")) } }), b("[" + a.attr_name() + "]", this.scope).length > 0 ? b(this.scope).on("open.fndtn.reveal", this.settings.open).on("opened.fndtn.reveal", this.settings.opened).on("opened.fndtn.reveal", this.open_video).on("close.fndtn.reveal", this.settings.close).on("closed.fndtn.reveal", this.settings.closed).on("closed.fndtn.reveal", this.close_video) : b(this.scope).on("open.fndtn.reveal", "[" + a.attr_name() + "]", this.settings.open).on("opened.fndtn.reveal", "[" + a.attr_name() + "]", this.settings.opened).on("opened.fndtn.reveal", "[" + a.attr_name() + "]", this.open_video).on("close.fndtn.reveal", "[" + a.attr_name() + "]", this.settings.close).on("closed.fndtn.reveal", "[" + a.attr_name() + "]", this.settings.closed).on("closed.fndtn.reveal", "[" + a.attr_name() + "]", this.close_video), !0 }, key_up_on: function () { var a = this; return a.S("body").off("keyup.fndtn.reveal").on("keyup.fndtn.reveal", function (b) { var c = a.S("[" + a.attr_name() + "].open"), d = c.data(a.attr_name(!0) + "-init") || a.settings; d && 27 === b.which && d.close_on_esc && !a.locked && a.close.call(a, c) }), !0 }, key_up_off: function () { return this.S("body").off("keyup.fndtn.reveal"), !0 }, open: function (c, d) { var e, f = this; c ? "undefined" != typeof c.selector ? e = f.S("#" + c.data(f.data_attr("reveal-id"))).first() : (e = f.S(this.scope), d = c) : e = f.S(this.scope); var g = e.data(f.attr_name(!0) + "-init"); if (g = g || this.settings, e.hasClass("open") && c.attr("data-reveal-id") == e.attr("id")) return f.close(e); if (!e.hasClass("open")) { var h = f.S("[" + f.attr_name() + "].open"); if ("undefined" == typeof e.data("css-top") && e.data("css-top", parseInt(e.css("top"), 10)).data("offset", this.cache_offset(e)), this.key_up_on(e), e.trigger("open").trigger("open.fndtn.reveal"), h.length < 1 && this.toggle_bg(e, !0), "string" == typeof d && (d = { url: d }), "undefined" != typeof d && d.url) { var i = "undefined" != typeof d.success ? d.success : null; a.extend(d, { success: function (b, c, d) { a.isFunction(i) && i(b, c, d), e.html(b), f.S(e).foundation("section", "reflow"), f.S(e).children().foundation(), h.length > 0 && f.hide(h, g.css.close), f.show(e, g.css.open) } }), a.ajax(d) } else h.length > 0 && this.hide(h, g.css.close), this.show(e, g.css.open) } f.S(b).trigger("resize") }, close: function (a) { var a = a && a.length ? a : this.S(this.scope), b = this.S("[" + this.attr_name() + "].open"), c = a.data(this.attr_name(!0) + "-init") || this.settings; b.length > 0 && (this.locked = !0, this.key_up_off(a), a.trigger("close").trigger("close.fndtn.reveal"), this.toggle_bg(a, !1), this.hide(b, c.css.close, c)) }, close_targets: function () { var a = "." + this.settings.dismiss_modal_class; return this.settings.close_on_background_click ? a + ", ." + this.settings.bg_class : a }, toggle_bg: function (b, c) { 0 === this.S("." + this.settings.bg_class).length && (this.settings.bg = a("<div />", { "class": this.settings.bg_class }).appendTo("body").hide()); var e = this.settings.bg.filter(":visible").length > 0; c != e && ((c == d ? e : !c) ? this.hide(this.settings.bg) : this.show(this.settings.bg)) }, show: function (c, d) { if (d) { var f = c.data(this.attr_name(!0) + "-init") || this.settings, g = f.root_element; if (0 === c.parent(g).length) { var h = c.wrap('<div style="display: none;" />').parent(); c.on("closed.fndtn.reveal.wrapped", function () { c.detach().appendTo(h), c.unwrap().unbind("closed.fndtn.reveal.wrapped") }), c.detach().appendTo(g) } var i = e(f.animation); if (i.animate || (this.locked = !1), i.pop) { d.top = a(b).scrollTop() - c.data("offset") + "px"; var j = { top: a(b).scrollTop() + c.data("css-top") + "px", opacity: 1 }; return setTimeout(function () { return c.css(d).animate(j, f.animation_speed, "linear", function () { this.locked = !1, c.trigger("opened").trigger("opened.fndtn.reveal") }.bind(this)).addClass("open") }.bind(this), f.animation_speed / 2) } if (i.fade) { d.top = a(b).scrollTop() + c.data("css-top") + "px"; var j = { opacity: 1 }; return setTimeout(function () { return c.css(d).animate(j, f.animation_speed, "linear", function () { this.locked = !1, c.trigger("opened").trigger("opened.fndtn.reveal") }.bind(this)).addClass("open") }.bind(this), f.animation_speed / 2) } return c.css(d).show().css({ opacity: 1 }).addClass("open").trigger("opened").trigger("opened.fndtn.reveal") } var f = this.settings; return e(f.animation).fade ? c.fadeIn(f.animation_speed / 2) : (this.locked = !1, c.show()) }, hide: function (c, d) { if (d) { var f = c.data(this.attr_name(!0) + "-init"); f = f || this.settings; var g = e(f.animation); if (g.animate || (this.locked = !1), g.pop) { var h = { top: -a(b).scrollTop() - c.data("offset") + "px", opacity: 0 }; return setTimeout(function () { return c.animate(h, f.animation_speed, "linear", function () { this.locked = !1, c.css(d).trigger("closed").trigger("closed.fndtn.reveal") }.bind(this)).removeClass("open") }.bind(this), f.animation_speed / 2) } if (g.fade) { var h = { opacity: 0 }; return setTimeout(function () { return c.animate(h, f.animation_speed, "linear", function () { this.locked = !1, c.css(d).trigger("closed").trigger("closed.fndtn.reveal") }.bind(this)).removeClass("open") }.bind(this), f.animation_speed / 2) } return c.hide().css(d).removeClass("open").trigger("closed").trigger("closed.fndtn.reveal") } var f = this.settings; return e(f.animation).fade ? c.fadeOut(f.animation_speed / 2) : c.hide() }, close_video: function (b) { var c = a(".flex-video", b.target), d = a("iframe", c); d.length > 0 && (d.attr("data-src", d[0].src), d.attr("src", d.attr("src")), c.hide()) }, open_video: function (b) { var c = a(".flex-video", b.target), e = c.find("iframe"); if (e.length > 0) { var f = e.attr("data-src"); if ("string" == typeof f) e[0].src = e.attr("data-src"); else { var g = e[0].src; e[0].src = d, e[0].src = g } c.show() } }, data_attr: function (a) { return this.namespace.length > 0 ? this.namespace + "-" + a : a }, cache_offset: function (a) { var b = a.show().height() + parseInt(a.css("top"), 10); return a.hide(), b }, off: function () { a(this.scope).off(".fndtn.reveal") }, reflow: function () { } } }(jQuery, window, window.document), function (a, b) { "use strict"; Foundation.libs.slider = { name: "slider", version: "5.4.6", settings: { start: 0, end: 100, step: 1, initial: null, display_selector: "", vertical: !1, on_change: function () { } }, cache: {}, init: function (a, b, c) { Foundation.inherit(this, "throttle"), this.bindings(b, c), this.reflow() }, events: function () { var c = this; a(this.scope).off(".slider").on("mousedown.fndtn.slider touchstart.fndtn.slider pointerdown.fndtn.slider", "[" + c.attr_name() + "]:not(.disabled, [disabled]) .range-slider-handle", function (b) { c.cache.active || (b.preventDefault(), c.set_active_slider(a(b.target))) }).on("mousemove.fndtn.slider touchmove.fndtn.slider pointermove.fndtn.slider", function (d) { if (c.cache.active) if (d.preventDefault(), a.data(c.cache.active[0], "settings").vertical) { var e = 0; d.pageY || (e = b.scrollY), c.calculate_position(c.cache.active, (d.pageY || d.originalEvent.clientY || d.originalEvent.touches[0].clientY || d.currentPoint.y) + e) } else c.calculate_position(c.cache.active, d.pageX || d.originalEvent.clientX || d.originalEvent.touches[0].clientX || d.currentPoint.x) }).on("mouseup.fndtn.slider touchend.fndtn.slider pointerup.fndtn.slider", function () { c.remove_active_slider() }).on("change.fndtn.slider", function () { c.settings.on_change() }), c.S(b).on("resize.fndtn.slider", c.throttle(function () { c.reflow() }, 300)) }, set_active_slider: function (a) { this.cache.active = a }, remove_active_slider: function () { this.cache.active = null }, calculate_position: function (b, c) { var d = this, e = a.data(b[0], "settings"), f = (a.data(b[0], "handle_l"), a.data(b[0], "handle_o"), a.data(b[0], "bar_l")), g = a.data(b[0], "bar_o"); requestAnimationFrame(function () { var a; a = Foundation.rtl && !e.vertical ? d.limit_to((g + f - c) / f, 0, 1) : d.limit_to((c - g) / f, 0, 1), a = e.vertical ? 1 - a : a; var h = d.normalized_value(a, e.start, e.end, e.step); d.set_ui(b, h) }) }, set_ui: function (b, c) { var d = a.data(b[0], "settings"), e = a.data(b[0], "handle_l"), f = a.data(b[0], "bar_l"), g = this.normalized_percentage(c, d.start, d.end), h = g * (f - e) - 1, i = 100 * g; Foundation.rtl && !d.vertical && (h = -h), h = d.vertical ? -h + f - e + 1 : h, this.set_translate(b, h, d.vertical), d.vertical ? b.siblings(".range-slider-active-segment").css("height", i + "%") : b.siblings(".range-slider-active-segment").css("width", i + "%"), b.parent().attr(this.attr_name(), c).trigger("change").trigger("change.fndtn.slider"), b.parent().children("input[type=hidden]").val(c), b[0].hasAttribute("aria-valuemin") || b.attr({ "aria-valuemin": d.start, "aria-valuemax": d.end }), b.attr("aria-valuenow", c), "" != d.display_selector && a(d.display_selector).each(function () { this.hasOwnProperty("value") ? a(this).val(c) : a(this).text(c) }) }, normalized_percentage: function (a, b, c) { return Math.min(1, (a - b) / (c - b)) }, normalized_value: function (a, b, c, d) { var e = c - b, f = a * e, g = (f - f % d) / d, h = f % d, i = h >= .5 * d ? d : 0; return g * d + i + b }, set_translate: function (b, c, d) { d ? a(b).css("-webkit-transform", "translateY(" + c + "px)").css("-moz-transform", "translateY(" + c + "px)").css("-ms-transform", "translateY(" + c + "px)").css("-o-transform", "translateY(" + c + "px)").css("transform", "translateY(" + c + "px)") : a(b).css("-webkit-transform", "translateX(" + c + "px)").css("-moz-transform", "translateX(" + c + "px)").css("-ms-transform", "translateX(" + c + "px)").css("-o-transform", "translateX(" + c + "px)").css("transform", "translateX(" + c + "px)") }, limit_to: function (a, b, c) { return Math.min(Math.max(a, b), c) }, initialize_settings: function (b) { var c = a.extend({}, this.settings, this.data_options(a(b).parent())); c.vertical ? (a.data(b, "bar_o", a(b).parent().offset().top), a.data(b, "bar_l", a(b).parent().outerHeight()), a.data(b, "handle_o", a(b).offset().top), a.data(b, "handle_l", a(b).outerHeight())) : (a.data(b, "bar_o", a(b).parent().offset().left), a.data(b, "bar_l", a(b).parent().outerWidth()), a.data(b, "handle_o", a(b).offset().left), a.data(b, "handle_l", a(b).outerWidth())), a.data(b, "bar", a(b).parent()), a.data(b, "settings", c) }, set_initial_position: function (b) { var c = a.data(b.children(".range-slider-handle")[0], "settings"), d = c.initial ? c.initial : Math.floor(.5 * (c.end - c.start) / c.step) * c.step + c.start, e = b.children(".range-slider-handle"); this.set_ui(e, d) }, set_value: function (b) { var c = this; a("[" + c.attr_name() + "]", this.scope).each(function () { a(this).attr(c.attr_name(), b) }), a(this.scope).attr(c.attr_name()) && a(this.scope).attr(c.attr_name(), b), c.reflow() }, reflow: function () { var b = this; b.S("[" + this.attr_name() + "]").each(function () { var c = a(this).children(".range-slider-handle")[0], d = a(this).attr(b.attr_name()); b.initialize_settings(c), d ? b.set_ui(a(c), parseFloat(d)) : b.set_initial_position(a(this)) }) } } }(jQuery, window, window.document), function (a, b, c, d) { "use strict"; Foundation.libs.tab = { name: "tab", version: "5.4.6", settings: { active_class: "active", callback: function () { }, deep_linking: !1, scroll_to_content: !0, is_hover: !1 }, default_tab_hashes: [], init: function (a, b, c) { var d = this, e = this.S; this.bindings(b, c), this.handle_location_hash_change(), e("[" + this.attr_name() + "] > .active > a", this.scope).each(function () { d.default_tab_hashes.push(this.hash) }) }, events: function () { var a = this, c = this.S, d = function (b) { var d = c(this).closest("[" + a.attr_name() + "]").data(a.attr_name(!0) + "-init"); (!d.is_hover || Modernizr.touch) && (b.preventDefault(), b.stopPropagation(), a.toggle_active_tab(c(this).parent())) }; c(this.scope).off(".tab").on("focus.fndtn.tab", "[" + this.attr_name() + "] > * > a", d).on("click.fndtn.tab", "[" + this.attr_name() + "] > * > a", d).on("mouseenter.fndtn.tab", "[" + this.attr_name() + "] > * > a", function () { var b = c(this).closest("[" + a.attr_name() + "]").data(a.attr_name(!0) + "-init"); b.is_hover && a.toggle_active_tab(c(this).parent()) }), c(b).on("hashchange.fndtn.tab", function (b) { b.preventDefault(), a.handle_location_hash_change() }) }, handle_location_hash_change: function () { var b = this, c = this.S; c("[" + this.attr_name() + "]", this.scope).each(function () { var e = c(this).data(b.attr_name(!0) + "-init"); if (e.deep_linking) { var f; if (f = e.scroll_to_content ? b.scope.location.hash : b.scope.location.hash.replace("fndtn-", ""), "" != f) { var g = c(f); if (g.hasClass("content") && g.parent().hasClass("tab-content")) b.toggle_active_tab(a("[" + b.attr_name() + "] > * > a[href=" + f + "]").parent()); else { var h = g.closest(".content").attr("id"); h != d && b.toggle_active_tab(a("[" + b.attr_name() + "] > * > a[href=#" + h + "]").parent(), f) } } else for (var i = 0; i < b.default_tab_hashes.length; i++)b.toggle_active_tab(a("[" + b.attr_name() + "] > * > a[href=" + b.default_tab_hashes[i] + "]").parent()) } }) }, toggle_active_tab: function (e, f) { var g = this.S, h = e.closest("[" + this.attr_name() + "]"), i = e.find("a"), j = e.children("a").first(), k = "#" + j.attr("href").split("#")[1], l = g(k), m = e.siblings(), n = h.data(this.attr_name(!0) + "-init"), o = function (b) { var d, e = a(this), f = a(this).parents("li").prev().children('[role="tab"]'), g = a(this).parents("li").next().children('[role="tab"]'); switch (b.keyCode) { case 37: d = f; break; case 39: d = g; break; default: d = !1 }d.length && (e.attr({ tabindex: "-1", "aria-selected": null }), d.attr({ tabindex: "0", "aria-selected": !0 }).focus()), a('[role="tabpanel"]').attr("aria-hidden", "true"), a("#" + a(c.activeElement).attr("href").substring(1)).attr("aria-hidden", null) }; g(this).data(this.data_attr("tab-content")) && (k = "#" + g(this).data(this.data_attr("tab-content")).split("#")[1], l = g(k)), n.deep_linking && (n.scroll_to_content ? (b.location.hash = f || k, f == d || f == k ? e.parent()[0].scrollIntoView() : g(k)[0].scrollIntoView()) : b.location.hash = f != d ? "fndtn-" + f.replace("#", "") : "fndtn-" + k.replace("#", "")), e.addClass(n.active_class).triggerHandler("opened"), i.attr({ "aria-selected": "true", tabindex: 0 }), m.removeClass(n.active_class), m.find("a").attr({ "aria-selected": "false", tabindex: -1 }), l.siblings().removeClass(n.active_class).attr({ "aria-hidden": "true", tabindex: -1 }), l.addClass(n.active_class).attr("aria-hidden", "false").removeAttr("tabindex"), n.callback(e), l.triggerHandler("toggled", [e]), h.triggerHandler("toggled", [l]), i.off("keydown").on("keydown", o) }, data_attr: function (a) { return this.namespace.length > 0 ? this.namespace + "-" + a : a }, off: function () { }, reflow: function () { } } }(jQuery, window, window.document), function (a, b) { "use strict"; Foundation.libs.tooltip = { name: "tooltip", version: "5.4.6", settings: { additional_inheritable_classes: [], tooltip_class: ".tooltip", append_to: "body", touch_close_text: "Tap To Close", disable_for_touch: !1, hover_delay: 200, show_on: "all", tip_template: function (a, b) { return '<span data-selector="' + a + '" id="' + a + '" class="' + Foundation.libs.tooltip.settings.tooltip_class.substring(1) + '" role="tooltip">' + b + '<span class="nub"></span></span>' } }, cache: {}, init: function (a, b, c) { Foundation.inherit(this, "random_str"), this.bindings(b, c) }, should_show: function (b) { var c = a.extend({}, this.settings, this.data_options(b)); return "all" === c.show_on ? !0 : this.small() && "small" === c.show_on ? !0 : this.medium() && "medium" === c.show_on ? !0 : this.large() && "large" === c.show_on ? !0 : !1 }, medium: function () { return matchMedia(Foundation.media_queries.medium).matches }, large: function () { return matchMedia(Foundation.media_queries.large).matches }, events: function (b) { var c = this, d = c.S; c.create(this.S(b)), a(this.scope).off(".tooltip").on("mouseenter.fndtn.tooltip mouseleave.fndtn.tooltip touchstart.fndtn.tooltip MSPointerDown.fndtn.tooltip", "[" + this.attr_name() + "]", function (b) { var e = d(this), f = a.extend({}, c.settings, c.data_options(e)), g = !1; if (Modernizr.touch && /touchstart|MSPointerDown/i.test(b.type) && d(b.target).is("a")) return !1; if (/mouse/i.test(b.type) && c.ie_touch(b)) return !1; if (e.hasClass("open")) Modernizr.touch && /touchstart|MSPointerDown/i.test(b.type) && b.preventDefault(), c.hide(e); else { if (f.disable_for_touch && Modernizr.touch && /touchstart|MSPointerDown/i.test(b.type)) return; !f.disable_for_touch && Modernizr.touch && /touchstart|MSPointerDown/i.test(b.type) && (b.preventDefault(), d(f.tooltip_class + ".open").hide(), g = !0), /enter|over/i.test(b.type) ? this.timer = setTimeout(function () { c.showTip(e) }.bind(this), c.settings.hover_delay) : "mouseout" === b.type || "mouseleave" === b.type ? (clearTimeout(this.timer), c.hide(e)) : c.showTip(e) } }).on("mouseleave.fndtn.tooltip touchstart.fndtn.tooltip MSPointerDown.fndtn.tooltip", "[" + this.attr_name() + "].open", function (b) { return /mouse/i.test(b.type) && c.ie_touch(b) ? !1 : void (("touch" != a(this).data("tooltip-open-event-type") || "mouseleave" != b.type) && ("mouse" == a(this).data("tooltip-open-event-type") && /MSPointerDown|touchstart/i.test(b.type) ? c.convert_to_touch(a(this)) : c.hide(a(this)))) }).on("DOMNodeRemoved DOMAttrModified", "[" + this.attr_name() + "]:not(a)", function () { c.hide(d(this)) }) }, ie_touch: function () { return !1 }, showTip: function (a) { var b = this.getTip(a); return this.should_show(a, b) ? this.show(a) : void 0 }, getTip: function (b) { var c = this.selector(b), d = a.extend({}, this.settings, this.data_options(b)), e = null; return c && (e = this.S('span[data-selector="' + c + '"]' + d.tooltip_class)), "object" == typeof e ? e : !1 }, selector: function (a) { var b = a.attr("id"), c = a.attr(this.attr_name()) || a.attr("data-selector"); return (b && b.length < 1 || !b) && "string" != typeof c && (c = this.random_str(6), a.attr("data-selector", c).attr("aria-describedby", c)), b && b.length > 0 ? b : c }, create: function (c) { var d = this, e = a.extend({}, this.settings, this.data_options(c)), f = this.settings.tip_template; "string" == typeof e.tip_template && b.hasOwnProperty(e.tip_template) && (f = b[e.tip_template]); var g = a(f(this.selector(c), a("<div></div>").html(c.attr("title")).html())), h = this.inheritable_classes(c); g.addClass(h).appendTo(e.append_to), Modernizr.touch && (g.append('<span class="tap-to-close">' + e.touch_close_text + "</span>"), g.on("touchstart.fndtn.tooltip MSPointerDown.fndtn.tooltip", function () { d.hide(c) })), c.removeAttr("title").attr("title", "") }, reposition: function (b, c, d) { var e, f, g, h, i; if (c.css("visibility", "hidden").show(), e = b.data("width"), f = c.children(".nub"), g = f.outerHeight(), h = f.outerHeight(), c.css(this.small() ? { width: "100%" } : { width: e ? e : "auto" }), i = function (a, b, c, d, e) { return a.css({ top: b ? b : "auto", bottom: d ? d : "auto", left: e ? e : "auto", right: c ? c : "auto" }).end() }, i(c, b.offset().top + b.outerHeight() + 10, "auto", "auto", b.offset().left), this.small()) i(c, b.offset().top + b.outerHeight() + 10, "auto", "auto", 12.5, a(this.scope).width()), c.addClass("tip-override"), i(f, -g, "auto", "auto", b.offset().left); else { var j = b.offset().left; Foundation.rtl && (f.addClass("rtl"), j = b.offset().left + b.outerWidth() - c.outerWidth()), i(c, b.offset().top + b.outerHeight() + 10, "auto", "auto", j), c.removeClass("tip-override"), d && d.indexOf("tip-top") > -1 ? (Foundation.rtl && f.addClass("rtl"), i(c, b.offset().top - c.outerHeight(), "auto", "auto", j).removeClass("tip-override")) : d && d.indexOf("tip-left") > -1 ? (i(c, b.offset().top + b.outerHeight() / 2 - c.outerHeight() / 2, "auto", "auto", b.offset().left - c.outerWidth() - g).removeClass("tip-override"), f.removeClass("rtl")) : d && d.indexOf("tip-right") > -1 && (i(c, b.offset().top + b.outerHeight() / 2 - c.outerHeight() / 2, "auto", "auto", b.offset().left + b.outerWidth() + g).removeClass("tip-override"), f.removeClass("rtl")) } c.css("visibility", "visible").hide() }, small: function () { return matchMedia(Foundation.media_queries.small).matches && !matchMedia(Foundation.media_queries.medium).matches }, inheritable_classes: function (b) { var c = a.extend({}, this.settings, this.data_options(b)), d = ["tip-top", "tip-left", "tip-bottom", "tip-right", "radius", "round"].concat(c.additional_inheritable_classes), e = b.attr("class"), f = e ? a.map(e.split(" "), function (b) { return -1 !== a.inArray(b, d) ? b : void 0 }).join(" ") : ""; return a.trim(f) }, convert_to_touch: function (b) { var c = this, d = c.getTip(b), e = a.extend({}, c.settings, c.data_options(b)); 0 === d.find(".tap-to-close").length && (d.append('<span class="tap-to-close">' + e.touch_close_text + "</span>"), d.on("click.fndtn.tooltip.tapclose touchstart.fndtn.tooltip.tapclose MSPointerDown.fndtn.tooltip.tapclose", function () { c.hide(b) })), b.data("tooltip-open-event-type", "touch") }, show: function (a) { var b = this.getTip(a); "touch" == a.data("tooltip-open-event-type") && this.convert_to_touch(a), this.reposition(a, b, a.attr("class")), a.addClass("open"), b.fadeIn(150) }, hide: function (a) { var b = this.getTip(a); b.fadeOut(150, function () { b.find(".tap-to-close").remove(), b.off("click.fndtn.tooltip.tapclose MSPointerDown.fndtn.tapclose"), a.removeClass("open") }) }, off: function () { var b = this; this.S(this.scope).off(".fndtn.tooltip"), this.S(this.settings.tooltip_class).each(function (c) { a("[" + b.attr_name() + "]").eq(c).attr("title", a(this).text()) }).remove() }, reflow: function () { } } }(jQuery, window, window.document), function (a, b, c) {
    "use strict"; Foundation.libs.topbar = {
        name: "topbar", version: "5.4.6", settings: { index: 0, sticky_class: "sticky", custom_back_text: !0, back_text: "Back", mobile_show_parent_link: !0, is_hover: !0, scrolltop: !0, sticky_on: "all" }, init: function (b, c, d) { Foundation.inherit(this, "add_custom_rule register_media throttle"); var e = this; e.register_media("topbar", "foundation-mq-topbar"), this.bindings(c, d), e.S("[" + this.attr_name() + "]", this.scope).each(function () { { var b = a(this), c = b.data(e.attr_name(!0) + "-init"); e.S("section, .top-bar-section", this) } b.data("index", 0); var d = b.parent(); d.hasClass("fixed") || e.is_sticky(b, d, c) ? (e.settings.sticky_class = c.sticky_class, e.settings.sticky_topbar = b, b.data("height", d.outerHeight()), b.data("stickyoffset", d.offset().top)) : b.data("height", b.outerHeight()), c.assembled || e.assemble(b), c.is_hover ? e.S(".has-dropdown", b).addClass("not-click") : e.S(".has-dropdown", b).removeClass("not-click"), e.add_custom_rule(".f-topbar-fixed { padding-top: " + b.data("height") + "px }"), d.hasClass("fixed") && e.S("body").addClass("f-topbar-fixed") }) }, is_sticky: function (a, b, c) { var d = b.hasClass(c.sticky_class); return d && "all" === c.sticky_on ? !0 : d && this.small() && "small" === c.sticky_on ? matchMedia(Foundation.media_queries.small).matches && !matchMedia(Foundation.media_queries.medium).matches && !matchMedia(Foundation.media_queries.large).matches : d && this.medium() && "medium" === c.sticky_on ? matchMedia(Foundation.media_queries.small).matches && matchMedia(Foundation.media_queries.medium).matches && !matchMedia(Foundation.media_queries.large).matches : d && this.large() && "large" === c.sticky_on ? matchMedia(Foundation.media_queries.small).matches && matchMedia(Foundation.media_queries.medium).matches && matchMedia(Foundation.media_queries.large).matches : !1 }, toggle: function (c) { var d, e = this; d = c ? e.S(c).closest("[" + this.attr_name() + "]") : e.S("[" + this.attr_name() + "]"); var f = d.data(this.attr_name(!0) + "-init"), g = e.S("section, .top-bar-section", d); e.breakpoint() && (e.rtl ? (g.css({ right: "0%" }), a(">.name", g).css({ right: "100%" })) : (g.css({ left: "0%" }), a(">.name", g).css({ left: "100%" })), e.S("li.moved", g).removeClass("moved"), d.data("index", 0), d.toggleClass("expanded").css("height", "")), f.scrolltop ? d.hasClass("expanded") ? d.parent().hasClass("fixed") && (f.scrolltop ? (d.parent().removeClass("fixed"), d.addClass("fixed"), e.S("body").removeClass("f-topbar-fixed"), b.scrollTo(0, 0)) : d.parent().removeClass("expanded")) : d.hasClass("fixed") && (d.parent().addClass("fixed"), d.removeClass("fixed"), e.S("body").addClass("f-topbar-fixed")) : (e.is_sticky(d, d.parent(), f) && d.parent().addClass("fixed"), d.parent().hasClass("fixed") && (d.hasClass("expanded") ? (d.addClass("fixed"), d.parent().addClass("expanded"), e.S("body").addClass("f-topbar-fixed")) : (d.removeClass("fixed"), d.parent().removeClass("expanded"), e.update_sticky_positioning()))) }, timer: null, events: function () { var c = this, d = this.S; d(this.scope).off(".topbar").on("click.fndtn.topbar", "[" + this.attr_name() + "] .toggle-topbar", function (a) { a.preventDefault(), c.toggle(this) }).on("click.fndtn.topbar", '.top-bar .top-bar-section li a[href^="#"],[' + this.attr_name() + '] .top-bar-section li a[href^="#"]', function () { var b = a(this).closest("li"); !c.breakpoint() || b.hasClass("back") || b.hasClass("has-dropdown") || c.toggle() }).on("click.fndtn.topbar", "[" + this.attr_name() + "] li.has-dropdown", function (b) { var e = d(this), f = d(b.target), g = e.closest("[" + c.attr_name() + "]"), h = g.data(c.attr_name(!0) + "-init"); return f.data("revealId") ? void c.toggle() : void (c.breakpoint() || (!h.is_hover || Modernizr.touch) && (b.stopImmediatePropagation(), e.hasClass("hover") ? (e.removeClass("hover").find("li").removeClass("hover"), e.parents("li.hover").removeClass("hover")) : (e.addClass("hover"), a(e).siblings().removeClass("hover"), "A" === f[0].nodeName && f.parent().hasClass("has-dropdown") && b.preventDefault()))) }).on("click.fndtn.topbar", "[" + this.attr_name() + "] .has-dropdown>a", function (a) { if (c.breakpoint()) { a.preventDefault(); var b = d(this), e = b.closest("[" + c.attr_name() + "]"), f = e.find("section, .top-bar-section"), g = (b.next(".dropdown").outerHeight(), b.closest("li")); e.data("index", e.data("index") + 1), g.addClass("moved"), c.rtl ? (f.css({ right: -(100 * e.data("index")) + "%" }), f.find(">.name").css({ right: 100 * e.data("index") + "%" })) : (f.css({ left: -(100 * e.data("index")) + "%" }), f.find(">.name").css({ left: 100 * e.data("index") + "%" })), e.css("height", b.siblings("ul").outerHeight(!0) + e.data("height")) } }), d(b).off(".topbar").on("resize.fndtn.topbar", c.throttle(function () { c.resize.call(c) }, 50)).trigger("resize").trigger("resize.fndtn.topbar").load(function () { d(this).trigger("resize.fndtn.topbar") }), d("body").off(".topbar").on("click.fndtn.topbar", function (a) { var b = d(a.target).closest("li").closest("li.hover"); b.length > 0 || d("[" + c.attr_name() + "] li.hover").removeClass("hover") }), d(this.scope).on("click.fndtn.topbar", "[" + this.attr_name() + "] .has-dropdown .back", function (a) { a.preventDefault(); var b = d(this), e = b.closest("[" + c.attr_name() + "]"), f = e.find("section, .top-bar-section"), g = (e.data(c.attr_name(!0) + "-init"), b.closest("li.moved")), h = g.parent(); e.data("index", e.data("index") - 1), c.rtl ? (f.css({ right: -(100 * e.data("index")) + "%" }), f.find(">.name").css({ right: 100 * e.data("index") + "%" })) : (f.css({ left: -(100 * e.data("index")) + "%" }), f.find(">.name").css({ left: 100 * e.data("index") + "%" })), 0 === e.data("index") ? e.css("height", "") : e.css("height", h.outerHeight(!0) + e.data("height")), setTimeout(function () { g.removeClass("moved") }, 300) }), d(this.scope).find(".dropdown a").focus(function () { a(this).parents(".has-dropdown").addClass("hover") }).blur(function () { a(this).parents(".has-dropdown").removeClass("hover") }) }, resize: function () { var a = this; a.S("[" + this.attr_name() + "]").each(function () { var b, d = a.S(this), e = d.data(a.attr_name(!0) + "-init"), f = d.parent("." + a.settings.sticky_class); if (!a.breakpoint()) { var g = d.hasClass("expanded"); d.css("height", "").removeClass("expanded").find("li").removeClass("hover"), g && a.toggle(d) } a.is_sticky(d, f, e) && (f.hasClass("fixed") ? (f.removeClass("fixed"), b = f.offset().top, a.S(c.body).hasClass("f-topbar-fixed") && (b -= d.data("height")), d.data("stickyoffset", b), f.addClass("fixed")) : (b = f.offset().top, d.data("stickyoffset", b))) }) }, breakpoint: function () { return !matchMedia(Foundation.media_queries.topbar).matches }, small: function () { return matchMedia(Foundation.media_queries.small).matches }, medium: function () { return matchMedia(Foundation.media_queries.medium).matches }, large: function () { return matchMedia(Foundation.media_queries.large).matches }, assemble: function (b) { var c = this, d = b.data(this.attr_name(!0) + "-init"), e = c.S("section, .top-bar-section", b); e.detach(), c.S(".has-dropdown>a", e).each(function () { var b, e = c.S(this), f = e.siblings(".dropdown"), g = e.attr("href"); f.find(".title.back").length || (b = a(1 == d.mobile_show_parent_link && g ? '<li class="title back js-generated"><h5><a href="javascript:void(0)"></a></h5></li><li class="parent-link show-for-small"><a class="parent-link js-generated" href="' + g + '">' + e.html() + "</a></li>" : '<li class="title back js-generated"><h5><a href="javascript:void(0)"></a></h5>'), a("h5>a", b).html(1 == d.custom_back_text ? d.back_text : "&laquo; " + e.html()), f.prepend(b)) }), e.appendTo(b), this.sticky(), this.assembled(b) }, assembled: function (b) { b.data(this.attr_name(!0), a.extend({}, b.data(this.attr_name(!0)), { assembled: !0 })) }, height: function (b) { var c = 0, d = this; return a("> li", b).each(function () { c += d.S(this).outerHeight(!0) }), c }, sticky: function () {
            var a = this; this.S(b).on("scroll", function () {
                a.update_sticky_positioning()
            })
        }, update_sticky_positioning: function () { var a = "." + this.settings.sticky_class, c = this.S(b), d = this; if (d.settings.sticky_topbar && d.is_sticky(this.settings.sticky_topbar, this.settings.sticky_topbar.parent(), this.settings)) { var e = this.settings.sticky_topbar.data("stickyoffset"); d.S(a).hasClass("expanded") || (c.scrollTop() > e ? d.S(a).hasClass("fixed") || (d.S(a).addClass("fixed"), d.S("body").addClass("f-topbar-fixed")) : c.scrollTop() <= e && d.S(a).hasClass("fixed") && (d.S(a).removeClass("fixed"), d.S("body").removeClass("f-topbar-fixed"))) } }, off: function () { this.S(this.scope).off(".fndtn.topbar"), this.S(b).off(".fndtn.topbar") }, reflow: function () { }
    }
}(jQuery, window, window.document);
var KO_LOCALE = false;
var KMS_MAPPING_PATH = false;
var PartnerPages = PartnerPages ? PartnerPages : false;

window.navigationFeedUrl = '/bin/st/top_menu.{lang}.json';

/*
 * EditMode.js https://github.com/davidegiannella/cq-misc/blob/master/EditMode.js
 *
 * Simple javascript object meant to be used within a CQ development to understand on a Javascript side which my Edit Mode is.
 *
 * USAGE:
 *      1) Drop the file in your clientlib
 *      2) Reference it in your js.txt
 *
 *      You can now use it as it will automatically create an "editmode" object
 *              (editmode.isEditMode())    ? "I'm Authoring"   : ""
 *              (editmode.isPreviewMode()) ? "I'm in Preview"  : ""
 *              (editmode.isDesignMode())  ? "I'm in Design"   : ""
 *              (editmode.isDisabled())    ? "I'm in Disabled" : ""
 */

var CQ = CQ || {};

function EditMode(){

    this.isEditMode=function(){
        return (CQ.WCM)?CQ.WCM.isEditMode(true):false;
    };
    this.isPreviewMode=function(){
        return (CQ.WCM)?CQ.WCM.isPreviewMode(true):false;
    };
    this.isDesignMode=function(){
        return (CQ.WCM)?CQ.WCM.isDesignMode(true):false;
    };
    this.isDisabled=function(){
        return (!CQ.WCM);
    }
};

var STFED = STFED || {};
STFED.isCqEditMode = new EditMode().isEditMode();

var STUtils = {};

STUtils.getLanguage = function (locale) {
    switch(locale) {
        case "zh":
            return "Chinese";
        case "ja":
            return "Japanese";
        case "ko":
            return "Korean";
        default:
            return "English";
    }
};

STUtils.isCookieEnabledInBrowser = function () {
    var isIEBrowser = false || !!document.documentMode;
    if(!isIEBrowser){
        return navigator.cookieEnabled;
    }
    return checkIfCookieEnabled ()
};

function checkIfCookieEnabled() {
    var testCookie = "testcookie" + new Date().getTime() + "=";
    document.cookie = testCookie;
    var isCookieEnabled = document.cookie.indexOf(testCookie) !== -1;
    //delete test cookie
    if(isCookieEnabled){
        document.cookie = testCookie + '=; expires=Thu, 01 Jan 1970 00:00:00 GMT;';
    }
    return isCookieEnabled;
}

STUtils.findUrlParameter = function (urlParam) {
    var pageURL = window.location.search.substring(1);
    var URLVariables = pageURL.split('&');
    for (var i = 0; i < URLVariables.length; i++) {
        var parameterName = URLVariables[i].split('=');
        if (parameterName[0] === urlParam) {
            return parameterName[1] === undefined ? '' : decodeURIComponent(parameterName[1]);
        }
    }
};

STUtils.isPfProduct = function (tabSlider = $('.js-st-tab__slider')) {
    return tabSlider.hasClass('exclude-product');
}

STUtils.isActiveTabLink = function (tabId) {
    if (STUtils.isPfProduct()) {
        var href = $('.js-st-tabs-tab[data-tab="' + tabId + '"]').attr('href');

        if (typeof href === 'undefined') {
            href = '#' + tabId;
        }

        return window.location.hash.indexOf(href) > -1;
    } else {
        return true;
    }
};

STUtils.setActiveTab = function(tabId){
    window.sliderActiveTab = tabId;
}

STUtils.getActiveTab = function(){
   return window.sliderActiveTab;
}

STUtils.isTabActive = function (tabId){
    return STUtils.getActiveTab() === tabId;
}

STUtils.getBrowserInfo = function () {
    var ua = navigator.userAgent,
        tem,
        M = ua.match(/(opera|chrome|safari|firefox|msie|trident|edge(?=\/))\/?\s*(\d+)(\.\d+)+/i) || [];
    if (/trident/i.test(M[1])) {
        tem = /\brv[ :]+(\d+)/g.exec(ua) || [];
        return {name: 'IE ', version: (tem[1] || '')};
    }
    if (M[1] === 'Chrome') {
        tem = ua.match(/\bOPR\/(\d+)/);
        if (tem != null) {
            return {name: 'Opera', version: tem[1]};
        }

        tem = ua.match(/\bEdge\/(\d+(.\d+)+)/i);
        if (tem != null) {
            return {name: 'Microsoft Edge', version: tem[1]};
        }
    }
    M = M[2] ? [M[1], M[0].substring(M[0].indexOf('/') + 1)] : [navigator.appName, navigator.appVersion, '-?'];
    if ((tem = ua.match(/version\/(\d+)/i)) != null) {
        M.splice(1, 1, tem[1]);
    }
    return {
        name: M[0],
        version: M[1]
    };
};

STUtils.getIpAddress = function () {
    var result = undefined;
    $.ajax({
        url: "//api.ipify.org?format=json",
        type: "GET",
        async: false,
        success: function (data) {
            result = (data && data.ip) ? data.ip : undefined;
        }
    });
    return result;
};

STUtils.getIpGeolocatedCountry = function (ipAddress) {
    var result = undefined;
    $.ajax({
        url: "/bin/st/geolocation/ip/country",
        type: "POST",
        data: {"clientIP": ipAddress},
        async: false,
        success: function (response) {
            result = (response === null || response === '') ? undefined : response;
        }
    });
    return result;
};

STUtils.getIpGeolocatedCountryCode = function (ipAddress) {
    var result = undefined;
    $.ajax({
        url: "/bin/st/geolocation/ip/country?code=true",
        type: "POST",
        data: {"clientIP": ipAddress},
        async: false,
        success: function (response) {
            result = (response === null || response === '') ? undefined : response;
        }
    });
    return result;
};

STUtils.isAppleDevice = function() {
    return navigator.userAgent.match(/(iPhone|iPod|iPad)/) !== null;
};

STUtils.localTimeConvertor = function (utcTime) {
    var localTime = new Date(utcTime);
    return localTime;
};

STUtils.getUserLocale = function(){
    if (navigator.languages != undefined)
        return navigator.languages[0];
    return navigator.language;
};

STUtils.jQuery = {
    resetInlineDisplay: function ($element) {
        var element = $element.get(0);

        if (element) {
            element.style.display = null;
        }
    }
};

// We use this method to generate unique sessions IDs
STUtils.generateGuid = function() {
    var sessionId = STUtils.getCookieByName("unomiSessionId");
    if(sessionId){
        return sessionId;
    }
    function s4() {
        return Math.floor((1 + Math.random()) * 0x10000)
            .toString(16)
            .substring(1);
    }
    sessionId = s4() + s4() + '-' + s4() + '-' + s4() + '-' +
        s4() + '-' + s4() + s4() + s4();

    STUtils.setCookieByName("unomiSessionId", sessionId);

    return sessionId;
};

STUtils.getCookieByName = function(name) {
    var value = ";" + document.cookie;
    var parts = value.split(";" + name + "=");
    if (parts.length === 2) {
        return parts.pop().split(';').shift();
    }
    else{
        //added the case where the element is not the first cookie of the page
        parts = value.split("; " + name + "=");
        if (parts.length === 2) {
            return parts.pop().split(';').shift();
        }
    }
};

STUtils.setCookieByName = function(name, value){
    document.cookie = encodeURIComponent(name) + "=" + encodeURIComponent(value) + "; path=/";
};

STUtils.deleteCookieByName = function(name){
    document.cookie = encodeURIComponent(name) + "=; path=/; Max-Age=-1;";
};

STUtils.getCsrfToken = function() {
    var request = new XMLHttpRequest();
    request.open('GET', '/libs/granite/csrf/token.json', false);
    request.send(null);
    if (request.status === 200) {
        return JSON.parse(request.responseText).token;
    }
};

STUtils.getScrollBarWidth = function() {
    var element = document.createElement("div");
    element.style.cssText = "overflow:scroll; visibility:hidden; position:absolute;";
    document.body.appendChild(element);
    var widthScrollBar = element.offsetWidth - element.clientWidth;
    element.remove();
    return widthScrollBar;
};

STUtils.toolsSoftwareFamilyIds = [
    "FM146",
    "FM2221",
    "FM147",
    "FM116",
    "FM2391",
    "FM2471"
];

STUtils.isSTMTools = function() {
    if(typeof productHierarchy !== "undefined" && productHierarchy.length){
        var productFamilyId = productHierarchy[productHierarchy.length - 1]
        return STUtils.toolsSoftwareFamilyIds.includes(productFamilyId);
    }
};

STUtils.isHiddenToolsAndSoftwareTab = function () {
    if (STUtils.isSTMTools()) {
        return true;
    }

    if (typeof digitalData.page !== 'undefined' && digitalData.page.category.primaryCategory === 'Product folder:solution') {
        return false;
    }

    var result = false;
    $.ajax({
        url: document.location.href.replace('.html','.page-settings.json'),
        type: "GET",
        async: false,
        success: function (data) {
            result = (data && data.hideToolsAndSoftwareTab) ? data.hideToolsAndSoftwareTab : false;
        }
    });
    return result;
};

/*
* Name: Data Tracker
* Purpose: Standardize submissions of analytics data through DTM
* Author: Brad Barton
*/
(function(window, $){
	'use strict';

	var STFED = window.STFED || {};

	var Tracker = function(element, options){
		var _ = this;

		_.element = element;
		_.options = options;
		_.metadata = $(element).data('tracker');
		_.defaults = {
/* <!IMPORTANT> example. should not have defaults as each component is different </!IMPORTANT>
			digitalData: {}, // data to update/submit on any/all events listed in the item's
			items: [ // list of objects describing the rules for tracking the interaction with the _.element
				{
					ruleName: "", // identifier for submission
					events: "", // space separated list of jQuery/JS events
					digitalData: {}, // data to update/submit custom to the item's events
					beforeSetData: null, // callback fn
					afterSetData: null, // callback fn
					beforeRecordData: null, // callback fn
					afterRecordData: null // callback fn
				}
			]
Notes:	item callbacks run immediately after their respective base callbacks
*/
			beforeSetData: null, // callback fn: runs before setData() is called
			afterSetData: null, // callback fn: runs immediately after setData() is called
			beforeRecordData: null, // callback fn: runs after afterSetData(), but before recordData()
			afterRecordData: null // callback fn: runs immediately after recordData()
		};
		_.events = {
			init: "tracker.init",
			submit: "tracker.submit",
			submitted: "tracker.submitted"
		};

		return _;
	};

	Tracker.prototype = {
/*
* Function: init()
* Description: Creates event listeners for each tracking item
* Notes:	Event listener function for each item in settings calls:
*				Callback functions
*				setData()
*				recordData()
*/
		init: function(){
			var _ = this,
				data = {};

			_.settings = $.extend(true, {}, _.defaults, _.options, _.metadata);

			$(_.settings.items).each(function(i, item){
				$(_.element).on(item.events, function(evt){
// extend the base set of data with the item's set of data
					data = $.extend(true, {}, _.settings.digitalData, item.digitalData);

					$(_.element).trigger($.Event(_.events.submit));

					$.isFunction(_.settings.beforeSetData) && _.settings.beforeSetData.call(_);
					$.isFunction(item.beforeSetData) && item.beforeSetData.call(_);
					_.setData(data);
					$.isFunction(_.settings.afterSetData) && _.settings.afterSetData.call(_);
					$.isFunction(item.afterSetData) && item.afterSetData.call(_);

					$.isFunction(_.settings.beforeRecordData) && _.settings.beforeRecordData.call(_);
					$.isFunction(item.beforeRecordData) && item.beforeRecordData.call(_);
					_.recordData(item.ruleName, item.detail);
					$.isFunction(_.settings.afterRecordData) && _.settings.afterRecordData.call(_);
					$.isFunction(item.afterRecordData) && item.afterRecordData.call(_);
				});
			});

			$(_.element).trigger($.Event(_.events.init));
		},
/*
* Function: setData()
* Description: Updates digitalData object with custom data
* Notes:	digitalData object is used to record information in DTM
*/
		setData: function(data){
			var _ = this,
				digitalData = window.digitalData || {};

			for(var key in data){
				if(data.hasOwnProperty(key)){
					if (key === 'product') {
						digitalData[key] ? window._.merge(digitalData[key] , data[key]) : digitalData[key] = data[key];
					} else {
						digitalData[key] = data[key];
					}
				}
			}

			window.digitalData = digitalData;
		},
/*
* Function: recordData()
* Description: Submits data to DTM via _satillite.track() if possible
* Notes:	_satellite is the DTM data object
			_satellite.track() is the DTM submission method for tracking data for non-pageload events
*/
		recordData: function(ruleName, detail){
			var _ = this,
				_satellite = window._satellite || {},
				digitalData = window.digitalData || {};

			try{
				_satellite.track(ruleName, detail);
			}catch(e){
                logError(e);
				return false;
			}

			$(_.element).trigger($.Event(_.events.submitted));

			window._satellite = _satellite;

			return true;
		}
	};

	STFED.Tracker = Tracker;

	window.STFED = STFED;
    window.createSessionID = function(){
        return new Date().getTime() + Math.floor((Math.random() + 1) * buildHex(7)).toString(16).substring(1);
    }

    window.buildHex = function (len){
        var hex = '0x1';

        for(var i=0;i<len;i++){
            hex += '0';
        }

        return parseInt(hex,16);
    }

    window.logError = function(error, ruleName){
        if(STFED.debug){
            if(window.console && typeof(console.log) === 'function'){
                console.log(error);
                console.log("Could not submit " + ruleName);
                if(window.JSON && typeof(JSON.stringify) === 'function'){
                    console.log(JSON.stringify(digitalData));
                }
            }
        }
    }
    window.satelliteTrack = function(ruleName){
        try{
            _satellite.track(ruleName);
        }
        catch(err){
            logError(err, ruleName);
        }
    }

    var digitalData = window.digitalData || {};
    digitalData.page = digitalData.page || {};
    digitalData.page.pageInfo = digitalData.page.pageInfo || {};
    digitalData.page.attributes = digitalData.page.attributes || {};
    digitalData.pageInstanceID = digitalData.pageInstanceID || '';
    digitalData.site = 'stcom';

	if (
		window.location.hash &&
		digitalData?.page?.pageInfo?.destinationURL &&
		digitalData?.page?.pageInfo?.pageName !== 'search' &&
		!digitalData.page.pageInfo.destinationURL.includes(window.location.hash)
	) {
		digitalData.page.pageInfo.destinationURL += window.location.hash;
	}

    var isKms = document.location.pathname.indexOf(KMS_MAPPING_PATH) > -1 || document.location.pathname.indexOf('/content/kms') > -1;
    if (isKms) {
        var regex = new RegExp("(\/"+KO_LOCALE+"\/|\.html)", 'g');
        digitalData.page.pageInfo.pageName = document.location.pathname
            .replace(regex, '')
            .replace(/\//g, ':');
        digitalData.page.pageInfo.hierarchie1 = digitalData.page.pageInfo.pageName;
        digitalData.page.pageInfo.breadCrumbs = digitalData.page.pageInfo.pageName;
        digitalData.page.attributes.language = 'Korean';
        digitalData.language = 'Korean';
        digitalData.site = 'korea';
        digitalData.environnement = digitalData.pageInstanceID.match(/dev|qa|preprod|prod/) ? digitalData.pageInstanceID.match(/dev|qa|preprod|prod/)[0] : '';
        if (window.location !== window.parent.location) { // code to detect iFrame
            digitalData.page.pageInfo.isIframe = true;
        }
    }

    if (PartnerPages && PartnerPages.isPartnerPage){
        PartnerPages.initDigitalData();
    }

/* Create jQuery plugin */
	$.fn.tracker = function(options){
		return this.each(function(i, element){
			new STFED.Tracker(element, options).init();
		});
	};

/* Call jQuery plugin for all elements with [data-tracker] */
	$(document).ready(function(){
		$('[data-tracker]').tracker();
	});

})(window, jQuery);

(function(window, $){
    'use strict';

    $(document).ready(function(){
        var checkDynamicIncludeCompletedTrackingOptions = setInterval(function(){
            var slingDynamicIncludeBlocks = $('[id^="dynamic_include_filter_div_"]');
            if (slingDynamicIncludeBlocks && !slingDynamicIncludeBlocks.length) {
                setTrackingOptions();
                clearInterval(checkDynamicIncludeCompletedTrackingOptions);
                window.STFED = STFED || {};
                window.STFED.trackingOptionsIsDefined = true;
                window.dispatchEvent(new CustomEvent("product-tracking-initialized"));
            }
		}, 300);
    });

    var setTrackingOptions = function(){

        // User session cookie generation
        var digitalData = window.digitalData || {},
            trackingIDCookie = 'trackingID',
            cookieExp = null,
            cookiePath = "/",
            cookieDomain = null,
            cookieSecure = null,
            originUrl = window.location.origin;

        digitalData.event = digitalData.event || [];
        digitalData.product = digitalData.product || [];
        digitalData.product[0] = digitalData.product[0] || {};
        digitalData.product[0].productInfo = digitalData.product[0].productInfo || {};
        digitalData.product[0].productInfo.productID = digitalData.product[0].productInfo.productID || "";
        digitalData.product[0].productInfo.distributor = digitalData.product[0].productInfo.distributor || "";
        digitalData.product[0].productInfo.tree = digitalData.product[0].productInfo.tree || {};
        digitalData.product[0].productInfo.tree.level1 = digitalData.product[0].productInfo.tree.level1 || "";
        digitalData.product[0].productInfo.tree.level2 = digitalData.product[0].productInfo.tree.level2 || "";
        digitalData.product[0].productInfo.tree.level3 = digitalData.product[0].productInfo.tree.level3 || "";
        digitalData.product[0].productInfo.tree.level4 = digitalData.product[0].productInfo.tree.level4 || "";
        digitalData.product[0].productInfo.tree.level5 = digitalData.product[0].productInfo.tree.level5 || "";
        digitalData.product[0].productInfo.tree.level6 = digitalData.product[0].productInfo.tree.level6 || "";

        if(!STFED.cookieFactory.has(trackingIDCookie)){
            STFED.cookieFactory.set(trackingIDCookie, createSessionID(), cookieExp, cookiePath, cookieDomain, cookieSecure);
        }

        var tabs = $('.st-nav-tabs:not(.js-st-nav-tabs--search) .js-st-tabs-tab:not(.js-st-tabs-tab--no-track)'),
            dsBtns = $('[data-ds-button]'),
            datasheetLinks = $('[data-js=datasheetLink]'),
            registrationModal = $('#emailModal'),
            validationModal = $('#validationModal'),
            sessionID = STFED.cookieFactory.get(trackingIDCookie),
            pageLoaded = false,
            isPfProduct = STUtils.isPfProduct();

        $(window).on('download.init', function(evt){
            var trackingData = {
                "product": [{
                    "productInfo": {
                        "tree": {
                            "level1": digitalData.product[0].productInfo.tree.level1,
                            "level2": digitalData.product[0].productInfo.tree.level2,
                            "level3": digitalData.product[0].productInfo.tree.level3,
                            "level4": digitalData.product[0].productInfo.tree.level4,
                            "level5": digitalData.product[0].productInfo.tree.level5,
                            "level6": digitalData.product[0].productInfo.tree.level6
                        }
                    }
                }],
                event: []
            };
            trackingData.event[10] = {
                "eventInfo": {
                    "eventName": evt.downloadPath,
                    "location": window.location.href,
                    "eventAction": "download",
                    "type": sessionID,
                    "eventPoints": "1"
                }
            };
            var btnType = $('[data-ds-button]').first().attr('data-ds-button');
            var isCAD = "get-cad" === btnType || "cad-license" === btnType || "download-cad" === btnType;
            trackingData.event[13] = {
                "eventInfo": {
                    "eventName": (isCAD ? "CAD resources " : "Funnel Name: Software Download::") + $('[data-registration]').first().attr('data-registration'),
                    "type": sessionID
                }
            };
            trackingData.event[46] = {
                "eventInfo": {
                    "eventName": evt.version
                }
            };

            if (isCAD) {
                trackingData.event[96] = {
                    "eventInfo": {
                        "eventName": "CAD resources light registration successful"
                    }
                };
            } else {
                trackingData.event[98] = {
                    "eventInfo": {
                        "eventName": "Downloadable software - download confirmed"
                    }
                };
            }

            if(!pageLoaded && /[?&]dl=/g.test(window.location.search)){
                // event97 tracking
            }
            pageLoaded = true;

            var trackerOpts = {
                items: [{
                    ruleName: isCAD ? 'DCDLCad' : 'DCDLSoft',
                    events: "download.start",
                    digitalData: trackingData
                }]
            };

            $(window).tracker(trackerOpts);
            setTimeout(function (){
                $(window).unbind('download.start');
            }, 200);
        });

        registrationModal.each(function(i, modal){
            var btn = $(modal).find('#emailSubmit'),
                btnType = $(btn).data('dsButton') || $(btn).attr('data-ds-button'),
                regLevel = $(btn).data('registration') || $(btn).attr('data-registration'),
                trackingData = {
                    "product": [{
                        "productInfo": {
                            "tree": {
                                "level1": digitalData.product[0].productInfo.tree.level1,
                                "level2": digitalData.product[0].productInfo.tree.level2,
                                "level3": digitalData.product[0].productInfo.tree.level3,
                                "level4": digitalData.product[0].productInfo.tree.level4,
                                "level5": digitalData.product[0].productInfo.tree.level5,
                                "level6": digitalData.product[0].productInfo.tree.level6
                            }
                        }
                    }],
                    event: []
                },
                trackerOpts = {};

            var isCAD = "get-cad" === btnType || "cad-license" === btnType || "download-cad" === btnType;

            trackingData.event[13] = {
                "eventInfo": {
                    "eventName": (isCAD ? "CAD resources " : "Funnel Name: Software Download::") + regLevel,
                    "type": sessionID
                }
            };
            trackingData.event[11] = {
                "eventInfo": {
                    "eventName": "Form::" + btnType,
                    "eventAction": "Registration",
                    "type": sessionID,
                    "eventPoints": "1"
                }
            };
            trackingData.event[83] = {
                "eventInfo": {
                    "eventName": "start"
                }
            };

            trackerOpts = {
                items: [{
                    ruleName: 'track_registration',
                    events: 'shown.bs.modal',
                    digitalData: trackingData
                }]
            };

            $(modal)
                .attr('data-tracker-opts', JSON.stringify(trackerOpts))
                .data('trackerOpts', JSON.stringify(trackerOpts))
                .tracker(trackerOpts);
        });

        validationModal.each(function(i, modal){
            var btn = $(modal).find('#validationSubmit'),
                btnType = $(btn).data('dsButton') || $(btn).attr('data-ds-button'),
                regLevel = $(btn).data('registration') || $(btn).attr('data-registration'),
                trackingData = {
                    "product": [{
                        "productInfo": {
                            "tree": {
                                "level1": digitalData.product[0].productInfo.tree.level1,
                                "level2": digitalData.product[0].productInfo.tree.level2,
                                "level3": digitalData.product[0].productInfo.tree.level3,
                                "level4": digitalData.product[0].productInfo.tree.level4,
                                "level5": digitalData.product[0].productInfo.tree.level5,
                                "level6": digitalData.product[0].productInfo.tree.level6
                            }
                        }
                    }],
                    event: []
                },
                trackerOpts = {};

            var isCAD = "get-cad" === btnType || "cad-license" === btnType || "download-cad" === btnType;

            trackingData.event[13] = {
                "eventInfo": {
                    "eventName": (isCAD ? "CAD resources " : "Funnel Name: Software Download::") + regLevel,
                    "type": sessionID
                }
            };
            trackingData.event[11] = {
                "eventInfo": {
                    "eventName": "Form::" + btnType,
                    "eventAction": "Registration",
                    "type": sessionID,
                    "eventPoints": "1"
                }
            };
            trackingData.event[83] = {
                "eventInfo": {
                    "eventName": "start"
                }
            };

            trackerOpts = {
                items: [{
                    ruleName: 'track_registration',
                    events: 'shown.bs.modal',
                    digitalData: trackingData
                }]
            };

            $(modal)
                .attr('data-tracker-opts', JSON.stringify(trackerOpts))
                .data('trackerOpts', JSON.stringify(trackerOpts))
                .tracker(trackerOpts);
        });

        datasheetLinks.each(function(i, link){
            var trackingData = {
                "product": [{
                    "productInfo": {
                        "tree": {
                            "level1": digitalData.product[0].productInfo.tree.level1,
                            "level2": digitalData.product[0].productInfo.tree.level2,
                            "level3": digitalData.product[0].productInfo.tree.level3,
                            "level4": digitalData.product[0].productInfo.tree.level4,
                            "level5": digitalData.product[0].productInfo.tree.level5,
                            "level6": digitalData.product[0].productInfo.tree.level6
                        }
                    }
                }],
                event: []
            },
            trackerOpts = {};

            trackingData.event[10] = {
                "eventInfo": {
                    "eventName": link.href,
                    "location": window.location.href,
                    "eventAction": "download",
                    "type": sessionID
                }
            };

            if ("gated content" !== digitalData.component) {
                trackingData.event[29] = {
                    "eventInfo": {
                        "ProductFolder": {
                            "eventName": "DocumentResourceDownload"
                        }
                    }
                };
            }

            trackerOpts = {
                items: [{
                    ruleName: "DCProduct",
                    events: "click",
                    digitalData: trackingData
                }]
            };

            $(link)
                .attr('data-tracker-opts', JSON.stringify(trackerOpts))
                .data('trackerOpts', JSON.stringify(trackerOpts))
                .tracker(trackerOpts);
        });

        var trackingData = {
            "product": [{
                "productInfo": {
                    "tree": {
                        "level1": digitalData.product[0].productInfo.tree.level1,
                        "level2": digitalData.product[0].productInfo.tree.level2,
                        "level3": digitalData.product[0].productInfo.tree.level3,
                        "level4": digitalData.product[0].productInfo.tree.level4,
                        "level5": digitalData.product[0].productInfo.tree.level5,
                        "level6": digitalData.product[0].productInfo.tree.level6
                    }
                }
            }],
            "folderTabChanged": "1",
            "page": digitalData.page ? JSON.parse(JSON.stringify(digitalData.page)) : {},
            event: []
        };

        tabs.each(function(i, tab){
            var tabText = $(tab).data('enKey') || $(tab).attr('data-enKey') || $(tab).text().trim(),
                tabParent = $(tab).parent(),
                trackerOpts = {};

            trackingData.page.pageInfo.destinationURL = $(tabParent).is('a')
                ? originUrl + $(tabParent).attr('href')
                : originUrl + window.location.pathname + '#' + $(tabParent).data('nav-tab-id');

            trackingData.event[7] = {
                "eventInfo": {
                    "eventName": tabText
                }
            };

            trackerOpts = {
                items: [{
                    ruleName: "DCProduct",
                    events: "click",
                    digitalData: trackingData
                }]
            };

            $(tab)
                .attr('data-tracker-opts', JSON.stringify(trackerOpts))
                .data('trackerOpts', JSON.stringify(trackerOpts))
                .tracker(trackerOpts);
        });

        dsBtns.each(function(i, btn){
            var btnType = $(btn).data('dsButton') || $(btn).attr('data-ds-button'),
                btnHref = btn.href,
                regLevel = $(btn).data('registration') || $(btn).attr('data-registration'),
                btnText = $(btn).text().trim(),
                dtmRuleName = "",
                detail = null,
                trackingData = {
                    "product": [{
                        "productInfo": {
                            "tree": {
                                "level1": digitalData.product[0].productInfo.tree.level1,
                                "level2": digitalData.product[0].productInfo.tree.level2,
                                "level3": digitalData.product[0].productInfo.tree.level3,
                                "level4": digitalData.product[0].productInfo.tree.level4,
                                "level5": digitalData.product[0].productInfo.tree.level5,
                                "level6": digitalData.product[0].productInfo.tree.level6
                            }
                        }
                    }],
                    event: []
                },
                trackerOpts = {},
                closestTabId = $(this).closest('[data-nav-tab-content-id]').attr('data-nav-tab-content-id');

            if (closestTabId) {
                closestTabId = closestTabId.replace('#', '');
                var parentTab = $('[data-nav-tab-id="' + closestTabId + '"]');
                if (parentTab.length) {
                    var tabText = $(parentTab).data('enKey') || $(parentTab).attr('data-enKey') || $(parentTab).text().trim();
                }
            }

            var isCAD = "get-cad" === btnType || "cad-license" === btnType || "download-cad" === btnType || "cad light registration" === btnType;

            if (regLevel === undefined && isCAD) {
                regLevel = 'light registration';
            }

            trackingData.event[13] = {
                "eventInfo": {
                    "eventName": (isCAD ? "CAD resources " : "Funnel Name: Software Download::") + regLevel,
                    "type": sessionID
                }
            };

            switch(btnType){
                case "get-cad":
                    dtmRuleName = "DCDLCad";
                    break;
                case "get-software": //fall through
                    break;
                case "request-software":
                    dtmRuleName = "DCDLSoft";

                    trackingData.event[97] = {
                        "eventInfo": {
                            "eventName": btnText
                        }
                    };
                    if (tabText) {
                        trackingData.event[7] = {
                            "eventInfo": {
                                "eventName": tabText
                            }
                        };
                    }
                break;

                case "download":
                    // submit no data. download.start event handles this
                    // make sure the dtm rule is empty to keep direct call from firing
                    dtmRuleName = "";
                break;

                case "license":
                    dtmRuleName = "DCDLSoft";

                    trackingData["licenseAgreed"] = "1";
                break;

                case "cad-license":
                    dtmRuleName = "DCDLCad";
                    detail = {
                        eventDetail3: digitalData?.product?.[0]?.productInfo?.productName,
                        step: 'second'
            }

                    trackingData["licenseAgreed"] = "1";
                    break;

                case "software light registration":
                    trackingData.event[11] = {
                        "eventInfo": {
                            "eventName": "Form::" + btnType,
                            "eventAction": "Registration",
                            "type": sessionID,
                            "eventPoints": "1"
                        }
                    };
                    sessionStorage.setItem('registrationTrackingData', JSON.stringify(trackingData));
                    dtmRuleName = "dcevent83";
                    break;

                case "cad light registration":
                    trackingData.event[11] = {
                        "eventInfo": {
                            "eventName": "Form::" + btnType,
                            "eventAction": "Registration",
                            "type": sessionID,
                            "eventPoints": "1"
                        }
                    };
                    sessionStorage.setItem('registrationTrackingData', JSON.stringify(trackingData));
                    dtmRuleName = "dcevent83";
                    break;

                case "software request":
                    dtmRuleName = "track_registration";

                    trackingData.event[11] = {
                        "eventInfo": {
                            "eventName": "Form::" + btnType,
                            "eventAction": "Registration",
                            "type": sessionID,
                            "eventPoints": "1"
                        }
                    };
                    trackingData.event[83] = {
                        "eventInfo": {
                            "eventName": "last"
                        }
                    };
                break;

                default:
                    dtmRuleName = isCAD ? "DCDLCad" : "DCDLSoft";
                    detail = isCAD ? {
                        eventDetail3: digitalData?.product?.[0]?.productInfo?.productName,
                        step: 'first'
                    } : null
            }

            trackerOpts = {
                items: [{
                    ruleName: dtmRuleName,
                    events: "click",
                    digitalData: trackingData,
                    detail: detail
                }]
            };

            $(btn)
                .attr('data-tracker-opts', JSON.stringify(trackerOpts))
                .data('trackerOpts', JSON.stringify(trackerOpts))
                .tracker(trackerOpts);
        });

		if(($(".st-stage-product").length && $("[data-nav-tab-content-id]").length) || ($(".st-stage--application").length && $("[data-nav-tab-content-id]").length)){
			$(".st-page-content").css("display", "none");
			$("[data-nav-tab-content-id='#tools-software'] .tools-software-table-label").click();
			$(".st-page-content").css("display", "block");

			$("[data-nav-tab-content-id='#documentation'], [data-nav-tab-content-id='#cad-resources']").find(".st-table tbody tr").click(function(){
				var $container = $(this).closest('.st-container');
				if(!$container.find(".st-selected-files-numberanimation").length){
					$("<span class='st-selected-files-overlay__counter st-text-color--light-blue st-selected-files-numberanimation'></span>").insertAfter(".st-selected-files-overlay__counter");
					$container.find(".st-selected-files-numberanimation").on("transitionend webkitTransitionEnd oTransitionEnd", function(){
						$(".st-selected-files-numberanimation").remove();
					});
					setTimeout(function(){
						$container.find(".st-selected-files-numberanimation").addClass("st-selected-files-numberanimation-transition");
						$container.find(".st-selected-files-numberanimation").text($container.find(".js-st-selected-files-overlay-counter").text());
					}, 0);
				}
			});

		}
    }

})(window, $);

$(document).ready(($) => {
    if ($('.st-up-events [data-utc-start]').length){

        var userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        var userLocale = $('meta[name=Content-Language]').attr("content") || "en";


        $('.st-up-events [data-utc-start]').each(function(){
            var $this = $(this);
            if ($this.has(['data-utc-end'])) {
                var startDate = STUtils.localTimeConvertor($this.data('utc-start'));
                var endDate =  STUtils.localTimeConvertor($this.data('utc-end'));
                var joiningPhrase = $this.data('joining-phrase') || 'at';
                var itemTimezone = $this.data('leave-gmt') ? 'Europe/London' : userTimeZone;
                var displayTime = $this.data('display-time') || false;

                // @todo: universalize with events-data-loader.js
                var startDayOfMonth = new Intl.DateTimeFormat(userLocale, {
                    day: "numeric",
                    timeZone: itemTimezone
                }).format(startDate);

                var endDayOfMonth = new Intl.DateTimeFormat(userLocale, {
                    day: "numeric",
                    timeZone: itemTimezone
                }).format(endDate);

                var startMonthStr = new Intl.DateTimeFormat(userLocale, {
                    month: "short",
                    timeZone: itemTimezone
                }).format(startDate);

                var endMonthStr = new Intl.DateTimeFormat(userLocale, {
                    month: "short",
                    timeZone: itemTimezone
                }).format(endDate);

                var startTimeHour = new Intl.DateTimeFormat(userLocale, {
                    hour: "numeric",
                    minute: "2-digit",
                    hour12: true,
                    timeZone: itemTimezone
                }).format(startDate);

                var endTimeHour = new Intl.DateTimeFormat(userLocale, {
                    hour: "numeric",
                    minute: "2-digit",
                    hour12: true,
                    timeZone: itemTimezone
                }).format(endDate);

                var isChinesePage = (document.documentElement.lang === "zh");

                // handle dates
                if (
                    startDate.getMonth() === endDate.getMonth() &&
                    startDate.getDate() !== endDate.getDate()
                ){
                    if(!isChinesePage)
                        // start date - end date start month
                        $this.text(startDayOfMonth + ' - ' + endDayOfMonth + ' ' + startMonthStr);
                    else
                        $this.text(startMonthStr + ' ' + startDayOfMonth + ' - ' + endDayOfMonth);
                }
                else if(
                    startDate.getMonth() !== endDate.getMonth()
                ){
                    if(!isChinesePage)
                        // start date start month - end date end month
                        $this.text(startDayOfMonth + ' ' + startMonthStr + ' - ' + endDayOfMonth + ' ' + endMonthStr);
                    else
                        //If page is chinese switch day and month position
                        $this.text(startMonthStr + ' ' + startDayOfMonth + ' - ' + endMonthStr + ' ' + endDayOfMonth);

                }
                else {
                    if(!isChinesePage)
                        // start date start month
                        $this.text( startDayOfMonth + ' ' + startMonthStr);
                    else
                        //If page is chinese switch day and month position
                        $this.text( startMonthStr + ' ' + startDayOfMonth);
                }

                if (displayTime) {
                    // add joiner ' at'
                    if(isChinesePage) {
                        joiningPhrase = '';
                    }
                    $this.append(' ' + joiningPhrase);

                    // add times
                    if (
                        startTimeHour !== endTimeHour
                    ) {
                        // start time - end time
                        $this.append(' ' + startTimeHour + ' - ' + endTimeHour)
                    } else {
                        // start time
                        $this.append(' ' + startTimeHour)
                    }

                    if (!$this.data('leave-gmt')) {
                        $this.append(' (' + new Date().toLocaleTimeString(userLocale, {timeZoneName: 'short'}).split(' ')[0] + ')')
                    }
                    else {
                        $this.append(' (GMT)');
                    }
                }

            }
        });

    }
});
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright JS Foundation and other contributors <https://js.foundation/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
;(function() {

  /** Used as a safe reference for `undefined` in pre-ES5 environments. */
  var undefined;

  /** Used as the semantic version number. */
  var VERSION = '4.17.4';

  /** Used as the size to enable large array optimizations. */
  var LARGE_ARRAY_SIZE = 200;

  /** Error message constants. */
  var CORE_ERROR_TEXT = 'Unsupported core-js use. Try https://npms.io/search?q=ponyfill.',
      FUNC_ERROR_TEXT = 'Expected a function';

  /** Used to stand-in for `undefined` hash values. */
  var HASH_UNDEFINED = '__lodash_hash_undefined__';

  /** Used as the maximum memoize cache size. */
  var MAX_MEMOIZE_SIZE = 500;

  /** Used as the internal argument placeholder. */
  var PLACEHOLDER = '__lodash_placeholder__';

  /** Used to compose bitmasks for cloning. */
  var CLONE_DEEP_FLAG = 1,
      CLONE_FLAT_FLAG = 2,
      CLONE_SYMBOLS_FLAG = 4;

  /** Used to compose bitmasks for value comparisons. */
  var COMPARE_PARTIAL_FLAG = 1,
      COMPARE_UNORDERED_FLAG = 2;

  /** Used to compose bitmasks for function metadata. */
  var WRAP_BIND_FLAG = 1,
      WRAP_BIND_KEY_FLAG = 2,
      WRAP_CURRY_BOUND_FLAG = 4,
      WRAP_CURRY_FLAG = 8,
      WRAP_CURRY_RIGHT_FLAG = 16,
      WRAP_PARTIAL_FLAG = 32,
      WRAP_PARTIAL_RIGHT_FLAG = 64,
      WRAP_ARY_FLAG = 128,
      WRAP_REARG_FLAG = 256,
      WRAP_FLIP_FLAG = 512;

  /** Used as default options for `_.truncate`. */
  var DEFAULT_TRUNC_LENGTH = 30,
      DEFAULT_TRUNC_OMISSION = '...';

  /** Used to detect hot functions by number of calls within a span of milliseconds. */
  var HOT_COUNT = 800,
      HOT_SPAN = 16;

  /** Used to indicate the type of lazy iteratees. */
  var LAZY_FILTER_FLAG = 1,
      LAZY_MAP_FLAG = 2,
      LAZY_WHILE_FLAG = 3;

  /** Used as references for various `Number` constants. */
  var INFINITY = 1 / 0,
      MAX_SAFE_INTEGER = 9007199254740991,
      MAX_INTEGER = 1.7976931348623157e+308,
      NAN = 0 / 0;

  /** Used as references for the maximum length and index of an array. */
  var MAX_ARRAY_LENGTH = 4294967295,
      MAX_ARRAY_INDEX = MAX_ARRAY_LENGTH - 1,
      HALF_MAX_ARRAY_LENGTH = MAX_ARRAY_LENGTH >>> 1;

  /** Used to associate wrap methods with their bit flags. */
  var wrapFlags = [
    ['ary', WRAP_ARY_FLAG],
    ['bind', WRAP_BIND_FLAG],
    ['bindKey', WRAP_BIND_KEY_FLAG],
    ['curry', WRAP_CURRY_FLAG],
    ['curryRight', WRAP_CURRY_RIGHT_FLAG],
    ['flip', WRAP_FLIP_FLAG],
    ['partial', WRAP_PARTIAL_FLAG],
    ['partialRight', WRAP_PARTIAL_RIGHT_FLAG],
    ['rearg', WRAP_REARG_FLAG]
  ];

  /** `Object#toString` result references. */
  var argsTag = '[object Arguments]',
      arrayTag = '[object Array]',
      asyncTag = '[object AsyncFunction]',
      boolTag = '[object Boolean]',
      dateTag = '[object Date]',
      domExcTag = '[object DOMException]',
      errorTag = '[object Error]',
      funcTag = '[object Function]',
      genTag = '[object GeneratorFunction]',
      mapTag = '[object Map]',
      numberTag = '[object Number]',
      nullTag = '[object Null]',
      objectTag = '[object Object]',
      promiseTag = '[object Promise]',
      proxyTag = '[object Proxy]',
      regexpTag = '[object RegExp]',
      setTag = '[object Set]',
      stringTag = '[object String]',
      symbolTag = '[object Symbol]',
      undefinedTag = '[object Undefined]',
      weakMapTag = '[object WeakMap]',
      weakSetTag = '[object WeakSet]';

  var arrayBufferTag = '[object ArrayBuffer]',
      dataViewTag = '[object DataView]',
      float32Tag = '[object Float32Array]',
      float64Tag = '[object Float64Array]',
      int8Tag = '[object Int8Array]',
      int16Tag = '[object Int16Array]',
      int32Tag = '[object Int32Array]',
      uint8Tag = '[object Uint8Array]',
      uint8ClampedTag = '[object Uint8ClampedArray]',
      uint16Tag = '[object Uint16Array]',
      uint32Tag = '[object Uint32Array]';

  /** Used to match empty string literals in compiled template source. */
  var reEmptyStringLeading = /\b__p \+= '';/g,
      reEmptyStringMiddle = /\b(__p \+=) '' \+/g,
      reEmptyStringTrailing = /(__e\(.*?\)|\b__t\)) \+\n'';/g;

  /** Used to match HTML entities and HTML characters. */
  var reEscapedHtml = /&(?:amp|lt|gt|quot|#39);/g,
      reUnescapedHtml = /[&<>"']/g,
      reHasEscapedHtml = RegExp(reEscapedHtml.source),
      reHasUnescapedHtml = RegExp(reUnescapedHtml.source);

  /** Used to match template delimiters. */
  var reEscape = /<%-([\s\S]+?)%>/g,
      reEvaluate = /<%([\s\S]+?)%>/g,
      reInterpolate = /<%=([\s\S]+?)%>/g;

  /** Used to match property names within property paths. */
  var reIsDeepProp = /\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,
      reIsPlainProp = /^\w*$/,
      reLeadingDot = /^\./,
      rePropName = /[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;

  /**
   * Used to match `RegExp`
   * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).
   */
  var reRegExpChar = /[\\^$.*+?()[\]{}|]/g,
      reHasRegExpChar = RegExp(reRegExpChar.source);

  /** Used to match leading and trailing whitespace. */
  var reTrim = /^\s+|\s+$/g,
      reTrimStart = /^\s+/,
      reTrimEnd = /\s+$/;

  /** Used to match wrap detail comments. */
  var reWrapComment = /\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,
      reWrapDetails = /\{\n\/\* \[wrapped with (.+)\] \*/,
      reSplitDetails = /,? & /;

  /** Used to match words composed of alphanumeric characters. */
  var reAsciiWord = /[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;

  /** Used to match backslashes in property paths. */
  var reEscapeChar = /\\(\\)?/g;

  /**
   * Used to match
   * [ES template delimiters](http://ecma-international.org/ecma-262/7.0/#sec-template-literal-lexical-components).
   */
  var reEsTemplate = /\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;

  /** Used to match `RegExp` flags from their coerced string values. */
  var reFlags = /\w*$/;

  /** Used to detect bad signed hexadecimal string values. */
  var reIsBadHex = /^[-+]0x[0-9a-f]+$/i;

  /** Used to detect binary string values. */
  var reIsBinary = /^0b[01]+$/i;

  /** Used to detect host constructors (Safari). */
  var reIsHostCtor = /^\[object .+?Constructor\]$/;

  /** Used to detect octal string values. */
  var reIsOctal = /^0o[0-7]+$/i;

  /** Used to detect unsigned integer values. */
  var reIsUint = /^(?:0|[1-9]\d*)$/;

  /** Used to match Latin Unicode letters (excluding mathematical operators). */
  var reLatin = /[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g;

  /** Used to ensure capturing order of template delimiters. */
  var reNoMatch = /($^)/;

  /** Used to match unescaped characters in compiled string literals. */
  var reUnescapedString = /['\n\r\u2028\u2029\\]/g;

  /** Used to compose unicode character classes. */
  var rsAstralRange = '\\ud800-\\udfff',
      rsComboMarksRange = '\\u0300-\\u036f',
      reComboHalfMarksRange = '\\ufe20-\\ufe2f',
      rsComboSymbolsRange = '\\u20d0-\\u20ff',
      rsComboRange = rsComboMarksRange + reComboHalfMarksRange + rsComboSymbolsRange,
      rsDingbatRange = '\\u2700-\\u27bf',
      rsLowerRange = 'a-z\\xdf-\\xf6\\xf8-\\xff',
      rsMathOpRange = '\\xac\\xb1\\xd7\\xf7',
      rsNonCharRange = '\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf',
      rsPunctuationRange = '\\u2000-\\u206f',
      rsSpaceRange = ' \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000',
      rsUpperRange = 'A-Z\\xc0-\\xd6\\xd8-\\xde',
      rsVarRange = '\\ufe0e\\ufe0f',
      rsBreakRange = rsMathOpRange + rsNonCharRange + rsPunctuationRange + rsSpaceRange;

  /** Used to compose unicode capture groups. */
  var rsApos = "['\u2019]",
      rsAstral = '[' + rsAstralRange + ']',
      rsBreak = '[' + rsBreakRange + ']',
      rsCombo = '[' + rsComboRange + ']',
      rsDigits = '\\d+',
      rsDingbat = '[' + rsDingbatRange + ']',
      rsLower = '[' + rsLowerRange + ']',
      rsMisc = '[^' + rsAstralRange + rsBreakRange + rsDigits + rsDingbatRange + rsLowerRange + rsUpperRange + ']',
      rsFitz = '\\ud83c[\\udffb-\\udfff]',
      rsModifier = '(?:' + rsCombo + '|' + rsFitz + ')',
      rsNonAstral = '[^' + rsAstralRange + ']',
      rsRegional = '(?:\\ud83c[\\udde6-\\uddff]){2}',
      rsSurrPair = '[\\ud800-\\udbff][\\udc00-\\udfff]',
      rsUpper = '[' + rsUpperRange + ']',
      rsZWJ = '\\u200d';

  /** Used to compose unicode regexes. */
  var rsMiscLower = '(?:' + rsLower + '|' + rsMisc + ')',
      rsMiscUpper = '(?:' + rsUpper + '|' + rsMisc + ')',
      rsOptContrLower = '(?:' + rsApos + '(?:d|ll|m|re|s|t|ve))?',
      rsOptContrUpper = '(?:' + rsApos + '(?:D|LL|M|RE|S|T|VE))?',
      reOptMod = rsModifier + '?',
      rsOptVar = '[' + rsVarRange + ']?',
      rsOptJoin = '(?:' + rsZWJ + '(?:' + [rsNonAstral, rsRegional, rsSurrPair].join('|') + ')' + rsOptVar + reOptMod + ')*',
      rsOrdLower = '\\d*(?:(?:1st|2nd|3rd|(?![123])\\dth)\\b)',
      rsOrdUpper = '\\d*(?:(?:1ST|2ND|3RD|(?![123])\\dTH)\\b)',
      rsSeq = rsOptVar + reOptMod + rsOptJoin,
      rsEmoji = '(?:' + [rsDingbat, rsRegional, rsSurrPair].join('|') + ')' + rsSeq,
      rsSymbol = '(?:' + [rsNonAstral + rsCombo + '?', rsCombo, rsRegional, rsSurrPair, rsAstral].join('|') + ')';

  /** Used to match apostrophes. */
  var reApos = RegExp(rsApos, 'g');

  /**
   * Used to match [combining diacritical marks](https://en.wikipedia.org/wiki/Combining_Diacritical_Marks) and
   * [combining diacritical marks for symbols](https://en.wikipedia.org/wiki/Combining_Diacritical_Marks_for_Symbols).
   */
  var reComboMark = RegExp(rsCombo, 'g');

  /** Used to match [string symbols](https://mathiasbynens.be/notes/javascript-unicode). */
  var reUnicode = RegExp(rsFitz + '(?=' + rsFitz + ')|' + rsSymbol + rsSeq, 'g');

  /** Used to match complex or compound words. */
  var reUnicodeWord = RegExp([
    rsUpper + '?' + rsLower + '+' + rsOptContrLower + '(?=' + [rsBreak, rsUpper, '$'].join('|') + ')',
    rsMiscUpper + '+' + rsOptContrUpper + '(?=' + [rsBreak, rsUpper + rsMiscLower, '$'].join('|') + ')',
    rsUpper + '?' + rsMiscLower + '+' + rsOptContrLower,
    rsUpper + '+' + rsOptContrUpper,
    rsOrdUpper,
    rsOrdLower,
    rsDigits,
    rsEmoji
  ].join('|'), 'g');

  /** Used to detect strings with [zero-width joiners or code points from the astral planes](http://eev.ee/blog/2015/09/12/dark-corners-of-unicode/). */
  var reHasUnicode = RegExp('[' + rsZWJ + rsAstralRange  + rsComboRange + rsVarRange + ']');

  /** Used to detect strings that need a more robust regexp to match words. */
  var reHasUnicodeWord = /[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;

  /** Used to assign default `context` object properties. */
  var contextProps = [
    'Array', 'Buffer', 'DataView', 'Date', 'Error', 'Float32Array', 'Float64Array',
    'Function', 'Int8Array', 'Int16Array', 'Int32Array', 'Map', 'Math', 'Object',
    'Promise', 'RegExp', 'Set', 'String', 'Symbol', 'TypeError', 'Uint8Array',
    'Uint8ClampedArray', 'Uint16Array', 'Uint32Array', 'WeakMap',
    '_', 'clearTimeout', 'isFinite', 'parseInt', 'setTimeout'
  ];

  /** Used to make template sourceURLs easier to identify. */
  var templateCounter = -1;

  /** Used to identify `toStringTag` values of typed arrays. */
  var typedArrayTags = {};
  typedArrayTags[float32Tag] = typedArrayTags[float64Tag] =
  typedArrayTags[int8Tag] = typedArrayTags[int16Tag] =
  typedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =
  typedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =
  typedArrayTags[uint32Tag] = true;
  typedArrayTags[argsTag] = typedArrayTags[arrayTag] =
  typedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =
  typedArrayTags[dataViewTag] = typedArrayTags[dateTag] =
  typedArrayTags[errorTag] = typedArrayTags[funcTag] =
  typedArrayTags[mapTag] = typedArrayTags[numberTag] =
  typedArrayTags[objectTag] = typedArrayTags[regexpTag] =
  typedArrayTags[setTag] = typedArrayTags[stringTag] =
  typedArrayTags[weakMapTag] = false;

  /** Used to identify `toStringTag` values supported by `_.clone`. */
  var cloneableTags = {};
  cloneableTags[argsTag] = cloneableTags[arrayTag] =
  cloneableTags[arrayBufferTag] = cloneableTags[dataViewTag] =
  cloneableTags[boolTag] = cloneableTags[dateTag] =
  cloneableTags[float32Tag] = cloneableTags[float64Tag] =
  cloneableTags[int8Tag] = cloneableTags[int16Tag] =
  cloneableTags[int32Tag] = cloneableTags[mapTag] =
  cloneableTags[numberTag] = cloneableTags[objectTag] =
  cloneableTags[regexpTag] = cloneableTags[setTag] =
  cloneableTags[stringTag] = cloneableTags[symbolTag] =
  cloneableTags[uint8Tag] = cloneableTags[uint8ClampedTag] =
  cloneableTags[uint16Tag] = cloneableTags[uint32Tag] = true;
  cloneableTags[errorTag] = cloneableTags[funcTag] =
  cloneableTags[weakMapTag] = false;

  /** Used to map Latin Unicode letters to basic Latin letters. */
  var deburredLetters = {
    // Latin-1 Supplement block.
    '\xc0': 'A',  '\xc1': 'A', '\xc2': 'A', '\xc3': 'A', '\xc4': 'A', '\xc5': 'A',
    '\xe0': 'a',  '\xe1': 'a', '\xe2': 'a', '\xe3': 'a', '\xe4': 'a', '\xe5': 'a',
    '\xc7': 'C',  '\xe7': 'c',
    '\xd0': 'D',  '\xf0': 'd',
    '\xc8': 'E',  '\xc9': 'E', '\xca': 'E', '\xcb': 'E',
    '\xe8': 'e',  '\xe9': 'e', '\xea': 'e', '\xeb': 'e',
    '\xcc': 'I',  '\xcd': 'I', '\xce': 'I', '\xcf': 'I',
    '\xec': 'i',  '\xed': 'i', '\xee': 'i', '\xef': 'i',
    '\xd1': 'N',  '\xf1': 'n',
    '\xd2': 'O',  '\xd3': 'O', '\xd4': 'O', '\xd5': 'O', '\xd6': 'O', '\xd8': 'O',
    '\xf2': 'o',  '\xf3': 'o', '\xf4': 'o', '\xf5': 'o', '\xf6': 'o', '\xf8': 'o',
    '\xd9': 'U',  '\xda': 'U', '\xdb': 'U', '\xdc': 'U',
    '\xf9': 'u',  '\xfa': 'u', '\xfb': 'u', '\xfc': 'u',
    '\xdd': 'Y',  '\xfd': 'y', '\xff': 'y',
    '\xc6': 'Ae', '\xe6': 'ae',
    '\xde': 'Th', '\xfe': 'th',
    '\xdf': 'ss',
    // Latin Extended-A block.
    '\u0100': 'A',  '\u0102': 'A', '\u0104': 'A',
    '\u0101': 'a',  '\u0103': 'a', '\u0105': 'a',
    '\u0106': 'C',  '\u0108': 'C', '\u010a': 'C', '\u010c': 'C',
    '\u0107': 'c',  '\u0109': 'c', '\u010b': 'c', '\u010d': 'c',
    '\u010e': 'D',  '\u0110': 'D', '\u010f': 'd', '\u0111': 'd',
    '\u0112': 'E',  '\u0114': 'E', '\u0116': 'E', '\u0118': 'E', '\u011a': 'E',
    '\u0113': 'e',  '\u0115': 'e', '\u0117': 'e', '\u0119': 'e', '\u011b': 'e',
    '\u011c': 'G',  '\u011e': 'G', '\u0120': 'G', '\u0122': 'G',
    '\u011d': 'g',  '\u011f': 'g', '\u0121': 'g', '\u0123': 'g',
    '\u0124': 'H',  '\u0126': 'H', '\u0125': 'h', '\u0127': 'h',
    '\u0128': 'I',  '\u012a': 'I', '\u012c': 'I', '\u012e': 'I', '\u0130': 'I',
    '\u0129': 'i',  '\u012b': 'i', '\u012d': 'i', '\u012f': 'i', '\u0131': 'i',
    '\u0134': 'J',  '\u0135': 'j',
    '\u0136': 'K',  '\u0137': 'k', '\u0138': 'k',
    '\u0139': 'L',  '\u013b': 'L', '\u013d': 'L', '\u013f': 'L', '\u0141': 'L',
    '\u013a': 'l',  '\u013c': 'l', '\u013e': 'l', '\u0140': 'l', '\u0142': 'l',
    '\u0143': 'N',  '\u0145': 'N', '\u0147': 'N', '\u014a': 'N',
    '\u0144': 'n',  '\u0146': 'n', '\u0148': 'n', '\u014b': 'n',
    '\u014c': 'O',  '\u014e': 'O', '\u0150': 'O',
    '\u014d': 'o',  '\u014f': 'o', '\u0151': 'o',
    '\u0154': 'R',  '\u0156': 'R', '\u0158': 'R',
    '\u0155': 'r',  '\u0157': 'r', '\u0159': 'r',
    '\u015a': 'S',  '\u015c': 'S', '\u015e': 'S', '\u0160': 'S',
    '\u015b': 's',  '\u015d': 's', '\u015f': 's', '\u0161': 's',
    '\u0162': 'T',  '\u0164': 'T', '\u0166': 'T',
    '\u0163': 't',  '\u0165': 't', '\u0167': 't',
    '\u0168': 'U',  '\u016a': 'U', '\u016c': 'U', '\u016e': 'U', '\u0170': 'U', '\u0172': 'U',
    '\u0169': 'u',  '\u016b': 'u', '\u016d': 'u', '\u016f': 'u', '\u0171': 'u', '\u0173': 'u',
    '\u0174': 'W',  '\u0175': 'w',
    '\u0176': 'Y',  '\u0177': 'y', '\u0178': 'Y',
    '\u0179': 'Z',  '\u017b': 'Z', '\u017d': 'Z',
    '\u017a': 'z',  '\u017c': 'z', '\u017e': 'z',
    '\u0132': 'IJ', '\u0133': 'ij',
    '\u0152': 'Oe', '\u0153': 'oe',
    '\u0149': "'n", '\u017f': 's'
  };

  /** Used to map characters to HTML entities. */
  var htmlEscapes = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#39;'
  };

  /** Used to map HTML entities to characters. */
  var htmlUnescapes = {
    '&amp;': '&',
    '&lt;': '<',
    '&gt;': '>',
    '&quot;': '"',
    '&#39;': "'"
  };

  /** Used to escape characters for inclusion in compiled string literals. */
  var stringEscapes = {
    '\\': '\\',
    "'": "'",
    '\n': 'n',
    '\r': 'r',
    '\u2028': 'u2028',
    '\u2029': 'u2029'
  };

  /** Built-in method references without a dependency on `root`. */
  var freeParseFloat = parseFloat,
      freeParseInt = parseInt;

  /** Detect free variable `global` from Node.js. */
  var freeGlobal = typeof global == 'object' && global && global.Object === Object && global;

  /** Detect free variable `self`. */
  var freeSelf = typeof self == 'object' && self && self.Object === Object && self;

  /** Used as a reference to the global object. */
  var root = freeGlobal || freeSelf || Function('return this')();

  /** Detect free variable `exports`. */
  var freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;

  /** Detect free variable `module`. */
  var freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;

  /** Detect the popular CommonJS extension `module.exports`. */
  var moduleExports = freeModule && freeModule.exports === freeExports;

  /** Detect free variable `process` from Node.js. */
  var freeProcess = moduleExports && freeGlobal.process;

  /** Used to access faster Node.js helpers. */
  var nodeUtil = (function() {
    try {
      return freeProcess && freeProcess.binding && freeProcess.binding('util');
    } catch (e) {}
  }());

  /* Node.js helper references. */
  var nodeIsArrayBuffer = nodeUtil && nodeUtil.isArrayBuffer,
      nodeIsDate = nodeUtil && nodeUtil.isDate,
      nodeIsMap = nodeUtil && nodeUtil.isMap,
      nodeIsRegExp = nodeUtil && nodeUtil.isRegExp,
      nodeIsSet = nodeUtil && nodeUtil.isSet,
      nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;

  /*--------------------------------------------------------------------------*/

  /**
   * Adds the key-value `pair` to `map`.
   *
   * @private
   * @param {Object} map The map to modify.
   * @param {Array} pair The key-value pair to add.
   * @returns {Object} Returns `map`.
   */
  function addMapEntry(map, pair) {
    // Don't return `map.set` because it's not chainable in IE 11.
    map.set(pair[0], pair[1]);
    return map;
  }

  /**
   * Adds `value` to `set`.
   *
   * @private
   * @param {Object} set The set to modify.
   * @param {*} value The value to add.
   * @returns {Object} Returns `set`.
   */
  function addSetEntry(set, value) {
    // Don't return `set.add` because it's not chainable in IE 11.
    set.add(value);
    return set;
  }

  /**
   * A faster alternative to `Function#apply`, this function invokes `func`
   * with the `this` binding of `thisArg` and the arguments of `args`.
   *
   * @private
   * @param {Function} func The function to invoke.
   * @param {*} thisArg The `this` binding of `func`.
   * @param {Array} args The arguments to invoke `func` with.
   * @returns {*} Returns the result of `func`.
   */
  function apply(func, thisArg, args) {
    switch (args.length) {
      case 0: return func.call(thisArg);
      case 1: return func.call(thisArg, args[0]);
      case 2: return func.call(thisArg, args[0], args[1]);
      case 3: return func.call(thisArg, args[0], args[1], args[2]);
    }
    return func.apply(thisArg, args);
  }

  /**
   * A specialized version of `baseAggregator` for arrays.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} setter The function to set `accumulator` values.
   * @param {Function} iteratee The iteratee to transform keys.
   * @param {Object} accumulator The initial aggregated object.
   * @returns {Function} Returns `accumulator`.
   */
  function arrayAggregator(array, setter, iteratee, accumulator) {
    var index = -1,
        length = array == null ? 0 : array.length;

    while (++index < length) {
      var value = array[index];
      setter(accumulator, value, iteratee(value), array);
    }
    return accumulator;
  }

  /**
   * A specialized version of `_.forEach` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns `array`.
   */
  function arrayEach(array, iteratee) {
    var index = -1,
        length = array == null ? 0 : array.length;

    while (++index < length) {
      if (iteratee(array[index], index, array) === false) {
        break;
      }
    }
    return array;
  }

  /**
   * A specialized version of `_.forEachRight` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns `array`.
   */
  function arrayEachRight(array, iteratee) {
    var length = array == null ? 0 : array.length;

    while (length--) {
      if (iteratee(array[length], length, array) === false) {
        break;
      }
    }
    return array;
  }

  /**
   * A specialized version of `_.every` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} predicate The function invoked per iteration.
   * @returns {boolean} Returns `true` if all elements pass the predicate check,
   *  else `false`.
   */
  function arrayEvery(array, predicate) {
    var index = -1,
        length = array == null ? 0 : array.length;

    while (++index < length) {
      if (!predicate(array[index], index, array)) {
        return false;
      }
    }
    return true;
  }

  /**
   * A specialized version of `_.filter` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} predicate The function invoked per iteration.
   * @returns {Array} Returns the new filtered array.
   */
  function arrayFilter(array, predicate) {
    var index = -1,
        length = array == null ? 0 : array.length,
        resIndex = 0,
        result = [];

    while (++index < length) {
      var value = array[index];
      if (predicate(value, index, array)) {
        result[resIndex++] = value;
      }
    }
    return result;
  }

  /**
   * A specialized version of `_.includes` for arrays without support for
   * specifying an index to search from.
   *
   * @private
   * @param {Array} [array] The array to inspect.
   * @param {*} target The value to search for.
   * @returns {boolean} Returns `true` if `target` is found, else `false`.
   */
  function arrayIncludes(array, value) {
    var length = array == null ? 0 : array.length;
    return !!length && baseIndexOf(array, value, 0) > -1;
  }

  /**
   * This function is like `arrayIncludes` except that it accepts a comparator.
   *
   * @private
   * @param {Array} [array] The array to inspect.
   * @param {*} target The value to search for.
   * @param {Function} comparator The comparator invoked per element.
   * @returns {boolean} Returns `true` if `target` is found, else `false`.
   */
  function arrayIncludesWith(array, value, comparator) {
    var index = -1,
        length = array == null ? 0 : array.length;

    while (++index < length) {
      if (comparator(value, array[index])) {
        return true;
      }
    }
    return false;
  }

  /**
   * A specialized version of `_.map` for arrays without support for iteratee
   * shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns the new mapped array.
   */
  function arrayMap(array, iteratee) {
    var index = -1,
        length = array == null ? 0 : array.length,
        result = Array(length);

    while (++index < length) {
      result[index] = iteratee(array[index], index, array);
    }
    return result;
  }

  /**
   * Appends the elements of `values` to `array`.
   *
   * @private
   * @param {Array} array The array to modify.
   * @param {Array} values The values to append.
   * @returns {Array} Returns `array`.
   */
  function arrayPush(array, values) {
    var index = -1,
        length = values.length,
        offset = array.length;

    while (++index < length) {
      array[offset + index] = values[index];
    }
    return array;
  }

  /**
   * A specialized version of `_.reduce` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @param {*} [accumulator] The initial value.
   * @param {boolean} [initAccum] Specify using the first element of `array` as
   *  the initial value.
   * @returns {*} Returns the accumulated value.
   */
  function arrayReduce(array, iteratee, accumulator, initAccum) {
    var index = -1,
        length = array == null ? 0 : array.length;

    if (initAccum && length) {
      accumulator = array[++index];
    }
    while (++index < length) {
      accumulator = iteratee(accumulator, array[index], index, array);
    }
    return accumulator;
  }

  /**
   * A specialized version of `_.reduceRight` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @param {*} [accumulator] The initial value.
   * @param {boolean} [initAccum] Specify using the last element of `array` as
   *  the initial value.
   * @returns {*} Returns the accumulated value.
   */
  function arrayReduceRight(array, iteratee, accumulator, initAccum) {
    var length = array == null ? 0 : array.length;
    if (initAccum && length) {
      accumulator = array[--length];
    }
    while (length--) {
      accumulator = iteratee(accumulator, array[length], length, array);
    }
    return accumulator;
  }

  /**
   * A specialized version of `_.some` for arrays without support for iteratee
   * shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} predicate The function invoked per iteration.
   * @returns {boolean} Returns `true` if any element passes the predicate check,
   *  else `false`.
   */
  function arraySome(array, predicate) {
    var index = -1,
        length = array == null ? 0 : array.length;

    while (++index < length) {
      if (predicate(array[index], index, array)) {
        return true;
      }
    }
    return false;
  }

  /**
   * Gets the size of an ASCII `string`.
   *
   * @private
   * @param {string} string The string inspect.
   * @returns {number} Returns the string size.
   */
  var asciiSize = baseProperty('length');

  /**
   * Converts an ASCII `string` to an array.
   *
   * @private
   * @param {string} string The string to convert.
   * @returns {Array} Returns the converted array.
   */
  function asciiToArray(string) {
    return string.split('');
  }

  /**
   * Splits an ASCII `string` into an array of its words.
   *
   * @private
   * @param {string} The string to inspect.
   * @returns {Array} Returns the words of `string`.
   */
  function asciiWords(string) {
    return string.match(reAsciiWord) || [];
  }

  /**
   * The base implementation of methods like `_.findKey` and `_.findLastKey`,
   * without support for iteratee shorthands, which iterates over `collection`
   * using `eachFunc`.
   *
   * @private
   * @param {Array|Object} collection The collection to inspect.
   * @param {Function} predicate The function invoked per iteration.
   * @param {Function} eachFunc The function to iterate over `collection`.
   * @returns {*} Returns the found element or its key, else `undefined`.
   */
  function baseFindKey(collection, predicate, eachFunc) {
    var result;
    eachFunc(collection, function(value, key, collection) {
      if (predicate(value, key, collection)) {
        result = key;
        return false;
      }
    });
    return result;
  }

  /**
   * The base implementation of `_.findIndex` and `_.findLastIndex` without
   * support for iteratee shorthands.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {Function} predicate The function invoked per iteration.
   * @param {number} fromIndex The index to search from.
   * @param {boolean} [fromRight] Specify iterating from right to left.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */
  function baseFindIndex(array, predicate, fromIndex, fromRight) {
    var length = array.length,
        index = fromIndex + (fromRight ? 1 : -1);

    while ((fromRight ? index-- : ++index < length)) {
      if (predicate(array[index], index, array)) {
        return index;
      }
    }
    return -1;
  }

  /**
   * The base implementation of `_.indexOf` without `fromIndex` bounds checks.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} value The value to search for.
   * @param {number} fromIndex The index to search from.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */
  function baseIndexOf(array, value, fromIndex) {
    return value === value
      ? strictIndexOf(array, value, fromIndex)
      : baseFindIndex(array, baseIsNaN, fromIndex);
  }

  /**
   * This function is like `baseIndexOf` except that it accepts a comparator.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} value The value to search for.
   * @param {number} fromIndex The index to search from.
   * @param {Function} comparator The comparator invoked per element.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */
  function baseIndexOfWith(array, value, fromIndex, comparator) {
    var index = fromIndex - 1,
        length = array.length;

    while (++index < length) {
      if (comparator(array[index], value)) {
        return index;
      }
    }
    return -1;
  }

  /**
   * The base implementation of `_.isNaN` without support for number objects.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is `NaN`, else `false`.
   */
  function baseIsNaN(value) {
    return value !== value;
  }

  /**
   * The base implementation of `_.mean` and `_.meanBy` without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} array The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {number} Returns the mean.
   */
  function baseMean(array, iteratee) {
    var length = array == null ? 0 : array.length;
    return length ? (baseSum(array, iteratee) / length) : NAN;
  }

  /**
   * The base implementation of `_.property` without support for deep paths.
   *
   * @private
   * @param {string} key The key of the property to get.
   * @returns {Function} Returns the new accessor function.
   */
  function baseProperty(key) {
    return function(object) {
      return object == null ? undefined : object[key];
    };
  }

  /**
   * The base implementation of `_.propertyOf` without support for deep paths.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Function} Returns the new accessor function.
   */
  function basePropertyOf(object) {
    return function(key) {
      return object == null ? undefined : object[key];
    };
  }

  /**
   * The base implementation of `_.reduce` and `_.reduceRight`, without support
   * for iteratee shorthands, which iterates over `collection` using `eachFunc`.
   *
   * @private
   * @param {Array|Object} collection The collection to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @param {*} accumulator The initial value.
   * @param {boolean} initAccum Specify using the first or last element of
   *  `collection` as the initial value.
   * @param {Function} eachFunc The function to iterate over `collection`.
   * @returns {*} Returns the accumulated value.
   */
  function baseReduce(collection, iteratee, accumulator, initAccum, eachFunc) {
    eachFunc(collection, function(value, index, collection) {
      accumulator = initAccum
        ? (initAccum = false, value)
        : iteratee(accumulator, value, index, collection);
    });
    return accumulator;
  }

  /**
   * The base implementation of `_.sortBy` which uses `comparer` to define the
   * sort order of `array` and replaces criteria objects with their corresponding
   * values.
   *
   * @private
   * @param {Array} array The array to sort.
   * @param {Function} comparer The function to define sort order.
   * @returns {Array} Returns `array`.
   */
  function baseSortBy(array, comparer) {
    var length = array.length;

    array.sort(comparer);
    while (length--) {
      array[length] = array[length].value;
    }
    return array;
  }

  /**
   * The base implementation of `_.sum` and `_.sumBy` without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} array The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {number} Returns the sum.
   */
  function baseSum(array, iteratee) {
    var result,
        index = -1,
        length = array.length;

    while (++index < length) {
      var current = iteratee(array[index]);
      if (current !== undefined) {
        result = result === undefined ? current : (result + current);
      }
    }
    return result;
  }

  /**
   * The base implementation of `_.times` without support for iteratee shorthands
   * or max array length checks.
   *
   * @private
   * @param {number} n The number of times to invoke `iteratee`.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns the array of results.
   */
  function baseTimes(n, iteratee) {
    var index = -1,
        result = Array(n);

    while (++index < n) {
      result[index] = iteratee(index);
    }
    return result;
  }

  /**
   * The base implementation of `_.toPairs` and `_.toPairsIn` which creates an array
   * of key-value pairs for `object` corresponding to the property names of `props`.
   *
   * @private
   * @param {Object} object The object to query.
   * @param {Array} props The property names to get values for.
   * @returns {Object} Returns the key-value pairs.
   */
  function baseToPairs(object, props) {
    return arrayMap(props, function(key) {
      return [key, object[key]];
    });
  }

  /**
   * The base implementation of `_.unary` without support for storing metadata.
   *
   * @private
   * @param {Function} func The function to cap arguments for.
   * @returns {Function} Returns the new capped function.
   */
  function baseUnary(func) {
    return function(value) {
      return func(value);
    };
  }

  /**
   * The base implementation of `_.values` and `_.valuesIn` which creates an
   * array of `object` property values corresponding to the property names
   * of `props`.
   *
   * @private
   * @param {Object} object The object to query.
   * @param {Array} props The property names to get values for.
   * @returns {Object} Returns the array of property values.
   */
  function baseValues(object, props) {
    return arrayMap(props, function(key) {
      return object[key];
    });
  }

  /**
   * Checks if a `cache` value for `key` exists.
   *
   * @private
   * @param {Object} cache The cache to query.
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */
  function cacheHas(cache, key) {
    return cache.has(key);
  }

  /**
   * Used by `_.trim` and `_.trimStart` to get the index of the first string symbol
   * that is not found in the character symbols.
   *
   * @private
   * @param {Array} strSymbols The string symbols to inspect.
   * @param {Array} chrSymbols The character symbols to find.
   * @returns {number} Returns the index of the first unmatched string symbol.
   */
  function charsStartIndex(strSymbols, chrSymbols) {
    var index = -1,
        length = strSymbols.length;

    while (++index < length && baseIndexOf(chrSymbols, strSymbols[index], 0) > -1) {}
    return index;
  }

  /**
   * Used by `_.trim` and `_.trimEnd` to get the index of the last string symbol
   * that is not found in the character symbols.
   *
   * @private
   * @param {Array} strSymbols The string symbols to inspect.
   * @param {Array} chrSymbols The character symbols to find.
   * @returns {number} Returns the index of the last unmatched string symbol.
   */
  function charsEndIndex(strSymbols, chrSymbols) {
    var index = strSymbols.length;

    while (index-- && baseIndexOf(chrSymbols, strSymbols[index], 0) > -1) {}
    return index;
  }

  /**
   * Gets the number of `placeholder` occurrences in `array`.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} placeholder The placeholder to search for.
   * @returns {number} Returns the placeholder count.
   */
  function countHolders(array, placeholder) {
    var length = array.length,
        result = 0;

    while (length--) {
      if (array[length] === placeholder) {
        ++result;
      }
    }
    return result;
  }

  /**
   * Used by `_.deburr` to convert Latin-1 Supplement and Latin Extended-A
   * letters to basic Latin letters.
   *
   * @private
   * @param {string} letter The matched letter to deburr.
   * @returns {string} Returns the deburred letter.
   */
  var deburrLetter = basePropertyOf(deburredLetters);

  /**
   * Used by `_.escape` to convert characters to HTML entities.
   *
   * @private
   * @param {string} chr The matched character to escape.
   * @returns {string} Returns the escaped character.
   */
  var escapeHtmlChar = basePropertyOf(htmlEscapes);

  /**
   * Used by `_.template` to escape characters for inclusion in compiled string literals.
   *
   * @private
   * @param {string} chr The matched character to escape.
   * @returns {string} Returns the escaped character.
   */
  function escapeStringChar(chr) {
    return '\\' + stringEscapes[chr];
  }

  /**
   * Gets the value at `key` of `object`.
   *
   * @private
   * @param {Object} [object] The object to query.
   * @param {string} key The key of the property to get.
   * @returns {*} Returns the property value.
   */
  function getValue(object, key) {
    return object == null ? undefined : object[key];
  }

  /**
   * Checks if `string` contains Unicode symbols.
   *
   * @private
   * @param {string} string The string to inspect.
   * @returns {boolean} Returns `true` if a symbol is found, else `false`.
   */
  function hasUnicode(string) {
    return reHasUnicode.test(string);
  }

  /**
   * Checks if `string` contains a word composed of Unicode symbols.
   *
   * @private
   * @param {string} string The string to inspect.
   * @returns {boolean} Returns `true` if a word is found, else `false`.
   */
  function hasUnicodeWord(string) {
    return reHasUnicodeWord.test(string);
  }

  /**
   * Converts `iterator` to an array.
   *
   * @private
   * @param {Object} iterator The iterator to convert.
   * @returns {Array} Returns the converted array.
   */
  function iteratorToArray(iterator) {
    var data,
        result = [];

    while (!(data = iterator.next()).done) {
      result.push(data.value);
    }
    return result;
  }

  /**
   * Converts `map` to its key-value pairs.
   *
   * @private
   * @param {Object} map The map to convert.
   * @returns {Array} Returns the key-value pairs.
   */
  function mapToArray(map) {
    var index = -1,
        result = Array(map.size);

    map.forEach(function(value, key) {
      result[++index] = [key, value];
    });
    return result;
  }

  /**
   * Creates a unary function that invokes `func` with its argument transformed.
   *
   * @private
   * @param {Function} func The function to wrap.
   * @param {Function} transform The argument transform.
   * @returns {Function} Returns the new function.
   */
  function overArg(func, transform) {
    return function(arg) {
      return func(transform(arg));
    };
  }

  /**
   * Replaces all `placeholder` elements in `array` with an internal placeholder
   * and returns an array of their indexes.
   *
   * @private
   * @param {Array} array The array to modify.
   * @param {*} placeholder The placeholder to replace.
   * @returns {Array} Returns the new array of placeholder indexes.
   */
  function replaceHolders(array, placeholder) {
    var index = -1,
        length = array.length,
        resIndex = 0,
        result = [];

    while (++index < length) {
      var value = array[index];
      if (value === placeholder || value === PLACEHOLDER) {
        array[index] = PLACEHOLDER;
        result[resIndex++] = index;
      }
    }
    return result;
  }

  /**
   * Converts `set` to an array of its values.
   *
   * @private
   * @param {Object} set The set to convert.
   * @returns {Array} Returns the values.
   */
  function setToArray(set) {
    var index = -1,
        result = Array(set.size);

    set.forEach(function(value) {
      result[++index] = value;
    });
    return result;
  }

  /**
   * Converts `set` to its value-value pairs.
   *
   * @private
   * @param {Object} set The set to convert.
   * @returns {Array} Returns the value-value pairs.
   */
  function setToPairs(set) {
    var index = -1,
        result = Array(set.size);

    set.forEach(function(value) {
      result[++index] = [value, value];
    });
    return result;
  }

  /**
   * A specialized version of `_.indexOf` which performs strict equality
   * comparisons of values, i.e. `===`.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} value The value to search for.
   * @param {number} fromIndex The index to search from.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */
  function strictIndexOf(array, value, fromIndex) {
    var index = fromIndex - 1,
        length = array.length;

    while (++index < length) {
      if (array[index] === value) {
        return index;
      }
    }
    return -1;
  }

  /**
   * A specialized version of `_.lastIndexOf` which performs strict equality
   * comparisons of values, i.e. `===`.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} value The value to search for.
   * @param {number} fromIndex The index to search from.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */
  function strictLastIndexOf(array, value, fromIndex) {
    var index = fromIndex + 1;
    while (index--) {
      if (array[index] === value) {
        return index;
      }
    }
    return index;
  }

  /**
   * Gets the number of symbols in `string`.
   *
   * @private
   * @param {string} string The string to inspect.
   * @returns {number} Returns the string size.
   */
  function stringSize(string) {
    return hasUnicode(string)
      ? unicodeSize(string)
      : asciiSize(string);
  }

  /**
   * Converts `string` to an array.
   *
   * @private
   * @param {string} string The string to convert.
   * @returns {Array} Returns the converted array.
   */
  function stringToArray(string) {
    return hasUnicode(string)
      ? unicodeToArray(string)
      : asciiToArray(string);
  }

  /**
   * Used by `_.unescape` to convert HTML entities to characters.
   *
   * @private
   * @param {string} chr The matched character to unescape.
   * @returns {string} Returns the unescaped character.
   */
  var unescapeHtmlChar = basePropertyOf(htmlUnescapes);

  /**
   * Gets the size of a Unicode `string`.
   *
   * @private
   * @param {string} string The string inspect.
   * @returns {number} Returns the string size.
   */
  function unicodeSize(string) {
    var result = reUnicode.lastIndex = 0;
    while (reUnicode.test(string)) {
      ++result;
    }
    return result;
  }

  /**
   * Converts a Unicode `string` to an array.
   *
   * @private
   * @param {string} string The string to convert.
   * @returns {Array} Returns the converted array.
   */
  function unicodeToArray(string) {
    return string.match(reUnicode) || [];
  }

  /**
   * Splits a Unicode `string` into an array of its words.
   *
   * @private
   * @param {string} The string to inspect.
   * @returns {Array} Returns the words of `string`.
   */
  function unicodeWords(string) {
    return string.match(reUnicodeWord) || [];
  }

  /*--------------------------------------------------------------------------*/

  /**
   * Create a new pristine `lodash` function using the `context` object.
   *
   * @static
   * @memberOf _
   * @since 1.1.0
   * @category Util
   * @param {Object} [context=root] The context object.
   * @returns {Function} Returns a new `lodash` function.
   * @example
   *
   * _.mixin({ 'foo': _.constant('foo') });
   *
   * var lodash = _.runInContext();
   * lodash.mixin({ 'bar': lodash.constant('bar') });
   *
   * _.isFunction(_.foo);
   * // => true
   * _.isFunction(_.bar);
   * // => false
   *
   * lodash.isFunction(lodash.foo);
   * // => false
   * lodash.isFunction(lodash.bar);
   * // => true
   *
   * // Create a suped-up `defer` in Node.js.
   * var defer = _.runInContext({ 'setTimeout': setImmediate }).defer;
   */
  var runInContext = (function runInContext(context) {
    context = context == null ? root : _.defaults(root.Object(), context, _.pick(root, contextProps));

    /** Built-in constructor references. */
    var Array = context.Array,
        Date = context.Date,
        Error = context.Error,
        Function = context.Function,
        Math = context.Math,
        Object = context.Object,
        RegExp = context.RegExp,
        String = context.String,
        TypeError = context.TypeError;

    /** Used for built-in method references. */
    var arrayProto = Array.prototype,
        funcProto = Function.prototype,
        objectProto = Object.prototype;

    /** Used to detect overreaching core-js shims. */
    var coreJsData = context['__core-js_shared__'];

    /** Used to resolve the decompiled source of functions. */
    var funcToString = funcProto.toString;

    /** Used to check objects for own properties. */
    var hasOwnProperty = objectProto.hasOwnProperty;

    /** Used to generate unique IDs. */
    var idCounter = 0;

    /** Used to detect methods masquerading as native. */
    var maskSrcKey = (function() {
      var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');
      return uid ? ('Symbol(src)_1.' + uid) : '';
    }());

    /**
     * Used to resolve the
     * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
     * of values.
     */
    var nativeObjectToString = objectProto.toString;

    /** Used to infer the `Object` constructor. */
    var objectCtorString = funcToString.call(Object);

    /** Used to restore the original `_` reference in `_.noConflict`. */
    var oldDash = root._;

    /** Used to detect if a method is native. */
    var reIsNative = RegExp('^' +
      funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\$&')
      .replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, '$1.*?') + '$'
    );

    /** Built-in value references. */
    var Buffer = moduleExports ? context.Buffer : undefined,
        Symbol = context.Symbol,
        Uint8Array = context.Uint8Array,
        allocUnsafe = Buffer ? Buffer.allocUnsafe : undefined,
        getPrototype = overArg(Object.getPrototypeOf, Object),
        objectCreate = Object.create,
        propertyIsEnumerable = objectProto.propertyIsEnumerable,
        splice = arrayProto.splice,
        spreadableSymbol = Symbol ? Symbol.isConcatSpreadable : undefined,
        symIterator = Symbol ? Symbol.iterator : undefined,
        symToStringTag = Symbol ? Symbol.toStringTag : undefined;

    var defineProperty = (function() {
      try {
        var func = getNative(Object, 'defineProperty');
        func({}, '', {});
        return func;
      } catch (e) {}
    }());

    /** Mocked built-ins. */
    var ctxClearTimeout = context.clearTimeout !== root.clearTimeout && context.clearTimeout,
        ctxNow = Date && Date.now !== root.Date.now && Date.now,
        ctxSetTimeout = context.setTimeout !== root.setTimeout && context.setTimeout;

    /* Built-in method references for those with the same name as other `lodash` methods. */
    var nativeCeil = Math.ceil,
        nativeFloor = Math.floor,
        nativeGetSymbols = Object.getOwnPropertySymbols,
        nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined,
        nativeIsFinite = context.isFinite,
        nativeJoin = arrayProto.join,
        nativeKeys = overArg(Object.keys, Object),
        nativeMax = Math.max,
        nativeMin = Math.min,
        nativeNow = Date.now,
        nativeParseInt = context.parseInt,
        nativeRandom = Math.random,
        nativeReverse = arrayProto.reverse;

    /* Built-in method references that are verified to be native. */
    var DataView = getNative(context, 'DataView'),
        Map = getNative(context, 'Map'),
        Promise = getNative(context, 'Promise'),
        Set = getNative(context, 'Set'),
        WeakMap = getNative(context, 'WeakMap'),
        nativeCreate = getNative(Object, 'create');

    /** Used to store function metadata. */
    var metaMap = WeakMap && new WeakMap;

    /** Used to lookup unminified function names. */
    var realNames = {};

    /** Used to detect maps, sets, and weakmaps. */
    var dataViewCtorString = toSource(DataView),
        mapCtorString = toSource(Map),
        promiseCtorString = toSource(Promise),
        setCtorString = toSource(Set),
        weakMapCtorString = toSource(WeakMap);

    /** Used to convert symbols to primitives and strings. */
    var symbolProto = Symbol ? Symbol.prototype : undefined,
        symbolValueOf = symbolProto ? symbolProto.valueOf : undefined,
        symbolToString = symbolProto ? symbolProto.toString : undefined;

    /*------------------------------------------------------------------------*/

    /**
     * Creates a `lodash` object which wraps `value` to enable implicit method
     * chain sequences. Methods that operate on and return arrays, collections,
     * and functions can be chained together. Methods that retrieve a single value
     * or may return a primitive value will automatically end the chain sequence
     * and return the unwrapped value. Otherwise, the value must be unwrapped
     * with `_#value`.
     *
     * Explicit chain sequences, which must be unwrapped with `_#value`, may be
     * enabled using `_.chain`.
     *
     * The execution of chained methods is lazy, that is, it's deferred until
     * `_#value` is implicitly or explicitly called.
     *
     * Lazy evaluation allows several methods to support shortcut fusion.
     * Shortcut fusion is an optimization to merge iteratee calls; this avoids
     * the creation of intermediate arrays and can greatly reduce the number of
     * iteratee executions. Sections of a chain sequence qualify for shortcut
     * fusion if the section is applied to an array and iteratees accept only
     * one argument. The heuristic for whether a section qualifies for shortcut
     * fusion is subject to change.
     *
     * Chaining is supported in custom builds as long as the `_#value` method is
     * directly or indirectly included in the build.
     *
     * In addition to lodash methods, wrappers have `Array` and `String` methods.
     *
     * The wrapper `Array` methods are:
     * `concat`, `join`, `pop`, `push`, `shift`, `sort`, `splice`, and `unshift`
     *
     * The wrapper `String` methods are:
     * `replace` and `split`
     *
     * The wrapper methods that support shortcut fusion are:
     * `at`, `compact`, `drop`, `dropRight`, `dropWhile`, `filter`, `find`,
     * `findLast`, `head`, `initial`, `last`, `map`, `reject`, `reverse`, `slice`,
     * `tail`, `take`, `takeRight`, `takeRightWhile`, `takeWhile`, and `toArray`
     *
     * The chainable wrapper methods are:
     * `after`, `ary`, `assign`, `assignIn`, `assignInWith`, `assignWith`, `at`,
     * `before`, `bind`, `bindAll`, `bindKey`, `castArray`, `chain`, `chunk`,
     * `commit`, `compact`, `concat`, `conforms`, `constant`, `countBy`, `create`,
     * `curry`, `debounce`, `defaults`, `defaultsDeep`, `defer`, `delay`,
     * `difference`, `differenceBy`, `differenceWith`, `drop`, `dropRight`,
     * `dropRightWhile`, `dropWhile`, `extend`, `extendWith`, `fill`, `filter`,
     * `flatMap`, `flatMapDeep`, `flatMapDepth`, `flatten`, `flattenDeep`,
     * `flattenDepth`, `flip`, `flow`, `flowRight`, `fromPairs`, `functions`,
     * `functionsIn`, `groupBy`, `initial`, `intersection`, `intersectionBy`,
     * `intersectionWith`, `invert`, `invertBy`, `invokeMap`, `iteratee`, `keyBy`,
     * `keys`, `keysIn`, `map`, `mapKeys`, `mapValues`, `matches`, `matchesProperty`,
     * `memoize`, `merge`, `mergeWith`, `method`, `methodOf`, `mixin`, `negate`,
     * `nthArg`, `omit`, `omitBy`, `once`, `orderBy`, `over`, `overArgs`,
     * `overEvery`, `overSome`, `partial`, `partialRight`, `partition`, `pick`,
     * `pickBy`, `plant`, `property`, `propertyOf`, `pull`, `pullAll`, `pullAllBy`,
     * `pullAllWith`, `pullAt`, `push`, `range`, `rangeRight`, `rearg`, `reject`,
     * `remove`, `rest`, `reverse`, `sampleSize`, `set`, `setWith`, `shuffle`,
     * `slice`, `sort`, `sortBy`, `splice`, `spread`, `tail`, `take`, `takeRight`,
     * `takeRightWhile`, `takeWhile`, `tap`, `throttle`, `thru`, `toArray`,
     * `toPairs`, `toPairsIn`, `toPath`, `toPlainObject`, `transform`, `unary`,
     * `union`, `unionBy`, `unionWith`, `uniq`, `uniqBy`, `uniqWith`, `unset`,
     * `unshift`, `unzip`, `unzipWith`, `update`, `updateWith`, `values`,
     * `valuesIn`, `without`, `wrap`, `xor`, `xorBy`, `xorWith`, `zip`,
     * `zipObject`, `zipObjectDeep`, and `zipWith`
     *
     * The wrapper methods that are **not** chainable by default are:
     * `add`, `attempt`, `camelCase`, `capitalize`, `ceil`, `clamp`, `clone`,
     * `cloneDeep`, `cloneDeepWith`, `cloneWith`, `conformsTo`, `deburr`,
     * `defaultTo`, `divide`, `each`, `eachRight`, `endsWith`, `eq`, `escape`,
     * `escapeRegExp`, `every`, `find`, `findIndex`, `findKey`, `findLast`,
     * `findLastIndex`, `findLastKey`, `first`, `floor`, `forEach`, `forEachRight`,
     * `forIn`, `forInRight`, `forOwn`, `forOwnRight`, `get`, `gt`, `gte`, `has`,
     * `hasIn`, `head`, `identity`, `includes`, `indexOf`, `inRange`, `invoke`,
     * `isArguments`, `isArray`, `isArrayBuffer`, `isArrayLike`, `isArrayLikeObject`,
     * `isBoolean`, `isBuffer`, `isDate`, `isElement`, `isEmpty`, `isEqual`,
     * `isEqualWith`, `isError`, `isFinite`, `isFunction`, `isInteger`, `isLength`,
     * `isMap`, `isMatch`, `isMatchWith`, `isNaN`, `isNative`, `isNil`, `isNull`,
     * `isNumber`, `isObject`, `isObjectLike`, `isPlainObject`, `isRegExp`,
     * `isSafeInteger`, `isSet`, `isString`, `isUndefined`, `isTypedArray`,
     * `isWeakMap`, `isWeakSet`, `join`, `kebabCase`, `last`, `lastIndexOf`,
     * `lowerCase`, `lowerFirst`, `lt`, `lte`, `max`, `maxBy`, `mean`, `meanBy`,
     * `min`, `minBy`, `multiply`, `noConflict`, `noop`, `now`, `nth`, `pad`,
     * `padEnd`, `padStart`, `parseInt`, `pop`, `random`, `reduce`, `reduceRight`,
     * `repeat`, `result`, `round`, `runInContext`, `sample`, `shift`, `size`,
     * `snakeCase`, `some`, `sortedIndex`, `sortedIndexBy`, `sortedLastIndex`,
     * `sortedLastIndexBy`, `startCase`, `startsWith`, `stubArray`, `stubFalse`,
     * `stubObject`, `stubString`, `stubTrue`, `subtract`, `sum`, `sumBy`,
     * `template`, `times`, `toFinite`, `toInteger`, `toJSON`, `toLength`,
     * `toLower`, `toNumber`, `toSafeInteger`, `toString`, `toUpper`, `trim`,
     * `trimEnd`, `trimStart`, `truncate`, `unescape`, `uniqueId`, `upperCase`,
     * `upperFirst`, `value`, and `words`
     *
     * @name _
     * @constructor
     * @category Seq
     * @param {*} value The value to wrap in a `lodash` instance.
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * function square(n) {
     *   return n * n;
     * }
     *
     * var wrapped = _([1, 2, 3]);
     *
     * // Returns an unwrapped value.
     * wrapped.reduce(_.add);
     * // => 6
     *
     * // Returns a wrapped value.
     * var squares = wrapped.map(square);
     *
     * _.isArray(squares);
     * // => false
     *
     * _.isArray(squares.value());
     * // => true
     */
    function lodash(value) {
      if (isObjectLike(value) && !isArray(value) && !(value instanceof LazyWrapper)) {
        if (value instanceof LodashWrapper) {
          return value;
        }
        if (hasOwnProperty.call(value, '__wrapped__')) {
          return wrapperClone(value);
        }
      }
      return new LodashWrapper(value);
    }

    /**
     * The base implementation of `_.create` without support for assigning
     * properties to the created object.
     *
     * @private
     * @param {Object} proto The object to inherit from.
     * @returns {Object} Returns the new object.
     */
    var baseCreate = (function() {
      function object() {}
      return function(proto) {
        if (!isObject(proto)) {
          return {};
        }
        if (objectCreate) {
          return objectCreate(proto);
        }
        object.prototype = proto;
        var result = new object;
        object.prototype = undefined;
        return result;
      };
    }());

    /**
     * The function whose prototype chain sequence wrappers inherit from.
     *
     * @private
     */
    function baseLodash() {
      // No operation performed.
    }

    /**
     * The base constructor for creating `lodash` wrapper objects.
     *
     * @private
     * @param {*} value The value to wrap.
     * @param {boolean} [chainAll] Enable explicit method chain sequences.
     */
    function LodashWrapper(value, chainAll) {
      this.__wrapped__ = value;
      this.__actions__ = [];
      this.__chain__ = !!chainAll;
      this.__index__ = 0;
      this.__values__ = undefined;
    }

    /**
     * By default, the template delimiters used by lodash are like those in
     * embedded Ruby (ERB) as well as ES2015 template strings. Change the
     * following template settings to use alternative delimiters.
     *
     * @static
     * @memberOf _
     * @type {Object}
     */
    lodash.templateSettings = {

      /**
       * Used to detect `data` property values to be HTML-escaped.
       *
       * @memberOf _.templateSettings
       * @type {RegExp}
       */
      'escape': reEscape,

      /**
       * Used to detect code to be evaluated.
       *
       * @memberOf _.templateSettings
       * @type {RegExp}
       */
      'evaluate': reEvaluate,

      /**
       * Used to detect `data` property values to inject.
       *
       * @memberOf _.templateSettings
       * @type {RegExp}
       */
      'interpolate': reInterpolate,

      /**
       * Used to reference the data object in the template text.
       *
       * @memberOf _.templateSettings
       * @type {string}
       */
      'variable': '',

      /**
       * Used to import variables into the compiled template.
       *
       * @memberOf _.templateSettings
       * @type {Object}
       */
      'imports': {

        /**
         * A reference to the `lodash` function.
         *
         * @memberOf _.templateSettings.imports
         * @type {Function}
         */
        '_': lodash
      }
    };

    // Ensure wrappers are instances of `baseLodash`.
    lodash.prototype = baseLodash.prototype;
    lodash.prototype.constructor = lodash;

    LodashWrapper.prototype = baseCreate(baseLodash.prototype);
    LodashWrapper.prototype.constructor = LodashWrapper;

    /*------------------------------------------------------------------------*/

    /**
     * Creates a lazy wrapper object which wraps `value` to enable lazy evaluation.
     *
     * @private
     * @constructor
     * @param {*} value The value to wrap.
     */
    function LazyWrapper(value) {
      this.__wrapped__ = value;
      this.__actions__ = [];
      this.__dir__ = 1;
      this.__filtered__ = false;
      this.__iteratees__ = [];
      this.__takeCount__ = MAX_ARRAY_LENGTH;
      this.__views__ = [];
    }

    /**
     * Creates a clone of the lazy wrapper object.
     *
     * @private
     * @name clone
     * @memberOf LazyWrapper
     * @returns {Object} Returns the cloned `LazyWrapper` object.
     */
    function lazyClone() {
      var result = new LazyWrapper(this.__wrapped__);
      result.__actions__ = copyArray(this.__actions__);
      result.__dir__ = this.__dir__;
      result.__filtered__ = this.__filtered__;
      result.__iteratees__ = copyArray(this.__iteratees__);
      result.__takeCount__ = this.__takeCount__;
      result.__views__ = copyArray(this.__views__);
      return result;
    }

    /**
     * Reverses the direction of lazy iteration.
     *
     * @private
     * @name reverse
     * @memberOf LazyWrapper
     * @returns {Object} Returns the new reversed `LazyWrapper` object.
     */
    function lazyReverse() {
      if (this.__filtered__) {
        var result = new LazyWrapper(this);
        result.__dir__ = -1;
        result.__filtered__ = true;
      } else {
        result = this.clone();
        result.__dir__ *= -1;
      }
      return result;
    }

    /**
     * Extracts the unwrapped value from its lazy wrapper.
     *
     * @private
     * @name value
     * @memberOf LazyWrapper
     * @returns {*} Returns the unwrapped value.
     */
    function lazyValue() {
      var array = this.__wrapped__.value(),
          dir = this.__dir__,
          isArr = isArray(array),
          isRight = dir < 0,
          arrLength = isArr ? array.length : 0,
          view = getView(0, arrLength, this.__views__),
          start = view.start,
          end = view.end,
          length = end - start,
          index = isRight ? end : (start - 1),
          iteratees = this.__iteratees__,
          iterLength = iteratees.length,
          resIndex = 0,
          takeCount = nativeMin(length, this.__takeCount__);

      if (!isArr || (!isRight && arrLength == length && takeCount == length)) {
        return baseWrapperValue(array, this.__actions__);
      }
      var result = [];

      outer:
      while (length-- && resIndex < takeCount) {
        index += dir;

        var iterIndex = -1,
            value = array[index];

        while (++iterIndex < iterLength) {
          var data = iteratees[iterIndex],
              iteratee = data.iteratee,
              type = data.type,
              computed = iteratee(value);

          if (type == LAZY_MAP_FLAG) {
            value = computed;
          } else if (!computed) {
            if (type == LAZY_FILTER_FLAG) {
              continue outer;
            } else {
              break outer;
            }
          }
        }
        result[resIndex++] = value;
      }
      return result;
    }

    // Ensure `LazyWrapper` is an instance of `baseLodash`.
    LazyWrapper.prototype = baseCreate(baseLodash.prototype);
    LazyWrapper.prototype.constructor = LazyWrapper;

    /*------------------------------------------------------------------------*/

    /**
     * Creates a hash object.
     *
     * @private
     * @constructor
     * @param {Array} [entries] The key-value pairs to cache.
     */
    function Hash(entries) {
      var index = -1,
          length = entries == null ? 0 : entries.length;

      this.clear();
      while (++index < length) {
        var entry = entries[index];
        this.set(entry[0], entry[1]);
      }
    }

    /**
     * Removes all key-value entries from the hash.
     *
     * @private
     * @name clear
     * @memberOf Hash
     */
    function hashClear() {
      this.__data__ = nativeCreate ? nativeCreate(null) : {};
      this.size = 0;
    }

    /**
     * Removes `key` and its value from the hash.
     *
     * @private
     * @name delete
     * @memberOf Hash
     * @param {Object} hash The hash to modify.
     * @param {string} key The key of the value to remove.
     * @returns {boolean} Returns `true` if the entry was removed, else `false`.
     */
    function hashDelete(key) {
      var result = this.has(key) && delete this.__data__[key];
      this.size -= result ? 1 : 0;
      return result;
    }

    /**
     * Gets the hash value for `key`.
     *
     * @private
     * @name get
     * @memberOf Hash
     * @param {string} key The key of the value to get.
     * @returns {*} Returns the entry value.
     */
    function hashGet(key) {
      var data = this.__data__;
      if (nativeCreate) {
        var result = data[key];
        return result === HASH_UNDEFINED ? undefined : result;
      }
      return hasOwnProperty.call(data, key) ? data[key] : undefined;
    }

    /**
     * Checks if a hash value for `key` exists.
     *
     * @private
     * @name has
     * @memberOf Hash
     * @param {string} key The key of the entry to check.
     * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
     */
    function hashHas(key) {
      var data = this.__data__;
      return nativeCreate ? (data[key] !== undefined) : hasOwnProperty.call(data, key);
    }

    /**
     * Sets the hash `key` to `value`.
     *
     * @private
     * @name set
     * @memberOf Hash
     * @param {string} key The key of the value to set.
     * @param {*} value The value to set.
     * @returns {Object} Returns the hash instance.
     */
    function hashSet(key, value) {
      var data = this.__data__;
      this.size += this.has(key) ? 0 : 1;
      data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;
      return this;
    }

    // Add methods to `Hash`.
    Hash.prototype.clear = hashClear;
    Hash.prototype['delete'] = hashDelete;
    Hash.prototype.get = hashGet;
    Hash.prototype.has = hashHas;
    Hash.prototype.set = hashSet;

    /*------------------------------------------------------------------------*/

    /**
     * Creates an list cache object.
     *
     * @private
     * @constructor
     * @param {Array} [entries] The key-value pairs to cache.
     */
    function ListCache(entries) {
      var index = -1,
          length = entries == null ? 0 : entries.length;

      this.clear();
      while (++index < length) {
        var entry = entries[index];
        this.set(entry[0], entry[1]);
      }
    }

    /**
     * Removes all key-value entries from the list cache.
     *
     * @private
     * @name clear
     * @memberOf ListCache
     */
    function listCacheClear() {
      this.__data__ = [];
      this.size = 0;
    }

    /**
     * Removes `key` and its value from the list cache.
     *
     * @private
     * @name delete
     * @memberOf ListCache
     * @param {string} key The key of the value to remove.
     * @returns {boolean} Returns `true` if the entry was removed, else `false`.
     */
    function listCacheDelete(key) {
      var data = this.__data__,
          index = assocIndexOf(data, key);

      if (index < 0) {
        return false;
      }
      var lastIndex = data.length - 1;
      if (index == lastIndex) {
        data.pop();
      } else {
        splice.call(data, index, 1);
      }
      --this.size;
      return true;
    }

    /**
     * Gets the list cache value for `key`.
     *
     * @private
     * @name get
     * @memberOf ListCache
     * @param {string} key The key of the value to get.
     * @returns {*} Returns the entry value.
     */
    function listCacheGet(key) {
      var data = this.__data__,
          index = assocIndexOf(data, key);

      return index < 0 ? undefined : data[index][1];
    }

    /**
     * Checks if a list cache value for `key` exists.
     *
     * @private
     * @name has
     * @memberOf ListCache
     * @param {string} key The key of the entry to check.
     * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
     */
    function listCacheHas(key) {
      return assocIndexOf(this.__data__, key) > -1;
    }

    /**
     * Sets the list cache `key` to `value`.
     *
     * @private
     * @name set
     * @memberOf ListCache
     * @param {string} key The key of the value to set.
     * @param {*} value The value to set.
     * @returns {Object} Returns the list cache instance.
     */
    function listCacheSet(key, value) {
      var data = this.__data__,
          index = assocIndexOf(data, key);

      if (index < 0) {
        ++this.size;
        data.push([key, value]);
      } else {
        data[index][1] = value;
      }
      return this;
    }

    // Add methods to `ListCache`.
    ListCache.prototype.clear = listCacheClear;
    ListCache.prototype['delete'] = listCacheDelete;
    ListCache.prototype.get = listCacheGet;
    ListCache.prototype.has = listCacheHas;
    ListCache.prototype.set = listCacheSet;

    /*------------------------------------------------------------------------*/

    /**
     * Creates a map cache object to store key-value pairs.
     *
     * @private
     * @constructor
     * @param {Array} [entries] The key-value pairs to cache.
     */
    function MapCache(entries) {
      var index = -1,
          length = entries == null ? 0 : entries.length;

      this.clear();
      while (++index < length) {
        var entry = entries[index];
        this.set(entry[0], entry[1]);
      }
    }

    /**
     * Removes all key-value entries from the map.
     *
     * @private
     * @name clear
     * @memberOf MapCache
     */
    function mapCacheClear() {
      this.size = 0;
      this.__data__ = {
        'hash': new Hash,
        'map': new (Map || ListCache),
        'string': new Hash
      };
    }

    /**
     * Removes `key` and its value from the map.
     *
     * @private
     * @name delete
     * @memberOf MapCache
     * @param {string} key The key of the value to remove.
     * @returns {boolean} Returns `true` if the entry was removed, else `false`.
     */
    function mapCacheDelete(key) {
      var result = getMapData(this, key)['delete'](key);
      this.size -= result ? 1 : 0;
      return result;
    }

    /**
     * Gets the map value for `key`.
     *
     * @private
     * @name get
     * @memberOf MapCache
     * @param {string} key The key of the value to get.
     * @returns {*} Returns the entry value.
     */
    function mapCacheGet(key) {
      return getMapData(this, key).get(key);
    }

    /**
     * Checks if a map value for `key` exists.
     *
     * @private
     * @name has
     * @memberOf MapCache
     * @param {string} key The key of the entry to check.
     * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
     */
    function mapCacheHas(key) {
      return getMapData(this, key).has(key);
    }

    /**
     * Sets the map `key` to `value`.
     *
     * @private
     * @name set
     * @memberOf MapCache
     * @param {string} key The key of the value to set.
     * @param {*} value The value to set.
     * @returns {Object} Returns the map cache instance.
     */
    function mapCacheSet(key, value) {
      var data = getMapData(this, key),
          size = data.size;

      data.set(key, value);
      this.size += data.size == size ? 0 : 1;
      return this;
    }

    // Add methods to `MapCache`.
    MapCache.prototype.clear = mapCacheClear;
    MapCache.prototype['delete'] = mapCacheDelete;
    MapCache.prototype.get = mapCacheGet;
    MapCache.prototype.has = mapCacheHas;
    MapCache.prototype.set = mapCacheSet;

    /*------------------------------------------------------------------------*/

    /**
     *
     * Creates an array cache object to store unique values.
     *
     * @private
     * @constructor
     * @param {Array} [values] The values to cache.
     */
    function SetCache(values) {
      var index = -1,
          length = values == null ? 0 : values.length;

      this.__data__ = new MapCache;
      while (++index < length) {
        this.add(values[index]);
      }
    }

    /**
     * Adds `value` to the array cache.
     *
     * @private
     * @name add
     * @memberOf SetCache
     * @alias push
     * @param {*} value The value to cache.
     * @returns {Object} Returns the cache instance.
     */
    function setCacheAdd(value) {
      this.__data__.set(value, HASH_UNDEFINED);
      return this;
    }

    /**
     * Checks if `value` is in the array cache.
     *
     * @private
     * @name has
     * @memberOf SetCache
     * @param {*} value The value to search for.
     * @returns {number} Returns `true` if `value` is found, else `false`.
     */
    function setCacheHas(value) {
      return this.__data__.has(value);
    }

    // Add methods to `SetCache`.
    SetCache.prototype.add = SetCache.prototype.push = setCacheAdd;
    SetCache.prototype.has = setCacheHas;

    /*------------------------------------------------------------------------*/

    /**
     * Creates a stack cache object to store key-value pairs.
     *
     * @private
     * @constructor
     * @param {Array} [entries] The key-value pairs to cache.
     */
    function Stack(entries) {
      var data = this.__data__ = new ListCache(entries);
      this.size = data.size;
    }

    /**
     * Removes all key-value entries from the stack.
     *
     * @private
     * @name clear
     * @memberOf Stack
     */
    function stackClear() {
      this.__data__ = new ListCache;
      this.size = 0;
    }

    /**
     * Removes `key` and its value from the stack.
     *
     * @private
     * @name delete
     * @memberOf Stack
     * @param {string} key The key of the value to remove.
     * @returns {boolean} Returns `true` if the entry was removed, else `false`.
     */
    function stackDelete(key) {
      var data = this.__data__,
          result = data['delete'](key);

      this.size = data.size;
      return result;
    }

    /**
     * Gets the stack value for `key`.
     *
     * @private
     * @name get
     * @memberOf Stack
     * @param {string} key The key of the value to get.
     * @returns {*} Returns the entry value.
     */
    function stackGet(key) {
      return this.__data__.get(key);
    }

    /**
     * Checks if a stack value for `key` exists.
     *
     * @private
     * @name has
     * @memberOf Stack
     * @param {string} key The key of the entry to check.
     * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
     */
    function stackHas(key) {
      return this.__data__.has(key);
    }

    /**
     * Sets the stack `key` to `value`.
     *
     * @private
     * @name set
     * @memberOf Stack
     * @param {string} key The key of the value to set.
     * @param {*} value The value to set.
     * @returns {Object} Returns the stack cache instance.
     */
    function stackSet(key, value) {
      var data = this.__data__;
      if (data instanceof ListCache) {
        var pairs = data.__data__;
        if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {
          pairs.push([key, value]);
          this.size = ++data.size;
          return this;
        }
        data = this.__data__ = new MapCache(pairs);
      }
      data.set(key, value);
      this.size = data.size;
      return this;
    }

    // Add methods to `Stack`.
    Stack.prototype.clear = stackClear;
    Stack.prototype['delete'] = stackDelete;
    Stack.prototype.get = stackGet;
    Stack.prototype.has = stackHas;
    Stack.prototype.set = stackSet;

    /*------------------------------------------------------------------------*/

    /**
     * Creates an array of the enumerable property names of the array-like `value`.
     *
     * @private
     * @param {*} value The value to query.
     * @param {boolean} inherited Specify returning inherited property names.
     * @returns {Array} Returns the array of property names.
     */
    function arrayLikeKeys(value, inherited) {
      var isArr = isArray(value),
          isArg = !isArr && isArguments(value),
          isBuff = !isArr && !isArg && isBuffer(value),
          isType = !isArr && !isArg && !isBuff && isTypedArray(value),
          skipIndexes = isArr || isArg || isBuff || isType,
          result = skipIndexes ? baseTimes(value.length, String) : [],
          length = result.length;

      for (var key in value) {
        if ((inherited || hasOwnProperty.call(value, key)) &&
            !(skipIndexes && (
               // Safari 9 has enumerable `arguments.length` in strict mode.
               key == 'length' ||
               // Node.js 0.10 has enumerable non-index properties on buffers.
               (isBuff && (key == 'offset' || key == 'parent')) ||
               // PhantomJS 2 has enumerable non-index properties on typed arrays.
               (isType && (key == 'buffer' || key == 'byteLength' || key == 'byteOffset')) ||
               // Skip index properties.
               isIndex(key, length)
            ))) {
          result.push(key);
        }
      }
      return result;
    }

    /**
     * A specialized version of `_.sample` for arrays.
     *
     * @private
     * @param {Array} array The array to sample.
     * @returns {*} Returns the random element.
     */
    function arraySample(array) {
      var length = array.length;
      return length ? array[baseRandom(0, length - 1)] : undefined;
    }

    /**
     * A specialized version of `_.sampleSize` for arrays.
     *
     * @private
     * @param {Array} array The array to sample.
     * @param {number} n The number of elements to sample.
     * @returns {Array} Returns the random elements.
     */
    function arraySampleSize(array, n) {
      return shuffleSelf(copyArray(array), baseClamp(n, 0, array.length));
    }

    /**
     * A specialized version of `_.shuffle` for arrays.
     *
     * @private
     * @param {Array} array The array to shuffle.
     * @returns {Array} Returns the new shuffled array.
     */
    function arrayShuffle(array) {
      return shuffleSelf(copyArray(array));
    }

    /**
     * This function is like `assignValue` except that it doesn't assign
     * `undefined` values.
     *
     * @private
     * @param {Object} object The object to modify.
     * @param {string} key The key of the property to assign.
     * @param {*} value The value to assign.
     */
    function assignMergeValue(object, key, value) {
      if ((value !== undefined && !eq(object[key], value)) ||
          (value === undefined && !(key in object))) {
        baseAssignValue(object, key, value);
      }
    }

    /**
     * Assigns `value` to `key` of `object` if the existing value is not equivalent
     * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * for equality comparisons.
     *
     * @private
     * @param {Object} object The object to modify.
     * @param {string} key The key of the property to assign.
     * @param {*} value The value to assign.
     */
    function assignValue(object, key, value) {
      var objValue = object[key];
      if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) ||
          (value === undefined && !(key in object))) {
        baseAssignValue(object, key, value);
      }
    }

    /**
     * Gets the index at which the `key` is found in `array` of key-value pairs.
     *
     * @private
     * @param {Array} array The array to inspect.
     * @param {*} key The key to search for.
     * @returns {number} Returns the index of the matched value, else `-1`.
     */
    function assocIndexOf(array, key) {
      var length = array.length;
      while (length--) {
        if (eq(array[length][0], key)) {
          return length;
        }
      }
      return -1;
    }

    /**
     * Aggregates elements of `collection` on `accumulator` with keys transformed
     * by `iteratee` and values set by `setter`.
     *
     * @private
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} setter The function to set `accumulator` values.
     * @param {Function} iteratee The iteratee to transform keys.
     * @param {Object} accumulator The initial aggregated object.
     * @returns {Function} Returns `accumulator`.
     */
    function baseAggregator(collection, setter, iteratee, accumulator) {
      baseEach(collection, function(value, key, collection) {
        setter(accumulator, value, iteratee(value), collection);
      });
      return accumulator;
    }

    /**
     * The base implementation of `_.assign` without support for multiple sources
     * or `customizer` functions.
     *
     * @private
     * @param {Object} object The destination object.
     * @param {Object} source The source object.
     * @returns {Object} Returns `object`.
     */
    function baseAssign(object, source) {
      return object && copyObject(source, keys(source), object);
    }

    /**
     * The base implementation of `_.assignIn` without support for multiple sources
     * or `customizer` functions.
     *
     * @private
     * @param {Object} object The destination object.
     * @param {Object} source The source object.
     * @returns {Object} Returns `object`.
     */
    function baseAssignIn(object, source) {
      return object && copyObject(source, keysIn(source), object);
    }

    /**
     * The base implementation of `assignValue` and `assignMergeValue` without
     * value checks.
     *
     * @private
     * @param {Object} object The object to modify.
     * @param {string} key The key of the property to assign.
     * @param {*} value The value to assign.
     */
    function baseAssignValue(object, key, value) {
      if (key == '__proto__' && defineProperty) {
        defineProperty(object, key, {
          'configurable': true,
          'enumerable': true,
          'value': value,
          'writable': true
        });
      } else {
        object[key] = value;
      }
    }

    /**
     * The base implementation of `_.at` without support for individual paths.
     *
     * @private
     * @param {Object} object The object to iterate over.
     * @param {string[]} paths The property paths to pick.
     * @returns {Array} Returns the picked elements.
     */
    function baseAt(object, paths) {
      var index = -1,
          length = paths.length,
          result = Array(length),
          skip = object == null;

      while (++index < length) {
        result[index] = skip ? undefined : get(object, paths[index]);
      }
      return result;
    }

    /**
     * The base implementation of `_.clamp` which doesn't coerce arguments.
     *
     * @private
     * @param {number} number The number to clamp.
     * @param {number} [lower] The lower bound.
     * @param {number} upper The upper bound.
     * @returns {number} Returns the clamped number.
     */
    function baseClamp(number, lower, upper) {
      if (number === number) {
        if (upper !== undefined) {
          number = number <= upper ? number : upper;
        }
        if (lower !== undefined) {
          number = number >= lower ? number : lower;
        }
      }
      return number;
    }

    /**
     * The base implementation of `_.clone` and `_.cloneDeep` which tracks
     * traversed objects.
     *
     * @private
     * @param {*} value The value to clone.
     * @param {boolean} bitmask The bitmask flags.
     *  1 - Deep clone
     *  2 - Flatten inherited properties
     *  4 - Clone symbols
     * @param {Function} [customizer] The function to customize cloning.
     * @param {string} [key] The key of `value`.
     * @param {Object} [object] The parent object of `value`.
     * @param {Object} [stack] Tracks traversed objects and their clone counterparts.
     * @returns {*} Returns the cloned value.
     */
    function baseClone(value, bitmask, customizer, key, object, stack) {
      var result,
          isDeep = bitmask & CLONE_DEEP_FLAG,
          isFlat = bitmask & CLONE_FLAT_FLAG,
          isFull = bitmask & CLONE_SYMBOLS_FLAG;

      if (customizer) {
        result = object ? customizer(value, key, object, stack) : customizer(value);
      }
      if (result !== undefined) {
        return result;
      }
      if (!isObject(value)) {
        return value;
      }
      var isArr = isArray(value);
      if (isArr) {
        result = initCloneArray(value);
        if (!isDeep) {
          return copyArray(value, result);
        }
      } else {
        var tag = getTag(value),
            isFunc = tag == funcTag || tag == genTag;

        if (isBuffer(value)) {
          return cloneBuffer(value, isDeep);
        }
        if (tag == objectTag || tag == argsTag || (isFunc && !object)) {
          result = (isFlat || isFunc) ? {} : initCloneObject(value);
          if (!isDeep) {
            return isFlat
              ? copySymbolsIn(value, baseAssignIn(result, value))
              : copySymbols(value, baseAssign(result, value));
          }
        } else {
          if (!cloneableTags[tag]) {
            return object ? value : {};
          }
          result = initCloneByTag(value, tag, baseClone, isDeep);
        }
      }
      // Check for circular references and return its corresponding clone.
      stack || (stack = new Stack);
      var stacked = stack.get(value);
      if (stacked) {
        return stacked;
      }
      stack.set(value, result);

      var keysFunc = isFull
        ? (isFlat ? getAllKeysIn : getAllKeys)
        : (isFlat ? keysIn : keys);

      var props = isArr ? undefined : keysFunc(value);
      arrayEach(props || value, function(subValue, key) {
        if (props) {
          key = subValue;
          subValue = value[key];
        }
        // Recursively populate clone (susceptible to call stack limits).
        assignValue(result, key, baseClone(subValue, bitmask, customizer, key, value, stack));
      });
      return result;
    }

    /**
     * The base implementation of `_.conforms` which doesn't clone `source`.
     *
     * @private
     * @param {Object} source The object of property predicates to conform to.
     * @returns {Function} Returns the new spec function.
     */
    function baseConforms(source) {
      var props = keys(source);
      return function(object) {
        return baseConformsTo(object, source, props);
      };
    }

    /**
     * The base implementation of `_.conformsTo` which accepts `props` to check.
     *
     * @private
     * @param {Object} object The object to inspect.
     * @param {Object} source The object of property predicates to conform to.
     * @returns {boolean} Returns `true` if `object` conforms, else `false`.
     */
    function baseConformsTo(object, source, props) {
      var length = props.length;
      if (object == null) {
        return !length;
      }
      object = Object(object);
      while (length--) {
        var key = props[length],
            predicate = source[key],
            value = object[key];

        if ((value === undefined && !(key in object)) || !predicate(value)) {
          return false;
        }
      }
      return true;
    }

    /**
     * The base implementation of `_.delay` and `_.defer` which accepts `args`
     * to provide to `func`.
     *
     * @private
     * @param {Function} func The function to delay.
     * @param {number} wait The number of milliseconds to delay invocation.
     * @param {Array} args The arguments to provide to `func`.
     * @returns {number|Object} Returns the timer id or timeout object.
     */
    function baseDelay(func, wait, args) {
      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      return setTimeout(function() { func.apply(undefined, args); }, wait);
    }

    /**
     * The base implementation of methods like `_.difference` without support
     * for excluding multiple arrays or iteratee shorthands.
     *
     * @private
     * @param {Array} array The array to inspect.
     * @param {Array} values The values to exclude.
     * @param {Function} [iteratee] The iteratee invoked per element.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new array of filtered values.
     */
    function baseDifference(array, values, iteratee, comparator) {
      var index = -1,
          includes = arrayIncludes,
          isCommon = true,
          length = array.length,
          result = [],
          valuesLength = values.length;

      if (!length) {
        return result;
      }
      if (iteratee) {
        values = arrayMap(values, baseUnary(iteratee));
      }
      if (comparator) {
        includes = arrayIncludesWith;
        isCommon = false;
      }
      else if (values.length >= LARGE_ARRAY_SIZE) {
        includes = cacheHas;
        isCommon = false;
        values = new SetCache(values);
      }
      outer:
      while (++index < length) {
        var value = array[index],
            computed = iteratee == null ? value : iteratee(value);

        value = (comparator || value !== 0) ? value : 0;
        if (isCommon && computed === computed) {
          var valuesIndex = valuesLength;
          while (valuesIndex--) {
            if (values[valuesIndex] === computed) {
              continue outer;
            }
          }
          result.push(value);
        }
        else if (!includes(values, computed, comparator)) {
          result.push(value);
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.forEach` without support for iteratee shorthands.
     *
     * @private
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Array|Object} Returns `collection`.
     */
    var baseEach = createBaseEach(baseForOwn);

    /**
     * The base implementation of `_.forEachRight` without support for iteratee shorthands.
     *
     * @private
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Array|Object} Returns `collection`.
     */
    var baseEachRight = createBaseEach(baseForOwnRight, true);

    /**
     * The base implementation of `_.every` without support for iteratee shorthands.
     *
     * @private
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} predicate The function invoked per iteration.
     * @returns {boolean} Returns `true` if all elements pass the predicate check,
     *  else `false`
     */
    function baseEvery(collection, predicate) {
      var result = true;
      baseEach(collection, function(value, index, collection) {
        result = !!predicate(value, index, collection);
        return result;
      });
      return result;
    }

    /**
     * The base implementation of methods like `_.max` and `_.min` which accepts a
     * `comparator` to determine the extremum value.
     *
     * @private
     * @param {Array} array The array to iterate over.
     * @param {Function} iteratee The iteratee invoked per iteration.
     * @param {Function} comparator The comparator used to compare values.
     * @returns {*} Returns the extremum value.
     */
    function baseExtremum(array, iteratee, comparator) {
      var index = -1,
          length = array.length;

      while (++index < length) {
        var value = array[index],
            current = iteratee(value);

        if (current != null && (computed === undefined
              ? (current === current && !isSymbol(current))
              : comparator(current, computed)
            )) {
          var computed = current,
              result = value;
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.fill` without an iteratee call guard.
     *
     * @private
     * @param {Array} array The array to fill.
     * @param {*} value The value to fill `array` with.
     * @param {number} [start=0] The start position.
     * @param {number} [end=array.length] The end position.
     * @returns {Array} Returns `array`.
     */
    function baseFill(array, value, start, end) {
      var length = array.length;

      start = toInteger(start);
      if (start < 0) {
        start = -start > length ? 0 : (length + start);
      }
      end = (end === undefined || end > length) ? length : toInteger(end);
      if (end < 0) {
        end += length;
      }
      end = start > end ? 0 : toLength(end);
      while (start < end) {
        array[start++] = value;
      }
      return array;
    }

    /**
     * The base implementation of `_.filter` without support for iteratee shorthands.
     *
     * @private
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} predicate The function invoked per iteration.
     * @returns {Array} Returns the new filtered array.
     */
    function baseFilter(collection, predicate) {
      var result = [];
      baseEach(collection, function(value, index, collection) {
        if (predicate(value, index, collection)) {
          result.push(value);
        }
      });
      return result;
    }

    /**
     * The base implementation of `_.flatten` with support for restricting flattening.
     *
     * @private
     * @param {Array} array The array to flatten.
     * @param {number} depth The maximum recursion depth.
     * @param {boolean} [predicate=isFlattenable] The function invoked per iteration.
     * @param {boolean} [isStrict] Restrict to values that pass `predicate` checks.
     * @param {Array} [result=[]] The initial result value.
     * @returns {Array} Returns the new flattened array.
     */
    function baseFlatten(array, depth, predicate, isStrict, result) {
      var index = -1,
          length = array.length;

      predicate || (predicate = isFlattenable);
      result || (result = []);

      while (++index < length) {
        var value = array[index];
        if (depth > 0 && predicate(value)) {
          if (depth > 1) {
            // Recursively flatten arrays (susceptible to call stack limits).
            baseFlatten(value, depth - 1, predicate, isStrict, result);
          } else {
            arrayPush(result, value);
          }
        } else if (!isStrict) {
          result[result.length] = value;
        }
      }
      return result;
    }

    /**
     * The base implementation of `baseForOwn` which iterates over `object`
     * properties returned by `keysFunc` and invokes `iteratee` for each property.
     * Iteratee functions may exit iteration early by explicitly returning `false`.
     *
     * @private
     * @param {Object} object The object to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @param {Function} keysFunc The function to get the keys of `object`.
     * @returns {Object} Returns `object`.
     */
    var baseFor = createBaseFor();

    /**
     * This function is like `baseFor` except that it iterates over properties
     * in the opposite order.
     *
     * @private
     * @param {Object} object The object to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @param {Function} keysFunc The function to get the keys of `object`.
     * @returns {Object} Returns `object`.
     */
    var baseForRight = createBaseFor(true);

    /**
     * The base implementation of `_.forOwn` without support for iteratee shorthands.
     *
     * @private
     * @param {Object} object The object to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Object} Returns `object`.
     */
    function baseForOwn(object, iteratee) {
      return object && baseFor(object, iteratee, keys);
    }

    /**
     * The base implementation of `_.forOwnRight` without support for iteratee shorthands.
     *
     * @private
     * @param {Object} object The object to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Object} Returns `object`.
     */
    function baseForOwnRight(object, iteratee) {
      return object && baseForRight(object, iteratee, keys);
    }

    /**
     * The base implementation of `_.functions` which creates an array of
     * `object` function property names filtered from `props`.
     *
     * @private
     * @param {Object} object The object to inspect.
     * @param {Array} props The property names to filter.
     * @returns {Array} Returns the function names.
     */
    function baseFunctions(object, props) {
      return arrayFilter(props, function(key) {
        return isFunction(object[key]);
      });
    }

    /**
     * The base implementation of `_.get` without support for default values.
     *
     * @private
     * @param {Object} object The object to query.
     * @param {Array|string} path The path of the property to get.
     * @returns {*} Returns the resolved value.
     */
    function baseGet(object, path) {
      path = castPath(path, object);

      var index = 0,
          length = path.length;

      while (object != null && index < length) {
        object = object[toKey(path[index++])];
      }
      return (index && index == length) ? object : undefined;
    }

    /**
     * The base implementation of `getAllKeys` and `getAllKeysIn` which uses
     * `keysFunc` and `symbolsFunc` to get the enumerable property names and
     * symbols of `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @param {Function} keysFunc The function to get the keys of `object`.
     * @param {Function} symbolsFunc The function to get the symbols of `object`.
     * @returns {Array} Returns the array of property names and symbols.
     */
    function baseGetAllKeys(object, keysFunc, symbolsFunc) {
      var result = keysFunc(object);
      return isArray(object) ? result : arrayPush(result, symbolsFunc(object));
    }

    /**
     * The base implementation of `getTag` without fallbacks for buggy environments.
     *
     * @private
     * @param {*} value The value to query.
     * @returns {string} Returns the `toStringTag`.
     */
    function baseGetTag(value) {
      if (value == null) {
        return value === undefined ? undefinedTag : nullTag;
      }
      return (symToStringTag && symToStringTag in Object(value))
        ? getRawTag(value)
        : objectToString(value);
    }

    /**
     * The base implementation of `_.gt` which doesn't coerce arguments.
     *
     * @private
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {boolean} Returns `true` if `value` is greater than `other`,
     *  else `false`.
     */
    function baseGt(value, other) {
      return value > other;
    }

    /**
     * The base implementation of `_.has` without support for deep paths.
     *
     * @private
     * @param {Object} [object] The object to query.
     * @param {Array|string} key The key to check.
     * @returns {boolean} Returns `true` if `key` exists, else `false`.
     */
    function baseHas(object, key) {
      return object != null && hasOwnProperty.call(object, key);
    }

    /**
     * The base implementation of `_.hasIn` without support for deep paths.
     *
     * @private
     * @param {Object} [object] The object to query.
     * @param {Array|string} key The key to check.
     * @returns {boolean} Returns `true` if `key` exists, else `false`.
     */
    function baseHasIn(object, key) {
      return object != null && key in Object(object);
    }

    /**
     * The base implementation of `_.inRange` which doesn't coerce arguments.
     *
     * @private
     * @param {number} number The number to check.
     * @param {number} start The start of the range.
     * @param {number} end The end of the range.
     * @returns {boolean} Returns `true` if `number` is in the range, else `false`.
     */
    function baseInRange(number, start, end) {
      return number >= nativeMin(start, end) && number < nativeMax(start, end);
    }

    /**
     * The base implementation of methods like `_.intersection`, without support
     * for iteratee shorthands, that accepts an array of arrays to inspect.
     *
     * @private
     * @param {Array} arrays The arrays to inspect.
     * @param {Function} [iteratee] The iteratee invoked per element.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new array of shared values.
     */
    function baseIntersection(arrays, iteratee, comparator) {
      var includes = comparator ? arrayIncludesWith : arrayIncludes,
          length = arrays[0].length,
          othLength = arrays.length,
          othIndex = othLength,
          caches = Array(othLength),
          maxLength = Infinity,
          result = [];

      while (othIndex--) {
        var array = arrays[othIndex];
        if (othIndex && iteratee) {
          array = arrayMap(array, baseUnary(iteratee));
        }
        maxLength = nativeMin(array.length, maxLength);
        caches[othIndex] = !comparator && (iteratee || (length >= 120 && array.length >= 120))
          ? new SetCache(othIndex && array)
          : undefined;
      }
      array = arrays[0];

      var index = -1,
          seen = caches[0];

      outer:
      while (++index < length && result.length < maxLength) {
        var value = array[index],
            computed = iteratee ? iteratee(value) : value;

        value = (comparator || value !== 0) ? value : 0;
        if (!(seen
              ? cacheHas(seen, computed)
              : includes(result, computed, comparator)
            )) {
          othIndex = othLength;
          while (--othIndex) {
            var cache = caches[othIndex];
            if (!(cache
                  ? cacheHas(cache, computed)
                  : includes(arrays[othIndex], computed, comparator))
                ) {
              continue outer;
            }
          }
          if (seen) {
            seen.push(computed);
          }
          result.push(value);
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.invert` and `_.invertBy` which inverts
     * `object` with values transformed by `iteratee` and set by `setter`.
     *
     * @private
     * @param {Object} object The object to iterate over.
     * @param {Function} setter The function to set `accumulator` values.
     * @param {Function} iteratee The iteratee to transform values.
     * @param {Object} accumulator The initial inverted object.
     * @returns {Function} Returns `accumulator`.
     */
    function baseInverter(object, setter, iteratee, accumulator) {
      baseForOwn(object, function(value, key, object) {
        setter(accumulator, iteratee(value), key, object);
      });
      return accumulator;
    }

    /**
     * The base implementation of `_.invoke` without support for individual
     * method arguments.
     *
     * @private
     * @param {Object} object The object to query.
     * @param {Array|string} path The path of the method to invoke.
     * @param {Array} args The arguments to invoke the method with.
     * @returns {*} Returns the result of the invoked method.
     */
    function baseInvoke(object, path, args) {
      path = castPath(path, object);
      object = parent(object, path);
      var func = object == null ? object : object[toKey(last(path))];
      return func == null ? undefined : apply(func, object, args);
    }

    /**
     * The base implementation of `_.isArguments`.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an `arguments` object,
     */
    function baseIsArguments(value) {
      return isObjectLike(value) && baseGetTag(value) == argsTag;
    }

    /**
     * The base implementation of `_.isArrayBuffer` without Node.js optimizations.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an array buffer, else `false`.
     */
    function baseIsArrayBuffer(value) {
      return isObjectLike(value) && baseGetTag(value) == arrayBufferTag;
    }

    /**
     * The base implementation of `_.isDate` without Node.js optimizations.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a date object, else `false`.
     */
    function baseIsDate(value) {
      return isObjectLike(value) && baseGetTag(value) == dateTag;
    }

    /**
     * The base implementation of `_.isEqual` which supports partial comparisons
     * and tracks traversed objects.
     *
     * @private
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @param {boolean} bitmask The bitmask flags.
     *  1 - Unordered comparison
     *  2 - Partial comparison
     * @param {Function} [customizer] The function to customize comparisons.
     * @param {Object} [stack] Tracks traversed `value` and `other` objects.
     * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
     */
    function baseIsEqual(value, other, bitmask, customizer, stack) {
      if (value === other) {
        return true;
      }
      if (value == null || other == null || (!isObjectLike(value) && !isObjectLike(other))) {
        return value !== value && other !== other;
      }
      return baseIsEqualDeep(value, other, bitmask, customizer, baseIsEqual, stack);
    }

    /**
     * A specialized version of `baseIsEqual` for arrays and objects which performs
     * deep comparisons and tracks traversed objects enabling objects with circular
     * references to be compared.
     *
     * @private
     * @param {Object} object The object to compare.
     * @param {Object} other The other object to compare.
     * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
     * @param {Function} customizer The function to customize comparisons.
     * @param {Function} equalFunc The function to determine equivalents of values.
     * @param {Object} [stack] Tracks traversed `object` and `other` objects.
     * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
     */
    function baseIsEqualDeep(object, other, bitmask, customizer, equalFunc, stack) {
      var objIsArr = isArray(object),
          othIsArr = isArray(other),
          objTag = objIsArr ? arrayTag : getTag(object),
          othTag = othIsArr ? arrayTag : getTag(other);

      objTag = objTag == argsTag ? objectTag : objTag;
      othTag = othTag == argsTag ? objectTag : othTag;

      var objIsObj = objTag == objectTag,
          othIsObj = othTag == objectTag,
          isSameTag = objTag == othTag;

      if (isSameTag && isBuffer(object)) {
        if (!isBuffer(other)) {
          return false;
        }
        objIsArr = true;
        objIsObj = false;
      }
      if (isSameTag && !objIsObj) {
        stack || (stack = new Stack);
        return (objIsArr || isTypedArray(object))
          ? equalArrays(object, other, bitmask, customizer, equalFunc, stack)
          : equalByTag(object, other, objTag, bitmask, customizer, equalFunc, stack);
      }
      if (!(bitmask & COMPARE_PARTIAL_FLAG)) {
        var objIsWrapped = objIsObj && hasOwnProperty.call(object, '__wrapped__'),
            othIsWrapped = othIsObj && hasOwnProperty.call(other, '__wrapped__');

        if (objIsWrapped || othIsWrapped) {
          var objUnwrapped = objIsWrapped ? object.value() : object,
              othUnwrapped = othIsWrapped ? other.value() : other;

          stack || (stack = new Stack);
          return equalFunc(objUnwrapped, othUnwrapped, bitmask, customizer, stack);
        }
      }
      if (!isSameTag) {
        return false;
      }
      stack || (stack = new Stack);
      return equalObjects(object, other, bitmask, customizer, equalFunc, stack);
    }

    /**
     * The base implementation of `_.isMap` without Node.js optimizations.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a map, else `false`.
     */
    function baseIsMap(value) {
      return isObjectLike(value) && getTag(value) == mapTag;
    }

    /**
     * The base implementation of `_.isMatch` without support for iteratee shorthands.
     *
     * @private
     * @param {Object} object The object to inspect.
     * @param {Object} source The object of property values to match.
     * @param {Array} matchData The property names, values, and compare flags to match.
     * @param {Function} [customizer] The function to customize comparisons.
     * @returns {boolean} Returns `true` if `object` is a match, else `false`.
     */
    function baseIsMatch(object, source, matchData, customizer) {
      var index = matchData.length,
          length = index,
          noCustomizer = !customizer;

      if (object == null) {
        return !length;
      }
      object = Object(object);
      while (index--) {
        var data = matchData[index];
        if ((noCustomizer && data[2])
              ? data[1] !== object[data[0]]
              : !(data[0] in object)
            ) {
          return false;
        }
      }
      while (++index < length) {
        data = matchData[index];
        var key = data[0],
            objValue = object[key],
            srcValue = data[1];

        if (noCustomizer && data[2]) {
          if (objValue === undefined && !(key in object)) {
            return false;
          }
        } else {
          var stack = new Stack;
          if (customizer) {
            var result = customizer(objValue, srcValue, key, object, source, stack);
          }
          if (!(result === undefined
                ? baseIsEqual(srcValue, objValue, COMPARE_PARTIAL_FLAG | COMPARE_UNORDERED_FLAG, customizer, stack)
                : result
              )) {
            return false;
          }
        }
      }
      return true;
    }

    /**
     * The base implementation of `_.isNative` without bad shim checks.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a native function,
     *  else `false`.
     */
    function baseIsNative(value) {
      if (!isObject(value) || isMasked(value)) {
        return false;
      }
      var pattern = isFunction(value) ? reIsNative : reIsHostCtor;
      return pattern.test(toSource(value));
    }

    /**
     * The base implementation of `_.isRegExp` without Node.js optimizations.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a regexp, else `false`.
     */
    function baseIsRegExp(value) {
      return isObjectLike(value) && baseGetTag(value) == regexpTag;
    }

    /**
     * The base implementation of `_.isSet` without Node.js optimizations.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a set, else `false`.
     */
    function baseIsSet(value) {
      return isObjectLike(value) && getTag(value) == setTag;
    }

    /**
     * The base implementation of `_.isTypedArray` without Node.js optimizations.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.
     */
    function baseIsTypedArray(value) {
      return isObjectLike(value) &&
        isLength(value.length) && !!typedArrayTags[baseGetTag(value)];
    }

    /**
     * The base implementation of `_.iteratee`.
     *
     * @private
     * @param {*} [value=_.identity] The value to convert to an iteratee.
     * @returns {Function} Returns the iteratee.
     */
    function baseIteratee(value) {
      // Don't store the `typeof` result in a variable to avoid a JIT bug in Safari 9.
      // See https://bugs.webkit.org/show_bug.cgi?id=156034 for more details.
      if (typeof value == 'function') {
        return value;
      }
      if (value == null) {
        return identity;
      }
      if (typeof value == 'object') {
        return isArray(value)
          ? baseMatchesProperty(value[0], value[1])
          : baseMatches(value);
      }
      return property(value);
    }

    /**
     * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.
     *
     * @private
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property names.
     */
    function baseKeys(object) {
      if (!isPrototype(object)) {
        return nativeKeys(object);
      }
      var result = [];
      for (var key in Object(object)) {
        if (hasOwnProperty.call(object, key) && key != 'constructor') {
          result.push(key);
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.keysIn` which doesn't treat sparse arrays as dense.
     *
     * @private
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property names.
     */
    function baseKeysIn(object) {
      if (!isObject(object)) {
        return nativeKeysIn(object);
      }
      var isProto = isPrototype(object),
          result = [];

      for (var key in object) {
        if (!(key == 'constructor' && (isProto || !hasOwnProperty.call(object, key)))) {
          result.push(key);
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.lt` which doesn't coerce arguments.
     *
     * @private
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {boolean} Returns `true` if `value` is less than `other`,
     *  else `false`.
     */
    function baseLt(value, other) {
      return value < other;
    }

    /**
     * The base implementation of `_.map` without support for iteratee shorthands.
     *
     * @private
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Array} Returns the new mapped array.
     */
    function baseMap(collection, iteratee) {
      var index = -1,
          result = isArrayLike(collection) ? Array(collection.length) : [];

      baseEach(collection, function(value, key, collection) {
        result[++index] = iteratee(value, key, collection);
      });
      return result;
    }

    /**
     * The base implementation of `_.matches` which doesn't clone `source`.
     *
     * @private
     * @param {Object} source The object of property values to match.
     * @returns {Function} Returns the new spec function.
     */
    function baseMatches(source) {
      var matchData = getMatchData(source);
      if (matchData.length == 1 && matchData[0][2]) {
        return matchesStrictComparable(matchData[0][0], matchData[0][1]);
      }
      return function(object) {
        return object === source || baseIsMatch(object, source, matchData);
      };
    }

    /**
     * The base implementation of `_.matchesProperty` which doesn't clone `srcValue`.
     *
     * @private
     * @param {string} path The path of the property to get.
     * @param {*} srcValue The value to match.
     * @returns {Function} Returns the new spec function.
     */
    function baseMatchesProperty(path, srcValue) {
      if (isKey(path) && isStrictComparable(srcValue)) {
        return matchesStrictComparable(toKey(path), srcValue);
      }
      return function(object) {
        var objValue = get(object, path);
        return (objValue === undefined && objValue === srcValue)
          ? hasIn(object, path)
          : baseIsEqual(srcValue, objValue, COMPARE_PARTIAL_FLAG | COMPARE_UNORDERED_FLAG);
      };
    }

    /**
     * The base implementation of `_.merge` without support for multiple sources.
     *
     * @private
     * @param {Object} object The destination object.
     * @param {Object} source The source object.
     * @param {number} srcIndex The index of `source`.
     * @param {Function} [customizer] The function to customize merged values.
     * @param {Object} [stack] Tracks traversed source values and their merged
     *  counterparts.
     */
    function baseMerge(object, source, srcIndex, customizer, stack) {
      if (object === source) {
        return;
      }
      baseFor(source, function(srcValue, key) {
        if (isObject(srcValue)) {
          stack || (stack = new Stack);
          baseMergeDeep(object, source, key, srcIndex, baseMerge, customizer, stack);
        }
        else {
          var newValue = customizer
            ? customizer(object[key], srcValue, (key + ''), object, source, stack)
            : undefined;

          if (newValue === undefined) {
            newValue = srcValue;
          }
          assignMergeValue(object, key, newValue);
        }
      }, keysIn);
    }

    /**
     * A specialized version of `baseMerge` for arrays and objects which performs
     * deep merges and tracks traversed objects enabling objects with circular
     * references to be merged.
     *
     * @private
     * @param {Object} object The destination object.
     * @param {Object} source The source object.
     * @param {string} key The key of the value to merge.
     * @param {number} srcIndex The index of `source`.
     * @param {Function} mergeFunc The function to merge values.
     * @param {Function} [customizer] The function to customize assigned values.
     * @param {Object} [stack] Tracks traversed source values and their merged
     *  counterparts.
     */
    function baseMergeDeep(object, source, key, srcIndex, mergeFunc, customizer, stack) {
      var objValue = object[key],
          srcValue = source[key],
          stacked = stack.get(srcValue);

      if (stacked) {
        assignMergeValue(object, key, stacked);
        return;
      }
      var newValue = customizer
        ? customizer(objValue, srcValue, (key + ''), object, source, stack)
        : undefined;

      var isCommon = newValue === undefined;

      if (isCommon) {
        var isArr = isArray(srcValue),
            isBuff = !isArr && isBuffer(srcValue),
            isTyped = !isArr && !isBuff && isTypedArray(srcValue);

        newValue = srcValue;
        if (isArr || isBuff || isTyped) {
          if (isArray(objValue)) {
            newValue = objValue;
          }
          else if (isArrayLikeObject(objValue)) {
            newValue = copyArray(objValue);
          }
          else if (isBuff) {
            isCommon = false;
            newValue = cloneBuffer(srcValue, true);
          }
          else if (isTyped) {
            isCommon = false;
            newValue = cloneTypedArray(srcValue, true);
          }
          else {
            newValue = [];
          }
        }
        else if (isPlainObject(srcValue) || isArguments(srcValue)) {
          newValue = objValue;
          if (isArguments(objValue)) {
            newValue = toPlainObject(objValue);
          }
          else if (!isObject(objValue) || (srcIndex && isFunction(objValue))) {
            newValue = initCloneObject(srcValue);
          }
        }
        else {
          isCommon = false;
        }
      }
      if (isCommon) {
        // Recursively merge objects and arrays (susceptible to call stack limits).
        stack.set(srcValue, newValue);
        mergeFunc(newValue, srcValue, srcIndex, customizer, stack);
        stack['delete'](srcValue);
      }
      assignMergeValue(object, key, newValue);
    }

    /**
     * The base implementation of `_.nth` which doesn't coerce arguments.
     *
     * @private
     * @param {Array} array The array to query.
     * @param {number} n The index of the element to return.
     * @returns {*} Returns the nth element of `array`.
     */
    function baseNth(array, n) {
      var length = array.length;
      if (!length) {
        return;
      }
      n += n < 0 ? length : 0;
      return isIndex(n, length) ? array[n] : undefined;
    }

    /**
     * The base implementation of `_.orderBy` without param guards.
     *
     * @private
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function[]|Object[]|string[]} iteratees The iteratees to sort by.
     * @param {string[]} orders The sort orders of `iteratees`.
     * @returns {Array} Returns the new sorted array.
     */
    function baseOrderBy(collection, iteratees, orders) {
      var index = -1;
      iteratees = arrayMap(iteratees.length ? iteratees : [identity], baseUnary(getIteratee()));

      var result = baseMap(collection, function(value, key, collection) {
        var criteria = arrayMap(iteratees, function(iteratee) {
          return iteratee(value);
        });
        return { 'criteria': criteria, 'index': ++index, 'value': value };
      });

      return baseSortBy(result, function(object, other) {
        return compareMultiple(object, other, orders);
      });
    }

    /**
     * The base implementation of `_.pick` without support for individual
     * property identifiers.
     *
     * @private
     * @param {Object} object The source object.
     * @param {string[]} paths The property paths to pick.
     * @returns {Object} Returns the new object.
     */
    function basePick(object, paths) {
      return basePickBy(object, paths, function(value, path) {
        return hasIn(object, path);
      });
    }

    /**
     * The base implementation of  `_.pickBy` without support for iteratee shorthands.
     *
     * @private
     * @param {Object} object The source object.
     * @param {string[]} paths The property paths to pick.
     * @param {Function} predicate The function invoked per property.
     * @returns {Object} Returns the new object.
     */
    function basePickBy(object, paths, predicate) {
      var index = -1,
          length = paths.length,
          result = {};

      while (++index < length) {
        var path = paths[index],
            value = baseGet(object, path);

        if (predicate(value, path)) {
          baseSet(result, castPath(path, object), value);
        }
      }
      return result;
    }

    /**
     * A specialized version of `baseProperty` which supports deep paths.
     *
     * @private
     * @param {Array|string} path The path of the property to get.
     * @returns {Function} Returns the new accessor function.
     */
    function basePropertyDeep(path) {
      return function(object) {
        return baseGet(object, path);
      };
    }

    /**
     * The base implementation of `_.pullAllBy` without support for iteratee
     * shorthands.
     *
     * @private
     * @param {Array} array The array to modify.
     * @param {Array} values The values to remove.
     * @param {Function} [iteratee] The iteratee invoked per element.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns `array`.
     */
    function basePullAll(array, values, iteratee, comparator) {
      var indexOf = comparator ? baseIndexOfWith : baseIndexOf,
          index = -1,
          length = values.length,
          seen = array;

      if (array === values) {
        values = copyArray(values);
      }
      if (iteratee) {
        seen = arrayMap(array, baseUnary(iteratee));
      }
      while (++index < length) {
        var fromIndex = 0,
            value = values[index],
            computed = iteratee ? iteratee(value) : value;

        while ((fromIndex = indexOf(seen, computed, fromIndex, comparator)) > -1) {
          if (seen !== array) {
            splice.call(seen, fromIndex, 1);
          }
          splice.call(array, fromIndex, 1);
        }
      }
      return array;
    }

    /**
     * The base implementation of `_.pullAt` without support for individual
     * indexes or capturing the removed elements.
     *
     * @private
     * @param {Array} array The array to modify.
     * @param {number[]} indexes The indexes of elements to remove.
     * @returns {Array} Returns `array`.
     */
    function basePullAt(array, indexes) {
      var length = array ? indexes.length : 0,
          lastIndex = length - 1;

      while (length--) {
        var index = indexes[length];
        if (length == lastIndex || index !== previous) {
          var previous = index;
          if (isIndex(index)) {
            splice.call(array, index, 1);
          } else {
            baseUnset(array, index);
          }
        }
      }
      return array;
    }

    /**
     * The base implementation of `_.random` without support for returning
     * floating-point numbers.
     *
     * @private
     * @param {number} lower The lower bound.
     * @param {number} upper The upper bound.
     * @returns {number} Returns the random number.
     */
    function baseRandom(lower, upper) {
      return lower + nativeFloor(nativeRandom() * (upper - lower + 1));
    }

    /**
     * The base implementation of `_.range` and `_.rangeRight` which doesn't
     * coerce arguments.
     *
     * @private
     * @param {number} start The start of the range.
     * @param {number} end The end of the range.
     * @param {number} step The value to increment or decrement by.
     * @param {boolean} [fromRight] Specify iterating from right to left.
     * @returns {Array} Returns the range of numbers.
     */
    function baseRange(start, end, step, fromRight) {
      var index = -1,
          length = nativeMax(nativeCeil((end - start) / (step || 1)), 0),
          result = Array(length);

      while (length--) {
        result[fromRight ? length : ++index] = start;
        start += step;
      }
      return result;
    }

    /**
     * The base implementation of `_.repeat` which doesn't coerce arguments.
     *
     * @private
     * @param {string} string The string to repeat.
     * @param {number} n The number of times to repeat the string.
     * @returns {string} Returns the repeated string.
     */
    function baseRepeat(string, n) {
      var result = '';
      if (!string || n < 1 || n > MAX_SAFE_INTEGER) {
        return result;
      }
      // Leverage the exponentiation by squaring algorithm for a faster repeat.
      // See https://en.wikipedia.org/wiki/Exponentiation_by_squaring for more details.
      do {
        if (n % 2) {
          result += string;
        }
        n = nativeFloor(n / 2);
        if (n) {
          string += string;
        }
      } while (n);

      return result;
    }

    /**
     * The base implementation of `_.rest` which doesn't validate or coerce arguments.
     *
     * @private
     * @param {Function} func The function to apply a rest parameter to.
     * @param {number} [start=func.length-1] The start position of the rest parameter.
     * @returns {Function} Returns the new function.
     */
    function baseRest(func, start) {
      return setToString(overRest(func, start, identity), func + '');
    }

    /**
     * The base implementation of `_.sample`.
     *
     * @private
     * @param {Array|Object} collection The collection to sample.
     * @returns {*} Returns the random element.
     */
    function baseSample(collection) {
      return arraySample(values(collection));
    }

    /**
     * The base implementation of `_.sampleSize` without param guards.
     *
     * @private
     * @param {Array|Object} collection The collection to sample.
     * @param {number} n The number of elements to sample.
     * @returns {Array} Returns the random elements.
     */
    function baseSampleSize(collection, n) {
      var array = values(collection);
      return shuffleSelf(array, baseClamp(n, 0, array.length));
    }

    /**
     * The base implementation of `_.set`.
     *
     * @private
     * @param {Object} object The object to modify.
     * @param {Array|string} path The path of the property to set.
     * @param {*} value The value to set.
     * @param {Function} [customizer] The function to customize path creation.
     * @returns {Object} Returns `object`.
     */
    function baseSet(object, path, value, customizer) {
      if (!isObject(object)) {
        return object;
      }
      path = castPath(path, object);

      var index = -1,
          length = path.length,
          lastIndex = length - 1,
          nested = object;

      while (nested != null && ++index < length) {
        var key = toKey(path[index]),
            newValue = value;

        if (index != lastIndex) {
          var objValue = nested[key];
          newValue = customizer ? customizer(objValue, key, nested) : undefined;
          if (newValue === undefined) {
            newValue = isObject(objValue)
              ? objValue
              : (isIndex(path[index + 1]) ? [] : {});
          }
        }
        assignValue(nested, key, newValue);
        nested = nested[key];
      }
      return object;
    }

    /**
     * The base implementation of `setData` without support for hot loop shorting.
     *
     * @private
     * @param {Function} func The function to associate metadata with.
     * @param {*} data The metadata.
     * @returns {Function} Returns `func`.
     */
    var baseSetData = !metaMap ? identity : function(func, data) {
      metaMap.set(func, data);
      return func;
    };

    /**
     * The base implementation of `setToString` without support for hot loop shorting.
     *
     * @private
     * @param {Function} func The function to modify.
     * @param {Function} string The `toString` result.
     * @returns {Function} Returns `func`.
     */
    var baseSetToString = !defineProperty ? identity : function(func, string) {
      return defineProperty(func, 'toString', {
        'configurable': true,
        'enumerable': false,
        'value': constant(string),
        'writable': true
      });
    };

    /**
     * The base implementation of `_.shuffle`.
     *
     * @private
     * @param {Array|Object} collection The collection to shuffle.
     * @returns {Array} Returns the new shuffled array.
     */
    function baseShuffle(collection) {
      return shuffleSelf(values(collection));
    }

    /**
     * The base implementation of `_.slice` without an iteratee call guard.
     *
     * @private
     * @param {Array} array The array to slice.
     * @param {number} [start=0] The start position.
     * @param {number} [end=array.length] The end position.
     * @returns {Array} Returns the slice of `array`.
     */
    function baseSlice(array, start, end) {
      var index = -1,
          length = array.length;

      if (start < 0) {
        start = -start > length ? 0 : (length + start);
      }
      end = end > length ? length : end;
      if (end < 0) {
        end += length;
      }
      length = start > end ? 0 : ((end - start) >>> 0);
      start >>>= 0;

      var result = Array(length);
      while (++index < length) {
        result[index] = array[index + start];
      }
      return result;
    }

    /**
     * The base implementation of `_.some` without support for iteratee shorthands.
     *
     * @private
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} predicate The function invoked per iteration.
     * @returns {boolean} Returns `true` if any element passes the predicate check,
     *  else `false`.
     */
    function baseSome(collection, predicate) {
      var result;

      baseEach(collection, function(value, index, collection) {
        result = predicate(value, index, collection);
        return !result;
      });
      return !!result;
    }

    /**
     * The base implementation of `_.sortedIndex` and `_.sortedLastIndex` which
     * performs a binary search of `array` to determine the index at which `value`
     * should be inserted into `array` in order to maintain its sort order.
     *
     * @private
     * @param {Array} array The sorted array to inspect.
     * @param {*} value The value to evaluate.
     * @param {boolean} [retHighest] Specify returning the highest qualified index.
     * @returns {number} Returns the index at which `value` should be inserted
     *  into `array`.
     */
    function baseSortedIndex(array, value, retHighest) {
      var low = 0,
          high = array == null ? low : array.length;

      if (typeof value == 'number' && value === value && high <= HALF_MAX_ARRAY_LENGTH) {
        while (low < high) {
          var mid = (low + high) >>> 1,
              computed = array[mid];

          if (computed !== null && !isSymbol(computed) &&
              (retHighest ? (computed <= value) : (computed < value))) {
            low = mid + 1;
          } else {
            high = mid;
          }
        }
        return high;
      }
      return baseSortedIndexBy(array, value, identity, retHighest);
    }

    /**
     * The base implementation of `_.sortedIndexBy` and `_.sortedLastIndexBy`
     * which invokes `iteratee` for `value` and each element of `array` to compute
     * their sort ranking. The iteratee is invoked with one argument; (value).
     *
     * @private
     * @param {Array} array The sorted array to inspect.
     * @param {*} value The value to evaluate.
     * @param {Function} iteratee The iteratee invoked per element.
     * @param {boolean} [retHighest] Specify returning the highest qualified index.
     * @returns {number} Returns the index at which `value` should be inserted
     *  into `array`.
     */
    function baseSortedIndexBy(array, value, iteratee, retHighest) {
      value = iteratee(value);

      var low = 0,
          high = array == null ? 0 : array.length,
          valIsNaN = value !== value,
          valIsNull = value === null,
          valIsSymbol = isSymbol(value),
          valIsUndefined = value === undefined;

      while (low < high) {
        var mid = nativeFloor((low + high) / 2),
            computed = iteratee(array[mid]),
            othIsDefined = computed !== undefined,
            othIsNull = computed === null,
            othIsReflexive = computed === computed,
            othIsSymbol = isSymbol(computed);

        if (valIsNaN) {
          var setLow = retHighest || othIsReflexive;
        } else if (valIsUndefined) {
          setLow = othIsReflexive && (retHighest || othIsDefined);
        } else if (valIsNull) {
          setLow = othIsReflexive && othIsDefined && (retHighest || !othIsNull);
        } else if (valIsSymbol) {
          setLow = othIsReflexive && othIsDefined && !othIsNull && (retHighest || !othIsSymbol);
        } else if (othIsNull || othIsSymbol) {
          setLow = false;
        } else {
          setLow = retHighest ? (computed <= value) : (computed < value);
        }
        if (setLow) {
          low = mid + 1;
        } else {
          high = mid;
        }
      }
      return nativeMin(high, MAX_ARRAY_INDEX);
    }

    /**
     * The base implementation of `_.sortedUniq` and `_.sortedUniqBy` without
     * support for iteratee shorthands.
     *
     * @private
     * @param {Array} array The array to inspect.
     * @param {Function} [iteratee] The iteratee invoked per element.
     * @returns {Array} Returns the new duplicate free array.
     */
    function baseSortedUniq(array, iteratee) {
      var index = -1,
          length = array.length,
          resIndex = 0,
          result = [];

      while (++index < length) {
        var value = array[index],
            computed = iteratee ? iteratee(value) : value;

        if (!index || !eq(computed, seen)) {
          var seen = computed;
          result[resIndex++] = value === 0 ? 0 : value;
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.toNumber` which doesn't ensure correct
     * conversions of binary, hexadecimal, or octal string values.
     *
     * @private
     * @param {*} value The value to process.
     * @returns {number} Returns the number.
     */
    function baseToNumber(value) {
      if (typeof value == 'number') {
        return value;
      }
      if (isSymbol(value)) {
        return NAN;
      }
      return +value;
    }

    /**
     * The base implementation of `_.toString` which doesn't convert nullish
     * values to empty strings.
     *
     * @private
     * @param {*} value The value to process.
     * @returns {string} Returns the string.
     */
    function baseToString(value) {
      // Exit early for strings to avoid a performance hit in some environments.
      if (typeof value == 'string') {
        return value;
      }
      if (isArray(value)) {
        // Recursively convert values (susceptible to call stack limits).
        return arrayMap(value, baseToString) + '';
      }
      if (isSymbol(value)) {
        return symbolToString ? symbolToString.call(value) : '';
      }
      var result = (value + '');
      return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;
    }

    /**
     * The base implementation of `_.uniqBy` without support for iteratee shorthands.
     *
     * @private
     * @param {Array} array The array to inspect.
     * @param {Function} [iteratee] The iteratee invoked per element.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new duplicate free array.
     */
    function baseUniq(array, iteratee, comparator) {
      var index = -1,
          includes = arrayIncludes,
          length = array.length,
          isCommon = true,
          result = [],
          seen = result;

      if (comparator) {
        isCommon = false;
        includes = arrayIncludesWith;
      }
      else if (length >= LARGE_ARRAY_SIZE) {
        var set = iteratee ? null : createSet(array);
        if (set) {
          return setToArray(set);
        }
        isCommon = false;
        includes = cacheHas;
        seen = new SetCache;
      }
      else {
        seen = iteratee ? [] : result;
      }
      outer:
      while (++index < length) {
        var value = array[index],
            computed = iteratee ? iteratee(value) : value;

        value = (comparator || value !== 0) ? value : 0;
        if (isCommon && computed === computed) {
          var seenIndex = seen.length;
          while (seenIndex--) {
            if (seen[seenIndex] === computed) {
              continue outer;
            }
          }
          if (iteratee) {
            seen.push(computed);
          }
          result.push(value);
        }
        else if (!includes(seen, computed, comparator)) {
          if (seen !== result) {
            seen.push(computed);
          }
          result.push(value);
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.unset`.
     *
     * @private
     * @param {Object} object The object to modify.
     * @param {Array|string} path The property path to unset.
     * @returns {boolean} Returns `true` if the property is deleted, else `false`.
     */
    function baseUnset(object, path) {
      path = castPath(path, object);
      object = parent(object, path);
      return object == null || delete object[toKey(last(path))];
    }

    /**
     * The base implementation of `_.update`.
     *
     * @private
     * @param {Object} object The object to modify.
     * @param {Array|string} path The path of the property to update.
     * @param {Function} updater The function to produce the updated value.
     * @param {Function} [customizer] The function to customize path creation.
     * @returns {Object} Returns `object`.
     */
    function baseUpdate(object, path, updater, customizer) {
      return baseSet(object, path, updater(baseGet(object, path)), customizer);
    }

    /**
     * The base implementation of methods like `_.dropWhile` and `_.takeWhile`
     * without support for iteratee shorthands.
     *
     * @private
     * @param {Array} array The array to query.
     * @param {Function} predicate The function invoked per iteration.
     * @param {boolean} [isDrop] Specify dropping elements instead of taking them.
     * @param {boolean} [fromRight] Specify iterating from right to left.
     * @returns {Array} Returns the slice of `array`.
     */
    function baseWhile(array, predicate, isDrop, fromRight) {
      var length = array.length,
          index = fromRight ? length : -1;

      while ((fromRight ? index-- : ++index < length) &&
        predicate(array[index], index, array)) {}

      return isDrop
        ? baseSlice(array, (fromRight ? 0 : index), (fromRight ? index + 1 : length))
        : baseSlice(array, (fromRight ? index + 1 : 0), (fromRight ? length : index));
    }

    /**
     * The base implementation of `wrapperValue` which returns the result of
     * performing a sequence of actions on the unwrapped `value`, where each
     * successive action is supplied the return value of the previous.
     *
     * @private
     * @param {*} value The unwrapped value.
     * @param {Array} actions Actions to perform to resolve the unwrapped value.
     * @returns {*} Returns the resolved value.
     */
    function baseWrapperValue(value, actions) {
      var result = value;
      if (result instanceof LazyWrapper) {
        result = result.value();
      }
      return arrayReduce(actions, function(result, action) {
        return action.func.apply(action.thisArg, arrayPush([result], action.args));
      }, result);
    }

    /**
     * The base implementation of methods like `_.xor`, without support for
     * iteratee shorthands, that accepts an array of arrays to inspect.
     *
     * @private
     * @param {Array} arrays The arrays to inspect.
     * @param {Function} [iteratee] The iteratee invoked per element.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new array of values.
     */
    function baseXor(arrays, iteratee, comparator) {
      var length = arrays.length;
      if (length < 2) {
        return length ? baseUniq(arrays[0]) : [];
      }
      var index = -1,
          result = Array(length);

      while (++index < length) {
        var array = arrays[index],
            othIndex = -1;

        while (++othIndex < length) {
          if (othIndex != index) {
            result[index] = baseDifference(result[index] || array, arrays[othIndex], iteratee, comparator);
          }
        }
      }
      return baseUniq(baseFlatten(result, 1), iteratee, comparator);
    }

    /**
     * This base implementation of `_.zipObject` which assigns values using `assignFunc`.
     *
     * @private
     * @param {Array} props The property identifiers.
     * @param {Array} values The property values.
     * @param {Function} assignFunc The function to assign values.
     * @returns {Object} Returns the new object.
     */
    function baseZipObject(props, values, assignFunc) {
      var index = -1,
          length = props.length,
          valsLength = values.length,
          result = {};

      while (++index < length) {
        var value = index < valsLength ? values[index] : undefined;
        assignFunc(result, props[index], value);
      }
      return result;
    }

    /**
     * Casts `value` to an empty array if it's not an array like object.
     *
     * @private
     * @param {*} value The value to inspect.
     * @returns {Array|Object} Returns the cast array-like object.
     */
    function castArrayLikeObject(value) {
      return isArrayLikeObject(value) ? value : [];
    }

    /**
     * Casts `value` to `identity` if it's not a function.
     *
     * @private
     * @param {*} value The value to inspect.
     * @returns {Function} Returns cast function.
     */
    function castFunction(value) {
      return typeof value == 'function' ? value : identity;
    }

    /**
     * Casts `value` to a path array if it's not one.
     *
     * @private
     * @param {*} value The value to inspect.
     * @param {Object} [object] The object to query keys on.
     * @returns {Array} Returns the cast property path array.
     */
    function castPath(value, object) {
      if (isArray(value)) {
        return value;
      }
      return isKey(value, object) ? [value] : stringToPath(toString(value));
    }

    /**
     * A `baseRest` alias which can be replaced with `identity` by module
     * replacement plugins.
     *
     * @private
     * @type {Function}
     * @param {Function} func The function to apply a rest parameter to.
     * @returns {Function} Returns the new function.
     */
    var castRest = baseRest;

    /**
     * Casts `array` to a slice if it's needed.
     *
     * @private
     * @param {Array} array The array to inspect.
     * @param {number} start The start position.
     * @param {number} [end=array.length] The end position.
     * @returns {Array} Returns the cast slice.
     */
    function castSlice(array, start, end) {
      var length = array.length;
      end = end === undefined ? length : end;
      return (!start && end >= length) ? array : baseSlice(array, start, end);
    }

    /**
     * A simple wrapper around the global [`clearTimeout`](https://mdn.io/clearTimeout).
     *
     * @private
     * @param {number|Object} id The timer id or timeout object of the timer to clear.
     */
    var clearTimeout = ctxClearTimeout || function(id) {
      return root.clearTimeout(id);
    };

    /**
     * Creates a clone of  `buffer`.
     *
     * @private
     * @param {Buffer} buffer The buffer to clone.
     * @param {boolean} [isDeep] Specify a deep clone.
     * @returns {Buffer} Returns the cloned buffer.
     */
    function cloneBuffer(buffer, isDeep) {
      if (isDeep) {
        return buffer.slice();
      }
      var length = buffer.length,
          result = allocUnsafe ? allocUnsafe(length) : new buffer.constructor(length);

      buffer.copy(result);
      return result;
    }

    /**
     * Creates a clone of `arrayBuffer`.
     *
     * @private
     * @param {ArrayBuffer} arrayBuffer The array buffer to clone.
     * @returns {ArrayBuffer} Returns the cloned array buffer.
     */
    function cloneArrayBuffer(arrayBuffer) {
      var result = new arrayBuffer.constructor(arrayBuffer.byteLength);
      new Uint8Array(result).set(new Uint8Array(arrayBuffer));
      return result;
    }

    /**
     * Creates a clone of `dataView`.
     *
     * @private
     * @param {Object} dataView The data view to clone.
     * @param {boolean} [isDeep] Specify a deep clone.
     * @returns {Object} Returns the cloned data view.
     */
    function cloneDataView(dataView, isDeep) {
      var buffer = isDeep ? cloneArrayBuffer(dataView.buffer) : dataView.buffer;
      return new dataView.constructor(buffer, dataView.byteOffset, dataView.byteLength);
    }

    /**
     * Creates a clone of `map`.
     *
     * @private
     * @param {Object} map The map to clone.
     * @param {Function} cloneFunc The function to clone values.
     * @param {boolean} [isDeep] Specify a deep clone.
     * @returns {Object} Returns the cloned map.
     */
    function cloneMap(map, isDeep, cloneFunc) {
      var array = isDeep ? cloneFunc(mapToArray(map), CLONE_DEEP_FLAG) : mapToArray(map);
      return arrayReduce(array, addMapEntry, new map.constructor);
    }

    /**
     * Creates a clone of `regexp`.
     *
     * @private
     * @param {Object} regexp The regexp to clone.
     * @returns {Object} Returns the cloned regexp.
     */
    function cloneRegExp(regexp) {
      var result = new regexp.constructor(regexp.source, reFlags.exec(regexp));
      result.lastIndex = regexp.lastIndex;
      return result;
    }

    /**
     * Creates a clone of `set`.
     *
     * @private
     * @param {Object} set The set to clone.
     * @param {Function} cloneFunc The function to clone values.
     * @param {boolean} [isDeep] Specify a deep clone.
     * @returns {Object} Returns the cloned set.
     */
    function cloneSet(set, isDeep, cloneFunc) {
      var array = isDeep ? cloneFunc(setToArray(set), CLONE_DEEP_FLAG) : setToArray(set);
      return arrayReduce(array, addSetEntry, new set.constructor);
    }

    /**
     * Creates a clone of the `symbol` object.
     *
     * @private
     * @param {Object} symbol The symbol object to clone.
     * @returns {Object} Returns the cloned symbol object.
     */
    function cloneSymbol(symbol) {
      return symbolValueOf ? Object(symbolValueOf.call(symbol)) : {};
    }

    /**
     * Creates a clone of `typedArray`.
     *
     * @private
     * @param {Object} typedArray The typed array to clone.
     * @param {boolean} [isDeep] Specify a deep clone.
     * @returns {Object} Returns the cloned typed array.
     */
    function cloneTypedArray(typedArray, isDeep) {
      var buffer = isDeep ? cloneArrayBuffer(typedArray.buffer) : typedArray.buffer;
      return new typedArray.constructor(buffer, typedArray.byteOffset, typedArray.length);
    }

    /**
     * Compares values to sort them in ascending order.
     *
     * @private
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {number} Returns the sort order indicator for `value`.
     */
    function compareAscending(value, other) {
      if (value !== other) {
        var valIsDefined = value !== undefined,
            valIsNull = value === null,
            valIsReflexive = value === value,
            valIsSymbol = isSymbol(value);

        var othIsDefined = other !== undefined,
            othIsNull = other === null,
            othIsReflexive = other === other,
            othIsSymbol = isSymbol(other);

        if ((!othIsNull && !othIsSymbol && !valIsSymbol && value > other) ||
            (valIsSymbol && othIsDefined && othIsReflexive && !othIsNull && !othIsSymbol) ||
            (valIsNull && othIsDefined && othIsReflexive) ||
            (!valIsDefined && othIsReflexive) ||
            !valIsReflexive) {
          return 1;
        }
        if ((!valIsNull && !valIsSymbol && !othIsSymbol && value < other) ||
            (othIsSymbol && valIsDefined && valIsReflexive && !valIsNull && !valIsSymbol) ||
            (othIsNull && valIsDefined && valIsReflexive) ||
            (!othIsDefined && valIsReflexive) ||
            !othIsReflexive) {
          return -1;
        }
      }
      return 0;
    }

    /**
     * Used by `_.orderBy` to compare multiple properties of a value to another
     * and stable sort them.
     *
     * If `orders` is unspecified, all values are sorted in ascending order. Otherwise,
     * specify an order of "desc" for descending or "asc" for ascending sort order
     * of corresponding values.
     *
     * @private
     * @param {Object} object The object to compare.
     * @param {Object} other The other object to compare.
     * @param {boolean[]|string[]} orders The order to sort by for each property.
     * @returns {number} Returns the sort order indicator for `object`.
     */
    function compareMultiple(object, other, orders) {
      var index = -1,
          objCriteria = object.criteria,
          othCriteria = other.criteria,
          length = objCriteria.length,
          ordersLength = orders.length;

      while (++index < length) {
        var result = compareAscending(objCriteria[index], othCriteria[index]);
        if (result) {
          if (index >= ordersLength) {
            return result;
          }
          var order = orders[index];
          return result * (order == 'desc' ? -1 : 1);
        }
      }
      // Fixes an `Array#sort` bug in the JS engine embedded in Adobe applications
      // that causes it, under certain circumstances, to provide the same value for
      // `object` and `other`. See https://github.com/jashkenas/underscore/pull/1247
      // for more details.
      //
      // This also ensures a stable sort in V8 and other engines.
      // See https://bugs.chromium.org/p/v8/issues/detail?id=90 for more details.
      return object.index - other.index;
    }

    /**
     * Creates an array that is the composition of partially applied arguments,
     * placeholders, and provided arguments into a single array of arguments.
     *
     * @private
     * @param {Array} args The provided arguments.
     * @param {Array} partials The arguments to prepend to those provided.
     * @param {Array} holders The `partials` placeholder indexes.
     * @params {boolean} [isCurried] Specify composing for a curried function.
     * @returns {Array} Returns the new array of composed arguments.
     */
    function composeArgs(args, partials, holders, isCurried) {
      var argsIndex = -1,
          argsLength = args.length,
          holdersLength = holders.length,
          leftIndex = -1,
          leftLength = partials.length,
          rangeLength = nativeMax(argsLength - holdersLength, 0),
          result = Array(leftLength + rangeLength),
          isUncurried = !isCurried;

      while (++leftIndex < leftLength) {
        result[leftIndex] = partials[leftIndex];
      }
      while (++argsIndex < holdersLength) {
        if (isUncurried || argsIndex < argsLength) {
          result[holders[argsIndex]] = args[argsIndex];
        }
      }
      while (rangeLength--) {
        result[leftIndex++] = args[argsIndex++];
      }
      return result;
    }

    /**
     * This function is like `composeArgs` except that the arguments composition
     * is tailored for `_.partialRight`.
     *
     * @private
     * @param {Array} args The provided arguments.
     * @param {Array} partials The arguments to append to those provided.
     * @param {Array} holders The `partials` placeholder indexes.
     * @params {boolean} [isCurried] Specify composing for a curried function.
     * @returns {Array} Returns the new array of composed arguments.
     */
    function composeArgsRight(args, partials, holders, isCurried) {
      var argsIndex = -1,
          argsLength = args.length,
          holdersIndex = -1,
          holdersLength = holders.length,
          rightIndex = -1,
          rightLength = partials.length,
          rangeLength = nativeMax(argsLength - holdersLength, 0),
          result = Array(rangeLength + rightLength),
          isUncurried = !isCurried;

      while (++argsIndex < rangeLength) {
        result[argsIndex] = args[argsIndex];
      }
      var offset = argsIndex;
      while (++rightIndex < rightLength) {
        result[offset + rightIndex] = partials[rightIndex];
      }
      while (++holdersIndex < holdersLength) {
        if (isUncurried || argsIndex < argsLength) {
          result[offset + holders[holdersIndex]] = args[argsIndex++];
        }
      }
      return result;
    }

    /**
     * Copies the values of `source` to `array`.
     *
     * @private
     * @param {Array} source The array to copy values from.
     * @param {Array} [array=[]] The array to copy values to.
     * @returns {Array} Returns `array`.
     */
    function copyArray(source, array) {
      var index = -1,
          length = source.length;

      array || (array = Array(length));
      while (++index < length) {
        array[index] = source[index];
      }
      return array;
    }

    /**
     * Copies properties of `source` to `object`.
     *
     * @private
     * @param {Object} source The object to copy properties from.
     * @param {Array} props The property identifiers to copy.
     * @param {Object} [object={}] The object to copy properties to.
     * @param {Function} [customizer] The function to customize copied values.
     * @returns {Object} Returns `object`.
     */
    function copyObject(source, props, object, customizer) {
      var isNew = !object;
      object || (object = {});

      var index = -1,
          length = props.length;

      while (++index < length) {
        var key = props[index];

        var newValue = customizer
          ? customizer(object[key], source[key], key, object, source)
          : undefined;

        if (newValue === undefined) {
          newValue = source[key];
        }
        if (isNew) {
          baseAssignValue(object, key, newValue);
        } else {
          assignValue(object, key, newValue);
        }
      }
      return object;
    }

    /**
     * Copies own symbols of `source` to `object`.
     *
     * @private
     * @param {Object} source The object to copy symbols from.
     * @param {Object} [object={}] The object to copy symbols to.
     * @returns {Object} Returns `object`.
     */
    function copySymbols(source, object) {
      return copyObject(source, getSymbols(source), object);
    }

    /**
     * Copies own and inherited symbols of `source` to `object`.
     *
     * @private
     * @param {Object} source The object to copy symbols from.
     * @param {Object} [object={}] The object to copy symbols to.
     * @returns {Object} Returns `object`.
     */
    function copySymbolsIn(source, object) {
      return copyObject(source, getSymbolsIn(source), object);
    }

    /**
     * Creates a function like `_.groupBy`.
     *
     * @private
     * @param {Function} setter The function to set accumulator values.
     * @param {Function} [initializer] The accumulator object initializer.
     * @returns {Function} Returns the new aggregator function.
     */
    function createAggregator(setter, initializer) {
      return function(collection, iteratee) {
        var func = isArray(collection) ? arrayAggregator : baseAggregator,
            accumulator = initializer ? initializer() : {};

        return func(collection, setter, getIteratee(iteratee, 2), accumulator);
      };
    }

    /**
     * Creates a function like `_.assign`.
     *
     * @private
     * @param {Function} assigner The function to assign values.
     * @returns {Function} Returns the new assigner function.
     */
    function createAssigner(assigner) {
      return baseRest(function(object, sources) {
        var index = -1,
            length = sources.length,
            customizer = length > 1 ? sources[length - 1] : undefined,
            guard = length > 2 ? sources[2] : undefined;

        customizer = (assigner.length > 3 && typeof customizer == 'function')
          ? (length--, customizer)
          : undefined;

        if (guard && isIterateeCall(sources[0], sources[1], guard)) {
          customizer = length < 3 ? undefined : customizer;
          length = 1;
        }
        object = Object(object);
        while (++index < length) {
          var source = sources[index];
          if (source) {
            assigner(object, source, index, customizer);
          }
        }
        return object;
      });
    }

    /**
     * Creates a `baseEach` or `baseEachRight` function.
     *
     * @private
     * @param {Function} eachFunc The function to iterate over a collection.
     * @param {boolean} [fromRight] Specify iterating from right to left.
     * @returns {Function} Returns the new base function.
     */
    function createBaseEach(eachFunc, fromRight) {
      return function(collection, iteratee) {
        if (collection == null) {
          return collection;
        }
        if (!isArrayLike(collection)) {
          return eachFunc(collection, iteratee);
        }
        var length = collection.length,
            index = fromRight ? length : -1,
            iterable = Object(collection);

        while ((fromRight ? index-- : ++index < length)) {
          if (iteratee(iterable[index], index, iterable) === false) {
            break;
          }
        }
        return collection;
      };
    }

    /**
     * Creates a base function for methods like `_.forIn` and `_.forOwn`.
     *
     * @private
     * @param {boolean} [fromRight] Specify iterating from right to left.
     * @returns {Function} Returns the new base function.
     */
    function createBaseFor(fromRight) {
      return function(object, iteratee, keysFunc) {
        var index = -1,
            iterable = Object(object),
            props = keysFunc(object),
            length = props.length;

        while (length--) {
          var key = props[fromRight ? length : ++index];
          if (iteratee(iterable[key], key, iterable) === false) {
            break;
          }
        }
        return object;
      };
    }

    /**
     * Creates a function that wraps `func` to invoke it with the optional `this`
     * binding of `thisArg`.
     *
     * @private
     * @param {Function} func The function to wrap.
     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.
     * @param {*} [thisArg] The `this` binding of `func`.
     * @returns {Function} Returns the new wrapped function.
     */
    function createBind(func, bitmask, thisArg) {
      var isBind = bitmask & WRAP_BIND_FLAG,
          Ctor = createCtor(func);

      function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }
      return wrapper;
    }

    /**
     * Creates a function like `_.lowerFirst`.
     *
     * @private
     * @param {string} methodName The name of the `String` case method to use.
     * @returns {Function} Returns the new case function.
     */
    function createCaseFirst(methodName) {
      return function(string) {
        string = toString(string);

        var strSymbols = hasUnicode(string)
          ? stringToArray(string)
          : undefined;

        var chr = strSymbols
          ? strSymbols[0]
          : string.charAt(0);

        var trailing = strSymbols
          ? castSlice(strSymbols, 1).join('')
          : string.slice(1);

        return chr[methodName]() + trailing;
      };
    }

    /**
     * Creates a function like `_.camelCase`.
     *
     * @private
     * @param {Function} callback The function to combine each word.
     * @returns {Function} Returns the new compounder function.
     */
    function createCompounder(callback) {
      return function(string) {
        return arrayReduce(words(deburr(string).replace(reApos, '')), callback, '');
      };
    }

    /**
     * Creates a function that produces an instance of `Ctor` regardless of
     * whether it was invoked as part of a `new` expression or by `call` or `apply`.
     *
     * @private
     * @param {Function} Ctor The constructor to wrap.
     * @returns {Function} Returns the new wrapped function.
     */
    function createCtor(Ctor) {
      return function() {
        // Use a `switch` statement to work with class constructors. See
        // http://ecma-international.org/ecma-262/7.0/#sec-ecmascript-function-objects-call-thisargument-argumentslist
        // for more details.
        var args = arguments;
        switch (args.length) {
          case 0: return new Ctor;
          case 1: return new Ctor(args[0]);
          case 2: return new Ctor(args[0], args[1]);
          case 3: return new Ctor(args[0], args[1], args[2]);
          case 4: return new Ctor(args[0], args[1], args[2], args[3]);
          case 5: return new Ctor(args[0], args[1], args[2], args[3], args[4]);
          case 6: return new Ctor(args[0], args[1], args[2], args[3], args[4], args[5]);
          case 7: return new Ctor(args[0], args[1], args[2], args[3], args[4], args[5], args[6]);
        }
        var thisBinding = baseCreate(Ctor.prototype),
            result = Ctor.apply(thisBinding, args);

        // Mimic the constructor's `return` behavior.
        // See https://es5.github.io/#x13.2.2 for more details.
        return isObject(result) ? result : thisBinding;
      };
    }

    /**
     * Creates a function that wraps `func` to enable currying.
     *
     * @private
     * @param {Function} func The function to wrap.
     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.
     * @param {number} arity The arity of `func`.
     * @returns {Function} Returns the new wrapped function.
     */
    function createCurry(func, bitmask, arity) {
      var Ctor = createCtor(func);

      function wrapper() {
        var length = arguments.length,
            args = Array(length),
            index = length,
            placeholder = getHolder(wrapper);

        while (index--) {
          args[index] = arguments[index];
        }
        var holders = (length < 3 && args[0] !== placeholder && args[length - 1] !== placeholder)
          ? []
          : replaceHolders(args, placeholder);

        length -= holders.length;
        if (length < arity) {
          return createRecurry(
            func, bitmask, createHybrid, wrapper.placeholder, undefined,
            args, holders, undefined, undefined, arity - length);
        }
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return apply(fn, this, args);
      }
      return wrapper;
    }

    /**
     * Creates a `_.find` or `_.findLast` function.
     *
     * @private
     * @param {Function} findIndexFunc The function to find the collection index.
     * @returns {Function} Returns the new find function.
     */
    function createFind(findIndexFunc) {
      return function(collection, predicate, fromIndex) {
        var iterable = Object(collection);
        if (!isArrayLike(collection)) {
          var iteratee = getIteratee(predicate, 3);
          collection = keys(collection);
          predicate = function(key) { return iteratee(iterable[key], key, iterable); };
        }
        var index = findIndexFunc(collection, predicate, fromIndex);
        return index > -1 ? iterable[iteratee ? collection[index] : index] : undefined;
      };
    }

    /**
     * Creates a `_.flow` or `_.flowRight` function.
     *
     * @private
     * @param {boolean} [fromRight] Specify iterating from right to left.
     * @returns {Function} Returns the new flow function.
     */
    function createFlow(fromRight) {
      return flatRest(function(funcs) {
        var length = funcs.length,
            index = length,
            prereq = LodashWrapper.prototype.thru;

        if (fromRight) {
          funcs.reverse();
        }
        while (index--) {
          var func = funcs[index];
          if (typeof func != 'function') {
            throw new TypeError(FUNC_ERROR_TEXT);
          }
          if (prereq && !wrapper && getFuncName(func) == 'wrapper') {
            var wrapper = new LodashWrapper([], true);
          }
        }
        index = wrapper ? index : length;
        while (++index < length) {
          func = funcs[index];

          var funcName = getFuncName(func),
              data = funcName == 'wrapper' ? getData(func) : undefined;

          if (data && isLaziable(data[0]) &&
                data[1] == (WRAP_ARY_FLAG | WRAP_CURRY_FLAG | WRAP_PARTIAL_FLAG | WRAP_REARG_FLAG) &&
                !data[4].length && data[9] == 1
              ) {
            wrapper = wrapper[getFuncName(data[0])].apply(wrapper, data[3]);
          } else {
            wrapper = (func.length == 1 && isLaziable(func))
              ? wrapper[funcName]()
              : wrapper.thru(func);
          }
        }
        return function() {
          var args = arguments,
              value = args[0];

          if (wrapper && args.length == 1 && isArray(value)) {
            return wrapper.plant(value).value();
          }
          var index = 0,
              result = length ? funcs[index].apply(this, args) : value;

          while (++index < length) {
            result = funcs[index].call(this, result);
          }
          return result;
        };
      });
    }

    /**
     * Creates a function that wraps `func` to invoke it with optional `this`
     * binding of `thisArg`, partial application, and currying.
     *
     * @private
     * @param {Function|string} func The function or method name to wrap.
     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.
     * @param {*} [thisArg] The `this` binding of `func`.
     * @param {Array} [partials] The arguments to prepend to those provided to
     *  the new function.
     * @param {Array} [holders] The `partials` placeholder indexes.
     * @param {Array} [partialsRight] The arguments to append to those provided
     *  to the new function.
     * @param {Array} [holdersRight] The `partialsRight` placeholder indexes.
     * @param {Array} [argPos] The argument positions of the new function.
     * @param {number} [ary] The arity cap of `func`.
     * @param {number} [arity] The arity of `func`.
     * @returns {Function} Returns the new wrapped function.
     */
    function createHybrid(func, bitmask, thisArg, partials, holders, partialsRight, holdersRight, argPos, ary, arity) {
      var isAry = bitmask & WRAP_ARY_FLAG,
          isBind = bitmask & WRAP_BIND_FLAG,
          isBindKey = bitmask & WRAP_BIND_KEY_FLAG,
          isCurried = bitmask & (WRAP_CURRY_FLAG | WRAP_CURRY_RIGHT_FLAG),
          isFlip = bitmask & WRAP_FLIP_FLAG,
          Ctor = isBindKey ? undefined : createCtor(func);

      function wrapper() {
        var length = arguments.length,
            args = Array(length),
            index = length;

        while (index--) {
          args[index] = arguments[index];
        }
        if (isCurried) {
          var placeholder = getHolder(wrapper),
              holdersCount = countHolders(args, placeholder);
        }
        if (partials) {
          args = composeArgs(args, partials, holders, isCurried);
        }
        if (partialsRight) {
          args = composeArgsRight(args, partialsRight, holdersRight, isCurried);
        }
        length -= holdersCount;
        if (isCurried && length < arity) {
          var newHolders = replaceHolders(args, placeholder);
          return createRecurry(
            func, bitmask, createHybrid, wrapper.placeholder, thisArg,
            args, newHolders, argPos, ary, arity - length
          );
        }
        var thisBinding = isBind ? thisArg : this,
            fn = isBindKey ? thisBinding[func] : func;

        length = args.length;
        if (argPos) {
          args = reorder(args, argPos);
        } else if (isFlip && length > 1) {
          args.reverse();
        }
        if (isAry && ary < length) {
          args.length = ary;
        }
        if (this && this !== root && this instanceof wrapper) {
          fn = Ctor || createCtor(fn);
        }
        return fn.apply(thisBinding, args);
      }
      return wrapper;
    }

    /**
     * Creates a function like `_.invertBy`.
     *
     * @private
     * @param {Function} setter The function to set accumulator values.
     * @param {Function} toIteratee The function to resolve iteratees.
     * @returns {Function} Returns the new inverter function.
     */
    function createInverter(setter, toIteratee) {
      return function(object, iteratee) {
        return baseInverter(object, setter, toIteratee(iteratee), {});
      };
    }

    /**
     * Creates a function that performs a mathematical operation on two values.
     *
     * @private
     * @param {Function} operator The function to perform the operation.
     * @param {number} [defaultValue] The value used for `undefined` arguments.
     * @returns {Function} Returns the new mathematical operation function.
     */
    function createMathOperation(operator, defaultValue) {
      return function(value, other) {
        var result;
        if (value === undefined && other === undefined) {
          return defaultValue;
        }
        if (value !== undefined) {
          result = value;
        }
        if (other !== undefined) {
          if (result === undefined) {
            return other;
          }
          if (typeof value == 'string' || typeof other == 'string') {
            value = baseToString(value);
            other = baseToString(other);
          } else {
            value = baseToNumber(value);
            other = baseToNumber(other);
          }
          result = operator(value, other);
        }
        return result;
      };
    }

    /**
     * Creates a function like `_.over`.
     *
     * @private
     * @param {Function} arrayFunc The function to iterate over iteratees.
     * @returns {Function} Returns the new over function.
     */
    function createOver(arrayFunc) {
      return flatRest(function(iteratees) {
        iteratees = arrayMap(iteratees, baseUnary(getIteratee()));
        return baseRest(function(args) {
          var thisArg = this;
          return arrayFunc(iteratees, function(iteratee) {
            return apply(iteratee, thisArg, args);
          });
        });
      });
    }

    /**
     * Creates the padding for `string` based on `length`. The `chars` string
     * is truncated if the number of characters exceeds `length`.
     *
     * @private
     * @param {number} length The padding length.
     * @param {string} [chars=' '] The string used as padding.
     * @returns {string} Returns the padding for `string`.
     */
    function createPadding(length, chars) {
      chars = chars === undefined ? ' ' : baseToString(chars);

      var charsLength = chars.length;
      if (charsLength < 2) {
        return charsLength ? baseRepeat(chars, length) : chars;
      }
      var result = baseRepeat(chars, nativeCeil(length / stringSize(chars)));
      return hasUnicode(chars)
        ? castSlice(stringToArray(result), 0, length).join('')
        : result.slice(0, length);
    }

    /**
     * Creates a function that wraps `func` to invoke it with the `this` binding
     * of `thisArg` and `partials` prepended to the arguments it receives.
     *
     * @private
     * @param {Function} func The function to wrap.
     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.
     * @param {*} thisArg The `this` binding of `func`.
     * @param {Array} partials The arguments to prepend to those provided to
     *  the new function.
     * @returns {Function} Returns the new wrapped function.
     */
    function createPartial(func, bitmask, thisArg, partials) {
      var isBind = bitmask & WRAP_BIND_FLAG,
          Ctor = createCtor(func);

      function wrapper() {
        var argsIndex = -1,
            argsLength = arguments.length,
            leftIndex = -1,
            leftLength = partials.length,
            args = Array(leftLength + argsLength),
            fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;

        while (++leftIndex < leftLength) {
          args[leftIndex] = partials[leftIndex];
        }
        while (argsLength--) {
          args[leftIndex++] = arguments[++argsIndex];
        }
        return apply(fn, isBind ? thisArg : this, args);
      }
      return wrapper;
    }

    /**
     * Creates a `_.range` or `_.rangeRight` function.
     *
     * @private
     * @param {boolean} [fromRight] Specify iterating from right to left.
     * @returns {Function} Returns the new range function.
     */
    function createRange(fromRight) {
      return function(start, end, step) {
        if (step && typeof step != 'number' && isIterateeCall(start, end, step)) {
          end = step = undefined;
        }
        // Ensure the sign of `-0` is preserved.
        start = toFinite(start);
        if (end === undefined) {
          end = start;
          start = 0;
        } else {
          end = toFinite(end);
        }
        step = step === undefined ? (start < end ? 1 : -1) : toFinite(step);
        return baseRange(start, end, step, fromRight);
      };
    }

    /**
     * Creates a function that performs a relational operation on two values.
     *
     * @private
     * @param {Function} operator The function to perform the operation.
     * @returns {Function} Returns the new relational operation function.
     */
    function createRelationalOperation(operator) {
      return function(value, other) {
        if (!(typeof value == 'string' && typeof other == 'string')) {
          value = toNumber(value);
          other = toNumber(other);
        }
        return operator(value, other);
      };
    }

    /**
     * Creates a function that wraps `func` to continue currying.
     *
     * @private
     * @param {Function} func The function to wrap.
     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.
     * @param {Function} wrapFunc The function to create the `func` wrapper.
     * @param {*} placeholder The placeholder value.
     * @param {*} [thisArg] The `this` binding of `func`.
     * @param {Array} [partials] The arguments to prepend to those provided to
     *  the new function.
     * @param {Array} [holders] The `partials` placeholder indexes.
     * @param {Array} [argPos] The argument positions of the new function.
     * @param {number} [ary] The arity cap of `func`.
     * @param {number} [arity] The arity of `func`.
     * @returns {Function} Returns the new wrapped function.
     */
    function createRecurry(func, bitmask, wrapFunc, placeholder, thisArg, partials, holders, argPos, ary, arity) {
      var isCurry = bitmask & WRAP_CURRY_FLAG,
          newHolders = isCurry ? holders : undefined,
          newHoldersRight = isCurry ? undefined : holders,
          newPartials = isCurry ? partials : undefined,
          newPartialsRight = isCurry ? undefined : partials;

      bitmask |= (isCurry ? WRAP_PARTIAL_FLAG : WRAP_PARTIAL_RIGHT_FLAG);
      bitmask &= ~(isCurry ? WRAP_PARTIAL_RIGHT_FLAG : WRAP_PARTIAL_FLAG);

      if (!(bitmask & WRAP_CURRY_BOUND_FLAG)) {
        bitmask &= ~(WRAP_BIND_FLAG | WRAP_BIND_KEY_FLAG);
      }
      var newData = [
        func, bitmask, thisArg, newPartials, newHolders, newPartialsRight,
        newHoldersRight, argPos, ary, arity
      ];

      var result = wrapFunc.apply(undefined, newData);
      if (isLaziable(func)) {
        setData(result, newData);
      }
      result.placeholder = placeholder;
      return setWrapToString(result, func, bitmask);
    }

    /**
     * Creates a function like `_.round`.
     *
     * @private
     * @param {string} methodName The name of the `Math` method to use when rounding.
     * @returns {Function} Returns the new round function.
     */
    function createRound(methodName) {
      var func = Math[methodName];
      return function(number, precision) {
        number = toNumber(number);
        precision = precision == null ? 0 : nativeMin(toInteger(precision), 292);
        if (precision) {
          // Shift with exponential notation to avoid floating-point issues.
          // See [MDN](https://mdn.io/round#Examples) for more details.
          var pair = (toString(number) + 'e').split('e'),
              value = func(pair[0] + 'e' + (+pair[1] + precision));

          pair = (toString(value) + 'e').split('e');
          return +(pair[0] + 'e' + (+pair[1] - precision));
        }
        return func(number);
      };
    }

    /**
     * Creates a set object of `values`.
     *
     * @private
     * @param {Array} values The values to add to the set.
     * @returns {Object} Returns the new set.
     */
    var createSet = !(Set && (1 / setToArray(new Set([,-0]))[1]) == INFINITY) ? noop : function(values) {
      return new Set(values);
    };

    /**
     * Creates a `_.toPairs` or `_.toPairsIn` function.
     *
     * @private
     * @param {Function} keysFunc The function to get the keys of a given object.
     * @returns {Function} Returns the new pairs function.
     */
    function createToPairs(keysFunc) {
      return function(object) {
        var tag = getTag(object);
        if (tag == mapTag) {
          return mapToArray(object);
        }
        if (tag == setTag) {
          return setToPairs(object);
        }
        return baseToPairs(object, keysFunc(object));
      };
    }

    /**
     * Creates a function that either curries or invokes `func` with optional
     * `this` binding and partially applied arguments.
     *
     * @private
     * @param {Function|string} func The function or method name to wrap.
     * @param {number} bitmask The bitmask flags.
     *    1 - `_.bind`
     *    2 - `_.bindKey`
     *    4 - `_.curry` or `_.curryRight` of a bound function
     *    8 - `_.curry`
     *   16 - `_.curryRight`
     *   32 - `_.partial`
     *   64 - `_.partialRight`
     *  128 - `_.rearg`
     *  256 - `_.ary`
     *  512 - `_.flip`
     * @param {*} [thisArg] The `this` binding of `func`.
     * @param {Array} [partials] The arguments to be partially applied.
     * @param {Array} [holders] The `partials` placeholder indexes.
     * @param {Array} [argPos] The argument positions of the new function.
     * @param {number} [ary] The arity cap of `func`.
     * @param {number} [arity] The arity of `func`.
     * @returns {Function} Returns the new wrapped function.
     */
    function createWrap(func, bitmask, thisArg, partials, holders, argPos, ary, arity) {
      var isBindKey = bitmask & WRAP_BIND_KEY_FLAG;
      if (!isBindKey && typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      var length = partials ? partials.length : 0;
      if (!length) {
        bitmask &= ~(WRAP_PARTIAL_FLAG | WRAP_PARTIAL_RIGHT_FLAG);
        partials = holders = undefined;
      }
      ary = ary === undefined ? ary : nativeMax(toInteger(ary), 0);
      arity = arity === undefined ? arity : toInteger(arity);
      length -= holders ? holders.length : 0;

      if (bitmask & WRAP_PARTIAL_RIGHT_FLAG) {
        var partialsRight = partials,
            holdersRight = holders;

        partials = holders = undefined;
      }
      var data = isBindKey ? undefined : getData(func);

      var newData = [
        func, bitmask, thisArg, partials, holders, partialsRight, holdersRight,
        argPos, ary, arity
      ];

      if (data) {
        mergeData(newData, data);
      }
      func = newData[0];
      bitmask = newData[1];
      thisArg = newData[2];
      partials = newData[3];
      holders = newData[4];
      arity = newData[9] = newData[9] === undefined
        ? (isBindKey ? 0 : func.length)
        : nativeMax(newData[9] - length, 0);

      if (!arity && bitmask & (WRAP_CURRY_FLAG | WRAP_CURRY_RIGHT_FLAG)) {
        bitmask &= ~(WRAP_CURRY_FLAG | WRAP_CURRY_RIGHT_FLAG);
      }
      if (!bitmask || bitmask == WRAP_BIND_FLAG) {
        var result = createBind(func, bitmask, thisArg);
      } else if (bitmask == WRAP_CURRY_FLAG || bitmask == WRAP_CURRY_RIGHT_FLAG) {
        result = createCurry(func, bitmask, arity);
      } else if ((bitmask == WRAP_PARTIAL_FLAG || bitmask == (WRAP_BIND_FLAG | WRAP_PARTIAL_FLAG)) && !holders.length) {
        result = createPartial(func, bitmask, thisArg, partials);
      } else {
        result = createHybrid.apply(undefined, newData);
      }
      var setter = data ? baseSetData : setData;
      return setWrapToString(setter(result, newData), func, bitmask);
    }

    /**
     * Used by `_.defaults` to customize its `_.assignIn` use to assign properties
     * of source objects to the destination object for all destination properties
     * that resolve to `undefined`.
     *
     * @private
     * @param {*} objValue The destination value.
     * @param {*} srcValue The source value.
     * @param {string} key The key of the property to assign.
     * @param {Object} object The parent object of `objValue`.
     * @returns {*} Returns the value to assign.
     */
    function customDefaultsAssignIn(objValue, srcValue, key, object) {
      if (objValue === undefined ||
          (eq(objValue, objectProto[key]) && !hasOwnProperty.call(object, key))) {
        return srcValue;
      }
      return objValue;
    }

    /**
     * Used by `_.defaultsDeep` to customize its `_.merge` use to merge source
     * objects into destination objects that are passed thru.
     *
     * @private
     * @param {*} objValue The destination value.
     * @param {*} srcValue The source value.
     * @param {string} key The key of the property to merge.
     * @param {Object} object The parent object of `objValue`.
     * @param {Object} source The parent object of `srcValue`.
     * @param {Object} [stack] Tracks traversed source values and their merged
     *  counterparts.
     * @returns {*} Returns the value to assign.
     */
    function customDefaultsMerge(objValue, srcValue, key, object, source, stack) {
      if (isObject(objValue) && isObject(srcValue)) {
        // Recursively merge objects and arrays (susceptible to call stack limits).
        stack.set(srcValue, objValue);
        baseMerge(objValue, srcValue, undefined, customDefaultsMerge, stack);
        stack['delete'](srcValue);
      }
      return objValue;
    }

    /**
     * Used by `_.omit` to customize its `_.cloneDeep` use to only clone plain
     * objects.
     *
     * @private
     * @param {*} value The value to inspect.
     * @param {string} key The key of the property to inspect.
     * @returns {*} Returns the uncloned value or `undefined` to defer cloning to `_.cloneDeep`.
     */
    function customOmitClone(value) {
      return isPlainObject(value) ? undefined : value;
    }

    /**
     * A specialized version of `baseIsEqualDeep` for arrays with support for
     * partial deep comparisons.
     *
     * @private
     * @param {Array} array The array to compare.
     * @param {Array} other The other array to compare.
     * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
     * @param {Function} customizer The function to customize comparisons.
     * @param {Function} equalFunc The function to determine equivalents of values.
     * @param {Object} stack Tracks traversed `array` and `other` objects.
     * @returns {boolean} Returns `true` if the arrays are equivalent, else `false`.
     */
    function equalArrays(array, other, bitmask, customizer, equalFunc, stack) {
      var isPartial = bitmask & COMPARE_PARTIAL_FLAG,
          arrLength = array.length,
          othLength = other.length;

      if (arrLength != othLength && !(isPartial && othLength > arrLength)) {
        return false;
      }
      // Assume cyclic values are equal.
      var stacked = stack.get(array);
      if (stacked && stack.get(other)) {
        return stacked == other;
      }
      var index = -1,
          result = true,
          seen = (bitmask & COMPARE_UNORDERED_FLAG) ? new SetCache : undefined;

      stack.set(array, other);
      stack.set(other, array);

      // Ignore non-index properties.
      while (++index < arrLength) {
        var arrValue = array[index],
            othValue = other[index];

        if (customizer) {
          var compared = isPartial
            ? customizer(othValue, arrValue, index, other, array, stack)
            : customizer(arrValue, othValue, index, array, other, stack);
        }
        if (compared !== undefined) {
          if (compared) {
            continue;
          }
          result = false;
          break;
        }
        // Recursively compare arrays (susceptible to call stack limits).
        if (seen) {
          if (!arraySome(other, function(othValue, othIndex) {
                if (!cacheHas(seen, othIndex) &&
                    (arrValue === othValue || equalFunc(arrValue, othValue, bitmask, customizer, stack))) {
                  return seen.push(othIndex);
                }
              })) {
            result = false;
            break;
          }
        } else if (!(
              arrValue === othValue ||
                equalFunc(arrValue, othValue, bitmask, customizer, stack)
            )) {
          result = false;
          break;
        }
      }
      stack['delete'](array);
      stack['delete'](other);
      return result;
    }

    /**
     * A specialized version of `baseIsEqualDeep` for comparing objects of
     * the same `toStringTag`.
     *
     * **Note:** This function only supports comparing values with tags of
     * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.
     *
     * @private
     * @param {Object} object The object to compare.
     * @param {Object} other The other object to compare.
     * @param {string} tag The `toStringTag` of the objects to compare.
     * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
     * @param {Function} customizer The function to customize comparisons.
     * @param {Function} equalFunc The function to determine equivalents of values.
     * @param {Object} stack Tracks traversed `object` and `other` objects.
     * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
     */
    function equalByTag(object, other, tag, bitmask, customizer, equalFunc, stack) {
      switch (tag) {
        case dataViewTag:
          if ((object.byteLength != other.byteLength) ||
              (object.byteOffset != other.byteOffset)) {
            return false;
          }
          object = object.buffer;
          other = other.buffer;

        case arrayBufferTag:
          if ((object.byteLength != other.byteLength) ||
              !equalFunc(new Uint8Array(object), new Uint8Array(other))) {
            return false;
          }
          return true;

        case boolTag:
        case dateTag:
        case numberTag:
          // Coerce booleans to `1` or `0` and dates to milliseconds.
          // Invalid dates are coerced to `NaN`.
          return eq(+object, +other);

        case errorTag:
          return object.name == other.name && object.message == other.message;

        case regexpTag:
        case stringTag:
          // Coerce regexes to strings and treat strings, primitives and objects,
          // as equal. See http://www.ecma-international.org/ecma-262/7.0/#sec-regexp.prototype.tostring
          // for more details.
          return object == (other + '');

        case mapTag:
          var convert = mapToArray;

        case setTag:
          var isPartial = bitmask & COMPARE_PARTIAL_FLAG;
          convert || (convert = setToArray);

          if (object.size != other.size && !isPartial) {
            return false;
          }
          // Assume cyclic values are equal.
          var stacked = stack.get(object);
          if (stacked) {
            return stacked == other;
          }
          bitmask |= COMPARE_UNORDERED_FLAG;

          // Recursively compare objects (susceptible to call stack limits).
          stack.set(object, other);
          var result = equalArrays(convert(object), convert(other), bitmask, customizer, equalFunc, stack);
          stack['delete'](object);
          return result;

        case symbolTag:
          if (symbolValueOf) {
            return symbolValueOf.call(object) == symbolValueOf.call(other);
          }
      }
      return false;
    }

    /**
     * A specialized version of `baseIsEqualDeep` for objects with support for
     * partial deep comparisons.
     *
     * @private
     * @param {Object} object The object to compare.
     * @param {Object} other The other object to compare.
     * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
     * @param {Function} customizer The function to customize comparisons.
     * @param {Function} equalFunc The function to determine equivalents of values.
     * @param {Object} stack Tracks traversed `object` and `other` objects.
     * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
     */
    function equalObjects(object, other, bitmask, customizer, equalFunc, stack) {
      var isPartial = bitmask & COMPARE_PARTIAL_FLAG,
          objProps = getAllKeys(object),
          objLength = objProps.length,
          othProps = getAllKeys(other),
          othLength = othProps.length;

      if (objLength != othLength && !isPartial) {
        return false;
      }
      var index = objLength;
      while (index--) {
        var key = objProps[index];
        if (!(isPartial ? key in other : hasOwnProperty.call(other, key))) {
          return false;
        }
      }
      // Assume cyclic values are equal.
      var stacked = stack.get(object);
      if (stacked && stack.get(other)) {
        return stacked == other;
      }
      var result = true;
      stack.set(object, other);
      stack.set(other, object);

      var skipCtor = isPartial;
      while (++index < objLength) {
        key = objProps[index];
        var objValue = object[key],
            othValue = other[key];

        if (customizer) {
          var compared = isPartial
            ? customizer(othValue, objValue, key, other, object, stack)
            : customizer(objValue, othValue, key, object, other, stack);
        }
        // Recursively compare objects (susceptible to call stack limits).
        if (!(compared === undefined
              ? (objValue === othValue || equalFunc(objValue, othValue, bitmask, customizer, stack))
              : compared
            )) {
          result = false;
          break;
        }
        skipCtor || (skipCtor = key == 'constructor');
      }
      if (result && !skipCtor) {
        var objCtor = object.constructor,
            othCtor = other.constructor;

        // Non `Object` object instances with different constructors are not equal.
        if (objCtor != othCtor &&
            ('constructor' in object && 'constructor' in other) &&
            !(typeof objCtor == 'function' && objCtor instanceof objCtor &&
              typeof othCtor == 'function' && othCtor instanceof othCtor)) {
          result = false;
        }
      }
      stack['delete'](object);
      stack['delete'](other);
      return result;
    }

    /**
     * A specialized version of `baseRest` which flattens the rest array.
     *
     * @private
     * @param {Function} func The function to apply a rest parameter to.
     * @returns {Function} Returns the new function.
     */
    function flatRest(func) {
      return setToString(overRest(func, undefined, flatten), func + '');
    }

    /**
     * Creates an array of own enumerable property names and symbols of `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property names and symbols.
     */
    function getAllKeys(object) {
      return baseGetAllKeys(object, keys, getSymbols);
    }

    /**
     * Creates an array of own and inherited enumerable property names and
     * symbols of `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property names and symbols.
     */
    function getAllKeysIn(object) {
      return baseGetAllKeys(object, keysIn, getSymbolsIn);
    }

    /**
     * Gets metadata for `func`.
     *
     * @private
     * @param {Function} func The function to query.
     * @returns {*} Returns the metadata for `func`.
     */
    var getData = !metaMap ? noop : function(func) {
      return metaMap.get(func);
    };

    /**
     * Gets the name of `func`.
     *
     * @private
     * @param {Function} func The function to query.
     * @returns {string} Returns the function name.
     */
    function getFuncName(func) {
      var result = (func.name + ''),
          array = realNames[result],
          length = hasOwnProperty.call(realNames, result) ? array.length : 0;

      while (length--) {
        var data = array[length],
            otherFunc = data.func;
        if (otherFunc == null || otherFunc == func) {
          return data.name;
        }
      }
      return result;
    }

    /**
     * Gets the argument placeholder value for `func`.
     *
     * @private
     * @param {Function} func The function to inspect.
     * @returns {*} Returns the placeholder value.
     */
    function getHolder(func) {
      var object = hasOwnProperty.call(lodash, 'placeholder') ? lodash : func;
      return object.placeholder;
    }

    /**
     * Gets the appropriate "iteratee" function. If `_.iteratee` is customized,
     * this function returns the custom method, otherwise it returns `baseIteratee`.
     * If arguments are provided, the chosen function is invoked with them and
     * its result is returned.
     *
     * @private
     * @param {*} [value] The value to convert to an iteratee.
     * @param {number} [arity] The arity of the created iteratee.
     * @returns {Function} Returns the chosen function or its result.
     */
    function getIteratee() {
      var result = lodash.iteratee || iteratee;
      result = result === iteratee ? baseIteratee : result;
      return arguments.length ? result(arguments[0], arguments[1]) : result;
    }

    /**
     * Gets the data for `map`.
     *
     * @private
     * @param {Object} map The map to query.
     * @param {string} key The reference key.
     * @returns {*} Returns the map data.
     */
    function getMapData(map, key) {
      var data = map.__data__;
      return isKeyable(key)
        ? data[typeof key == 'string' ? 'string' : 'hash']
        : data.map;
    }

    /**
     * Gets the property names, values, and compare flags of `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @returns {Array} Returns the match data of `object`.
     */
    function getMatchData(object) {
      var result = keys(object),
          length = result.length;

      while (length--) {
        var key = result[length],
            value = object[key];

        result[length] = [key, value, isStrictComparable(value)];
      }
      return result;
    }

    /**
     * Gets the native function at `key` of `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @param {string} key The key of the method to get.
     * @returns {*} Returns the function if it's native, else `undefined`.
     */
    function getNative(object, key) {
      var value = getValue(object, key);
      return baseIsNative(value) ? value : undefined;
    }

    /**
     * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.
     *
     * @private
     * @param {*} value The value to query.
     * @returns {string} Returns the raw `toStringTag`.
     */
    function getRawTag(value) {
      var isOwn = hasOwnProperty.call(value, symToStringTag),
          tag = value[symToStringTag];

      try {
        value[symToStringTag] = undefined;
        var unmasked = true;
      } catch (e) {}

      var result = nativeObjectToString.call(value);
      if (unmasked) {
        if (isOwn) {
          value[symToStringTag] = tag;
        } else {
          delete value[symToStringTag];
        }
      }
      return result;
    }

    /**
     * Creates an array of the own enumerable symbols of `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of symbols.
     */
    var getSymbols = !nativeGetSymbols ? stubArray : function(object) {
      if (object == null) {
        return [];
      }
      object = Object(object);
      return arrayFilter(nativeGetSymbols(object), function(symbol) {
        return propertyIsEnumerable.call(object, symbol);
      });
    };

    /**
     * Creates an array of the own and inherited enumerable symbols of `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of symbols.
     */
    var getSymbolsIn = !nativeGetSymbols ? stubArray : function(object) {
      var result = [];
      while (object) {
        arrayPush(result, getSymbols(object));
        object = getPrototype(object);
      }
      return result;
    };

    /**
     * Gets the `toStringTag` of `value`.
     *
     * @private
     * @param {*} value The value to query.
     * @returns {string} Returns the `toStringTag`.
     */
    var getTag = baseGetTag;

    // Fallback for data views, maps, sets, and weak maps in IE 11 and promises in Node.js < 6.
    if ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||
        (Map && getTag(new Map) != mapTag) ||
        (Promise && getTag(Promise.resolve()) != promiseTag) ||
        (Set && getTag(new Set) != setTag) ||
        (WeakMap && getTag(new WeakMap) != weakMapTag)) {
      getTag = function(value) {
        var result = baseGetTag(value),
            Ctor = result == objectTag ? value.constructor : undefined,
            ctorString = Ctor ? toSource(Ctor) : '';

        if (ctorString) {
          switch (ctorString) {
            case dataViewCtorString: return dataViewTag;
            case mapCtorString: return mapTag;
            case promiseCtorString: return promiseTag;
            case setCtorString: return setTag;
            case weakMapCtorString: return weakMapTag;
          }
        }
        return result;
      };
    }

    /**
     * Gets the view, applying any `transforms` to the `start` and `end` positions.
     *
     * @private
     * @param {number} start The start of the view.
     * @param {number} end The end of the view.
     * @param {Array} transforms The transformations to apply to the view.
     * @returns {Object} Returns an object containing the `start` and `end`
     *  positions of the view.
     */
    function getView(start, end, transforms) {
      var index = -1,
          length = transforms.length;

      while (++index < length) {
        var data = transforms[index],
            size = data.size;

        switch (data.type) {
          case 'drop':      start += size; break;
          case 'dropRight': end -= size; break;
          case 'take':      end = nativeMin(end, start + size); break;
          case 'takeRight': start = nativeMax(start, end - size); break;
        }
      }
      return { 'start': start, 'end': end };
    }

    /**
     * Extracts wrapper details from the `source` body comment.
     *
     * @private
     * @param {string} source The source to inspect.
     * @returns {Array} Returns the wrapper details.
     */
    function getWrapDetails(source) {
      var match = source.match(reWrapDetails);
      return match ? match[1].split(reSplitDetails) : [];
    }

    /**
     * Checks if `path` exists on `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @param {Array|string} path The path to check.
     * @param {Function} hasFunc The function to check properties.
     * @returns {boolean} Returns `true` if `path` exists, else `false`.
     */
    function hasPath(object, path, hasFunc) {
      path = castPath(path, object);

      var index = -1,
          length = path.length,
          result = false;

      while (++index < length) {
        var key = toKey(path[index]);
        if (!(result = object != null && hasFunc(object, key))) {
          break;
        }
        object = object[key];
      }
      if (result || ++index != length) {
        return result;
      }
      length = object == null ? 0 : object.length;
      return !!length && isLength(length) && isIndex(key, length) &&
        (isArray(object) || isArguments(object));
    }

    /**
     * Initializes an array clone.
     *
     * @private
     * @param {Array} array The array to clone.
     * @returns {Array} Returns the initialized clone.
     */
    function initCloneArray(array) {
      var length = array.length,
          result = array.constructor(length);

      // Add properties assigned by `RegExp#exec`.
      if (length && typeof array[0] == 'string' && hasOwnProperty.call(array, 'index')) {
        result.index = array.index;
        result.input = array.input;
      }
      return result;
    }

    /**
     * Initializes an object clone.
     *
     * @private
     * @param {Object} object The object to clone.
     * @returns {Object} Returns the initialized clone.
     */
    function initCloneObject(object) {
      return (typeof object.constructor == 'function' && !isPrototype(object))
        ? baseCreate(getPrototype(object))
        : {};
    }

    /**
     * Initializes an object clone based on its `toStringTag`.
     *
     * **Note:** This function only supports cloning values with tags of
     * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.
     *
     * @private
     * @param {Object} object The object to clone.
     * @param {string} tag The `toStringTag` of the object to clone.
     * @param {Function} cloneFunc The function to clone values.
     * @param {boolean} [isDeep] Specify a deep clone.
     * @returns {Object} Returns the initialized clone.
     */
    function initCloneByTag(object, tag, cloneFunc, isDeep) {
      var Ctor = object.constructor;
      switch (tag) {
        case arrayBufferTag:
          return cloneArrayBuffer(object);

        case boolTag:
        case dateTag:
          return new Ctor(+object);

        case dataViewTag:
          return cloneDataView(object, isDeep);

        case float32Tag: case float64Tag:
        case int8Tag: case int16Tag: case int32Tag:
        case uint8Tag: case uint8ClampedTag: case uint16Tag: case uint32Tag:
          return cloneTypedArray(object, isDeep);

        case mapTag:
          return cloneMap(object, isDeep, cloneFunc);

        case numberTag:
        case stringTag:
          return new Ctor(object);

        case regexpTag:
          return cloneRegExp(object);

        case setTag:
          return cloneSet(object, isDeep, cloneFunc);

        case symbolTag:
          return cloneSymbol(object);
      }
    }

    /**
     * Inserts wrapper `details` in a comment at the top of the `source` body.
     *
     * @private
     * @param {string} source The source to modify.
     * @returns {Array} details The details to insert.
     * @returns {string} Returns the modified source.
     */
    function insertWrapDetails(source, details) {
      var length = details.length;
      if (!length) {
        return source;
      }
      var lastIndex = length - 1;
      details[lastIndex] = (length > 1 ? '& ' : '') + details[lastIndex];
      details = details.join(length > 2 ? ', ' : ' ');
      return source.replace(reWrapComment, '{\n/* [wrapped with ' + details + '] */\n');
    }

    /**
     * Checks if `value` is a flattenable `arguments` object or array.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is flattenable, else `false`.
     */
    function isFlattenable(value) {
      return isArray(value) || isArguments(value) ||
        !!(spreadableSymbol && value && value[spreadableSymbol]);
    }

    /**
     * Checks if `value` is a valid array-like index.
     *
     * @private
     * @param {*} value The value to check.
     * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.
     * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.
     */
    function isIndex(value, length) {
      length = length == null ? MAX_SAFE_INTEGER : length;
      return !!length &&
        (typeof value == 'number' || reIsUint.test(value)) &&
        (value > -1 && value % 1 == 0 && value < length);
    }

    /**
     * Checks if the given arguments are from an iteratee call.
     *
     * @private
     * @param {*} value The potential iteratee value argument.
     * @param {*} index The potential iteratee index or key argument.
     * @param {*} object The potential iteratee object argument.
     * @returns {boolean} Returns `true` if the arguments are from an iteratee call,
     *  else `false`.
     */
    function isIterateeCall(value, index, object) {
      if (!isObject(object)) {
        return false;
      }
      var type = typeof index;
      if (type == 'number'
            ? (isArrayLike(object) && isIndex(index, object.length))
            : (type == 'string' && index in object)
          ) {
        return eq(object[index], value);
      }
      return false;
    }

    /**
     * Checks if `value` is a property name and not a property path.
     *
     * @private
     * @param {*} value The value to check.
     * @param {Object} [object] The object to query keys on.
     * @returns {boolean} Returns `true` if `value` is a property name, else `false`.
     */
    function isKey(value, object) {
      if (isArray(value)) {
        return false;
      }
      var type = typeof value;
      if (type == 'number' || type == 'symbol' || type == 'boolean' ||
          value == null || isSymbol(value)) {
        return true;
      }
      return reIsPlainProp.test(value) || !reIsDeepProp.test(value) ||
        (object != null && value in Object(object));
    }

    /**
     * Checks if `value` is suitable for use as unique object key.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is suitable, else `false`.
     */
    function isKeyable(value) {
      var type = typeof value;
      return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')
        ? (value !== '__proto__')
        : (value === null);
    }

    /**
     * Checks if `func` has a lazy counterpart.
     *
     * @private
     * @param {Function} func The function to check.
     * @returns {boolean} Returns `true` if `func` has a lazy counterpart,
     *  else `false`.
     */
    function isLaziable(func) {
      var funcName = getFuncName(func),
          other = lodash[funcName];

      if (typeof other != 'function' || !(funcName in LazyWrapper.prototype)) {
        return false;
      }
      if (func === other) {
        return true;
      }
      var data = getData(other);
      return !!data && func === data[0];
    }

    /**
     * Checks if `func` has its source masked.
     *
     * @private
     * @param {Function} func The function to check.
     * @returns {boolean} Returns `true` if `func` is masked, else `false`.
     */
    function isMasked(func) {
      return !!maskSrcKey && (maskSrcKey in func);
    }

    /**
     * Checks if `func` is capable of being masked.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `func` is maskable, else `false`.
     */
    var isMaskable = coreJsData ? isFunction : stubFalse;

    /**
     * Checks if `value` is likely a prototype object.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.
     */
    function isPrototype(value) {
      var Ctor = value && value.constructor,
          proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;

      return value === proto;
    }

    /**
     * Checks if `value` is suitable for strict equality comparisons, i.e. `===`.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` if suitable for strict
     *  equality comparisons, else `false`.
     */
    function isStrictComparable(value) {
      return value === value && !isObject(value);
    }

    /**
     * A specialized version of `matchesProperty` for source values suitable
     * for strict equality comparisons, i.e. `===`.
     *
     * @private
     * @param {string} key The key of the property to get.
     * @param {*} srcValue The value to match.
     * @returns {Function} Returns the new spec function.
     */
    function matchesStrictComparable(key, srcValue) {
      return function(object) {
        if (object == null) {
          return false;
        }
        return object[key] === srcValue &&
          (srcValue !== undefined || (key in Object(object)));
      };
    }

    /**
     * A specialized version of `_.memoize` which clears the memoized function's
     * cache when it exceeds `MAX_MEMOIZE_SIZE`.
     *
     * @private
     * @param {Function} func The function to have its output memoized.
     * @returns {Function} Returns the new memoized function.
     */
    function memoizeCapped(func) {
      var result = memoize(func, function(key) {
        if (cache.size === MAX_MEMOIZE_SIZE) {
          cache.clear();
        }
        return key;
      });

      var cache = result.cache;
      return result;
    }

    /**
     * Merges the function metadata of `source` into `data`.
     *
     * Merging metadata reduces the number of wrappers used to invoke a function.
     * This is possible because methods like `_.bind`, `_.curry`, and `_.partial`
     * may be applied regardless of execution order. Methods like `_.ary` and
     * `_.rearg` modify function arguments, making the order in which they are
     * executed important, preventing the merging of metadata. However, we make
     * an exception for a safe combined case where curried functions have `_.ary`
     * and or `_.rearg` applied.
     *
     * @private
     * @param {Array} data The destination metadata.
     * @param {Array} source The source metadata.
     * @returns {Array} Returns `data`.
     */
    function mergeData(data, source) {
      var bitmask = data[1],
          srcBitmask = source[1],
          newBitmask = bitmask | srcBitmask,
          isCommon = newBitmask < (WRAP_BIND_FLAG | WRAP_BIND_KEY_FLAG | WRAP_ARY_FLAG);

      var isCombo =
        ((srcBitmask == WRAP_ARY_FLAG) && (bitmask == WRAP_CURRY_FLAG)) ||
        ((srcBitmask == WRAP_ARY_FLAG) && (bitmask == WRAP_REARG_FLAG) && (data[7].length <= source[8])) ||
        ((srcBitmask == (WRAP_ARY_FLAG | WRAP_REARG_FLAG)) && (source[7].length <= source[8]) && (bitmask == WRAP_CURRY_FLAG));

      // Exit early if metadata can't be merged.
      if (!(isCommon || isCombo)) {
        return data;
      }
      // Use source `thisArg` if available.
      if (srcBitmask & WRAP_BIND_FLAG) {
        data[2] = source[2];
        // Set when currying a bound function.
        newBitmask |= bitmask & WRAP_BIND_FLAG ? 0 : WRAP_CURRY_BOUND_FLAG;
      }
      // Compose partial arguments.
      var value = source[3];
      if (value) {
        var partials = data[3];
        data[3] = partials ? composeArgs(partials, value, source[4]) : value;
        data[4] = partials ? replaceHolders(data[3], PLACEHOLDER) : source[4];
      }
      // Compose partial right arguments.
      value = source[5];
      if (value) {
        partials = data[5];
        data[5] = partials ? composeArgsRight(partials, value, source[6]) : value;
        data[6] = partials ? replaceHolders(data[5], PLACEHOLDER) : source[6];
      }
      // Use source `argPos` if available.
      value = source[7];
      if (value) {
        data[7] = value;
      }
      // Use source `ary` if it's smaller.
      if (srcBitmask & WRAP_ARY_FLAG) {
        data[8] = data[8] == null ? source[8] : nativeMin(data[8], source[8]);
      }
      // Use source `arity` if one is not provided.
      if (data[9] == null) {
        data[9] = source[9];
      }
      // Use source `func` and merge bitmasks.
      data[0] = source[0];
      data[1] = newBitmask;

      return data;
    }

    /**
     * This function is like
     * [`Object.keys`](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)
     * except that it includes inherited enumerable properties.
     *
     * @private
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property names.
     */
    function nativeKeysIn(object) {
      var result = [];
      if (object != null) {
        for (var key in Object(object)) {
          result.push(key);
        }
      }
      return result;
    }

    /**
     * Converts `value` to a string using `Object.prototype.toString`.
     *
     * @private
     * @param {*} value The value to convert.
     * @returns {string} Returns the converted string.
     */
    function objectToString(value) {
      return nativeObjectToString.call(value);
    }

    /**
     * A specialized version of `baseRest` which transforms the rest array.
     *
     * @private
     * @param {Function} func The function to apply a rest parameter to.
     * @param {number} [start=func.length-1] The start position of the rest parameter.
     * @param {Function} transform The rest array transform.
     * @returns {Function} Returns the new function.
     */
    function overRest(func, start, transform) {
      start = nativeMax(start === undefined ? (func.length - 1) : start, 0);
      return function() {
        var args = arguments,
            index = -1,
            length = nativeMax(args.length - start, 0),
            array = Array(length);

        while (++index < length) {
          array[index] = args[start + index];
        }
        index = -1;
        var otherArgs = Array(start + 1);
        while (++index < start) {
          otherArgs[index] = args[index];
        }
        otherArgs[start] = transform(array);
        return apply(func, this, otherArgs);
      };
    }

    /**
     * Gets the parent value at `path` of `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @param {Array} path The path to get the parent value of.
     * @returns {*} Returns the parent value.
     */
    function parent(object, path) {
      return path.length < 2 ? object : baseGet(object, baseSlice(path, 0, -1));
    }

    /**
     * Reorder `array` according to the specified indexes where the element at
     * the first index is assigned as the first element, the element at
     * the second index is assigned as the second element, and so on.
     *
     * @private
     * @param {Array} array The array to reorder.
     * @param {Array} indexes The arranged array indexes.
     * @returns {Array} Returns `array`.
     */
    function reorder(array, indexes) {
      var arrLength = array.length,
          length = nativeMin(indexes.length, arrLength),
          oldArray = copyArray(array);

      while (length--) {
        var index = indexes[length];
        array[length] = isIndex(index, arrLength) ? oldArray[index] : undefined;
      }
      return array;
    }

    /**
     * Sets metadata for `func`.
     *
     * **Note:** If this function becomes hot, i.e. is invoked a lot in a short
     * period of time, it will trip its breaker and transition to an identity
     * function to avoid garbage collection pauses in V8. See
     * [V8 issue 2070](https://bugs.chromium.org/p/v8/issues/detail?id=2070)
     * for more details.
     *
     * @private
     * @param {Function} func The function to associate metadata with.
     * @param {*} data The metadata.
     * @returns {Function} Returns `func`.
     */
    var setData = shortOut(baseSetData);

    /**
     * A simple wrapper around the global [`setTimeout`](https://mdn.io/setTimeout).
     *
     * @private
     * @param {Function} func The function to delay.
     * @param {number} wait The number of milliseconds to delay invocation.
     * @returns {number|Object} Returns the timer id or timeout object.
     */
    var setTimeout = ctxSetTimeout || function(func, wait) {
      return root.setTimeout(func, wait);
    };

    /**
     * Sets the `toString` method of `func` to return `string`.
     *
     * @private
     * @param {Function} func The function to modify.
     * @param {Function} string The `toString` result.
     * @returns {Function} Returns `func`.
     */
    var setToString = shortOut(baseSetToString);

    /**
     * Sets the `toString` method of `wrapper` to mimic the source of `reference`
     * with wrapper details in a comment at the top of the source body.
     *
     * @private
     * @param {Function} wrapper The function to modify.
     * @param {Function} reference The reference function.
     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.
     * @returns {Function} Returns `wrapper`.
     */
    function setWrapToString(wrapper, reference, bitmask) {
      var source = (reference + '');
      return setToString(wrapper, insertWrapDetails(source, updateWrapDetails(getWrapDetails(source), bitmask)));
    }

    /**
     * Creates a function that'll short out and invoke `identity` instead
     * of `func` when it's called `HOT_COUNT` or more times in `HOT_SPAN`
     * milliseconds.
     *
     * @private
     * @param {Function} func The function to restrict.
     * @returns {Function} Returns the new shortable function.
     */
    function shortOut(func) {
      var count = 0,
          lastCalled = 0;

      return function() {
        var stamp = nativeNow(),
            remaining = HOT_SPAN - (stamp - lastCalled);

        lastCalled = stamp;
        if (remaining > 0) {
          if (++count >= HOT_COUNT) {
            return arguments[0];
          }
        } else {
          count = 0;
        }
        return func.apply(undefined, arguments);
      };
    }

    /**
     * A specialized version of `_.shuffle` which mutates and sets the size of `array`.
     *
     * @private
     * @param {Array} array The array to shuffle.
     * @param {number} [size=array.length] The size of `array`.
     * @returns {Array} Returns `array`.
     */
    function shuffleSelf(array, size) {
      var index = -1,
          length = array.length,
          lastIndex = length - 1;

      size = size === undefined ? length : size;
      while (++index < size) {
        var rand = baseRandom(index, lastIndex),
            value = array[rand];

        array[rand] = array[index];
        array[index] = value;
      }
      array.length = size;
      return array;
    }

    /**
     * Converts `string` to a property path array.
     *
     * @private
     * @param {string} string The string to convert.
     * @returns {Array} Returns the property path array.
     */
    var stringToPath = memoizeCapped(function(string) {
      var result = [];
      if (reLeadingDot.test(string)) {
        result.push('');
      }
      string.replace(rePropName, function(match, number, quote, string) {
        result.push(quote ? string.replace(reEscapeChar, '$1') : (number || match));
      });
      return result;
    });

    /**
     * Converts `value` to a string key if it's not a string or symbol.
     *
     * @private
     * @param {*} value The value to inspect.
     * @returns {string|symbol} Returns the key.
     */
    function toKey(value) {
      if (typeof value == 'string' || isSymbol(value)) {
        return value;
      }
      var result = (value + '');
      return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;
    }

    /**
     * Converts `func` to its source code.
     *
     * @private
     * @param {Function} func The function to convert.
     * @returns {string} Returns the source code.
     */
    function toSource(func) {
      if (func != null) {
        try {
          return funcToString.call(func);
        } catch (e) {}
        try {
          return (func + '');
        } catch (e) {}
      }
      return '';
    }

    /**
     * Updates wrapper `details` based on `bitmask` flags.
     *
     * @private
     * @returns {Array} details The details to modify.
     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.
     * @returns {Array} Returns `details`.
     */
    function updateWrapDetails(details, bitmask) {
      arrayEach(wrapFlags, function(pair) {
        var value = '_.' + pair[0];
        if ((bitmask & pair[1]) && !arrayIncludes(details, value)) {
          details.push(value);
        }
      });
      return details.sort();
    }

    /**
     * Creates a clone of `wrapper`.
     *
     * @private
     * @param {Object} wrapper The wrapper to clone.
     * @returns {Object} Returns the cloned wrapper.
     */
    function wrapperClone(wrapper) {
      if (wrapper instanceof LazyWrapper) {
        return wrapper.clone();
      }
      var result = new LodashWrapper(wrapper.__wrapped__, wrapper.__chain__);
      result.__actions__ = copyArray(wrapper.__actions__);
      result.__index__  = wrapper.__index__;
      result.__values__ = wrapper.__values__;
      return result;
    }

    /*------------------------------------------------------------------------*/

    /**
     * Creates an array of elements split into groups the length of `size`.
     * If `array` can't be split evenly, the final chunk will be the remaining
     * elements.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to process.
     * @param {number} [size=1] The length of each chunk
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Array} Returns the new array of chunks.
     * @example
     *
     * _.chunk(['a', 'b', 'c', 'd'], 2);
     * // => [['a', 'b'], ['c', 'd']]
     *
     * _.chunk(['a', 'b', 'c', 'd'], 3);
     * // => [['a', 'b', 'c'], ['d']]
     */
    function chunk(array, size, guard) {
      if ((guard ? isIterateeCall(array, size, guard) : size === undefined)) {
        size = 1;
      } else {
        size = nativeMax(toInteger(size), 0);
      }
      var length = array == null ? 0 : array.length;
      if (!length || size < 1) {
        return [];
      }
      var index = 0,
          resIndex = 0,
          result = Array(nativeCeil(length / size));

      while (index < length) {
        result[resIndex++] = baseSlice(array, index, (index += size));
      }
      return result;
    }

    /**
     * Creates an array with all falsey values removed. The values `false`, `null`,
     * `0`, `""`, `undefined`, and `NaN` are falsey.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to compact.
     * @returns {Array} Returns the new array of filtered values.
     * @example
     *
     * _.compact([0, 1, false, 2, '', 3]);
     * // => [1, 2, 3]
     */
    function compact(array) {
      var index = -1,
          length = array == null ? 0 : array.length,
          resIndex = 0,
          result = [];

      while (++index < length) {
        var value = array[index];
        if (value) {
          result[resIndex++] = value;
        }
      }
      return result;
    }

    /**
     * Creates a new array concatenating `array` with any additional arrays
     * and/or values.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to concatenate.
     * @param {...*} [values] The values to concatenate.
     * @returns {Array} Returns the new concatenated array.
     * @example
     *
     * var array = [1];
     * var other = _.concat(array, 2, [3], [[4]]);
     *
     * console.log(other);
     * // => [1, 2, 3, [4]]
     *
     * console.log(array);
     * // => [1]
     */
    function concat() {
      var length = arguments.length;
      if (!length) {
        return [];
      }
      var args = Array(length - 1),
          array = arguments[0],
          index = length;

      while (index--) {
        args[index - 1] = arguments[index];
      }
      return arrayPush(isArray(array) ? copyArray(array) : [array], baseFlatten(args, 1));
    }

    /**
     * Creates an array of `array` values not included in the other given arrays
     * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * for equality comparisons. The order and references of result values are
     * determined by the first array.
     *
     * **Note:** Unlike `_.pullAll`, this method returns a new array.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {...Array} [values] The values to exclude.
     * @returns {Array} Returns the new array of filtered values.
     * @see _.without, _.xor
     * @example
     *
     * _.difference([2, 1], [2, 3]);
     * // => [1]
     */
    var difference = baseRest(function(array, values) {
      return isArrayLikeObject(array)
        ? baseDifference(array, baseFlatten(values, 1, isArrayLikeObject, true))
        : [];
    });

    /**
     * This method is like `_.difference` except that it accepts `iteratee` which
     * is invoked for each element of `array` and `values` to generate the criterion
     * by which they're compared. The order and references of result values are
     * determined by the first array. The iteratee is invoked with one argument:
     * (value).
     *
     * **Note:** Unlike `_.pullAllBy`, this method returns a new array.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {...Array} [values] The values to exclude.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {Array} Returns the new array of filtered values.
     * @example
     *
     * _.differenceBy([2.1, 1.2], [2.3, 3.4], Math.floor);
     * // => [1.2]
     *
     * // The `_.property` iteratee shorthand.
     * _.differenceBy([{ 'x': 2 }, { 'x': 1 }], [{ 'x': 1 }], 'x');
     * // => [{ 'x': 2 }]
     */
    var differenceBy = baseRest(function(array, values) {
      var iteratee = last(values);
      if (isArrayLikeObject(iteratee)) {
        iteratee = undefined;
      }
      return isArrayLikeObject(array)
        ? baseDifference(array, baseFlatten(values, 1, isArrayLikeObject, true), getIteratee(iteratee, 2))
        : [];
    });

    /**
     * This method is like `_.difference` except that it accepts `comparator`
     * which is invoked to compare elements of `array` to `values`. The order and
     * references of result values are determined by the first array. The comparator
     * is invoked with two arguments: (arrVal, othVal).
     *
     * **Note:** Unlike `_.pullAllWith`, this method returns a new array.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {...Array} [values] The values to exclude.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new array of filtered values.
     * @example
     *
     * var objects = [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }];
     *
     * _.differenceWith(objects, [{ 'x': 1, 'y': 2 }], _.isEqual);
     * // => [{ 'x': 2, 'y': 1 }]
     */
    var differenceWith = baseRest(function(array, values) {
      var comparator = last(values);
      if (isArrayLikeObject(comparator)) {
        comparator = undefined;
      }
      return isArrayLikeObject(array)
        ? baseDifference(array, baseFlatten(values, 1, isArrayLikeObject, true), undefined, comparator)
        : [];
    });

    /**
     * Creates a slice of `array` with `n` elements dropped from the beginning.
     *
     * @static
     * @memberOf _
     * @since 0.5.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {number} [n=1] The number of elements to drop.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.drop([1, 2, 3]);
     * // => [2, 3]
     *
     * _.drop([1, 2, 3], 2);
     * // => [3]
     *
     * _.drop([1, 2, 3], 5);
     * // => []
     *
     * _.drop([1, 2, 3], 0);
     * // => [1, 2, 3]
     */
    function drop(array, n, guard) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return [];
      }
      n = (guard || n === undefined) ? 1 : toInteger(n);
      return baseSlice(array, n < 0 ? 0 : n, length);
    }

    /**
     * Creates a slice of `array` with `n` elements dropped from the end.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {number} [n=1] The number of elements to drop.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.dropRight([1, 2, 3]);
     * // => [1, 2]
     *
     * _.dropRight([1, 2, 3], 2);
     * // => [1]
     *
     * _.dropRight([1, 2, 3], 5);
     * // => []
     *
     * _.dropRight([1, 2, 3], 0);
     * // => [1, 2, 3]
     */
    function dropRight(array, n, guard) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return [];
      }
      n = (guard || n === undefined) ? 1 : toInteger(n);
      n = length - n;
      return baseSlice(array, 0, n < 0 ? 0 : n);
    }

    /**
     * Creates a slice of `array` excluding elements dropped from the end.
     * Elements are dropped until `predicate` returns falsey. The predicate is
     * invoked with three arguments: (value, index, array).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'active': true },
     *   { 'user': 'fred',    'active': false },
     *   { 'user': 'pebbles', 'active': false }
     * ];
     *
     * _.dropRightWhile(users, function(o) { return !o.active; });
     * // => objects for ['barney']
     *
     * // The `_.matches` iteratee shorthand.
     * _.dropRightWhile(users, { 'user': 'pebbles', 'active': false });
     * // => objects for ['barney', 'fred']
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.dropRightWhile(users, ['active', false]);
     * // => objects for ['barney']
     *
     * // The `_.property` iteratee shorthand.
     * _.dropRightWhile(users, 'active');
     * // => objects for ['barney', 'fred', 'pebbles']
     */
    function dropRightWhile(array, predicate) {
      return (array && array.length)
        ? baseWhile(array, getIteratee(predicate, 3), true, true)
        : [];
    }

    /**
     * Creates a slice of `array` excluding elements dropped from the beginning.
     * Elements are dropped until `predicate` returns falsey. The predicate is
     * invoked with three arguments: (value, index, array).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'active': false },
     *   { 'user': 'fred',    'active': false },
     *   { 'user': 'pebbles', 'active': true }
     * ];
     *
     * _.dropWhile(users, function(o) { return !o.active; });
     * // => objects for ['pebbles']
     *
     * // The `_.matches` iteratee shorthand.
     * _.dropWhile(users, { 'user': 'barney', 'active': false });
     * // => objects for ['fred', 'pebbles']
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.dropWhile(users, ['active', false]);
     * // => objects for ['pebbles']
     *
     * // The `_.property` iteratee shorthand.
     * _.dropWhile(users, 'active');
     * // => objects for ['barney', 'fred', 'pebbles']
     */
    function dropWhile(array, predicate) {
      return (array && array.length)
        ? baseWhile(array, getIteratee(predicate, 3), true)
        : [];
    }

    /**
     * Fills elements of `array` with `value` from `start` up to, but not
     * including, `end`.
     *
     * **Note:** This method mutates `array`.
     *
     * @static
     * @memberOf _
     * @since 3.2.0
     * @category Array
     * @param {Array} array The array to fill.
     * @param {*} value The value to fill `array` with.
     * @param {number} [start=0] The start position.
     * @param {number} [end=array.length] The end position.
     * @returns {Array} Returns `array`.
     * @example
     *
     * var array = [1, 2, 3];
     *
     * _.fill(array, 'a');
     * console.log(array);
     * // => ['a', 'a', 'a']
     *
     * _.fill(Array(3), 2);
     * // => [2, 2, 2]
     *
     * _.fill([4, 6, 8, 10], '*', 1, 3);
     * // => [4, '*', '*', 10]
     */
    function fill(array, value, start, end) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return [];
      }
      if (start && typeof start != 'number' && isIterateeCall(array, value, start)) {
        start = 0;
        end = length;
      }
      return baseFill(array, value, start, end);
    }

    /**
     * This method is like `_.find` except that it returns the index of the first
     * element `predicate` returns truthy for instead of the element itself.
     *
     * @static
     * @memberOf _
     * @since 1.1.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @param {number} [fromIndex=0] The index to search from.
     * @returns {number} Returns the index of the found element, else `-1`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'active': false },
     *   { 'user': 'fred',    'active': false },
     *   { 'user': 'pebbles', 'active': true }
     * ];
     *
     * _.findIndex(users, function(o) { return o.user == 'barney'; });
     * // => 0
     *
     * // The `_.matches` iteratee shorthand.
     * _.findIndex(users, { 'user': 'fred', 'active': false });
     * // => 1
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.findIndex(users, ['active', false]);
     * // => 0
     *
     * // The `_.property` iteratee shorthand.
     * _.findIndex(users, 'active');
     * // => 2
     */
    function findIndex(array, predicate, fromIndex) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return -1;
      }
      var index = fromIndex == null ? 0 : toInteger(fromIndex);
      if (index < 0) {
        index = nativeMax(length + index, 0);
      }
      return baseFindIndex(array, getIteratee(predicate, 3), index);
    }

    /**
     * This method is like `_.findIndex` except that it iterates over elements
     * of `collection` from right to left.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @param {number} [fromIndex=array.length-1] The index to search from.
     * @returns {number} Returns the index of the found element, else `-1`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'active': true },
     *   { 'user': 'fred',    'active': false },
     *   { 'user': 'pebbles', 'active': false }
     * ];
     *
     * _.findLastIndex(users, function(o) { return o.user == 'pebbles'; });
     * // => 2
     *
     * // The `_.matches` iteratee shorthand.
     * _.findLastIndex(users, { 'user': 'barney', 'active': true });
     * // => 0
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.findLastIndex(users, ['active', false]);
     * // => 2
     *
     * // The `_.property` iteratee shorthand.
     * _.findLastIndex(users, 'active');
     * // => 0
     */
    function findLastIndex(array, predicate, fromIndex) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return -1;
      }
      var index = length - 1;
      if (fromIndex !== undefined) {
        index = toInteger(fromIndex);
        index = fromIndex < 0
          ? nativeMax(length + index, 0)
          : nativeMin(index, length - 1);
      }
      return baseFindIndex(array, getIteratee(predicate, 3), index, true);
    }

    /**
     * Flattens `array` a single level deep.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to flatten.
     * @returns {Array} Returns the new flattened array.
     * @example
     *
     * _.flatten([1, [2, [3, [4]], 5]]);
     * // => [1, 2, [3, [4]], 5]
     */
    function flatten(array) {
      var length = array == null ? 0 : array.length;
      return length ? baseFlatten(array, 1) : [];
    }

    /**
     * Recursively flattens `array`.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to flatten.
     * @returns {Array} Returns the new flattened array.
     * @example
     *
     * _.flattenDeep([1, [2, [3, [4]], 5]]);
     * // => [1, 2, 3, 4, 5]
     */
    function flattenDeep(array) {
      var length = array == null ? 0 : array.length;
      return length ? baseFlatten(array, INFINITY) : [];
    }

    /**
     * Recursively flatten `array` up to `depth` times.
     *
     * @static
     * @memberOf _
     * @since 4.4.0
     * @category Array
     * @param {Array} array The array to flatten.
     * @param {number} [depth=1] The maximum recursion depth.
     * @returns {Array} Returns the new flattened array.
     * @example
     *
     * var array = [1, [2, [3, [4]], 5]];
     *
     * _.flattenDepth(array, 1);
     * // => [1, 2, [3, [4]], 5]
     *
     * _.flattenDepth(array, 2);
     * // => [1, 2, 3, [4], 5]
     */
    function flattenDepth(array, depth) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return [];
      }
      depth = depth === undefined ? 1 : toInteger(depth);
      return baseFlatten(array, depth);
    }

    /**
     * The inverse of `_.toPairs`; this method returns an object composed
     * from key-value `pairs`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} pairs The key-value pairs.
     * @returns {Object} Returns the new object.
     * @example
     *
     * _.fromPairs([['a', 1], ['b', 2]]);
     * // => { 'a': 1, 'b': 2 }
     */
    function fromPairs(pairs) {
      var index = -1,
          length = pairs == null ? 0 : pairs.length,
          result = {};

      while (++index < length) {
        var pair = pairs[index];
        result[pair[0]] = pair[1];
      }
      return result;
    }

    /**
     * Gets the first element of `array`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @alias first
     * @category Array
     * @param {Array} array The array to query.
     * @returns {*} Returns the first element of `array`.
     * @example
     *
     * _.head([1, 2, 3]);
     * // => 1
     *
     * _.head([]);
     * // => undefined
     */
    function head(array) {
      return (array && array.length) ? array[0] : undefined;
    }

    /**
     * Gets the index at which the first occurrence of `value` is found in `array`
     * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * for equality comparisons. If `fromIndex` is negative, it's used as the
     * offset from the end of `array`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {*} value The value to search for.
     * @param {number} [fromIndex=0] The index to search from.
     * @returns {number} Returns the index of the matched value, else `-1`.
     * @example
     *
     * _.indexOf([1, 2, 1, 2], 2);
     * // => 1
     *
     * // Search from the `fromIndex`.
     * _.indexOf([1, 2, 1, 2], 2, 2);
     * // => 3
     */
    function indexOf(array, value, fromIndex) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return -1;
      }
      var index = fromIndex == null ? 0 : toInteger(fromIndex);
      if (index < 0) {
        index = nativeMax(length + index, 0);
      }
      return baseIndexOf(array, value, index);
    }

    /**
     * Gets all but the last element of `array`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to query.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.initial([1, 2, 3]);
     * // => [1, 2]
     */
    function initial(array) {
      var length = array == null ? 0 : array.length;
      return length ? baseSlice(array, 0, -1) : [];
    }

    /**
     * Creates an array of unique values that are included in all given arrays
     * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * for equality comparisons. The order and references of result values are
     * determined by the first array.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @returns {Array} Returns the new array of intersecting values.
     * @example
     *
     * _.intersection([2, 1], [2, 3]);
     * // => [2]
     */
    var intersection = baseRest(function(arrays) {
      var mapped = arrayMap(arrays, castArrayLikeObject);
      return (mapped.length && mapped[0] === arrays[0])
        ? baseIntersection(mapped)
        : [];
    });

    /**
     * This method is like `_.intersection` except that it accepts `iteratee`
     * which is invoked for each element of each `arrays` to generate the criterion
     * by which they're compared. The order and references of result values are
     * determined by the first array. The iteratee is invoked with one argument:
     * (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {Array} Returns the new array of intersecting values.
     * @example
     *
     * _.intersectionBy([2.1, 1.2], [2.3, 3.4], Math.floor);
     * // => [2.1]
     *
     * // The `_.property` iteratee shorthand.
     * _.intersectionBy([{ 'x': 1 }], [{ 'x': 2 }, { 'x': 1 }], 'x');
     * // => [{ 'x': 1 }]
     */
    var intersectionBy = baseRest(function(arrays) {
      var iteratee = last(arrays),
          mapped = arrayMap(arrays, castArrayLikeObject);

      if (iteratee === last(mapped)) {
        iteratee = undefined;
      } else {
        mapped.pop();
      }
      return (mapped.length && mapped[0] === arrays[0])
        ? baseIntersection(mapped, getIteratee(iteratee, 2))
        : [];
    });

    /**
     * This method is like `_.intersection` except that it accepts `comparator`
     * which is invoked to compare elements of `arrays`. The order and references
     * of result values are determined by the first array. The comparator is
     * invoked with two arguments: (arrVal, othVal).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new array of intersecting values.
     * @example
     *
     * var objects = [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }];
     * var others = [{ 'x': 1, 'y': 1 }, { 'x': 1, 'y': 2 }];
     *
     * _.intersectionWith(objects, others, _.isEqual);
     * // => [{ 'x': 1, 'y': 2 }]
     */
    var intersectionWith = baseRest(function(arrays) {
      var comparator = last(arrays),
          mapped = arrayMap(arrays, castArrayLikeObject);

      comparator = typeof comparator == 'function' ? comparator : undefined;
      if (comparator) {
        mapped.pop();
      }
      return (mapped.length && mapped[0] === arrays[0])
        ? baseIntersection(mapped, undefined, comparator)
        : [];
    });

    /**
     * Converts all elements in `array` into a string separated by `separator`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to convert.
     * @param {string} [separator=','] The element separator.
     * @returns {string} Returns the joined string.
     * @example
     *
     * _.join(['a', 'b', 'c'], '~');
     * // => 'a~b~c'
     */
    function join(array, separator) {
      return array == null ? '' : nativeJoin.call(array, separator);
    }

    /**
     * Gets the last element of `array`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to query.
     * @returns {*} Returns the last element of `array`.
     * @example
     *
     * _.last([1, 2, 3]);
     * // => 3
     */
    function last(array) {
      var length = array == null ? 0 : array.length;
      return length ? array[length - 1] : undefined;
    }

    /**
     * This method is like `_.indexOf` except that it iterates over elements of
     * `array` from right to left.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {*} value The value to search for.
     * @param {number} [fromIndex=array.length-1] The index to search from.
     * @returns {number} Returns the index of the matched value, else `-1`.
     * @example
     *
     * _.lastIndexOf([1, 2, 1, 2], 2);
     * // => 3
     *
     * // Search from the `fromIndex`.
     * _.lastIndexOf([1, 2, 1, 2], 2, 2);
     * // => 1
     */
    function lastIndexOf(array, value, fromIndex) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return -1;
      }
      var index = length;
      if (fromIndex !== undefined) {
        index = toInteger(fromIndex);
        index = index < 0 ? nativeMax(length + index, 0) : nativeMin(index, length - 1);
      }
      return value === value
        ? strictLastIndexOf(array, value, index)
        : baseFindIndex(array, baseIsNaN, index, true);
    }

    /**
     * Gets the element at index `n` of `array`. If `n` is negative, the nth
     * element from the end is returned.
     *
     * @static
     * @memberOf _
     * @since 4.11.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {number} [n=0] The index of the element to return.
     * @returns {*} Returns the nth element of `array`.
     * @example
     *
     * var array = ['a', 'b', 'c', 'd'];
     *
     * _.nth(array, 1);
     * // => 'b'
     *
     * _.nth(array, -2);
     * // => 'c';
     */
    function nth(array, n) {
      return (array && array.length) ? baseNth(array, toInteger(n)) : undefined;
    }

    /**
     * Removes all given values from `array` using
     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * for equality comparisons.
     *
     * **Note:** Unlike `_.without`, this method mutates `array`. Use `_.remove`
     * to remove elements from an array by predicate.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Array
     * @param {Array} array The array to modify.
     * @param {...*} [values] The values to remove.
     * @returns {Array} Returns `array`.
     * @example
     *
     * var array = ['a', 'b', 'c', 'a', 'b', 'c'];
     *
     * _.pull(array, 'a', 'c');
     * console.log(array);
     * // => ['b', 'b']
     */
    var pull = baseRest(pullAll);

    /**
     * This method is like `_.pull` except that it accepts an array of values to remove.
     *
     * **Note:** Unlike `_.difference`, this method mutates `array`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to modify.
     * @param {Array} values The values to remove.
     * @returns {Array} Returns `array`.
     * @example
     *
     * var array = ['a', 'b', 'c', 'a', 'b', 'c'];
     *
     * _.pullAll(array, ['a', 'c']);
     * console.log(array);
     * // => ['b', 'b']
     */
    function pullAll(array, values) {
      return (array && array.length && values && values.length)
        ? basePullAll(array, values)
        : array;
    }

    /**
     * This method is like `_.pullAll` except that it accepts `iteratee` which is
     * invoked for each element of `array` and `values` to generate the criterion
     * by which they're compared. The iteratee is invoked with one argument: (value).
     *
     * **Note:** Unlike `_.differenceBy`, this method mutates `array`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to modify.
     * @param {Array} values The values to remove.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {Array} Returns `array`.
     * @example
     *
     * var array = [{ 'x': 1 }, { 'x': 2 }, { 'x': 3 }, { 'x': 1 }];
     *
     * _.pullAllBy(array, [{ 'x': 1 }, { 'x': 3 }], 'x');
     * console.log(array);
     * // => [{ 'x': 2 }]
     */
    function pullAllBy(array, values, iteratee) {
      return (array && array.length && values && values.length)
        ? basePullAll(array, values, getIteratee(iteratee, 2))
        : array;
    }

    /**
     * This method is like `_.pullAll` except that it accepts `comparator` which
     * is invoked to compare elements of `array` to `values`. The comparator is
     * invoked with two arguments: (arrVal, othVal).
     *
     * **Note:** Unlike `_.differenceWith`, this method mutates `array`.
     *
     * @static
     * @memberOf _
     * @since 4.6.0
     * @category Array
     * @param {Array} array The array to modify.
     * @param {Array} values The values to remove.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns `array`.
     * @example
     *
     * var array = [{ 'x': 1, 'y': 2 }, { 'x': 3, 'y': 4 }, { 'x': 5, 'y': 6 }];
     *
     * _.pullAllWith(array, [{ 'x': 3, 'y': 4 }], _.isEqual);
     * console.log(array);
     * // => [{ 'x': 1, 'y': 2 }, { 'x': 5, 'y': 6 }]
     */
    function pullAllWith(array, values, comparator) {
      return (array && array.length && values && values.length)
        ? basePullAll(array, values, undefined, comparator)
        : array;
    }

    /**
     * Removes elements from `array` corresponding to `indexes` and returns an
     * array of removed elements.
     *
     * **Note:** Unlike `_.at`, this method mutates `array`.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to modify.
     * @param {...(number|number[])} [indexes] The indexes of elements to remove.
     * @returns {Array} Returns the new array of removed elements.
     * @example
     *
     * var array = ['a', 'b', 'c', 'd'];
     * var pulled = _.pullAt(array, [1, 3]);
     *
     * console.log(array);
     * // => ['a', 'c']
     *
     * console.log(pulled);
     * // => ['b', 'd']
     */
    var pullAt = flatRest(function(array, indexes) {
      var length = array == null ? 0 : array.length,
          result = baseAt(array, indexes);

      basePullAt(array, arrayMap(indexes, function(index) {
        return isIndex(index, length) ? +index : index;
      }).sort(compareAscending));

      return result;
    });

    /**
     * Removes all elements from `array` that `predicate` returns truthy for
     * and returns an array of the removed elements. The predicate is invoked
     * with three arguments: (value, index, array).
     *
     * **Note:** Unlike `_.filter`, this method mutates `array`. Use `_.pull`
     * to pull elements from an array by value.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Array
     * @param {Array} array The array to modify.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the new array of removed elements.
     * @example
     *
     * var array = [1, 2, 3, 4];
     * var evens = _.remove(array, function(n) {
     *   return n % 2 == 0;
     * });
     *
     * console.log(array);
     * // => [1, 3]
     *
     * console.log(evens);
     * // => [2, 4]
     */
    function remove(array, predicate) {
      var result = [];
      if (!(array && array.length)) {
        return result;
      }
      var index = -1,
          indexes = [],
          length = array.length;

      predicate = getIteratee(predicate, 3);
      while (++index < length) {
        var value = array[index];
        if (predicate(value, index, array)) {
          result.push(value);
          indexes.push(index);
        }
      }
      basePullAt(array, indexes);
      return result;
    }

    /**
     * Reverses `array` so that the first element becomes the last, the second
     * element becomes the second to last, and so on.
     *
     * **Note:** This method mutates `array` and is based on
     * [`Array#reverse`](https://mdn.io/Array/reverse).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to modify.
     * @returns {Array} Returns `array`.
     * @example
     *
     * var array = [1, 2, 3];
     *
     * _.reverse(array);
     * // => [3, 2, 1]
     *
     * console.log(array);
     * // => [3, 2, 1]
     */
    function reverse(array) {
      return array == null ? array : nativeReverse.call(array);
    }

    /**
     * Creates a slice of `array` from `start` up to, but not including, `end`.
     *
     * **Note:** This method is used instead of
     * [`Array#slice`](https://mdn.io/Array/slice) to ensure dense arrays are
     * returned.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to slice.
     * @param {number} [start=0] The start position.
     * @param {number} [end=array.length] The end position.
     * @returns {Array} Returns the slice of `array`.
     */
    function slice(array, start, end) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return [];
      }
      if (end && typeof end != 'number' && isIterateeCall(array, start, end)) {
        start = 0;
        end = length;
      }
      else {
        start = start == null ? 0 : toInteger(start);
        end = end === undefined ? length : toInteger(end);
      }
      return baseSlice(array, start, end);
    }

    /**
     * Uses a binary search to determine the lowest index at which `value`
     * should be inserted into `array` in order to maintain its sort order.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The sorted array to inspect.
     * @param {*} value The value to evaluate.
     * @returns {number} Returns the index at which `value` should be inserted
     *  into `array`.
     * @example
     *
     * _.sortedIndex([30, 50], 40);
     * // => 1
     */
    function sortedIndex(array, value) {
      return baseSortedIndex(array, value);
    }

    /**
     * This method is like `_.sortedIndex` except that it accepts `iteratee`
     * which is invoked for `value` and each element of `array` to compute their
     * sort ranking. The iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The sorted array to inspect.
     * @param {*} value The value to evaluate.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {number} Returns the index at which `value` should be inserted
     *  into `array`.
     * @example
     *
     * var objects = [{ 'x': 4 }, { 'x': 5 }];
     *
     * _.sortedIndexBy(objects, { 'x': 4 }, function(o) { return o.x; });
     * // => 0
     *
     * // The `_.property` iteratee shorthand.
     * _.sortedIndexBy(objects, { 'x': 4 }, 'x');
     * // => 0
     */
    function sortedIndexBy(array, value, iteratee) {
      return baseSortedIndexBy(array, value, getIteratee(iteratee, 2));
    }

    /**
     * This method is like `_.indexOf` except that it performs a binary
     * search on a sorted `array`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {*} value The value to search for.
     * @returns {number} Returns the index of the matched value, else `-1`.
     * @example
     *
     * _.sortedIndexOf([4, 5, 5, 5, 6], 5);
     * // => 1
     */
    function sortedIndexOf(array, value) {
      var length = array == null ? 0 : array.length;
      if (length) {
        var index = baseSortedIndex(array, value);
        if (index < length && eq(array[index], value)) {
          return index;
        }
      }
      return -1;
    }

    /**
     * This method is like `_.sortedIndex` except that it returns the highest
     * index at which `value` should be inserted into `array` in order to
     * maintain its sort order.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The sorted array to inspect.
     * @param {*} value The value to evaluate.
     * @returns {number} Returns the index at which `value` should be inserted
     *  into `array`.
     * @example
     *
     * _.sortedLastIndex([4, 5, 5, 5, 6], 5);
     * // => 4
     */
    function sortedLastIndex(array, value) {
      return baseSortedIndex(array, value, true);
    }

    /**
     * This method is like `_.sortedLastIndex` except that it accepts `iteratee`
     * which is invoked for `value` and each element of `array` to compute their
     * sort ranking. The iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The sorted array to inspect.
     * @param {*} value The value to evaluate.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {number} Returns the index at which `value` should be inserted
     *  into `array`.
     * @example
     *
     * var objects = [{ 'x': 4 }, { 'x': 5 }];
     *
     * _.sortedLastIndexBy(objects, { 'x': 4 }, function(o) { return o.x; });
     * // => 1
     *
     * // The `_.property` iteratee shorthand.
     * _.sortedLastIndexBy(objects, { 'x': 4 }, 'x');
     * // => 1
     */
    function sortedLastIndexBy(array, value, iteratee) {
      return baseSortedIndexBy(array, value, getIteratee(iteratee, 2), true);
    }

    /**
     * This method is like `_.lastIndexOf` except that it performs a binary
     * search on a sorted `array`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {*} value The value to search for.
     * @returns {number} Returns the index of the matched value, else `-1`.
     * @example
     *
     * _.sortedLastIndexOf([4, 5, 5, 5, 6], 5);
     * // => 3
     */
    function sortedLastIndexOf(array, value) {
      var length = array == null ? 0 : array.length;
      if (length) {
        var index = baseSortedIndex(array, value, true) - 1;
        if (eq(array[index], value)) {
          return index;
        }
      }
      return -1;
    }

    /**
     * This method is like `_.uniq` except that it's designed and optimized
     * for sorted arrays.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @returns {Array} Returns the new duplicate free array.
     * @example
     *
     * _.sortedUniq([1, 1, 2]);
     * // => [1, 2]
     */
    function sortedUniq(array) {
      return (array && array.length)
        ? baseSortedUniq(array)
        : [];
    }

    /**
     * This method is like `_.uniqBy` except that it's designed and optimized
     * for sorted arrays.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {Function} [iteratee] The iteratee invoked per element.
     * @returns {Array} Returns the new duplicate free array.
     * @example
     *
     * _.sortedUniqBy([1.1, 1.2, 2.3, 2.4], Math.floor);
     * // => [1.1, 2.3]
     */
    function sortedUniqBy(array, iteratee) {
      return (array && array.length)
        ? baseSortedUniq(array, getIteratee(iteratee, 2))
        : [];
    }

    /**
     * Gets all but the first element of `array`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to query.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.tail([1, 2, 3]);
     * // => [2, 3]
     */
    function tail(array) {
      var length = array == null ? 0 : array.length;
      return length ? baseSlice(array, 1, length) : [];
    }

    /**
     * Creates a slice of `array` with `n` elements taken from the beginning.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {number} [n=1] The number of elements to take.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.take([1, 2, 3]);
     * // => [1]
     *
     * _.take([1, 2, 3], 2);
     * // => [1, 2]
     *
     * _.take([1, 2, 3], 5);
     * // => [1, 2, 3]
     *
     * _.take([1, 2, 3], 0);
     * // => []
     */
    function take(array, n, guard) {
      if (!(array && array.length)) {
        return [];
      }
      n = (guard || n === undefined) ? 1 : toInteger(n);
      return baseSlice(array, 0, n < 0 ? 0 : n);
    }

    /**
     * Creates a slice of `array` with `n` elements taken from the end.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {number} [n=1] The number of elements to take.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.takeRight([1, 2, 3]);
     * // => [3]
     *
     * _.takeRight([1, 2, 3], 2);
     * // => [2, 3]
     *
     * _.takeRight([1, 2, 3], 5);
     * // => [1, 2, 3]
     *
     * _.takeRight([1, 2, 3], 0);
     * // => []
     */
    function takeRight(array, n, guard) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return [];
      }
      n = (guard || n === undefined) ? 1 : toInteger(n);
      n = length - n;
      return baseSlice(array, n < 0 ? 0 : n, length);
    }

    /**
     * Creates a slice of `array` with elements taken from the end. Elements are
     * taken until `predicate` returns falsey. The predicate is invoked with
     * three arguments: (value, index, array).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'active': true },
     *   { 'user': 'fred',    'active': false },
     *   { 'user': 'pebbles', 'active': false }
     * ];
     *
     * _.takeRightWhile(users, function(o) { return !o.active; });
     * // => objects for ['fred', 'pebbles']
     *
     * // The `_.matches` iteratee shorthand.
     * _.takeRightWhile(users, { 'user': 'pebbles', 'active': false });
     * // => objects for ['pebbles']
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.takeRightWhile(users, ['active', false]);
     * // => objects for ['fred', 'pebbles']
     *
     * // The `_.property` iteratee shorthand.
     * _.takeRightWhile(users, 'active');
     * // => []
     */
    function takeRightWhile(array, predicate) {
      return (array && array.length)
        ? baseWhile(array, getIteratee(predicate, 3), false, true)
        : [];
    }

    /**
     * Creates a slice of `array` with elements taken from the beginning. Elements
     * are taken until `predicate` returns falsey. The predicate is invoked with
     * three arguments: (value, index, array).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'active': false },
     *   { 'user': 'fred',    'active': false },
     *   { 'user': 'pebbles', 'active': true }
     * ];
     *
     * _.takeWhile(users, function(o) { return !o.active; });
     * // => objects for ['barney', 'fred']
     *
     * // The `_.matches` iteratee shorthand.
     * _.takeWhile(users, { 'user': 'barney', 'active': false });
     * // => objects for ['barney']
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.takeWhile(users, ['active', false]);
     * // => objects for ['barney', 'fred']
     *
     * // The `_.property` iteratee shorthand.
     * _.takeWhile(users, 'active');
     * // => []
     */
    function takeWhile(array, predicate) {
      return (array && array.length)
        ? baseWhile(array, getIteratee(predicate, 3))
        : [];
    }

    /**
     * Creates an array of unique values, in order, from all given arrays using
     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * for equality comparisons.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @returns {Array} Returns the new array of combined values.
     * @example
     *
     * _.union([2], [1, 2]);
     * // => [2, 1]
     */
    var union = baseRest(function(arrays) {
      return baseUniq(baseFlatten(arrays, 1, isArrayLikeObject, true));
    });

    /**
     * This method is like `_.union` except that it accepts `iteratee` which is
     * invoked for each element of each `arrays` to generate the criterion by
     * which uniqueness is computed. Result values are chosen from the first
     * array in which the value occurs. The iteratee is invoked with one argument:
     * (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {Array} Returns the new array of combined values.
     * @example
     *
     * _.unionBy([2.1], [1.2, 2.3], Math.floor);
     * // => [2.1, 1.2]
     *
     * // The `_.property` iteratee shorthand.
     * _.unionBy([{ 'x': 1 }], [{ 'x': 2 }, { 'x': 1 }], 'x');
     * // => [{ 'x': 1 }, { 'x': 2 }]
     */
    var unionBy = baseRest(function(arrays) {
      var iteratee = last(arrays);
      if (isArrayLikeObject(iteratee)) {
        iteratee = undefined;
      }
      return baseUniq(baseFlatten(arrays, 1, isArrayLikeObject, true), getIteratee(iteratee, 2));
    });

    /**
     * This method is like `_.union` except that it accepts `comparator` which
     * is invoked to compare elements of `arrays`. Result values are chosen from
     * the first array in which the value occurs. The comparator is invoked
     * with two arguments: (arrVal, othVal).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new array of combined values.
     * @example
     *
     * var objects = [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }];
     * var others = [{ 'x': 1, 'y': 1 }, { 'x': 1, 'y': 2 }];
     *
     * _.unionWith(objects, others, _.isEqual);
     * // => [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }, { 'x': 1, 'y': 1 }]
     */
    var unionWith = baseRest(function(arrays) {
      var comparator = last(arrays);
      comparator = typeof comparator == 'function' ? comparator : undefined;
      return baseUniq(baseFlatten(arrays, 1, isArrayLikeObject, true), undefined, comparator);
    });

    /**
     * Creates a duplicate-free version of an array, using
     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * for equality comparisons, in which only the first occurrence of each element
     * is kept. The order of result values is determined by the order they occur
     * in the array.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @returns {Array} Returns the new duplicate free array.
     * @example
     *
     * _.uniq([2, 1, 2]);
     * // => [2, 1]
     */
    function uniq(array) {
      return (array && array.length) ? baseUniq(array) : [];
    }

    /**
     * This method is like `_.uniq` except that it accepts `iteratee` which is
     * invoked for each element in `array` to generate the criterion by which
     * uniqueness is computed. The order of result values is determined by the
     * order they occur in the array. The iteratee is invoked with one argument:
     * (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {Array} Returns the new duplicate free array.
     * @example
     *
     * _.uniqBy([2.1, 1.2, 2.3], Math.floor);
     * // => [2.1, 1.2]
     *
     * // The `_.property` iteratee shorthand.
     * _.uniqBy([{ 'x': 1 }, { 'x': 2 }, { 'x': 1 }], 'x');
     * // => [{ 'x': 1 }, { 'x': 2 }]
     */
    function uniqBy(array, iteratee) {
      return (array && array.length) ? baseUniq(array, getIteratee(iteratee, 2)) : [];
    }

    /**
     * This method is like `_.uniq` except that it accepts `comparator` which
     * is invoked to compare elements of `array`. The order of result values is
     * determined by the order they occur in the array.The comparator is invoked
     * with two arguments: (arrVal, othVal).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new duplicate free array.
     * @example
     *
     * var objects = [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }, { 'x': 1, 'y': 2 }];
     *
     * _.uniqWith(objects, _.isEqual);
     * // => [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }]
     */
    function uniqWith(array, comparator) {
      comparator = typeof comparator == 'function' ? comparator : undefined;
      return (array && array.length) ? baseUniq(array, undefined, comparator) : [];
    }

    /**
     * This method is like `_.zip` except that it accepts an array of grouped
     * elements and creates an array regrouping the elements to their pre-zip
     * configuration.
     *
     * @static
     * @memberOf _
     * @since 1.2.0
     * @category Array
     * @param {Array} array The array of grouped elements to process.
     * @returns {Array} Returns the new array of regrouped elements.
     * @example
     *
     * var zipped = _.zip(['a', 'b'], [1, 2], [true, false]);
     * // => [['a', 1, true], ['b', 2, false]]
     *
     * _.unzip(zipped);
     * // => [['a', 'b'], [1, 2], [true, false]]
     */
    function unzip(array) {
      if (!(array && array.length)) {
        return [];
      }
      var length = 0;
      array = arrayFilter(array, function(group) {
        if (isArrayLikeObject(group)) {
          length = nativeMax(group.length, length);
          return true;
        }
      });
      return baseTimes(length, function(index) {
        return arrayMap(array, baseProperty(index));
      });
    }

    /**
     * This method is like `_.unzip` except that it accepts `iteratee` to specify
     * how regrouped values should be combined. The iteratee is invoked with the
     * elements of each group: (...group).
     *
     * @static
     * @memberOf _
     * @since 3.8.0
     * @category Array
     * @param {Array} array The array of grouped elements to process.
     * @param {Function} [iteratee=_.identity] The function to combine
     *  regrouped values.
     * @returns {Array} Returns the new array of regrouped elements.
     * @example
     *
     * var zipped = _.zip([1, 2], [10, 20], [100, 200]);
     * // => [[1, 10, 100], [2, 20, 200]]
     *
     * _.unzipWith(zipped, _.add);
     * // => [3, 30, 300]
     */
    function unzipWith(array, iteratee) {
      if (!(array && array.length)) {
        return [];
      }
      var result = unzip(array);
      if (iteratee == null) {
        return result;
      }
      return arrayMap(result, function(group) {
        return apply(iteratee, undefined, group);
      });
    }

    /**
     * Creates an array excluding all given values using
     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * for equality comparisons.
     *
     * **Note:** Unlike `_.pull`, this method returns a new array.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {...*} [values] The values to exclude.
     * @returns {Array} Returns the new array of filtered values.
     * @see _.difference, _.xor
     * @example
     *
     * _.without([2, 1, 2, 3], 1, 2);
     * // => [3]
     */
    var without = baseRest(function(array, values) {
      return isArrayLikeObject(array)
        ? baseDifference(array, values)
        : [];
    });

    /**
     * Creates an array of unique values that is the
     * [symmetric difference](https://en.wikipedia.org/wiki/Symmetric_difference)
     * of the given arrays. The order of result values is determined by the order
     * they occur in the arrays.
     *
     * @static
     * @memberOf _
     * @since 2.4.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @returns {Array} Returns the new array of filtered values.
     * @see _.difference, _.without
     * @example
     *
     * _.xor([2, 1], [2, 3]);
     * // => [1, 3]
     */
    var xor = baseRest(function(arrays) {
      return baseXor(arrayFilter(arrays, isArrayLikeObject));
    });

    /**
     * This method is like `_.xor` except that it accepts `iteratee` which is
     * invoked for each element of each `arrays` to generate the criterion by
     * which by which they're compared. The order of result values is determined
     * by the order they occur in the arrays. The iteratee is invoked with one
     * argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {Array} Returns the new array of filtered values.
     * @example
     *
     * _.xorBy([2.1, 1.2], [2.3, 3.4], Math.floor);
     * // => [1.2, 3.4]
     *
     * // The `_.property` iteratee shorthand.
     * _.xorBy([{ 'x': 1 }], [{ 'x': 2 }, { 'x': 1 }], 'x');
     * // => [{ 'x': 2 }]
     */
    var xorBy = baseRest(function(arrays) {
      var iteratee = last(arrays);
      if (isArrayLikeObject(iteratee)) {
        iteratee = undefined;
      }
      return baseXor(arrayFilter(arrays, isArrayLikeObject), getIteratee(iteratee, 2));
    });

    /**
     * This method is like `_.xor` except that it accepts `comparator` which is
     * invoked to compare elements of `arrays`. The order of result values is
     * determined by the order they occur in the arrays. The comparator is invoked
     * with two arguments: (arrVal, othVal).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new array of filtered values.
     * @example
     *
     * var objects = [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }];
     * var others = [{ 'x': 1, 'y': 1 }, { 'x': 1, 'y': 2 }];
     *
     * _.xorWith(objects, others, _.isEqual);
     * // => [{ 'x': 2, 'y': 1 }, { 'x': 1, 'y': 1 }]
     */
    var xorWith = baseRest(function(arrays) {
      var comparator = last(arrays);
      comparator = typeof comparator == 'function' ? comparator : undefined;
      return baseXor(arrayFilter(arrays, isArrayLikeObject), undefined, comparator);
    });

    /**
     * Creates an array of grouped elements, the first of which contains the
     * first elements of the given arrays, the second of which contains the
     * second elements of the given arrays, and so on.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {...Array} [arrays] The arrays to process.
     * @returns {Array} Returns the new array of grouped elements.
     * @example
     *
     * _.zip(['a', 'b'], [1, 2], [true, false]);
     * // => [['a', 1, true], ['b', 2, false]]
     */
    var zip = baseRest(unzip);

    /**
     * This method is like `_.fromPairs` except that it accepts two arrays,
     * one of property identifiers and one of corresponding values.
     *
     * @static
     * @memberOf _
     * @since 0.4.0
     * @category Array
     * @param {Array} [props=[]] The property identifiers.
     * @param {Array} [values=[]] The property values.
     * @returns {Object} Returns the new object.
     * @example
     *
     * _.zipObject(['a', 'b'], [1, 2]);
     * // => { 'a': 1, 'b': 2 }
     */
    function zipObject(props, values) {
      return baseZipObject(props || [], values || [], assignValue);
    }

    /**
     * This method is like `_.zipObject` except that it supports property paths.
     *
     * @static
     * @memberOf _
     * @since 4.1.0
     * @category Array
     * @param {Array} [props=[]] The property identifiers.
     * @param {Array} [values=[]] The property values.
     * @returns {Object} Returns the new object.
     * @example
     *
     * _.zipObjectDeep(['a.b[0].c', 'a.b[1].d'], [1, 2]);
     * // => { 'a': { 'b': [{ 'c': 1 }, { 'd': 2 }] } }
     */
    function zipObjectDeep(props, values) {
      return baseZipObject(props || [], values || [], baseSet);
    }

    /**
     * This method is like `_.zip` except that it accepts `iteratee` to specify
     * how grouped values should be combined. The iteratee is invoked with the
     * elements of each group: (...group).
     *
     * @static
     * @memberOf _
     * @since 3.8.0
     * @category Array
     * @param {...Array} [arrays] The arrays to process.
     * @param {Function} [iteratee=_.identity] The function to combine
     *  grouped values.
     * @returns {Array} Returns the new array of grouped elements.
     * @example
     *
     * _.zipWith([1, 2], [10, 20], [100, 200], function(a, b, c) {
     *   return a + b + c;
     * });
     * // => [111, 222]
     */
    var zipWith = baseRest(function(arrays) {
      var length = arrays.length,
          iteratee = length > 1 ? arrays[length - 1] : undefined;

      iteratee = typeof iteratee == 'function' ? (arrays.pop(), iteratee) : undefined;
      return unzipWith(arrays, iteratee);
    });

    /*------------------------------------------------------------------------*/

    /**
     * Creates a `lodash` wrapper instance that wraps `value` with explicit method
     * chain sequences enabled. The result of such sequences must be unwrapped
     * with `_#value`.
     *
     * @static
     * @memberOf _
     * @since 1.3.0
     * @category Seq
     * @param {*} value The value to wrap.
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'age': 36 },
     *   { 'user': 'fred',    'age': 40 },
     *   { 'user': 'pebbles', 'age': 1 }
     * ];
     *
     * var youngest = _
     *   .chain(users)
     *   .sortBy('age')
     *   .map(function(o) {
     *     return o.user + ' is ' + o.age;
     *   })
     *   .head()
     *   .value();
     * // => 'pebbles is 1'
     */
    function chain(value) {
      var result = lodash(value);
      result.__chain__ = true;
      return result;
    }

    /**
     * This method invokes `interceptor` and returns `value`. The interceptor
     * is invoked with one argument; (value). The purpose of this method is to
     * "tap into" a method chain sequence in order to modify intermediate results.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Seq
     * @param {*} value The value to provide to `interceptor`.
     * @param {Function} interceptor The function to invoke.
     * @returns {*} Returns `value`.
     * @example
     *
     * _([1, 2, 3])
     *  .tap(function(array) {
     *    // Mutate input array.
     *    array.pop();
     *  })
     *  .reverse()
     *  .value();
     * // => [2, 1]
     */
    function tap(value, interceptor) {
      interceptor(value);
      return value;
    }

    /**
     * This method is like `_.tap` except that it returns the result of `interceptor`.
     * The purpose of this method is to "pass thru" values replacing intermediate
     * results in a method chain sequence.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Seq
     * @param {*} value The value to provide to `interceptor`.
     * @param {Function} interceptor The function to invoke.
     * @returns {*} Returns the result of `interceptor`.
     * @example
     *
     * _('  abc  ')
     *  .chain()
     *  .trim()
     *  .thru(function(value) {
     *    return [value];
     *  })
     *  .value();
     * // => ['abc']
     */
    function thru(value, interceptor) {
      return interceptor(value);
    }

    /**
     * This method is the wrapper version of `_.at`.
     *
     * @name at
     * @memberOf _
     * @since 1.0.0
     * @category Seq
     * @param {...(string|string[])} [paths] The property paths to pick.
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * var object = { 'a': [{ 'b': { 'c': 3 } }, 4] };
     *
     * _(object).at(['a[0].b.c', 'a[1]']).value();
     * // => [3, 4]
     */
    var wrapperAt = flatRest(function(paths) {
      var length = paths.length,
          start = length ? paths[0] : 0,
          value = this.__wrapped__,
          interceptor = function(object) { return baseAt(object, paths); };

      if (length > 1 || this.__actions__.length ||
          !(value instanceof LazyWrapper) || !isIndex(start)) {
        return this.thru(interceptor);
      }
      value = value.slice(start, +start + (length ? 1 : 0));
      value.__actions__.push({
        'func': thru,
        'args': [interceptor],
        'thisArg': undefined
      });
      return new LodashWrapper(value, this.__chain__).thru(function(array) {
        if (length && !array.length) {
          array.push(undefined);
        }
        return array;
      });
    });

    /**
     * Creates a `lodash` wrapper instance with explicit method chain sequences enabled.
     *
     * @name chain
     * @memberOf _
     * @since 0.1.0
     * @category Seq
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36 },
     *   { 'user': 'fred',   'age': 40 }
     * ];
     *
     * // A sequence without explicit chaining.
     * _(users).head();
     * // => { 'user': 'barney', 'age': 36 }
     *
     * // A sequence with explicit chaining.
     * _(users)
     *   .chain()
     *   .head()
     *   .pick('user')
     *   .value();
     * // => { 'user': 'barney' }
     */
    function wrapperChain() {
      return chain(this);
    }

    /**
     * Executes the chain sequence and returns the wrapped result.
     *
     * @name commit
     * @memberOf _
     * @since 3.2.0
     * @category Seq
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * var array = [1, 2];
     * var wrapped = _(array).push(3);
     *
     * console.log(array);
     * // => [1, 2]
     *
     * wrapped = wrapped.commit();
     * console.log(array);
     * // => [1, 2, 3]
     *
     * wrapped.last();
     * // => 3
     *
     * console.log(array);
     * // => [1, 2, 3]
     */
    function wrapperCommit() {
      return new LodashWrapper(this.value(), this.__chain__);
    }

    /**
     * Gets the next value on a wrapped object following the
     * [iterator protocol](https://mdn.io/iteration_protocols#iterator).
     *
     * @name next
     * @memberOf _
     * @since 4.0.0
     * @category Seq
     * @returns {Object} Returns the next iterator value.
     * @example
     *
     * var wrapped = _([1, 2]);
     *
     * wrapped.next();
     * // => { 'done': false, 'value': 1 }
     *
     * wrapped.next();
     * // => { 'done': false, 'value': 2 }
     *
     * wrapped.next();
     * // => { 'done': true, 'value': undefined }
     */
    function wrapperNext() {
      if (this.__values__ === undefined) {
        this.__values__ = toArray(this.value());
      }
      var done = this.__index__ >= this.__values__.length,
          value = done ? undefined : this.__values__[this.__index__++];

      return { 'done': done, 'value': value };
    }

    /**
     * Enables the wrapper to be iterable.
     *
     * @name Symbol.iterator
     * @memberOf _
     * @since 4.0.0
     * @category Seq
     * @returns {Object} Returns the wrapper object.
     * @example
     *
     * var wrapped = _([1, 2]);
     *
     * wrapped[Symbol.iterator]() === wrapped;
     * // => true
     *
     * Array.from(wrapped);
     * // => [1, 2]
     */
    function wrapperToIterator() {
      return this;
    }

    /**
     * Creates a clone of the chain sequence planting `value` as the wrapped value.
     *
     * @name plant
     * @memberOf _
     * @since 3.2.0
     * @category Seq
     * @param {*} value The value to plant.
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * function square(n) {
     *   return n * n;
     * }
     *
     * var wrapped = _([1, 2]).map(square);
     * var other = wrapped.plant([3, 4]);
     *
     * other.value();
     * // => [9, 16]
     *
     * wrapped.value();
     * // => [1, 4]
     */
    function wrapperPlant(value) {
      var result,
          parent = this;

      while (parent instanceof baseLodash) {
        var clone = wrapperClone(parent);
        clone.__index__ = 0;
        clone.__values__ = undefined;
        if (result) {
          previous.__wrapped__ = clone;
        } else {
          result = clone;
        }
        var previous = clone;
        parent = parent.__wrapped__;
      }
      previous.__wrapped__ = value;
      return result;
    }

    /**
     * This method is the wrapper version of `_.reverse`.
     *
     * **Note:** This method mutates the wrapped array.
     *
     * @name reverse
     * @memberOf _
     * @since 0.1.0
     * @category Seq
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * var array = [1, 2, 3];
     *
     * _(array).reverse().value()
     * // => [3, 2, 1]
     *
     * console.log(array);
     * // => [3, 2, 1]
     */
    function wrapperReverse() {
      var value = this.__wrapped__;
      if (value instanceof LazyWrapper) {
        var wrapped = value;
        if (this.__actions__.length) {
          wrapped = new LazyWrapper(this);
        }
        wrapped = wrapped.reverse();
        wrapped.__actions__.push({
          'func': thru,
          'args': [reverse],
          'thisArg': undefined
        });
        return new LodashWrapper(wrapped, this.__chain__);
      }
      return this.thru(reverse);
    }

    /**
     * Executes the chain sequence to resolve the unwrapped value.
     *
     * @name value
     * @memberOf _
     * @since 0.1.0
     * @alias toJSON, valueOf
     * @category Seq
     * @returns {*} Returns the resolved unwrapped value.
     * @example
     *
     * _([1, 2, 3]).value();
     * // => [1, 2, 3]
     */
    function wrapperValue() {
      return baseWrapperValue(this.__wrapped__, this.__actions__);
    }

    /*------------------------------------------------------------------------*/

    /**
     * Creates an object composed of keys generated from the results of running
     * each element of `collection` thru `iteratee`. The corresponding value of
     * each key is the number of times the key was returned by `iteratee`. The
     * iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 0.5.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The iteratee to transform keys.
     * @returns {Object} Returns the composed aggregate object.
     * @example
     *
     * _.countBy([6.1, 4.2, 6.3], Math.floor);
     * // => { '4': 1, '6': 2 }
     *
     * // The `_.property` iteratee shorthand.
     * _.countBy(['one', 'two', 'three'], 'length');
     * // => { '3': 2, '5': 1 }
     */
    var countBy = createAggregator(function(result, value, key) {
      if (hasOwnProperty.call(result, key)) {
        ++result[key];
      } else {
        baseAssignValue(result, key, 1);
      }
    });

    /**
     * Checks if `predicate` returns truthy for **all** elements of `collection`.
     * Iteration is stopped once `predicate` returns falsey. The predicate is
     * invoked with three arguments: (value, index|key, collection).
     *
     * **Note:** This method returns `true` for
     * [empty collections](https://en.wikipedia.org/wiki/Empty_set) because
     * [everything is true](https://en.wikipedia.org/wiki/Vacuous_truth) of
     * elements of empty collections.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {boolean} Returns `true` if all elements pass the predicate check,
     *  else `false`.
     * @example
     *
     * _.every([true, 1, null, 'yes'], Boolean);
     * // => false
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36, 'active': false },
     *   { 'user': 'fred',   'age': 40, 'active': false }
     * ];
     *
     * // The `_.matches` iteratee shorthand.
     * _.every(users, { 'user': 'barney', 'active': false });
     * // => false
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.every(users, ['active', false]);
     * // => true
     *
     * // The `_.property` iteratee shorthand.
     * _.every(users, 'active');
     * // => false
     */
    function every(collection, predicate, guard) {
      var func = isArray(collection) ? arrayEvery : baseEvery;
      if (guard && isIterateeCall(collection, predicate, guard)) {
        predicate = undefined;
      }
      return func(collection, getIteratee(predicate, 3));
    }

    /**
     * Iterates over elements of `collection`, returning an array of all elements
     * `predicate` returns truthy for. The predicate is invoked with three
     * arguments: (value, index|key, collection).
     *
     * **Note:** Unlike `_.remove`, this method returns a new array.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the new filtered array.
     * @see _.reject
     * @example
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36, 'active': true },
     *   { 'user': 'fred',   'age': 40, 'active': false }
     * ];
     *
     * _.filter(users, function(o) { return !o.active; });
     * // => objects for ['fred']
     *
     * // The `_.matches` iteratee shorthand.
     * _.filter(users, { 'age': 36, 'active': true });
     * // => objects for ['barney']
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.filter(users, ['active', false]);
     * // => objects for ['fred']
     *
     * // The `_.property` iteratee shorthand.
     * _.filter(users, 'active');
     * // => objects for ['barney']
     */
    function filter(collection, predicate) {
      var func = isArray(collection) ? arrayFilter : baseFilter;
      return func(collection, getIteratee(predicate, 3));
    }

    /**
     * Iterates over elements of `collection`, returning the first element
     * `predicate` returns truthy for. The predicate is invoked with three
     * arguments: (value, index|key, collection).
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to inspect.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @param {number} [fromIndex=0] The index to search from.
     * @returns {*} Returns the matched element, else `undefined`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'age': 36, 'active': true },
     *   { 'user': 'fred',    'age': 40, 'active': false },
     *   { 'user': 'pebbles', 'age': 1,  'active': true }
     * ];
     *
     * _.find(users, function(o) { return o.age < 40; });
     * // => object for 'barney'
     *
     * // The `_.matches` iteratee shorthand.
     * _.find(users, { 'age': 1, 'active': true });
     * // => object for 'pebbles'
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.find(users, ['active', false]);
     * // => object for 'fred'
     *
     * // The `_.property` iteratee shorthand.
     * _.find(users, 'active');
     * // => object for 'barney'
     */
    var find = createFind(findIndex);

    /**
     * This method is like `_.find` except that it iterates over elements of
     * `collection` from right to left.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Collection
     * @param {Array|Object} collection The collection to inspect.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @param {number} [fromIndex=collection.length-1] The index to search from.
     * @returns {*} Returns the matched element, else `undefined`.
     * @example
     *
     * _.findLast([1, 2, 3, 4], function(n) {
     *   return n % 2 == 1;
     * });
     * // => 3
     */
    var findLast = createFind(findLastIndex);

    /**
     * Creates a flattened array of values by running each element in `collection`
     * thru `iteratee` and flattening the mapped results. The iteratee is invoked
     * with three arguments: (value, index|key, collection).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the new flattened array.
     * @example
     *
     * function duplicate(n) {
     *   return [n, n];
     * }
     *
     * _.flatMap([1, 2], duplicate);
     * // => [1, 1, 2, 2]
     */
    function flatMap(collection, iteratee) {
      return baseFlatten(map(collection, iteratee), 1);
    }

    /**
     * This method is like `_.flatMap` except that it recursively flattens the
     * mapped results.
     *
     * @static
     * @memberOf _
     * @since 4.7.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the new flattened array.
     * @example
     *
     * function duplicate(n) {
     *   return [[[n, n]]];
     * }
     *
     * _.flatMapDeep([1, 2], duplicate);
     * // => [1, 1, 2, 2]
     */
    function flatMapDeep(collection, iteratee) {
      return baseFlatten(map(collection, iteratee), INFINITY);
    }

    /**
     * This method is like `_.flatMap` except that it recursively flattens the
     * mapped results up to `depth` times.
     *
     * @static
     * @memberOf _
     * @since 4.7.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {number} [depth=1] The maximum recursion depth.
     * @returns {Array} Returns the new flattened array.
     * @example
     *
     * function duplicate(n) {
     *   return [[[n, n]]];
     * }
     *
     * _.flatMapDepth([1, 2], duplicate, 2);
     * // => [[1, 1], [2, 2]]
     */
    function flatMapDepth(collection, iteratee, depth) {
      depth = depth === undefined ? 1 : toInteger(depth);
      return baseFlatten(map(collection, iteratee), depth);
    }

    /**
     * Iterates over elements of `collection` and invokes `iteratee` for each element.
     * The iteratee is invoked with three arguments: (value, index|key, collection).
     * Iteratee functions may exit iteration early by explicitly returning `false`.
     *
     * **Note:** As with other "Collections" methods, objects with a "length"
     * property are iterated like arrays. To avoid this behavior use `_.forIn`
     * or `_.forOwn` for object iteration.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @alias each
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Array|Object} Returns `collection`.
     * @see _.forEachRight
     * @example
     *
     * _.forEach([1, 2], function(value) {
     *   console.log(value);
     * });
     * // => Logs `1` then `2`.
     *
     * _.forEach({ 'a': 1, 'b': 2 }, function(value, key) {
     *   console.log(key);
     * });
     * // => Logs 'a' then 'b' (iteration order is not guaranteed).
     */
    function forEach(collection, iteratee) {
      var func = isArray(collection) ? arrayEach : baseEach;
      return func(collection, getIteratee(iteratee, 3));
    }

    /**
     * This method is like `_.forEach` except that it iterates over elements of
     * `collection` from right to left.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @alias eachRight
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Array|Object} Returns `collection`.
     * @see _.forEach
     * @example
     *
     * _.forEachRight([1, 2], function(value) {
     *   console.log(value);
     * });
     * // => Logs `2` then `1`.
     */
    function forEachRight(collection, iteratee) {
      var func = isArray(collection) ? arrayEachRight : baseEachRight;
      return func(collection, getIteratee(iteratee, 3));
    }

    /**
     * Creates an object composed of keys generated from the results of running
     * each element of `collection` thru `iteratee`. The order of grouped values
     * is determined by the order they occur in `collection`. The corresponding
     * value of each key is an array of elements responsible for generating the
     * key. The iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The iteratee to transform keys.
     * @returns {Object} Returns the composed aggregate object.
     * @example
     *
     * _.groupBy([6.1, 4.2, 6.3], Math.floor);
     * // => { '4': [4.2], '6': [6.1, 6.3] }
     *
     * // The `_.property` iteratee shorthand.
     * _.groupBy(['one', 'two', 'three'], 'length');
     * // => { '3': ['one', 'two'], '5': ['three'] }
     */
    var groupBy = createAggregator(function(result, value, key) {
      if (hasOwnProperty.call(result, key)) {
        result[key].push(value);
      } else {
        baseAssignValue(result, key, [value]);
      }
    });

    /**
     * Checks if `value` is in `collection`. If `collection` is a string, it's
     * checked for a substring of `value`, otherwise
     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * is used for equality comparisons. If `fromIndex` is negative, it's used as
     * the offset from the end of `collection`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object|string} collection The collection to inspect.
     * @param {*} value The value to search for.
     * @param {number} [fromIndex=0] The index to search from.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.reduce`.
     * @returns {boolean} Returns `true` if `value` is found, else `false`.
     * @example
     *
     * _.includes([1, 2, 3], 1);
     * // => true
     *
     * _.includes([1, 2, 3], 1, 2);
     * // => false
     *
     * _.includes({ 'a': 1, 'b': 2 }, 1);
     * // => true
     *
     * _.includes('abcd', 'bc');
     * // => true
     */
    function includes(collection, value, fromIndex, guard) {
      collection = isArrayLike(collection) ? collection : values(collection);
      fromIndex = (fromIndex && !guard) ? toInteger(fromIndex) : 0;

      var length = collection.length;
      if (fromIndex < 0) {
        fromIndex = nativeMax(length + fromIndex, 0);
      }
      return isString(collection)
        ? (fromIndex <= length && collection.indexOf(value, fromIndex) > -1)
        : (!!length && baseIndexOf(collection, value, fromIndex) > -1);
    }

    /**
     * Invokes the method at `path` of each element in `collection`, returning
     * an array of the results of each invoked method. Any additional arguments
     * are provided to each invoked method. If `path` is a function, it's invoked
     * for, and `this` bound to, each element in `collection`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Array|Function|string} path The path of the method to invoke or
     *  the function invoked per iteration.
     * @param {...*} [args] The arguments to invoke each method with.
     * @returns {Array} Returns the array of results.
     * @example
     *
     * _.invokeMap([[5, 1, 7], [3, 2, 1]], 'sort');
     * // => [[1, 5, 7], [1, 2, 3]]
     *
     * _.invokeMap([123, 456], String.prototype.split, '');
     * // => [['1', '2', '3'], ['4', '5', '6']]
     */
    var invokeMap = baseRest(function(collection, path, args) {
      var index = -1,
          isFunc = typeof path == 'function',
          result = isArrayLike(collection) ? Array(collection.length) : [];

      baseEach(collection, function(value) {
        result[++index] = isFunc ? apply(path, value, args) : baseInvoke(value, path, args);
      });
      return result;
    });

    /**
     * Creates an object composed of keys generated from the results of running
     * each element of `collection` thru `iteratee`. The corresponding value of
     * each key is the last element responsible for generating the key. The
     * iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The iteratee to transform keys.
     * @returns {Object} Returns the composed aggregate object.
     * @example
     *
     * var array = [
     *   { 'dir': 'left', 'code': 97 },
     *   { 'dir': 'right', 'code': 100 }
     * ];
     *
     * _.keyBy(array, function(o) {
     *   return String.fromCharCode(o.code);
     * });
     * // => { 'a': { 'dir': 'left', 'code': 97 }, 'd': { 'dir': 'right', 'code': 100 } }
     *
     * _.keyBy(array, 'dir');
     * // => { 'left': { 'dir': 'left', 'code': 97 }, 'right': { 'dir': 'right', 'code': 100 } }
     */
    var keyBy = createAggregator(function(result, value, key) {
      baseAssignValue(result, key, value);
    });

    /**
     * Creates an array of values by running each element in `collection` thru
     * `iteratee`. The iteratee is invoked with three arguments:
     * (value, index|key, collection).
     *
     * Many lodash methods are guarded to work as iteratees for methods like
     * `_.every`, `_.filter`, `_.map`, `_.mapValues`, `_.reject`, and `_.some`.
     *
     * The guarded methods are:
     * `ary`, `chunk`, `curry`, `curryRight`, `drop`, `dropRight`, `every`,
     * `fill`, `invert`, `parseInt`, `random`, `range`, `rangeRight`, `repeat`,
     * `sampleSize`, `slice`, `some`, `sortBy`, `split`, `take`, `takeRight`,
     * `template`, `trim`, `trimEnd`, `trimStart`, and `words`
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the new mapped array.
     * @example
     *
     * function square(n) {
     *   return n * n;
     * }
     *
     * _.map([4, 8], square);
     * // => [16, 64]
     *
     * _.map({ 'a': 4, 'b': 8 }, square);
     * // => [16, 64] (iteration order is not guaranteed)
     *
     * var users = [
     *   { 'user': 'barney' },
     *   { 'user': 'fred' }
     * ];
     *
     * // The `_.property` iteratee shorthand.
     * _.map(users, 'user');
     * // => ['barney', 'fred']
     */
    function map(collection, iteratee) {
      var func = isArray(collection) ? arrayMap : baseMap;
      return func(collection, getIteratee(iteratee, 3));
    }

    /**
     * This method is like `_.sortBy` except that it allows specifying the sort
     * orders of the iteratees to sort by. If `orders` is unspecified, all values
     * are sorted in ascending order. Otherwise, specify an order of "desc" for
     * descending or "asc" for ascending sort order of corresponding values.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Array[]|Function[]|Object[]|string[]} [iteratees=[_.identity]]
     *  The iteratees to sort by.
     * @param {string[]} [orders] The sort orders of `iteratees`.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.reduce`.
     * @returns {Array} Returns the new sorted array.
     * @example
     *
     * var users = [
     *   { 'user': 'fred',   'age': 48 },
     *   { 'user': 'barney', 'age': 34 },
     *   { 'user': 'fred',   'age': 40 },
     *   { 'user': 'barney', 'age': 36 }
     * ];
     *
     * // Sort by `user` in ascending order and by `age` in descending order.
     * _.orderBy(users, ['user', 'age'], ['asc', 'desc']);
     * // => objects for [['barney', 36], ['barney', 34], ['fred', 48], ['fred', 40]]
     */
    function orderBy(collection, iteratees, orders, guard) {
      if (collection == null) {
        return [];
      }
      if (!isArray(iteratees)) {
        iteratees = iteratees == null ? [] : [iteratees];
      }
      orders = guard ? undefined : orders;
      if (!isArray(orders)) {
        orders = orders == null ? [] : [orders];
      }
      return baseOrderBy(collection, iteratees, orders);
    }

    /**
     * Creates an array of elements split into two groups, the first of which
     * contains elements `predicate` returns truthy for, the second of which
     * contains elements `predicate` returns falsey for. The predicate is
     * invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the array of grouped elements.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'age': 36, 'active': false },
     *   { 'user': 'fred',    'age': 40, 'active': true },
     *   { 'user': 'pebbles', 'age': 1,  'active': false }
     * ];
     *
     * _.partition(users, function(o) { return o.active; });
     * // => objects for [['fred'], ['barney', 'pebbles']]
     *
     * // The `_.matches` iteratee shorthand.
     * _.partition(users, { 'age': 1, 'active': false });
     * // => objects for [['pebbles'], ['barney', 'fred']]
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.partition(users, ['active', false]);
     * // => objects for [['barney', 'pebbles'], ['fred']]
     *
     * // The `_.property` iteratee shorthand.
     * _.partition(users, 'active');
     * // => objects for [['fred'], ['barney', 'pebbles']]
     */
    var partition = createAggregator(function(result, value, key) {
      result[key ? 0 : 1].push(value);
    }, function() { return [[], []]; });

    /**
     * Reduces `collection` to a value which is the accumulated result of running
     * each element in `collection` thru `iteratee`, where each successive
     * invocation is supplied the return value of the previous. If `accumulator`
     * is not given, the first element of `collection` is used as the initial
     * value. The iteratee is invoked with four arguments:
     * (accumulator, value, index|key, collection).
     *
     * Many lodash methods are guarded to work as iteratees for methods like
     * `_.reduce`, `_.reduceRight`, and `_.transform`.
     *
     * The guarded methods are:
     * `assign`, `defaults`, `defaultsDeep`, `includes`, `merge`, `orderBy`,
     * and `sortBy`
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {*} [accumulator] The initial value.
     * @returns {*} Returns the accumulated value.
     * @see _.reduceRight
     * @example
     *
     * _.reduce([1, 2], function(sum, n) {
     *   return sum + n;
     * }, 0);
     * // => 3
     *
     * _.reduce({ 'a': 1, 'b': 2, 'c': 1 }, function(result, value, key) {
     *   (result[value] || (result[value] = [])).push(key);
     *   return result;
     * }, {});
     * // => { '1': ['a', 'c'], '2': ['b'] } (iteration order is not guaranteed)
     */
    function reduce(collection, iteratee, accumulator) {
      var func = isArray(collection) ? arrayReduce : baseReduce,
          initAccum = arguments.length < 3;

      return func(collection, getIteratee(iteratee, 4), accumulator, initAccum, baseEach);
    }

    /**
     * This method is like `_.reduce` except that it iterates over elements of
     * `collection` from right to left.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {*} [accumulator] The initial value.
     * @returns {*} Returns the accumulated value.
     * @see _.reduce
     * @example
     *
     * var array = [[0, 1], [2, 3], [4, 5]];
     *
     * _.reduceRight(array, function(flattened, other) {
     *   return flattened.concat(other);
     * }, []);
     * // => [4, 5, 2, 3, 0, 1]
     */
    function reduceRight(collection, iteratee, accumulator) {
      var func = isArray(collection) ? arrayReduceRight : baseReduce,
          initAccum = arguments.length < 3;

      return func(collection, getIteratee(iteratee, 4), accumulator, initAccum, baseEachRight);
    }

    /**
     * The opposite of `_.filter`; this method returns the elements of `collection`
     * that `predicate` does **not** return truthy for.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the new filtered array.
     * @see _.filter
     * @example
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36, 'active': false },
     *   { 'user': 'fred',   'age': 40, 'active': true }
     * ];
     *
     * _.reject(users, function(o) { return !o.active; });
     * // => objects for ['fred']
     *
     * // The `_.matches` iteratee shorthand.
     * _.reject(users, { 'age': 40, 'active': true });
     * // => objects for ['barney']
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.reject(users, ['active', false]);
     * // => objects for ['fred']
     *
     * // The `_.property` iteratee shorthand.
     * _.reject(users, 'active');
     * // => objects for ['barney']
     */
    function reject(collection, predicate) {
      var func = isArray(collection) ? arrayFilter : baseFilter;
      return func(collection, negate(getIteratee(predicate, 3)));
    }

    /**
     * Gets a random element from `collection`.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Collection
     * @param {Array|Object} collection The collection to sample.
     * @returns {*} Returns the random element.
     * @example
     *
     * _.sample([1, 2, 3, 4]);
     * // => 2
     */
    function sample(collection) {
      var func = isArray(collection) ? arraySample : baseSample;
      return func(collection);
    }

    /**
     * Gets `n` random elements at unique keys from `collection` up to the
     * size of `collection`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Collection
     * @param {Array|Object} collection The collection to sample.
     * @param {number} [n=1] The number of elements to sample.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Array} Returns the random elements.
     * @example
     *
     * _.sampleSize([1, 2, 3], 2);
     * // => [3, 1]
     *
     * _.sampleSize([1, 2, 3], 4);
     * // => [2, 3, 1]
     */
    function sampleSize(collection, n, guard) {
      if ((guard ? isIterateeCall(collection, n, guard) : n === undefined)) {
        n = 1;
      } else {
        n = toInteger(n);
      }
      var func = isArray(collection) ? arraySampleSize : baseSampleSize;
      return func(collection, n);
    }

    /**
     * Creates an array of shuffled values, using a version of the
     * [Fisher-Yates shuffle](https://en.wikipedia.org/wiki/Fisher-Yates_shuffle).
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to shuffle.
     * @returns {Array} Returns the new shuffled array.
     * @example
     *
     * _.shuffle([1, 2, 3, 4]);
     * // => [4, 1, 3, 2]
     */
    function shuffle(collection) {
      var func = isArray(collection) ? arrayShuffle : baseShuffle;
      return func(collection);
    }

    /**
     * Gets the size of `collection` by returning its length for array-like
     * values or the number of own enumerable string keyed properties for objects.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object|string} collection The collection to inspect.
     * @returns {number} Returns the collection size.
     * @example
     *
     * _.size([1, 2, 3]);
     * // => 3
     *
     * _.size({ 'a': 1, 'b': 2 });
     * // => 2
     *
     * _.size('pebbles');
     * // => 7
     */
    function size(collection) {
      if (collection == null) {
        return 0;
      }
      if (isArrayLike(collection)) {
        return isString(collection) ? stringSize(collection) : collection.length;
      }
      var tag = getTag(collection);
      if (tag == mapTag || tag == setTag) {
        return collection.size;
      }
      return baseKeys(collection).length;
    }

    /**
     * Checks if `predicate` returns truthy for **any** element of `collection`.
     * Iteration is stopped once `predicate` returns truthy. The predicate is
     * invoked with three arguments: (value, index|key, collection).
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {boolean} Returns `true` if any element passes the predicate check,
     *  else `false`.
     * @example
     *
     * _.some([null, 0, 'yes', false], Boolean);
     * // => true
     *
     * var users = [
     *   { 'user': 'barney', 'active': true },
     *   { 'user': 'fred',   'active': false }
     * ];
     *
     * // The `_.matches` iteratee shorthand.
     * _.some(users, { 'user': 'barney', 'active': false });
     * // => false
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.some(users, ['active', false]);
     * // => true
     *
     * // The `_.property` iteratee shorthand.
     * _.some(users, 'active');
     * // => true
     */
    function some(collection, predicate, guard) {
      var func = isArray(collection) ? arraySome : baseSome;
      if (guard && isIterateeCall(collection, predicate, guard)) {
        predicate = undefined;
      }
      return func(collection, getIteratee(predicate, 3));
    }

    /**
     * Creates an array of elements, sorted in ascending order by the results of
     * running each element in a collection thru each iteratee. This method
     * performs a stable sort, that is, it preserves the original sort order of
     * equal elements. The iteratees are invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {...(Function|Function[])} [iteratees=[_.identity]]
     *  The iteratees to sort by.
     * @returns {Array} Returns the new sorted array.
     * @example
     *
     * var users = [
     *   { 'user': 'fred',   'age': 48 },
     *   { 'user': 'barney', 'age': 36 },
     *   { 'user': 'fred',   'age': 40 },
     *   { 'user': 'barney', 'age': 34 }
     * ];
     *
     * _.sortBy(users, [function(o) { return o.user; }]);
     * // => objects for [['barney', 36], ['barney', 34], ['fred', 48], ['fred', 40]]
     *
     * _.sortBy(users, ['user', 'age']);
     * // => objects for [['barney', 34], ['barney', 36], ['fred', 40], ['fred', 48]]
     */
    var sortBy = baseRest(function(collection, iteratees) {
      if (collection == null) {
        return [];
      }
      var length = iteratees.length;
      if (length > 1 && isIterateeCall(collection, iteratees[0], iteratees[1])) {
        iteratees = [];
      } else if (length > 2 && isIterateeCall(iteratees[0], iteratees[1], iteratees[2])) {
        iteratees = [iteratees[0]];
      }
      return baseOrderBy(collection, baseFlatten(iteratees, 1), []);
    });

    /*------------------------------------------------------------------------*/

    /**
     * Gets the timestamp of the number of milliseconds that have elapsed since
     * the Unix epoch (1 January 1970 00:00:00 UTC).
     *
     * @static
     * @memberOf _
     * @since 2.4.0
     * @category Date
     * @returns {number} Returns the timestamp.
     * @example
     *
     * _.defer(function(stamp) {
     *   console.log(_.now() - stamp);
     * }, _.now());
     * // => Logs the number of milliseconds it took for the deferred invocation.
     */
    var now = ctxNow || function() {
      return root.Date.now();
    };

    /*------------------------------------------------------------------------*/

    /**
     * The opposite of `_.before`; this method creates a function that invokes
     * `func` once it's called `n` or more times.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {number} n The number of calls before `func` is invoked.
     * @param {Function} func The function to restrict.
     * @returns {Function} Returns the new restricted function.
     * @example
     *
     * var saves = ['profile', 'settings'];
     *
     * var done = _.after(saves.length, function() {
     *   console.log('done saving!');
     * });
     *
     * _.forEach(saves, function(type) {
     *   asyncSave({ 'type': type, 'complete': done });
     * });
     * // => Logs 'done saving!' after the two async saves have completed.
     */
    function after(n, func) {
      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      n = toInteger(n);
      return function() {
        if (--n < 1) {
          return func.apply(this, arguments);
        }
      };
    }

    /**
     * Creates a function that invokes `func`, with up to `n` arguments,
     * ignoring any additional arguments.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Function
     * @param {Function} func The function to cap arguments for.
     * @param {number} [n=func.length] The arity cap.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Function} Returns the new capped function.
     * @example
     *
     * _.map(['6', '8', '10'], _.ary(parseInt, 1));
     * // => [6, 8, 10]
     */
    function ary(func, n, guard) {
      n = guard ? undefined : n;
      n = (func && n == null) ? func.length : n;
      return createWrap(func, WRAP_ARY_FLAG, undefined, undefined, undefined, undefined, n);
    }

    /**
     * Creates a function that invokes `func`, with the `this` binding and arguments
     * of the created function, while it's called less than `n` times. Subsequent
     * calls to the created function return the result of the last `func` invocation.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Function
     * @param {number} n The number of calls at which `func` is no longer invoked.
     * @param {Function} func The function to restrict.
     * @returns {Function} Returns the new restricted function.
     * @example
     *
     * jQuery(element).on('click', _.before(5, addContactToList));
     * // => Allows adding up to 4 contacts to the list.
     */
    function before(n, func) {
      var result;
      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      n = toInteger(n);
      return function() {
        if (--n > 0) {
          result = func.apply(this, arguments);
        }
        if (n <= 1) {
          func = undefined;
        }
        return result;
      };
    }

    /**
     * Creates a function that invokes `func` with the `this` binding of `thisArg`
     * and `partials` prepended to the arguments it receives.
     *
     * The `_.bind.placeholder` value, which defaults to `_` in monolithic builds,
     * may be used as a placeholder for partially applied arguments.
     *
     * **Note:** Unlike native `Function#bind`, this method doesn't set the "length"
     * property of bound functions.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {Function} func The function to bind.
     * @param {*} thisArg The `this` binding of `func`.
     * @param {...*} [partials] The arguments to be partially applied.
     * @returns {Function} Returns the new bound function.
     * @example
     *
     * function greet(greeting, punctuation) {
     *   return greeting + ' ' + this.user + punctuation;
     * }
     *
     * var object = { 'user': 'fred' };
     *
     * var bound = _.bind(greet, object, 'hi');
     * bound('!');
     * // => 'hi fred!'
     *
     * // Bound with placeholders.
     * var bound = _.bind(greet, object, _, '!');
     * bound('hi');
     * // => 'hi fred!'
     */
    var bind = baseRest(function(func, thisArg, partials) {
      var bitmask = WRAP_BIND_FLAG;
      if (partials.length) {
        var holders = replaceHolders(partials, getHolder(bind));
        bitmask |= WRAP_PARTIAL_FLAG;
      }
      return createWrap(func, bitmask, thisArg, partials, holders);
    });

    /**
     * Creates a function that invokes the method at `object[key]` with `partials`
     * prepended to the arguments it receives.
     *
     * This method differs from `_.bind` by allowing bound functions to reference
     * methods that may be redefined or don't yet exist. See
     * [Peter Michaux's article](http://peter.michaux.ca/articles/lazy-function-definition-pattern)
     * for more details.
     *
     * The `_.bindKey.placeholder` value, which defaults to `_` in monolithic
     * builds, may be used as a placeholder for partially applied arguments.
     *
     * @static
     * @memberOf _
     * @since 0.10.0
     * @category Function
     * @param {Object} object The object to invoke the method on.
     * @param {string} key The key of the method.
     * @param {...*} [partials] The arguments to be partially applied.
     * @returns {Function} Returns the new bound function.
     * @example
     *
     * var object = {
     *   'user': 'fred',
     *   'greet': function(greeting, punctuation) {
     *     return greeting + ' ' + this.user + punctuation;
     *   }
     * };
     *
     * var bound = _.bindKey(object, 'greet', 'hi');
     * bound('!');
     * // => 'hi fred!'
     *
     * object.greet = function(greeting, punctuation) {
     *   return greeting + 'ya ' + this.user + punctuation;
     * };
     *
     * bound('!');
     * // => 'hiya fred!'
     *
     * // Bound with placeholders.
     * var bound = _.bindKey(object, 'greet', _, '!');
     * bound('hi');
     * // => 'hiya fred!'
     */
    var bindKey = baseRest(function(object, key, partials) {
      var bitmask = WRAP_BIND_FLAG | WRAP_BIND_KEY_FLAG;
      if (partials.length) {
        var holders = replaceHolders(partials, getHolder(bindKey));
        bitmask |= WRAP_PARTIAL_FLAG;
      }
      return createWrap(key, bitmask, object, partials, holders);
    });

    /**
     * Creates a function that accepts arguments of `func` and either invokes
     * `func` returning its result, if at least `arity` number of arguments have
     * been provided, or returns a function that accepts the remaining `func`
     * arguments, and so on. The arity of `func` may be specified if `func.length`
     * is not sufficient.
     *
     * The `_.curry.placeholder` value, which defaults to `_` in monolithic builds,
     * may be used as a placeholder for provided arguments.
     *
     * **Note:** This method doesn't set the "length" property of curried functions.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Function
     * @param {Function} func The function to curry.
     * @param {number} [arity=func.length] The arity of `func`.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Function} Returns the new curried function.
     * @example
     *
     * var abc = function(a, b, c) {
     *   return [a, b, c];
     * };
     *
     * var curried = _.curry(abc);
     *
     * curried(1)(2)(3);
     * // => [1, 2, 3]
     *
     * curried(1, 2)(3);
     * // => [1, 2, 3]
     *
     * curried(1, 2, 3);
     * // => [1, 2, 3]
     *
     * // Curried with placeholders.
     * curried(1)(_, 3)(2);
     * // => [1, 2, 3]
     */
    function curry(func, arity, guard) {
      arity = guard ? undefined : arity;
      var result = createWrap(func, WRAP_CURRY_FLAG, undefined, undefined, undefined, undefined, undefined, arity);
      result.placeholder = curry.placeholder;
      return result;
    }

    /**
     * This method is like `_.curry` except that arguments are applied to `func`
     * in the manner of `_.partialRight` instead of `_.partial`.
     *
     * The `_.curryRight.placeholder` value, which defaults to `_` in monolithic
     * builds, may be used as a placeholder for provided arguments.
     *
     * **Note:** This method doesn't set the "length" property of curried functions.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Function
     * @param {Function} func The function to curry.
     * @param {number} [arity=func.length] The arity of `func`.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Function} Returns the new curried function.
     * @example
     *
     * var abc = function(a, b, c) {
     *   return [a, b, c];
     * };
     *
     * var curried = _.curryRight(abc);
     *
     * curried(3)(2)(1);
     * // => [1, 2, 3]
     *
     * curried(2, 3)(1);
     * // => [1, 2, 3]
     *
     * curried(1, 2, 3);
     * // => [1, 2, 3]
     *
     * // Curried with placeholders.
     * curried(3)(1, _)(2);
     * // => [1, 2, 3]
     */
    function curryRight(func, arity, guard) {
      arity = guard ? undefined : arity;
      var result = createWrap(func, WRAP_CURRY_RIGHT_FLAG, undefined, undefined, undefined, undefined, undefined, arity);
      result.placeholder = curryRight.placeholder;
      return result;
    }

    /**
     * Creates a debounced function that delays invoking `func` until after `wait`
     * milliseconds have elapsed since the last time the debounced function was
     * invoked. The debounced function comes with a `cancel` method to cancel
     * delayed `func` invocations and a `flush` method to immediately invoke them.
     * Provide `options` to indicate whether `func` should be invoked on the
     * leading and/or trailing edge of the `wait` timeout. The `func` is invoked
     * with the last arguments provided to the debounced function. Subsequent
     * calls to the debounced function return the result of the last `func`
     * invocation.
     *
     * **Note:** If `leading` and `trailing` options are `true`, `func` is
     * invoked on the trailing edge of the timeout only if the debounced function
     * is invoked more than once during the `wait` timeout.
     *
     * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred
     * until to the next tick, similar to `setTimeout` with a timeout of `0`.
     *
     * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)
     * for details over the differences between `_.debounce` and `_.throttle`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {Function} func The function to debounce.
     * @param {number} [wait=0] The number of milliseconds to delay.
     * @param {Object} [options={}] The options object.
     * @param {boolean} [options.leading=false]
     *  Specify invoking on the leading edge of the timeout.
     * @param {number} [options.maxWait]
     *  The maximum time `func` is allowed to be delayed before it's invoked.
     * @param {boolean} [options.trailing=true]
     *  Specify invoking on the trailing edge of the timeout.
     * @returns {Function} Returns the new debounced function.
     * @example
     *
     * // Avoid costly calculations while the window size is in flux.
     * jQuery(window).on('resize', _.debounce(calculateLayout, 150));
     *
     * // Invoke `sendMail` when clicked, debouncing subsequent calls.
     * jQuery(element).on('click', _.debounce(sendMail, 300, {
     *   'leading': true,
     *   'trailing': false
     * }));
     *
     * // Ensure `batchLog` is invoked once after 1 second of debounced calls.
     * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });
     * var source = new EventSource('/stream');
     * jQuery(source).on('message', debounced);
     *
     * // Cancel the trailing debounced invocation.
     * jQuery(window).on('popstate', debounced.cancel);
     */
    function debounce(func, wait, options) {
      var lastArgs,
          lastThis,
          maxWait,
          result,
          timerId,
          lastCallTime,
          lastInvokeTime = 0,
          leading = false,
          maxing = false,
          trailing = true;

      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      wait = toNumber(wait) || 0;
      if (isObject(options)) {
        leading = !!options.leading;
        maxing = 'maxWait' in options;
        maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;
        trailing = 'trailing' in options ? !!options.trailing : trailing;
      }

      function invokeFunc(time) {
        var args = lastArgs,
            thisArg = lastThis;

        lastArgs = lastThis = undefined;
        lastInvokeTime = time;
        result = func.apply(thisArg, args);
        return result;
      }

      function leadingEdge(time) {
        // Reset any `maxWait` timer.
        lastInvokeTime = time;
        // Start the timer for the trailing edge.
        timerId = setTimeout(timerExpired, wait);
        // Invoke the leading edge.
        return leading ? invokeFunc(time) : result;
      }

      function remainingWait(time) {
        var timeSinceLastCall = time - lastCallTime,
            timeSinceLastInvoke = time - lastInvokeTime,
            result = wait - timeSinceLastCall;

        return maxing ? nativeMin(result, maxWait - timeSinceLastInvoke) : result;
      }

      function shouldInvoke(time) {
        var timeSinceLastCall = time - lastCallTime,
            timeSinceLastInvoke = time - lastInvokeTime;

        // Either this is the first call, activity has stopped and we're at the
        // trailing edge, the system time has gone backwards and we're treating
        // it as the trailing edge, or we've hit the `maxWait` limit.
        return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||
          (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));
      }

      function timerExpired() {
        var time = now();
        if (shouldInvoke(time)) {
          return trailingEdge(time);
        }
        // Restart the timer.
        timerId = setTimeout(timerExpired, remainingWait(time));
      }

      function trailingEdge(time) {
        timerId = undefined;

        // Only invoke if we have `lastArgs` which means `func` has been
        // debounced at least once.
        if (trailing && lastArgs) {
          return invokeFunc(time);
        }
        lastArgs = lastThis = undefined;
        return result;
      }

      function cancel() {
        if (timerId !== undefined) {
          clearTimeout(timerId);
        }
        lastInvokeTime = 0;
        lastArgs = lastCallTime = lastThis = timerId = undefined;
      }

      function flush() {
        return timerId === undefined ? result : trailingEdge(now());
      }

      function debounced() {
        var time = now(),
            isInvoking = shouldInvoke(time);

        lastArgs = arguments;
        lastThis = this;
        lastCallTime = time;

        if (isInvoking) {
          if (timerId === undefined) {
            return leadingEdge(lastCallTime);
          }
          if (maxing) {
            // Handle invocations in a tight loop.
            timerId = setTimeout(timerExpired, wait);
            return invokeFunc(lastCallTime);
          }
        }
        if (timerId === undefined) {
          timerId = setTimeout(timerExpired, wait);
        }
        return result;
      }
      debounced.cancel = cancel;
      debounced.flush = flush;
      return debounced;
    }

    /**
     * Defers invoking the `func` until the current call stack has cleared. Any
     * additional arguments are provided to `func` when it's invoked.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {Function} func The function to defer.
     * @param {...*} [args] The arguments to invoke `func` with.
     * @returns {number} Returns the timer id.
     * @example
     *
     * _.defer(function(text) {
     *   console.log(text);
     * }, 'deferred');
     * // => Logs 'deferred' after one millisecond.
     */
    var defer = baseRest(function(func, args) {
      return baseDelay(func, 1, args);
    });

    /**
     * Invokes `func` after `wait` milliseconds. Any additional arguments are
     * provided to `func` when it's invoked.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {Function} func The function to delay.
     * @param {number} wait The number of milliseconds to delay invocation.
     * @param {...*} [args] The arguments to invoke `func` with.
     * @returns {number} Returns the timer id.
     * @example
     *
     * _.delay(function(text) {
     *   console.log(text);
     * }, 1000, 'later');
     * // => Logs 'later' after one second.
     */
    var delay = baseRest(function(func, wait, args) {
      return baseDelay(func, toNumber(wait) || 0, args);
    });

    /**
     * Creates a function that invokes `func` with arguments reversed.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Function
     * @param {Function} func The function to flip arguments for.
     * @returns {Function} Returns the new flipped function.
     * @example
     *
     * var flipped = _.flip(function() {
     *   return _.toArray(arguments);
     * });
     *
     * flipped('a', 'b', 'c', 'd');
     * // => ['d', 'c', 'b', 'a']
     */
    function flip(func) {
      return createWrap(func, WRAP_FLIP_FLAG);
    }

    /**
     * Creates a function that memoizes the result of `func`. If `resolver` is
     * provided, it determines the cache key for storing the result based on the
     * arguments provided to the memoized function. By default, the first argument
     * provided to the memoized function is used as the map cache key. The `func`
     * is invoked with the `this` binding of the memoized function.
     *
     * **Note:** The cache is exposed as the `cache` property on the memoized
     * function. Its creation may be customized by replacing the `_.memoize.Cache`
     * constructor with one whose instances implement the
     * [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)
     * method interface of `clear`, `delete`, `get`, `has`, and `set`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {Function} func The function to have its output memoized.
     * @param {Function} [resolver] The function to resolve the cache key.
     * @returns {Function} Returns the new memoized function.
     * @example
     *
     * var object = { 'a': 1, 'b': 2 };
     * var other = { 'c': 3, 'd': 4 };
     *
     * var values = _.memoize(_.values);
     * values(object);
     * // => [1, 2]
     *
     * values(other);
     * // => [3, 4]
     *
     * object.a = 2;
     * values(object);
     * // => [1, 2]
     *
     * // Modify the result cache.
     * values.cache.set(object, ['a', 'b']);
     * values(object);
     * // => ['a', 'b']
     *
     * // Replace `_.memoize.Cache`.
     * _.memoize.Cache = WeakMap;
     */
    function memoize(func, resolver) {
      if (typeof func != 'function' || (resolver != null && typeof resolver != 'function')) {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      var memoized = function() {
        var args = arguments,
            key = resolver ? resolver.apply(this, args) : args[0],
            cache = memoized.cache;

        if (cache.has(key)) {
          return cache.get(key);
        }
        var result = func.apply(this, args);
        memoized.cache = cache.set(key, result) || cache;
        return result;
      };
      memoized.cache = new (memoize.Cache || MapCache);
      return memoized;
    }

    // Expose `MapCache`.
    memoize.Cache = MapCache;

    /**
     * Creates a function that negates the result of the predicate `func`. The
     * `func` predicate is invoked with the `this` binding and arguments of the
     * created function.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Function
     * @param {Function} predicate The predicate to negate.
     * @returns {Function} Returns the new negated function.
     * @example
     *
     * function isEven(n) {
     *   return n % 2 == 0;
     * }
     *
     * _.filter([1, 2, 3, 4, 5, 6], _.negate(isEven));
     * // => [1, 3, 5]
     */
    function negate(predicate) {
      if (typeof predicate != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      return function() {
        var args = arguments;
        switch (args.length) {
          case 0: return !predicate.call(this);
          case 1: return !predicate.call(this, args[0]);
          case 2: return !predicate.call(this, args[0], args[1]);
          case 3: return !predicate.call(this, args[0], args[1], args[2]);
        }
        return !predicate.apply(this, args);
      };
    }

    /**
     * Creates a function that is restricted to invoking `func` once. Repeat calls
     * to the function return the value of the first invocation. The `func` is
     * invoked with the `this` binding and arguments of the created function.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {Function} func The function to restrict.
     * @returns {Function} Returns the new restricted function.
     * @example
     *
     * var initialize = _.once(createApplication);
     * initialize();
     * initialize();
     * // => `createApplication` is invoked once
     */
    function once(func) {
      return before(2, func);
    }

    /**
     * Creates a function that invokes `func` with its arguments transformed.
     *
     * @static
     * @since 4.0.0
     * @memberOf _
     * @category Function
     * @param {Function} func The function to wrap.
     * @param {...(Function|Function[])} [transforms=[_.identity]]
     *  The argument transforms.
     * @returns {Function} Returns the new function.
     * @example
     *
     * function doubled(n) {
     *   return n * 2;
     * }
     *
     * function square(n) {
     *   return n * n;
     * }
     *
     * var func = _.overArgs(function(x, y) {
     *   return [x, y];
     * }, [square, doubled]);
     *
     * func(9, 3);
     * // => [81, 6]
     *
     * func(10, 5);
     * // => [100, 10]
     */
    var overArgs = castRest(function(func, transforms) {
      transforms = (transforms.length == 1 && isArray(transforms[0]))
        ? arrayMap(transforms[0], baseUnary(getIteratee()))
        : arrayMap(baseFlatten(transforms, 1), baseUnary(getIteratee()));

      var funcsLength = transforms.length;
      return baseRest(function(args) {
        var index = -1,
            length = nativeMin(args.length, funcsLength);

        while (++index < length) {
          args[index] = transforms[index].call(this, args[index]);
        }
        return apply(func, this, args);
      });
    });

    /**
     * Creates a function that invokes `func` with `partials` prepended to the
     * arguments it receives. This method is like `_.bind` except it does **not**
     * alter the `this` binding.
     *
     * The `_.partial.placeholder` value, which defaults to `_` in monolithic
     * builds, may be used as a placeholder for partially applied arguments.
     *
     * **Note:** This method doesn't set the "length" property of partially
     * applied functions.
     *
     * @static
     * @memberOf _
     * @since 0.2.0
     * @category Function
     * @param {Function} func The function to partially apply arguments to.
     * @param {...*} [partials] The arguments to be partially applied.
     * @returns {Function} Returns the new partially applied function.
     * @example
     *
     * function greet(greeting, name) {
     *   return greeting + ' ' + name;
     * }
     *
     * var sayHelloTo = _.partial(greet, 'hello');
     * sayHelloTo('fred');
     * // => 'hello fred'
     *
     * // Partially applied with placeholders.
     * var greetFred = _.partial(greet, _, 'fred');
     * greetFred('hi');
     * // => 'hi fred'
     */
    var partial = baseRest(function(func, partials) {
      var holders = replaceHolders(partials, getHolder(partial));
      return createWrap(func, WRAP_PARTIAL_FLAG, undefined, partials, holders);
    });

    /**
     * This method is like `_.partial` except that partially applied arguments
     * are appended to the arguments it receives.
     *
     * The `_.partialRight.placeholder` value, which defaults to `_` in monolithic
     * builds, may be used as a placeholder for partially applied arguments.
     *
     * **Note:** This method doesn't set the "length" property of partially
     * applied functions.
     *
     * @static
     * @memberOf _
     * @since 1.0.0
     * @category Function
     * @param {Function} func The function to partially apply arguments to.
     * @param {...*} [partials] The arguments to be partially applied.
     * @returns {Function} Returns the new partially applied function.
     * @example
     *
     * function greet(greeting, name) {
     *   return greeting + ' ' + name;
     * }
     *
     * var greetFred = _.partialRight(greet, 'fred');
     * greetFred('hi');
     * // => 'hi fred'
     *
     * // Partially applied with placeholders.
     * var sayHelloTo = _.partialRight(greet, 'hello', _);
     * sayHelloTo('fred');
     * // => 'hello fred'
     */
    var partialRight = baseRest(function(func, partials) {
      var holders = replaceHolders(partials, getHolder(partialRight));
      return createWrap(func, WRAP_PARTIAL_RIGHT_FLAG, undefined, partials, holders);
    });

    /**
     * Creates a function that invokes `func` with arguments arranged according
     * to the specified `indexes` where the argument value at the first index is
     * provided as the first argument, the argument value at the second index is
     * provided as the second argument, and so on.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Function
     * @param {Function} func The function to rearrange arguments for.
     * @param {...(number|number[])} indexes The arranged argument indexes.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var rearged = _.rearg(function(a, b, c) {
     *   return [a, b, c];
     * }, [2, 0, 1]);
     *
     * rearged('b', 'c', 'a')
     * // => ['a', 'b', 'c']
     */
    var rearg = flatRest(function(func, indexes) {
      return createWrap(func, WRAP_REARG_FLAG, undefined, undefined, undefined, indexes);
    });

    /**
     * Creates a function that invokes `func` with the `this` binding of the
     * created function and arguments from `start` and beyond provided as
     * an array.
     *
     * **Note:** This method is based on the
     * [rest parameter](https://mdn.io/rest_parameters).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Function
     * @param {Function} func The function to apply a rest parameter to.
     * @param {number} [start=func.length-1] The start position of the rest parameter.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var say = _.rest(function(what, names) {
     *   return what + ' ' + _.initial(names).join(', ') +
     *     (_.size(names) > 1 ? ', & ' : '') + _.last(names);
     * });
     *
     * say('hello', 'fred', 'barney', 'pebbles');
     * // => 'hello fred, barney, & pebbles'
     */
    function rest(func, start) {
      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      start = start === undefined ? start : toInteger(start);
      return baseRest(func, start);
    }

    /**
     * Creates a function that invokes `func` with the `this` binding of the
     * create function and an array of arguments much like
     * [`Function#apply`](http://www.ecma-international.org/ecma-262/7.0/#sec-function.prototype.apply).
     *
     * **Note:** This method is based on the
     * [spread operator](https://mdn.io/spread_operator).
     *
     * @static
     * @memberOf _
     * @since 3.2.0
     * @category Function
     * @param {Function} func The function to spread arguments over.
     * @param {number} [start=0] The start position of the spread.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var say = _.spread(function(who, what) {
     *   return who + ' says ' + what;
     * });
     *
     * say(['fred', 'hello']);
     * // => 'fred says hello'
     *
     * var numbers = Promise.all([
     *   Promise.resolve(40),
     *   Promise.resolve(36)
     * ]);
     *
     * numbers.then(_.spread(function(x, y) {
     *   return x + y;
     * }));
     * // => a Promise of 76
     */
    function spread(func, start) {
      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      start = start == null ? 0 : nativeMax(toInteger(start), 0);
      return baseRest(function(args) {
        var array = args[start],
            otherArgs = castSlice(args, 0, start);

        if (array) {
          arrayPush(otherArgs, array);
        }
        return apply(func, this, otherArgs);
      });
    }

    /**
     * Creates a throttled function that only invokes `func` at most once per
     * every `wait` milliseconds. The throttled function comes with a `cancel`
     * method to cancel delayed `func` invocations and a `flush` method to
     * immediately invoke them. Provide `options` to indicate whether `func`
     * should be invoked on the leading and/or trailing edge of the `wait`
     * timeout. The `func` is invoked with the last arguments provided to the
     * throttled function. Subsequent calls to the throttled function return the
     * result of the last `func` invocation.
     *
     * **Note:** If `leading` and `trailing` options are `true`, `func` is
     * invoked on the trailing edge of the timeout only if the throttled function
     * is invoked more than once during the `wait` timeout.
     *
     * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred
     * until to the next tick, similar to `setTimeout` with a timeout of `0`.
     *
     * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)
     * for details over the differences between `_.throttle` and `_.debounce`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {Function} func The function to throttle.
     * @param {number} [wait=0] The number of milliseconds to throttle invocations to.
     * @param {Object} [options={}] The options object.
     * @param {boolean} [options.leading=true]
     *  Specify invoking on the leading edge of the timeout.
     * @param {boolean} [options.trailing=true]
     *  Specify invoking on the trailing edge of the timeout.
     * @returns {Function} Returns the new throttled function.
     * @example
     *
     * // Avoid excessively updating the position while scrolling.
     * jQuery(window).on('scroll', _.throttle(updatePosition, 100));
     *
     * // Invoke `renewToken` when the click event is fired, but not more than once every 5 minutes.
     * var throttled = _.throttle(renewToken, 300000, { 'trailing': false });
     * jQuery(element).on('click', throttled);
     *
     * // Cancel the trailing throttled invocation.
     * jQuery(window).on('popstate', throttled.cancel);
     */
    function throttle(func, wait, options) {
      var leading = true,
          trailing = true;

      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      if (isObject(options)) {
        leading = 'leading' in options ? !!options.leading : leading;
        trailing = 'trailing' in options ? !!options.trailing : trailing;
      }
      return debounce(func, wait, {
        'leading': leading,
        'maxWait': wait,
        'trailing': trailing
      });
    }

    /**
     * Creates a function that accepts up to one argument, ignoring any
     * additional arguments.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Function
     * @param {Function} func The function to cap arguments for.
     * @returns {Function} Returns the new capped function.
     * @example
     *
     * _.map(['6', '8', '10'], _.unary(parseInt));
     * // => [6, 8, 10]
     */
    function unary(func) {
      return ary(func, 1);
    }

    /**
     * Creates a function that provides `value` to `wrapper` as its first
     * argument. Any additional arguments provided to the function are appended
     * to those provided to the `wrapper`. The wrapper is invoked with the `this`
     * binding of the created function.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {*} value The value to wrap.
     * @param {Function} [wrapper=identity] The wrapper function.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var p = _.wrap(_.escape, function(func, text) {
     *   return '<p>' + func(text) + '</p>';
     * });
     *
     * p('fred, barney, & pebbles');
     * // => '<p>fred, barney, &amp; pebbles</p>'
     */
    function wrap(value, wrapper) {
      return partial(castFunction(wrapper), value);
    }

    /*------------------------------------------------------------------------*/

    /**
     * Casts `value` as an array if it's not one.
     *
     * @static
     * @memberOf _
     * @since 4.4.0
     * @category Lang
     * @param {*} value The value to inspect.
     * @returns {Array} Returns the cast array.
     * @example
     *
     * _.castArray(1);
     * // => [1]
     *
     * _.castArray({ 'a': 1 });
     * // => [{ 'a': 1 }]
     *
     * _.castArray('abc');
     * // => ['abc']
     *
     * _.castArray(null);
     * // => [null]
     *
     * _.castArray(undefined);
     * // => [undefined]
     *
     * _.castArray();
     * // => []
     *
     * var array = [1, 2, 3];
     * console.log(_.castArray(array) === array);
     * // => true
     */
    function castArray() {
      if (!arguments.length) {
        return [];
      }
      var value = arguments[0];
      return isArray(value) ? value : [value];
    }

    /**
     * Creates a shallow clone of `value`.
     *
     * **Note:** This method is loosely based on the
     * [structured clone algorithm](https://mdn.io/Structured_clone_algorithm)
     * and supports cloning arrays, array buffers, booleans, date objects, maps,
     * numbers, `Object` objects, regexes, sets, strings, symbols, and typed
     * arrays. The own enumerable properties of `arguments` objects are cloned
     * as plain objects. An empty object is returned for uncloneable values such
     * as error objects, functions, DOM nodes, and WeakMaps.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to clone.
     * @returns {*} Returns the cloned value.
     * @see _.cloneDeep
     * @example
     *
     * var objects = [{ 'a': 1 }, { 'b': 2 }];
     *
     * var shallow = _.clone(objects);
     * console.log(shallow[0] === objects[0]);
     * // => true
     */
    function clone(value) {
      return baseClone(value, CLONE_SYMBOLS_FLAG);
    }

    /**
     * This method is like `_.clone` except that it accepts `customizer` which
     * is invoked to produce the cloned value. If `customizer` returns `undefined`,
     * cloning is handled by the method instead. The `customizer` is invoked with
     * up to four arguments; (value [, index|key, object, stack]).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to clone.
     * @param {Function} [customizer] The function to customize cloning.
     * @returns {*} Returns the cloned value.
     * @see _.cloneDeepWith
     * @example
     *
     * function customizer(value) {
     *   if (_.isElement(value)) {
     *     return value.cloneNode(false);
     *   }
     * }
     *
     * var el = _.cloneWith(document.body, customizer);
     *
     * console.log(el === document.body);
     * // => false
     * console.log(el.nodeName);
     * // => 'BODY'
     * console.log(el.childNodes.length);
     * // => 0
     */
    function cloneWith(value, customizer) {
      customizer = typeof customizer == 'function' ? customizer : undefined;
      return baseClone(value, CLONE_SYMBOLS_FLAG, customizer);
    }

    /**
     * This method is like `_.clone` except that it recursively clones `value`.
     *
     * @static
     * @memberOf _
     * @since 1.0.0
     * @category Lang
     * @param {*} value The value to recursively clone.
     * @returns {*} Returns the deep cloned value.
     * @see _.clone
     * @example
     *
     * var objects = [{ 'a': 1 }, { 'b': 2 }];
     *
     * var deep = _.cloneDeep(objects);
     * console.log(deep[0] === objects[0]);
     * // => false
     */
    function cloneDeep(value) {
      return baseClone(value, CLONE_DEEP_FLAG | CLONE_SYMBOLS_FLAG);
    }

    /**
     * This method is like `_.cloneWith` except that it recursively clones `value`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to recursively clone.
     * @param {Function} [customizer] The function to customize cloning.
     * @returns {*} Returns the deep cloned value.
     * @see _.cloneWith
     * @example
     *
     * function customizer(value) {
     *   if (_.isElement(value)) {
     *     return value.cloneNode(true);
     *   }
     * }
     *
     * var el = _.cloneDeepWith(document.body, customizer);
     *
     * console.log(el === document.body);
     * // => false
     * console.log(el.nodeName);
     * // => 'BODY'
     * console.log(el.childNodes.length);
     * // => 20
     */
    function cloneDeepWith(value, customizer) {
      customizer = typeof customizer == 'function' ? customizer : undefined;
      return baseClone(value, CLONE_DEEP_FLAG | CLONE_SYMBOLS_FLAG, customizer);
    }

    /**
     * Checks if `object` conforms to `source` by invoking the predicate
     * properties of `source` with the corresponding property values of `object`.
     *
     * **Note:** This method is equivalent to `_.conforms` when `source` is
     * partially applied.
     *
     * @static
     * @memberOf _
     * @since 4.14.0
     * @category Lang
     * @param {Object} object The object to inspect.
     * @param {Object} source The object of property predicates to conform to.
     * @returns {boolean} Returns `true` if `object` conforms, else `false`.
     * @example
     *
     * var object = { 'a': 1, 'b': 2 };
     *
     * _.conformsTo(object, { 'b': function(n) { return n > 1; } });
     * // => true
     *
     * _.conformsTo(object, { 'b': function(n) { return n > 2; } });
     * // => false
     */
    function conformsTo(object, source) {
      return source == null || baseConformsTo(object, source, keys(source));
    }

    /**
     * Performs a
     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * comparison between two values to determine if they are equivalent.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
     * @example
     *
     * var object = { 'a': 1 };
     * var other = { 'a': 1 };
     *
     * _.eq(object, object);
     * // => true
     *
     * _.eq(object, other);
     * // => false
     *
     * _.eq('a', 'a');
     * // => true
     *
     * _.eq('a', Object('a'));
     * // => false
     *
     * _.eq(NaN, NaN);
     * // => true
     */
    function eq(value, other) {
      return value === other || (value !== value && other !== other);
    }

    /**
     * Checks if `value` is greater than `other`.
     *
     * @static
     * @memberOf _
     * @since 3.9.0
     * @category Lang
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {boolean} Returns `true` if `value` is greater than `other`,
     *  else `false`.
     * @see _.lt
     * @example
     *
     * _.gt(3, 1);
     * // => true
     *
     * _.gt(3, 3);
     * // => false
     *
     * _.gt(1, 3);
     * // => false
     */
    var gt = createRelationalOperation(baseGt);

    /**
     * Checks if `value` is greater than or equal to `other`.
     *
     * @static
     * @memberOf _
     * @since 3.9.0
     * @category Lang
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {boolean} Returns `true` if `value` is greater than or equal to
     *  `other`, else `false`.
     * @see _.lte
     * @example
     *
     * _.gte(3, 1);
     * // => true
     *
     * _.gte(3, 3);
     * // => true
     *
     * _.gte(1, 3);
     * // => false
     */
    var gte = createRelationalOperation(function(value, other) {
      return value >= other;
    });

    /**
     * Checks if `value` is likely an `arguments` object.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an `arguments` object,
     *  else `false`.
     * @example
     *
     * _.isArguments(function() { return arguments; }());
     * // => true
     *
     * _.isArguments([1, 2, 3]);
     * // => false
     */
    var isArguments = baseIsArguments(function() { return arguments; }()) ? baseIsArguments : function(value) {
      return isObjectLike(value) && hasOwnProperty.call(value, 'callee') &&
        !propertyIsEnumerable.call(value, 'callee');
    };

    /**
     * Checks if `value` is classified as an `Array` object.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an array, else `false`.
     * @example
     *
     * _.isArray([1, 2, 3]);
     * // => true
     *
     * _.isArray(document.body.children);
     * // => false
     *
     * _.isArray('abc');
     * // => false
     *
     * _.isArray(_.noop);
     * // => false
     */
    var isArray = Array.isArray;

    /**
     * Checks if `value` is classified as an `ArrayBuffer` object.
     *
     * @static
     * @memberOf _
     * @since 4.3.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an array buffer, else `false`.
     * @example
     *
     * _.isArrayBuffer(new ArrayBuffer(2));
     * // => true
     *
     * _.isArrayBuffer(new Array(2));
     * // => false
     */
    var isArrayBuffer = nodeIsArrayBuffer ? baseUnary(nodeIsArrayBuffer) : baseIsArrayBuffer;

    /**
     * Checks if `value` is array-like. A value is considered array-like if it's
     * not a function and has a `value.length` that's an integer greater than or
     * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is array-like, else `false`.
     * @example
     *
     * _.isArrayLike([1, 2, 3]);
     * // => true
     *
     * _.isArrayLike(document.body.children);
     * // => true
     *
     * _.isArrayLike('abc');
     * // => true
     *
     * _.isArrayLike(_.noop);
     * // => false
     */
    function isArrayLike(value) {
      return value != null && isLength(value.length) && !isFunction(value);
    }

    /**
     * This method is like `_.isArrayLike` except that it also checks if `value`
     * is an object.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an array-like object,
     *  else `false`.
     * @example
     *
     * _.isArrayLikeObject([1, 2, 3]);
     * // => true
     *
     * _.isArrayLikeObject(document.body.children);
     * // => true
     *
     * _.isArrayLikeObject('abc');
     * // => false
     *
     * _.isArrayLikeObject(_.noop);
     * // => false
     */
    function isArrayLikeObject(value) {
      return isObjectLike(value) && isArrayLike(value);
    }

    /**
     * Checks if `value` is classified as a boolean primitive or object.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a boolean, else `false`.
     * @example
     *
     * _.isBoolean(false);
     * // => true
     *
     * _.isBoolean(null);
     * // => false
     */
    function isBoolean(value) {
      return value === true || value === false ||
        (isObjectLike(value) && baseGetTag(value) == boolTag);
    }

    /**
     * Checks if `value` is a buffer.
     *
     * @static
     * @memberOf _
     * @since 4.3.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.
     * @example
     *
     * _.isBuffer(new Buffer(2));
     * // => true
     *
     * _.isBuffer(new Uint8Array(2));
     * // => false
     */
    var isBuffer = nativeIsBuffer || stubFalse;

    /**
     * Checks if `value` is classified as a `Date` object.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a date object, else `false`.
     * @example
     *
     * _.isDate(new Date);
     * // => true
     *
     * _.isDate('Mon April 23 2012');
     * // => false
     */
    var isDate = nodeIsDate ? baseUnary(nodeIsDate) : baseIsDate;

    /**
     * Checks if `value` is likely a DOM element.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a DOM element, else `false`.
     * @example
     *
     * _.isElement(document.body);
     * // => true
     *
     * _.isElement('<body>');
     * // => false
     */
    function isElement(value) {
      return isObjectLike(value) && value.nodeType === 1 && !isPlainObject(value);
    }

    /**
     * Checks if `value` is an empty object, collection, map, or set.
     *
     * Objects are considered empty if they have no own enumerable string keyed
     * properties.
     *
     * Array-like values such as `arguments` objects, arrays, buffers, strings, or
     * jQuery-like collections are considered empty if they have a `length` of `0`.
     * Similarly, maps and sets are considered empty if they have a `size` of `0`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is empty, else `false`.
     * @example
     *
     * _.isEmpty(null);
     * // => true
     *
     * _.isEmpty(true);
     * // => true
     *
     * _.isEmpty(1);
     * // => true
     *
     * _.isEmpty([1, 2, 3]);
     * // => false
     *
     * _.isEmpty({ 'a': 1 });
     * // => false
     */
    function isEmpty(value) {
      if (value == null) {
        return true;
      }
      if (isArrayLike(value) &&
          (isArray(value) || typeof value == 'string' || typeof value.splice == 'function' ||
            isBuffer(value) || isTypedArray(value) || isArguments(value))) {
        return !value.length;
      }
      var tag = getTag(value);
      if (tag == mapTag || tag == setTag) {
        return !value.size;
      }
      if (isPrototype(value)) {
        return !baseKeys(value).length;
      }
      for (var key in value) {
        if (hasOwnProperty.call(value, key)) {
          return false;
        }
      }
      return true;
    }

    /**
     * Performs a deep comparison between two values to determine if they are
     * equivalent.
     *
     * **Note:** This method supports comparing arrays, array buffers, booleans,
     * date objects, error objects, maps, numbers, `Object` objects, regexes,
     * sets, strings, symbols, and typed arrays. `Object` objects are compared
     * by their own, not inherited, enumerable properties. Functions and DOM
     * nodes are compared by strict equality, i.e. `===`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
     * @example
     *
     * var object = { 'a': 1 };
     * var other = { 'a': 1 };
     *
     * _.isEqual(object, other);
     * // => true
     *
     * object === other;
     * // => false
     */
    function isEqual(value, other) {
      return baseIsEqual(value, other);
    }

    /**
     * This method is like `_.isEqual` except that it accepts `customizer` which
     * is invoked to compare values. If `customizer` returns `undefined`, comparisons
     * are handled by the method instead. The `customizer` is invoked with up to
     * six arguments: (objValue, othValue [, index|key, object, other, stack]).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @param {Function} [customizer] The function to customize comparisons.
     * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
     * @example
     *
     * function isGreeting(value) {
     *   return /^h(?:i|ello)$/.test(value);
     * }
     *
     * function customizer(objValue, othValue) {
     *   if (isGreeting(objValue) && isGreeting(othValue)) {
     *     return true;
     *   }
     * }
     *
     * var array = ['hello', 'goodbye'];
     * var other = ['hi', 'goodbye'];
     *
     * _.isEqualWith(array, other, customizer);
     * // => true
     */
    function isEqualWith(value, other, customizer) {
      customizer = typeof customizer == 'function' ? customizer : undefined;
      var result = customizer ? customizer(value, other) : undefined;
      return result === undefined ? baseIsEqual(value, other, undefined, customizer) : !!result;
    }

    /**
     * Checks if `value` is an `Error`, `EvalError`, `RangeError`, `ReferenceError`,
     * `SyntaxError`, `TypeError`, or `URIError` object.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an error object, else `false`.
     * @example
     *
     * _.isError(new Error);
     * // => true
     *
     * _.isError(Error);
     * // => false
     */
    function isError(value) {
      if (!isObjectLike(value)) {
        return false;
      }
      var tag = baseGetTag(value);
      return tag == errorTag || tag == domExcTag ||
        (typeof value.message == 'string' && typeof value.name == 'string' && !isPlainObject(value));
    }

    /**
     * Checks if `value` is a finite primitive number.
     *
     * **Note:** This method is based on
     * [`Number.isFinite`](https://mdn.io/Number/isFinite).
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a finite number, else `false`.
     * @example
     *
     * _.isFinite(3);
     * // => true
     *
     * _.isFinite(Number.MIN_VALUE);
     * // => true
     *
     * _.isFinite(Infinity);
     * // => false
     *
     * _.isFinite('3');
     * // => false
     */
    function isFinite(value) {
      return typeof value == 'number' && nativeIsFinite(value);
    }

    /**
     * Checks if `value` is classified as a `Function` object.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a function, else `false`.
     * @example
     *
     * _.isFunction(_);
     * // => true
     *
     * _.isFunction(/abc/);
     * // => false
     */
    function isFunction(value) {
      if (!isObject(value)) {
        return false;
      }
      // The use of `Object#toString` avoids issues with the `typeof` operator
      // in Safari 9 which returns 'object' for typed arrays and other constructors.
      var tag = baseGetTag(value);
      return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;
    }

    /**
     * Checks if `value` is an integer.
     *
     * **Note:** This method is based on
     * [`Number.isInteger`](https://mdn.io/Number/isInteger).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an integer, else `false`.
     * @example
     *
     * _.isInteger(3);
     * // => true
     *
     * _.isInteger(Number.MIN_VALUE);
     * // => false
     *
     * _.isInteger(Infinity);
     * // => false
     *
     * _.isInteger('3');
     * // => false
     */
    function isInteger(value) {
      return typeof value == 'number' && value == toInteger(value);
    }

    /**
     * Checks if `value` is a valid array-like length.
     *
     * **Note:** This method is loosely based on
     * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.
     * @example
     *
     * _.isLength(3);
     * // => true
     *
     * _.isLength(Number.MIN_VALUE);
     * // => false
     *
     * _.isLength(Infinity);
     * // => false
     *
     * _.isLength('3');
     * // => false
     */
    function isLength(value) {
      return typeof value == 'number' &&
        value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;
    }

    /**
     * Checks if `value` is the
     * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)
     * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an object, else `false`.
     * @example
     *
     * _.isObject({});
     * // => true
     *
     * _.isObject([1, 2, 3]);
     * // => true
     *
     * _.isObject(_.noop);
     * // => true
     *
     * _.isObject(null);
     * // => false
     */
    function isObject(value) {
      var type = typeof value;
      return value != null && (type == 'object' || type == 'function');
    }

    /**
     * Checks if `value` is object-like. A value is object-like if it's not `null`
     * and has a `typeof` result of "object".
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
     * @example
     *
     * _.isObjectLike({});
     * // => true
     *
     * _.isObjectLike([1, 2, 3]);
     * // => true
     *
     * _.isObjectLike(_.noop);
     * // => false
     *
     * _.isObjectLike(null);
     * // => false
     */
    function isObjectLike(value) {
      return value != null && typeof value == 'object';
    }

    /**
     * Checks if `value` is classified as a `Map` object.
     *
     * @static
     * @memberOf _
     * @since 4.3.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a map, else `false`.
     * @example
     *
     * _.isMap(new Map);
     * // => true
     *
     * _.isMap(new WeakMap);
     * // => false
     */
    var isMap = nodeIsMap ? baseUnary(nodeIsMap) : baseIsMap;

    /**
     * Performs a partial deep comparison between `object` and `source` to
     * determine if `object` contains equivalent property values.
     *
     * **Note:** This method is equivalent to `_.matches` when `source` is
     * partially applied.
     *
     * Partial comparisons will match empty array and empty object `source`
     * values against any array or object value, respectively. See `_.isEqual`
     * for a list of supported value comparisons.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Lang
     * @param {Object} object The object to inspect.
     * @param {Object} source The object of property values to match.
     * @returns {boolean} Returns `true` if `object` is a match, else `false`.
     * @example
     *
     * var object = { 'a': 1, 'b': 2 };
     *
     * _.isMatch(object, { 'b': 2 });
     * // => true
     *
     * _.isMatch(object, { 'b': 1 });
     * // => false
     */
    function isMatch(object, source) {
      return object === source || baseIsMatch(object, source, getMatchData(source));
    }

    /**
     * This method is like `_.isMatch` except that it accepts `customizer` which
     * is invoked to compare values. If `customizer` returns `undefined`, comparisons
     * are handled by the method instead. The `customizer` is invoked with five
     * arguments: (objValue, srcValue, index|key, object, source).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {Object} object The object to inspect.
     * @param {Object} source The object of property values to match.
     * @param {Function} [customizer] The function to customize comparisons.
     * @returns {boolean} Returns `true` if `object` is a match, else `false`.
     * @example
     *
     * function isGreeting(value) {
     *   return /^h(?:i|ello)$/.test(value);
     * }
     *
     * function customizer(objValue, srcValue) {
     *   if (isGreeting(objValue) && isGreeting(srcValue)) {
     *     return true;
     *   }
     * }
     *
     * var object = { 'greeting': 'hello' };
     * var source = { 'greeting': 'hi' };
     *
     * _.isMatchWith(object, source, customizer);
     * // => true
     */
    function isMatchWith(object, source, customizer) {
      customizer = typeof customizer == 'function' ? customizer : undefined;
      return baseIsMatch(object, source, getMatchData(source), customizer);
    }

    /**
     * Checks if `value` is `NaN`.
     *
     * **Note:** This method is based on
     * [`Number.isNaN`](https://mdn.io/Number/isNaN) and is not the same as
     * global [`isNaN`](https://mdn.io/isNaN) which returns `true` for
     * `undefined` and other non-number values.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is `NaN`, else `false`.
     * @example
     *
     * _.isNaN(NaN);
     * // => true
     *
     * _.isNaN(new Number(NaN));
     * // => true
     *
     * isNaN(undefined);
     * // => true
     *
     * _.isNaN(undefined);
     * // => false
     */
    function isNaN(value) {
      // An `NaN` primitive is the only value that is not equal to itself.
      // Perform the `toStringTag` check first to avoid errors with some
      // ActiveX objects in IE.
      return isNumber(value) && value != +value;
    }

    /**
     * Checks if `value` is a pristine native function.
     *
     * **Note:** This method can't reliably detect native functions in the presence
     * of the core-js package because core-js circumvents this kind of detection.
     * Despite multiple requests, the core-js maintainer has made it clear: any
     * attempt to fix the detection will be obstructed. As a result, we're left
     * with little choice but to throw an error. Unfortunately, this also affects
     * packages, like [babel-polyfill](https://www.npmjs.com/package/babel-polyfill),
     * which rely on core-js.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a native function,
     *  else `false`.
     * @example
     *
     * _.isNative(Array.prototype.push);
     * // => true
     *
     * _.isNative(_);
     * // => false
     */
    function isNative(value) {
      if (isMaskable(value)) {
        throw new Error(CORE_ERROR_TEXT);
      }
      return baseIsNative(value);
    }

    /**
     * Checks if `value` is `null`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is `null`, else `false`.
     * @example
     *
     * _.isNull(null);
     * // => true
     *
     * _.isNull(void 0);
     * // => false
     */
    function isNull(value) {
      return value === null;
    }

    /**
     * Checks if `value` is `null` or `undefined`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is nullish, else `false`.
     * @example
     *
     * _.isNil(null);
     * // => true
     *
     * _.isNil(void 0);
     * // => true
     *
     * _.isNil(NaN);
     * // => false
     */
    function isNil(value) {
      return value == null;
    }

    /**
     * Checks if `value` is classified as a `Number` primitive or object.
     *
     * **Note:** To exclude `Infinity`, `-Infinity`, and `NaN`, which are
     * classified as numbers, use the `_.isFinite` method.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a number, else `false`.
     * @example
     *
     * _.isNumber(3);
     * // => true
     *
     * _.isNumber(Number.MIN_VALUE);
     * // => true
     *
     * _.isNumber(Infinity);
     * // => true
     *
     * _.isNumber('3');
     * // => false
     */
    function isNumber(value) {
      return typeof value == 'number' ||
        (isObjectLike(value) && baseGetTag(value) == numberTag);
    }

    /**
     * Checks if `value` is a plain object, that is, an object created by the
     * `Object` constructor or one with a `[[Prototype]]` of `null`.
     *
     * @static
     * @memberOf _
     * @since 0.8.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     * }
     *
     * _.isPlainObject(new Foo);
     * // => false
     *
     * _.isPlainObject([1, 2, 3]);
     * // => false
     *
     * _.isPlainObject({ 'x': 0, 'y': 0 });
     * // => true
     *
     * _.isPlainObject(Object.create(null));
     * // => true
     */
    function isPlainObject(value) {
      if (!isObjectLike(value) || baseGetTag(value) != objectTag) {
        return false;
      }
      var proto = getPrototype(value);
      if (proto === null) {
        return true;
      }
      var Ctor = hasOwnProperty.call(proto, 'constructor') && proto.constructor;
      return typeof Ctor == 'function' && Ctor instanceof Ctor &&
        funcToString.call(Ctor) == objectCtorString;
    }

    /**
     * Checks if `value` is classified as a `RegExp` object.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a regexp, else `false`.
     * @example
     *
     * _.isRegExp(/abc/);
     * // => true
     *
     * _.isRegExp('/abc/');
     * // => false
     */
    var isRegExp = nodeIsRegExp ? baseUnary(nodeIsRegExp) : baseIsRegExp;

    /**
     * Checks if `value` is a safe integer. An integer is safe if it's an IEEE-754
     * double precision number which isn't the result of a rounded unsafe integer.
     *
     * **Note:** This method is based on
     * [`Number.isSafeInteger`](https://mdn.io/Number/isSafeInteger).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a safe integer, else `false`.
     * @example
     *
     * _.isSafeInteger(3);
     * // => true
     *
     * _.isSafeInteger(Number.MIN_VALUE);
     * // => false
     *
     * _.isSafeInteger(Infinity);
     * // => false
     *
     * _.isSafeInteger('3');
     * // => false
     */
    function isSafeInteger(value) {
      return isInteger(value) && value >= -MAX_SAFE_INTEGER && value <= MAX_SAFE_INTEGER;
    }

    /**
     * Checks if `value` is classified as a `Set` object.
     *
     * @static
     * @memberOf _
     * @since 4.3.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a set, else `false`.
     * @example
     *
     * _.isSet(new Set);
     * // => true
     *
     * _.isSet(new WeakSet);
     * // => false
     */
    var isSet = nodeIsSet ? baseUnary(nodeIsSet) : baseIsSet;

    /**
     * Checks if `value` is classified as a `String` primitive or object.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a string, else `false`.
     * @example
     *
     * _.isString('abc');
     * // => true
     *
     * _.isString(1);
     * // => false
     */
    function isString(value) {
      return typeof value == 'string' ||
        (!isArray(value) && isObjectLike(value) && baseGetTag(value) == stringTag);
    }

    /**
     * Checks if `value` is classified as a `Symbol` primitive or object.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.
     * @example
     *
     * _.isSymbol(Symbol.iterator);
     * // => true
     *
     * _.isSymbol('abc');
     * // => false
     */
    function isSymbol(value) {
      return typeof value == 'symbol' ||
        (isObjectLike(value) && baseGetTag(value) == symbolTag);
    }

    /**
     * Checks if `value` is classified as a typed array.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.
     * @example
     *
     * _.isTypedArray(new Uint8Array);
     * // => true
     *
     * _.isTypedArray([]);
     * // => false
     */
    var isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;

    /**
     * Checks if `value` is `undefined`.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is `undefined`, else `false`.
     * @example
     *
     * _.isUndefined(void 0);
     * // => true
     *
     * _.isUndefined(null);
     * // => false
     */
    function isUndefined(value) {
      return value === undefined;
    }

    /**
     * Checks if `value` is classified as a `WeakMap` object.
     *
     * @static
     * @memberOf _
     * @since 4.3.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a weak map, else `false`.
     * @example
     *
     * _.isWeakMap(new WeakMap);
     * // => true
     *
     * _.isWeakMap(new Map);
     * // => false
     */
    function isWeakMap(value) {
      return isObjectLike(value) && getTag(value) == weakMapTag;
    }

    /**
     * Checks if `value` is classified as a `WeakSet` object.
     *
     * @static
     * @memberOf _
     * @since 4.3.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a weak set, else `false`.
     * @example
     *
     * _.isWeakSet(new WeakSet);
     * // => true
     *
     * _.isWeakSet(new Set);
     * // => false
     */
    function isWeakSet(value) {
      return isObjectLike(value) && baseGetTag(value) == weakSetTag;
    }

    /**
     * Checks if `value` is less than `other`.
     *
     * @static
     * @memberOf _
     * @since 3.9.0
     * @category Lang
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {boolean} Returns `true` if `value` is less than `other`,
     *  else `false`.
     * @see _.gt
     * @example
     *
     * _.lt(1, 3);
     * // => true
     *
     * _.lt(3, 3);
     * // => false
     *
     * _.lt(3, 1);
     * // => false
     */
    var lt = createRelationalOperation(baseLt);

    /**
     * Checks if `value` is less than or equal to `other`.
     *
     * @static
     * @memberOf _
     * @since 3.9.0
     * @category Lang
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {boolean} Returns `true` if `value` is less than or equal to
     *  `other`, else `false`.
     * @see _.gte
     * @example
     *
     * _.lte(1, 3);
     * // => true
     *
     * _.lte(3, 3);
     * // => true
     *
     * _.lte(3, 1);
     * // => false
     */
    var lte = createRelationalOperation(function(value, other) {
      return value <= other;
    });

    /**
     * Converts `value` to an array.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Lang
     * @param {*} value The value to convert.
     * @returns {Array} Returns the converted array.
     * @example
     *
     * _.toArray({ 'a': 1, 'b': 2 });
     * // => [1, 2]
     *
     * _.toArray('abc');
     * // => ['a', 'b', 'c']
     *
     * _.toArray(1);
     * // => []
     *
     * _.toArray(null);
     * // => []
     */
    function toArray(value) {
      if (!value) {
        return [];
      }
      if (isArrayLike(value)) {
        return isString(value) ? stringToArray(value) : copyArray(value);
      }
      if (symIterator && value[symIterator]) {
        return iteratorToArray(value[symIterator]());
      }
      var tag = getTag(value),
          func = tag == mapTag ? mapToArray : (tag == setTag ? setToArray : values);

      return func(value);
    }

    /**
     * Converts `value` to a finite number.
     *
     * @static
     * @memberOf _
     * @since 4.12.0
     * @category Lang
     * @param {*} value The value to convert.
     * @returns {number} Returns the converted number.
     * @example
     *
     * _.toFinite(3.2);
     * // => 3.2
     *
     * _.toFinite(Number.MIN_VALUE);
     * // => 5e-324
     *
     * _.toFinite(Infinity);
     * // => 1.7976931348623157e+308
     *
     * _.toFinite('3.2');
     * // => 3.2
     */
    function toFinite(value) {
      if (!value) {
        return value === 0 ? value : 0;
      }
      value = toNumber(value);
      if (value === INFINITY || value === -INFINITY) {
        var sign = (value < 0 ? -1 : 1);
        return sign * MAX_INTEGER;
      }
      return value === value ? value : 0;
    }

    /**
     * Converts `value` to an integer.
     *
     * **Note:** This method is loosely based on
     * [`ToInteger`](http://www.ecma-international.org/ecma-262/7.0/#sec-tointeger).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to convert.
     * @returns {number} Returns the converted integer.
     * @example
     *
     * _.toInteger(3.2);
     * // => 3
     *
     * _.toInteger(Number.MIN_VALUE);
     * // => 0
     *
     * _.toInteger(Infinity);
     * // => 1.7976931348623157e+308
     *
     * _.toInteger('3.2');
     * // => 3
     */
    function toInteger(value) {
      var result = toFinite(value),
          remainder = result % 1;

      return result === result ? (remainder ? result - remainder : result) : 0;
    }

    /**
     * Converts `value` to an integer suitable for use as the length of an
     * array-like object.
     *
     * **Note:** This method is based on
     * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to convert.
     * @returns {number} Returns the converted integer.
     * @example
     *
     * _.toLength(3.2);
     * // => 3
     *
     * _.toLength(Number.MIN_VALUE);
     * // => 0
     *
     * _.toLength(Infinity);
     * // => 4294967295
     *
     * _.toLength('3.2');
     * // => 3
     */
    function toLength(value) {
      return value ? baseClamp(toInteger(value), 0, MAX_ARRAY_LENGTH) : 0;
    }

    /**
     * Converts `value` to a number.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to process.
     * @returns {number} Returns the number.
     * @example
     *
     * _.toNumber(3.2);
     * // => 3.2
     *
     * _.toNumber(Number.MIN_VALUE);
     * // => 5e-324
     *
     * _.toNumber(Infinity);
     * // => Infinity
     *
     * _.toNumber('3.2');
     * // => 3.2
     */
    function toNumber(value) {
      if (typeof value == 'number') {
        return value;
      }
      if (isSymbol(value)) {
        return NAN;
      }
      if (isObject(value)) {
        var other = typeof value.valueOf == 'function' ? value.valueOf() : value;
        value = isObject(other) ? (other + '') : other;
      }
      if (typeof value != 'string') {
        return value === 0 ? value : +value;
      }
      value = value.replace(reTrim, '');
      var isBinary = reIsBinary.test(value);
      return (isBinary || reIsOctal.test(value))
        ? freeParseInt(value.slice(2), isBinary ? 2 : 8)
        : (reIsBadHex.test(value) ? NAN : +value);
    }

    /**
     * Converts `value` to a plain object flattening inherited enumerable string
     * keyed properties of `value` to own properties of the plain object.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Lang
     * @param {*} value The value to convert.
     * @returns {Object} Returns the converted plain object.
     * @example
     *
     * function Foo() {
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.assign({ 'a': 1 }, new Foo);
     * // => { 'a': 1, 'b': 2 }
     *
     * _.assign({ 'a': 1 }, _.toPlainObject(new Foo));
     * // => { 'a': 1, 'b': 2, 'c': 3 }
     */
    function toPlainObject(value) {
      return copyObject(value, keysIn(value));
    }

    /**
     * Converts `value` to a safe integer. A safe integer can be compared and
     * represented correctly.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to convert.
     * @returns {number} Returns the converted integer.
     * @example
     *
     * _.toSafeInteger(3.2);
     * // => 3
     *
     * _.toSafeInteger(Number.MIN_VALUE);
     * // => 0
     *
     * _.toSafeInteger(Infinity);
     * // => 9007199254740991
     *
     * _.toSafeInteger('3.2');
     * // => 3
     */
    function toSafeInteger(value) {
      return value
        ? baseClamp(toInteger(value), -MAX_SAFE_INTEGER, MAX_SAFE_INTEGER)
        : (value === 0 ? value : 0);
    }

    /**
     * Converts `value` to a string. An empty string is returned for `null`
     * and `undefined` values. The sign of `-0` is preserved.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to convert.
     * @returns {string} Returns the converted string.
     * @example
     *
     * _.toString(null);
     * // => ''
     *
     * _.toString(-0);
     * // => '-0'
     *
     * _.toString([1, 2, 3]);
     * // => '1,2,3'
     */
    function toString(value) {
      return value == null ? '' : baseToString(value);
    }

    /*------------------------------------------------------------------------*/

    /**
     * Assigns own enumerable string keyed properties of source objects to the
     * destination object. Source objects are applied from left to right.
     * Subsequent sources overwrite property assignments of previous sources.
     *
     * **Note:** This method mutates `object` and is loosely based on
     * [`Object.assign`](https://mdn.io/Object/assign).
     *
     * @static
     * @memberOf _
     * @since 0.10.0
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} [sources] The source objects.
     * @returns {Object} Returns `object`.
     * @see _.assignIn
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     * }
     *
     * function Bar() {
     *   this.c = 3;
     * }
     *
     * Foo.prototype.b = 2;
     * Bar.prototype.d = 4;
     *
     * _.assign({ 'a': 0 }, new Foo, new Bar);
     * // => { 'a': 1, 'c': 3 }
     */
    var assign = createAssigner(function(object, source) {
      if (isPrototype(source) || isArrayLike(source)) {
        copyObject(source, keys(source), object);
        return;
      }
      for (var key in source) {
        if (hasOwnProperty.call(source, key)) {
          assignValue(object, key, source[key]);
        }
      }
    });

    /**
     * This method is like `_.assign` except that it iterates over own and
     * inherited source properties.
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @alias extend
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} [sources] The source objects.
     * @returns {Object} Returns `object`.
     * @see _.assign
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     * }
     *
     * function Bar() {
     *   this.c = 3;
     * }
     *
     * Foo.prototype.b = 2;
     * Bar.prototype.d = 4;
     *
     * _.assignIn({ 'a': 0 }, new Foo, new Bar);
     * // => { 'a': 1, 'b': 2, 'c': 3, 'd': 4 }
     */
    var assignIn = createAssigner(function(object, source) {
      copyObject(source, keysIn(source), object);
    });

    /**
     * This method is like `_.assignIn` except that it accepts `customizer`
     * which is invoked to produce the assigned values. If `customizer` returns
     * `undefined`, assignment is handled by the method instead. The `customizer`
     * is invoked with five arguments: (objValue, srcValue, key, object, source).
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @alias extendWith
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} sources The source objects.
     * @param {Function} [customizer] The function to customize assigned values.
     * @returns {Object} Returns `object`.
     * @see _.assignWith
     * @example
     *
     * function customizer(objValue, srcValue) {
     *   return _.isUndefined(objValue) ? srcValue : objValue;
     * }
     *
     * var defaults = _.partialRight(_.assignInWith, customizer);
     *
     * defaults({ 'a': 1 }, { 'b': 2 }, { 'a': 3 });
     * // => { 'a': 1, 'b': 2 }
     */
    var assignInWith = createAssigner(function(object, source, srcIndex, customizer) {
      copyObject(source, keysIn(source), object, customizer);
    });

    /**
     * This method is like `_.assign` except that it accepts `customizer`
     * which is invoked to produce the assigned values. If `customizer` returns
     * `undefined`, assignment is handled by the method instead. The `customizer`
     * is invoked with five arguments: (objValue, srcValue, key, object, source).
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} sources The source objects.
     * @param {Function} [customizer] The function to customize assigned values.
     * @returns {Object} Returns `object`.
     * @see _.assignInWith
     * @example
     *
     * function customizer(objValue, srcValue) {
     *   return _.isUndefined(objValue) ? srcValue : objValue;
     * }
     *
     * var defaults = _.partialRight(_.assignWith, customizer);
     *
     * defaults({ 'a': 1 }, { 'b': 2 }, { 'a': 3 });
     * // => { 'a': 1, 'b': 2 }
     */
    var assignWith = createAssigner(function(object, source, srcIndex, customizer) {
      copyObject(source, keys(source), object, customizer);
    });

    /**
     * Creates an array of values corresponding to `paths` of `object`.
     *
     * @static
     * @memberOf _
     * @since 1.0.0
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {...(string|string[])} [paths] The property paths to pick.
     * @returns {Array} Returns the picked values.
     * @example
     *
     * var object = { 'a': [{ 'b': { 'c': 3 } }, 4] };
     *
     * _.at(object, ['a[0].b.c', 'a[1]']);
     * // => [3, 4]
     */
    var at = flatRest(baseAt);

    /**
     * Creates an object that inherits from the `prototype` object. If a
     * `properties` object is given, its own enumerable string keyed properties
     * are assigned to the created object.
     *
     * @static
     * @memberOf _
     * @since 2.3.0
     * @category Object
     * @param {Object} prototype The object to inherit from.
     * @param {Object} [properties] The properties to assign to the object.
     * @returns {Object} Returns the new object.
     * @example
     *
     * function Shape() {
     *   this.x = 0;
     *   this.y = 0;
     * }
     *
     * function Circle() {
     *   Shape.call(this);
     * }
     *
     * Circle.prototype = _.create(Shape.prototype, {
     *   'constructor': Circle
     * });
     *
     * var circle = new Circle;
     * circle instanceof Circle;
     * // => true
     *
     * circle instanceof Shape;
     * // => true
     */
    function create(prototype, properties) {
      var result = baseCreate(prototype);
      return properties == null ? result : baseAssign(result, properties);
    }

    /**
     * Assigns own and inherited enumerable string keyed properties of source
     * objects to the destination object for all destination properties that
     * resolve to `undefined`. Source objects are applied from left to right.
     * Once a property is set, additional values of the same property are ignored.
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} [sources] The source objects.
     * @returns {Object} Returns `object`.
     * @see _.defaultsDeep
     * @example
     *
     * _.defaults({ 'a': 1 }, { 'b': 2 }, { 'a': 3 });
     * // => { 'a': 1, 'b': 2 }
     */
    var defaults = baseRest(function(args) {
      args.push(undefined, customDefaultsAssignIn);
      return apply(assignInWith, undefined, args);
    });

    /**
     * This method is like `_.defaults` except that it recursively assigns
     * default properties.
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 3.10.0
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} [sources] The source objects.
     * @returns {Object} Returns `object`.
     * @see _.defaults
     * @example
     *
     * _.defaultsDeep({ 'a': { 'b': 2 } }, { 'a': { 'b': 1, 'c': 3 } });
     * // => { 'a': { 'b': 2, 'c': 3 } }
     */
    var defaultsDeep = baseRest(function(args) {
      args.push(undefined, customDefaultsMerge);
      return apply(mergeWith, undefined, args);
    });

    /**
     * This method is like `_.find` except that it returns the key of the first
     * element `predicate` returns truthy for instead of the element itself.
     *
     * @static
     * @memberOf _
     * @since 1.1.0
     * @category Object
     * @param {Object} object The object to inspect.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {string|undefined} Returns the key of the matched element,
     *  else `undefined`.
     * @example
     *
     * var users = {
     *   'barney':  { 'age': 36, 'active': true },
     *   'fred':    { 'age': 40, 'active': false },
     *   'pebbles': { 'age': 1,  'active': true }
     * };
     *
     * _.findKey(users, function(o) { return o.age < 40; });
     * // => 'barney' (iteration order is not guaranteed)
     *
     * // The `_.matches` iteratee shorthand.
     * _.findKey(users, { 'age': 1, 'active': true });
     * // => 'pebbles'
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.findKey(users, ['active', false]);
     * // => 'fred'
     *
     * // The `_.property` iteratee shorthand.
     * _.findKey(users, 'active');
     * // => 'barney'
     */
    function findKey(object, predicate) {
      return baseFindKey(object, getIteratee(predicate, 3), baseForOwn);
    }

    /**
     * This method is like `_.findKey` except that it iterates over elements of
     * a collection in the opposite order.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Object
     * @param {Object} object The object to inspect.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {string|undefined} Returns the key of the matched element,
     *  else `undefined`.
     * @example
     *
     * var users = {
     *   'barney':  { 'age': 36, 'active': true },
     *   'fred':    { 'age': 40, 'active': false },
     *   'pebbles': { 'age': 1,  'active': true }
     * };
     *
     * _.findLastKey(users, function(o) { return o.age < 40; });
     * // => returns 'pebbles' assuming `_.findKey` returns 'barney'
     *
     * // The `_.matches` iteratee shorthand.
     * _.findLastKey(users, { 'age': 36, 'active': true });
     * // => 'barney'
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.findLastKey(users, ['active', false]);
     * // => 'fred'
     *
     * // The `_.property` iteratee shorthand.
     * _.findLastKey(users, 'active');
     * // => 'pebbles'
     */
    function findLastKey(object, predicate) {
      return baseFindKey(object, getIteratee(predicate, 3), baseForOwnRight);
    }

    /**
     * Iterates over own and inherited enumerable string keyed properties of an
     * object and invokes `iteratee` for each property. The iteratee is invoked
     * with three arguments: (value, key, object). Iteratee functions may exit
     * iteration early by explicitly returning `false`.
     *
     * @static
     * @memberOf _
     * @since 0.3.0
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Object} Returns `object`.
     * @see _.forInRight
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.forIn(new Foo, function(value, key) {
     *   console.log(key);
     * });
     * // => Logs 'a', 'b', then 'c' (iteration order is not guaranteed).
     */
    function forIn(object, iteratee) {
      return object == null
        ? object
        : baseFor(object, getIteratee(iteratee, 3), keysIn);
    }

    /**
     * This method is like `_.forIn` except that it iterates over properties of
     * `object` in the opposite order.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Object} Returns `object`.
     * @see _.forIn
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.forInRight(new Foo, function(value, key) {
     *   console.log(key);
     * });
     * // => Logs 'c', 'b', then 'a' assuming `_.forIn` logs 'a', 'b', then 'c'.
     */
    function forInRight(object, iteratee) {
      return object == null
        ? object
        : baseForRight(object, getIteratee(iteratee, 3), keysIn);
    }

    /**
     * Iterates over own enumerable string keyed properties of an object and
     * invokes `iteratee` for each property. The iteratee is invoked with three
     * arguments: (value, key, object). Iteratee functions may exit iteration
     * early by explicitly returning `false`.
     *
     * @static
     * @memberOf _
     * @since 0.3.0
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Object} Returns `object`.
     * @see _.forOwnRight
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.forOwn(new Foo, function(value, key) {
     *   console.log(key);
     * });
     * // => Logs 'a' then 'b' (iteration order is not guaranteed).
     */
    function forOwn(object, iteratee) {
      return object && baseForOwn(object, getIteratee(iteratee, 3));
    }

    /**
     * This method is like `_.forOwn` except that it iterates over properties of
     * `object` in the opposite order.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Object} Returns `object`.
     * @see _.forOwn
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.forOwnRight(new Foo, function(value, key) {
     *   console.log(key);
     * });
     * // => Logs 'b' then 'a' assuming `_.forOwn` logs 'a' then 'b'.
     */
    function forOwnRight(object, iteratee) {
      return object && baseForOwnRight(object, getIteratee(iteratee, 3));
    }

    /**
     * Creates an array of function property names from own enumerable properties
     * of `object`.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Object
     * @param {Object} object The object to inspect.
     * @returns {Array} Returns the function names.
     * @see _.functionsIn
     * @example
     *
     * function Foo() {
     *   this.a = _.constant('a');
     *   this.b = _.constant('b');
     * }
     *
     * Foo.prototype.c = _.constant('c');
     *
     * _.functions(new Foo);
     * // => ['a', 'b']
     */
    function functions(object) {
      return object == null ? [] : baseFunctions(object, keys(object));
    }

    /**
     * Creates an array of function property names from own and inherited
     * enumerable properties of `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The object to inspect.
     * @returns {Array} Returns the function names.
     * @see _.functions
     * @example
     *
     * function Foo() {
     *   this.a = _.constant('a');
     *   this.b = _.constant('b');
     * }
     *
     * Foo.prototype.c = _.constant('c');
     *
     * _.functionsIn(new Foo);
     * // => ['a', 'b', 'c']
     */
    function functionsIn(object) {
      return object == null ? [] : baseFunctions(object, keysIn(object));
    }

    /**
     * Gets the value at `path` of `object`. If the resolved value is
     * `undefined`, the `defaultValue` is returned in its place.
     *
     * @static
     * @memberOf _
     * @since 3.7.0
     * @category Object
     * @param {Object} object The object to query.
     * @param {Array|string} path The path of the property to get.
     * @param {*} [defaultValue] The value returned for `undefined` resolved values.
     * @returns {*} Returns the resolved value.
     * @example
     *
     * var object = { 'a': [{ 'b': { 'c': 3 } }] };
     *
     * _.get(object, 'a[0].b.c');
     * // => 3
     *
     * _.get(object, ['a', '0', 'b', 'c']);
     * // => 3
     *
     * _.get(object, 'a.b.c', 'default');
     * // => 'default'
     */
    function get(object, path, defaultValue) {
      var result = object == null ? undefined : baseGet(object, path);
      return result === undefined ? defaultValue : result;
    }

    /**
     * Checks if `path` is a direct property of `object`.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Object
     * @param {Object} object The object to query.
     * @param {Array|string} path The path to check.
     * @returns {boolean} Returns `true` if `path` exists, else `false`.
     * @example
     *
     * var object = { 'a': { 'b': 2 } };
     * var other = _.create({ 'a': _.create({ 'b': 2 }) });
     *
     * _.has(object, 'a');
     * // => true
     *
     * _.has(object, 'a.b');
     * // => true
     *
     * _.has(object, ['a', 'b']);
     * // => true
     *
     * _.has(other, 'a');
     * // => false
     */
    function has(object, path) {
      return object != null && hasPath(object, path, baseHas);
    }

    /**
     * Checks if `path` is a direct or inherited property of `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The object to query.
     * @param {Array|string} path The path to check.
     * @returns {boolean} Returns `true` if `path` exists, else `false`.
     * @example
     *
     * var object = _.create({ 'a': _.create({ 'b': 2 }) });
     *
     * _.hasIn(object, 'a');
     * // => true
     *
     * _.hasIn(object, 'a.b');
     * // => true
     *
     * _.hasIn(object, ['a', 'b']);
     * // => true
     *
     * _.hasIn(object, 'b');
     * // => false
     */
    function hasIn(object, path) {
      return object != null && hasPath(object, path, baseHasIn);
    }

    /**
     * Creates an object composed of the inverted keys and values of `object`.
     * If `object` contains duplicate values, subsequent values overwrite
     * property assignments of previous values.
     *
     * @static
     * @memberOf _
     * @since 0.7.0
     * @category Object
     * @param {Object} object The object to invert.
     * @returns {Object} Returns the new inverted object.
     * @example
     *
     * var object = { 'a': 1, 'b': 2, 'c': 1 };
     *
     * _.invert(object);
     * // => { '1': 'c', '2': 'b' }
     */
    var invert = createInverter(function(result, value, key) {
      result[value] = key;
    }, constant(identity));

    /**
     * This method is like `_.invert` except that the inverted object is generated
     * from the results of running each element of `object` thru `iteratee`. The
     * corresponding inverted value of each inverted key is an array of keys
     * responsible for generating the inverted value. The iteratee is invoked
     * with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.1.0
     * @category Object
     * @param {Object} object The object to invert.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {Object} Returns the new inverted object.
     * @example
     *
     * var object = { 'a': 1, 'b': 2, 'c': 1 };
     *
     * _.invertBy(object);
     * // => { '1': ['a', 'c'], '2': ['b'] }
     *
     * _.invertBy(object, function(value) {
     *   return 'group' + value;
     * });
     * // => { 'group1': ['a', 'c'], 'group2': ['b'] }
     */
    var invertBy = createInverter(function(result, value, key) {
      if (hasOwnProperty.call(result, value)) {
        result[value].push(key);
      } else {
        result[value] = [key];
      }
    }, getIteratee);

    /**
     * Invokes the method at `path` of `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The object to query.
     * @param {Array|string} path The path of the method to invoke.
     * @param {...*} [args] The arguments to invoke the method with.
     * @returns {*} Returns the result of the invoked method.
     * @example
     *
     * var object = { 'a': [{ 'b': { 'c': [1, 2, 3, 4] } }] };
     *
     * _.invoke(object, 'a[0].b.c.slice', 1, 3);
     * // => [2, 3]
     */
    var invoke = baseRest(baseInvoke);

    /**
     * Creates an array of the own enumerable property names of `object`.
     *
     * **Note:** Non-object values are coerced to objects. See the
     * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)
     * for more details.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Object
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property names.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.keys(new Foo);
     * // => ['a', 'b'] (iteration order is not guaranteed)
     *
     * _.keys('hi');
     * // => ['0', '1']
     */
    function keys(object) {
      return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);
    }

    /**
     * Creates an array of the own and inherited enumerable property names of `object`.
     *
     * **Note:** Non-object values are coerced to objects.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Object
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property names.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.keysIn(new Foo);
     * // => ['a', 'b', 'c'] (iteration order is not guaranteed)
     */
    function keysIn(object) {
      return isArrayLike(object) ? arrayLikeKeys(object, true) : baseKeysIn(object);
    }

    /**
     * The opposite of `_.mapValues`; this method creates an object with the
     * same values as `object` and keys generated by running each own enumerable
     * string keyed property of `object` thru `iteratee`. The iteratee is invoked
     * with three arguments: (value, key, object).
     *
     * @static
     * @memberOf _
     * @since 3.8.0
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Object} Returns the new mapped object.
     * @see _.mapValues
     * @example
     *
     * _.mapKeys({ 'a': 1, 'b': 2 }, function(value, key) {
     *   return key + value;
     * });
     * // => { 'a1': 1, 'b2': 2 }
     */
    function mapKeys(object, iteratee) {
      var result = {};
      iteratee = getIteratee(iteratee, 3);

      baseForOwn(object, function(value, key, object) {
        baseAssignValue(result, iteratee(value, key, object), value);
      });
      return result;
    }

    /**
     * Creates an object with the same keys as `object` and values generated
     * by running each own enumerable string keyed property of `object` thru
     * `iteratee`. The iteratee is invoked with three arguments:
     * (value, key, object).
     *
     * @static
     * @memberOf _
     * @since 2.4.0
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Object} Returns the new mapped object.
     * @see _.mapKeys
     * @example
     *
     * var users = {
     *   'fred':    { 'user': 'fred',    'age': 40 },
     *   'pebbles': { 'user': 'pebbles', 'age': 1 }
     * };
     *
     * _.mapValues(users, function(o) { return o.age; });
     * // => { 'fred': 40, 'pebbles': 1 } (iteration order is not guaranteed)
     *
     * // The `_.property` iteratee shorthand.
     * _.mapValues(users, 'age');
     * // => { 'fred': 40, 'pebbles': 1 } (iteration order is not guaranteed)
     */
    function mapValues(object, iteratee) {
      var result = {};
      iteratee = getIteratee(iteratee, 3);

      baseForOwn(object, function(value, key, object) {
        baseAssignValue(result, key, iteratee(value, key, object));
      });
      return result;
    }

    /**
     * This method is like `_.assign` except that it recursively merges own and
     * inherited enumerable string keyed properties of source objects into the
     * destination object. Source properties that resolve to `undefined` are
     * skipped if a destination value exists. Array and plain object properties
     * are merged recursively. Other objects and value types are overridden by
     * assignment. Source objects are applied from left to right. Subsequent
     * sources overwrite property assignments of previous sources.
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 0.5.0
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} [sources] The source objects.
     * @returns {Object} Returns `object`.
     * @example
     *
     * var object = {
     *   'a': [{ 'b': 2 }, { 'd': 4 }]
     * };
     *
     * var other = {
     *   'a': [{ 'c': 3 }, { 'e': 5 }]
     * };
     *
     * _.merge(object, other);
     * // => { 'a': [{ 'b': 2, 'c': 3 }, { 'd': 4, 'e': 5 }] }
     */
    var merge = createAssigner(function(object, source, srcIndex) {
      baseMerge(object, source, srcIndex);
    });

    /**
     * This method is like `_.merge` except that it accepts `customizer` which
     * is invoked to produce the merged values of the destination and source
     * properties. If `customizer` returns `undefined`, merging is handled by the
     * method instead. The `customizer` is invoked with six arguments:
     * (objValue, srcValue, key, object, source, stack).
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} sources The source objects.
     * @param {Function} customizer The function to customize assigned values.
     * @returns {Object} Returns `object`.
     * @example
     *
     * function customizer(objValue, srcValue) {
     *   if (_.isArray(objValue)) {
     *     return objValue.concat(srcValue);
     *   }
     * }
     *
     * var object = { 'a': [1], 'b': [2] };
     * var other = { 'a': [3], 'b': [4] };
     *
     * _.mergeWith(object, other, customizer);
     * // => { 'a': [1, 3], 'b': [2, 4] }
     */
    var mergeWith = createAssigner(function(object, source, srcIndex, customizer) {
      baseMerge(object, source, srcIndex, customizer);
    });

    /**
     * The opposite of `_.pick`; this method creates an object composed of the
     * own and inherited enumerable property paths of `object` that are not omitted.
     *
     * **Note:** This method is considerably slower than `_.pick`.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Object
     * @param {Object} object The source object.
     * @param {...(string|string[])} [paths] The property paths to omit.
     * @returns {Object} Returns the new object.
     * @example
     *
     * var object = { 'a': 1, 'b': '2', 'c': 3 };
     *
     * _.omit(object, ['a', 'c']);
     * // => { 'b': '2' }
     */
    var omit = flatRest(function(object, paths) {
      var result = {};
      if (object == null) {
        return result;
      }
      var isDeep = false;
      paths = arrayMap(paths, function(path) {
        path = castPath(path, object);
        isDeep || (isDeep = path.length > 1);
        return path;
      });
      copyObject(object, getAllKeysIn(object), result);
      if (isDeep) {
        result = baseClone(result, CLONE_DEEP_FLAG | CLONE_FLAT_FLAG | CLONE_SYMBOLS_FLAG, customOmitClone);
      }
      var length = paths.length;
      while (length--) {
        baseUnset(result, paths[length]);
      }
      return result;
    });

    /**
     * The opposite of `_.pickBy`; this method creates an object composed of
     * the own and inherited enumerable string keyed properties of `object` that
     * `predicate` doesn't return truthy for. The predicate is invoked with two
     * arguments: (value, key).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The source object.
     * @param {Function} [predicate=_.identity] The function invoked per property.
     * @returns {Object} Returns the new object.
     * @example
     *
     * var object = { 'a': 1, 'b': '2', 'c': 3 };
     *
     * _.omitBy(object, _.isNumber);
     * // => { 'b': '2' }
     */
    function omitBy(object, predicate) {
      return pickBy(object, negate(getIteratee(predicate)));
    }

    /**
     * Creates an object composed of the picked `object` properties.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Object
     * @param {Object} object The source object.
     * @param {...(string|string[])} [paths] The property paths to pick.
     * @returns {Object} Returns the new object.
     * @example
     *
     * var object = { 'a': 1, 'b': '2', 'c': 3 };
     *
     * _.pick(object, ['a', 'c']);
     * // => { 'a': 1, 'c': 3 }
     */
    var pick = flatRest(function(object, paths) {
      return object == null ? {} : basePick(object, paths);
    });

    /**
     * Creates an object composed of the `object` properties `predicate` returns
     * truthy for. The predicate is invoked with two arguments: (value, key).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The source object.
     * @param {Function} [predicate=_.identity] The function invoked per property.
     * @returns {Object} Returns the new object.
     * @example
     *
     * var object = { 'a': 1, 'b': '2', 'c': 3 };
     *
     * _.pickBy(object, _.isNumber);
     * // => { 'a': 1, 'c': 3 }
     */
    function pickBy(object, predicate) {
      if (object == null) {
        return {};
      }
      var props = arrayMap(getAllKeysIn(object), function(prop) {
        return [prop];
      });
      predicate = getIteratee(predicate);
      return basePickBy(object, props, function(value, path) {
        return predicate(value, path[0]);
      });
    }

    /**
     * This method is like `_.get` except that if the resolved value is a
     * function it's invoked with the `this` binding of its parent object and
     * its result is returned.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Object
     * @param {Object} object The object to query.
     * @param {Array|string} path The path of the property to resolve.
     * @param {*} [defaultValue] The value returned for `undefined` resolved values.
     * @returns {*} Returns the resolved value.
     * @example
     *
     * var object = { 'a': [{ 'b': { 'c1': 3, 'c2': _.constant(4) } }] };
     *
     * _.result(object, 'a[0].b.c1');
     * // => 3
     *
     * _.result(object, 'a[0].b.c2');
     * // => 4
     *
     * _.result(object, 'a[0].b.c3', 'default');
     * // => 'default'
     *
     * _.result(object, 'a[0].b.c3', _.constant('default'));
     * // => 'default'
     */
    function result(object, path, defaultValue) {
      path = castPath(path, object);

      var index = -1,
          length = path.length;

      // Ensure the loop is entered when path is empty.
      if (!length) {
        length = 1;
        object = undefined;
      }
      while (++index < length) {
        var value = object == null ? undefined : object[toKey(path[index])];
        if (value === undefined) {
          index = length;
          value = defaultValue;
        }
        object = isFunction(value) ? value.call(object) : value;
      }
      return object;
    }

    /**
     * Sets the value at `path` of `object`. If a portion of `path` doesn't exist,
     * it's created. Arrays are created for missing index properties while objects
     * are created for all other missing properties. Use `_.setWith` to customize
     * `path` creation.
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 3.7.0
     * @category Object
     * @param {Object} object The object to modify.
     * @param {Array|string} path The path of the property to set.
     * @param {*} value The value to set.
     * @returns {Object} Returns `object`.
     * @example
     *
     * var object = { 'a': [{ 'b': { 'c': 3 } }] };
     *
     * _.set(object, 'a[0].b.c', 4);
     * console.log(object.a[0].b.c);
     * // => 4
     *
     * _.set(object, ['x', '0', 'y', 'z'], 5);
     * console.log(object.x[0].y.z);
     * // => 5
     */
    function set(object, path, value) {
      return object == null ? object : baseSet(object, path, value);
    }

    /**
     * This method is like `_.set` except that it accepts `customizer` which is
     * invoked to produce the objects of `path`.  If `customizer` returns `undefined`
     * path creation is handled by the method instead. The `customizer` is invoked
     * with three arguments: (nsValue, key, nsObject).
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The object to modify.
     * @param {Array|string} path The path of the property to set.
     * @param {*} value The value to set.
     * @param {Function} [customizer] The function to customize assigned values.
     * @returns {Object} Returns `object`.
     * @example
     *
     * var object = {};
     *
     * _.setWith(object, '[0][1]', 'a', Object);
     * // => { '0': { '1': 'a' } }
     */
    function setWith(object, path, value, customizer) {
      customizer = typeof customizer == 'function' ? customizer : undefined;
      return object == null ? object : baseSet(object, path, value, customizer);
    }

    /**
     * Creates an array of own enumerable string keyed-value pairs for `object`
     * which can be consumed by `_.fromPairs`. If `object` is a map or set, its
     * entries are returned.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @alias entries
     * @category Object
     * @param {Object} object The object to query.
     * @returns {Array} Returns the key-value pairs.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.toPairs(new Foo);
     * // => [['a', 1], ['b', 2]] (iteration order is not guaranteed)
     */
    var toPairs = createToPairs(keys);

    /**
     * Creates an array of own and inherited enumerable string keyed-value pairs
     * for `object` which can be consumed by `_.fromPairs`. If `object` is a map
     * or set, its entries are returned.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @alias entriesIn
     * @category Object
     * @param {Object} object The object to query.
     * @returns {Array} Returns the key-value pairs.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.toPairsIn(new Foo);
     * // => [['a', 1], ['b', 2], ['c', 3]] (iteration order is not guaranteed)
     */
    var toPairsIn = createToPairs(keysIn);

    /**
     * An alternative to `_.reduce`; this method transforms `object` to a new
     * `accumulator` object which is the result of running each of its own
     * enumerable string keyed properties thru `iteratee`, with each invocation
     * potentially mutating the `accumulator` object. If `accumulator` is not
     * provided, a new object with the same `[[Prototype]]` will be used. The
     * iteratee is invoked with four arguments: (accumulator, value, key, object).
     * Iteratee functions may exit iteration early by explicitly returning `false`.
     *
     * @static
     * @memberOf _
     * @since 1.3.0
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {*} [accumulator] The custom accumulator value.
     * @returns {*} Returns the accumulated value.
     * @example
     *
     * _.transform([2, 3, 4], function(result, n) {
     *   result.push(n *= n);
     *   return n % 2 == 0;
     * }, []);
     * // => [4, 9]
     *
     * _.transform({ 'a': 1, 'b': 2, 'c': 1 }, function(result, value, key) {
     *   (result[value] || (result[value] = [])).push(key);
     * }, {});
     * // => { '1': ['a', 'c'], '2': ['b'] }
     */
    function transform(object, iteratee, accumulator) {
      var isArr = isArray(object),
          isArrLike = isArr || isBuffer(object) || isTypedArray(object);

      iteratee = getIteratee(iteratee, 4);
      if (accumulator == null) {
        var Ctor = object && object.constructor;
        if (isArrLike) {
          accumulator = isArr ? new Ctor : [];
        }
        else if (isObject(object)) {
          accumulator = isFunction(Ctor) ? baseCreate(getPrototype(object)) : {};
        }
        else {
          accumulator = {};
        }
      }
      (isArrLike ? arrayEach : baseForOwn)(object, function(value, index, object) {
        return iteratee(accumulator, value, index, object);
      });
      return accumulator;
    }

    /**
     * Removes the property at `path` of `object`.
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The object to modify.
     * @param {Array|string} path The path of the property to unset.
     * @returns {boolean} Returns `true` if the property is deleted, else `false`.
     * @example
     *
     * var object = { 'a': [{ 'b': { 'c': 7 } }] };
     * _.unset(object, 'a[0].b.c');
     * // => true
     *
     * console.log(object);
     * // => { 'a': [{ 'b': {} }] };
     *
     * _.unset(object, ['a', '0', 'b', 'c']);
     * // => true
     *
     * console.log(object);
     * // => { 'a': [{ 'b': {} }] };
     */
    function unset(object, path) {
      return object == null ? true : baseUnset(object, path);
    }

    /**
     * This method is like `_.set` except that accepts `updater` to produce the
     * value to set. Use `_.updateWith` to customize `path` creation. The `updater`
     * is invoked with one argument: (value).
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 4.6.0
     * @category Object
     * @param {Object} object The object to modify.
     * @param {Array|string} path The path of the property to set.
     * @param {Function} updater The function to produce the updated value.
     * @returns {Object} Returns `object`.
     * @example
     *
     * var object = { 'a': [{ 'b': { 'c': 3 } }] };
     *
     * _.update(object, 'a[0].b.c', function(n) { return n * n; });
     * console.log(object.a[0].b.c);
     * // => 9
     *
     * _.update(object, 'x[0].y.z', function(n) { return n ? n + 1 : 0; });
     * console.log(object.x[0].y.z);
     * // => 0
     */
    function update(object, path, updater) {
      return object == null ? object : baseUpdate(object, path, castFunction(updater));
    }

    /**
     * This method is like `_.update` except that it accepts `customizer` which is
     * invoked to produce the objects of `path`.  If `customizer` returns `undefined`
     * path creation is handled by the method instead. The `customizer` is invoked
     * with three arguments: (nsValue, key, nsObject).
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 4.6.0
     * @category Object
     * @param {Object} object The object to modify.
     * @param {Array|string} path The path of the property to set.
     * @param {Function} updater The function to produce the updated value.
     * @param {Function} [customizer] The function to customize assigned values.
     * @returns {Object} Returns `object`.
     * @example
     *
     * var object = {};
     *
     * _.updateWith(object, '[0][1]', _.constant('a'), Object);
     * // => { '0': { '1': 'a' } }
     */
    function updateWith(object, path, updater, customizer) {
      customizer = typeof customizer == 'function' ? customizer : undefined;
      return object == null ? object : baseUpdate(object, path, castFunction(updater), customizer);
    }

    /**
     * Creates an array of the own enumerable string keyed property values of `object`.
     *
     * **Note:** Non-object values are coerced to objects.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Object
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property values.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.values(new Foo);
     * // => [1, 2] (iteration order is not guaranteed)
     *
     * _.values('hi');
     * // => ['h', 'i']
     */
    function values(object) {
      return object == null ? [] : baseValues(object, keys(object));
    }

    /**
     * Creates an array of the own and inherited enumerable string keyed property
     * values of `object`.
     *
     * **Note:** Non-object values are coerced to objects.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Object
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property values.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.valuesIn(new Foo);
     * // => [1, 2, 3] (iteration order is not guaranteed)
     */
    function valuesIn(object) {
      return object == null ? [] : baseValues(object, keysIn(object));
    }

    /*------------------------------------------------------------------------*/

    /**
     * Clamps `number` within the inclusive `lower` and `upper` bounds.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Number
     * @param {number} number The number to clamp.
     * @param {number} [lower] The lower bound.
     * @param {number} upper The upper bound.
     * @returns {number} Returns the clamped number.
     * @example
     *
     * _.clamp(-10, -5, 5);
     * // => -5
     *
     * _.clamp(10, -5, 5);
     * // => 5
     */
    function clamp(number, lower, upper) {
      if (upper === undefined) {
        upper = lower;
        lower = undefined;
      }
      if (upper !== undefined) {
        upper = toNumber(upper);
        upper = upper === upper ? upper : 0;
      }
      if (lower !== undefined) {
        lower = toNumber(lower);
        lower = lower === lower ? lower : 0;
      }
      return baseClamp(toNumber(number), lower, upper);
    }

    /**
     * Checks if `n` is between `start` and up to, but not including, `end`. If
     * `end` is not specified, it's set to `start` with `start` then set to `0`.
     * If `start` is greater than `end` the params are swapped to support
     * negative ranges.
     *
     * @static
     * @memberOf _
     * @since 3.3.0
     * @category Number
     * @param {number} number The number to check.
     * @param {number} [start=0] The start of the range.
     * @param {number} end The end of the range.
     * @returns {boolean} Returns `true` if `number` is in the range, else `false`.
     * @see _.range, _.rangeRight
     * @example
     *
     * _.inRange(3, 2, 4);
     * // => true
     *
     * _.inRange(4, 8);
     * // => true
     *
     * _.inRange(4, 2);
     * // => false
     *
     * _.inRange(2, 2);
     * // => false
     *
     * _.inRange(1.2, 2);
     * // => true
     *
     * _.inRange(5.2, 4);
     * // => false
     *
     * _.inRange(-3, -2, -6);
     * // => true
     */
    function inRange(number, start, end) {
      start = toFinite(start);
      if (end === undefined) {
        end = start;
        start = 0;
      } else {
        end = toFinite(end);
      }
      number = toNumber(number);
      return baseInRange(number, start, end);
    }

    /**
     * Produces a random number between the inclusive `lower` and `upper` bounds.
     * If only one argument is provided a number between `0` and the given number
     * is returned. If `floating` is `true`, or either `lower` or `upper` are
     * floats, a floating-point number is returned instead of an integer.
     *
     * **Note:** JavaScript follows the IEEE-754 standard for resolving
     * floating-point values which can produce unexpected results.
     *
     * @static
     * @memberOf _
     * @since 0.7.0
     * @category Number
     * @param {number} [lower=0] The lower bound.
     * @param {number} [upper=1] The upper bound.
     * @param {boolean} [floating] Specify returning a floating-point number.
     * @returns {number} Returns the random number.
     * @example
     *
     * _.random(0, 5);
     * // => an integer between 0 and 5
     *
     * _.random(5);
     * // => also an integer between 0 and 5
     *
     * _.random(5, true);
     * // => a floating-point number between 0 and 5
     *
     * _.random(1.2, 5.2);
     * // => a floating-point number between 1.2 and 5.2
     */
    function random(lower, upper, floating) {
      if (floating && typeof floating != 'boolean' && isIterateeCall(lower, upper, floating)) {
        upper = floating = undefined;
      }
      if (floating === undefined) {
        if (typeof upper == 'boolean') {
          floating = upper;
          upper = undefined;
        }
        else if (typeof lower == 'boolean') {
          floating = lower;
          lower = undefined;
        }
      }
      if (lower === undefined && upper === undefined) {
        lower = 0;
        upper = 1;
      }
      else {
        lower = toFinite(lower);
        if (upper === undefined) {
          upper = lower;
          lower = 0;
        } else {
          upper = toFinite(upper);
        }
      }
      if (lower > upper) {
        var temp = lower;
        lower = upper;
        upper = temp;
      }
      if (floating || lower % 1 || upper % 1) {
        var rand = nativeRandom();
        return nativeMin(lower + (rand * (upper - lower + freeParseFloat('1e-' + ((rand + '').length - 1)))), upper);
      }
      return baseRandom(lower, upper);
    }

    /*------------------------------------------------------------------------*/

    /**
     * Converts `string` to [camel case](https://en.wikipedia.org/wiki/CamelCase).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the camel cased string.
     * @example
     *
     * _.camelCase('Foo Bar');
     * // => 'fooBar'
     *
     * _.camelCase('--foo-bar--');
     * // => 'fooBar'
     *
     * _.camelCase('__FOO_BAR__');
     * // => 'fooBar'
     */
    var camelCase = createCompounder(function(result, word, index) {
      word = word.toLowerCase();
      return result + (index ? capitalize(word) : word);
    });

    /**
     * Converts the first character of `string` to upper case and the remaining
     * to lower case.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to capitalize.
     * @returns {string} Returns the capitalized string.
     * @example
     *
     * _.capitalize('FRED');
     * // => 'Fred'
     */
    function capitalize(string) {
      return upperFirst(toString(string).toLowerCase());
    }

    /**
     * Deburrs `string` by converting
     * [Latin-1 Supplement](https://en.wikipedia.org/wiki/Latin-1_Supplement_(Unicode_block)#Character_table)
     * and [Latin Extended-A](https://en.wikipedia.org/wiki/Latin_Extended-A)
     * letters to basic Latin letters and removing
     * [combining diacritical marks](https://en.wikipedia.org/wiki/Combining_Diacritical_Marks).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to deburr.
     * @returns {string} Returns the deburred string.
     * @example
     *
     * _.deburr('déjà vu');
     * // => 'deja vu'
     */
    function deburr(string) {
      string = toString(string);
      return string && string.replace(reLatin, deburrLetter).replace(reComboMark, '');
    }

    /**
     * Checks if `string` ends with the given target string.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to inspect.
     * @param {string} [target] The string to search for.
     * @param {number} [position=string.length] The position to search up to.
     * @returns {boolean} Returns `true` if `string` ends with `target`,
     *  else `false`.
     * @example
     *
     * _.endsWith('abc', 'c');
     * // => true
     *
     * _.endsWith('abc', 'b');
     * // => false
     *
     * _.endsWith('abc', 'b', 2);
     * // => true
     */
    function endsWith(string, target, position) {
      string = toString(string);
      target = baseToString(target);

      var length = string.length;
      position = position === undefined
        ? length
        : baseClamp(toInteger(position), 0, length);

      var end = position;
      position -= target.length;
      return position >= 0 && string.slice(position, end) == target;
    }

    /**
     * Converts the characters "&", "<", ">", '"', and "'" in `string` to their
     * corresponding HTML entities.
     *
     * **Note:** No other characters are escaped. To escape additional
     * characters use a third-party library like [_he_](https://mths.be/he).
     *
     * Though the ">" character is escaped for symmetry, characters like
     * ">" and "/" don't need escaping in HTML and have no special meaning
     * unless they're part of a tag or unquoted attribute value. See
     * [Mathias Bynens's article](https://mathiasbynens.be/notes/ambiguous-ampersands)
     * (under "semi-related fun fact") for more details.
     *
     * When working with HTML you should always
     * [quote attribute values](http://wonko.com/post/html-escaping) to reduce
     * XSS vectors.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to escape.
     * @returns {string} Returns the escaped string.
     * @example
     *
     * _.escape('fred, barney, & pebbles');
     * // => 'fred, barney, &amp; pebbles'
     */
    function escape(string) {
      string = toString(string);
      return (string && reHasUnescapedHtml.test(string))
        ? string.replace(reUnescapedHtml, escapeHtmlChar)
        : string;
    }

    /**
     * Escapes the `RegExp` special characters "^", "$", "\", ".", "*", "+",
     * "?", "(", ")", "[", "]", "{", "}", and "|" in `string`.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to escape.
     * @returns {string} Returns the escaped string.
     * @example
     *
     * _.escapeRegExp('[lodash](https://lodash.com/)');
     * // => '\[lodash\]\(https://lodash\.com/\)'
     */
    function escapeRegExp(string) {
      string = toString(string);
      return (string && reHasRegExpChar.test(string))
        ? string.replace(reRegExpChar, '\\$&')
        : string;
    }

    /**
     * Converts `string` to
     * [kebab case](https://en.wikipedia.org/wiki/Letter_case#Special_case_styles).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the kebab cased string.
     * @example
     *
     * _.kebabCase('Foo Bar');
     * // => 'foo-bar'
     *
     * _.kebabCase('fooBar');
     * // => 'foo-bar'
     *
     * _.kebabCase('__FOO_BAR__');
     * // => 'foo-bar'
     */
    var kebabCase = createCompounder(function(result, word, index) {
      return result + (index ? '-' : '') + word.toLowerCase();
    });

    /**
     * Converts `string`, as space separated words, to lower case.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the lower cased string.
     * @example
     *
     * _.lowerCase('--Foo-Bar--');
     * // => 'foo bar'
     *
     * _.lowerCase('fooBar');
     * // => 'foo bar'
     *
     * _.lowerCase('__FOO_BAR__');
     * // => 'foo bar'
     */
    var lowerCase = createCompounder(function(result, word, index) {
      return result + (index ? ' ' : '') + word.toLowerCase();
    });

    /**
     * Converts the first character of `string` to lower case.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the converted string.
     * @example
     *
     * _.lowerFirst('Fred');
     * // => 'fred'
     *
     * _.lowerFirst('FRED');
     * // => 'fRED'
     */
    var lowerFirst = createCaseFirst('toLowerCase');

    /**
     * Pads `string` on the left and right sides if it's shorter than `length`.
     * Padding characters are truncated if they can't be evenly divided by `length`.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to pad.
     * @param {number} [length=0] The padding length.
     * @param {string} [chars=' '] The string used as padding.
     * @returns {string} Returns the padded string.
     * @example
     *
     * _.pad('abc', 8);
     * // => '  abc   '
     *
     * _.pad('abc', 8, '_-');
     * // => '_-abc_-_'
     *
     * _.pad('abc', 3);
     * // => 'abc'
     */
    function pad(string, length, chars) {
      string = toString(string);
      length = toInteger(length);

      var strLength = length ? stringSize(string) : 0;
      if (!length || strLength >= length) {
        return string;
      }
      var mid = (length - strLength) / 2;
      return (
        createPadding(nativeFloor(mid), chars) +
        string +
        createPadding(nativeCeil(mid), chars)
      );
    }

    /**
     * Pads `string` on the right side if it's shorter than `length`. Padding
     * characters are truncated if they exceed `length`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to pad.
     * @param {number} [length=0] The padding length.
     * @param {string} [chars=' '] The string used as padding.
     * @returns {string} Returns the padded string.
     * @example
     *
     * _.padEnd('abc', 6);
     * // => 'abc   '
     *
     * _.padEnd('abc', 6, '_-');
     * // => 'abc_-_'
     *
     * _.padEnd('abc', 3);
     * // => 'abc'
     */
    function padEnd(string, length, chars) {
      string = toString(string);
      length = toInteger(length);

      var strLength = length ? stringSize(string) : 0;
      return (length && strLength < length)
        ? (string + createPadding(length - strLength, chars))
        : string;
    }

    /**
     * Pads `string` on the left side if it's shorter than `length`. Padding
     * characters are truncated if they exceed `length`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to pad.
     * @param {number} [length=0] The padding length.
     * @param {string} [chars=' '] The string used as padding.
     * @returns {string} Returns the padded string.
     * @example
     *
     * _.padStart('abc', 6);
     * // => '   abc'
     *
     * _.padStart('abc', 6, '_-');
     * // => '_-_abc'
     *
     * _.padStart('abc', 3);
     * // => 'abc'
     */
    function padStart(string, length, chars) {
      string = toString(string);
      length = toInteger(length);

      var strLength = length ? stringSize(string) : 0;
      return (length && strLength < length)
        ? (createPadding(length - strLength, chars) + string)
        : string;
    }

    /**
     * Converts `string` to an integer of the specified radix. If `radix` is
     * `undefined` or `0`, a `radix` of `10` is used unless `value` is a
     * hexadecimal, in which case a `radix` of `16` is used.
     *
     * **Note:** This method aligns with the
     * [ES5 implementation](https://es5.github.io/#x15.1.2.2) of `parseInt`.
     *
     * @static
     * @memberOf _
     * @since 1.1.0
     * @category String
     * @param {string} string The string to convert.
     * @param {number} [radix=10] The radix to interpret `value` by.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {number} Returns the converted integer.
     * @example
     *
     * _.parseInt('08');
     * // => 8
     *
     * _.map(['6', '08', '10'], _.parseInt);
     * // => [6, 8, 10]
     */
    function parseInt(string, radix, guard) {
      if (guard || radix == null) {
        radix = 0;
      } else if (radix) {
        radix = +radix;
      }
      return nativeParseInt(toString(string).replace(reTrimStart, ''), radix || 0);
    }

    /**
     * Repeats the given string `n` times.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to repeat.
     * @param {number} [n=1] The number of times to repeat the string.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {string} Returns the repeated string.
     * @example
     *
     * _.repeat('*', 3);
     * // => '***'
     *
     * _.repeat('abc', 2);
     * // => 'abcabc'
     *
     * _.repeat('abc', 0);
     * // => ''
     */
    function repeat(string, n, guard) {
      if ((guard ? isIterateeCall(string, n, guard) : n === undefined)) {
        n = 1;
      } else {
        n = toInteger(n);
      }
      return baseRepeat(toString(string), n);
    }

    /**
     * Replaces matches for `pattern` in `string` with `replacement`.
     *
     * **Note:** This method is based on
     * [`String#replace`](https://mdn.io/String/replace).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to modify.
     * @param {RegExp|string} pattern The pattern to replace.
     * @param {Function|string} replacement The match replacement.
     * @returns {string} Returns the modified string.
     * @example
     *
     * _.replace('Hi Fred', 'Fred', 'Barney');
     * // => 'Hi Barney'
     */
    function replace() {
      var args = arguments,
          string = toString(args[0]);

      return args.length < 3 ? string : string.replace(args[1], args[2]);
    }

    /**
     * Converts `string` to
     * [snake case](https://en.wikipedia.org/wiki/Snake_case).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the snake cased string.
     * @example
     *
     * _.snakeCase('Foo Bar');
     * // => 'foo_bar'
     *
     * _.snakeCase('fooBar');
     * // => 'foo_bar'
     *
     * _.snakeCase('--FOO-BAR--');
     * // => 'foo_bar'
     */
    var snakeCase = createCompounder(function(result, word, index) {
      return result + (index ? '_' : '') + word.toLowerCase();
    });

    /**
     * Splits `string` by `separator`.
     *
     * **Note:** This method is based on
     * [`String#split`](https://mdn.io/String/split).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to split.
     * @param {RegExp|string} separator The separator pattern to split by.
     * @param {number} [limit] The length to truncate results to.
     * @returns {Array} Returns the string segments.
     * @example
     *
     * _.split('a-b-c', '-', 2);
     * // => ['a', 'b']
     */
    function split(string, separator, limit) {
      if (limit && typeof limit != 'number' && isIterateeCall(string, separator, limit)) {
        separator = limit = undefined;
      }
      limit = limit === undefined ? MAX_ARRAY_LENGTH : limit >>> 0;
      if (!limit) {
        return [];
      }
      string = toString(string);
      if (string && (
            typeof separator == 'string' ||
            (separator != null && !isRegExp(separator))
          )) {
        separator = baseToString(separator);
        if (!separator && hasUnicode(string)) {
          return castSlice(stringToArray(string), 0, limit);
        }
      }
      return string.split(separator, limit);
    }

    /**
     * Converts `string` to
     * [start case](https://en.wikipedia.org/wiki/Letter_case#Stylistic_or_specialised_usage).
     *
     * @static
     * @memberOf _
     * @since 3.1.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the start cased string.
     * @example
     *
     * _.startCase('--foo-bar--');
     * // => 'Foo Bar'
     *
     * _.startCase('fooBar');
     * // => 'Foo Bar'
     *
     * _.startCase('__FOO_BAR__');
     * // => 'FOO BAR'
     */
    var startCase = createCompounder(function(result, word, index) {
      return result + (index ? ' ' : '') + upperFirst(word);
    });

    /**
     * Checks if `string` starts with the given target string.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to inspect.
     * @param {string} [target] The string to search for.
     * @param {number} [position=0] The position to search from.
     * @returns {boolean} Returns `true` if `string` starts with `target`,
     *  else `false`.
     * @example
     *
     * _.startsWith('abc', 'a');
     * // => true
     *
     * _.startsWith('abc', 'b');
     * // => false
     *
     * _.startsWith('abc', 'b', 1);
     * // => true
     */
    function startsWith(string, target, position) {
      string = toString(string);
      position = position == null
        ? 0
        : baseClamp(toInteger(position), 0, string.length);

      target = baseToString(target);
      return string.slice(position, position + target.length) == target;
    }

    /**
     * Creates a compiled template function that can interpolate data properties
     * in "interpolate" delimiters, HTML-escape interpolated data properties in
     * "escape" delimiters, and execute JavaScript in "evaluate" delimiters. Data
     * properties may be accessed as free variables in the template. If a setting
     * object is given, it takes precedence over `_.templateSettings` values.
     *
     * **Note:** In the development build `_.template` utilizes
     * [sourceURLs](http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-sourceurl)
     * for easier debugging.
     *
     * For more information on precompiling templates see
     * [lodash's custom builds documentation](https://lodash.com/custom-builds).
     *
     * For more information on Chrome extension sandboxes see
     * [Chrome's extensions documentation](https://developer.chrome.com/extensions/sandboxingEval).
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category String
     * @param {string} [string=''] The template string.
     * @param {Object} [options={}] The options object.
     * @param {RegExp} [options.escape=_.templateSettings.escape]
     *  The HTML "escape" delimiter.
     * @param {RegExp} [options.evaluate=_.templateSettings.evaluate]
     *  The "evaluate" delimiter.
     * @param {Object} [options.imports=_.templateSettings.imports]
     *  An object to import into the template as free variables.
     * @param {RegExp} [options.interpolate=_.templateSettings.interpolate]
     *  The "interpolate" delimiter.
     * @param {string} [options.sourceURL='lodash.templateSources[n]']
     *  The sourceURL of the compiled template.
     * @param {string} [options.variable='obj']
     *  The data object variable name.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Function} Returns the compiled template function.
     * @example
     *
     * // Use the "interpolate" delimiter to create a compiled template.
     * var compiled = _.template('hello <%= user %>!');
     * compiled({ 'user': 'fred' });
     * // => 'hello fred!'
     *
     * // Use the HTML "escape" delimiter to escape data property values.
     * var compiled = _.template('<b><%- value %></b>');
     * compiled({ 'value': '<script>' });
     * // => '<b>&lt;script&gt;</b>'
     *
     * // Use the "evaluate" delimiter to execute JavaScript and generate HTML.
     * var compiled = _.template('<% _.forEach(users, function(user) { %><li><%- user %></li><% }); %>');
     * compiled({ 'users': ['fred', 'barney'] });
     * // => '<li>fred</li><li>barney</li>'
     *
     * // Use the internal `print` function in "evaluate" delimiters.
     * var compiled = _.template('<% print("hello " + user); %>!');
     * compiled({ 'user': 'barney' });
     * // => 'hello barney!'
     *
     * // Use the ES template literal delimiter as an "interpolate" delimiter.
     * // Disable support by replacing the "interpolate" delimiter.
     * var compiled = _.template('hello ${ user }!');
     * compiled({ 'user': 'pebbles' });
     * // => 'hello pebbles!'
     *
     * // Use backslashes to treat delimiters as plain text.
     * var compiled = _.template('<%= "\\<%- value %\\>" %>');
     * compiled({ 'value': 'ignored' });
     * // => '<%- value %>'
     *
     * // Use the `imports` option to import `jQuery` as `jq`.
     * var text = '<% jq.each(users, function(user) { %><li><%- user %></li><% }); %>';
     * var compiled = _.template(text, { 'imports': { 'jq': jQuery } });
     * compiled({ 'users': ['fred', 'barney'] });
     * // => '<li>fred</li><li>barney</li>'
     *
     * // Use the `sourceURL` option to specify a custom sourceURL for the template.
     * var compiled = _.template('hello <%= user %>!', { 'sourceURL': '/basic/greeting.jst' });
     * compiled(data);
     * // => Find the source of "greeting.jst" under the Sources tab or Resources panel of the web inspector.
     *
     * // Use the `variable` option to ensure a with-statement isn't used in the compiled template.
     * var compiled = _.template('hi <%= data.user %>!', { 'variable': 'data' });
     * compiled.source;
     * // => function(data) {
     * //   var __t, __p = '';
     * //   __p += 'hi ' + ((__t = ( data.user )) == null ? '' : __t) + '!';
     * //   return __p;
     * // }
     *
     * // Use custom template delimiters.
     * _.templateSettings.interpolate = /{{([\s\S]+?)}}/g;
     * var compiled = _.template('hello {{ user }}!');
     * compiled({ 'user': 'mustache' });
     * // => 'hello mustache!'
     *
     * // Use the `source` property to inline compiled templates for meaningful
     * // line numbers in error messages and stack traces.
     * fs.writeFileSync(path.join(process.cwd(), 'jst.js'), '\
     *   var JST = {\
     *     "main": ' + _.template(mainText).source + '\
     *   };\
     * ');
     */
    function template(string, options, guard) {
      // Based on John Resig's `tmpl` implementation
      // (http://ejohn.org/blog/javascript-micro-templating/)
      // and Laura Doktorova's doT.js (https://github.com/olado/doT).
      var settings = lodash.templateSettings;

      if (guard && isIterateeCall(string, options, guard)) {
        options = undefined;
      }
      string = toString(string);
      options = assignInWith({}, options, settings, customDefaultsAssignIn);

      var imports = assignInWith({}, options.imports, settings.imports, customDefaultsAssignIn),
          importsKeys = keys(imports),
          importsValues = baseValues(imports, importsKeys);

      var isEscaping,
          isEvaluating,
          index = 0,
          interpolate = options.interpolate || reNoMatch,
          source = "__p += '";

      // Compile the regexp to match each delimiter.
      var reDelimiters = RegExp(
        (options.escape || reNoMatch).source + '|' +
        interpolate.source + '|' +
        (interpolate === reInterpolate ? reEsTemplate : reNoMatch).source + '|' +
        (options.evaluate || reNoMatch).source + '|$'
      , 'g');

      // Use a sourceURL for easier debugging.
      var sourceURL = '//# sourceURL=' +
        ('sourceURL' in options
          ? options.sourceURL
          : ('lodash.templateSources[' + (++templateCounter) + ']')
        ) + '\n';

      string.replace(reDelimiters, function(match, escapeValue, interpolateValue, esTemplateValue, evaluateValue, offset) {
        interpolateValue || (interpolateValue = esTemplateValue);

        // Escape characters that can't be included in string literals.
        source += string.slice(index, offset).replace(reUnescapedString, escapeStringChar);

        // Replace delimiters with snippets.
        if (escapeValue) {
          isEscaping = true;
          source += "' +\n__e(" + escapeValue + ") +\n'";
        }
        if (evaluateValue) {
          isEvaluating = true;
          source += "';\n" + evaluateValue + ";\n__p += '";
        }
        if (interpolateValue) {
          source += "' +\n((__t = (" + interpolateValue + ")) == null ? '' : __t) +\n'";
        }
        index = offset + match.length;

        // The JS engine embedded in Adobe products needs `match` returned in
        // order to produce the correct `offset` value.
        return match;
      });

      source += "';\n";

      // If `variable` is not specified wrap a with-statement around the generated
      // code to add the data object to the top of the scope chain.
      var variable = options.variable;
      if (!variable) {
        source = 'with (obj) {\n' + source + '\n}\n';
      }
      // Cleanup code by stripping empty strings.
      source = (isEvaluating ? source.replace(reEmptyStringLeading, '') : source)
        .replace(reEmptyStringMiddle, '$1')
        .replace(reEmptyStringTrailing, '$1;');

      // Frame code as the function body.
      source = 'function(' + (variable || 'obj') + ') {\n' +
        (variable
          ? ''
          : 'obj || (obj = {});\n'
        ) +
        "var __t, __p = ''" +
        (isEscaping
           ? ', __e = _.escape'
           : ''
        ) +
        (isEvaluating
          ? ', __j = Array.prototype.join;\n' +
            "function print() { __p += __j.call(arguments, '') }\n"
          : ';\n'
        ) +
        source +
        'return __p\n}';

      var result = attempt(function() {
        return Function(importsKeys, sourceURL + 'return ' + source)
          .apply(undefined, importsValues);
      });

      // Provide the compiled function's source by its `toString` method or
      // the `source` property as a convenience for inlining compiled templates.
      result.source = source;
      if (isError(result)) {
        throw result;
      }
      return result;
    }

    /**
     * Converts `string`, as a whole, to lower case just like
     * [String#toLowerCase](https://mdn.io/toLowerCase).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the lower cased string.
     * @example
     *
     * _.toLower('--Foo-Bar--');
     * // => '--foo-bar--'
     *
     * _.toLower('fooBar');
     * // => 'foobar'
     *
     * _.toLower('__FOO_BAR__');
     * // => '__foo_bar__'
     */
    function toLower(value) {
      return toString(value).toLowerCase();
    }

    /**
     * Converts `string`, as a whole, to upper case just like
     * [String#toUpperCase](https://mdn.io/toUpperCase).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the upper cased string.
     * @example
     *
     * _.toUpper('--foo-bar--');
     * // => '--FOO-BAR--'
     *
     * _.toUpper('fooBar');
     * // => 'FOOBAR'
     *
     * _.toUpper('__foo_bar__');
     * // => '__FOO_BAR__'
     */
    function toUpper(value) {
      return toString(value).toUpperCase();
    }

    /**
     * Removes leading and trailing whitespace or specified characters from `string`.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to trim.
     * @param {string} [chars=whitespace] The characters to trim.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {string} Returns the trimmed string.
     * @example
     *
     * _.trim('  abc  ');
     * // => 'abc'
     *
     * _.trim('-_-abc-_-', '_-');
     * // => 'abc'
     *
     * _.map(['  foo  ', '  bar  '], _.trim);
     * // => ['foo', 'bar']
     */
    function trim(string, chars, guard) {
      string = toString(string);
      if (string && (guard || chars === undefined)) {
        return string.replace(reTrim, '');
      }
      if (!string || !(chars = baseToString(chars))) {
        return string;
      }
      var strSymbols = stringToArray(string),
          chrSymbols = stringToArray(chars),
          start = charsStartIndex(strSymbols, chrSymbols),
          end = charsEndIndex(strSymbols, chrSymbols) + 1;

      return castSlice(strSymbols, start, end).join('');
    }

    /**
     * Removes trailing whitespace or specified characters from `string`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to trim.
     * @param {string} [chars=whitespace] The characters to trim.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {string} Returns the trimmed string.
     * @example
     *
     * _.trimEnd('  abc  ');
     * // => '  abc'
     *
     * _.trimEnd('-_-abc-_-', '_-');
     * // => '-_-abc'
     */
    function trimEnd(string, chars, guard) {
      string = toString(string);
      if (string && (guard || chars === undefined)) {
        return string.replace(reTrimEnd, '');
      }
      if (!string || !(chars = baseToString(chars))) {
        return string;
      }
      var strSymbols = stringToArray(string),
          end = charsEndIndex(strSymbols, stringToArray(chars)) + 1;

      return castSlice(strSymbols, 0, end).join('');
    }

    /**
     * Removes leading whitespace or specified characters from `string`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to trim.
     * @param {string} [chars=whitespace] The characters to trim.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {string} Returns the trimmed string.
     * @example
     *
     * _.trimStart('  abc  ');
     * // => 'abc  '
     *
     * _.trimStart('-_-abc-_-', '_-');
     * // => 'abc-_-'
     */
    function trimStart(string, chars, guard) {
      string = toString(string);
      if (string && (guard || chars === undefined)) {
        return string.replace(reTrimStart, '');
      }
      if (!string || !(chars = baseToString(chars))) {
        return string;
      }
      var strSymbols = stringToArray(string),
          start = charsStartIndex(strSymbols, stringToArray(chars));

      return castSlice(strSymbols, start).join('');
    }

    /**
     * Truncates `string` if it's longer than the given maximum string length.
     * The last characters of the truncated string are replaced with the omission
     * string which defaults to "...".
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to truncate.
     * @param {Object} [options={}] The options object.
     * @param {number} [options.length=30] The maximum string length.
     * @param {string} [options.omission='...'] The string to indicate text is omitted.
     * @param {RegExp|string} [options.separator] The separator pattern to truncate to.
     * @returns {string} Returns the truncated string.
     * @example
     *
     * _.truncate('hi-diddly-ho there, neighborino');
     * // => 'hi-diddly-ho there, neighbo...'
     *
     * _.truncate('hi-diddly-ho there, neighborino', {
     *   'length': 24,
     *   'separator': ' '
     * });
     * // => 'hi-diddly-ho there,...'
     *
     * _.truncate('hi-diddly-ho there, neighborino', {
     *   'length': 24,
     *   'separator': /,? +/
     * });
     * // => 'hi-diddly-ho there...'
     *
     * _.truncate('hi-diddly-ho there, neighborino', {
     *   'omission': ' [...]'
     * });
     * // => 'hi-diddly-ho there, neig [...]'
     */
    function truncate(string, options) {
      var length = DEFAULT_TRUNC_LENGTH,
          omission = DEFAULT_TRUNC_OMISSION;

      if (isObject(options)) {
        var separator = 'separator' in options ? options.separator : separator;
        length = 'length' in options ? toInteger(options.length) : length;
        omission = 'omission' in options ? baseToString(options.omission) : omission;
      }
      string = toString(string);

      var strLength = string.length;
      if (hasUnicode(string)) {
        var strSymbols = stringToArray(string);
        strLength = strSymbols.length;
      }
      if (length >= strLength) {
        return string;
      }
      var end = length - stringSize(omission);
      if (end < 1) {
        return omission;
      }
      var result = strSymbols
        ? castSlice(strSymbols, 0, end).join('')
        : string.slice(0, end);

      if (separator === undefined) {
        return result + omission;
      }
      if (strSymbols) {
        end += (result.length - end);
      }
      if (isRegExp(separator)) {
        if (string.slice(end).search(separator)) {
          var match,
              substring = result;

          if (!separator.global) {
            separator = RegExp(separator.source, toString(reFlags.exec(separator)) + 'g');
          }
          separator.lastIndex = 0;
          while ((match = separator.exec(substring))) {
            var newEnd = match.index;
          }
          result = result.slice(0, newEnd === undefined ? end : newEnd);
        }
      } else if (string.indexOf(baseToString(separator), end) != end) {
        var index = result.lastIndexOf(separator);
        if (index > -1) {
          result = result.slice(0, index);
        }
      }
      return result + omission;
    }

    /**
     * The inverse of `_.escape`; this method converts the HTML entities
     * `&amp;`, `&lt;`, `&gt;`, `&quot;`, and `&#39;` in `string` to
     * their corresponding characters.
     *
     * **Note:** No other HTML entities are unescaped. To unescape additional
     * HTML entities use a third-party library like [_he_](https://mths.be/he).
     *
     * @static
     * @memberOf _
     * @since 0.6.0
     * @category String
     * @param {string} [string=''] The string to unescape.
     * @returns {string} Returns the unescaped string.
     * @example
     *
     * _.unescape('fred, barney, &amp; pebbles');
     * // => 'fred, barney, & pebbles'
     */
    function unescape(string) {
      string = toString(string);
      return (string && reHasEscapedHtml.test(string))
        ? string.replace(reEscapedHtml, unescapeHtmlChar)
        : string;
    }

    /**
     * Converts `string`, as space separated words, to upper case.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the upper cased string.
     * @example
     *
     * _.upperCase('--foo-bar');
     * // => 'FOO BAR'
     *
     * _.upperCase('fooBar');
     * // => 'FOO BAR'
     *
     * _.upperCase('__foo_bar__');
     * // => 'FOO BAR'
     */
    var upperCase = createCompounder(function(result, word, index) {
      return result + (index ? ' ' : '') + word.toUpperCase();
    });

    /**
     * Converts the first character of `string` to upper case.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the converted string.
     * @example
     *
     * _.upperFirst('fred');
     * // => 'Fred'
     *
     * _.upperFirst('FRED');
     * // => 'FRED'
     */
    var upperFirst = createCaseFirst('toUpperCase');

    /**
     * Splits `string` into an array of its words.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to inspect.
     * @param {RegExp|string} [pattern] The pattern to match words.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Array} Returns the words of `string`.
     * @example
     *
     * _.words('fred, barney, & pebbles');
     * // => ['fred', 'barney', 'pebbles']
     *
     * _.words('fred, barney, & pebbles', /[^, ]+/g);
     * // => ['fred', 'barney', '&', 'pebbles']
     */
    function words(string, pattern, guard) {
      string = toString(string);
      pattern = guard ? undefined : pattern;

      if (pattern === undefined) {
        return hasUnicodeWord(string) ? unicodeWords(string) : asciiWords(string);
      }
      return string.match(pattern) || [];
    }

    /*------------------------------------------------------------------------*/

    /**
     * Attempts to invoke `func`, returning either the result or the caught error
     * object. Any additional arguments are provided to `func` when it's invoked.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Util
     * @param {Function} func The function to attempt.
     * @param {...*} [args] The arguments to invoke `func` with.
     * @returns {*} Returns the `func` result or error object.
     * @example
     *
     * // Avoid throwing errors for invalid selectors.
     * var elements = _.attempt(function(selector) {
     *   return document.querySelectorAll(selector);
     * }, '>_>');
     *
     * if (_.isError(elements)) {
     *   elements = [];
     * }
     */
    var attempt = baseRest(function(func, args) {
      try {
        return apply(func, undefined, args);
      } catch (e) {
        return isError(e) ? e : new Error(e);
      }
    });

    /**
     * Binds methods of an object to the object itself, overwriting the existing
     * method.
     *
     * **Note:** This method doesn't set the "length" property of bound functions.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Util
     * @param {Object} object The object to bind and assign the bound methods to.
     * @param {...(string|string[])} methodNames The object method names to bind.
     * @returns {Object} Returns `object`.
     * @example
     *
     * var view = {
     *   'label': 'docs',
     *   'click': function() {
     *     console.log('clicked ' + this.label);
     *   }
     * };
     *
     * _.bindAll(view, ['click']);
     * jQuery(element).on('click', view.click);
     * // => Logs 'clicked docs' when clicked.
     */
    var bindAll = flatRest(function(object, methodNames) {
      arrayEach(methodNames, function(key) {
        key = toKey(key);
        baseAssignValue(object, key, bind(object[key], object));
      });
      return object;
    });

    /**
     * Creates a function that iterates over `pairs` and invokes the corresponding
     * function of the first predicate to return truthy. The predicate-function
     * pairs are invoked with the `this` binding and arguments of the created
     * function.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Util
     * @param {Array} pairs The predicate-function pairs.
     * @returns {Function} Returns the new composite function.
     * @example
     *
     * var func = _.cond([
     *   [_.matches({ 'a': 1 }),           _.constant('matches A')],
     *   [_.conforms({ 'b': _.isNumber }), _.constant('matches B')],
     *   [_.stubTrue,                      _.constant('no match')]
     * ]);
     *
     * func({ 'a': 1, 'b': 2 });
     * // => 'matches A'
     *
     * func({ 'a': 0, 'b': 1 });
     * // => 'matches B'
     *
     * func({ 'a': '1', 'b': '2' });
     * // => 'no match'
     */
    function cond(pairs) {
      var length = pairs == null ? 0 : pairs.length,
          toIteratee = getIteratee();

      pairs = !length ? [] : arrayMap(pairs, function(pair) {
        if (typeof pair[1] != 'function') {
          throw new TypeError(FUNC_ERROR_TEXT);
        }
        return [toIteratee(pair[0]), pair[1]];
      });

      return baseRest(function(args) {
        var index = -1;
        while (++index < length) {
          var pair = pairs[index];
          if (apply(pair[0], this, args)) {
            return apply(pair[1], this, args);
          }
        }
      });
    }

    /**
     * Creates a function that invokes the predicate properties of `source` with
     * the corresponding property values of a given object, returning `true` if
     * all predicates return truthy, else `false`.
     *
     * **Note:** The created function is equivalent to `_.conformsTo` with
     * `source` partially applied.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Util
     * @param {Object} source The object of property predicates to conform to.
     * @returns {Function} Returns the new spec function.
     * @example
     *
     * var objects = [
     *   { 'a': 2, 'b': 1 },
     *   { 'a': 1, 'b': 2 }
     * ];
     *
     * _.filter(objects, _.conforms({ 'b': function(n) { return n > 1; } }));
     * // => [{ 'a': 1, 'b': 2 }]
     */
    function conforms(source) {
      return baseConforms(baseClone(source, CLONE_DEEP_FLAG));
    }

    /**
     * Creates a function that returns `value`.
     *
     * @static
     * @memberOf _
     * @since 2.4.0
     * @category Util
     * @param {*} value The value to return from the new function.
     * @returns {Function} Returns the new constant function.
     * @example
     *
     * var objects = _.times(2, _.constant({ 'a': 1 }));
     *
     * console.log(objects);
     * // => [{ 'a': 1 }, { 'a': 1 }]
     *
     * console.log(objects[0] === objects[1]);
     * // => true
     */
    function constant(value) {
      return function() {
        return value;
      };
    }

    /**
     * Checks `value` to determine whether a default value should be returned in
     * its place. The `defaultValue` is returned if `value` is `NaN`, `null`,
     * or `undefined`.
     *
     * @static
     * @memberOf _
     * @since 4.14.0
     * @category Util
     * @param {*} value The value to check.
     * @param {*} defaultValue The default value.
     * @returns {*} Returns the resolved value.
     * @example
     *
     * _.defaultTo(1, 10);
     * // => 1
     *
     * _.defaultTo(undefined, 10);
     * // => 10
     */
    function defaultTo(value, defaultValue) {
      return (value == null || value !== value) ? defaultValue : value;
    }

    /**
     * Creates a function that returns the result of invoking the given functions
     * with the `this` binding of the created function, where each successive
     * invocation is supplied the return value of the previous.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Util
     * @param {...(Function|Function[])} [funcs] The functions to invoke.
     * @returns {Function} Returns the new composite function.
     * @see _.flowRight
     * @example
     *
     * function square(n) {
     *   return n * n;
     * }
     *
     * var addSquare = _.flow([_.add, square]);
     * addSquare(1, 2);
     * // => 9
     */
    var flow = createFlow();

    /**
     * This method is like `_.flow` except that it creates a function that
     * invokes the given functions from right to left.
     *
     * @static
     * @since 3.0.0
     * @memberOf _
     * @category Util
     * @param {...(Function|Function[])} [funcs] The functions to invoke.
     * @returns {Function} Returns the new composite function.
     * @see _.flow
     * @example
     *
     * function square(n) {
     *   return n * n;
     * }
     *
     * var addSquare = _.flowRight([square, _.add]);
     * addSquare(1, 2);
     * // => 9
     */
    var flowRight = createFlow(true);

    /**
     * This method returns the first argument it receives.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Util
     * @param {*} value Any value.
     * @returns {*} Returns `value`.
     * @example
     *
     * var object = { 'a': 1 };
     *
     * console.log(_.identity(object) === object);
     * // => true
     */
    function identity(value) {
      return value;
    }

    /**
     * Creates a function that invokes `func` with the arguments of the created
     * function. If `func` is a property name, the created function returns the
     * property value for a given element. If `func` is an array or object, the
     * created function returns `true` for elements that contain the equivalent
     * source properties, otherwise it returns `false`.
     *
     * @static
     * @since 4.0.0
     * @memberOf _
     * @category Util
     * @param {*} [func=_.identity] The value to convert to a callback.
     * @returns {Function} Returns the callback.
     * @example
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36, 'active': true },
     *   { 'user': 'fred',   'age': 40, 'active': false }
     * ];
     *
     * // The `_.matches` iteratee shorthand.
     * _.filter(users, _.iteratee({ 'user': 'barney', 'active': true }));
     * // => [{ 'user': 'barney', 'age': 36, 'active': true }]
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.filter(users, _.iteratee(['user', 'fred']));
     * // => [{ 'user': 'fred', 'age': 40 }]
     *
     * // The `_.property` iteratee shorthand.
     * _.map(users, _.iteratee('user'));
     * // => ['barney', 'fred']
     *
     * // Create custom iteratee shorthands.
     * _.iteratee = _.wrap(_.iteratee, function(iteratee, func) {
     *   return !_.isRegExp(func) ? iteratee(func) : function(string) {
     *     return func.test(string);
     *   };
     * });
     *
     * _.filter(['abc', 'def'], /ef/);
     * // => ['def']
     */
    function iteratee(func) {
      return baseIteratee(typeof func == 'function' ? func : baseClone(func, CLONE_DEEP_FLAG));
    }

    /**
     * Creates a function that performs a partial deep comparison between a given
     * object and `source`, returning `true` if the given object has equivalent
     * property values, else `false`.
     *
     * **Note:** The created function is equivalent to `_.isMatch` with `source`
     * partially applied.
     *
     * Partial comparisons will match empty array and empty object `source`
     * values against any array or object value, respectively. See `_.isEqual`
     * for a list of supported value comparisons.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Util
     * @param {Object} source The object of property values to match.
     * @returns {Function} Returns the new spec function.
     * @example
     *
     * var objects = [
     *   { 'a': 1, 'b': 2, 'c': 3 },
     *   { 'a': 4, 'b': 5, 'c': 6 }
     * ];
     *
     * _.filter(objects, _.matches({ 'a': 4, 'c': 6 }));
     * // => [{ 'a': 4, 'b': 5, 'c': 6 }]
     */
    function matches(source) {
      return baseMatches(baseClone(source, CLONE_DEEP_FLAG));
    }

    /**
     * Creates a function that performs a partial deep comparison between the
     * value at `path` of a given object to `srcValue`, returning `true` if the
     * object value is equivalent, else `false`.
     *
     * **Note:** Partial comparisons will match empty array and empty object
     * `srcValue` values against any array or object value, respectively. See
     * `_.isEqual` for a list of supported value comparisons.
     *
     * @static
     * @memberOf _
     * @since 3.2.0
     * @category Util
     * @param {Array|string} path The path of the property to get.
     * @param {*} srcValue The value to match.
     * @returns {Function} Returns the new spec function.
     * @example
     *
     * var objects = [
     *   { 'a': 1, 'b': 2, 'c': 3 },
     *   { 'a': 4, 'b': 5, 'c': 6 }
     * ];
     *
     * _.find(objects, _.matchesProperty('a', 4));
     * // => { 'a': 4, 'b': 5, 'c': 6 }
     */
    function matchesProperty(path, srcValue) {
      return baseMatchesProperty(path, baseClone(srcValue, CLONE_DEEP_FLAG));
    }

    /**
     * Creates a function that invokes the method at `path` of a given object.
     * Any additional arguments are provided to the invoked method.
     *
     * @static
     * @memberOf _
     * @since 3.7.0
     * @category Util
     * @param {Array|string} path The path of the method to invoke.
     * @param {...*} [args] The arguments to invoke the method with.
     * @returns {Function} Returns the new invoker function.
     * @example
     *
     * var objects = [
     *   { 'a': { 'b': _.constant(2) } },
     *   { 'a': { 'b': _.constant(1) } }
     * ];
     *
     * _.map(objects, _.method('a.b'));
     * // => [2, 1]
     *
     * _.map(objects, _.method(['a', 'b']));
     * // => [2, 1]
     */
    var method = baseRest(function(path, args) {
      return function(object) {
        return baseInvoke(object, path, args);
      };
    });

    /**
     * The opposite of `_.method`; this method creates a function that invokes
     * the method at a given path of `object`. Any additional arguments are
     * provided to the invoked method.
     *
     * @static
     * @memberOf _
     * @since 3.7.0
     * @category Util
     * @param {Object} object The object to query.
     * @param {...*} [args] The arguments to invoke the method with.
     * @returns {Function} Returns the new invoker function.
     * @example
     *
     * var array = _.times(3, _.constant),
     *     object = { 'a': array, 'b': array, 'c': array };
     *
     * _.map(['a[2]', 'c[0]'], _.methodOf(object));
     * // => [2, 0]
     *
     * _.map([['a', '2'], ['c', '0']], _.methodOf(object));
     * // => [2, 0]
     */
    var methodOf = baseRest(function(object, args) {
      return function(path) {
        return baseInvoke(object, path, args);
      };
    });

    /**
     * Adds all own enumerable string keyed function properties of a source
     * object to the destination object. If `object` is a function, then methods
     * are added to its prototype as well.
     *
     * **Note:** Use `_.runInContext` to create a pristine `lodash` function to
     * avoid conflicts caused by modifying the original.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Util
     * @param {Function|Object} [object=lodash] The destination object.
     * @param {Object} source The object of functions to add.
     * @param {Object} [options={}] The options object.
     * @param {boolean} [options.chain=true] Specify whether mixins are chainable.
     * @returns {Function|Object} Returns `object`.
     * @example
     *
     * function vowels(string) {
     *   return _.filter(string, function(v) {
     *     return /[aeiou]/i.test(v);
     *   });
     * }
     *
     * _.mixin({ 'vowels': vowels });
     * _.vowels('fred');
     * // => ['e']
     *
     * _('fred').vowels().value();
     * // => ['e']
     *
     * _.mixin({ 'vowels': vowels }, { 'chain': false });
     * _('fred').vowels();
     * // => ['e']
     */
    function mixin(object, source, options) {
      var props = keys(source),
          methodNames = baseFunctions(source, props);

      if (options == null &&
          !(isObject(source) && (methodNames.length || !props.length))) {
        options = source;
        source = object;
        object = this;
        methodNames = baseFunctions(source, keys(source));
      }
      var chain = !(isObject(options) && 'chain' in options) || !!options.chain,
          isFunc = isFunction(object);

      arrayEach(methodNames, function(methodName) {
        var func = source[methodName];
        object[methodName] = func;
        if (isFunc) {
          object.prototype[methodName] = function() {
            var chainAll = this.__chain__;
            if (chain || chainAll) {
              var result = object(this.__wrapped__),
                  actions = result.__actions__ = copyArray(this.__actions__);

              actions.push({ 'func': func, 'args': arguments, 'thisArg': object });
              result.__chain__ = chainAll;
              return result;
            }
            return func.apply(object, arrayPush([this.value()], arguments));
          };
        }
      });

      return object;
    }

    /**
     * Reverts the `_` variable to its previous value and returns a reference to
     * the `lodash` function.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Util
     * @returns {Function} Returns the `lodash` function.
     * @example
     *
     * var lodash = _.noConflict();
     */
    function noConflict() {
      if (root._ === this) {
        root._ = oldDash;
      }
      return this;
    }

    /**
     * This method returns `undefined`.
     *
     * @static
     * @memberOf _
     * @since 2.3.0
     * @category Util
     * @example
     *
     * _.times(2, _.noop);
     * // => [undefined, undefined]
     */
    function noop() {
      // No operation performed.
    }

    /**
     * Creates a function that gets the argument at index `n`. If `n` is negative,
     * the nth argument from the end is returned.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Util
     * @param {number} [n=0] The index of the argument to return.
     * @returns {Function} Returns the new pass-thru function.
     * @example
     *
     * var func = _.nthArg(1);
     * func('a', 'b', 'c', 'd');
     * // => 'b'
     *
     * var func = _.nthArg(-2);
     * func('a', 'b', 'c', 'd');
     * // => 'c'
     */
    function nthArg(n) {
      n = toInteger(n);
      return baseRest(function(args) {
        return baseNth(args, n);
      });
    }

    /**
     * Creates a function that invokes `iteratees` with the arguments it receives
     * and returns their results.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Util
     * @param {...(Function|Function[])} [iteratees=[_.identity]]
     *  The iteratees to invoke.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var func = _.over([Math.max, Math.min]);
     *
     * func(1, 2, 3, 4);
     * // => [4, 1]
     */
    var over = createOver(arrayMap);

    /**
     * Creates a function that checks if **all** of the `predicates` return
     * truthy when invoked with the arguments it receives.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Util
     * @param {...(Function|Function[])} [predicates=[_.identity]]
     *  The predicates to check.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var func = _.overEvery([Boolean, isFinite]);
     *
     * func('1');
     * // => true
     *
     * func(null);
     * // => false
     *
     * func(NaN);
     * // => false
     */
    var overEvery = createOver(arrayEvery);

    /**
     * Creates a function that checks if **any** of the `predicates` return
     * truthy when invoked with the arguments it receives.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Util
     * @param {...(Function|Function[])} [predicates=[_.identity]]
     *  The predicates to check.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var func = _.overSome([Boolean, isFinite]);
     *
     * func('1');
     * // => true
     *
     * func(null);
     * // => true
     *
     * func(NaN);
     * // => false
     */
    var overSome = createOver(arraySome);

    /**
     * Creates a function that returns the value at `path` of a given object.
     *
     * @static
     * @memberOf _
     * @since 2.4.0
     * @category Util
     * @param {Array|string} path The path of the property to get.
     * @returns {Function} Returns the new accessor function.
     * @example
     *
     * var objects = [
     *   { 'a': { 'b': 2 } },
     *   { 'a': { 'b': 1 } }
     * ];
     *
     * _.map(objects, _.property('a.b'));
     * // => [2, 1]
     *
     * _.map(_.sortBy(objects, _.property(['a', 'b'])), 'a.b');
     * // => [1, 2]
     */
    function property(path) {
      return isKey(path) ? baseProperty(toKey(path)) : basePropertyDeep(path);
    }

    /**
     * The opposite of `_.property`; this method creates a function that returns
     * the value at a given path of `object`.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Util
     * @param {Object} object The object to query.
     * @returns {Function} Returns the new accessor function.
     * @example
     *
     * var array = [0, 1, 2],
     *     object = { 'a': array, 'b': array, 'c': array };
     *
     * _.map(['a[2]', 'c[0]'], _.propertyOf(object));
     * // => [2, 0]
     *
     * _.map([['a', '2'], ['c', '0']], _.propertyOf(object));
     * // => [2, 0]
     */
    function propertyOf(object) {
      return function(path) {
        return object == null ? undefined : baseGet(object, path);
      };
    }

    /**
     * Creates an array of numbers (positive and/or negative) progressing from
     * `start` up to, but not including, `end`. A step of `-1` is used if a negative
     * `start` is specified without an `end` or `step`. If `end` is not specified,
     * it's set to `start` with `start` then set to `0`.
     *
     * **Note:** JavaScript follows the IEEE-754 standard for resolving
     * floating-point values which can produce unexpected results.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Util
     * @param {number} [start=0] The start of the range.
     * @param {number} end The end of the range.
     * @param {number} [step=1] The value to increment or decrement by.
     * @returns {Array} Returns the range of numbers.
     * @see _.inRange, _.rangeRight
     * @example
     *
     * _.range(4);
     * // => [0, 1, 2, 3]
     *
     * _.range(-4);
     * // => [0, -1, -2, -3]
     *
     * _.range(1, 5);
     * // => [1, 2, 3, 4]
     *
     * _.range(0, 20, 5);
     * // => [0, 5, 10, 15]
     *
     * _.range(0, -4, -1);
     * // => [0, -1, -2, -3]
     *
     * _.range(1, 4, 0);
     * // => [1, 1, 1]
     *
     * _.range(0);
     * // => []
     */
    var range = createRange();

    /**
     * This method is like `_.range` except that it populates values in
     * descending order.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Util
     * @param {number} [start=0] The start of the range.
     * @param {number} end The end of the range.
     * @param {number} [step=1] The value to increment or decrement by.
     * @returns {Array} Returns the range of numbers.
     * @see _.inRange, _.range
     * @example
     *
     * _.rangeRight(4);
     * // => [3, 2, 1, 0]
     *
     * _.rangeRight(-4);
     * // => [-3, -2, -1, 0]
     *
     * _.rangeRight(1, 5);
     * // => [4, 3, 2, 1]
     *
     * _.rangeRight(0, 20, 5);
     * // => [15, 10, 5, 0]
     *
     * _.rangeRight(0, -4, -1);
     * // => [-3, -2, -1, 0]
     *
     * _.rangeRight(1, 4, 0);
     * // => [1, 1, 1]
     *
     * _.rangeRight(0);
     * // => []
     */
    var rangeRight = createRange(true);

    /**
     * This method returns a new empty array.
     *
     * @static
     * @memberOf _
     * @since 4.13.0
     * @category Util
     * @returns {Array} Returns the new empty array.
     * @example
     *
     * var arrays = _.times(2, _.stubArray);
     *
     * console.log(arrays);
     * // => [[], []]
     *
     * console.log(arrays[0] === arrays[1]);
     * // => false
     */
    function stubArray() {
      return [];
    }

    /**
     * This method returns `false`.
     *
     * @static
     * @memberOf _
     * @since 4.13.0
     * @category Util
     * @returns {boolean} Returns `false`.
     * @example
     *
     * _.times(2, _.stubFalse);
     * // => [false, false]
     */
    function stubFalse() {
      return false;
    }

    /**
     * This method returns a new empty object.
     *
     * @static
     * @memberOf _
     * @since 4.13.0
     * @category Util
     * @returns {Object} Returns the new empty object.
     * @example
     *
     * var objects = _.times(2, _.stubObject);
     *
     * console.log(objects);
     * // => [{}, {}]
     *
     * console.log(objects[0] === objects[1]);
     * // => false
     */
    function stubObject() {
      return {};
    }

    /**
     * This method returns an empty string.
     *
     * @static
     * @memberOf _
     * @since 4.13.0
     * @category Util
     * @returns {string} Returns the empty string.
     * @example
     *
     * _.times(2, _.stubString);
     * // => ['', '']
     */
    function stubString() {
      return '';
    }

    /**
     * This method returns `true`.
     *
     * @static
     * @memberOf _
     * @since 4.13.0
     * @category Util
     * @returns {boolean} Returns `true`.
     * @example
     *
     * _.times(2, _.stubTrue);
     * // => [true, true]
     */
    function stubTrue() {
      return true;
    }

    /**
     * Invokes the iteratee `n` times, returning an array of the results of
     * each invocation. The iteratee is invoked with one argument; (index).
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Util
     * @param {number} n The number of times to invoke `iteratee`.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the array of results.
     * @example
     *
     * _.times(3, String);
     * // => ['0', '1', '2']
     *
     *  _.times(4, _.constant(0));
     * // => [0, 0, 0, 0]
     */
    function times(n, iteratee) {
      n = toInteger(n);
      if (n < 1 || n > MAX_SAFE_INTEGER) {
        return [];
      }
      var index = MAX_ARRAY_LENGTH,
          length = nativeMin(n, MAX_ARRAY_LENGTH);

      iteratee = getIteratee(iteratee);
      n -= MAX_ARRAY_LENGTH;

      var result = baseTimes(length, iteratee);
      while (++index < n) {
        iteratee(index);
      }
      return result;
    }

    /**
     * Converts `value` to a property path array.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Util
     * @param {*} value The value to convert.
     * @returns {Array} Returns the new property path array.
     * @example
     *
     * _.toPath('a.b.c');
     * // => ['a', 'b', 'c']
     *
     * _.toPath('a[0].b.c');
     * // => ['a', '0', 'b', 'c']
     */
    function toPath(value) {
      if (isArray(value)) {
        return arrayMap(value, toKey);
      }
      return isSymbol(value) ? [value] : copyArray(stringToPath(toString(value)));
    }

    /**
     * Generates a unique ID. If `prefix` is given, the ID is appended to it.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Util
     * @param {string} [prefix=''] The value to prefix the ID with.
     * @returns {string} Returns the unique ID.
     * @example
     *
     * _.uniqueId('contact_');
     * // => 'contact_104'
     *
     * _.uniqueId();
     * // => '105'
     */
    function uniqueId(prefix) {
      var id = ++idCounter;
      return toString(prefix) + id;
    }

    /*------------------------------------------------------------------------*/

    /**
     * Adds two numbers.
     *
     * @static
     * @memberOf _
     * @since 3.4.0
     * @category Math
     * @param {number} augend The first number in an addition.
     * @param {number} addend The second number in an addition.
     * @returns {number} Returns the total.
     * @example
     *
     * _.add(6, 4);
     * // => 10
     */
    var add = createMathOperation(function(augend, addend) {
      return augend + addend;
    }, 0);

    /**
     * Computes `number` rounded up to `precision`.
     *
     * @static
     * @memberOf _
     * @since 3.10.0
     * @category Math
     * @param {number} number The number to round up.
     * @param {number} [precision=0] The precision to round up to.
     * @returns {number} Returns the rounded up number.
     * @example
     *
     * _.ceil(4.006);
     * // => 5
     *
     * _.ceil(6.004, 2);
     * // => 6.01
     *
     * _.ceil(6040, -2);
     * // => 6100
     */
    var ceil = createRound('ceil');

    /**
     * Divide two numbers.
     *
     * @static
     * @memberOf _
     * @since 4.7.0
     * @category Math
     * @param {number} dividend The first number in a division.
     * @param {number} divisor The second number in a division.
     * @returns {number} Returns the quotient.
     * @example
     *
     * _.divide(6, 4);
     * // => 1.5
     */
    var divide = createMathOperation(function(dividend, divisor) {
      return dividend / divisor;
    }, 1);

    /**
     * Computes `number` rounded down to `precision`.
     *
     * @static
     * @memberOf _
     * @since 3.10.0
     * @category Math
     * @param {number} number The number to round down.
     * @param {number} [precision=0] The precision to round down to.
     * @returns {number} Returns the rounded down number.
     * @example
     *
     * _.floor(4.006);
     * // => 4
     *
     * _.floor(0.046, 2);
     * // => 0.04
     *
     * _.floor(4060, -2);
     * // => 4000
     */
    var floor = createRound('floor');

    /**
     * Computes the maximum value of `array`. If `array` is empty or falsey,
     * `undefined` is returned.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Math
     * @param {Array} array The array to iterate over.
     * @returns {*} Returns the maximum value.
     * @example
     *
     * _.max([4, 2, 8, 6]);
     * // => 8
     *
     * _.max([]);
     * // => undefined
     */
    function max(array) {
      return (array && array.length)
        ? baseExtremum(array, identity, baseGt)
        : undefined;
    }

    /**
     * This method is like `_.max` except that it accepts `iteratee` which is
     * invoked for each element in `array` to generate the criterion by which
     * the value is ranked. The iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Math
     * @param {Array} array The array to iterate over.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {*} Returns the maximum value.
     * @example
     *
     * var objects = [{ 'n': 1 }, { 'n': 2 }];
     *
     * _.maxBy(objects, function(o) { return o.n; });
     * // => { 'n': 2 }
     *
     * // The `_.property` iteratee shorthand.
     * _.maxBy(objects, 'n');
     * // => { 'n': 2 }
     */
    function maxBy(array, iteratee) {
      return (array && array.length)
        ? baseExtremum(array, getIteratee(iteratee, 2), baseGt)
        : undefined;
    }

    /**
     * Computes the mean of the values in `array`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Math
     * @param {Array} array The array to iterate over.
     * @returns {number} Returns the mean.
     * @example
     *
     * _.mean([4, 2, 8, 6]);
     * // => 5
     */
    function mean(array) {
      return baseMean(array, identity);
    }

    /**
     * This method is like `_.mean` except that it accepts `iteratee` which is
     * invoked for each element in `array` to generate the value to be averaged.
     * The iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.7.0
     * @category Math
     * @param {Array} array The array to iterate over.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {number} Returns the mean.
     * @example
     *
     * var objects = [{ 'n': 4 }, { 'n': 2 }, { 'n': 8 }, { 'n': 6 }];
     *
     * _.meanBy(objects, function(o) { return o.n; });
     * // => 5
     *
     * // The `_.property` iteratee shorthand.
     * _.meanBy(objects, 'n');
     * // => 5
     */
    function meanBy(array, iteratee) {
      return baseMean(array, getIteratee(iteratee, 2));
    }

    /**
     * Computes the minimum value of `array`. If `array` is empty or falsey,
     * `undefined` is returned.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Math
     * @param {Array} array The array to iterate over.
     * @returns {*} Returns the minimum value.
     * @example
     *
     * _.min([4, 2, 8, 6]);
     * // => 2
     *
     * _.min([]);
     * // => undefined
     */
    function min(array) {
      return (array && array.length)
        ? baseExtremum(array, identity, baseLt)
        : undefined;
    }

    /**
     * This method is like `_.min` except that it accepts `iteratee` which is
     * invoked for each element in `array` to generate the criterion by which
     * the value is ranked. The iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Math
     * @param {Array} array The array to iterate over.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {*} Returns the minimum value.
     * @example
     *
     * var objects = [{ 'n': 1 }, { 'n': 2 }];
     *
     * _.minBy(objects, function(o) { return o.n; });
     * // => { 'n': 1 }
     *
     * // The `_.property` iteratee shorthand.
     * _.minBy(objects, 'n');
     * // => { 'n': 1 }
     */
    function minBy(array, iteratee) {
      return (array && array.length)
        ? baseExtremum(array, getIteratee(iteratee, 2), baseLt)
        : undefined;
    }

    /**
     * Multiply two numbers.
     *
     * @static
     * @memberOf _
     * @since 4.7.0
     * @category Math
     * @param {number} multiplier The first number in a multiplication.
     * @param {number} multiplicand The second number in a multiplication.
     * @returns {number} Returns the product.
     * @example
     *
     * _.multiply(6, 4);
     * // => 24
     */
    var multiply = createMathOperation(function(multiplier, multiplicand) {
      return multiplier * multiplicand;
    }, 1);

    /**
     * Computes `number` rounded to `precision`.
     *
     * @static
     * @memberOf _
     * @since 3.10.0
     * @category Math
     * @param {number} number The number to round.
     * @param {number} [precision=0] The precision to round to.
     * @returns {number} Returns the rounded number.
     * @example
     *
     * _.round(4.006);
     * // => 4
     *
     * _.round(4.006, 2);
     * // => 4.01
     *
     * _.round(4060, -2);
     * // => 4100
     */
    var round = createRound('round');

    /**
     * Subtract two numbers.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Math
     * @param {number} minuend The first number in a subtraction.
     * @param {number} subtrahend The second number in a subtraction.
     * @returns {number} Returns the difference.
     * @example
     *
     * _.subtract(6, 4);
     * // => 2
     */
    var subtract = createMathOperation(function(minuend, subtrahend) {
      return minuend - subtrahend;
    }, 0);

    /**
     * Computes the sum of the values in `array`.
     *
     * @static
     * @memberOf _
     * @since 3.4.0
     * @category Math
     * @param {Array} array The array to iterate over.
     * @returns {number} Returns the sum.
     * @example
     *
     * _.sum([4, 2, 8, 6]);
     * // => 20
     */
    function sum(array) {
      return (array && array.length)
        ? baseSum(array, identity)
        : 0;
    }

    /**
     * This method is like `_.sum` except that it accepts `iteratee` which is
     * invoked for each element in `array` to generate the value to be summed.
     * The iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Math
     * @param {Array} array The array to iterate over.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {number} Returns the sum.
     * @example
     *
     * var objects = [{ 'n': 4 }, { 'n': 2 }, { 'n': 8 }, { 'n': 6 }];
     *
     * _.sumBy(objects, function(o) { return o.n; });
     * // => 20
     *
     * // The `_.property` iteratee shorthand.
     * _.sumBy(objects, 'n');
     * // => 20
     */
    function sumBy(array, iteratee) {
      return (array && array.length)
        ? baseSum(array, getIteratee(iteratee, 2))
        : 0;
    }

    /*------------------------------------------------------------------------*/

    // Add methods that return wrapped values in chain sequences.
    lodash.after = after;
    lodash.ary = ary;
    lodash.assign = assign;
    lodash.assignIn = assignIn;
    lodash.assignInWith = assignInWith;
    lodash.assignWith = assignWith;
    lodash.at = at;
    lodash.before = before;
    lodash.bind = bind;
    lodash.bindAll = bindAll;
    lodash.bindKey = bindKey;
    lodash.castArray = castArray;
    lodash.chain = chain;
    lodash.chunk = chunk;
    lodash.compact = compact;
    lodash.concat = concat;
    lodash.cond = cond;
    lodash.conforms = conforms;
    lodash.constant = constant;
    lodash.countBy = countBy;
    lodash.create = create;
    lodash.curry = curry;
    lodash.curryRight = curryRight;
    lodash.debounce = debounce;
    lodash.defaults = defaults;
    lodash.defaultsDeep = defaultsDeep;
    lodash.defer = defer;
    lodash.delay = delay;
    lodash.difference = difference;
    lodash.differenceBy = differenceBy;
    lodash.differenceWith = differenceWith;
    lodash.drop = drop;
    lodash.dropRight = dropRight;
    lodash.dropRightWhile = dropRightWhile;
    lodash.dropWhile = dropWhile;
    lodash.fill = fill;
    lodash.filter = filter;
    lodash.flatMap = flatMap;
    lodash.flatMapDeep = flatMapDeep;
    lodash.flatMapDepth = flatMapDepth;
    lodash.flatten = flatten;
    lodash.flattenDeep = flattenDeep;
    lodash.flattenDepth = flattenDepth;
    lodash.flip = flip;
    lodash.flow = flow;
    lodash.flowRight = flowRight;
    lodash.fromPairs = fromPairs;
    lodash.functions = functions;
    lodash.functionsIn = functionsIn;
    lodash.groupBy = groupBy;
    lodash.initial = initial;
    lodash.intersection = intersection;
    lodash.intersectionBy = intersectionBy;
    lodash.intersectionWith = intersectionWith;
    lodash.invert = invert;
    lodash.invertBy = invertBy;
    lodash.invokeMap = invokeMap;
    lodash.iteratee = iteratee;
    lodash.keyBy = keyBy;
    lodash.keys = keys;
    lodash.keysIn = keysIn;
    lodash.map = map;
    lodash.mapKeys = mapKeys;
    lodash.mapValues = mapValues;
    lodash.matches = matches;
    lodash.matchesProperty = matchesProperty;
    lodash.memoize = memoize;
    lodash.merge = merge;
    lodash.mergeWith = mergeWith;
    lodash.method = method;
    lodash.methodOf = methodOf;
    lodash.mixin = mixin;
    lodash.negate = negate;
    lodash.nthArg = nthArg;
    lodash.omit = omit;
    lodash.omitBy = omitBy;
    lodash.once = once;
    lodash.orderBy = orderBy;
    lodash.over = over;
    lodash.overArgs = overArgs;
    lodash.overEvery = overEvery;
    lodash.overSome = overSome;
    lodash.partial = partial;
    lodash.partialRight = partialRight;
    lodash.partition = partition;
    lodash.pick = pick;
    lodash.pickBy = pickBy;
    lodash.property = property;
    lodash.propertyOf = propertyOf;
    lodash.pull = pull;
    lodash.pullAll = pullAll;
    lodash.pullAllBy = pullAllBy;
    lodash.pullAllWith = pullAllWith;
    lodash.pullAt = pullAt;
    lodash.range = range;
    lodash.rangeRight = rangeRight;
    lodash.rearg = rearg;
    lodash.reject = reject;
    lodash.remove = remove;
    lodash.rest = rest;
    lodash.reverse = reverse;
    lodash.sampleSize = sampleSize;
    lodash.set = set;
    lodash.setWith = setWith;
    lodash.shuffle = shuffle;
    lodash.slice = slice;
    lodash.sortBy = sortBy;
    lodash.sortedUniq = sortedUniq;
    lodash.sortedUniqBy = sortedUniqBy;
    lodash.split = split;
    lodash.spread = spread;
    lodash.tail = tail;
    lodash.take = take;
    lodash.takeRight = takeRight;
    lodash.takeRightWhile = takeRightWhile;
    lodash.takeWhile = takeWhile;
    lodash.tap = tap;
    lodash.throttle = throttle;
    lodash.thru = thru;
    lodash.toArray = toArray;
    lodash.toPairs = toPairs;
    lodash.toPairsIn = toPairsIn;
    lodash.toPath = toPath;
    lodash.toPlainObject = toPlainObject;
    lodash.transform = transform;
    lodash.unary = unary;
    lodash.union = union;
    lodash.unionBy = unionBy;
    lodash.unionWith = unionWith;
    lodash.uniq = uniq;
    lodash.uniqBy = uniqBy;
    lodash.uniqWith = uniqWith;
    lodash.unset = unset;
    lodash.unzip = unzip;
    lodash.unzipWith = unzipWith;
    lodash.update = update;
    lodash.updateWith = updateWith;
    lodash.values = values;
    lodash.valuesIn = valuesIn;
    lodash.without = without;
    lodash.words = words;
    lodash.wrap = wrap;
    lodash.xor = xor;
    lodash.xorBy = xorBy;
    lodash.xorWith = xorWith;
    lodash.zip = zip;
    lodash.zipObject = zipObject;
    lodash.zipObjectDeep = zipObjectDeep;
    lodash.zipWith = zipWith;

    // Add aliases.
    lodash.entries = toPairs;
    lodash.entriesIn = toPairsIn;
    lodash.extend = assignIn;
    lodash.extendWith = assignInWith;

    // Add methods to `lodash.prototype`.
    mixin(lodash, lodash);

    /*------------------------------------------------------------------------*/

    // Add methods that return unwrapped values in chain sequences.
    lodash.add = add;
    lodash.attempt = attempt;
    lodash.camelCase = camelCase;
    lodash.capitalize = capitalize;
    lodash.ceil = ceil;
    lodash.clamp = clamp;
    lodash.clone = clone;
    lodash.cloneDeep = cloneDeep;
    lodash.cloneDeepWith = cloneDeepWith;
    lodash.cloneWith = cloneWith;
    lodash.conformsTo = conformsTo;
    lodash.deburr = deburr;
    lodash.defaultTo = defaultTo;
    lodash.divide = divide;
    lodash.endsWith = endsWith;
    lodash.eq = eq;
    lodash.escape = escape;
    lodash.escapeRegExp = escapeRegExp;
    lodash.every = every;
    lodash.find = find;
    lodash.findIndex = findIndex;
    lodash.findKey = findKey;
    lodash.findLast = findLast;
    lodash.findLastIndex = findLastIndex;
    lodash.findLastKey = findLastKey;
    lodash.floor = floor;
    lodash.forEach = forEach;
    lodash.forEachRight = forEachRight;
    lodash.forIn = forIn;
    lodash.forInRight = forInRight;
    lodash.forOwn = forOwn;
    lodash.forOwnRight = forOwnRight;
    lodash.get = get;
    lodash.gt = gt;
    lodash.gte = gte;
    lodash.has = has;
    lodash.hasIn = hasIn;
    lodash.head = head;
    lodash.identity = identity;
    lodash.includes = includes;
    lodash.indexOf = indexOf;
    lodash.inRange = inRange;
    lodash.invoke = invoke;
    lodash.isArguments = isArguments;
    lodash.isArray = isArray;
    lodash.isArrayBuffer = isArrayBuffer;
    lodash.isArrayLike = isArrayLike;
    lodash.isArrayLikeObject = isArrayLikeObject;
    lodash.isBoolean = isBoolean;
    lodash.isBuffer = isBuffer;
    lodash.isDate = isDate;
    lodash.isElement = isElement;
    lodash.isEmpty = isEmpty;
    lodash.isEqual = isEqual;
    lodash.isEqualWith = isEqualWith;
    lodash.isError = isError;
    lodash.isFinite = isFinite;
    lodash.isFunction = isFunction;
    lodash.isInteger = isInteger;
    lodash.isLength = isLength;
    lodash.isMap = isMap;
    lodash.isMatch = isMatch;
    lodash.isMatchWith = isMatchWith;
    lodash.isNaN = isNaN;
    lodash.isNative = isNative;
    lodash.isNil = isNil;
    lodash.isNull = isNull;
    lodash.isNumber = isNumber;
    lodash.isObject = isObject;
    lodash.isObjectLike = isObjectLike;
    lodash.isPlainObject = isPlainObject;
    lodash.isRegExp = isRegExp;
    lodash.isSafeInteger = isSafeInteger;
    lodash.isSet = isSet;
    lodash.isString = isString;
    lodash.isSymbol = isSymbol;
    lodash.isTypedArray = isTypedArray;
    lodash.isUndefined = isUndefined;
    lodash.isWeakMap = isWeakMap;
    lodash.isWeakSet = isWeakSet;
    lodash.join = join;
    lodash.kebabCase = kebabCase;
    lodash.last = last;
    lodash.lastIndexOf = lastIndexOf;
    lodash.lowerCase = lowerCase;
    lodash.lowerFirst = lowerFirst;
    lodash.lt = lt;
    lodash.lte = lte;
    lodash.max = max;
    lodash.maxBy = maxBy;
    lodash.mean = mean;
    lodash.meanBy = meanBy;
    lodash.min = min;
    lodash.minBy = minBy;
    lodash.stubArray = stubArray;
    lodash.stubFalse = stubFalse;
    lodash.stubObject = stubObject;
    lodash.stubString = stubString;
    lodash.stubTrue = stubTrue;
    lodash.multiply = multiply;
    lodash.nth = nth;
    lodash.noConflict = noConflict;
    lodash.noop = noop;
    lodash.now = now;
    lodash.pad = pad;
    lodash.padEnd = padEnd;
    lodash.padStart = padStart;
    lodash.parseInt = parseInt;
    lodash.random = random;
    lodash.reduce = reduce;
    lodash.reduceRight = reduceRight;
    lodash.repeat = repeat;
    lodash.replace = replace;
    lodash.result = result;
    lodash.round = round;
    lodash.runInContext = runInContext;
    lodash.sample = sample;
    lodash.size = size;
    lodash.snakeCase = snakeCase;
    lodash.some = some;
    lodash.sortedIndex = sortedIndex;
    lodash.sortedIndexBy = sortedIndexBy;
    lodash.sortedIndexOf = sortedIndexOf;
    lodash.sortedLastIndex = sortedLastIndex;
    lodash.sortedLastIndexBy = sortedLastIndexBy;
    lodash.sortedLastIndexOf = sortedLastIndexOf;
    lodash.startCase = startCase;
    lodash.startsWith = startsWith;
    lodash.subtract = subtract;
    lodash.sum = sum;
    lodash.sumBy = sumBy;
    lodash.template = template;
    lodash.times = times;
    lodash.toFinite = toFinite;
    lodash.toInteger = toInteger;
    lodash.toLength = toLength;
    lodash.toLower = toLower;
    lodash.toNumber = toNumber;
    lodash.toSafeInteger = toSafeInteger;
    lodash.toString = toString;
    lodash.toUpper = toUpper;
    lodash.trim = trim;
    lodash.trimEnd = trimEnd;
    lodash.trimStart = trimStart;
    lodash.truncate = truncate;
    lodash.unescape = unescape;
    lodash.uniqueId = uniqueId;
    lodash.upperCase = upperCase;
    lodash.upperFirst = upperFirst;

    // Add aliases.
    lodash.each = forEach;
    lodash.eachRight = forEachRight;
    lodash.first = head;

    mixin(lodash, (function() {
      var source = {};
      baseForOwn(lodash, function(func, methodName) {
        if (!hasOwnProperty.call(lodash.prototype, methodName)) {
          source[methodName] = func;
        }
      });
      return source;
    }()), { 'chain': false });

    /*------------------------------------------------------------------------*/

    /**
     * The semantic version number.
     *
     * @static
     * @memberOf _
     * @type {string}
     */
    lodash.VERSION = VERSION;

    // Assign default placeholders.
    arrayEach(['bind', 'bindKey', 'curry', 'curryRight', 'partial', 'partialRight'], function(methodName) {
      lodash[methodName].placeholder = lodash;
    });

    // Add `LazyWrapper` methods for `_.drop` and `_.take` variants.
    arrayEach(['drop', 'take'], function(methodName, index) {
      LazyWrapper.prototype[methodName] = function(n) {
        n = n === undefined ? 1 : nativeMax(toInteger(n), 0);

        var result = (this.__filtered__ && !index)
          ? new LazyWrapper(this)
          : this.clone();

        if (result.__filtered__) {
          result.__takeCount__ = nativeMin(n, result.__takeCount__);
        } else {
          result.__views__.push({
            'size': nativeMin(n, MAX_ARRAY_LENGTH),
            'type': methodName + (result.__dir__ < 0 ? 'Right' : '')
          });
        }
        return result;
      };

      LazyWrapper.prototype[methodName + 'Right'] = function(n) {
        return this.reverse()[methodName](n).reverse();
      };
    });

    // Add `LazyWrapper` methods that accept an `iteratee` value.
    arrayEach(['filter', 'map', 'takeWhile'], function(methodName, index) {
      var type = index + 1,
          isFilter = type == LAZY_FILTER_FLAG || type == LAZY_WHILE_FLAG;

      LazyWrapper.prototype[methodName] = function(iteratee) {
        var result = this.clone();
        result.__iteratees__.push({
          'iteratee': getIteratee(iteratee, 3),
          'type': type
        });
        result.__filtered__ = result.__filtered__ || isFilter;
        return result;
      };
    });

    // Add `LazyWrapper` methods for `_.head` and `_.last`.
    arrayEach(['head', 'last'], function(methodName, index) {
      var takeName = 'take' + (index ? 'Right' : '');

      LazyWrapper.prototype[methodName] = function() {
        return this[takeName](1).value()[0];
      };
    });

    // Add `LazyWrapper` methods for `_.initial` and `_.tail`.
    arrayEach(['initial', 'tail'], function(methodName, index) {
      var dropName = 'drop' + (index ? '' : 'Right');

      LazyWrapper.prototype[methodName] = function() {
        return this.__filtered__ ? new LazyWrapper(this) : this[dropName](1);
      };
    });

    LazyWrapper.prototype.compact = function() {
      return this.filter(identity);
    };

    LazyWrapper.prototype.find = function(predicate) {
      return this.filter(predicate).head();
    };

    LazyWrapper.prototype.findLast = function(predicate) {
      return this.reverse().find(predicate);
    };

    LazyWrapper.prototype.invokeMap = baseRest(function(path, args) {
      if (typeof path == 'function') {
        return new LazyWrapper(this);
      }
      return this.map(function(value) {
        return baseInvoke(value, path, args);
      });
    });

    LazyWrapper.prototype.reject = function(predicate) {
      return this.filter(negate(getIteratee(predicate)));
    };

    LazyWrapper.prototype.slice = function(start, end) {
      start = toInteger(start);

      var result = this;
      if (result.__filtered__ && (start > 0 || end < 0)) {
        return new LazyWrapper(result);
      }
      if (start < 0) {
        result = result.takeRight(-start);
      } else if (start) {
        result = result.drop(start);
      }
      if (end !== undefined) {
        end = toInteger(end);
        result = end < 0 ? result.dropRight(-end) : result.take(end - start);
      }
      return result;
    };

    LazyWrapper.prototype.takeRightWhile = function(predicate) {
      return this.reverse().takeWhile(predicate).reverse();
    };

    LazyWrapper.prototype.toArray = function() {
      return this.take(MAX_ARRAY_LENGTH);
    };

    // Add `LazyWrapper` methods to `lodash.prototype`.
    baseForOwn(LazyWrapper.prototype, function(func, methodName) {
      var checkIteratee = /^(?:filter|find|map|reject)|While$/.test(methodName),
          isTaker = /^(?:head|last)$/.test(methodName),
          lodashFunc = lodash[isTaker ? ('take' + (methodName == 'last' ? 'Right' : '')) : methodName],
          retUnwrapped = isTaker || /^find/.test(methodName);

      if (!lodashFunc) {
        return;
      }
      lodash.prototype[methodName] = function() {
        var value = this.__wrapped__,
            args = isTaker ? [1] : arguments,
            isLazy = value instanceof LazyWrapper,
            iteratee = args[0],
            useLazy = isLazy || isArray(value);

        var interceptor = function(value) {
          var result = lodashFunc.apply(lodash, arrayPush([value], args));
          return (isTaker && chainAll) ? result[0] : result;
        };

        if (useLazy && checkIteratee && typeof iteratee == 'function' && iteratee.length != 1) {
          // Avoid lazy use if the iteratee has a "length" value other than `1`.
          isLazy = useLazy = false;
        }
        var chainAll = this.__chain__,
            isHybrid = !!this.__actions__.length,
            isUnwrapped = retUnwrapped && !chainAll,
            onlyLazy = isLazy && !isHybrid;

        if (!retUnwrapped && useLazy) {
          value = onlyLazy ? value : new LazyWrapper(this);
          var result = func.apply(value, args);
          result.__actions__.push({ 'func': thru, 'args': [interceptor], 'thisArg': undefined });
          return new LodashWrapper(result, chainAll);
        }
        if (isUnwrapped && onlyLazy) {
          return func.apply(this, args);
        }
        result = this.thru(interceptor);
        return isUnwrapped ? (isTaker ? result.value()[0] : result.value()) : result;
      };
    });

    // Add `Array` methods to `lodash.prototype`.
    arrayEach(['pop', 'push', 'shift', 'sort', 'splice', 'unshift'], function(methodName) {
      var func = arrayProto[methodName],
          chainName = /^(?:push|sort|unshift)$/.test(methodName) ? 'tap' : 'thru',
          retUnwrapped = /^(?:pop|shift)$/.test(methodName);

      lodash.prototype[methodName] = function() {
        var args = arguments;
        if (retUnwrapped && !this.__chain__) {
          var value = this.value();
          return func.apply(isArray(value) ? value : [], args);
        }
        return this[chainName](function(value) {
          return func.apply(isArray(value) ? value : [], args);
        });
      };
    });

    // Map minified method names to their real names.
    baseForOwn(LazyWrapper.prototype, function(func, methodName) {
      var lodashFunc = lodash[methodName];
      if (lodashFunc) {
        var key = (lodashFunc.name + ''),
            names = realNames[key] || (realNames[key] = []);

        names.push({ 'name': methodName, 'func': lodashFunc });
      }
    });

    realNames[createHybrid(undefined, WRAP_BIND_KEY_FLAG).name] = [{
      'name': 'wrapper',
      'func': undefined
    }];

    // Add methods to `LazyWrapper`.
    LazyWrapper.prototype.clone = lazyClone;
    LazyWrapper.prototype.reverse = lazyReverse;
    LazyWrapper.prototype.value = lazyValue;

    // Add chain sequence methods to the `lodash` wrapper.
    lodash.prototype.at = wrapperAt;
    lodash.prototype.chain = wrapperChain;
    lodash.prototype.commit = wrapperCommit;
    lodash.prototype.next = wrapperNext;
    lodash.prototype.plant = wrapperPlant;
    lodash.prototype.reverse = wrapperReverse;
    lodash.prototype.toJSON = lodash.prototype.valueOf = lodash.prototype.value = wrapperValue;

    // Add lazy aliases.
    lodash.prototype.first = lodash.prototype.head;

    if (symIterator) {
      lodash.prototype[symIterator] = wrapperToIterator;
    }
    return lodash;
  });

  /*--------------------------------------------------------------------------*/

  // Export lodash.
  var _ = runInContext();

  // Some AMD build optimizers, like r.js, check for condition patterns like:
  if (typeof define == 'function' && typeof define.amd == 'object' && define.amd) {
    // Expose Lodash on the global object to prevent errors when Lodash is
    // loaded by a script tag in the presence of an AMD loader.
    // See http://requirejs.org/docs/errors.html#mismatch for more details.
    // Use `_.noConflict` to remove Lodash from the global object.
    root._ = _;

    // Define as an anonymous module so, through path mapping, it can be
    // referenced as the "underscore" module.
    define(function() {
      return _;
    });
  }
  // Check for `exports` after `define` in case a build optimizer adds it.
  else if (freeModule) {
    // Export for Node.js.
    (freeModule.exports = _)._ = _;
    // Export for CommonJS support.
    freeExports._ = _;
  }
  else {
    // Export to the global object.
    root._ = _;
  }
}.call(this));

/*
 Sticky-kit v1.1.0 | WTFPL | Leaf Corcoran 2014 | http://leafo.net
*/
(function(){var k,e;k=this.jQuery||window.jQuery;e=k(window);k.fn.stick_in_parent=function(d){var w,y,n,r,h,C,s,F,p,G;null==d&&(d={});s=d.sticky_class;y=d.inner_scrolling;C=d.recalc_every;h=d.parent;r=d.offset_top;n=d.spacer;w=d.bottoming;null==r&&(r=0);null==h&&(h=void 0);null==y&&(y=!0);null==s&&(s="is_stuck");null==w&&(w=!0);F=function(a,d,p,z,D,t,q){var u,E,m,A,c,f,B,x,v,g,b;if(!a.data("sticky_kit")){a.data("sticky_kit",!0);f=a.parent();null!=h&&(f=f.closest(h));if(!f.length)throw"failed to find stick parent";
u=m=!1;(g=null!=n?n&&a.closest(n):k("<div />"))&&g.css("position",a.css("position"));B=function(){var c,e,l;c=parseInt(f.css("border-top-width"),10);e=parseInt(f.css("padding-top"),10);d=parseInt(f.css("padding-bottom"),10);p=f.offset().top+c+e;z=f.height();m&&(u=m=!1,null==n&&(a.insertAfter(g),g.detach()),a.css({position:"",top:"",width:"",bottom:""}).removeClass(s),l=!0);D=a.offset().top-parseInt(a.css("margin-top"),10)-r;t=a.outerHeight(!0);q=a.css("float");g&&g.css({width:a.outerWidth(!0),height:t,
display:a.css("display"),"vertical-align":a.css("vertical-align"),"float":q});if(l)return b()};B();if(t!==z)return A=void 0,c=r,v=C,b=function(){var b,k,l,h;null!=v&&(v-=1,0>=v&&(v=C,B()));l=e.scrollTop();null!=A&&(k=l-A);A=l;m?(w&&(h=l+t+c>z+p,u&&!h&&(u=!1,a.css({position:"fixed",bottom:"",top:c}).trigger("sticky_kit:unbottom"))),l<D&&(m=!1,c=r,null==n&&("left"!==q&&"right"!==q||a.insertAfter(g),g.detach()),b={position:"",width:"",top:""},a.css(b).removeClass(s).trigger("sticky_kit:unstick")),y&&
(b=e.height(),t>b&&!u&&(c-=k,c=Math.max(b-t,c),c=Math.min(r,c),m&&a.css({top:c+"px"})))):l>D&&(m=!0,b={position:"fixed",top:c},b.width="border-box"===a.css("box-sizing")?a.outerWidth()+"px":a.width()+"px",a.css(b).addClass(s),null==n&&(a.after(g),"left"!==q&&"right"!==q||g.append(a)),a.trigger("sticky_kit:stick"));if(m&&w&&(null==h&&(h=l+t+c>z+p),!u&&h))return u=!0,"static"===f.css("position")&&f.css({position:"relative"}),a.css({position:"absolute",bottom:d,top:"auto"}).trigger("sticky_kit:bottom")},
x=function(){B();return b()},E=function(){e.off("touchmove",b);e.off("scroll",b);e.off("resize",x);k(document.body).off("sticky_kit:recalc",x);a.off("sticky_kit:detach",E);a.removeData("sticky_kit");a.css({position:"",bottom:"",top:""});f.position("position","");if(m)return null==n&&("left"!==q&&"right"!==q||a.insertAfter(g),g.remove()),a.removeClass(s)},e.on("touchmove",b),e.on("scroll",b),e.on("resize",x),k(document.body).on("sticky_kit:recalc",x),a.on("sticky_kit:detach",E),setTimeout(b,0)}};p=
0;for(G=this.length;p<G;p++)d=this[p],F(k(d));return this}}).call(this);

// @preserve jQuery.floatThead 1.3.0 - http://mkoryak.github.io/floatThead/ - Copyright (c) 2012 - 2015 Misha Koryak
// @license MIT
!function(a){function b(a,b){if(8==j){var c=o.width(),d=h.debounce(function(){var a=o.width();c!=a&&(c=a,b())},1);o.on(a,d)}else o.on(a,h.debounce(b,1))}function c(a){window&&window.console&&window.console.error&&window.console.error("jQuery.floatThead: "+a)}function d(a){var b=a.getBoundingClientRect();return b.width||b.right-b.left}function e(){var b=a('<div style="width:50px;height:50px;overflow-y:scroll;position:absolute;top:-200px;left:-200px;"><div style="height:100px;width:100%"></div>');a("body").append(b);var c=b.innerWidth(),d=a("div",b).innerWidth();return b.remove(),c-d}function f(a){if(a.dataTableSettings)for(var b=0;b<a.dataTableSettings.length;b++){var c=a.dataTableSettings[b].nTable;if(a[0]==c)return!0}return!1}function g(a,b,c){var d=c?"outerWidth":"width";if(m&&a.css("max-width")){var e=0;c&&(e+=parseInt(a.css("borderLeft"),10),e+=parseInt(a.css("borderRight"),10));for(var f=0;f<b.length;f++)e+=b.get(f).offsetWidth;return e}return a[d]()}a.floatThead=a.floatThead||{},a.floatThead.defaults={headerCellSelector:"tr:visible:first>*:visible",zIndex:1001,position:"auto",top:0,bottom:0,scrollContainer:function(){return a([])},getSizingRow:function(a){return a.find("tbody tr:visible:first>*:visible")},floatTableClass:"floatThead-table",floatWrapperClass:"floatThead-wrapper",floatContainerClass:"floatThead-container",copyTableClass:!0,enableAria:!1,autoReflow:!1,debug:!1};var h=window._,i="undefined"!=typeof MutationObserver,j=function(){for(var a=3,b=document.createElement("b"),c=b.all||[];a=1+a,b.innerHTML="<!--[if gt IE "+a+"]><i><![endif]-->",c[0];);return a>4?a:document.documentMode}(),k=/Gecko\//.test(navigator.userAgent),l=/WebKit\//.test(navigator.userAgent),m=function(){if(l){var b=a('<div style="width:0px"><table style="max-width:100%"><tr><th><div style="min-width:100px;">X</div></th></tr></table></div>');a("body").append(b);var c=0==b.find("table").width();return b.remove(),c}return!1},n=!k&&!j,o=a(window);a.fn.floatThead=function(k){if(k=k||{},!h&&(h=window._||a.floatThead._,!h))throw new Error("jquery.floatThead-slim.js requires underscore. You should use the non-lite version since you do not have underscore.");if(8>j)return this;var p=null;if(h.isFunction(m)&&(m=m()),h.isString(k)){var q=k,r=this;return this.filter("table").each(function(){var b=a(this),c=b.data("floatThead-lazy");c&&b.floatThead(c);var d=b.data("floatThead-attached");if(d&&h.isFunction(d[q])){var e=d[q]();"undefined"!=typeof e&&(r=e)}}),r}var s=a.extend({},a.floatThead.defaults||{},k);if(a.each(k,function(b){b in a.floatThead.defaults||!s.debug||c("Used ["+b+"] key to init plugin, but that param is not an option for the plugin. Valid options are: "+h.keys(a.floatThead.defaults).join(", "))}),s.debug){var t=a.fn.jquery.split(".");1==parseInt(t[0],10)&&parseInt(t[1],10)<=7&&c("jQuery version "+a.fn.jquery+" detected! This plugin supports 1.8 or better, or 1.7.x with jQuery UI 1.8.24 -> http://jqueryui.com/resources/download/jquery-ui-1.8.24.zip")}return this.filter(":not(."+s.floatTableClass+")").each(function(){function k(a){return a+".fth-"+E+".floatTHead"}function m(){var b=0;if(G.children("tr:visible").each(function(){b+=a(this).outerHeight(!0)}),"collapse"==F.css("border-collapse")){var c=parseInt(F.css("border-top-width"),10),d=parseInt(F.find("thead tr:first").find(">*:first").css("border-top-width"),10);c>d&&(b-=c/2)}fb.outerHeight(b),gb.outerHeight(b)}function q(){var a=g(F,jb,!0),b=O.width()||a,c="hidden"!=O.css("overflow-y")?b-L.vertical:b;if(cb.width(c),P){var d=100*a/c;Y.css("width",d+"%")}else Y.outerWidth(a)}function r(){I=(h.isFunction(s.top)?s.top(F):s.top)||0,J=(h.isFunction(s.bottom)?s.bottom(F):s.bottom)||0}function t(){var b,c=G.find(s.headerCellSelector);if(ab?b=$.find("col").length:(b=0,c.each(function(){b+=parseInt(a(this).attr("colspan")||1,10)})),b!=N){N=b;for(var d,e=[],f=[],g=[],h=0;b>h;h++)e.push(s.enableAria&&(d=c.eq(h).text())?'<th scope="col" class="floatThead-col">'+d+"</th>":'<th class="floatThead-col"/>'),f.push("<col/>"),g.push("<fthtd style='display:table-cell;height:0;width:auto;'/>");f=f.join(""),e=e.join(""),n&&(g=g.join(""),bb.html(g),jb=bb.find("fthtd")),fb.html(e),gb=fb.find("th"),ab||$.html(f),hb=$.find("col"),Z.html(f),ib=Z.find("col")}return b}function u(){if(!K){if(K=!0,Q){var a=g(F,jb,!0),b=W.width();a>b&&F.css("minWidth",a)}F.css(mb),Y.css(mb),Y.append(G),H.before(eb),m()}}function v(){K&&(K=!1,Q&&F.width(ob),eb.detach(),F.prepend(G),F.css(nb),Y.css(nb),F.css("minWidth",pb),F.css("minWidth",g(F,jb)))}function w(a){qb!=a&&(qb=a,F.triggerHandler("floatThead",[a,cb]))}function x(a){Q!=a&&(Q=a,cb.css({position:Q?"absolute":"fixed"}))}function y(a,b,c,d){return n?c:d?s.getSizingRow(a,b,c):b}function z(){var a,b=t();return function(){hb=$.find("col");var c=y(F,hb,jb,j);if(c.length==b&&b>0){if(!ab)for(a=0;b>a;a++)hb.eq(a).css("width","");v();var e=[];for(a=0;b>a;a++)e[a]=d(c.get(a));for(a=0;b>a;a++)ib.eq(a).width(e[a]),hb.eq(a).width(e[a]);u()}else Y.append(G),F.css(nb),Y.css(nb),m()}}function A(a){var b=O.css("border-"+a+"-width"),c=0;return b&&~b.indexOf("px")&&(c=parseInt(b,10)),c}function B(){var a,b=O.scrollTop(),c=0,d=S?R.outerHeight(!0):0,e=T?d:-d,f=cb.height(),g=F.offset(),h=0,i=0;if(P){var j=O.offset();c=g.top-j.top+b,S&&T&&(c+=d),h=A("left"),i=A("top"),c-=i}else a=g.top-I-f+J+L.horizontal;var k=o.scrollTop(),m=o.scrollLeft(),n=O.scrollLeft();return function(j){var p=F[0].offsetWidth<=0&&F[0].offsetHeight<=0;if(!p&&db)return db=!1,setTimeout(function(){F.triggerHandler("reflow")},1),null;if(p&&(db=!0,!Q))return null;if("windowScroll"==j?(k=o.scrollTop(),m=o.scrollLeft()):"containerScroll"==j?(b=O.scrollTop(),n=O.scrollLeft()):"init"!=j&&(k=o.scrollTop(),m=o.scrollLeft(),b=O.scrollTop(),n=O.scrollLeft()),!l||!(0>k||0>m)){if(X)x("windowScrollDone"==j?!0:!1);else if("windowScrollDone"==j)return null;g=F.offset(),S&&T&&(g.top+=d);var q,r,s=F.outerHeight();if(P&&Q){if(c>=b){var t=c-b+i;q=t>0?t:0,w(!1)}else q=V?i:b,w(!0);r=h}else!P&&Q?(k>a+s+e?q=s-f+e:g.top>=k+I?(q=0,v(),w(!1)):(q=I+k-g.top+c+(T?d:0),u(),w(!0)),r=0):P&&!Q?(c>b||b-c>s?(q=g.top-k,v(),w(!1)):(q=g.top+b-k-c,u(),w(!0)),r=g.left+n-m):P||Q||(k>a+s+e?q=s+I-k+a+e:g.top>k+I?(q=g.top-k,u(),w(!1)):(q=I,w(!0)),r=g.left-m);return{top:q,left:r}}}}function C(){var a=null,b=null,c=null;return function(d,e,f){null==d||a==d.top&&b==d.left||(cb.css({top:d.top,left:d.left}),a=d.top,b=d.left),e&&q(),f&&m();var g=O.scrollLeft();Q&&c==g||(cb.scrollLeft(g),c=g)}}function D(){if(O.length)if(O.data().perfectScrollbar)L={horizontal:0,vertical:0};else{var a=O.width(),b=O.height(),c=F.height(),d=g(F,jb),e=d>a?M:0,f=c>b?M:0;L.horizontal=d>a-f?M:0,L.vertical=c>b-e?M:0}}var E=h.uniqueId(),F=a(this);if(F.data("floatThead-attached"))return!0;if(!F.is("table"))throw new Error('jQuery.floatThead must be run on a table element. ex: $("table").floatThead();');i=s.autoReflow&&i;var G=F.children("thead:first"),H=F.children("tbody:first");if(0==G.length||0==H.length)return F.data("floatThead-lazy",s),void F.unbind("reflow").one("reflow",function(){F.floatThead(s)});F.data("floatThead-lazy")&&F.unbind("reflow"),F.data("floatThead-lazy",!1);var I,J,K=!1,L={vertical:0,horizontal:0},M=e(),N=0,O=s.scrollContainer(F)||a([]),P=O.length>0,Q=null;"undefined"!=typeof s.useAbsolutePositioning&&c("option 'useAbsolutePositioning' has been removed in v1.3.0, use 'position' instead. See docs for more info: http://mkoryak.github.io/floatThead/#options"),"auto"==s.position?Q=null:"fixed"==s.position?Q=!1:"absolute"==s.position?Q=!0:s.debug&&c('Invalid value given to "position" option, valid is "fixed", "absolute" and "auto". You passed: ',s.position),null==Q&&(Q=P),Q||(K=!0);var R=F.find("caption"),S=1==R.length;if(S)var T="top"===(R.css("caption-side")||R.attr("align")||"top");var U=a('<fthfoot style="display:table-footer-group;border-spacing:0;height:0;border-collapse:collapse;"/>'),V=!1,W=a([]),X=9>=j&&!P&&Q,Y=a("<table/>"),Z=a("<colgroup/>"),$=F.children("colgroup:first"),ab=!0;0==$.length&&($=a("<colgroup/>"),ab=!1);var bb=a('<fthtr style="display:table-row;border-spacing:0;height:0;border-collapse:collapse"/>'),cb=a('<div style="overflow: hidden;" aria-hidden="true"></div>'),db=!1,eb=a("<thead/>"),fb=a('<tr class="size-row"/>'),gb=a([]),hb=a([]),ib=a([]),jb=a([]);eb.append(fb),F.prepend($),n&&(U.append(bb),F.append(U)),Y.append(Z),cb.append(Y),s.copyTableClass&&Y.attr("class",F.attr("class")),Y.attr({cellpadding:F.attr("cellpadding"),cellspacing:F.attr("cellspacing"),border:F.attr("border")});var kb=F.css("display");if(Y.css({borderCollapse:F.css("borderCollapse"),border:F.css("border"),display:kb}),"none"==kb&&(db=!0),Y.addClass(s.floatTableClass).css({margin:0,"border-bottom-width":0}),Q){var lb=function(a,b){var c=a.css("position"),d="relative"==c||"absolute"==c,e=a;if(!d||b){var f={paddingLeft:a.css("paddingLeft"),paddingRight:a.css("paddingRight")};cb.css(f),e=a.data("floatThead-containerWrap")||a.wrap("<div class='"+s.floatWrapperClass+"' style='position: relative; clear:both;'></div>").parent(),a.data("floatThead-containerWrap",e),V=!0}return e};P?(W=lb(O,!0),W.prepend(cb)):(W=lb(F),F.before(cb))}else F.before(cb);cb.css({position:Q?"absolute":"fixed",marginTop:0,top:Q?0:"auto",zIndex:s.zIndex}),cb.addClass(s.floatContainerClass),r();var mb={"table-layout":"fixed"},nb={"table-layout":F.css("tableLayout")||"auto"},ob=F[0].style.width||"",pb=F.css("minWidth")||"",qb=!1;D();var rb,sb=function(){(rb=z())()};sb();var tb=B(),ub=C();ub(tb("init"),!0);var vb=h.debounce(function(){ub(tb("windowScrollDone"),!1)},1),wb=function(){ub(tb("windowScroll"),!1),X&&vb()},xb=function(){ub(tb("containerScroll"),!1)},yb=function(){F.is(":hidden")||(r(),D(),sb(),tb=B(),(ub=C())(tb("resize"),!0,!0))},zb=h.debounce(function(){F.is(":hidden")||(D(),r(),sb(),tb=B(),ub(tb("reflow"),!0))},1);if(P?Q?O.on(k("scroll"),xb):(O.on(k("scroll"),xb),o.on(k("scroll"),wb)):o.on(k("scroll"),wb),o.on(k("load"),zb),b(k("resize"),yb),F.on("reflow",zb),f(F)&&F.on("filter",zb).on("sort",zb).on("page",zb),o.on(k("shown.bs.tab"),zb),o.on(k("tabsactivate"),zb),i){var Ab=null;_.isFunction(s.autoReflow)&&(Ab=s.autoReflow(F,O)),Ab||(Ab=O.length?O[0]:F[0]),p=new MutationObserver(function(a){for(var b=function(a){return a&&a[0]&&("THEAD"==a[0].nodeName||"TD"==a[0].nodeName||"TH"==a[0].nodeName)},c=0;c<a.length;c++)if(!b(a[c].addedNodes)&&!b(a[c].removedNodes)){zb();break}}),p.observe(Ab,{childList:!0,subtree:!0})}F.data("floatThead-attached",{destroy:function(){var a=".fth-"+E;v(),F.css(nb),$.remove(),n&&U.remove(),eb.parent().length&&eb.replaceWith(G),i&&(p.disconnect(),p=null),F.off("reflow"),O.off(a),V&&(O.length?O.unwrap():F.unwrap()),P?O.data("floatThead-containerWrap",!1):F.data("floatThead-containerWrap",!1),F.css("minWidth",pb),cb.remove(),F.data("floatThead-attached",!1),o.off(a)},reflow:function(){zb()},setHeaderHeight:function(){m()},getFloatContainer:function(){return cb},getRowGroups:function(){return K?cb.find(">table>thead").add(F.children("tbody,tfoot")):F.children("thead,tbody,tfoot")}})}),this}}(jQuery),function(a){a.floatThead=a.floatThead||{},a.floatThead._=window._||function(){var b={},c=Object.prototype.hasOwnProperty,d=["Arguments","Function","String","Number","Date","RegExp"];b.has=function(a,b){return c.call(a,b)},b.keys=function(a){if(a!==Object(a))throw new TypeError("Invalid object");var c=[];for(var d in a)b.has(a,d)&&c.push(d);return c};var e=0;return b.uniqueId=function(a){var b=++e+"";return a?a+b:b},a.each(d,function(){var a=this;b["is"+a]=function(b){return Object.prototype.toString.call(b)=="[object "+a+"]"}}),b.debounce=function(a,b,c){var d,e,f,g,h;return function(){f=this,e=arguments,g=new Date;var i=function(){var j=new Date-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e)))},j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e)),h}},b}()}(jQuery);
/*! Responsive 2.1.1
 * 2014-2016 SpryMedia Ltd - datatables.net/license
 */

/**
 * @summary     Responsive
 * @description Responsive tables plug-in for DataTables
 * @version     2.1.1
 * @file        dataTables.responsive.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk/contact
 * @copyright   Copyright 2014-2016 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */
(function( factory ){
	if ( typeof define === 'function' && define.amd ) {
		// AMD
		define( ['jquery', 'datatables.net'], function ( $ ) {
			return factory( $, window, document );
		} );
	}
	else if ( typeof exports === 'object' ) {
		// CommonJS
		module.exports = function (root, $) {
			if ( ! root ) {
				root = window;
			}

			if ( ! $ || ! $.fn.dataTable ) {
				$ = require('datatables.net')(root, $).$;
			}

			return factory( $, root, root.document );
		};
	}
	else {
		// Browser
		factory( jQuery, window, document );
	}
}(function( $, window, document, undefined ) {
'use strict';
var DataTable = $.fn.dataTable;


/**
 * Responsive is a plug-in for the DataTables library that makes use of
 * DataTables' ability to change the visibility of columns, changing the
 * visibility of columns so the displayed columns fit into the table container.
 * The end result is that complex tables will be dynamically adjusted to fit
 * into the viewport, be it on a desktop, tablet or mobile browser.
 *
 * Responsive for DataTables has two modes of operation, which can used
 * individually or combined:
 *
 * * Class name based control - columns assigned class names that match the
 *   breakpoint logic can be shown / hidden as required for each breakpoint.
 * * Automatic control - columns are automatically hidden when there is no
 *   room left to display them. Columns removed from the right.
 *
 * In additional to column visibility control, Responsive also has built into
 * options to use DataTables' child row display to show / hide the information
 * from the table that has been hidden. There are also two modes of operation
 * for this child row display:
 *
 * * Inline - when the control element that the user can use to show / hide
 *   child rows is displayed inside the first column of the table.
 * * Column - where a whole column is dedicated to be the show / hide control.
 *
 * Initialisation of Responsive is performed by:
 *
 * * Adding the class `responsive` or `dt-responsive` to the table. In this case
 *   Responsive will automatically be initialised with the default configuration
 *   options when the DataTable is created.
 * * Using the `responsive` option in the DataTables configuration options. This
 *   can also be used to specify the configuration options, or simply set to
 *   `true` to use the defaults.
 *
 *  @class
 *  @param {object} settings DataTables settings object for the host table
 *  @param {object} [opts] Configuration options
 *  @requires jQuery 1.7+
 *  @requires DataTables 1.10.3+
 *
 *  @example
 *      $('#example').DataTable( {
 *        responsive: true
 *      } );
 *    } );
 */
var Responsive = function ( settings, opts ) {
	// Sanity check that we are using DataTables 1.10 or newer
	if ( ! DataTable.versionCheck || ! DataTable.versionCheck( '1.10.3' ) ) {
		throw 'DataTables Responsive requires DataTables 1.10.3 or newer';
	}

	this.s = {
		dt: new DataTable.Api( settings ),
		columns: [],
		current: []
	};

	// Check if responsive has already been initialised on this table
	if ( this.s.dt.settings()[0].responsive ) {
		return;
	}

	// details is an object, but for simplicity the user can give it as a string
	// or a boolean
	if ( opts && typeof opts.details === 'string' ) {
		opts.details = { type: opts.details };
	}
	else if ( opts && opts.details === false ) {
		opts.details = { type: false };
	}
	else if ( opts && opts.details === true ) {
		opts.details = { type: 'inline' };
	}

	this.c = $.extend( true, {}, Responsive.defaults, DataTable.defaults.responsive, opts );
	settings.responsive = this;
	this._constructor();
};

$.extend( Responsive.prototype, {
	/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
	 * Constructor
	 */

	/**
	 * Initialise the Responsive instance
	 *
	 * @private
	 */
	_constructor: function ()
	{
		var that = this;
		var dt = this.s.dt;
		var dtPrivateSettings = dt.settings()[0];
		var oldWindowWidth = $(window).width();

		dt.settings()[0]._responsive = this;

		// Use DataTables' throttle function to avoid processor thrashing on
		// resize
		$(window).on( 'resize.dtr orientationchange.dtr', DataTable.util.throttle( function () {
			// iOS has a bug whereby resize can fire when only scrolling
			// See: http://stackoverflow.com/questions/8898412
			var width = $(window).width();

			if ( width !== oldWindowWidth ) {
				that._resize();
				oldWindowWidth = width;
			}
		} ) );

		// DataTables doesn't currently trigger an event when a row is added, so
		// we need to hook into its private API to enforce the hidden rows when
		// new data is added
		dtPrivateSettings.oApi._fnCallbackReg( dtPrivateSettings, 'aoRowCreatedCallback', function (tr, data, idx) {
			if ( $.inArray( false, that.s.current ) !== -1 ) {
				$('>td, >th', tr).each( function ( i ) {
					var idx = dt.column.index( 'toData', i );

					if ( that.s.current[idx] === false ) {
						$(this).css('display', 'none');
					}
				} );
			}
		} );

		// Destroy event handler
		dt.on( 'destroy.dtr', function () {
			dt.off( '.dtr' );
			$( dt.table().body() ).off( '.dtr' );
			$(window).off( 'resize.dtr orientationchange.dtr' );

			// Restore the columns that we've hidden
			$.each( that.s.current, function ( i, val ) {
				if ( val === false ) {
					that._setColumnVis( i, true );
				}
			} );
		} );

		// Reorder the breakpoints array here in case they have been added out
		// of order
		this.c.breakpoints.sort( function (a, b) {
			return a.width < b.width ? 1 :
				a.width > b.width ? -1 : 0;
		} );

		this._classLogic();
		this._resizeAuto();

		// Details handler
		var details = this.c.details;

		if ( details.type !== false ) {
			that._detailsInit();

			// DataTables will trigger this event on every column it shows and
			// hides individually
			dt.on( 'column-visibility.dtr', function (e, ctx, col, vis) {
				that._classLogic();
				that._resizeAuto();
				that._resize();
			} );

			// Redraw the details box on each draw which will happen if the data
			// has changed. This is used until DataTables implements a native
			// `updated` event for rows
			dt.on( 'draw.dtr', function () {
				that._redrawChildren();
			} );

			$(dt.table().node()).addClass( 'dtr-'+details.type );
		}

		dt.on( 'column-reorder.dtr', function (e, settings, details) {
			that._classLogic();
			that._resizeAuto();
			that._resize();
		} );

		// Change in column sizes means we need to calc
		dt.on( 'column-sizing.dtr', function () {
			that._resizeAuto();
			that._resize();
		});

		// On Ajax reload we want to reopen any child rows which are displayed
		// by responsive
		dt.on( 'preXhr.dtr', function () {
			var rowIds = [];
			dt.rows().every( function () {
				if ( this.child.isShown() ) {
					rowIds.push( this.id(true) );
				}
			} );

			dt.one( 'draw.dtr', function () {
				dt.rows( rowIds ).every( function () {
					that._detailsDisplay( this, false );
				} );
			} );
		});

		dt.on( 'init.dtr', function (e, settings, details) {
			that._resizeAuto();
			that._resize();

			// If columns were hidden, then DataTables needs to adjust the
			// column sizing
			if ( $.inArray( false, that.s.current ) ) {
				dt.columns.adjust();
			}
		} );

		// First pass - draw the table for the current viewport size
		this._resize();
	},


	/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
	 * Private methods
	 */

	/**
	 * Calculate the visibility for the columns in a table for a given
	 * breakpoint. The result is pre-determined based on the class logic if
	 * class names are used to control all columns, but the width of the table
	 * is also used if there are columns which are to be automatically shown
	 * and hidden.
	 *
	 * @param  {string} breakpoint Breakpoint name to use for the calculation
	 * @return {array} Array of boolean values initiating the visibility of each
	 *   column.
	 *  @private
	 */
	_columnsVisiblity: function ( breakpoint )
	{
		var dt = this.s.dt;
		var columns = this.s.columns;
		var i, ien;

		// Create an array that defines the column ordering based first on the
		// column's priority, and secondly the column index. This allows the
		// columns to be removed from the right if the priority matches
		var order = columns
			.map( function ( col, idx ) {
				return {
					columnIdx: idx,
					priority: col.priority
				};
			} )
			.sort( function ( a, b ) {
				if ( a.priority !== b.priority ) {
					return a.priority - b.priority;
				}
				return a.columnIdx - b.columnIdx;
			} );

		// Class logic - determine which columns are in this breakpoint based
		// on the classes. If no class control (i.e. `auto`) then `-` is used
		// to indicate this to the rest of the function
		var display = $.map( columns, function ( col ) {
			return col.auto && col.minWidth === null ?
				false :
				col.auto === true ?
					'-' :
					$.inArray( breakpoint, col.includeIn ) !== -1;
		} );

		// Auto column control - first pass: how much width is taken by the
		// ones that must be included from the non-auto columns
		var requiredWidth = 0;
		for ( i=0, ien=display.length ; i<ien ; i++ ) {
			if ( display[i] === true ) {
				requiredWidth += columns[i].minWidth;
			}
		}

		// Second pass, use up any remaining width for other columns. For
		// scrolling tables we need to subtract the width of the scrollbar. It
		// may not be requires which makes this sub-optimal, but it would
		// require another full redraw to make complete use of those extra few
		// pixels
		var scrolling = dt.settings()[0].oScroll;
		var bar = scrolling.sY || scrolling.sX ? scrolling.iBarWidth : 0;
		var widthAvailable = dt.table().container().offsetWidth - bar;
		var usedWidth = widthAvailable - requiredWidth;

		// Control column needs to always be included. This makes it sub-
		// optimal in terms of using the available with, but to stop layout
		// thrashing or overflow. Also we need to account for the control column
		// width first so we know how much width is available for the other
		// columns, since the control column might not be the first one shown
		for ( i=0, ien=display.length ; i<ien ; i++ ) {
			if ( columns[i].control ) {
				usedWidth -= columns[i].minWidth;
			}
		}

		// Allow columns to be shown (counting by priority and then right to
		// left) until we run out of room
		var empty = false;
		for ( i=0, ien=order.length ; i<ien ; i++ ) {
			var colIdx = order[i].columnIdx;

			if ( display[colIdx] === '-' && ! columns[colIdx].control && columns[colIdx].minWidth ) {
				// Once we've found a column that won't fit we don't let any
				// others display either, or columns might disappear in the
				// middle of the table
				if ( empty || usedWidth - columns[colIdx].minWidth < 0 ) {
					empty = true;
					display[colIdx] = false;
				}
				else {
					display[colIdx] = true;
				}

				usedWidth -= columns[colIdx].minWidth;
			}
		}

		// Determine if the 'control' column should be shown (if there is one).
		// This is the case when there is a hidden column (that is not the
		// control column). The two loops look inefficient here, but they are
		// trivial and will fly through. We need to know the outcome from the
		// first , before the action in the second can be taken
		var showControl = false;

		for ( i=0, ien=columns.length ; i<ien ; i++ ) {
			if ( ! columns[i].control && ! columns[i].never && ! display[i] ) {
				showControl = true;
				break;
			}
		}

		for ( i=0, ien=columns.length ; i<ien ; i++ ) {
			if ( columns[i].control ) {
				display[i] = showControl;
			}
		}

		// Finally we need to make sure that there is at least one column that
		// is visible
		if ( $.inArray( true, display ) === -1 ) {
			display[0] = true;
		}

		return display;
	},


	/**
	 * Create the internal `columns` array with information about the columns
	 * for the table. This includes determining which breakpoints the column
	 * will appear in, based upon class names in the column, which makes up the
	 * vast majority of this method.
	 *
	 * @private
	 */
	_classLogic: function ()
	{
		var that = this;
		var calc = {};
		var breakpoints = this.c.breakpoints;
		var dt = this.s.dt;
		var columns = dt.columns().eq(0).map( function (i) {
			var column = this.column(i);
			var className = column.header().className;
			var priority = dt.settings()[0].aoColumns[i].responsivePriority;

			if ( priority === undefined ) {
				var dataPriority = $(column.header()).data('priority');

				priority = dataPriority !== undefined ?
					dataPriority * 1 :
					10000;
			}

			return {
				className: className,
				includeIn: [],
				auto:      false,
				control:   false,
				never:     className.match(/\bnever\b/) ? true : false,
				priority:  priority
			};
		} );

		// Simply add a breakpoint to `includeIn` array, ensuring that there are
		// no duplicates
		var add = function ( colIdx, name ) {
			var includeIn = columns[ colIdx ].includeIn;

			if ( $.inArray( name, includeIn ) === -1 ) {
				includeIn.push( name );
			}
		};

		var column = function ( colIdx, name, operator, matched ) {
			var size, i, ien;

			if ( ! operator ) {
				columns[ colIdx ].includeIn.push( name );
			}
			else if ( operator === 'max-' ) {
				// Add this breakpoint and all smaller
				size = that._find( name ).width;

				for ( i=0, ien=breakpoints.length ; i<ien ; i++ ) {
					if ( breakpoints[i].width <= size ) {
						add( colIdx, breakpoints[i].name );
					}
				}
			}
			else if ( operator === 'min-' ) {
				// Add this breakpoint and all larger
				size = that._find( name ).width;

				for ( i=0, ien=breakpoints.length ; i<ien ; i++ ) {
					if ( breakpoints[i].width >= size ) {
						add( colIdx, breakpoints[i].name );
					}
				}
			}
			else if ( operator === 'not-' ) {
				// Add all but this breakpoint
				for ( i=0, ien=breakpoints.length ; i<ien ; i++ ) {
					if ( breakpoints[i].name.indexOf( matched ) === -1 ) {
						add( colIdx, breakpoints[i].name );
					}
				}
			}
		};

		// Loop over each column and determine if it has a responsive control
		// class
		columns.each( function ( col, i ) {
			var classNames = col.className.split(' ');
			var hasClass = false;

			// Split the class name up so multiple rules can be applied if needed
			for ( var k=0, ken=classNames.length ; k<ken ; k++ ) {
				var className = $.trim( classNames[k] );

				if ( className === 'all' ) {
					// Include in all
					hasClass = true;
					col.includeIn = $.map( breakpoints, function (a) {
						return a.name;
					} );
					return;
				}
				else if ( className === 'none' || col.never ) {
					// Include in none (default) and no auto
					hasClass = true;
					return;
				}
				else if ( className === 'control' ) {
					// Special column that is only visible, when one of the other
					// columns is hidden. This is used for the details control
					hasClass = true;
					col.control = true;
					return;
				}

				$.each( breakpoints, function ( j, breakpoint ) {
					// Does this column have a class that matches this breakpoint?
					var brokenPoint = breakpoint.name.split('-');
					var re = new RegExp( '(min\\-|max\\-|not\\-)?('+brokenPoint[0]+')(\\-[_a-zA-Z0-9])?' );
					var match = className.match( re );

					if ( match ) {
						hasClass = true;

						if ( match[2] === brokenPoint[0] && match[3] === '-'+brokenPoint[1] ) {
							// Class name matches breakpoint name fully
							column( i, breakpoint.name, match[1], match[2]+match[3] );
						}
						else if ( match[2] === brokenPoint[0] && ! match[3] ) {
							// Class name matched primary breakpoint name with no qualifier
							column( i, breakpoint.name, match[1], match[2] );
						}
					}
				} );
			}

			// If there was no control class, then automatic sizing is used
			if ( ! hasClass ) {
				col.auto = true;
			}
		} );

		this.s.columns = columns;
	},


	/**
	 * Show the details for the child row
	 *
	 * @param  {DataTables.Api} row    API instance for the row
	 * @param  {boolean}        update Update flag
	 * @private
	 */
	_detailsDisplay: function ( row, update )
	{
		var that = this;
		var dt = this.s.dt;
		var details = this.c.details;

		if ( details && details.type !== false ) {
			var res = details.display( row, update, function () {
				return details.renderer(
					dt, row[0], that._detailsObj(row[0])
				);
			} );

			if ( res === true || res === false ) {
				$(dt.table().node()).triggerHandler( 'responsive-display.dt', [dt, row, res, update] );
			}
		}
	},


	/**
	 * Initialisation for the details handler
	 *
	 * @private
	 */
	_detailsInit: function ()
	{
		var that    = this;
		var dt      = this.s.dt;
		var details = this.c.details;

		// The inline type always uses the first child as the target
		if ( details.type === 'inline' ) {
			details.target = 'td:first-child, th:first-child';
		}

		// Keyboard accessibility
		dt.on( 'draw.dtr', function () {
			that._tabIndexes();
		} );
		that._tabIndexes(); // Initial draw has already happened

		$( dt.table().body() ).on( 'keyup.dtr', 'td, th', function (e) {
			if ( e.keyCode === 13 && $(this).data('dtr-keyboard') ) {
				$(this).click();
			}
		} );

		// type.target can be a string jQuery selector or a column index
		var target   = details.target;
		var selector = typeof target === 'string' ? target : 'td, th';

		// Click handler to show / hide the details rows when they are available
		$( dt.table().body() )
			.on( 'click.dtr mousedown.dtr mouseup.dtr', selector, function (e) {
				// If the table is not collapsed (i.e. there is no hidden columns)
				// then take no action
				if ( ! $(dt.table().node()).hasClass('collapsed' ) ) {
					return;
				}

				// Check that the row is actually a DataTable's controlled node
				if ( $.inArray( $(this).closest('tr').get(0), dt.rows().nodes().toArray() ) === -1 ) {
					return;
				}

				// For column index, we determine if we should act or not in the
				// handler - otherwise it is already okay
				if ( typeof target === 'number' ) {
					var targetIdx = target < 0 ?
						dt.columns().eq(0).length + target :
						target;

					if ( dt.cell( this ).index().column !== targetIdx ) {
						return;
					}
				}

				// $().closest() includes itself in its check
				var row = dt.row( $(this).closest('tr') );

				// Check event type to do an action
				if ( e.type === 'click' ) {
					// The renderer is given as a function so the caller can execute it
					// only when they need (i.e. if hiding there is no point is running
					// the renderer)
					that._detailsDisplay( row, false );
				}
				else if ( e.type === 'mousedown' ) {
					// For mouse users, prevent the focus ring from showing
					$(this).css('outline', 'none');
				}
				else if ( e.type === 'mouseup' ) {
					// And then re-allow at the end of the click
					$(this).blur().css('outline', '');
				}
			} );
	},


	/**
	 * Get the details to pass to a renderer for a row
	 * @param  {int} rowIdx Row index
	 * @private
	 */
	_detailsObj: function ( rowIdx )
	{
		var that = this;
		var dt = this.s.dt;

		return $.map( this.s.columns, function( col, i ) {
			// Never and control columns should not be passed to the renderer
			if ( col.never || col.control ) {
				return;
			}

			return {
				title:       dt.settings()[0].aoColumns[ i ].sTitle,
				data:        dt.cell( rowIdx, i ).render( that.c.orthogonal ),
				hidden:      dt.column( i ).visible() && !that.s.current[ i ],
				columnIndex: i,
				rowIndex:    rowIdx
			};
		} );
	},


	/**
	 * Find a breakpoint object from a name
	 *
	 * @param  {string} name Breakpoint name to find
	 * @return {object}      Breakpoint description object
	 * @private
	 */
	_find: function ( name )
	{
		var breakpoints = this.c.breakpoints;

		for ( var i=0, ien=breakpoints.length ; i<ien ; i++ ) {
			if ( breakpoints[i].name === name ) {
				return breakpoints[i];
			}
		}
	},


	/**
	 * Re-create the contents of the child rows as the display has changed in
	 * some way.
	 *
	 * @private
	 */
	_redrawChildren: function ()
	{
		var that = this;
		var dt = this.s.dt;

		dt.rows( {page: 'current'} ).iterator( 'row', function ( settings, idx ) {
			var row = dt.row( idx );

			that._detailsDisplay( dt.row( idx ), true );
		} );
	},


	/**
	 * Alter the table display for a resized viewport. This involves first
	 * determining what breakpoint the window currently is in, getting the
	 * column visibilities to apply and then setting them.
	 *
	 * @private
	 */
	_resize: function ()
	{
		var that = this;
		var dt = this.s.dt;
		var width = $(window).width();
		var breakpoints = this.c.breakpoints;
		var breakpoint = breakpoints[0].name;
		var columns = this.s.columns;
		var i, ien;
		var oldVis = this.s.current.slice();

		// Determine what breakpoint we are currently at
		for ( i=breakpoints.length-1 ; i>=0 ; i-- ) {
			if ( width <= breakpoints[i].width ) {
				breakpoint = breakpoints[i].name;
				break;
			}
		}
		
		// Show the columns for that break point
		var columnsVis = this._columnsVisiblity( breakpoint );
		this.s.current = columnsVis;

		// Set the class before the column visibility is changed so event
		// listeners know what the state is. Need to determine if there are
		// any columns that are not visible but can be shown
		var collapsedClass = false;
		for ( i=0, ien=columns.length ; i<ien ; i++ ) {
			if ( columnsVis[i] === false && ! columns[i].never && ! columns[i].control ) {
				collapsedClass = true;
				break;
			}
		}

		$( dt.table().node() ).toggleClass( 'collapsed', collapsedClass );

		var changed = false;

		dt.columns().eq(0).each( function ( colIdx, i ) {
			if ( columnsVis[i] !== oldVis[i] ) {
				changed = true;
				that._setColumnVis( colIdx, columnsVis[i] );
			}
		} );

		if ( changed ) {
			this._redrawChildren();

			// Inform listeners of the change
			$(dt.table().node()).trigger( 'responsive-resize.dt', [dt, this.s.current] );
		}
	},


	/**
	 * Determine the width of each column in the table so the auto column hiding
	 * has that information to work with. This method is never going to be 100%
	 * perfect since column widths can change slightly per page, but without
	 * seriously compromising performance this is quite effective.
	 *
	 * @private
	 */
	_resizeAuto: function ()
	{
		var dt = this.s.dt;
		var columns = this.s.columns;

		// Are we allowed to do auto sizing?
		if ( ! this.c.auto ) {
			return;
		}

		// Are there any columns that actually need auto-sizing, or do they all
		// have classes defined
		if ( $.inArray( true, $.map( columns, function (c) { return c.auto; } ) ) === -1 ) {
			return;
		}

		// Clone the table with the current data in it
		var tableWidth   = dt.table().node().offsetWidth;
		var columnWidths = dt.columns;
		var clonedTable  = dt.table().node().cloneNode( false );
		var clonedHeader = $( dt.table().header().cloneNode( false ) ).appendTo( clonedTable );
		var clonedBody   = $( dt.table().body() ).clone( false, false ).empty().appendTo( clonedTable ); // use jQuery because of IE8

		// Header
		var headerCells = dt.columns()
			.header()
			.filter( function (idx) {
				return dt.column(idx).visible();
			} )
			.to$()
			.clone( false )
			.css( 'display', 'table-cell' );

		// Body rows - we don't need to take account of DataTables' column
		// visibility since we implement our own here (hence the `display` set)
		$(clonedBody)
			.append( $(dt.rows( { page: 'current' } ).nodes()).clone( false ) )
			.find( 'th, td' ).css( 'display', '' );

		// Footer
		var footer = dt.table().footer();
		if ( footer ) {
			var clonedFooter = $( footer.cloneNode( false ) ).appendTo( clonedTable );
			var footerCells = dt.columns()
				.footer()
				.filter( function (idx) {
					return dt.column(idx).visible();
				} )
				.to$()
				.clone( false )
				.css( 'display', 'table-cell' );

			$('<tr/>')
				.append( footerCells )
				.appendTo( clonedFooter );
		}

		$('<tr/>')
			.append( headerCells )
			.appendTo( clonedHeader );

		// In the inline case extra padding is applied to the first column to
		// give space for the show / hide icon. We need to use this in the
		// calculation
		if ( this.c.details.type === 'inline' ) {
			$(clonedTable).addClass( 'dtr-inline collapsed' );
		}
		
		// It is unsafe to insert elements with the same name into the DOM
		// multiple times. For example, cloning and inserting a checked radio
		// clears the chcecked state of the original radio.
		$( clonedTable ).find( '[name]' ).removeAttr( 'name' );
		
		var inserted = $('<div/>')
			.css( {
				width: 1,
				height: 1,
				overflow: 'hidden'
			} )
			.append( clonedTable );

		inserted.insertBefore( dt.table().node() );

		// The cloned header now contains the smallest that each column can be
		headerCells.each( function (i) {
			var idx = dt.column.index( 'fromVisible', i );
			columns[ idx ].minWidth =  this.offsetWidth || 0;
		} );

		inserted.remove();
	},

	/**
	 * Set a column's visibility.
	 *
	 * We don't use DataTables' column visibility controls in order to ensure
	 * that column visibility can Responsive can no-exist. Since only IE8+ is
	 * supported (and all evergreen browsers of course) the control of the
	 * display attribute works well.
	 *
	 * @param {integer} col      Column index
	 * @param {boolean} showHide Show or hide (true or false)
	 * @private
	 */
	_setColumnVis: function ( col, showHide )
	{
		var dt = this.s.dt;
		var display = showHide ? '' : 'none'; // empty string will remove the attr

		$( dt.column( col ).header() ).css( 'display', display );
		$( dt.column( col ).footer() ).css( 'display', display );
		dt.column( col ).nodes().to$().css( 'display', display );
	},


	/**
	 * Update the cell tab indexes for keyboard accessibility. This is called on
	 * every table draw - that is potentially inefficient, but also the least
	 * complex option given that column visibility can change on the fly. Its a
	 * shame user-focus was removed from CSS 3 UI, as it would have solved this
	 * issue with a single CSS statement.
	 *
	 * @private
	 */
	_tabIndexes: function ()
	{
		var dt = this.s.dt;
		var cells = dt.cells( { page: 'current' } ).nodes().to$();
		var ctx = dt.settings()[0];
		var target = this.c.details.target;

		cells.filter( '[data-dtr-keyboard]' ).removeData( '[data-dtr-keyboard]' );

		var selector = typeof target === 'number' ?
			':eq('+target+')' :
			target;

		// This is a bit of a hack - we need to limit the selected nodes to just
		// those of this table
		if ( selector === 'td:first-child, th:first-child' ) {
			selector = '>td:first-child, >th:first-child';
		}

		$( selector, dt.rows( { page: 'current' } ).nodes() )
			.attr( 'tabIndex', ctx.iTabIndex )
			.data( 'dtr-keyboard', 1 );
	}
} );


/**
 * List of default breakpoints. Each item in the array is an object with two
 * properties:
 *
 * * `name` - the breakpoint name.
 * * `width` - the breakpoint width
 *
 * @name Responsive.breakpoints
 * @static
 */
Responsive.breakpoints = [
	{ name: 'desktop',  width: Infinity },
	{ name: 'tablet-l', width: 1024 },
	{ name: 'tablet-p', width: 768 },
	{ name: 'mobile-l', width: 480 },
	{ name: 'mobile-p', width: 320 }
];


/**
 * Display methods - functions which define how the hidden data should be shown
 * in the table.
 *
 * @namespace
 * @name Responsive.defaults
 * @static
 */
Responsive.display = {
	childRow: function ( row, update, render ) {
		if ( update ) {
			if ( $(row.node()).hasClass('parent') ) {
				row.child( render(), 'child' ).show();

				return true;
			}
		}
		else {
			if ( ! row.child.isShown()  ) {
				row.child( render(), 'child' ).show();
				$( row.node() ).addClass( 'parent' );

				return true;
			}
			else {
				row.child( false );
				$( row.node() ).removeClass( 'parent' );

				return false;
			}
		}
	},

	childRowImmediate: function ( row, update, render ) {
		if ( (! update && row.child.isShown()) || ! row.responsive.hasHidden() ) {
			// User interaction and the row is show, or nothing to show
			row.child( false );
			$( row.node() ).removeClass( 'parent' );

			return false;
		}
		else {
			// Display
			row.child( render(), 'child' ).show();
			$( row.node() ).addClass( 'parent' );

			return true;
		}
	},

	// This is a wrapper so the modal options for Bootstrap and jQuery UI can
	// have options passed into them. This specific one doesn't need to be a
	// function but it is for consistency in the `modal` name
	modal: function ( options ) {
		return function ( row, update, render ) {
			if ( ! update ) {
				// Show a modal
				var close = function () {
					modal.remove(); // will tidy events for us
					$(document).off( 'keypress.dtr' );
				};

				var modal = $('<div class="dtr-modal"/>')
					.append( $('<div class="dtr-modal-display"/>')
						.append( $('<div class="dtr-modal-content"/>')
							.append( render() )
						)
						.append( $('<div class="dtr-modal-close">&times;</div>' )
							.click( function () {
								close();
							} )
						)
					)
					.append( $('<div class="dtr-modal-background"/>')
						.click( function () {
							close();
						} )
					)
					.appendTo( 'body' );

				$(document).on( 'keyup.dtr', function (e) {
					if ( e.keyCode === 27 ) {
						e.stopPropagation();

						close();
					}
				} );
			}
			else {
				$('div.dtr-modal-content')
					.empty()
					.append( render() );
			}

			if ( options && options.header ) {
				$('div.dtr-modal-content').prepend(
					'<h2>'+options.header( row )+'</h2>'
				);
			}
		};
	}
};


/**
 * Display methods - functions which define how the hidden data should be shown
 * in the table.
 *
 * @namespace
 * @name Responsive.defaults
 * @static
 */
Responsive.renderer = {
	listHidden: function () {
		return function ( api, rowIdx, columns ) {
			var data = $.map( columns, function ( col ) {
				return col.hidden ?
					'<li data-dtr-index="'+col.columnIndex+'" data-dt-row="'+col.rowIndex+'" data-dt-column="'+col.columnIndex+'">'+
						'<span class="dtr-title">'+
							col.title+
						'</span> '+
						'<span class="dtr-data">'+
							col.data+
						'</span>'+
					'</li>' :
					'';
			} ).join('');

			return data ?
				$('<ul data-dtr-index="'+rowIdx+'" class="dtr-details"/>').append( data ) :
				false;
		}
	},

	tableAll: function ( options ) {
		options = $.extend( {
			tableClass: ''
		}, options );

		return function ( api, rowIdx, columns ) {
			var data = $.map( columns, function ( col ) {
				return '<tr data-dt-row="'+col.rowIndex+'" data-dt-column="'+col.columnIndex+'">'+
						'<td>'+col.title+':'+'</td> '+
						'<td>'+col.data+'</td>'+
					'</tr>';
			} ).join('');

			return $('<table class="'+options.tableClass+' dtr-details" width="100%"/>').append( data );
		}
	}
};

/**
 * Responsive default settings for initialisation
 *
 * @namespace
 * @name Responsive.defaults
 * @static
 */
Responsive.defaults = {
	/**
	 * List of breakpoints for the instance. Note that this means that each
	 * instance can have its own breakpoints. Additionally, the breakpoints
	 * cannot be changed once an instance has been creased.
	 *
	 * @type {Array}
	 * @default Takes the value of `Responsive.breakpoints`
	 */
	breakpoints: Responsive.breakpoints,

	/**
	 * Enable / disable auto hiding calculations. It can help to increase
	 * performance slightly if you disable this option, but all columns would
	 * need to have breakpoint classes assigned to them
	 *
	 * @type {Boolean}
	 * @default  `true`
	 */
	auto: true,

	/**
	 * Details control. If given as a string value, the `type` property of the
	 * default object is set to that value, and the defaults used for the rest
	 * of the object - this is for ease of implementation.
	 *
	 * The object consists of the following properties:
	 *
	 * * `display` - A function that is used to show and hide the hidden details
	 * * `renderer` - function that is called for display of the child row data.
	 *   The default function will show the data from the hidden columns
	 * * `target` - Used as the selector for what objects to attach the child
	 *   open / close to
	 * * `type` - `false` to disable the details display, `inline` or `column`
	 *   for the two control types
	 *
	 * @type {Object|string}
	 */
	details: {
		display: Responsive.display.childRow,

		renderer: Responsive.renderer.listHidden(),

		target: 0,

		type: 'inline'
	},

	/**
	 * Orthogonal data request option. This is used to define the data type
	 * requested when Responsive gets the data to show in the child row.
	 *
	 * @type {String}
	 */
	orthogonal: 'display'
};


/*
 * API
 */
var Api = $.fn.dataTable.Api;

// Doesn't do anything - work around for a bug in DT... Not documented
Api.register( 'responsive()', function () {
	return this;
} );

Api.register( 'responsive.index()', function ( li ) {
	li = $(li);

	return {
		column: li.data('dtr-index'),
		row:    li.parent().data('dtr-index')
	};
} );

Api.register( 'responsive.rebuild()', function () {
	return this.iterator( 'table', function ( ctx ) {
		if ( ctx._responsive ) {
			ctx._responsive._classLogic();
		}
	} );
} );

Api.register( 'responsive.recalc()', function () {
	return this.iterator( 'table', function ( ctx ) {
		if ( ctx._responsive ) {
			ctx._responsive._resizeAuto();
			ctx._responsive._resize();
		}
	} );
} );

Api.register( 'responsive.hasHidden()', function () {
	var ctx = this.context[0];

	return ctx._responsive ?
		$.inArray( false, ctx._responsive.s.current ) !== -1 :
		false;
} );


/**
 * Version information
 *
 * @name Responsive.version
 * @static
 */
Responsive.version = '2.1.1';


$.fn.dataTable.Responsive = Responsive;
$.fn.DataTable.Responsive = Responsive;

// Attach a listener to the document which listens for DataTables initialisation
// events so we can automatically initialise
$(document).on( 'preInit.dt.dtr', function (e, settings, json) {
	if ( e.namespace !== 'dt' ) {
		return;
	}

	if ( $(settings.nTable).hasClass( 'responsive' ) ||
		 $(settings.nTable).hasClass( 'dt-responsive' ) ||
		 settings.oInit.responsive ||
		 DataTable.defaults.responsive
	) {
		var init = settings.oInit.responsive;

		if ( init !== false ) {
			new Responsive( settings, $.isPlainObject( init ) ? init : {}  );
		}
	}
} );


return Responsive;
}));

/*! ColReorder 1.1.2
 * ©2010-2014 SpryMedia Ltd - datatables.net/license
 */

/**
 * @summary     ColReorder
 * @description Provide the ability to reorder columns in a DataTable
 * @version     1.1.2
 * @file        dataTables.colReorder.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk/contact
 * @copyright   Copyright 2010-2014 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */

(function(window, document, undefined) {


/**
 * Switch the key value pairing of an index array to be value key (i.e. the old value is now the
 * key). For example consider [ 2, 0, 1 ] this would be returned as [ 1, 2, 0 ].
 *  @method  fnInvertKeyValues
 *  @param   array aIn Array to switch around
 *  @returns array
 */
function fnInvertKeyValues( aIn )
{
	var aRet=[];
	for ( var i=0, iLen=aIn.length ; i<iLen ; i++ )
	{
		aRet[ aIn[i] ] = i;
	}
	return aRet;
}


/**
 * Modify an array by switching the position of two elements
 *  @method  fnArraySwitch
 *  @param   array aArray Array to consider, will be modified by reference (i.e. no return)
 *  @param   int iFrom From point
 *  @param   int iTo Insert point
 *  @returns void
 */
function fnArraySwitch( aArray, iFrom, iTo )
{
	var mStore = aArray.splice( iFrom, 1 )[0];
	aArray.splice( iTo, 0, mStore );
}


/**
 * Switch the positions of nodes in a parent node (note this is specifically designed for
 * table rows). Note this function considers all element nodes under the parent!
 *  @method  fnDomSwitch
 *  @param   string sTag Tag to consider
 *  @param   int iFrom Element to move
 *  @param   int Point to element the element to (before this point), can be null for append
 *  @returns void
 */
function fnDomSwitch( nParent, iFrom, iTo )
{
	var anTags = [];
	for ( var i=0, iLen=nParent.childNodes.length ; i<iLen ; i++ )
	{
		if ( nParent.childNodes[i].nodeType == 1 )
		{
			anTags.push( nParent.childNodes[i] );
		}
	}
	var nStore = anTags[ iFrom ];

	if ( iTo !== null )
	{
		nParent.insertBefore( nStore, anTags[iTo] );
	}
	else
	{
		nParent.appendChild( nStore );
	}
}



/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * DataTables plug-in API functions
 *
 * This are required by ColReorder in order to perform the tasks required, and also keep this
 * code portable, to be used for other column reordering projects with DataTables, if needed.
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */


/**
 * Plug-in for DataTables which will reorder the internal column structure by taking the column
 * from one position (iFrom) and insert it into a given point (iTo).
 *  @method  $.fn.dataTableExt.oApi.fnColReorder
 *  @param   object oSettings DataTables settings object - automatically added by DataTables!
 *  @param   int iFrom Take the column to be repositioned from this point
 *  @param   int iTo and insert it into this point
 *  @returns void
 */
$.fn.dataTableExt.oApi.fnColReorder = function ( oSettings, iFrom, iTo )
{
	var v110 = $.fn.dataTable.Api ? true : false;
	var i, iLen, j, jLen, iCols=oSettings.aoColumns.length, nTrs, oCol;
	var attrMap = function ( obj, prop, mapping ) {
		if ( ! obj[ prop ] ) {
			return;
		}

		var a = obj[ prop ].split('.');
		var num = a.shift();

		if ( isNaN( num*1 ) ) {
			return;
		}

		obj[ prop ] = mapping[ num*1 ]+'.'+a.join('.');
	};

	/* Sanity check in the input */
	if ( iFrom == iTo )
	{
		/* Pointless reorder */
		return;
	}

	if ( iFrom < 0 || iFrom >= iCols )
	{
		this.oApi._fnLog( oSettings, 1, "ColReorder 'from' index is out of bounds: "+iFrom );
		return;
	}

	if ( iTo < 0 || iTo >= iCols )
	{
		this.oApi._fnLog( oSettings, 1, "ColReorder 'to' index is out of bounds: "+iTo );
		return;
	}

	/*
	 * Calculate the new column array index, so we have a mapping between the old and new
	 */
	var aiMapping = [];
	for ( i=0, iLen=iCols ; i<iLen ; i++ )
	{
		aiMapping[i] = i;
	}
	fnArraySwitch( aiMapping, iFrom, iTo );
	var aiInvertMapping = fnInvertKeyValues( aiMapping );


	/*
	 * Convert all internal indexing to the new column order indexes
	 */
	/* Sorting */
	for ( i=0, iLen=oSettings.aaSorting.length ; i<iLen ; i++ )
	{
		oSettings.aaSorting[i][0] = aiInvertMapping[ oSettings.aaSorting[i][0] ];
	}

	/* Fixed sorting */
	if ( oSettings.aaSortingFixed !== null )
	{
		for ( i=0, iLen=oSettings.aaSortingFixed.length ; i<iLen ; i++ )
		{
			oSettings.aaSortingFixed[i][0] = aiInvertMapping[ oSettings.aaSortingFixed[i][0] ];
		}
	}

	/* Data column sorting (the column which the sort for a given column should take place on) */
	for ( i=0, iLen=iCols ; i<iLen ; i++ )
	{
		oCol = oSettings.aoColumns[i];
		for ( j=0, jLen=oCol.aDataSort.length ; j<jLen ; j++ )
		{
			oCol.aDataSort[j] = aiInvertMapping[ oCol.aDataSort[j] ];
		}

		// Update the column indexes
		if ( v110 ) {
			oCol.idx = aiInvertMapping[ oCol.idx ];
		}
	}

	if ( v110 ) {
		// Update 1.10 optimised sort class removal variable
		$.each( oSettings.aLastSort, function (i, val) {
			oSettings.aLastSort[i].src = aiInvertMapping[ val.src ];
		} );
	}

	/* Update the Get and Set functions for each column */
	for ( i=0, iLen=iCols ; i<iLen ; i++ )
	{
		oCol = oSettings.aoColumns[i];

		if ( typeof oCol.mData == 'number' ) {
			oCol.mData = aiInvertMapping[ oCol.mData ];

			// regenerate the get / set functions
			oSettings.oApi._fnColumnOptions( oSettings, i, {} );
		}
		else if ( $.isPlainObject( oCol.mData ) ) {
			// HTML5 data sourced
			attrMap( oCol.mData, '_',      aiInvertMapping );
			attrMap( oCol.mData, 'filter', aiInvertMapping );
			attrMap( oCol.mData, 'sort',   aiInvertMapping );
			attrMap( oCol.mData, 'type',   aiInvertMapping );

			// regenerate the get / set functions
			oSettings.oApi._fnColumnOptions( oSettings, i, {} );
		}
	}


	/*
	 * Move the DOM elements
	 */
	if ( oSettings.aoColumns[iFrom].bVisible )
	{
		/* Calculate the current visible index and the point to insert the node before. The insert
		 * before needs to take into account that there might not be an element to insert before,
		 * in which case it will be null, and an appendChild should be used
		 */
		var iVisibleIndex = this.oApi._fnColumnIndexToVisible( oSettings, iFrom );
		var iInsertBeforeIndex = null;

		i = iTo < iFrom ? iTo : iTo + 1;
		while ( iInsertBeforeIndex === null && i < iCols )
		{
			iInsertBeforeIndex = this.oApi._fnColumnIndexToVisible( oSettings, i );
			i++;
		}

		/* Header */
		nTrs = oSettings.nTHead.getElementsByTagName('tr');
		for ( i=0, iLen=nTrs.length ; i<iLen ; i++ )
		{
			fnDomSwitch( nTrs[i], iVisibleIndex, iInsertBeforeIndex );
		}

		/* Footer */
		if ( oSettings.nTFoot !== null )
		{
			nTrs = oSettings.nTFoot.getElementsByTagName('tr');
			for ( i=0, iLen=nTrs.length ; i<iLen ; i++ )
			{
				fnDomSwitch( nTrs[i], iVisibleIndex, iInsertBeforeIndex );
			}
		}

		/* Body */
		for ( i=0, iLen=oSettings.aoData.length ; i<iLen ; i++ )
		{
			if ( oSettings.aoData[i].nTr !== null )
			{
				fnDomSwitch( oSettings.aoData[i].nTr, iVisibleIndex, iInsertBeforeIndex );
			}
		}
	}

	/*
	 * Move the internal array elements
	 */
	/* Columns */
	fnArraySwitch( oSettings.aoColumns, iFrom, iTo );

	/* Search columns */
	fnArraySwitch( oSettings.aoPreSearchCols, iFrom, iTo );

	/* Array array - internal data anodes cache */
	for ( i=0, iLen=oSettings.aoData.length ; i<iLen ; i++ )
	{
		var data = oSettings.aoData[i];

		if ( v110 ) {
			// DataTables 1.10+
			if ( data.anCells ) {
				fnArraySwitch( data.anCells, iFrom, iTo );
			}

			// For DOM sourced data, the invalidate will reread the cell into
			// the data array, but for data sources as an array, they need to
			// be flipped
			if ( data.src !== 'dom' && $.isArray( data._aData ) ) {
				fnArraySwitch( data._aData, iFrom, iTo );
			}
		}
		else {
			// DataTables 1.9-
			if ( $.isArray( data._aData ) ) {
				fnArraySwitch( data._aData, iFrom, iTo );
			}
			fnArraySwitch( data._anHidden, iFrom, iTo );
		}
	}

	/* Reposition the header elements in the header layout array */
	for ( i=0, iLen=oSettings.aoHeader.length ; i<iLen ; i++ )
	{
		fnArraySwitch( oSettings.aoHeader[i], iFrom, iTo );
	}

	if ( oSettings.aoFooter !== null )
	{
		for ( i=0, iLen=oSettings.aoFooter.length ; i<iLen ; i++ )
		{
			fnArraySwitch( oSettings.aoFooter[i], iFrom, iTo );
		}
	}

	// In 1.10 we need to invalidate row cached data for sorting, filtering etc
	if ( v110 ) {
		var api = new $.fn.dataTable.Api( oSettings );
		api.rows().invalidate();
	}

	/*
	 * Update DataTables' event handlers
	 */

	/* Sort listener */
	for ( i=0, iLen=iCols ; i<iLen ; i++ )
	{
		$(oSettings.aoColumns[i].nTh).off('click.DT');
		this.oApi._fnSortAttachListener( oSettings, oSettings.aoColumns[i].nTh, i );
	}


	/* Fire an event so other plug-ins can update */
	$(oSettings.oInstance).trigger( 'column-reorder', [ oSettings, {
		"iFrom": iFrom,
		"iTo": iTo,
		"aiInvertMapping": aiInvertMapping
	} ] );
};



var factory = function( $, DataTable ) {
"use strict";

/**
 * ColReorder provides column visibility control for DataTables
 * @class ColReorder
 * @constructor
 * @param {object} dt DataTables settings object
 * @param {object} opts ColReorder options
 */
var ColReorder = function( dt, opts )
{
	var oDTSettings;

	if ( $.fn.dataTable.Api ) {
		oDTSettings = new $.fn.dataTable.Api( dt ).settings()[0];
	}
	// 1.9 compatibility
	else if ( dt.fnSettings ) {
		// DataTables object, convert to the settings object
		oDTSettings = dt.fnSettings();
	}
	else if ( typeof dt === 'string' ) {
		// jQuery selector
		if ( $.fn.dataTable.fnIsDataTable( $(dt)[0] ) ) {
			oDTSettings = $(dt).eq(0).dataTable().fnSettings();
		}
	}
	else if ( dt.nodeName && dt.nodeName.toLowerCase() === 'table' ) {
		// Table node
		if ( $.fn.dataTable.fnIsDataTable( dt.nodeName ) ) {
			oDTSettings = $(dt.nodeName).dataTable().fnSettings();
		}
	}
	else if ( dt instanceof jQuery ) {
		// jQuery object
		if ( $.fn.dataTable.fnIsDataTable( dt[0] ) ) {
			oDTSettings = dt.eq(0).dataTable().fnSettings();
		}
	}
	else {
		// DataTables settings object
		oDTSettings = dt;
	}

	// Convert from camelCase to Hungarian, just as DataTables does
	var camelToHungarian = $.fn.dataTable.camelToHungarian;
	if ( camelToHungarian ) {
		camelToHungarian( ColReorder.defaults, ColReorder.defaults, true );
		camelToHungarian( ColReorder.defaults, opts || {} );
	}


	/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
	 * Public class variables
	 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

	/**
	 * @namespace Settings object which contains customisable information for ColReorder instance
	 */
	this.s = {
		/**
		 * DataTables settings object
		 *  @property dt
		 *  @type     Object
		 *  @default  null
		 */
		"dt": null,

		/**
		 * Initialisation object used for this instance
		 *  @property init
		 *  @type     object
		 *  @default  {}
		 */
		"init": $.extend( true, {}, ColReorder.defaults, opts ),

		/**
		 * Number of columns to fix (not allow to be reordered)
		 *  @property fixed
		 *  @type     int
		 *  @default  0
		 */
		"fixed": 0,

		/**
		 * Number of columns to fix counting from right (not allow to be reordered)
		 *  @property fixedRight
		 *  @type     int
		 *  @default  0
		 */
		"fixedRight": 0,

		/**
		 * Callback function for once the reorder has been done
		 *  @property dropcallback
		 *  @type     function
		 *  @default  null
		 */
		"dropCallback": null,

		/**
		 * @namespace Information used for the mouse drag
		 */
		"mouse": {
			"startX": -1,
			"startY": -1,
			"offsetX": -1,
			"offsetY": -1,
			"target": -1,
			"targetIndex": -1,
			"fromIndex": -1
		},

		/**
		 * Information which is used for positioning the insert cusor and knowing where to do the
		 * insert. Array of objects with the properties:
		 *   x: x-axis position
		 *   to: insert point
		 *  @property aoTargets
		 *  @type     array
		 *  @default  []
		 */
		"aoTargets": []
	};


	/**
	 * @namespace Common and useful DOM elements for the class instance
	 */
	this.dom = {
		/**
		 * Dragging element (the one the mouse is moving)
		 *  @property drag
		 *  @type     element
		 *  @default  null
		 */
		"drag": null,

		/**
		 * The insert cursor
		 *  @property pointer
		 *  @type     element
		 *  @default  null
		 */
		"pointer": null
	};


	/* Constructor logic */
	this.s.dt = oDTSettings.oInstance.fnSettings();
	this.s.dt._colReorder = this;
	this._fnConstruct();

	/* Add destroy callback */
	oDTSettings.oApi._fnCallbackReg(oDTSettings, 'aoDestroyCallback', $.proxy(this._fnDestroy, this), 'ColReorder');

	return this;
};



ColReorder.prototype = {
	/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
	 * Public methods
	 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

	/**
	 * Reset the column ordering to the original ordering that was detected on
	 * start up.
	 *  @return {this} Returns `this` for chaining.
	 *
	 *  @example
	 *    // DataTables initialisation with ColReorder
	 *    var table = $('#example').dataTable( {
	 *        "sDom": 'Rlfrtip'
	 *    } );
	 *
	 *    // Add click event to a button to reset the ordering
	 *    $('#resetOrdering').click( function (e) {
	 *        e.preventDefault();
	 *        $.fn.dataTable.ColReorder( table ).fnReset();
	 *    } );
	 */
	"fnReset": function ()
	{
		var a = [];
		for ( var i=0, iLen=this.s.dt.aoColumns.length ; i<iLen ; i++ )
		{
			a.push( this.s.dt.aoColumns[i]._ColReorder_iOrigCol );
		}

		this._fnOrderColumns( a );

		return this;
	},

	/**
	 * `Deprecated` - Get the current order of the columns, as an array.
	 *  @return {array} Array of column identifiers
	 *  @deprecated `fnOrder` should be used in preference to this method.
	 *      `fnOrder` acts as a getter/setter.
	 */
	"fnGetCurrentOrder": function ()
	{
		return this.fnOrder();
	},

	/**
	 * Get the current order of the columns, as an array. Note that the values
	 * given in the array are unique identifiers for each column. Currently
	 * these are the original ordering of the columns that was detected on
	 * start up, but this could potentially change in future.
	 *  @return {array} Array of column identifiers
	 *
	 *  @example
	 *    // Get column ordering for the table
	 *    var order = $.fn.dataTable.ColReorder( dataTable ).fnOrder();
	 *//**
	 * Set the order of the columns, from the positions identified in the
	 * ordering array given. Note that ColReorder takes a brute force approach
	 * to reordering, so it is possible multiple reordering events will occur
	 * before the final order is settled upon.
	 *  @param {array} [set] Array of column identifiers in the new order. Note
	 *    that every column must be included, uniquely, in this array.
	 *  @return {this} Returns `this` for chaining.
	 *
	 *  @example
	 *    // Swap the first and second columns
	 *    $.fn.dataTable.ColReorder( dataTable ).fnOrder( [1, 0, 2, 3, 4] );
	 *
	 *  @example
	 *    // Move the first column to the end for the table `#example`
	 *    var curr = $.fn.dataTable.ColReorder( '#example' ).fnOrder();
	 *    var first = curr.shift();
	 *    curr.push( first );
	 *    $.fn.dataTable.ColReorder( '#example' ).fnOrder( curr );
	 *
	 *  @example
	 *    // Reverse the table's order
	 *    $.fn.dataTable.ColReorder( '#example' ).fnOrder(
	 *      $.fn.dataTable.ColReorder( '#example' ).fnOrder().reverse()
	 *    );
	 */
	"fnOrder": function ( set )
	{
		if ( set === undefined )
		{
			var a = [];
			for ( var i=0, iLen=this.s.dt.aoColumns.length ; i<iLen ; i++ )
			{
				a.push( this.s.dt.aoColumns[i]._ColReorder_iOrigCol );
			}
			return a;
		}

		this._fnOrderColumns( fnInvertKeyValues( set ) );

		return this;
	},


	/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
	 * Private methods (they are of course public in JS, but recommended as private)
	 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

	/**
	 * Constructor logic
	 *  @method  _fnConstruct
	 *  @returns void
	 *  @private
	 */
	"_fnConstruct": function ()
	{
		var that = this;
		var iLen = this.s.dt.aoColumns.length;
		var i;

		/* Columns discounted from reordering - counting left to right */
		if ( this.s.init.iFixedColumns )
		{
			this.s.fixed = this.s.init.iFixedColumns;
		}

		/* Columns discounted from reordering - counting right to left */
		this.s.fixedRight = this.s.init.iFixedColumnsRight ?
			this.s.init.iFixedColumnsRight :
			0;

		/* Drop callback initialisation option */
		if ( this.s.init.fnReorderCallback )
		{
			this.s.dropCallback = this.s.init.fnReorderCallback;
		}

		/* Add event handlers for the drag and drop, and also mark the original column order */
		for ( i = 0; i < iLen; i++ )
		{
			if ( i > this.s.fixed-1 && i < iLen - this.s.fixedRight )
			{
				this._fnMouseListener( i, this.s.dt.aoColumns[i].nTh );
			}

			/* Mark the original column order for later reference */
			this.s.dt.aoColumns[i]._ColReorder_iOrigCol = i;
		}

		/* State saving */
		this.s.dt.oApi._fnCallbackReg( this.s.dt, 'aoStateSaveParams', function (oS, oData) {
			that._fnStateSave.call( that, oData );
		}, "ColReorder_State" );

		/* An initial column order has been specified */
		var aiOrder = null;
		if ( this.s.init.aiOrder )
		{
			aiOrder = this.s.init.aiOrder.slice();
		}

		/* State loading, overrides the column order given */
		if ( this.s.dt.oLoadedState && typeof this.s.dt.oLoadedState.ColReorder != 'undefined' &&
		  this.s.dt.oLoadedState.ColReorder.length == this.s.dt.aoColumns.length )
		{
			aiOrder = this.s.dt.oLoadedState.ColReorder;
		}

		/* If we have an order to apply - do so */
		if ( aiOrder )
		{
			/* We might be called during or after the DataTables initialisation. If before, then we need
			 * to wait until the draw is done, if after, then do what we need to do right away
			 */
			if ( !that.s.dt._bInitComplete )
			{
				var bDone = false;
				this.s.dt.aoDrawCallback.push( {
					"fn": function () {
						if ( !that.s.dt._bInitComplete && !bDone )
						{
							bDone = true;
							var resort = fnInvertKeyValues( aiOrder );
							that._fnOrderColumns.call( that, resort );
						}
					},
					"sName": "ColReorder_Pre"
				} );
			}
			else
			{
				var resort = fnInvertKeyValues( aiOrder );
				that._fnOrderColumns.call( that, resort );
			}
		}
		else {
			this._fnSetColumnIndexes();
		}
	},


	/**
	 * Set the column order from an array
	 *  @method  _fnOrderColumns
	 *  @param   array a An array of integers which dictate the column order that should be applied
	 *  @returns void
	 *  @private
	 */
	"_fnOrderColumns": function ( a )
	{
		if ( a.length != this.s.dt.aoColumns.length )
		{
			this.s.dt.oInstance.oApi._fnLog( this.s.dt, 1, "ColReorder - array reorder does not "+
				"match known number of columns. Skipping." );
			return;
		}

		for ( var i=0, iLen=a.length ; i<iLen ; i++ )
		{
			var currIndex = $.inArray( i, a );
			if ( i != currIndex )
			{
				/* Reorder our switching array */
				fnArraySwitch( a, currIndex, i );

				/* Do the column reorder in the table */
				this.s.dt.oInstance.fnColReorder( currIndex, i );
			}
		}

		/* When scrolling we need to recalculate the column sizes to allow for the shift */
		if ( this.s.dt.oScroll.sX !== "" || this.s.dt.oScroll.sY !== "" )
		{
			this.s.dt.oInstance.fnAdjustColumnSizing();
		}

		/* Save the state */
		this.s.dt.oInstance.oApi._fnSaveState( this.s.dt );

		this._fnSetColumnIndexes();
	},


	/**
	 * Because we change the indexes of columns in the table, relative to their starting point
	 * we need to reorder the state columns to what they are at the starting point so we can
	 * then rearrange them again on state load!
	 *  @method  _fnStateSave
	 *  @param   object oState DataTables state
	 *  @returns string JSON encoded cookie string for DataTables
	 *  @private
	 */
	"_fnStateSave": function ( oState )
	{
		var i, iLen, aCopy, iOrigColumn;
		var oSettings = this.s.dt;
		var columns = oSettings.aoColumns;

		oState.ColReorder = [];

		/* Sorting */
		if ( oState.aaSorting ) {
			// 1.10.0-
			for ( i=0 ; i<oState.aaSorting.length ; i++ ) {
				oState.aaSorting[i][0] = columns[ oState.aaSorting[i][0] ]._ColReorder_iOrigCol;
			}

			var aSearchCopy = $.extend( true, [], oState.aoSearchCols );

			for ( i=0, iLen=columns.length ; i<iLen ; i++ )
			{
				iOrigColumn = columns[i]._ColReorder_iOrigCol;

				/* Column filter */
				oState.aoSearchCols[ iOrigColumn ] = aSearchCopy[i];

				/* Visibility */
				oState.abVisCols[ iOrigColumn ] = columns[i].bVisible;

				/* Column reordering */
				oState.ColReorder.push( iOrigColumn );
			}
		}
		else if ( oState.order ) {
			// 1.10.1+
			for ( i=0 ; i<oState.order.length ; i++ ) {
				oState.order[i][0] = columns[ oState.order[i][0] ]._ColReorder_iOrigCol;
			}

			var stateColumnsCopy = $.extend( true, [], oState.columns );

			for ( i=0, iLen=columns.length ; i<iLen ; i++ )
			{
				iOrigColumn = columns[i]._ColReorder_iOrigCol;

				/* Columns */
				oState.columns[ iOrigColumn ] = stateColumnsCopy[i];

				/* Column reordering */
				oState.ColReorder.push( iOrigColumn );
			}
		}
	},


	/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
	 * Mouse drop and drag
	 */

	/**
	 * Add a mouse down listener to a particluar TH element
	 *  @method  _fnMouseListener
	 *  @param   int i Column index
	 *  @param   element nTh TH element clicked on
	 *  @returns void
	 *  @private
	 */
	"_fnMouseListener": function ( i, nTh )
	{
		var that = this;
		$(nTh).on( 'mousedown.ColReorder', function (e) {
			e.preventDefault();
			that._fnMouseDown.call( that, e, nTh );
		} );
	},


	/**
	 * Mouse down on a TH element in the table header
	 *  @method  _fnMouseDown
	 *  @param   event e Mouse event
	 *  @param   element nTh TH element to be dragged
	 *  @returns void
	 *  @private
	 */
	"_fnMouseDown": function ( e, nTh )
	{
		var that = this;

		/* Store information about the mouse position */
		var target = $(e.target).closest('th, td');
		var offset = target.offset();
		var idx = parseInt( $(nTh).attr('data-column-index'), 10 );

		if ( idx === undefined ) {
			return;
		}

		this.s.mouse.startX = e.pageX;
		this.s.mouse.startY = e.pageY;
		this.s.mouse.offsetX = e.pageX - offset.left;
		this.s.mouse.offsetY = e.pageY - offset.top;
		this.s.mouse.target = this.s.dt.aoColumns[ idx ].nTh;//target[0];
		this.s.mouse.targetIndex = idx;
		this.s.mouse.fromIndex = idx;

		this._fnRegions();

		/* Add event handlers to the document */
		$(document)
			.on( 'mousemove.ColReorder', function (e) {
				that._fnMouseMove.call( that, e );
			} )
			.on( 'mouseup.ColReorder', function (e) {
				that._fnMouseUp.call( that, e );
			} );
	},


	/**
	 * Deal with a mouse move event while dragging a node
	 *  @method  _fnMouseMove
	 *  @param   event e Mouse event
	 *  @returns void
	 *  @private
	 */
	"_fnMouseMove": function ( e )
	{
		var that = this;

		if ( this.dom.drag === null )
		{
			/* Only create the drag element if the mouse has moved a specific distance from the start
			 * point - this allows the user to make small mouse movements when sorting and not have a
			 * possibly confusing drag element showing up
			 */
			if ( Math.pow(
				Math.pow(e.pageX - this.s.mouse.startX, 2) +
				Math.pow(e.pageY - this.s.mouse.startY, 2), 0.5 ) < 5 )
			{
				return;
			}
			this._fnCreateDragNode();
		}

		/* Position the element - we respect where in the element the click occured */
		this.dom.drag.css( {
			left: e.pageX - this.s.mouse.offsetX,
			top: e.pageY - this.s.mouse.offsetY
		} );

		/* Based on the current mouse position, calculate where the insert should go */
		var bSet = false;
		var lastToIndex = this.s.mouse.toIndex;

		for ( var i=1, iLen=this.s.aoTargets.length ; i<iLen ; i++ )
		{
			if ( e.pageX < this.s.aoTargets[i-1].x + ((this.s.aoTargets[i].x-this.s.aoTargets[i-1].x)/2) )
			{
				this.dom.pointer.css( 'left', this.s.aoTargets[i-1].x );
				this.s.mouse.toIndex = this.s.aoTargets[i-1].to;
				bSet = true;
				break;
			}
		}

		// The insert element wasn't positioned in the array (less than
		// operator), so we put it at the end
		if ( !bSet )
		{
			this.dom.pointer.css( 'left', this.s.aoTargets[this.s.aoTargets.length-1].x );
			this.s.mouse.toIndex = this.s.aoTargets[this.s.aoTargets.length-1].to;
		}

		// Perform reordering if realtime updating is on and the column has moved
		if ( this.s.init.bRealtime && lastToIndex !== this.s.mouse.toIndex ) {
			this.s.dt.oInstance.fnColReorder( this.s.mouse.fromIndex, this.s.mouse.toIndex );
			this.s.mouse.fromIndex = this.s.mouse.toIndex;
			this._fnRegions();
		}
	},


	/**
	 * Finish off the mouse drag and insert the column where needed
	 *  @method  _fnMouseUp
	 *  @param   event e Mouse event
	 *  @returns void
	 *  @private
	 */
	"_fnMouseUp": function ( e )
	{
		var that = this;

		$(document).off( 'mousemove.ColReorder mouseup.ColReorder' );

		if ( this.dom.drag !== null )
		{
			/* Remove the guide elements */
			this.dom.drag.remove();
			this.dom.pointer.remove();
			this.dom.drag = null;
			this.dom.pointer = null;

			/* Actually do the reorder */
			this.s.dt.oInstance.fnColReorder( this.s.mouse.fromIndex, this.s.mouse.toIndex );
			this._fnSetColumnIndexes();

			/* When scrolling we need to recalculate the column sizes to allow for the shift */
			if ( this.s.dt.oScroll.sX !== "" || this.s.dt.oScroll.sY !== "" )
			{
				this.s.dt.oInstance.fnAdjustColumnSizing();
			}

			if ( this.s.dropCallback !== null )
			{
				this.s.dropCallback.call( this );
			}

			/* Save the state */
			this.s.dt.oInstance.oApi._fnSaveState( this.s.dt );
		}
	},


	/**
	 * Calculate a cached array with the points of the column inserts, and the
	 * 'to' points
	 *  @method  _fnRegions
	 *  @returns void
	 *  @private
	 */
	"_fnRegions": function ()
	{
		var aoColumns = this.s.dt.aoColumns;

		this.s.aoTargets.splice( 0, this.s.aoTargets.length );

		this.s.aoTargets.push( {
			"x":  $(this.s.dt.nTable).offset().left,
			"to": 0
		} );

		var iToPoint = 0;
		for ( var i=0, iLen=aoColumns.length ; i<iLen ; i++ )
		{
			/* For the column / header in question, we want it's position to remain the same if the
			 * position is just to it's immediate left or right, so we only incremement the counter for
			 * other columns
			 */
			if ( i != this.s.mouse.fromIndex )
			{
				iToPoint++;
			}

			if ( aoColumns[i].bVisible )
			{
				this.s.aoTargets.push( {
					"x":  $(aoColumns[i].nTh).offset().left + $(aoColumns[i].nTh).outerWidth(),
					"to": iToPoint
				} );
			}
		}

		/* Disallow columns for being reordered by drag and drop, counting right to left */
		if ( this.s.fixedRight !== 0 )
		{
			this.s.aoTargets.splice( this.s.aoTargets.length - this.s.fixedRight );
		}

		/* Disallow columns for being reordered by drag and drop, counting left to right */
		if ( this.s.fixed !== 0 )
		{
			this.s.aoTargets.splice( 0, this.s.fixed );
		}
	},


	/**
	 * Copy the TH element that is being drags so the user has the idea that they are actually
	 * moving it around the page.
	 *  @method  _fnCreateDragNode
	 *  @returns void
	 *  @private
	 */
	"_fnCreateDragNode": function ()
	{
		var scrolling = this.s.dt.oScroll.sX !== "" || this.s.dt.oScroll.sY !== "";

		var origCell = this.s.dt.aoColumns[ this.s.mouse.targetIndex ].nTh;
		var origTr = origCell.parentNode;
		var origThead = origTr.parentNode;
		var origTable = origThead.parentNode;
		var cloneCell = $(origCell).clone();

		// This is a slightly odd combination of jQuery and DOM, but it is the
		// fastest and least resource intensive way I could think of cloning
		// the table with just a single header cell in it.
		this.dom.drag = $(origTable.cloneNode(false))
			.addClass( 'DTCR_clonedTable' )
			.append(
				origThead.cloneNode(false).appendChild(
					origTr.cloneNode(false).appendChild(
						cloneCell[0]
					)
				)
			)
			.css( {
				position: 'absolute',
				top: 0,
				left: 0,
				width: $(origCell).outerWidth(),
				height: $(origCell).outerHeight()
			} )
			.appendTo( 'body' );

		this.dom.pointer = $('<div></div>')
			.addClass( 'DTCR_pointer' )
			.css( {
				position: 'absolute',
				top: scrolling ?
					$('div.dataTables_scroll', this.s.dt.nTableWrapper).offset().top :
					$(this.s.dt.nTable).offset().top,
				height : scrolling ?
					$('div.dataTables_scroll', this.s.dt.nTableWrapper).height() :
					$(this.s.dt.nTable).height()
			} )
			.appendTo( 'body' );
	},

	/**
	 * Clean up ColReorder memory references and event handlers
	 *  @method  _fnDestroy
	 *  @returns void
	 *  @private
	 */
	"_fnDestroy": function ()
	{
		var i, iLen;

		for ( i=0, iLen=this.s.dt.aoDrawCallback.length ; i<iLen ; i++ )
		{
			if ( this.s.dt.aoDrawCallback[i].sName === 'ColReorder_Pre' )
			{
				this.s.dt.aoDrawCallback.splice( i, 1 );
				break;
			}
		}

		$(this.s.dt.nTHead).find( '*' ).off( '.ColReorder' );

		$.each( this.s.dt.aoColumns, function (i, column) {
			$(column.nTh).removeAttr('data-column-index');
		} );

		this.s.dt._colReorder = null;
		this.s = null;
	},


	/**
	 * Add a data attribute to the column headers, so we know the index of
	 * the row to be reordered. This allows fast detection of the index, and
	 * for this plug-in to work with FixedHeader which clones the nodes.
	 *  @private
	 */
	"_fnSetColumnIndexes": function ()
	{
		$.each( this.s.dt.aoColumns, function (i, column) {
			$(column.nTh).attr('data-column-index', i);
		} );
	}
};





/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * Static parameters
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */


/**
 * ColReorder default settings for initialisation
 *  @namespace
 *  @static
 */
ColReorder.defaults = {
	/**
	 * Predefined ordering for the columns that will be applied automatically
	 * on initialisation. If not specified then the order that the columns are
	 * found to be in the HTML is the order used.
	 *  @type array
	 *  @default null
	 *  @static
	 *  @example
	 *      // Using the `oColReorder` option in the DataTables options object
	 *      $('#example').dataTable( {
	 *          "sDom": 'Rlfrtip',
	 *          "oColReorder": {
	 *              "aiOrder": [ 4, 3, 2, 1, 0 ]
	 *          }
	 *      } );
	 *
	 *  @example
	 *      // Using `new` constructor
	 *      $('#example').dataTable()
	 *
	 *      new $.fn.dataTable.ColReorder( '#example', {
	 *          "aiOrder": [ 4, 3, 2, 1, 0 ]
	 *      } );
	 */
	aiOrder: null,

	/**
	 * Redraw the table's column ordering as the end user draws the column
	 * (`true`) or wait until the mouse is released (`false` - default). Note
	 * that this will perform a redraw on each reordering, which involves an
	 * Ajax request each time if you are using server-side processing in
	 * DataTables.
	 *  @type boolean
	 *  @default false
	 *  @static
	 *  @example
	 *      // Using the `oColReorder` option in the DataTables options object
	 *      $('#example').dataTable( {
	 *          "sDom": 'Rlfrtip',
	 *          "oColReorder": {
	 *              "bRealtime": true
	 *          }
	 *      } );
	 *
	 *  @example
	 *      // Using `new` constructor
	 *      $('#example').dataTable()
	 *
	 *      new $.fn.dataTable.ColReorder( '#example', {
	 *          "bRealtime": true
	 *      } );
	 */
	bRealtime: false,

	/**
	 * Indicate how many columns should be fixed in position (counting from the
	 * left). This will typically be 1 if used, but can be as high as you like.
	 *  @type int
	 *  @default 0
	 *  @static
	 *  @example
	 *      // Using the `oColReorder` option in the DataTables options object
	 *      $('#example').dataTable( {
	 *          "sDom": 'Rlfrtip',
	 *          "oColReorder": {
	 *              "iFixedColumns": 1
	 *          }
	 *      } );
	 *
	 *  @example
	 *      // Using `new` constructor
	 *      $('#example').dataTable()
	 *
	 *      new $.fn.dataTable.ColReorder( '#example', {
	 *          "iFixedColumns": 1
	 *      } );
	 */
	iFixedColumns: 0,

	/**
	 * As `iFixedColumnsRight` but counting from the right.
	 *  @type int
	 *  @default 0
	 *  @static
	 *  @example
	 *      // Using the `oColReorder` option in the DataTables options object
	 *      $('#example').dataTable( {
	 *          "sDom": 'Rlfrtip',
	 *          "oColReorder": {
	 *              "iFixedColumnsRight": 1
	 *          }
	 *      } );
	 *
	 *  @example
	 *      // Using `new` constructor
	 *      $('#example').dataTable()
	 *
	 *      new $.fn.dataTable.ColReorder( '#example', {
	 *          "iFixedColumnsRight": 1
	 *      } );
	 */
	iFixedColumnsRight: 0,

	/**
	 * Callback function that is fired when columns are reordered
	 *  @type function():void
	 *  @default null
	 *  @static
	 *  @example
	 *      // Using the `oColReorder` option in the DataTables options object
	 *      $('#example').dataTable( {
	 *          "sDom": 'Rlfrtip',
	 *          "oColReorder": {
	 *              "fnReorderCallback": function () {
	 *                  alert( 'Columns reordered' );
	 *              }
	 *          }
	 *      } );
	 *
	 *  @example
	 *      // Using `new` constructor
	 *      $('#example').dataTable()
	 *
	 *      new $.fn.dataTable.ColReorder( '#example', {
	 *          "fnReorderCallback": function () {
	 *              alert( 'Columns reordered' );
	 *          }
	 *      } );
	 */
	fnReorderCallback: null
};



/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * Constants
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

/**
 * ColReorder version
 *  @constant  version
 *  @type      String
 *  @default   As code
 */
ColReorder.version = "1.1.2";



/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * DataTables interfaces
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

// Expose
$.fn.dataTable.ColReorder = ColReorder;
$.fn.DataTable.ColReorder = ColReorder;


// Register a new feature with DataTables
if ( typeof $.fn.dataTable == "function" &&
     typeof $.fn.dataTableExt.fnVersionCheck == "function" &&
     $.fn.dataTableExt.fnVersionCheck('1.9.3') )
{
	$.fn.dataTableExt.aoFeatures.push( {
		"fnInit": function( settings ) {
			var table = settings.oInstance;

			if ( ! settings._colReorder ) {
				var dtInit = settings.oInit;
				var opts = dtInit.colReorder || dtInit.oColReorder || {};

				new ColReorder( settings, opts );
			}
			else {
				table.oApi._fnLog( settings, 1, "ColReorder attempted to initialise twice. Ignoring second" );
			}

			return null; /* No node for DataTables to insert */
		},
		"cFeature": "R",
		"sFeature": "ColReorder"
	} );
}
else {
	alert( "Warning: ColReorder requires DataTables 1.9.3 or greater - www.datatables.net/download");
}


// API augmentation
if ( $.fn.dataTable.Api ) {
	$.fn.dataTable.Api.register( 'colReorder.reset()', function () {
		return this.iterator( 'table', function ( ctx ) {
			ctx._colReorder.fnReset();
		} );
	} );

	$.fn.dataTable.Api.register( 'colReorder.order()', function ( set ) {
		if ( set ) {
			return this.iterator( 'table', function ( ctx ) {
				ctx._colReorder.fnOrder( set );
			} );
		}

		return this.context.length ?
			this.context[0]._colReorder.fnOrder() :
			null;
	} );
}

return ColReorder;
}; // /factory


// Define as an AMD module if possible
if ( typeof define === 'function' && define.amd ) {
	define( ['jquery', 'datatables'], factory );
}
else if ( typeof exports === 'object' ) {
    // Node/CommonJS
    factory( require('jquery'), require('datatables') );
}
else if ( jQuery && !jQuery.fn.dataTable.ColReorder ) {
	// Otherwise simply initialise as normal, stopping multiple evaluation
	factory( jQuery, jQuery.fn.dataTable );
}


})(window, document);

/*! FixedHeader 3.1.2
 * ©2009-2016 SpryMedia Ltd - datatables.net/license
 */

/**
 * @summary     FixedHeader
 * @description Fix a table's header or footer, so it is always visible while
 *              scrolling
 * @version     3.1.2
 * @file        dataTables.fixedHeader.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk/contact
 * @copyright   Copyright 2009-2016 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */

(function( factory ){
	if ( typeof define === 'function' && define.amd ) {
		// AMD
		define( ['jquery', 'datatables.net'], function ( $ ) {
			return factory( $, window, document );
		} );
	}
	else if ( typeof exports === 'object' ) {
		// CommonJS
		module.exports = function (root, $) {
			if ( ! root ) {
				root = window;
			}

			if ( ! $ || ! $.fn.dataTable ) {
				$ = require('datatables.net')(root, $).$;
			}

			return factory( $, root, root.document );
		};
	}
	else {
		// Browser
		factory( jQuery, window, document );
	}
}(function( $, window, document, undefined ) {
'use strict';
var DataTable = $.fn.dataTable;


var _instCounter = 0;

var FixedHeader = function ( dt, config ) {
	// Sanity check - you just know it will happen
	if ( ! (this instanceof FixedHeader) ) {
		throw "FixedHeader must be initialised with the 'new' keyword.";
	}

	// Allow a boolean true for defaults
	if ( config === true ) {
		config = {};
	}

	dt = new DataTable.Api( dt );

	this.c = $.extend( true, {}, FixedHeader.defaults, config );

	this.s = {
		dt: dt,
		position: {
			theadTop: 0,
			tbodyTop: 0,
			tfootTop: 0,
			tfootBottom: 0,
			width: 0,
			left: 0,
			tfootHeight: 0,
			theadHeight: 0,
			windowHeight: $(window).height(),
			visible: true
		},
		headerMode: null,
		footerMode: null,
		autoWidth: dt.settings()[0].oFeatures.bAutoWidth,
		namespace: '.dtfc'+(_instCounter++),
		scrollLeft: {
			header: -1,
			footer: -1
		},
		enable: true
	};

	this.dom = {
		floatingHeader: null,
		thead: $(dt.table().header()),
		tbody: $(dt.table().body()),
		tfoot: $(dt.table().footer()),
		header: {
			host: null,
			floating: null,
			placeholder: null
		},
		footer: {
			host: null,
			floating: null,
			placeholder: null
		}
	};

	this.dom.header.host = this.dom.thead.parent();
	this.dom.footer.host = this.dom.tfoot.parent();

	var dtSettings = dt.settings()[0];
	if ( dtSettings._fixedHeader ) {
		throw "FixedHeader already initialised on table "+dtSettings.nTable.id;
	}

	dtSettings._fixedHeader = this;

	this._constructor();
};


/*
 * Variable: FixedHeader
 * Purpose:  Prototype for FixedHeader
 * Scope:    global
 */
$.extend( FixedHeader.prototype, {
	/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
	 * API methods
	 */
	
	/**
	 * Enable / disable the fixed elements
	 *
	 * @param  {boolean} enable `true` to enable, `false` to disable
	 */
	enable: function ( enable )
	{
		this.s.enable = enable;

		if ( this.c.header ) {
			this._modeChange( 'in-place', 'header', true );
		}

		if ( this.c.footer && this.dom.tfoot.length ) {
			this._modeChange( 'in-place', 'footer', true );
		}

		this.update();
	},
	
	/**
	 * Set header offset 
	 *
	 * @param  {int} new value for headerOffset
	 */
	headerOffset: function ( offset )
	{
		if ( offset !== undefined ) {
			this.c.headerOffset = offset;
			this.update();
		}

		return this.c.headerOffset;
	},
	
	/**
	 * Set footer offset
	 *
	 * @param  {int} new value for footerOffset
	 */
	footerOffset: function ( offset )
	{
		if ( offset !== undefined ) {
			this.c.footerOffset = offset;
			this.update();
		}

		return this.c.footerOffset;
	},

	
	/**
	 * Recalculate the position of the fixed elements and force them into place
	 */
	update: function ()
	{
		this._positions();
		this._scroll( true );
	},


	/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
	 * Constructor
	 */
	
	/**
	 * FixedHeader constructor - adding the required event listeners and
	 * simple initialisation
	 *
	 * @private
	 */
	_constructor: function ()
	{
		var that = this;
		var dt = this.s.dt;

		$(window)
			.on( 'scroll'+this.s.namespace, function () {
				that._scroll();
			} )
			.on( 'resize'+this.s.namespace, function () {
				that.s.position.windowHeight = $(window).height();
				that.update();
			} );

		var autoHeader = $('.fh-fixedHeader');
		if ( ! this.c.headerOffset && autoHeader.length ) {
			this.c.headerOffset = autoHeader.outerHeight();
		}

		var autoFooter = $('.fh-fixedFooter');
		if ( ! this.c.footerOffset && autoFooter.length ) {
			this.c.footerOffset = autoFooter.outerHeight();
		}

		dt.on( 'column-reorder.dt.dtfc column-visibility.dt.dtfc draw.dt.dtfc column-sizing.dt.dtfc', function () {
			that.update();
		} );

		dt.on( 'destroy.dtfc', function () {
			dt.off( '.dtfc' );
			$(window).off( that.s.namespace );
		} );

		this._positions();
		this._scroll();
	},


	/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
	 * Private methods
	 */

	/**
	 * Clone a fixed item to act as a place holder for the original element
	 * which is moved into a clone of the table element, and moved around the
	 * document to give the fixed effect.
	 *
	 * @param  {string}  item  'header' or 'footer'
	 * @param  {boolean} force Force the clone to happen, or allow automatic
	 *   decision (reuse existing if available)
	 * @private
	 */
	_clone: function ( item, force )
	{
		var dt = this.s.dt;
		var itemDom = this.dom[ item ];
		var itemElement = item === 'header' ?
			this.dom.thead :
			this.dom.tfoot;

		if ( ! force && itemDom.floating ) {
			// existing floating element - reuse it
			itemDom.floating.removeClass( 'fixedHeader-floating fixedHeader-locked' );
		}
		else {
			if ( itemDom.floating ) {
				itemDom.placeholder.remove();
				this._unsize( item );
				itemDom.floating.children().detach();
				itemDom.floating.remove();
			}

			itemDom.floating = $( dt.table().node().cloneNode( false ) )
				.css( 'table-layout', 'fixed' )
				.removeAttr( 'id' )
				.append( itemElement )
				.appendTo( 'body' );

			// Insert a fake thead/tfoot into the DataTable to stop it jumping around
			itemDom.placeholder = itemElement.clone( false );
			itemDom.host.prepend( itemDom.placeholder );

			// Clone widths
			this._matchWidths( itemDom.placeholder, itemDom.floating );
		}
	},

	/**
	 * Copy widths from the cells in one element to another. This is required
	 * for the footer as the footer in the main table takes its sizes from the
	 * header columns. That isn't present in the footer so to have it still
	 * align correctly, the sizes need to be copied over. It is also required
	 * for the header when auto width is not enabled
	 *
	 * @param  {jQuery} from Copy widths from
	 * @param  {jQuery} to   Copy widths to
	 * @private
	 */
	_matchWidths: function ( from, to ) {
		var get = function ( name ) {
			return $(name, from)
				.map( function () {
					return $(this).width();
				} ).toArray();
		};

		var set = function ( name, toWidths ) {
			$(name, to).each( function ( i ) {
				$(this).css( {
					width: toWidths[i],
					minWidth: toWidths[i]
				} );
			} );
		};

		var thWidths = get( 'th' );
		var tdWidths = get( 'td' );

		set( 'th', thWidths );
		set( 'td', tdWidths );
	},

	/**
	 * Remove assigned widths from the cells in an element. This is required
	 * when inserting the footer back into the main table so the size is defined
	 * by the header columns and also when auto width is disabled in the
	 * DataTable.
	 *
	 * @param  {string} item The `header` or `footer`
	 * @private
	 */
	_unsize: function ( item ) {
		var el = this.dom[ item ].floating;

		if ( el && (item === 'footer' || (item === 'header' && ! this.s.autoWidth)) ) {
			$('th, td', el).css( {
				width: '',
				minWidth: ''
			} );
		}
		else if ( el && item === 'header' ) {
			$('th, td', el).css( 'min-width', '' );
		}
	},

	/**
	 * Reposition the floating elements to take account of horizontal page
	 * scroll
	 *
	 * @param  {string} item       The `header` or `footer`
	 * @param  {int}    scrollLeft Document scrollLeft
	 * @private
	 */
	_horizontal: function ( item, scrollLeft )
	{
		var itemDom = this.dom[ item ];
		var position = this.s.position;
		var lastScrollLeft = this.s.scrollLeft;

		if ( itemDom.floating && lastScrollLeft[ item ] !== scrollLeft ) {
			itemDom.floating.css( 'left', position.left - scrollLeft );

			lastScrollLeft[ item ] = scrollLeft;
		}
	},

	/**
	 * Change from one display mode to another. Each fixed item can be in one
	 * of:
	 *
	 * * `in-place` - In the main DataTable
	 * * `in` - Floating over the DataTable
	 * * `below` - (Header only) Fixed to the bottom of the table body
	 * * `above` - (Footer only) Fixed to the top of the table body
	 * 
	 * @param  {string}  mode        Mode that the item should be shown in
	 * @param  {string}  item        'header' or 'footer'
	 * @param  {boolean} forceChange Force a redraw of the mode, even if already
	 *     in that mode.
	 * @private
	 */
	_modeChange: function ( mode, item, forceChange )
	{
		var dt = this.s.dt;
		var itemDom = this.dom[ item ];
		var position = this.s.position;

		// Record focus. Browser's will cause input elements to loose focus if
		// they are inserted else where in the doc
		var tablePart = this.dom[ item==='footer' ? 'tfoot' : 'thead' ];
		var focus = $.contains( tablePart[0], document.activeElement ) ?
			document.activeElement :
			null;

		if ( mode === 'in-place' ) {
			// Insert the header back into the table's real header
			if ( itemDom.placeholder ) {
				itemDom.placeholder.remove();
				itemDom.placeholder = null;
			}

			this._unsize( item );

			if ( item === 'header' ) {
				itemDom.host.prepend( this.dom.thead );
			}
			else {
				itemDom.host.append( this.dom.tfoot );
			}

			if ( itemDom.floating ) {
				itemDom.floating.remove();
				itemDom.floating = null;
			}
		}
		else if ( mode === 'in' ) {
			// Remove the header from the read header and insert into a fixed
			// positioned floating table clone
			this._clone( item, forceChange );

			itemDom.floating
				.addClass( 'fixedHeader-floating' )
				.css( item === 'header' ? 'top' : 'bottom', this.c[item+'Offset'] )
				.css( 'left', position.left+'px' )
				.css( 'width', position.width+'px' );

			if ( item === 'footer' ) {
				itemDom.floating.css( 'top', '' );
			}
		}
		else if ( mode === 'below' ) { // only used for the header
			// Fix the position of the floating header at base of the table body
			this._clone( item, forceChange );

			itemDom.floating
				.addClass( 'fixedHeader-locked' )
				.css( 'top', position.tfootTop - position.theadHeight )
				.css( 'left', position.left+'px' )
				.css( 'width', position.width+'px' );
		}
		else if ( mode === 'above' ) { // only used for the footer
			// Fix the position of the floating footer at top of the table body
			this._clone( item, forceChange );

			itemDom.floating
				.addClass( 'fixedHeader-locked' )
				.css( 'top', position.tbodyTop )
				.css( 'left', position.left+'px' )
				.css( 'width', position.width+'px' );
		}

		// Restore focus if it was lost
		if ( focus && focus !== document.activeElement ) {
			focus.focus();
		}

		this.s.scrollLeft.header = -1;
		this.s.scrollLeft.footer = -1;
		this.s[item+'Mode'] = mode;
	},

	/**
	 * Cache the positional information that is required for the mode
	 * calculations that FixedHeader performs.
	 *
	 * @private
	 */
	_positions: function ()
	{
		var dt = this.s.dt;
		var table = dt.table();
		var position = this.s.position;
		var dom = this.dom;
		var tableNode = $(table.node());

		// Need to use the header and footer that are in the main table,
		// regardless of if they are clones, since they hold the positions we
		// want to measure from
		var thead = tableNode.children('thead');
		var tfoot = tableNode.children('tfoot');
		var tbody = dom.tbody;

		position.visible = tableNode.is(':visible');
		position.width = tableNode.outerWidth();
		position.left = tableNode.offset().left;
		position.theadTop = thead.offset().top;
		position.tbodyTop = tbody.offset().top;
		position.theadHeight = position.tbodyTop - position.theadTop;

		if ( tfoot.length ) {
			position.tfootTop = tfoot.offset().top;
			position.tfootBottom = position.tfootTop + tfoot.outerHeight();
			position.tfootHeight = position.tfootBottom - position.tfootTop;
		}
		else {
			position.tfootTop = position.tbodyTop + tbody.outerHeight();
			position.tfootBottom = position.tfootTop;
			position.tfootHeight = position.tfootTop;
		}
	},


	/**
	 * Mode calculation - determine what mode the fixed items should be placed
	 * into.
	 *
	 * @param  {boolean} forceChange Force a redraw of the mode, even if already
	 *     in that mode.
	 * @private
	 */
	_scroll: function ( forceChange )
	{
		var windowTop = $(document).scrollTop();
		var windowLeft = $(document).scrollLeft();
		var position = this.s.position;
		var headerMode, footerMode;

		if ( ! this.s.enable ) {
			return;
		}

		if ( this.c.header ) {
			if ( ! position.visible || windowTop <= position.theadTop - this.c.headerOffset ) {
				headerMode = 'in-place';
			}
			else if ( windowTop <= position.tfootTop - position.theadHeight - this.c.headerOffset ) {
				headerMode = 'in';
			}
			else {
				headerMode = 'below';
			}

			if ( forceChange || headerMode !== this.s.headerMode ) {
				this._modeChange( headerMode, 'header', forceChange );
			}

			this._horizontal( 'header', windowLeft );
		}

		if ( this.c.footer && this.dom.tfoot.length ) {
			if ( ! position.visible || windowTop + position.windowHeight >= position.tfootBottom + this.c.footerOffset ) {
				footerMode = 'in-place';
			}
			else if ( position.windowHeight + windowTop > position.tbodyTop + position.tfootHeight + this.c.footerOffset ) {
				footerMode = 'in';
			}
			else {
				footerMode = 'above';
			}

			if ( forceChange || footerMode !== this.s.footerMode ) {
				this._modeChange( footerMode, 'footer', forceChange );
			}

			this._horizontal( 'footer', windowLeft );
		}
	}
} );


/**
 * Version
 * @type {String}
 * @static
 */
FixedHeader.version = "3.1.2";

/**
 * Defaults
 * @type {Object}
 * @static
 */
FixedHeader.defaults = {
	header: true,
	footer: false,
	headerOffset: 0,
	footerOffset: 0
};


/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * DataTables interfaces
 */

// Attach for constructor access
$.fn.dataTable.FixedHeader = FixedHeader;
$.fn.DataTable.FixedHeader = FixedHeader;


// DataTables creation - check if the FixedHeader option has been defined on the
// table and if so, initialise
$(document).on( 'init.dt.dtfh', function (e, settings, json) {
	if ( e.namespace !== 'dt' ) {
		return;
	}

	var init = settings.oInit.fixedHeader;
	var defaults = DataTable.defaults.fixedHeader;

	if ( (init || defaults) && ! settings._fixedHeader ) {
		var opts = $.extend( {}, defaults, init );

		if ( init !== false ) {
			new FixedHeader( settings, opts );
		}
	}
} );

// DataTables API methods
DataTable.Api.register( 'fixedHeader()', function () {} );

DataTable.Api.register( 'fixedHeader.adjust()', function () {
	return this.iterator( 'table', function ( ctx ) {
		var fh = ctx._fixedHeader;

		if ( fh ) {
			fh.update();
		}
	} );
} );

DataTable.Api.register( 'fixedHeader.enable()', function ( flag ) {
	return this.iterator( 'table', function ( ctx ) {
		var fh = ctx._fixedHeader;

		if ( fh ) {
			fh.enable( flag !== undefined ? flag : true );
		}
	} );
} );

DataTable.Api.register( 'fixedHeader.disable()', function ( ) {
	return this.iterator( 'table', function ( ctx ) {
		var fh = ctx._fixedHeader;

		if ( fh ) {
			fh.enable( false );
		}
	} );
} );

$.each( ['header', 'footer'], function ( i, el ) {
	DataTable.Api.register( 'fixedHeader.'+el+'Offset()', function ( offset ) {
		var ctx = this.context;

		if ( offset === undefined ) {
			return ctx.length && ctx[0]._fixedHeader ?
				ctx[0]._fixedHeader[el +'Offset']() :
				undefined;
		}

		return this.iterator( 'table', function ( ctx ) {
			var fh = ctx._fixedHeader;

			if ( fh ) {
				fh[ el +'Offset' ]( offset );
			}
		} );
	} );
} );


return FixedHeader;
}));

/* =========================================================
 * foundation-datepicker.js
 * Copyright 2013 Peter Beno, najlepsiwebdesigner@gmail.com, @benopeter
 * project website http://foundation-datepicker.peterbeno.com
 *
 * original project:
 * 		bootstrap-datepicker.js
 * 		http://www.eyecon.ro/bootstrap-datepicker
 * 		=========================================================
 * 		Copyright 2012 Stefan Petre
 * 		Improvements by Andrew Rowls
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================= */

!function( $ ) {

	function UTCDate(){
		return new Date(Date.UTC.apply(Date, arguments));
	}
	function UTCToday(){
		var today = new Date();
		return UTCDate(today.getUTCFullYear(), today.getUTCMonth(), today.getUTCDate());
	}

	// Picker object

	var Datepicker = function(element, options) {
		var that = this;

		this.element = $(element);
		this.closeButton = options.closeButton;
		this.language = options.language||this.element.data('date-language')||"en";
		this.language = this.language in dates ? this.language : this.language.split('-')[0]; //Check if "de-DE" style date is available, if not language should fallback to 2 letter code eg "de"
		this.language = this.language in dates ? this.language : "en";
		this.isRTL = dates[this.language].rtl||false;
		this.format = DPGlobal.parseFormat(options.format||this.element.data('date-format')||dates[this.language].format||'mm/dd/yyyy');
		this.isInline = false;
		this.isInput = this.element.is('input');
		this.component = this.element.is('.date') ? this.element.find('.prefix, .postfix') : false;
		this.hasInput = this.component && this.element.find('input').length;


		this.onRender = options.onRender || function () {};
		if(this.component && this.component.length === 0)
			this.component = false;

		this._attachEvents();

		this.forceParse = true;
		if ('forceParse' in options) {
			this.forceParse = options.forceParse;
		} else if ('dateForceParse' in this.element.data()) {
			this.forceParse = this.element.data('date-force-parse');
		}


		this.picker = $(DPGlobal.template)
							.appendTo(this.isInline ? this.element : 'body')
							.on({
								click: $.proxy(this.click, this),
								mousedown: $.proxy(this.mousedown, this)
							});
		if (this.closeButton){
			this.picker.find('a.datepicker-close').show();
		}

		if(this.isInline) {
			this.picker.addClass('datepicker-inline');
		} else {
			this.picker.addClass('datepicker-dropdown dropdown-menu');
		}
		if (this.isRTL){
			this.picker.addClass('datepicker-rtl');
			this.picker.find('.prev i, .next i')
						.toggleClass('fa fa-chevron-left fa-chevron-right').toggleClass('fa-chevron-left fa-chevron-right');
		}
		$(document).on('mousedown', function (e) {
			// Clicked outside the datepicker, hide it
			if ($(e.target).closest('.datepicker.datepicker-inline, .datepicker.datepicker-dropdown').length === 0) {
				that.hide();
			}
		});

		this.autoclose = true;
		if ('autoclose' in options) {
			this.autoclose = options.autoclose;
		} else if ('dateAutoclose' in this.element.data()) {
			this.autoclose = this.element.data('date-autoclose');
		}

		this.keyboardNavigation = true;
		if ('keyboardNavigation' in options) {
			this.keyboardNavigation = options.keyboardNavigation;
		} else if ('dateKeyboardNavigation' in this.element.data()) {
			this.keyboardNavigation = this.element.data('date-keyboard-navigation');
		}

		this.viewMode = this.startViewMode = 0;
		switch(options.startView || this.element.data('date-start-view')){
			case 2:
			case 'decade':
				this.viewMode = this.startViewMode = 2;
				break;
			case 1:
			case 'year':
				this.viewMode = this.startViewMode = 1;
				break;
		}

		this.todayBtn = (options.todayBtn||this.element.data('date-today-btn')||false);
		this.todayHighlight = (options.todayHighlight||this.element.data('date-today-highlight')||false);

		this.calendarWeeks = false;
		if ('calendarWeeks' in options) {
			this.calendarWeeks = options.calendarWeeks;
		} else if ('dateCalendarWeeks' in this.element.data()) {
			this.calendarWeeks = this.element.data('date-calendar-weeks');
		}
		if (this.calendarWeeks)
			this.picker.find('tfoot th.today')
						.attr('colspan', function(i, val){
							return parseInt(val) + 1;
						});

		this.weekStart = ((options.weekStart||this.element.data('date-weekstart')||dates[this.language].weekStart||0) % 7);
		this.weekEnd = ((this.weekStart + 6) % 7);
		this.startDate = -Infinity;
		this.endDate = Infinity;
		this.daysOfWeekDisabled = [];
		this.setStartDate(options.startDate||this.element.data('date-startdate'));
		this.setEndDate(options.endDate||this.element.data('date-enddate'));
		this.setDaysOfWeekDisabled(options.daysOfWeekDisabled||this.element.data('date-days-of-week-disabled'));

		this.fillDow();
		this.fillMonths();
		this.update();
		this.showMode();

		if(this.isInline) {
			this.show();
		}
	};

	Datepicker.prototype = {
		constructor: Datepicker,

		_events: [],
		_attachEvents: function(){
			this._detachEvents();
			if (this.isInput) { // single input
				this._events = [
					[this.element, {
						focus: $.proxy(this.show, this),
						keyup: $.proxy(this.update, this),
						keydown: $.proxy(this.keydown, this)
					}]
				];
			}
			else if (this.component && this.hasInput){ // component: input + button
				this._events = [
					// For components that are not readonly, allow keyboard nav
					[this.element.find('input'), {
						focus: $.proxy(this.show, this),
						keyup: $.proxy(this.update, this),
						keydown: $.proxy(this.keydown, this)
					}],
					[this.component, {
						click: $.proxy(this.show, this)
					}]
				];
			}
						else if (this.element.is('div')) {  // inline datepicker
							this.isInline = true;
						}
			else {
				this._events = [
					[this.element, {
						click: $.proxy(this.show, this)
					}]
				];
			}
			for (var i=0, el, ev; i<this._events.length; i++){
				el = this._events[i][0];
				ev = this._events[i][1];
				el.on(ev);
			}
		},
		_detachEvents: function(){
			for (var i=0, el, ev; i<this._events.length; i++){
				el = this._events[i][0];
				ev = this._events[i][1];
				el.off(ev);
			}
			this._events = [];
		},

		show: function(e) {
			this.picker.show();
			this.height = this.component ? this.component.outerHeight() : this.element.outerHeight();
			this.update();
			this.place();
			$(window).on('resize', $.proxy(this.place, this));
			if (e ) {
				e.stopPropagation();
				e.preventDefault();
			}
			this.element.trigger({
				type: 'show',
				date: this.date
			});
		},

		hide: function(e){
			if(this.isInline) return;
			if (!this.picker.is(':visible')) return;
			this.picker.hide();
			$(window).off('resize', this.place);
			this.viewMode = this.startViewMode;
			this.showMode();
			if (!this.isInput) {
				$(document).off('mousedown', this.hide);
			}

			if (
				this.forceParse &&
				(
					this.isInput && this.element.val() ||
					this.hasInput && this.element.find('input').val()
				)
			)
				this.setValue();
			this.element.trigger({
				type: 'hide',
				date: this.date
			});
		},

		remove: function() {
			this._detachEvents();
			this.picker.remove();
			delete this.element.data().datepicker;
		},

		getDate: function() {
			var d = this.getUTCDate();
			return new Date(d.getTime() + (d.getTimezoneOffset()*60000));
		},

		getUTCDate: function() {
			return this.date;
		},

		setDate: function(d) {
			this.setUTCDate(new Date(d.getTime() - (d.getTimezoneOffset()*60000)));
		},

		setUTCDate: function(d) {
			this.date = d;
			this.setValue();
		},

		setValue: function() {
			var formatted = this.getFormattedDate();
			if (!this.isInput) {
				if (this.component){
					this.element.find('input').val(formatted);
				}
				this.element.data('date', formatted);
			} else {
				this.element.val(formatted);
			}
		},

		getFormattedDate: function(format) {
			if (format === undefined)
				format = this.format;
			return DPGlobal.formatDate(this.date, format, this.language);
		},

		setStartDate: function(startDate){
			this.startDate = startDate||-Infinity;
			if (this.startDate !== -Infinity) {
				this.startDate = DPGlobal.parseDate(this.startDate, this.format, this.language);
			}
			this.update();
			this.updateNavArrows();
		},

		setEndDate: function(endDate){
			this.endDate = endDate||Infinity;
			if (this.endDate !== Infinity) {
				this.endDate = DPGlobal.parseDate(this.endDate, this.format, this.language);
			}
			this.update();
			this.updateNavArrows();
		},

		setDaysOfWeekDisabled: function(daysOfWeekDisabled){
			this.daysOfWeekDisabled = daysOfWeekDisabled||[];
			if (!$.isArray(this.daysOfWeekDisabled)) {
				this.daysOfWeekDisabled = this.daysOfWeekDisabled.split(/,\s*/);
			}
			this.daysOfWeekDisabled = $.map(this.daysOfWeekDisabled, function (d) {
				return parseInt(d, 10);
			});
			this.update();
			this.updateNavArrows();
		},

		place: function(){
		        if(this.isInline) return;
		  var zIndex = parseInt(this.element.parents().filter(function() {
		          return $(this).css('z-index') != 'auto';
		        }).first().css('z-index'))+10;
		  var textbox = this.component ? this.component : this.element;
		  var offset = textbox.offset();
		  var height = textbox.outerHeight() + parseInt(textbox.css('margin-top'));
		  var width = textbox.outerWidth() + parseInt(textbox.css('margin-left'));
		  var fullOffsetTop = offset.top + height;
		  var offsetLeft = offset.left;
		  // if the datepicker is going to be below the window, show it on top of the input
		  if((fullOffsetTop + this.picker.height()) >= $(window).scrollTop() + $(window).height()){
		  	fullOffsetTop = offset.top - height - this.picker.height();
		  }

		  // if the datepicker is going to go past the right side of the window, we want
		  // to set the right position so the datepicker lines up with the textbox
		  if(offset.left + this.picker.width() >= $(window).width()){
		  	offsetLeft = (offset.left + width)  - this.picker.width();
		  }
		  this.picker.css({
		    top: fullOffsetTop,
		    left: offsetLeft,
		    zIndex: zIndex
		  });
		},

		update: function(){
			var date, fromArgs = false;
			if(arguments && arguments.length && (typeof arguments[0] === 'string' || arguments[0] instanceof Date)) {
				date = arguments[0];
				fromArgs = true;
			} else {
				date = this.isInput ? this.element.val() : this.element.data('date') || this.element.find('input').val();
			}

			this.date = DPGlobal.parseDate(date, this.format, this.language);

			if(fromArgs) this.setValue();

			if (this.date < this.startDate) {
				this.viewDate = new Date(this.startDate.valueOf());
			} else if (this.date > this.endDate) {
				this.viewDate = new Date(this.endDate.valueOf());
			} else {
				this.viewDate = new Date(this.date.valueOf());
			}
			this.fill();
		},

		fillDow: function(){
			var dowCnt = this.weekStart,
			html = '<tr>';
			if(this.calendarWeeks){
				var cell = '<th class="cw">&nbsp;</th>';
				html += cell;
				this.picker.find('.datepicker-days thead tr:first-child').prepend(cell);
			}
			while (dowCnt < this.weekStart + 7) {
				html += '<th class="dow">'+dates[this.language].daysMin[(dowCnt++)%7]+'</th>';
			}
			html += '</tr>';
			this.picker.find('.datepicker-days thead').append(html);
		},

		fillMonths: function(){
			var html = '',
			i = 0;
			while (i < 12) {
				html += '<span class="month">'+dates[this.language].monthsShort[i++]+'</span>';
			}
			this.picker.find('.datepicker-months td').html(html);
		},

		fill: function() {
			var d = new Date(this.viewDate.valueOf()),
				year = d.getUTCFullYear(),
				month = d.getUTCMonth(),
				startYear = this.startDate !== -Infinity ? this.startDate.getUTCFullYear() : -Infinity,
				startMonth = this.startDate !== -Infinity ? this.startDate.getUTCMonth() : -Infinity,
				endYear = this.endDate !== Infinity ? this.endDate.getUTCFullYear() : Infinity,
				endMonth = this.endDate !== Infinity ? this.endDate.getUTCMonth() : Infinity,
				currentDate = this.date && this.date.valueOf(),
				today = new Date();
			this.picker.find('.datepicker-days thead th.date-switch')
						.text(dates[this.language].months[month]+' '+year);
			this.picker.find('tfoot th.today')
						.text(dates[this.language].today)
						.toggle(this.todayBtn !== false);
			this.updateNavArrows();
			this.fillMonths();
			var prevMonth = UTCDate(year, month-1, 28,0,0,0,0),
				day = DPGlobal.getDaysInMonth(prevMonth.getUTCFullYear(), prevMonth.getUTCMonth());
			prevMonth.setUTCDate(day);
			prevMonth.setUTCDate(day - (prevMonth.getUTCDay() - this.weekStart + 7)%7);
			var nextMonth = new Date(prevMonth.valueOf());
			nextMonth.setUTCDate(nextMonth.getUTCDate() + 42);
			nextMonth = nextMonth.valueOf();
			var html = [];
			var clsName;
			while(prevMonth.valueOf() < nextMonth) {
				if (prevMonth.getUTCDay() == this.weekStart) {
					html.push('<tr>');
					if(this.calendarWeeks){
						// adapted from https://github.com/timrwood/moment/blob/master/moment.js#L128
						var a = new Date(prevMonth.getUTCFullYear(), prevMonth.getUTCMonth(), prevMonth.getUTCDate() - prevMonth.getDay() + 10 - (this.weekStart && this.weekStart%7 < 5 && 7)),
							b = new Date(a.getFullYear(), 0, 4),
							calWeek =  ~~((a - b) / 864e5 / 7 + 1.5);
						html.push('<td class="cw">'+ calWeek +'</td>');
					}
				}
				clsName = ' '+this.onRender(prevMonth)+' ';
				if (prevMonth.getUTCFullYear() < year || (prevMonth.getUTCFullYear() == year && prevMonth.getUTCMonth() < month)) {
					clsName += ' old';
				} else if (prevMonth.getUTCFullYear() > year || (prevMonth.getUTCFullYear() == year && prevMonth.getUTCMonth() > month)) {
					clsName += ' new';
				}
				// Compare internal UTC date with local today, not UTC today
				if (this.todayHighlight &&
					prevMonth.getUTCFullYear() == today.getFullYear() &&
					prevMonth.getUTCMonth() == today.getMonth() &&
					prevMonth.getUTCDate() == today.getDate()) {
					clsName += ' today';
				}
				if (currentDate && prevMonth.valueOf() == currentDate) {
					clsName += ' active';
				}
				if (prevMonth.valueOf() < this.startDate || prevMonth.valueOf() > this.endDate ||
					$.inArray(prevMonth.getUTCDay(), this.daysOfWeekDisabled) !== -1) {
					clsName += ' disabled';
				}
				html.push('<td class="day'+clsName+'">'+prevMonth.getUTCDate() + '</td>');
				if (prevMonth.getUTCDay() == this.weekEnd) {
					html.push('</tr>');
				}
				prevMonth.setUTCDate(prevMonth.getUTCDate()+1);
			}
			this.picker.find('.datepicker-days tbody').empty().append(html.join(''));
			var currentYear = this.date && this.date.getUTCFullYear();

			var months = this.picker.find('.datepicker-months')
						.find('th:eq(1)')
							.text(year)
							.end()
						.find('span').removeClass('active');
			if (currentYear && currentYear == year) {
				months.eq(this.date.getUTCMonth()).addClass('active');
			}
			if (year < startYear || year > endYear) {
				months.addClass('disabled');
			}
			if (year == startYear) {
				months.slice(0, startMonth).addClass('disabled');
			}
			if (year == endYear) {
				months.slice(endMonth+1).addClass('disabled');
			}

			html = '';
			year = parseInt(year/10, 10) * 10;
			var yearCont = this.picker.find('.datepicker-years')
								.find('th:eq(1)')
									.text(year + '-' + (year + 9))
									.end()
								.find('td');
			year -= 1;
			for (var i = -1; i < 11; i++) {
				html += '<span class="year'+(i == -1 || i == 10 ? ' old' : '')+(currentYear == year ? ' active' : '')+(year < startYear || year > endYear ? ' disabled' : '')+'">'+year+'</span>';
				year += 1;
			}
			yearCont.html(html);
		},

		updateNavArrows: function() {
			var d = new Date(this.viewDate.valueOf()),
				year = d.getUTCFullYear(),
				month = d.getUTCMonth();
			switch (this.viewMode) {
				case 0:
					if (this.startDate !== -Infinity && year <= this.startDate.getUTCFullYear() && month <= this.startDate.getUTCMonth()) {
						this.picker.find('.prev').css({visibility: 'hidden'});
					} else {
						this.picker.find('.prev').css({visibility: 'visible'});
					}
					if (this.endDate !== Infinity && year >= this.endDate.getUTCFullYear() && month >= this.endDate.getUTCMonth()) {
						this.picker.find('.next').css({visibility: 'hidden'});
					} else {
						this.picker.find('.next').css({visibility: 'visible'});
					}
					break;
				case 1:
				case 2:
					if (this.startDate !== -Infinity && year <= this.startDate.getUTCFullYear()) {
						this.picker.find('.prev').css({visibility: 'hidden'});
					} else {
						this.picker.find('.prev').css({visibility: 'visible'});
					}
					if (this.endDate !== Infinity && year >= this.endDate.getUTCFullYear()) {
						this.picker.find('.next').css({visibility: 'hidden'});
					} else {
						this.picker.find('.next').css({visibility: 'visible'});
					}
					break;
			}
		},

		click: function(e) {
			e.stopPropagation();
			e.preventDefault();

			if ($(e.target).hasClass('datepicker-close') || $(e.target).parent().hasClass('datepicker-close')){
				this.hide();
			}

			var target = $(e.target).closest('span, td, th');
			if (target.length == 1) {
				switch(target[0].nodeName.toLowerCase()) {
					case 'th':
						switch(target[0].className) {
							case 'date-switch':
								this.showMode(1);
								break;
							case 'prev':
							case 'next':
								var dir = DPGlobal.modes[this.viewMode].navStep * (target[0].className == 'prev' ? -1 : 1);
								switch(this.viewMode){
									case 0:
										this.viewDate = this.moveMonth(this.viewDate, dir);
										break;
									case 1:
									case 2:
										this.viewDate = this.moveYear(this.viewDate, dir);
										break;
								}
								this.fill();
								break;
							case 'today':
								var date = new Date();
								date = UTCDate(date.getFullYear(), date.getMonth(), date.getDate(), 0, 0, 0);

								this.showMode(-2);
								var which = this.todayBtn == 'linked' ? null : 'view';
								this._setDate(date, which);
								break;
						}
						break;
					case 'span':
						if (!target.is('.disabled')) {
							this.viewDate.setUTCDate(1);
							if (target.is('.month')) {
								var month = target.parent().find('span').index(target);
								this.viewDate.setUTCMonth(month);
								this.element.trigger({
									type: 'changeMonth',
									date: this.viewDate
								});
							} else {
								var year = parseInt(target.text(), 10)||0;
								this.viewDate.setUTCFullYear(year);
								this.element.trigger({
									type: 'changeYear',
									date: this.viewDate
								});
							}
							this.showMode(-1);
							this.fill();
						}
						break;
					case 'td':
						if (target.is('.day') && !target.is('.disabled')){
							var day = parseInt(target.text(), 10)||1;
							var year = this.viewDate.getUTCFullYear(),
								month = this.viewDate.getUTCMonth();
							if (target.is('.old')) {
								if (month === 0) {
									month = 11;
									year -= 1;
								} else {
									month -= 1;
								}
							} else if (target.is('.new')) {
								if (month == 11) {
									month = 0;
									year += 1;
								} else {
									month += 1;
								}
							}
							this._setDate(UTCDate(year, month, day,0,0,0,0));
						}
						break;
				}
			}
		},

		_setDate: function(date, which){
			if (!which || which == 'date')
				this.date = date;
			if (!which || which  == 'view')
				this.viewDate = date;
			this.fill();
			this.setValue();
			this.element.trigger({
				type: 'changeDate',
				date: this.date
			});
			var element;
			if (this.isInput) {
				element = this.element;
			} else if (this.component){
				element = this.element.find('input');
			}
			if (element) {
				element.change();
				if (this.autoclose && (!which || which == 'date')) {
					this.hide();
				}
			}
		},

		moveMonth: function(date, dir){
			if (!dir) return date;
			var new_date = new Date(date.valueOf()),
				day = new_date.getUTCDate(),
				month = new_date.getUTCMonth(),
				mag = Math.abs(dir),
				new_month, test;
			dir = dir > 0 ? 1 : -1;
			if (mag == 1){
				test = dir == -1
					// If going back one month, make sure month is not current month
					// (eg, Mar 31 -> Feb 31 == Feb 28, not Mar 02)
					? function(){ return new_date.getUTCMonth() == month; }
					// If going forward one month, make sure month is as expected
					// (eg, Jan 31 -> Feb 31 == Feb 28, not Mar 02)
					: function(){ return new_date.getUTCMonth() != new_month; };
				new_month = month + dir;
				new_date.setUTCMonth(new_month);
				// Dec -> Jan (12) or Jan -> Dec (-1) -- limit expected date to 0-11
				if (new_month < 0 || new_month > 11)
					new_month = (new_month + 12) % 12;
			} else {
				// For magnitudes >1, move one month at a time...
				for (var i=0; i<mag; i++)
					// ...which might decrease the day (eg, Jan 31 to Feb 28, etc)...
					new_date = this.moveMonth(new_date, dir);
				// ...then reset the day, keeping it in the new month
				new_month = new_date.getUTCMonth();
				new_date.setUTCDate(day);
				test = function(){ return new_month != new_date.getUTCMonth(); };
			}
			// Common date-resetting loop -- if date is beyond end of month, make it
			// end of month
			while (test()){
				new_date.setUTCDate(--day);
				new_date.setUTCMonth(new_month);
			}
			return new_date;
		},

		moveYear: function(date, dir){
			return this.moveMonth(date, dir*12);
		},

		dateWithinRange: function(date){
			return date >= this.startDate && date <= this.endDate;
		},

		keydown: function(e){
			if (this.picker.is(':not(:visible)')){
				if (e.keyCode == 27) // allow escape to hide and re-show picker
					this.show();
				return;
			}
			var dateChanged = false,
				dir, day, month,
				newDate, newViewDate;
			switch(e.keyCode){
				case 27: // escape
					this.hide();
					e.preventDefault();
					break;
				case 37: // left
				case 39: // right
					if (!this.keyboardNavigation) break;
					dir = e.keyCode == 37 ? -1 : 1;
					if (e.ctrlKey){
						newDate = this.moveYear(this.date, dir);
						newViewDate = this.moveYear(this.viewDate, dir);
					} else if (e.shiftKey){
						newDate = this.moveMonth(this.date, dir);
						newViewDate = this.moveMonth(this.viewDate, dir);
					} else {
						newDate = new Date(this.date.valueOf());
						newDate.setUTCDate(this.date.getUTCDate() + dir);
						newViewDate = new Date(this.viewDate.valueOf());
						newViewDate.setUTCDate(this.viewDate.getUTCDate() + dir);
					}
					if (this.dateWithinRange(newDate)){
						this.date = newDate;
						this.viewDate = newViewDate;
						this.setValue();
						this.update();
						e.preventDefault();
						dateChanged = true;
					}
					break;
				case 38: // up
				case 40: // down
					if (!this.keyboardNavigation) break;
					dir = e.keyCode == 38 ? -1 : 1;
					if (e.ctrlKey){
						newDate = this.moveYear(this.date, dir);
						newViewDate = this.moveYear(this.viewDate, dir);
					} else if (e.shiftKey){
						newDate = this.moveMonth(this.date, dir);
						newViewDate = this.moveMonth(this.viewDate, dir);
					} else {
						newDate = new Date(this.date.valueOf());
						newDate.setUTCDate(this.date.getUTCDate() + dir * 7);
						newViewDate = new Date(this.viewDate.valueOf());
						newViewDate.setUTCDate(this.viewDate.getUTCDate() + dir * 7);
					}
					if (this.dateWithinRange(newDate)){
						this.date = newDate;
						this.viewDate = newViewDate;
						this.setValue();
						this.update();
						e.preventDefault();
						dateChanged = true;
					}
					break;
				case 13: // enter
					this.hide();
					e.preventDefault();
					break;
				case 9: // tab
					this.hide();
					break;
			}
			if (dateChanged){
				this.element.trigger({
					type: 'changeDate',
					date: this.date
				});
				var element;
				if (this.isInput) {
					element = this.element;
				} else if (this.component){
					element = this.element.find('input');
				}
				if (element) {
					element.change();
				}
			}
		},

		showMode: function(dir) {
			if (dir) {
				this.viewMode = Math.max(0, Math.min(2, this.viewMode + dir));
			}
			/*
				vitalets: fixing bug of very special conditions:
				jquery 1.7.1 + webkit + show inline datepicker in bootstrap popover.
				Method show() does not set display css correctly and datepicker is not shown.
				Changed to .css('display', 'block') solve the problem.
				See https://github.com/vitalets/x-editable/issues/37

				In jquery 1.7.2+ everything works fine.
			*/
			//this.picker.find('>div').hide().filter('.datepicker-'+DPGlobal.modes[this.viewMode].clsName).show();
			this.picker.find('>div').hide().filter('.datepicker-'+DPGlobal.modes[this.viewMode].clsName).css('display', 'block');
			this.updateNavArrows();
		}
	};

	$.fn.fdatepicker = function ( option ) {
		var args = Array.apply(null, arguments);
		args.shift();
		return this.each(function () {
			var $this = $(this),
				data = $this.data('datepicker'),
				options = typeof option == 'object' && option;
			if (!data) {
				$this.data('datepicker', (data = new Datepicker(this, $.extend({}, $.fn.fdatepicker.defaults,options))));
			}
			if (typeof option == 'string' && typeof data[option] == 'function') {
				data[option].apply(data, args);
			}
		});
	};

    $.fn.fdatepicker.defaults = {
        onRender: function(date) {
            return '';
        }
    };
	$.fn.fdatepicker.Constructor = Datepicker;
	var dates = $.fn.fdatepicker.dates = {
		en: {
			days: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
			daysShort: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
			daysMin: ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa", "Su"],
			months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
			monthsShort: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
			today: "Today"
		},
		fr: {
			days: ["Dimanche", "Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi", "Dimanche"],
			daysShort: ["Dim", "Lun", "Mar", "Mer", "Jeu", "Ven", "Sam", "Dim"],
			daysMin: ["Di", "Li", "Ma", "Me", "Je", "Ve", "Sa", "Di"],
			months: ["Janvier", "Févirer", "Mars", "Avril", "Mai", "Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre"],
			monthsShort: ["Jan", "Fev", "Mar", "Avr", "Mai", "Jun", "Jul", "Aoû", "Sep", "Oct", "Nov", "Dec"],
			today: "Aujourd'hui"
		},
		pl: {
			days: ["Niedziela", "Poniedziałek", "Wtorek", "Środa", "Czwartek", "Piątek", "Sobota", "Niedziela"],
			daysShort: ["Nie", "Pon", "Wt", "Śr", "Czw", "Pt", "Sob", "Nie"],
			daysMin: ["Nd", "Po", "Wt", "Śr", "Czw", "Pt", "So", "Nd"],
			months: ["Styczeń", "Luty", "Marzec", "Kwiecień", "Maj", "Czerwiec", "Lipiec", "Sierpień", "Wrzesień", "Październik", "Listopad", "Grudzień"],
			monthsShort: ["Sty", "Lut", "Mar", "Kwi", "Maj", "Cze", "Lip", "Sie", "Wrz", "Paź", "Lit", "Gru"],
			today: "Dzisiaj"
		},
		es: {
			days: ["Domingo", "Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado", "Domingo"],
			daysShort: ["Dom", "Lun", "Mar", "Mie", "Jue", "Vie", "Sab", "Dom"],
			daysMin: ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sa", "Do"],
			months: ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Deciembre"],
			monthsShort: ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"],
			today: "Hoy"
		},
		pt: {
		    days: ["Domingo", "Segunda", "Terça", "Quarta", "Quinta", "Sexta", "Sábado", "Domingo"],
		    daysShort: ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb", "Dom"],
		    daysMin: ["Do", "Se", "Te", "Qu", "Qu", "Se", "Sá", "Do"],
		    months: ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"],
		    monthsShort: ["Jan", "Fev", "Mar", "Abr", "Mai", "Jun", "Jul", "Ago", "Set", "Out", "Nov", "Dez"],
		    today: "Hoje"
		},
		it: {
		    days: ["Domenica", "Lunedì", "Martedì", "Mercoledì", "Giovedì", "Venerdì", "Sabato", "Domenica"],
		    daysShort: ["Dom", "Lun", "Mar", "Mer", "Gio", "Veb", "Sab", "Dom"],
		    daysMin: ["Do", "Lu", "Ma", "Me", "Gi", "Ve", "Sa", "Do"],
		    months: ["Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno", "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre"],
		    monthsShort: ["Gen", "Feb", "Mar", "Apr", "Mag", "Giu", "Lug", "Ago", "Set", "Ott", "Nov", "Dic"],
		    today: "Oggi"
		},
		de: {
		    days: ["Sonntag", "Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag", "Sonntag"],
		    daysShort: ["So", "Mo", "Di", "Mi", "Do", "Fr", "Sa", "So"],
		    daysMin: ["So", "Mo", "Di", "Mi", "Do", "Fr", "Sa", "So"],
		    months: ["Januar", "Februar", "März", "April", "Mai", "Juni", "Juli", "August", "September", "Oktober", "November", "Dezember"],
		    monthsShort: ["Jan", "Feb", "Mär", "Apr", "Mai", "Jun", "Jul", "Aug", "Sep", "Okt", "Nov", "Dez"],
		    today: "Heute"
		},
		ro: {
		    days: ["Duminica", "Luni", "Marti", "Miercuri", "Joi", "Vineri", "Sambata", "Duminica"],
		    daysShort: ["Dum", "Lun", "Mar", "Mie", "Joi", "Vin", "Sam", "Dum"],
		    daysMin: ["Du", "Lu", "Ma", "Mi", "Jo", "Vi", "Sa", "Du"],
		    months: ["Ianuarie", "Februarie", "Martie", "Aprilie", "Mai", "Iunie", "Iulie", "August", "Septembrie", "Octombrie", "Noiembrie", "Decembrie"],
		    monthsShort: ["Ian", "Feb", "Mar", "Apr", "Mai", "Iun", "Iul", "Aug", "Sep", "Oct", "Noi", "Dec"],
		    today: "Astazi"
		},
		hu: {
		    days: ["Vasárnap", "Hétfő", "Kedd", "Szerda", "Csütörtök", "Péntek", "Szombat", "Vasárnap"],
		    daysShort: ["Vas", "Hét", "Kedd", "Sze", "Csü", "Pén", "Szo", "Vas"],
		    daysMin: ["Va", "Hé", "Ke", "Sz", "Cs", "Pé", "Sz", "Va"],
		    months: ["Január", "Február", "Március", "Április", "Május", "Június", "Július", "Augusztus", "Szeptember", "Október", "November", "December"],
		    monthsShort: ["Jan", "Feb", "Már", "Ápr", "Máj", "Jún", "Júl", "Aug", "Szep", "Okt", "Nov", "Dec"],
		    today: "Ma"
		},
		ru: {
			days: ["Воскресенье", "Понедельник", "Вторник", "Среда", "Четверг", "Пятница", "Суббота", "Воскресенье"],
			daysShort: ["Вск", "Пнд", "Втр", "Срд", "Чтв", "Птн", "Суб", "Вск"],
			daysMin: ["Вс", "Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"],
			months: ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"],
			monthsShort: ["Янв", "Фев", "Мар", "Апр", "Май", "Июн", "Июл", "Авг", "Сен", "Окт", "Ноя", "Дек"],
			today: "Сегодня",
		},
		cz: {
			days: ["Neděle", "Pondělí", "Úterý", "Středa", "Čtvrtek", "Pátek", "Sobota", "Neděle"],
			daysShort: ["Ne", "Po", "Út", "St", "Čt", "Pá", "So", "Ne"],
			daysMin: ["Ne", "Po", "Út", "St", "Čt", "Pá", "So", "Ne"],
			months: ["Leden", "Únor", "Březen", "Duben", "Květen", "Červen", "Červenec", "Srpen", "Září", "Říjen", "Listopad", "Prosinec"],
			monthsShort: ["Led", "Úno", "Bře", "Dub", "Kvě", "Čer", "Čnc", "Srp", "Zář", "Říj", "Lis", "Pro"],
			today: "Dnes"
		}
	};

	var DPGlobal = {
		modes: [
			{
				clsName: 'days',
				navFnc: 'Month',
				navStep: 1
			},
			{
				clsName: 'months',
				navFnc: 'FullYear',
				navStep: 1
			},
			{
				clsName: 'years',
				navFnc: 'FullYear',
				navStep: 10
		}],
		isLeapYear: function (year) {
			return (((year % 4 === 0) && (year % 100 !== 0)) || (year % 400 === 0));
		},
		getDaysInMonth: function (year, month) {
			return [31, (DPGlobal.isLeapYear(year) ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month];
		},
		validParts: /dd?|DD?|mm?|MM?|yy(?:yy)?/g,
		nonpunctuation: /[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,
		parseFormat: function(format){
			// IE treats \0 as a string end in inputs (truncating the value),
			// so it's a bad format delimiter, anyway
			var separators = format.replace(this.validParts, '\0').split('\0'),
				parts = format.match(this.validParts);
			if (!separators || !separators.length || !parts || parts.length === 0){
				throw new Error("Invalid date format.");
			}
			return {separators: separators, parts: parts};
		},
		parseDate: function(date, format, language) {
			if (date instanceof Date) return date;
			if (/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(date)) {
				var part_re = /([\-+]\d+)([dmwy])/,
					parts = date.match(/([\-+]\d+)([dmwy])/g),
					part, dir;
				date = new Date();
				for (var i=0; i<parts.length; i++) {
					part = part_re.exec(parts[i]);
					dir = parseInt(part[1]);
					switch(part[2]){
						case 'd':
							date.setUTCDate(date.getUTCDate() + dir);
							break;
						case 'm':
							date = Datepicker.prototype.moveMonth.call(Datepicker.prototype, date, dir);
							break;
						case 'w':
							date.setUTCDate(date.getUTCDate() + dir * 7);
							break;
						case 'y':
							date = Datepicker.prototype.moveYear.call(Datepicker.prototype, date, dir);
							break;
					}
				}
				return UTCDate(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), 0, 0, 0);
			}
			var parts = date && date.match(this.nonpunctuation) || [],
				date = new Date(),
				parsed = {},
				setters_order = ['yyyy', 'yy', 'M', 'MM', 'm', 'mm', 'd', 'dd'],
				setters_map = {
					yyyy: function(d,v){ return d.setUTCFullYear(v); },
					yy: function(d,v){ return d.setUTCFullYear(2000+v); },
					m: function(d,v){
						v -= 1;
						while (v<0) v += 12;
						v %= 12;
						d.setUTCMonth(v);
						while (d.getUTCMonth() != v)
							d.setUTCDate(d.getUTCDate()-1);
						return d;
					},
					d: function(d,v){ return d.setUTCDate(v); }
				},
				val, filtered, part;
			setters_map['M'] = setters_map['MM'] = setters_map['mm'] = setters_map['m'];
			setters_map['dd'] = setters_map['d'];
			date = UTCDate(date.getFullYear(), date.getMonth(), date.getDate(), 0, 0, 0);
			var fparts = format.parts.slice();
			// Remove noop parts
			if (parts.length != fparts.length) {
				fparts = $(fparts).filter(function(i,p){
					return $.inArray(p, setters_order) !== -1;
				}).toArray();
			}
			// Process remainder
			if (parts.length == fparts.length) {
				for (var i=0, cnt = fparts.length; i < cnt; i++) {
					val = parseInt(parts[i], 10);
					part = fparts[i];
					if (isNaN(val)) {
						switch(part) {
							case 'MM':
								filtered = $(dates[language].months).filter(function(){
									var m = this.slice(0, parts[i].length),
										p = parts[i].slice(0, m.length);
									return m == p;
								});
								val = $.inArray(filtered[0], dates[language].months) + 1;
								break;
							case 'M':
								filtered = $(dates[language].monthsShort).filter(function(){
									var m = this.slice(0, parts[i].length),
										p = parts[i].slice(0, m.length);
									return m == p;
								});
								val = $.inArray(filtered[0], dates[language].monthsShort) + 1;
								break;
						}
					}
					parsed[part] = val;
				}
				for (var i=0, s; i<setters_order.length; i++){
					s = setters_order[i];
					if (s in parsed && !isNaN(parsed[s]))
						setters_map[s](date, parsed[s]);
				}
			}
			return date;
		},
		formatDate: function(date, format, language){
			var val = {
				d: date.getUTCDate(),
				D: dates[language].daysShort[date.getUTCDay()],
				DD: dates[language].days[date.getUTCDay()],
				m: date.getUTCMonth() + 1,
				M: dates[language].monthsShort[date.getUTCMonth()],
				MM: dates[language].months[date.getUTCMonth()],
				yy: date.getUTCFullYear().toString().substring(2),
				yyyy: date.getUTCFullYear()
			};
			val.dd = (val.d < 10 ? '0' : '') + val.d;
			val.mm = (val.m < 10 ? '0' : '') + val.m;
			var date = [],
				seps = $.extend([], format.separators);
			for (var i=0, cnt = format.parts.length; i < cnt; i++) {
				if (seps.length)
					date.push(seps.shift());
				date.push(val[format.parts[i]]);
			}
			return date.join('');
		},
		headTemplate: '<thead>'+
							'<tr>'+
								'<th class="prev"><i class="fa fa-chevron-left fi-arrow-left"/></th>'+
								'<th colspan="5" class="date-switch"></th>'+
								'<th class="next"><i class="fa fa-chevron-right fi-arrow-right"/></th>'+
							'</tr>'+
						'</thead>',
		contTemplate: '<tbody><tr><td colspan="7"></td></tr></tbody>',
		footTemplate: '<tfoot><tr><th colspan="7" class="today"></th></tr></tfoot>'
	};
	DPGlobal.template = '<div class="datepicker">'+

							'<div class="datepicker-days">'+
								'<table class=" table-condensed">'+
									DPGlobal.headTemplate+
									'<tbody></tbody>'+
									DPGlobal.footTemplate+
								'</table>'+
							'</div>'+
							'<div class="datepicker-months">'+
								'<table class="table-condensed">'+
									DPGlobal.headTemplate+
									DPGlobal.contTemplate+
									DPGlobal.footTemplate+
								'</table>'+
							'</div>'+
							'<div class="datepicker-years">'+
								'<table class="table-condensed">'+
									DPGlobal.headTemplate+
									DPGlobal.contTemplate+
									DPGlobal.footTemplate+
								'</table>'+
							'</div>'+
							'<a class="button datepicker-close small alert right" style="width:auto;"><i class="fa fa-remove fa-times fi-x"></i></a>'+
						'</div>';

	$.fn.fdatepicker.DPGlobal = DPGlobal;

}( window.jQuery );

/*! jQuery responsive breadcrumbs plugin - v1.1.0 | https://github.com/cm0s/jquery-rcrumbs | (c) 2014 Nicolas Forney | License MIT */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.$element=a(b),this.options=a.extend(!0,{},g,c),this._defaults=g,this._name=f,e.prototype.plugin=this,this._init()}var f="rcrumbs",g={version:"@@version",callback:{preCrumbsListDisplay:a.noop,preCrumbDisplay:a.noop,postCrumbsListDisplay:a.noop,postCrumbDisplay:a.noop},ellipsis:!0,windowResize:!0,nbUncollapsableCrumbs:2,nbFixedCrumbs:0,animation:{activated:!0,speed:400}};e.prototype={version:function(){return this.options.version},_init:function(){if(this.$element.hasClass("rcrumbs")||this.$element.addClass("rcrumbs"),this.nbCrumbDisplayed=0,this.$crumbsList=a("ul",this.element),this.$crumbs=a("li",this.$crumbsList),this.$lastCrumb=this.$crumbs.last(),this.reversedCrumbs=a("li",this.$crumbsList).get().reverse(),this.lastNbCrumbDisplayed=0,this.totalCrumbsWidth=0,this.fixedCrumbsWidth=0,this._initCrumbs(),this.options.nbFixedCrumbs>0){var b=this.$crumbs.length;this.$crumbs=a("li",this.$crumbsList).slice(this.options.nbFixedCrumbs,b),this.reversedCrumbs=a("li",this.$crumbsList).slice(this.options.nbFixedCrumbs,b).get().reverse();var c=this;a("li",this.$crumbsList).slice(0,this.options.nbFixedCrumbs).each(function(b,d){c.totalCrumbsWidth+=a(d).data("width"),a(d).addClass("show")})}this._showOrHideCrumbsList(!0),this.options.windowResize&&this._showOrHideCrumbsListOnWindowResize()},_getHiddenElWidth:function(b){var c,d=a(b).clone(!1);return d.css({visibility:"hidden",position:"absolute"}),d.appendTo(this.$crumbsList),c=d.width(),d.remove(),c},_initCrumbs:function(){var b=this;a(this.$crumbsList).contents().filter(function(){return 3===this.nodeType}).remove(),a.each(this.$crumbs,function(){var c=a(this);b._storeCrumbWidth(c)}),this.options.nbFixedCrumbs>0&&a(this.$crumbs).slice(0,this.options.nbFixedCrumbs).each(function(c,d){b.fixedCrumbsWidth+=a(d).data("width")})},_storeCrumbWidth:function(a){var b=this._getHiddenElWidth(a);return a.data("width",b),b},_showOrHideCrumbsList:function(b){var c=this;this.remainingSpaceToDisplayCrumbs=this.$element.width(),this.nbCrumbDisplayed=0,this.totalCrumbsWidth=0,this.options.nbFixedCrumbs>0&&(this.remainingSpaceToDisplayCrumbs-=this.fixedCrumbsWidth,a("li",this.$crumbsList).slice(0,this.options.nbFixedCrumbs).each(function(b,d){c.totalCrumbsWidth+=a(d).data("width")})),this.nextCrumbToShowWidth=d,this.options.callback.preCrumbsListDisplay(this),a.each(this.reversedCrumbs,function(d){var e=a(this),f=a(c.reversedCrumbs[d+1]);c._showOrHideCrumb(e,f,d,b)}),this.lastNbCrumbDisplayed=this.nbCrumbDisplayed,this.options.callback.postCrumbsListDisplay(this)},_showOrHideCrumb:function(a,b,c,d){function e(){a.addClass("show"),h.lastNbCrumbDisplayed<h.nbCrumbDisplayed+1&&h.options.animation.activated&&!d?(a.width(0),a.animate({width:a.data("width")},h.options.animation.speed,function(){h.options.callback.postCrumbDisplay(a)})):h.options.callback.postCrumbDisplay(a),h.nbCrumbDisplayed+=1}function f(){a.animate({width:0},h.options.animation.speed,function(){a.removeClass("show")})}function g(a){a.css({width:h.remainingSpaceToDisplayCrumbs+a.data("width")+"px"}),a.addClass("ellipsis")}this.options.callback.preCrumbDisplay(a);var h=this;this.remainingSpaceToDisplayCrumbs-=a.data("width"),c<this.options.nbUncollapsableCrumbs?(e(),this.remainingSpaceToDisplayCrumbs<0&&g(this.$lastCrumb),this.totalCrumbsWidth+=a.data("width")):this.remainingSpaceToDisplayCrumbs>=0?(e(),this.totalCrumbsWidth+=a.data("width")):(this.lastNbCrumbDisplayed>this.nbCrumbDisplayed-1&&this.options.animation.activated?f():a.removeClass("show"),this.nextCrumbToShowWidth||(this.nextCrumbToShowWidth=a.data("width")))},_showOrHideCrumbsListOnWindowResize:function(){var c=this;a(b).resize(function(){var b=c.$element.width();(b<c.totalCrumbsWidth||c.totalCrumbsWidth+c.nextCrumbToShowWidth<b)&&(a.each(c.reversedCrumbs,function(){var b=a(this);b.stop(!0,!0)}),c._showOrHideCrumbsList()),b>=c.totalCrumbsWidth&&c.$lastCrumb.hasClass("ellipsis")&&c._disableEllipsis(c.$lastCrumb)})},_disableEllipsis:function(a){a.css({width:"auto"}),a.removeClass("ellipsis")}},a.fn[f]=function(b){if(e.prototype[b]&&-1===b.indexOf("_")){var c=a.data(this[0],"plugin_"+f);if(c)return e.prototype[b].apply(c,Array.prototype.slice.call(arguments,1));a.error("jquery."+f+" plugin must be initialized first on the element")}else{if("object"==typeof b||!b)return this.each(function(){a.data(this,"plugin_"+f)?a.error("jquery."+f+" plugin cannot be instantiated multiple times on same element"):a.data(this,"plugin_"+f,new e(this,b))});a.error("Method "+b+" does not exist on jquery."+f)}}}(jQuery,window,document);
/**
 * @license
 * Video.js 5.20.4 <http://videojs.com/>
 * Copyright Brightcove, Inc. <https://www.brightcove.com/>
 * Available under Apache License Version 2.0
 * <https://github.com/videojs/video.js/blob/master/LICENSE>
 *
 * Includes vtt.js <https://github.com/mozilla/vtt.js>
 * Available under Apache License Version 2.0
 * <https://github.com/mozilla/vtt.js/blob/master/LICENSE>
 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.videojs=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c||b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(2),i=d(h),j=a(5),k=d(j),l=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.mouseused_=!1,g.on("mousedown",g.handleMouseDown),g}return g(b,a),b.prototype.buildCSSClass=function(){return"vjs-big-play-button"},b.prototype.handleClick=function(a){var b=this.player_.play();if(!(this.mouseused_&&a.clientX&&a.clientY)){var c=this.player_.getChild("controlBar"),d=c&&c.getChild("playToggle");if(!d)return void this.player_.focus();var e=function(){return d.focus()};if(b&&b.then){var f=function(){};b.then(e,f)}else this.setTimeout(e,1)}},b.prototype.handleKeyPress=function(b){this.mouseused_=!1,a.prototype.handleKeyPress.call(this,b)},b.prototype.handleMouseDown=function(a){this.mouseused_=!0},b}(i["default"]);l.prototype.controlText_="Play Video",k["default"].registerComponent("BigPlayButton",l),c["default"]=l},{2:2,5:5}],2:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(3),i=d(h),j=a(5),k=d(j),l=a(86),m=d(l),n=a(88),o=function(a){function b(){return e(this,b),f(this,a.apply(this,arguments))}return g(b,a),b.prototype.createEl=function(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"button",b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};b=(0,n.assign)({className:this.buildCSSClass()},b),"button"!==a&&(m["default"].warn("Creating a Button with an HTML element of "+a+" is deprecated; use ClickableComponent instead."),b=(0,n.assign)({tabIndex:0},b),c=(0,n.assign)({role:"button"},c)),c=(0,n.assign)({type:"button","aria-live":"polite"},c);var d=k["default"].prototype.createEl.call(this,a,b,c);return this.createControlTextEl(d),d},b.prototype.addChild=function(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},c=this.constructor.name;return m["default"].warn("Adding an actionable (user controllable) child to a Button ("+c+") is not supported; use a ClickableComponent instead."),k["default"].prototype.addChild.call(this,a,b)},b.prototype.enable=function(){a.prototype.enable.call(this),this.el_.removeAttribute("disabled")},b.prototype.disable=function(){a.prototype.disable.call(this),this.el_.setAttribute("disabled","disabled")},b.prototype.handleKeyPress=function(b){32!==b.which&&13!==b.which&&a.prototype.handleKeyPress.call(this,b)},b}(i["default"]);k["default"].registerComponent("Button",o),c["default"]=o},{3:3,5:5,86:86,88:88}],3:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var i=a(5),j=e(i),k=a(81),l=d(k),m=a(82),n=d(m),o=a(83),p=d(o),q=a(86),r=e(q),s=a(96),t=e(s),u=a(88),v=function(a){function b(c,d){f(this,b);var e=g(this,a.call(this,c,d));return e.emitTapEvents(),e.enable(),e}return h(b,a),b.prototype.createEl=function(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"div",c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};c=(0,u.assign)({className:this.buildCSSClass(),tabIndex:0},c),"button"===b&&r["default"].error("Creating a ClickableComponent with an HTML element of "+b+" is not supported; use a Button instead."),d=(0,u.assign)({role:"button","aria-live":"polite"},d),this.tabIndex_=c.tabIndex;var e=a.prototype.createEl.call(this,b,c,d);return this.createControlTextEl(e),e},b.prototype.createControlTextEl=function(a){return this.controlTextEl_=l.createEl("span",{className:"vjs-control-text"}),a&&a.appendChild(this.controlTextEl_),this.controlText(this.controlText_,a),this.controlTextEl_},b.prototype.controlText=function(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.el();if(!a)return this.controlText_||"Need Text";var c=this.localize(a);return this.controlText_=a,this.controlTextEl_.innerHTML=c,this.nonIconControl||b.setAttribute("title",c),this},b.prototype.buildCSSClass=function(){return"vjs-control vjs-button "+a.prototype.buildCSSClass.call(this)},b.prototype.enable=function(){return this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),"undefined"!=typeof this.tabIndex_&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.off(["tap","click"],this.handleClick),this.off("focus",this.handleFocus),this.off("blur",this.handleBlur),this.on(["tap","click"],this.handleClick),this.on("focus",this.handleFocus),this.on("blur",this.handleBlur),this},b.prototype.disable=function(){return this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),"undefined"!=typeof this.tabIndex_&&this.el_.removeAttribute("tabIndex"),this.off(["tap","click"],this.handleClick),this.off("focus",this.handleFocus),this.off("blur",this.handleBlur),this},b.prototype.handleClick=function(a){},b.prototype.handleFocus=function(a){n.on(t["default"],"keydown",p.bind(this,this.handleKeyPress))},b.prototype.handleKeyPress=function(b){32===b.which||13===b.which?(b.preventDefault(),this.handleClick(b)):a.prototype.handleKeyPress&&a.prototype.handleKeyPress.call(this,b)},b.prototype.handleBlur=function(a){n.off(t["default"],"keydown",p.bind(this,this.handleKeyPress))},b}(j["default"]);j["default"].registerComponent("ClickableComponent",v),c["default"]=v},{5:5,81:81,82:82,83:83,86:86,88:88,96:96}],4:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(2),i=d(h),j=a(5),k=d(j),l=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.controlText(d&&d.controlText||g.localize("Close")),g}return g(b,a),b.prototype.buildCSSClass=function(){return"vjs-close-button "+a.prototype.buildCSSClass.call(this)},b.prototype.handleClick=function(a){this.trigger({type:"close",bubbles:!1})},b}(i["default"]);k["default"].registerComponent("CloseButton",l),c["default"]=l},{2:2,5:5}],5:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.__esModule=!0;var g=a(97),h=e(g),i=a(81),j=d(i),k=a(83),l=d(k),m=a(85),n=d(m),o=a(82),p=d(o),q=a(86),r=e(q),s=a(91),t=e(s),u=a(87),v=e(u),w=function(){function a(b,c,d){if(f(this,a),!b&&this.play?this.player_=b=this:this.player_=b,this.options_=(0,v["default"])({},this.options_),c=this.options_=(0,v["default"])(this.options_,c),this.id_=c.id||c.el&&c.el.id,!this.id_){var e=b&&b.id&&b.id()||"no_player";this.id_=e+"_component_"+n.newGUID()}this.name_=c.name||null,c.el?this.el_=c.el:!1!==c.createEl&&(this.el_=this.createEl()),this.children_=[],this.childIndex_={},this.childNameIndex_={},!1!==c.initChildren&&this.initChildren(),this.ready(d),!1!==c.reportTouchActivity&&this.enableTouchActivity()}return a.prototype.dispose=function(){if(this.trigger({type:"dispose",bubbles:!1}),this.children_)for(var a=this.children_.length-1;a>=0;a--)this.children_[a].dispose&&this.children_[a].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.off(),this.el_.parentNode&&this.el_.parentNode.removeChild(this.el_),j.removeElData(this.el_),this.el_=null},a.prototype.player=function(){return this.player_},a.prototype.options=function(a){return r["default"].warn("this.options() has been deprecated and will be moved to the constructor in 6.0"),a?(this.options_=(0,v["default"])(this.options_,a),this.options_):this.options_},a.prototype.el=function(){return this.el_},a.prototype.createEl=function(a,b,c){return j.createEl(a,b,c)},a.prototype.localize=function(a){var b=this.player_.language&&this.player_.language(),c=this.player_.languages&&this.player_.languages();if(!b||!c)return a;var d=c[b];if(d&&d[a])return d[a];var e=b.split("-")[0],f=c[e];return f&&f[a]?f[a]:a},a.prototype.contentEl=function(){return this.contentEl_||this.el_},a.prototype.id=function(){return this.id_},a.prototype.name=function(){return this.name_},a.prototype.children=function(){return this.children_},a.prototype.getChildById=function(a){return this.childIndex_[a]},a.prototype.getChild=function(a){if(a)return a=(0,t["default"])(a),this.childNameIndex_[a]},a.prototype.addChild=function(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this.children_.length,e=void 0,f=void 0;if("string"==typeof b){f=(0,t["default"])(b),c||(c={}),!0===c&&(r["default"].warn("Initializing a child component with `true` is deprecated.Children should be defined in an array when possible, but if necessary use an object instead of `true`."),c={});var g=c.componentClass||f;c.name=f;var h=a.getComponent(g);if(!h)throw new Error("Component "+g+" does not exist");if("function"!=typeof h)return null;e=new h(this.player_||this,c)}else e=b;if(this.children_.splice(d,0,e),"function"==typeof e.id&&(this.childIndex_[e.id()]=e),f=f||e.name&&(0,t["default"])(e.name()),f&&(this.childNameIndex_[f]=e),"function"==typeof e.el&&e.el()){var i=this.contentEl().children,j=i[d]||null;this.contentEl().insertBefore(e.el(),j)}return e},a.prototype.removeChild=function(a){if("string"==typeof a&&(a=this.getChild(a)),a&&this.children_){for(var b=!1,c=this.children_.length-1;c>=0;c--)if(this.children_[c]===a){b=!0,this.children_.splice(c,1);break}if(b){this.childIndex_[a.id()]=null,this.childNameIndex_[a.name()]=null;var d=a.el();d&&d.parentNode===this.contentEl()&&this.contentEl().removeChild(a.el())}}},a.prototype.initChildren=function(){var b=this,c=this.options_.children;if(c){var d=this.options_,e=function(a){var c=a.name,e=a.opts;if(d[c]!==undefined&&(e=d[c]),!1!==e){!0===e&&(e={}),e.playerOptions=b.options_.playerOptions;var f=b.addChild(c,e);f&&(b[c]=f)}},f=void 0,g=a.getComponent("Tech");f=Array.isArray(c)?c:Object.keys(c),f.concat(Object.keys(this.options_).filter(function(a){return!f.some(function(b){return"string"==typeof b?a===b:a===b.name})})).map(function(a){var d=void 0,e=void 0;return"string"==typeof a?(d=a,e=c[d]||b.options_[d]||{}):(d=a.name,e=a),{name:d,opts:e}}).filter(function(b){var c=a.getComponent(b.opts.componentClass||(0,t["default"])(b.name));return c&&!g.isTech(c)}).forEach(e)}},a.prototype.buildCSSClass=function(){return""},a.prototype.on=function(a,b,c){var d=this;if("string"==typeof a||Array.isArray(a))p.on(this.el_,a,l.bind(this,b));else{var e=a,f=b,g=l.bind(this,c),h=function(){return d.off(e,f,g)};h.guid=g.guid,this.on("dispose",h);var i=function(){return d.off("dispose",h)};i.guid=g.guid,a.nodeName?(p.on(e,f,g),p.on(e,"dispose",i)):"function"==typeof a.on&&(e.on(f,g),e.on("dispose",i))}return this},a.prototype.off=function(a,b,c){if(!a||"string"==typeof a||Array.isArray(a))p.off(this.el_,a,b);else{var d=a,e=b,f=l.bind(this,c);this.off("dispose",f),a.nodeName?(p.off(d,e,f),p.off(d,"dispose",f)):(d.off(e,f),d.off("dispose",f))}return this},a.prototype.one=function(a,b,c){var d=this,e=arguments;if("string"==typeof a||Array.isArray(a))p.one(this.el_,a,l.bind(this,b));else{var f=a,g=b,h=l.bind(this,c),i=function j(){d.off(f,g,j),h.apply(null,e)};i.guid=h.guid,this.on(f,g,i)}return this},a.prototype.trigger=function(a,b){return p.trigger(this.el_,a,b),this},a.prototype.ready=function(a){var b=arguments.length>1&&arguments[1]!==undefined&&arguments[1];return a&&(this.isReady_?b?a.call(this):this.setTimeout(a,1):(this.readyQueue_=this.readyQueue_||[],this.readyQueue_.push(a))),this},a.prototype.triggerReady=function(){this.isReady_=!0,this.setTimeout(function(){var a=this.readyQueue_;this.readyQueue_=[],a&&a.length>0&&a.forEach(function(a){a.call(this)},this),this.trigger("ready")},1)},a.prototype.$=function(a,b){return j.$(a,b||this.contentEl())},a.prototype.$$=function(a,b){return j.$$(a,b||this.contentEl())},a.prototype.hasClass=function(a){return j.hasElClass(this.el_,a)},a.prototype.addClass=function(a){return j.addElClass(this.el_,a),this},a.prototype.removeClass=function(a){return j.removeElClass(this.el_,a),this},a.prototype.toggleClass=function(a,b){return j.toggleElClass(this.el_,a,b),this},a.prototype.show=function(){return this.removeClass("vjs-hidden"),this},a.prototype.hide=function(){return this.addClass("vjs-hidden"),this},a.prototype.lockShowing=function(){return this.addClass("vjs-lock-showing"),this},a.prototype.unlockShowing=function(){return this.removeClass("vjs-lock-showing"),this},a.prototype.getAttribute=function(a){return j.getAttribute(this.el_,a)},a.prototype.setAttribute=function(a,b){return j.setAttribute(this.el_,a,b),this},a.prototype.removeAttribute=function(a){return j.removeAttribute(this.el_,a),this},a.prototype.width=function(a,b){return this.dimension("width",a,b)},a.prototype.height=function(a,b){return this.dimension("height",a,b)},a.prototype.dimensions=function(a,b){return this.width(a,!0).height(b)},a.prototype.dimension=function(a,b,c){if(b!==undefined)return null!==b&&b===b||(b=0),-1!==(""+b).indexOf("%")||-1!==(""+b).indexOf("px")?this.el_.style[a]=b:this.el_.style[a]="auto"===b?"":b+"px",c||this.trigger("resize"),this;if(!this.el_)return 0;var d=this.el_.style[a],e=d.indexOf("px");return-1!==e?parseInt(d.slice(0,e),10):parseInt(this.el_["offset"+(0,t["default"])(a)],10)},a.prototype.currentDimension=function(a){var b=0;if("width"!==a&&"height"!==a)throw new Error("currentDimension only accepts width or height value");if("function"==typeof h["default"].getComputedStyle){var c=h["default"].getComputedStyle(this.el_);b=c.getPropertyValue(a)||c[a]}if(0===(b=parseFloat(b))){var d="offset"+(0,t["default"])(a);b=this.el_[d]}return b},a.prototype.currentDimensions=function(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}},a.prototype.currentWidth=function(){return this.currentDimension("width")},a.prototype.currentHeight=function(){return this.currentDimension("height")},a.prototype.focus=function(){this.el_.focus()},a.prototype.blur=function(){this.el_.blur()},a.prototype.emitTapEvents=function(){var a=0,b=null,c=void 0;this.on("touchstart",function(d){1===d.touches.length&&(b={pageX:d.touches[0].pageX,pageY:d.touches[0].pageY},a=(new Date).getTime(),c=!0)}),this.on("touchmove",function(a){if(a.touches.length>1)c=!1;else if(b){var d=a.touches[0].pageX-b.pageX,e=a.touches[0].pageY-b.pageY,f=Math.sqrt(d*d+e*e);f>10&&(c=!1)}});var d=function(){c=!1};this.on("touchleave",d),this.on("touchcancel",d),this.on("touchend",function(d){if(b=null,!0===c){(new Date).getTime()-a<200&&(d.preventDefault(),this.trigger("tap"))}})},a.prototype.enableTouchActivity=function(){if(this.player()&&this.player().reportUserActivity){var a=l.bind(this.player(),this.player().reportUserActivity),b=void 0;this.on("touchstart",function(){a(),this.clearInterval(b),b=this.setInterval(a,250)});var c=function(c){a(),this.clearInterval(b)};this.on("touchmove",a),this.on("touchend",c),this.on("touchcancel",c)}},a.prototype.setTimeout=function(a,b){a=l.bind(this,a);var c=h["default"].setTimeout(a,b),d=function(){this.clearTimeout(c)};return d.guid="vjs-timeout-"+c,this.on("dispose",d),c},a.prototype.clearTimeout=function(a){h["default"].clearTimeout(a);var b=function(){};return b.guid="vjs-timeout-"+a,this.off("dispose",b),a},a.prototype.setInterval=function(a,b){a=l.bind(this,a);var c=h["default"].setInterval(a,b),d=function(){this.clearInterval(c)};return d.guid="vjs-interval-"+c,this.on("dispose",d),c},a.prototype.clearInterval=function(a){h["default"].clearInterval(a);var b=function(){};return b.guid="vjs-interval-"+a,this.off("dispose",b),a},a.registerComponent=function(b,c){if(b){if(b=(0,t["default"])(b),a.components_||(a.components_={}),"Player"===b&&a.components_[b]){var d=a.components_[b];if(d.players&&Object.keys(d.players).length>0&&Object.keys(d.players).map(function(a){return d.players[a]}).every(Boolean))throw new Error("Can not register Player component after player has been created")}return a.components_[b]=c,c}},a.getComponent=function(b){if(b)return b=(0,t["default"])(b),a.components_&&a.components_[b]?a.components_[b]:h["default"]&&h["default"].videojs&&h["default"].videojs[b]?(r["default"].warn("The "+b+" component was added to the videojs object when it should be registered using videojs.registerComponent(name, component)"),h["default"].videojs[b]):void 0},a.extend=function(b){b=b||{},r["default"].warn("Component.extend({}) has been deprecated,  use videojs.extend(Component, {}) instead");var c=b.init||b.init||this.prototype.init||this.prototype.init||function(){},d=function(){c.apply(this,arguments)};d.prototype=Object.create(this.prototype),d.prototype.constructor=d,d.extend=a.extend;for(var e in b)b.hasOwnProperty(e)&&(d.prototype[e]=b[e]);return d},a}();w.registerComponent("Component",w),c["default"]=w},{81:81,82:82,83:83,85:85,86:86,87:87,91:91,97:97}],6:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(36),i=d(h),j=a(5),k=d(j),l=a(7),m=d(l),n=function(a){function b(c){var d=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};e(this,b),d.tracks=c.audioTracks&&c.audioTracks();var g=f(this,a.call(this,c,d));return g.el_.setAttribute("aria-label","Audio Menu"),g}return g(b,a),b.prototype.buildCSSClass=function(){return"vjs-audio-button "+a.prototype.buildCSSClass.call(this)},b.prototype.createItems=function(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];this.hideThreshold_=1;var b=this.player_.audioTracks&&this.player_.audioTracks();if(!b)return a;for(var c=0;c<b.length;c++){var d=b[c];a.push(new m["default"](this.player_,{track:d,selectable:!0}))}return a},b}(i["default"]);n.prototype.controlText_="Audio Track",k["default"].registerComponent("AudioTrackButton",n),c["default"]=n},{36:36,5:5,7:7}],7:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(48),i=d(h),j=a(5),k=d(j),l=a(83),m=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(l),n=function(a){function b(c,d){e(this,b);var g=d.track,h=c.audioTracks();d.label=g.label||g.language||"Unknown",d.selected=g.enabled;var i=f(this,a.call(this,c,d));if(i.track=g,h){var j=m.bind(i,i.handleTracksChange);h.addEventListener("change",j),i.on("dispose",function(){h.removeEventListener("change",j)})}return i}return g(b,a),b.prototype.handleClick=function(b){var c=this.player_.audioTracks();if(a.prototype.handleClick.call(this,b),c)for(var d=0;d<c.length;d++){var e=c[d];e.enabled=e===this.track}},b.prototype.handleTracksChange=function(a){this.selected(this.track.enabled)},b}(i["default"]);k["default"].registerComponent("AudioTrackMenuItem",n),c["default"]=n},{48:48,5:5,83:83}],8:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var g=a(5),h=function(a){return a&&a.__esModule?a:{"default":a}}(g);a(12),a(32),a(33),a(35),a(34),a(10),a(18),a(9),a(38),a(40),a(11),a(25),a(27),a(29),a(24),a(6),a(13),a(21);var i=function(a){function b(){return d(this,b),e(this,a.apply(this,arguments))}return f(b,a),b.prototype.createEl=function(){return a.prototype.createEl.call(this,"div",{className:"vjs-control-bar",dir:"ltr"},{role:"group"})},b}(h["default"]);i.prototype.options_={children:["playToggle","volumeMenuButton","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subtitlesButton","captionsButton","audioTrackButton","fullscreenToggle"]},h["default"].registerComponent("ControlBar",i),c["default"]=i},{10:10,11:11,12:12,13:13,18:18,21:21,24:24,25:25,27:27,29:29,32:32,33:33,34:34,35:35,38:38,40:40,5:5,6:6,9:9}],9:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(2),i=d(h),j=a(5),k=d(j),l=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.on(c,"fullscreenchange",g.handleFullscreenChange),g}return g(b,a),b.prototype.buildCSSClass=function(){return"vjs-fullscreen-control "+a.prototype.buildCSSClass.call(this)},b.prototype.handleFullscreenChange=function(a){this.player_.isFullscreen()?this.controlText("Non-Fullscreen"):this.controlText("Fullscreen")},b.prototype.handleClick=function(a){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()},b}(i["default"]);l.prototype.controlText_="Fullscreen",k["default"].registerComponent("FullscreenToggle",l),c["default"]=l},{2:2,5:5}],10:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var g=a(5),h=function(a){return a&&a.__esModule?a:{"default":a}}(g),i=a(81),j=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(i),k=function(a){function b(c,f){d(this,b);var g=e(this,a.call(this,c,f));return g.updateShowing(),g.on(g.player(),"durationchange",g.updateShowing),g}return f(b,a),b.prototype.createEl=function(){var b=a.prototype.createEl.call(this,"div",{className:"vjs-live-control vjs-control"});return this.contentEl_=j.createEl("div",{className:"vjs-live-display",innerHTML:'<span class="vjs-control-text">'+this.localize("Stream Type")+"</span>"+this.localize("LIVE")},{"aria-live":"off"}),b.appendChild(this.contentEl_),b},b.prototype.updateShowing=function(a){this.player().duration()===Infinity?this.show():this.hide()},b}(h["default"]);h["default"].registerComponent("LiveDisplay",k),c["default"]=k},{5:5,81:81}],11:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(2),i=d(h),j=a(5),k=d(j),l=a(81),m=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(l),n=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.on(c,"volumechange",g.update),c.tech_&&!1===c.tech_.featuresVolumeControl&&g.addClass("vjs-hidden"),g.on(c,"loadstart",function(){this.update(),!1===c.tech_.featuresVolumeControl?this.addClass("vjs-hidden"):this.removeClass("vjs-hidden")}),g}return g(b,a),b.prototype.buildCSSClass=function(){return"vjs-mute-control "+a.prototype.buildCSSClass.call(this)},b.prototype.handleClick=function(a){this.player_.muted(!this.player_.muted())},b.prototype.update=function(a){var b=this.player_.volume(),c=3;this.player_.muted()?c=0:b<.33?c=1:b<.67&&(c=2);var d=this.player_.muted()?"Unmute":"Mute";this.controlText()!==d&&this.controlText(d);for(var e=0;e<4;e++)m.removeElClass(this.el_,"vjs-vol-"+e);m.addElClass(this.el_,"vjs-vol-"+c)},b}(i["default"]);n.prototype.controlText_="Mute",k["default"].registerComponent("MuteToggle",n),c["default"]=n},{2:2,5:5,81:81}],12:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(2),i=d(h),j=a(5),k=d(j),l=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.on(c,"play",g.handlePlay),g.on(c,"pause",g.handlePause),g}return g(b,a),b.prototype.buildCSSClass=function(){return"vjs-play-control "+a.prototype.buildCSSClass.call(this)},b.prototype.handleClick=function(a){this.player_.paused()?this.player_.play():this.player_.pause()},b.prototype.handlePlay=function(a){this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.controlText("Pause")},b.prototype.handlePause=function(a){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.controlText("Play")},b}(i["default"]);l.prototype.controlText_="Play",k["default"].registerComponent("PlayToggle",l),c["default"]=l},{2:2,5:5}],13:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(47),i=d(h),j=a(49),k=d(j),l=a(14),m=d(l),n=a(5),o=d(n),p=a(81),q=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(p),r=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.updateVisibility(),g.updateLabel(),g.on(c,"loadstart",g.updateVisibility),g.on(c,"ratechange",g.updateLabel),g}return g(b,a),
b.prototype.createEl=function(){var b=a.prototype.createEl.call(this);return this.labelEl_=q.createEl("div",{className:"vjs-playback-rate-value",innerHTML:1}),b.appendChild(this.labelEl_),b},b.prototype.buildCSSClass=function(){return"vjs-playback-rate "+a.prototype.buildCSSClass.call(this)},b.prototype.createMenu=function(){var a=new k["default"](this.player()),b=this.playbackRates();if(b)for(var c=b.length-1;c>=0;c--)a.addChild(new m["default"](this.player(),{rate:b[c]+"x"}));return a},b.prototype.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())},b.prototype.handleClick=function(a){for(var b=this.player().playbackRate(),c=this.playbackRates(),d=c[0],e=0;e<c.length;e++)if(c[e]>b){d=c[e];break}this.player().playbackRate(d)},b.prototype.playbackRates=function(){return this.options_.playbackRates||this.options_.playerOptions&&this.options_.playerOptions.playbackRates},b.prototype.playbackRateSupported=function(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0},b.prototype.updateVisibility=function(a){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")},b.prototype.updateLabel=function(a){this.playbackRateSupported()&&(this.labelEl_.innerHTML=this.player().playbackRate()+"x")},b}(i["default"]);r.prototype.controlText_="Playback Rate",o["default"].registerComponent("PlaybackRateMenuButton",r),c["default"]=r},{14:14,47:47,49:49,5:5,81:81}],14:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(48),i=d(h),j=a(5),k=d(j),l=function(a){function b(c,d){e(this,b);var g=d.rate,h=parseFloat(g,10);d.label=g,d.selected=1===h,d.selectable=!0;var i=f(this,a.call(this,c,d));return i.label=g,i.rate=h,i.on(c,"ratechange",i.update),i}return g(b,a),b.prototype.handleClick=function(b){a.prototype.handleClick.call(this),this.player().playbackRate(this.rate)},b.prototype.update=function(a){this.selected(this.player().playbackRate()===this.rate)},b}(i["default"]);l.prototype.contentElType="button",k["default"].registerComponent("PlaybackRateMenuItem",l),c["default"]=l},{48:48,5:5}],15:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var g=a(5),h=function(a){return a&&a.__esModule?a:{"default":a}}(g),i=a(81),j=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(i),k=function(a){function b(c,f){d(this,b);var g=e(this,a.call(this,c,f));return g.partEls_=[],g.on(c,"progress",g.update),g}return f(b,a),b.prototype.createEl=function(){return a.prototype.createEl.call(this,"div",{className:"vjs-load-progress",innerHTML:'<span class="vjs-control-text"><span>'+this.localize("Loaded")+"</span>: 0%</span>"})},b.prototype.update=function(a){var b=this.player_.buffered(),c=this.player_.duration(),d=this.player_.bufferedEnd(),e=this.partEls_,f=function(a,b){var c=a/b||0;return 100*(c>=1?1:c)+"%"};this.el_.style.width=f(d,c);for(var g=0;g<b.length;g++){var h=b.start(g),i=b.end(g),k=e[g];k||(k=this.el_.appendChild(j.createEl()),e[g]=k),k.style.left=f(h,d),k.style.width=f(i-h,d)}for(var l=e.length;l>b.length;l--)this.el_.removeChild(e[l-1]);e.length=b.length},b}(h["default"]);h["default"].registerComponent("LoadProgressBar",k),c["default"]=k},{5:5,81:81}],16:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var i=a(5),j=e(i),k=a(81),l=d(k),m=a(83),n=d(m),o=a(84),p=e(o),q=a(80),r=e(q),s=function(a){function b(c,d){f(this,b);var e=g(this,a.call(this,c,d));return d.playerOptions&&d.playerOptions.controlBar&&d.playerOptions.controlBar.progressControl&&d.playerOptions.controlBar.progressControl.keepTooltipsInside&&(e.keepTooltipsInside=d.playerOptions.controlBar.progressControl.keepTooltipsInside),e.keepTooltipsInside&&(e.tooltip=l.createEl("div",{className:"vjs-time-tooltip"}),e.el().appendChild(e.tooltip),e.addClass("vjs-keep-tooltips-inside")),e.update(0,0),c.on("ready",function(){e.on(c.controlBar.progressControl.el(),"mousemove",n.throttle(n.bind(e,e.handleMouseMove),25))}),e}return h(b,a),b.prototype.createEl=function(){return a.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},b.prototype.handleMouseMove=function(a){var b=this.player_.duration(),c=this.calculateDistance(a)*b,d=a.pageX-l.findElPosition(this.el().parentNode).left;this.update(c,d)},b.prototype.update=function(a,b){var c=(0,p["default"])(a,this.player_.duration());if(this.el().style.left=b+"px",this.el().setAttribute("data-current-time",c),this.keepTooltipsInside){var d=this.clampPosition_(b),e=b-d+1,f=parseFloat((0,r["default"])(this.tooltip,"width")),g=f/2;this.tooltip.innerHTML=c,this.tooltip.style.right="-"+(g-e)+"px"}},b.prototype.calculateDistance=function(a){return l.getPointerPosition(this.el().parentNode,a).x},b.prototype.clampPosition_=function(a){if(!this.keepTooltipsInside)return a;var b=parseFloat((0,r["default"])(this.player().el(),"width")),c=parseFloat((0,r["default"])(this.tooltip,"width")),d=c/2,e=a;return a<d?e=Math.ceil(d):a>b-d&&(e=Math.floor(b-d)),e},b}(j["default"]);j["default"].registerComponent("MouseTimeDisplay",s),c["default"]=s},{5:5,80:80,81:81,83:83,84:84}],17:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(5),i=d(h),j=a(83),k=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(j),l=a(84),m=d(l),n=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.updateDataAttr(),g.on(c,"timeupdate",g.updateDataAttr),c.ready(k.bind(g,g.updateDataAttr)),d.playerOptions&&d.playerOptions.controlBar&&d.playerOptions.controlBar.progressControl&&d.playerOptions.controlBar.progressControl.keepTooltipsInside&&(g.keepTooltipsInside=d.playerOptions.controlBar.progressControl.keepTooltipsInside),g.keepTooltipsInside&&g.addClass("vjs-keep-tooltips-inside"),g}return g(b,a),b.prototype.createEl=function(){return a.prototype.createEl.call(this,"div",{className:"vjs-play-progress vjs-slider-bar",innerHTML:'<span class="vjs-control-text"><span>'+this.localize("Progress")+"</span>: 0%</span>"})},b.prototype.updateDataAttr=function(a){var b=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();this.el_.setAttribute("data-current-time",(0,m["default"])(b,this.player_.duration()))},b}(i["default"]);i["default"].registerComponent("PlayProgressBar",n),c["default"]=n},{5:5,83:83,84:84}],18:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var g=a(5),h=function(a){return a&&a.__esModule?a:{"default":a}}(g);a(19),a(16);var i=function(a){function b(){return d(this,b),e(this,a.apply(this,arguments))}return f(b,a),b.prototype.createEl=function(){return a.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})},b}(h["default"]);i.prototype.options_={children:["seekBar"]},h["default"].registerComponent("ProgressControl",i),c["default"]=i},{16:16,19:19,5:5}],19:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(57),i=d(h),j=a(5),k=d(j),l=a(83),m=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(l),n=a(84),o=d(n),p=a(80),q=d(p);a(15),a(17),a(20);var r=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.on(c,"timeupdate",g.updateProgress),g.on(c,"ended",g.updateProgress),c.ready(m.bind(g,g.updateProgress)),d.playerOptions&&d.playerOptions.controlBar&&d.playerOptions.controlBar.progressControl&&d.playerOptions.controlBar.progressControl.keepTooltipsInside&&(g.keepTooltipsInside=d.playerOptions.controlBar.progressControl.keepTooltipsInside),g.keepTooltipsInside&&(g.tooltipProgressBar=g.addChild("TooltipProgressBar")),g}return g(b,a),b.prototype.createEl=function(){return a.prototype.createEl.call(this,"div",{className:"vjs-progress-holder"},{"aria-label":"progress bar"})},b.prototype.updateProgress=function(a){if(this.updateAriaAttributes(this.el_),this.keepTooltipsInside){this.updateAriaAttributes(this.tooltipProgressBar.el_),this.tooltipProgressBar.el_.style.width=this.bar.el_.style.width;var b=parseFloat((0,q["default"])(this.player().el(),"width")),c=parseFloat((0,q["default"])(this.tooltipProgressBar.tooltip,"width")),d=this.tooltipProgressBar.el().style;d.maxWidth=Math.floor(b-c/2)+"px",d.minWidth=Math.ceil(c/2)+"px",d.right="-"+c/2+"px"}},b.prototype.updateAriaAttributes=function(a){var b=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();a.setAttribute("aria-valuenow",(100*this.getPercent()).toFixed(2)),a.setAttribute("aria-valuetext",(0,o["default"])(b,this.player_.duration()))},b.prototype.getPercent=function(){var a=this.player_.currentTime()/this.player_.duration();return a>=1?1:a},b.prototype.handleMouseDown=function(b){this.player_.scrubbing(!0),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),a.prototype.handleMouseDown.call(this,b)},b.prototype.handleMouseMove=function(a){var b=this.calculateDistance(a)*this.player_.duration();b===this.player_.duration()&&(b-=.1),this.player_.currentTime(b)},b.prototype.handleMouseUp=function(b){a.prototype.handleMouseUp.call(this,b),this.player_.scrubbing(!1),this.videoWasPlaying&&this.player_.play()},b.prototype.stepForward=function(){this.player_.currentTime(this.player_.currentTime()+5)},b.prototype.stepBack=function(){this.player_.currentTime(this.player_.currentTime()-5)},b}(i["default"]);r.prototype.options_={children:["loadProgressBar","mouseTimeDisplay","playProgressBar"],barName:"playProgressBar"},r.prototype.playerEvent="timeupdate",k["default"].registerComponent("SeekBar",r),c["default"]=r},{15:15,17:17,20:20,5:5,57:57,80:80,83:83,84:84}],20:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(5),i=d(h),j=a(83),k=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(j),l=a(84),m=d(l),n=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.updateDataAttr(),g.on(c,"timeupdate",g.updateDataAttr),c.ready(k.bind(g,g.updateDataAttr)),g}return g(b,a),b.prototype.createEl=function(){var b=a.prototype.createEl.call(this,"div",{className:"vjs-tooltip-progress-bar vjs-slider-bar",innerHTML:'<div class="vjs-time-tooltip"></div>\n        <span class="vjs-control-text"><span>'+this.localize("Progress")+"</span>: 0%</span>"});return this.tooltip=b.querySelector(".vjs-time-tooltip"),b},b.prototype.updateDataAttr=function(a){var b=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),c=(0,m["default"])(b,this.player_.duration());this.el_.setAttribute("data-current-time",c),this.tooltip.innerHTML=c},b}(i["default"]);i["default"].registerComponent("TooltipProgressBar",n),c["default"]=n},{5:5,83:83,84:84}],21:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(22),i=d(h),j=a(5),k=d(j),l=function(a){function b(){return e(this,b),f(this,a.apply(this,arguments))}return g(b,a),b.prototype.buildCSSClass=function(){return"vjs-custom-control-spacer "+a.prototype.buildCSSClass.call(this)},b.prototype.createEl=function(){var b=a.prototype.createEl.call(this,{className:this.buildCSSClass()});return b.innerHTML="&nbsp;",b},b}(i["default"]);k["default"].registerComponent("CustomControlSpacer",l),c["default"]=l},{22:22,5:5}],22:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var g=a(5),h=function(a){return a&&a.__esModule?a:{"default":a}}(g),i=function(a){function b(){return d(this,b),e(this,a.apply(this,arguments))}return f(b,a),b.prototype.buildCSSClass=function(){return"vjs-spacer "+a.prototype.buildCSSClass.call(this)},b.prototype.createEl=function(){return a.prototype.createEl.call(this,"div",{className:this.buildCSSClass()})},b}(h["default"]);h["default"].registerComponent("Spacer",i),c["default"]=i},{5:5}],23:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(31),i=d(h),j=a(5),k=d(j),l=function(a){function b(c,d){e(this,b),d.track={player:c,kind:d.kind,label:d.kind+" settings",selectable:!1,"default":!1,mode:"disabled"},d.selectable=!1;var g=f(this,a.call(this,c,d));return g.addClass("vjs-texttrack-settings"),g.controlText(", opens "+d.kind+" settings dialog"),g}return g(b,a),b.prototype.handleClick=function(a){this.player().getChild("textTrackSettings").show(),this.player().getChild("textTrackSettings").el_.focus()},b}(i["default"]);k["default"].registerComponent("CaptionSettingsMenuItem",l),c["default"]=l},{31:31,5:5}],24:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(30),i=d(h),j=a(5),k=d(j),l=a(23),m=d(l),n=function(a){function b(c,d,g){e(this,b);var h=f(this,a.call(this,c,d,g));return h.el_.setAttribute("aria-label","Captions Menu"),h}return g(b,a),b.prototype.buildCSSClass=function(){return"vjs-captions-button "+a.prototype.buildCSSClass.call(this)},b.prototype.createItems=function(){var b=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||(b.push(new m["default"](this.player_,{kind:this.kind_})),this.hideThreshold_+=1),a.prototype.createItems.call(this,b)},b}(i["default"]);n.prototype.kind_="captions",n.prototype.controlText_="Captions",k["default"].registerComponent("CaptionsButton",n),c["default"]=n},{23:23,30:30,5:5}],25:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(30),i=d(h),j=a(5),k=d(j),l=a(26),m=d(l),n=a(91),o=d(n),p=function(a){function b(c,d,g){e(this,b);var h=f(this,a.call(this,c,d,g));return h.el_.setAttribute("aria-label","Chapters Menu"),h}return g(b,a),b.prototype.buildCSSClass=function(){return"vjs-chapters-button "+a.prototype.buildCSSClass.call(this)},b.prototype.update=function(b){this.track_&&(!b||"addtrack"!==b.type&&"removetrack"!==b.type)||this.setTrack(this.findChaptersTrack()),a.prototype.update.call(this)},b.prototype.setTrack=function(a){if(this.track_!==a){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){var b=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);b&&b.removeEventListener("load",this.updateHandler_),this.track_=null}if(this.track_=a,this.track_){this.track_.mode="hidden";var c=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);c&&c.addEventListener("load",this.updateHandler_)}}},b.prototype.findChaptersTrack=function(){for(var a=this.player_.textTracks()||[],b=a.length-1;b>=0;b--){var c=a[b];if(c.kind===this.kind_)return c}},b.prototype.getMenuCaption=function(){return this.track_&&this.track_.label?this.track_.label:this.localize((0,o["default"])(this.kind_))},b.prototype.createMenu=function(){return this.options_.title=this.getMenuCaption(),a.prototype.createMenu.call(this)},b.prototype.createItems=function(){var a=[];if(!this.track_)return a;var b=this.track_.cues;if(!b)return a;for(var c=0,d=b.length;c<d;c++){var e=b[c],f=new m["default"](this.player_,{track:this.track_,cue:e});a.push(f)}return a},b}(i["default"]);p.prototype.kind_="chapters",p.prototype.controlText_="Chapters",k["default"].registerComponent("ChaptersButton",p),c["default"]=p},{26:26,30:30,5:5,91:91}],26:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(48),i=d(h),j=a(5),k=d(j),l=a(83),m=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(l),n=function(a){function b(c,d){e(this,b);var g=d.track,h=d.cue,i=c.currentTime();d.selectable=!0,d.label=h.text,d.selected=h.startTime<=i&&i<h.endTime;var j=f(this,a.call(this,c,d));return j.track=g,j.cue=h,g.addEventListener("cuechange",m.bind(j,j.update)),j}return g(b,a),b.prototype.handleClick=function(b){a.prototype.handleClick.call(this),this.player_.currentTime(this.cue.startTime),this.update(this.cue.startTime)},b.prototype.update=function(a){var b=this.cue,c=this.player_.currentTime();this.selected(b.startTime<=c&&c<b.endTime)},b}(i["default"]);k["default"].registerComponent("ChaptersTrackMenuItem",n),c["default"]=n},{48:48,5:5,83:83}],27:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(30),i=d(h),j=a(5),k=d(j),l=a(83),m=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(l),n=function(a){function b(c,d,g){e(this,b);var h=f(this,a.call(this,c,d,g));h.el_.setAttribute("aria-label","Descriptions Menu");var i=c.textTracks();if(i){var j=m.bind(h,h.handleTracksChange);i.addEventListener("change",j),h.on("dispose",function(){i.removeEventListener("change",j)})}return h}return g(b,a),b.prototype.handleTracksChange=function(a){for(var b=this.player().textTracks(),c=!1,d=0,e=b.length;d<e;d++){var f=b[d];if(f.kind!==this.kind_&&"showing"===f.mode){c=!0;break}}c?this.disable():this.enable()},b.prototype.buildCSSClass=function(){return"vjs-descriptions-button "+a.prototype.buildCSSClass.call(this)},b}(i["default"]);n.prototype.kind_="descriptions",n.prototype.controlText_="Descriptions",k["default"].registerComponent("DescriptionsButton",n),c["default"]=n},{30:30,5:5,83:83}],28:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(31),i=d(h),j=a(5),k=d(j),l=function(a){function b(c,d){e(this,b),d.track={player:c,kind:d.kind,label:d.kind+" off","default":!1,mode:"disabled"},d.selectable=!0;var g=f(this,a.call(this,c,d));return g.selected(!0),g}return g(b,a),b.prototype.handleTracksChange=function(a){for(var b=this.player().textTracks(),c=!0,d=0,e=b.length;d<e;d++){var f=b[d];if(f.kind===this.track.kind&&"showing"===f.mode){c=!1;break}}this.selected(c)},b}(i["default"]);k["default"].registerComponent("OffTextTrackMenuItem",l),c["default"]=l},{31:31,5:5}],29:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(30),i=d(h),j=a(5),k=d(j),l=function(a){function b(c,d,g){e(this,b);var h=f(this,a.call(this,c,d,g));return h.el_.setAttribute("aria-label","Subtitles Menu"),h}return g(b,a),b.prototype.buildCSSClass=function(){return"vjs-subtitles-button "+a.prototype.buildCSSClass.call(this)},b}(i["default"]);l.prototype.kind_="subtitles",l.prototype.controlText_="Subtitles",k["default"].registerComponent("SubtitlesButton",l),c["default"]=l},{30:30,5:5}],30:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(36),i=d(h),j=a(5),k=d(j),l=a(31),m=d(l),n=a(28),o=d(n),p=function(a){function b(c){var d=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return e(this,b),d.tracks=c.textTracks(),f(this,a.call(this,c,d))}return g(b,a),b.prototype.createItems=function(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];a.push(new o["default"](this.player_,{kind:this.kind_})),this.hideThreshold_+=1;var b=this.player_.textTracks();if(!b)return a;for(var c=0;c<b.length;c++){var d=b[c];d.kind===this.kind_&&a.push(new m["default"](this.player_,{track:d,selectable:!0}))}return a},b}(i["default"]);k["default"].registerComponent("TextTrackButton",p),c["default"]=p},{28:28,31:31,36:36,5:5}],31:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},i=a(48),j=d(i),k=a(5),l=d(k),m=a(83),n=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(m),o=a(97),p=d(o),q=a(96),r=d(q),s=function(a){function b(c,d){e(this,b);var g=d.track,i=c.textTracks();d.label=g.label||g.language||"Unknown",d.selected=g["default"]||"showing"===g.mode;var j=f(this,a.call(this,c,d));if(j.track=g,i){var k=n.bind(j,j.handleTracksChange);c.on(["loadstart","texttrackchange"],k),i.addEventListener("change",k),j.on("dispose",function(){i.removeEventListener("change",k)})}if(i&&i.onchange===undefined){var l=void 0;j.on(["tap","click"],function(){if("object"!==h(p["default"].Event))try{l=new p["default"].Event("change")}catch(a){}l||(l=r["default"].createEvent("Event"),l.initEvent("change",!0,!0)),i.dispatchEvent(l)})}return j}return g(b,a),b.prototype.handleClick=function(b){var c=this.track.kind,d=this.player_.textTracks();if(a.prototype.handleClick.call(this,b),d)for(var e=0;e<d.length;e++){var f=d[e];f.kind===c&&(f===this.track?"showing"!==f.mode&&(f.mode="showing"):"disabled"!==f.mode&&(f.mode="disabled"))}},b.prototype.handleTracksChange=function(a){this.selected("showing"===this.track.mode)},b}(j["default"]);l["default"].registerComponent("TextTrackMenuItem",s),c["default"]=s},{48:48,5:5,83:83,96:96,97:97}],32:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){
if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(5),i=d(h),j=a(81),k=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(j),l=a(84),m=d(l),n=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.on(c,"timeupdate",g.updateContent),g}return g(b,a),b.prototype.createEl=function(){var b=a.prototype.createEl.call(this,"div",{className:"vjs-current-time vjs-time-control vjs-control"});return this.contentEl_=k.createEl("div",{className:"vjs-current-time-display",innerHTML:'<span class="vjs-control-text">Current Time </span>0:00'},{"aria-live":"off"}),b.appendChild(this.contentEl_),b},b.prototype.updateContent=function(a){var b=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),c=this.localize("Current Time"),d=(0,m["default"])(b,this.player_.duration());d!==this.formattedTime_&&(this.formattedTime_=d,this.contentEl_.innerHTML='<span class="vjs-control-text">'+c+"</span> "+d)},b}(i["default"]);i["default"].registerComponent("CurrentTimeDisplay",n),c["default"]=n},{5:5,81:81,84:84}],33:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(5),i=d(h),j=a(81),k=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(j),l=a(84),m=d(l),n=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.on(c,"durationchange",g.updateContent),g.on(c,"timeupdate",g.updateContent),g.on(c,"loadedmetadata",g.updateContent),g}return g(b,a),b.prototype.createEl=function(){var b=a.prototype.createEl.call(this,"div",{className:"vjs-duration vjs-time-control vjs-control"});return this.contentEl_=k.createEl("div",{className:"vjs-duration-display",innerHTML:'<span class="vjs-control-text">'+this.localize("Duration Time")+"</span> 0:00"},{"aria-live":"off"}),b.appendChild(this.contentEl_),b},b.prototype.updateContent=function(a){var b=this.player_.duration();if(b&&this.duration_!==b){this.duration_=b;var c=this.localize("Duration Time"),d=(0,m["default"])(b);this.contentEl_.innerHTML='<span class="vjs-control-text">'+c+"</span> "+d}},b}(i["default"]);i["default"].registerComponent("DurationDisplay",n),c["default"]=n},{5:5,81:81,84:84}],34:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(5),i=d(h),j=a(81),k=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(j),l=a(84),m=d(l),n=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.on(c,"timeupdate",g.updateContent),g.on(c,"durationchange",g.updateContent),g}return g(b,a),b.prototype.createEl=function(){var b=a.prototype.createEl.call(this,"div",{className:"vjs-remaining-time vjs-time-control vjs-control"});return this.contentEl_=k.createEl("div",{className:"vjs-remaining-time-display",innerHTML:'<span class="vjs-control-text">'+this.localize("Remaining Time")+"</span> -0:00"},{"aria-live":"off"}),b.appendChild(this.contentEl_),b},b.prototype.updateContent=function(a){if(this.player_.duration()){var b=this.localize("Remaining Time"),c=(0,m["default"])(this.player_.remainingTime());c!==this.formattedTime_&&(this.formattedTime_=c,this.contentEl_.innerHTML='<span class="vjs-control-text">'+b+"</span> -"+c)}},b}(i["default"]);i["default"].registerComponent("RemainingTimeDisplay",n),c["default"]=n},{5:5,81:81,84:84}],35:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var g=a(5),h=function(a){return a&&a.__esModule?a:{"default":a}}(g),i=function(a){function b(){return d(this,b),e(this,a.apply(this,arguments))}return f(b,a),b.prototype.createEl=function(){return a.prototype.createEl.call(this,"div",{className:"vjs-time-control vjs-time-divider",innerHTML:"<div><span>/</span></div>"})},b}(h["default"]);h["default"].registerComponent("TimeDivider",i),c["default"]=i},{5:5}],36:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(47),i=d(h),j=a(5),k=d(j),l=a(83),m=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(l),n=function(a){function b(c,d){e(this,b);var g=d.tracks,h=f(this,a.call(this,c,d));if(h.items.length<=1&&h.hide(),!g)return f(h);var i=m.bind(h,h.update);return g.addEventListener("removetrack",i),g.addEventListener("addtrack",i),h.player_.on("dispose",function(){g.removeEventListener("removetrack",i),g.removeEventListener("addtrack",i)}),h}return g(b,a),b}(i["default"]);k["default"].registerComponent("TrackButton",n),c["default"]=n},{47:47,5:5,83:83}],37:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(57),i=d(h),j=a(5),k=d(j),l=a(83),m=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(l);a(39);var n=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.on(c,"volumechange",g.updateARIAAttributes),c.ready(m.bind(g,g.updateARIAAttributes)),g}return g(b,a),b.prototype.createEl=function(){return a.prototype.createEl.call(this,"div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":"volume level"})},b.prototype.handleMouseMove=function(a){this.checkMuted(),this.player_.volume(this.calculateDistance(a))},b.prototype.checkMuted=function(){this.player_.muted()&&this.player_.muted(!1)},b.prototype.getPercent=function(){return this.player_.muted()?0:this.player_.volume()},b.prototype.stepForward=function(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)},b.prototype.stepBack=function(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)},b.prototype.updateARIAAttributes=function(a){var b=(100*this.player_.volume()).toFixed(2);this.el_.setAttribute("aria-valuenow",b),this.el_.setAttribute("aria-valuetext",b+"%")},b}(i["default"]);n.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},n.prototype.playerEvent="volumechange",k["default"].registerComponent("VolumeBar",n),c["default"]=n},{39:39,5:5,57:57,83:83}],38:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var g=a(5),h=function(a){return a&&a.__esModule?a:{"default":a}}(g);a(37);var i=function(a){function b(c,f){d(this,b);var g=e(this,a.call(this,c,f));return c.tech_&&!1===c.tech_.featuresVolumeControl&&g.addClass("vjs-hidden"),g.on(c,"loadstart",function(){!1===c.tech_.featuresVolumeControl?this.addClass("vjs-hidden"):this.removeClass("vjs-hidden")}),g}return f(b,a),b.prototype.createEl=function(){return a.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control"})},b}(h["default"]);i.prototype.options_={children:["volumeBar"]},h["default"].registerComponent("VolumeControl",i),c["default"]=i},{37:37,5:5}],39:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var g=a(5),h=function(a){return a&&a.__esModule?a:{"default":a}}(g),i=function(a){function b(){return d(this,b),e(this,a.apply(this,arguments))}return f(b,a),b.prototype.createEl=function(){return a.prototype.createEl.call(this,"div",{className:"vjs-volume-level",innerHTML:'<span class="vjs-control-text"></span>'})},b}(h["default"]);h["default"].registerComponent("VolumeLevel",i),c["default"]=i},{5:5}],40:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(83),i=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(h),j=a(5),k=d(j),l=a(54),m=d(l),n=a(53),o=d(n),p=a(11),q=d(p),r=a(37),s=d(r),t=function(a){function b(c){function d(){c.tech_&&!1===c.tech_.featuresVolumeControl?this.addClass("vjs-hidden"):this.removeClass("vjs-hidden")}var g=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};e(this,b),g.inline===undefined&&(g.inline=!0),g.vertical===undefined&&(g.inline?g.vertical=!1:g.vertical=!0),g.volumeBar=g.volumeBar||{},g.volumeBar.vertical=!!g.vertical;var h=f(this,a.call(this,c,g));return h.on(c,"volumechange",h.volumeUpdate),h.on(c,"loadstart",h.volumeUpdate),d.call(h),h.on(c,"loadstart",d),h.on(h.volumeBar,["slideractive","focus"],function(){this.addClass("vjs-slider-active")}),h.on(h.volumeBar,["sliderinactive","blur"],function(){this.removeClass("vjs-slider-active")}),h.on(h.volumeBar,["focus"],function(){this.addClass("vjs-lock-showing")}),h.on(h.volumeBar,["blur"],function(){this.removeClass("vjs-lock-showing")}),h}return g(b,a),b.prototype.buildCSSClass=function(){var b="";return b=this.options_.vertical?"vjs-volume-menu-button-vertical":"vjs-volume-menu-button-horizontal","vjs-volume-menu-button "+a.prototype.buildCSSClass.call(this)+" "+b},b.prototype.createPopup=function(){var a=new m["default"](this.player_,{contentElType:"div"}),b=new s["default"](this.player_,this.options_.volumeBar);return a.addChild(b),this.menuContent=a,this.volumeBar=b,this.attachVolumeBarEvents(),a},b.prototype.handleClick=function(b){q["default"].prototype.handleClick.call(this),a.prototype.handleClick.call(this)},b.prototype.attachVolumeBarEvents=function(){this.menuContent.on(["mousedown","touchdown"],i.bind(this,this.handleMouseDown))},b.prototype.handleMouseDown=function(a){this.on(["mousemove","touchmove"],i.bind(this.volumeBar,this.volumeBar.handleMouseMove)),this.on(this.el_.ownerDocument,["mouseup","touchend"],this.handleMouseUp)},b.prototype.handleMouseUp=function(a){this.off(["mousemove","touchmove"],i.bind(this.volumeBar,this.volumeBar.handleMouseMove))},b}(o["default"]);t.prototype.volumeUpdate=q["default"].prototype.update,t.prototype.controlText_="Mute",k["default"].registerComponent("VolumeMenuButton",t),c["default"]=t},{11:11,37:37,5:5,53:53,54:54,83:83}],41:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(5),i=d(h),j=a(50),k=d(j),l=a(87),m=d(l),n=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.on(c,"error",g.open),g}return g(b,a),b.prototype.buildCSSClass=function(){return"vjs-error-display "+a.prototype.buildCSSClass.call(this)},b.prototype.content=function(){var a=this.player().error();return a?this.localize(a.message):""},b}(k["default"]);n.prototype.options_=(0,m["default"])(k["default"].prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),i["default"].registerComponent("ErrorDisplay",n),c["default"]=n},{5:5,50:50,87:87}],42:[function(a,b,c){"use strict";c.__esModule=!0;var d=a(82),e=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(d),f=function(){};f.prototype.allowedEvents_={},f.prototype.on=function(a,b){var c=this.addEventListener;this.addEventListener=function(){},e.on(this,a,b),this.addEventListener=c},f.prototype.addEventListener=f.prototype.on,f.prototype.off=function(a,b){e.off(this,a,b)},f.prototype.removeEventListener=f.prototype.off,f.prototype.one=function(a,b){var c=this.addEventListener;this.addEventListener=function(){},e.one(this,a,b),this.addEventListener=c},f.prototype.trigger=function(a){var b=a.type||a;"string"==typeof a&&(a={type:b}),a=e.fixEvent(a),this.allowedEvents_[b]&&this["on"+b]&&this["on"+b](a),e.trigger(this,a)},f.prototype.dispatchEvent=f.prototype.trigger,c["default"]=f},{82:82}],43:[function(a,b,c){"use strict";c.__esModule=!0;var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e=a(86),f=function(a){return a&&a.__esModule?a:{"default":a}}(e),g=a(88),h=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+(void 0===b?"undefined":d(b)));a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(a.super_=b)},i=function(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},c=function(){a.apply(this,arguments)},d={};(0,g.isObject)(b)?("function"==typeof b.init&&(f["default"].warn("Constructor logic via init() is deprecated; please use constructor() instead."),b.constructor=b.init),b.constructor!==Object.prototype.constructor&&(c=b.constructor),d=b):"function"==typeof b&&(c=b),h(c,a);for(var e in d)d.hasOwnProperty(e)&&(c.prototype[e]=d[e]);return c};c["default"]=i},{86:86,88:88}],44:[function(a,b,c){"use strict";c.__esModule=!0;for(var d=a(96),e=function(a){return a&&a.__esModule?a:{"default":a}}(d),f={},g=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],h=g[0],i=void 0,j=0;j<g.length;j++)if(g[j][1]in e["default"]){i=g[j];break}if(i)for(var k=0;k<i.length;k++)f[h[k]]=i[k];c["default"]=f},{96:96}],45:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var g=a(5),h=function(a){return a&&a.__esModule?a:{"default":a}}(g),i=function(a){function b(){return d(this,b),e(this,a.apply(this,arguments))}return f(b,a),b.prototype.createEl=function(){return a.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",dir:"ltr"})},b}(h["default"]);h["default"].registerComponent("LoadingSpinner",i),c["default"]=i},{5:5}],46:[function(a,b,c){"use strict";function d(a){if(a instanceof d)return a;"number"==typeof a?this.code=a:"string"==typeof a?this.message=a:(0,e.isObject)(a)&&("number"==typeof a.code&&(this.code=a.code),(0,e.assign)(this,a)),this.message||(this.message=d.defaultMessages[this.code]||"")}c.__esModule=!0;var e=a(88);d.prototype.code=0,d.prototype.message="",d.prototype.status=null,d.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],d.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(var f=0;f<d.errorTypes.length;f++)d[d.errorTypes[f]]=f,d.prototype[d.errorTypes[f]]=f;c["default"]=d},{88:88}],47:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var i=a(3),j=e(i),k=a(5),l=e(k),m=a(49),n=e(m),o=a(81),p=d(o),q=a(83),r=d(q),s=a(91),t=e(s),u=function(a){function b(c){var d=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};f(this,b);var e=g(this,a.call(this,c,d));return e.update(),e.enabled_=!0,e.el_.setAttribute("aria-haspopup","true"),e.el_.setAttribute("role","menuitem"),e.on("keydown",e.handleSubmenuKeyPress),e}return h(b,a),b.prototype.update=function(){var a=this.createMenu();this.menu&&this.removeChild(this.menu),this.menu=a,this.addChild(a),this.buttonPressed_=!1,this.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?this.hide():this.show()},b.prototype.createMenu=function(){var a=new n["default"](this.player_);if(this.hideThreshold_=0,this.options_.title){var b=p.createEl("li",{className:"vjs-menu-title",innerHTML:(0,t["default"])(this.options_.title),tabIndex:-1});this.hideThreshold_+=1,a.children_.unshift(b),p.insertElFirst(b,a.contentEl())}if(this.items=this.createItems(),this.items)for(var c=0;c<this.items.length;c++)a.addItem(this.items[c]);return a},b.prototype.createItems=function(){},b.prototype.createEl=function(){return a.prototype.createEl.call(this,"div",{className:this.buildCSSClass()})},b.prototype.buildCSSClass=function(){var b="vjs-menu-button";return!0===this.options_.inline?b+="-inline":b+="-popup","vjs-menu-button "+b+" "+a.prototype.buildCSSClass.call(this)},b.prototype.handleClick=function(a){this.one(this.menu.contentEl(),"mouseleave",r.bind(this,function(a){this.unpressButton(),this.el_.blur()})),this.buttonPressed_?this.unpressButton():this.pressButton()},b.prototype.handleKeyPress=function(b){27===b.which||9===b.which?(this.buttonPressed_&&this.unpressButton(),9!==b.which&&b.preventDefault()):38===b.which||40===b.which?this.buttonPressed_||(this.pressButton(),b.preventDefault()):a.prototype.handleKeyPress.call(this,b)},b.prototype.handleSubmenuKeyPress=function(a){27!==a.which&&9!==a.which||(this.buttonPressed_&&this.unpressButton(),9!==a.which&&a.preventDefault())},b.prototype.pressButton=function(){this.enabled_&&(this.buttonPressed_=!0,this.menu.lockShowing(),this.el_.setAttribute("aria-expanded","true"),this.menu.focus())},b.prototype.unpressButton=function(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.el_.setAttribute("aria-expanded","false"),this.el_.focus())},b.prototype.disable=function(){return this.buttonPressed_=!1,this.menu.unlockShowing(),this.el_.setAttribute("aria-expanded","false"),this.enabled_=!1,a.prototype.disable.call(this)},b.prototype.enable=function(){return this.enabled_=!0,a.prototype.enable.call(this)},b}(j["default"]);l["default"].registerComponent("MenuButton",u),c["default"]=u},{3:3,49:49,5:5,81:81,83:83,91:91}],48:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(3),i=d(h),j=a(5),k=d(j),l=a(88),m=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.selectable=d.selectable,g.selected(d.selected),g.selectable?g.el_.setAttribute("role","menuitemcheckbox"):g.el_.setAttribute("role","menuitem"),g}return g(b,a),b.prototype.createEl=function(b,c,d){return this.nonIconControl=!0,a.prototype.createEl.call(this,"li",(0,l.assign)({className:"vjs-menu-item",innerHTML:this.localize(this.options_.label),tabIndex:-1},c),d)},b.prototype.handleClick=function(a){this.selected(!0)},b.prototype.selected=function(a){this.selectable&&(a?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected")):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(" ")))},b}(i["default"]);k["default"].registerComponent("MenuItem",m),c["default"]=m},{3:3,5:5,88:88}],49:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(5),i=function(a){return a&&a.__esModule?a:{"default":a}}(h),j=a(81),k=d(j),l=a(83),m=d(l),n=a(82),o=d(n),p=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.focusedChild_=-1,g.on("keydown",g.handleKeyPress),g}return g(b,a),b.prototype.addItem=function(a){this.addChild(a),a.on("click",m.bind(this,function(a){this.unlockShowing()}))},b.prototype.createEl=function(){var b=this.options_.contentElType||"ul";this.contentEl_=k.createEl(b,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");var c=a.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});return c.setAttribute("role","presentation"),c.appendChild(this.contentEl_),o.on(c,"click",function(a){a.preventDefault(),a.stopImmediatePropagation()}),c},b.prototype.handleKeyPress=function(a){37===a.which||40===a.which?(a.preventDefault(),this.stepForward()):38!==a.which&&39!==a.which||(a.preventDefault(),this.stepBack())},b.prototype.stepForward=function(){var a=0;this.focusedChild_!==undefined&&(a=this.focusedChild_+1),this.focus(a)},b.prototype.stepBack=function(){var a=0;this.focusedChild_!==undefined&&(a=this.focusedChild_-1),this.focus(a)},b.prototype.focus=function(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0,b=this.children().slice();b.length&&b[0].className&&/vjs-menu-title/.test(b[0].className)&&b.shift(),b.length>0&&(a<0?a=0:a>=b.length&&(a=b.length-1),this.focusedChild_=a,b[a].el_.focus())},b}(i["default"]);i["default"].registerComponent("Menu",p),c["default"]=p},{5:5,81:81,82:82,83:83}],50:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(81),i=d(h),j=a(83),k=d(j),l=a(5),m=function(a){return a&&a.__esModule?a:{"default":a}}(l),n="vjs-modal-dialog",o=function(a){function b(c,d){e(this,b);var g=f(this,a.call(this,c,d));return g.opened_=g.hasBeenOpened_=g.hasBeenFilled_=!1,g.closeable(!g.options_.uncloseable),g.content(g.options_.content),g.contentEl_=i.createEl("div",{className:n+"-content"},{role:"document"}),g.descEl_=i.createEl("p",{className:n+"-description vjs-offscreen",id:g.el().getAttribute("aria-describedby")}),i.textContent(g.descEl_,g.description()),g.el_.appendChild(g.descEl_),g.el_.appendChild(g.contentEl_),g}return g(b,a),b.prototype.createEl=function(){return a.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":this.id()+"_description","aria-hidden":"true","aria-label":this.label(),role:"dialog"})},b.prototype.buildCSSClass=function(){return n+" vjs-hidden "+a.prototype.buildCSSClass.call(this)},b.prototype.handleKeyPress=function(a){27===a.which&&this.closeable()&&this.close()},b.prototype.label=function(){return this.options_.label||this.localize("Modal Window")},b.prototype.description=function(){var a=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(a+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),a},b.prototype.open=function(){if(!this.opened_){var a=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!a.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&a.pause(),this.closeable()&&this.on(this.el_.ownerDocument,"keydown",k.bind(this,this.handleKeyPress)),a.controls(!1),this.show(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}return this},b.prototype.opened=function(a){return"boolean"==typeof a&&this[a?"open":"close"](),this.opened_},b.prototype.close=function(){if(this.opened_){var a=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&a.play(),this.closeable()&&this.off(this.el_.ownerDocument,"keydown",k.bind(this,this.handleKeyPress)),a.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.options_.temporary&&this.dispose()}return this},b.prototype.closeable=function(a){
if("boolean"==typeof a){var b=this.closeable_=!!a,c=this.getChild("closeButton");if(b&&!c){var d=this.contentEl_;this.contentEl_=this.el_,c=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=d,this.on(c,"close",this.close)}!b&&c&&(this.off(c,"close",this.close),this.removeChild(c),c.dispose())}return this.closeable_},b.prototype.fill=function(){return this.fillWith(this.content())},b.prototype.fillWith=function(a){var b=this.contentEl(),c=b.parentNode,d=b.nextSibling;return this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,c.removeChild(b),this.empty(),i.insertContent(b,a),this.trigger("modalfill"),d?c.insertBefore(b,d):c.appendChild(b),this},b.prototype.empty=function(){return this.trigger("beforemodalempty"),i.emptyEl(this.contentEl()),this.trigger("modalempty"),this},b.prototype.content=function(a){return void 0!==a&&(this.content_=a),this.content_},b}(m["default"]);o.prototype.options_={pauseOnOpen:!0,temporary:!0},m["default"].registerComponent("ModalDialog",o),c["default"]=o},{5:5,81:81,83:83}],51:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var i=a(5),j=e(i),k=a(96),l=e(k),m=a(97),n=e(m),o=a(82),p=d(o),q=a(81),r=d(q),s=a(83),t=d(s),u=a(85),v=d(u),w=a(78),x=d(w),y=a(86),z=e(y),A=a(91),B=e(A),C=a(90),D=a(79),E=a(89),F=d(E),G=a(44),H=e(G),I=a(46),J=e(I),K=a(100),L=e(K),M=a(88),N=a(87),O=e(N),P=a(69),Q=e(P),R=a(50),S=e(R),T=a(62),U=e(T),V=a(63),W=e(V),X=a(76),Y=e(X);a(61),a(59),a(55),a(68),a(45),a(1),a(4),a(8),a(41),a(71),a(60);var Z=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","ratechange","volumechange","texttrackchange"],$=function(a){function b(c,d,e){if(f(this,b),c.id=c.id||"vjs_video_"+v.newGUID(),d=(0,M.assign)(b.getTagSettings(c),d),d.initChildren=!1,d.createEl=!1,d.reportTouchActivity=!1,!d.language)if("function"==typeof c.closest){var h=c.closest("[lang]");h&&(d.language=h.getAttribute("lang"))}else for(var i=c;i&&1===i.nodeType;){if(r.getElAttributes(i).hasOwnProperty("lang")){d.language=i.getAttribute("lang");break}i=i.parentNode}var j=g(this,a.call(this,null,d,e));if(!j.options_||!j.options_.techOrder||!j.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(j.tag=c,j.tagAttributes=c&&r.getElAttributes(c),j.language(j.options_.language),d.languages){var k={};Object.getOwnPropertyNames(d.languages).forEach(function(a){k[a.toLowerCase()]=d.languages[a]}),j.languages_=k}else j.languages_=b.prototype.options_.languages;j.cache_={},j.poster_=d.poster||"",j.controls_=!!d.controls,c.controls=!1,j.scrubbing_=!1,j.el_=j.createEl();var l=(0,O["default"])(j.options_);if(d.plugins){var m=d.plugins;Object.getOwnPropertyNames(m).forEach(function(a){"function"==typeof this[a]?this[a](m[a]):z["default"].error("Unable to find plugin:",a)},j)}j.options_.playerOptions=l,j.initChildren(),j.isAudio("audio"===c.nodeName.toLowerCase()),j.controls()?j.addClass("vjs-controls-enabled"):j.addClass("vjs-controls-disabled"),j.el_.setAttribute("role","region"),j.isAudio()?j.el_.setAttribute("aria-label","audio player"):j.el_.setAttribute("aria-label","video player"),j.isAudio()&&j.addClass("vjs-audio"),j.flexNotSupported_()&&j.addClass("vjs-no-flex"),x.IS_IOS||j.addClass("vjs-workinghover"),b.players[j.id_]=j;var n="5.20.4".split(".")[0];return j.addClass("vjs-v"+n),j.userActive(!0),j.reportUserActivity(),j.listenForUserActivity_(),j.on("fullscreenchange",j.handleFullscreenChange_),j.on("stageclick",j.handleStageClick_),j}return h(b,a),b.prototype.dispose=function(){this.trigger("dispose"),this.off("dispose"),this.styleEl_&&this.styleEl_.parentNode&&this.styleEl_.parentNode.removeChild(this.styleEl_),b.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&this.tech_.dispose(),a.prototype.dispose.call(this)},b.prototype.createEl=function(){var b=this.tag,c=void 0,d=this.playerElIngest_=b.parentNode&&b.parentNode.hasAttribute&&b.parentNode.hasAttribute("data-vjs-player");c=this.el_=d?b.parentNode:a.prototype.createEl.call(this,"div"),b.setAttribute("tabindex","-1"),b.removeAttribute("width"),b.removeAttribute("height");var e=r.getElAttributes(b);if(Object.getOwnPropertyNames(e).forEach(function(a){"class"===a?c.className+=" "+e[a]:c.setAttribute(a,e[a])}),b.playerId=b.id,b.id+="_html5_api",b.className="vjs-tech",b.player=c.player=this,this.addClass("vjs-paused"),!0!==n["default"].VIDEOJS_NO_DYNAMIC_STYLE){this.styleEl_=F.createStyleElement("vjs-styles-dimensions");var f=r.$(".vjs-styles-defaults"),g=r.$("head");g.insertBefore(this.styleEl_,f?f.nextSibling:g.firstChild)}this.width(this.options_.width),this.height(this.options_.height),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio);for(var h=b.getElementsByTagName("a"),i=0;i<h.length;i++){var j=h.item(i);r.addElClass(j,"vjs-hidden"),j.setAttribute("hidden","hidden")}return b.initNetworkState_=b.networkState,b.parentNode&&!d&&b.parentNode.insertBefore(c,b),r.insertElFirst(b,c),this.children_.unshift(b),this.el_=c,c},b.prototype.width=function(a){return this.dimension("width",a)},b.prototype.height=function(a){return this.dimension("height",a)},b.prototype.dimension=function(a,b){var c=a+"_";if(b===undefined)return this[c]||0;if(""===b)this[c]=undefined;else{var d=parseFloat(b);if(isNaN(d))return z["default"].error('Improper value "'+b+'" supplied for for '+a),this;this[c]=d}return this.updateStyleEl_(),this},b.prototype.fluid=function(a){if(a===undefined)return!!this.fluid_;this.fluid_=!!a,a?this.addClass("vjs-fluid"):this.removeClass("vjs-fluid"),this.updateStyleEl_()},b.prototype.aspectRatio=function(a){if(a===undefined)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(a))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=a,this.fluid(!0),this.updateStyleEl_()},b.prototype.updateStyleEl_=function(){if(!0===n["default"].VIDEOJS_NO_DYNAMIC_STYLE){var a="number"==typeof this.width_?this.width_:this.options_.width,b="number"==typeof this.height_?this.height_:this.options_.height,c=this.tech_&&this.tech_.el();return void(c&&(a>=0&&(c.width=a),b>=0&&(c.height=b)))}var d=void 0,e=void 0,f=void 0,g=void 0;f=this.aspectRatio_!==undefined&&"auto"!==this.aspectRatio_?this.aspectRatio_:this.videoWidth()>0?this.videoWidth()+":"+this.videoHeight():"16:9";var h=f.split(":"),i=h[1]/h[0];d=this.width_!==undefined?this.width_:this.height_!==undefined?this.height_/i:this.videoWidth()||300,e=this.height_!==undefined?this.height_:d*i,g=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(g),F.setTextContent(this.styleEl_,"\n      ."+g+" {\n        width: "+d+"px;\n        height: "+e+"px;\n      }\n\n      ."+g+".vjs-fluid {\n        padding-top: "+100*i+"%;\n      }\n    ")},b.prototype.loadTech_=function(a,b){var c=this;this.tech_&&this.unloadTech_(),"Html5"!==a&&this.tag&&(U["default"].getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=a,this.isReady_=!1;var d=(0,M.assign)({source:b,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+"_"+a+"_api",videoTracks:this.videoTracks_,textTracks:this.textTracks_,audioTracks:this.audioTracks_,autoplay:this.options_.autoplay,playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"]},this.options_[a.toLowerCase()]);this.tag&&(d.tag=this.tag),b&&(this.currentType_=b.type,b.src===this.cache_.src&&this.cache_.currentTime>0&&(d.startTime=this.cache_.currentTime),this.cache_.sources=null,this.cache_.source=b,this.cache_.src=b.src);var e=U["default"].getTech(a);e||(e=j["default"].getComponent(a)),this.tech_=new e(d),this.tech_.ready(t.bind(this,this.handleTechReady_),!0),Q["default"].jsonToTextTracks(this.textTracksJson_||[],this.tech_),Z.forEach(function(a){c.on(c.tech_,a,c["handleTech"+(0,B["default"])(a)+"_"])}),this.on(this.tech_,"loadstart",this.handleTechLoadStart_),this.on(this.tech_,"waiting",this.handleTechWaiting_),this.on(this.tech_,"canplay",this.handleTechCanPlay_),this.on(this.tech_,"canplaythrough",this.handleTechCanPlayThrough_),this.on(this.tech_,"playing",this.handleTechPlaying_),this.on(this.tech_,"ended",this.handleTechEnded_),this.on(this.tech_,"seeking",this.handleTechSeeking_),this.on(this.tech_,"seeked",this.handleTechSeeked_),this.on(this.tech_,"play",this.handleTechPlay_),this.on(this.tech_,"firstplay",this.handleTechFirstPlay_),this.on(this.tech_,"pause",this.handleTechPause_),this.on(this.tech_,"durationchange",this.handleTechDurationChange_),this.on(this.tech_,"fullscreenchange",this.handleTechFullscreenChange_),this.on(this.tech_,"error",this.handleTechError_),this.on(this.tech_,"loadedmetadata",this.updateStyleEl_),this.on(this.tech_,"posterchange",this.handleTechPosterChange_),this.on(this.tech_,"textdata",this.handleTechTextData_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode===this.el()||"Html5"===a&&this.tag||r.insertElFirst(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)},b.prototype.unloadTech_=function(){this.videoTracks_=this.videoTracks(),this.textTracks_=this.textTracks(),this.audioTracks_=this.audioTracks(),this.textTracksJson_=Q["default"].textTracksToJson(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1},b.prototype.tech=function(a){if(a&&a.IWillNotUseThisInPlugins)return this.tech_;var b="\n      Please make sure that you are not using this inside of a plugin.\n      To disable this alert and error, please pass in an object with\n      `IWillNotUseThisInPlugins` to the `tech` method. See\n      https://github.com/videojs/video.js/issues/2617 for more info.\n    ";throw n["default"].alert(b),new Error(b)},b.prototype.addTechControlsListeners_=function(){this.removeTechControlsListeners_(),this.on(this.tech_,"mousedown",this.handleTechClick_),this.on(this.tech_,"touchstart",this.handleTechTouchStart_),this.on(this.tech_,"touchmove",this.handleTechTouchMove_),this.on(this.tech_,"touchend",this.handleTechTouchEnd_),this.on(this.tech_,"tap",this.handleTechTap_)},b.prototype.removeTechControlsListeners_=function(){this.off(this.tech_,"tap",this.handleTechTap_),this.off(this.tech_,"touchstart",this.handleTechTouchStart_),this.off(this.tech_,"touchmove",this.handleTechTouchMove_),this.off(this.tech_,"touchend",this.handleTechTouchEnd_),this.off(this.tech_,"mousedown",this.handleTechClick_)},b.prototype.handleTechReady_=function(){if(this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_(),(this.src()||this.currentSrc())&&this.tag&&this.options_.autoplay&&this.paused()){try{delete this.tag.poster}catch(a){(0,z["default"])("deleting tag.poster throws in some browsers",a)}this.play()}},b.prototype.handleTechLoadStart_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-seeking"),this.error(null),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):(this.trigger("loadstart"),this.trigger("firstplay"))},b.prototype.hasStarted=function(a){return a!==undefined?(this.hasStarted_!==a&&(this.hasStarted_=a,a?(this.addClass("vjs-has-started"),this.trigger("firstplay")):this.removeClass("vjs-has-started")),this):!!this.hasStarted_},b.prototype.handleTechPlay_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")},b.prototype.handleTechWaiting_=function(){var a=this;this.addClass("vjs-waiting"),this.trigger("waiting"),this.one("timeupdate",function(){return a.removeClass("vjs-waiting")})},b.prototype.handleTechCanPlay_=function(){this.removeClass("vjs-waiting"),this.trigger("canplay")},b.prototype.handleTechCanPlayThrough_=function(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")},b.prototype.handleTechPlaying_=function(){this.removeClass("vjs-waiting"),this.trigger("playing")},b.prototype.handleTechSeeking_=function(){this.addClass("vjs-seeking"),this.trigger("seeking")},b.prototype.handleTechSeeked_=function(){this.removeClass("vjs-seeking"),this.trigger("seeked")},b.prototype.handleTechFirstPlay_=function(){this.options_.starttime&&(z["default"].warn("Passing the `starttime` option to the player will be deprecated in 6.0"),this.currentTime(this.options_.starttime)),this.addClass("vjs-has-started"),this.trigger("firstplay")},b.prototype.handleTechPause_=function(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")},b.prototype.handleTechEnded_=function(){this.addClass("vjs-ended"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")},b.prototype.handleTechDurationChange_=function(){this.duration(this.techGet_("duration"))},b.prototype.handleTechClick_=function(a){0===a.button&&this.controls()&&(this.paused()?this.play():this.pause())},b.prototype.handleTechTap_=function(){this.userActive(!this.userActive())},b.prototype.handleTechTouchStart_=function(){this.userWasActive=this.userActive()},b.prototype.handleTechTouchMove_=function(){this.userWasActive&&this.reportUserActivity()},b.prototype.handleTechTouchEnd_=function(a){a.preventDefault()},b.prototype.handleFullscreenChange_=function(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")},b.prototype.handleStageClick_=function(){this.reportUserActivity()},b.prototype.handleTechFullscreenChange_=function(a,b){b&&this.isFullscreen(b.isFullscreen),this.trigger("fullscreenchange")},b.prototype.handleTechError_=function(){var a=this.tech_.error();this.error(a)},b.prototype.handleTechTextData_=function(){var a=null;arguments.length>1&&(a=arguments[1]),this.trigger("textdata",a)},b.prototype.getCache=function(){return this.cache_},b.prototype.techCall_=function(a,b){if(this.tech_&&!this.tech_.isReady_)this.tech_.ready(function(){this[a](b)},!0);else try{this.tech_&&this.tech_[a](b)}catch(c){throw(0,z["default"])(c),c}},b.prototype.techGet_=function(a){if(this.tech_&&this.tech_.isReady_)try{return this.tech_[a]()}catch(b){throw this.tech_[a]===undefined?(0,z["default"])("Video.js: "+a+" method not defined for "+this.techName_+" playback technology.",b):"TypeError"===b.name?((0,z["default"])("Video.js: "+a+" unavailable on "+this.techName_+" playback technology element.",b),this.tech_.isReady_=!1):(0,z["default"])(b),b}},b.prototype.play=function(){return this.src()||this.currentSrc()?this.techCall_("play"):this.tech_.one("loadstart",function(){this.play()}),this},b.prototype.pause=function(){return this.techCall_("pause"),this},b.prototype.paused=function(){return!1!==this.techGet_("paused")},b.prototype.scrubbing=function(a){return a!==undefined?(this.scrubbing_=!!a,a?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing"),this):this.scrubbing_},b.prototype.currentTime=function(a){return a!==undefined?(this.techCall_("setCurrentTime",a),this):(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime)},b.prototype.duration=function(a){return a===undefined?this.cache_.duration!==undefined?this.cache_.duration:NaN:(a=parseFloat(a),a<0&&(a=Infinity),a!==this.cache_.duration&&(this.cache_.duration=a,a===Infinity?this.addClass("vjs-live"):this.removeClass("vjs-live"),this.trigger("durationchange")),this)},b.prototype.remainingTime=function(){return this.duration()-this.currentTime()},b.prototype.buffered=function(){var a=this.techGet_("buffered");return a&&a.length||(a=(0,C.createTimeRange)(0,0)),a},b.prototype.bufferedPercent=function(){return(0,D.bufferedPercent)(this.buffered(),this.duration())},b.prototype.bufferedEnd=function(){var a=this.buffered(),b=this.duration(),c=a.end(a.length-1);return c>b&&(c=b),c},b.prototype.volume=function(a){var b=void 0;return a!==undefined?(b=Math.max(0,Math.min(1,parseFloat(a))),this.cache_.volume=b,this.techCall_("setVolume",b),this):(b=parseFloat(this.techGet_("volume")),isNaN(b)?1:b)},b.prototype.muted=function(a){return a!==undefined?(this.techCall_("setMuted",a),this):this.techGet_("muted")||!1},b.prototype.supportsFullScreen=function(){return this.techGet_("supportsFullScreen")||!1},b.prototype.isFullscreen=function(a){return a!==undefined?(this.isFullscreen_=!!a,this):!!this.isFullscreen_},b.prototype.requestFullscreen=function(){var a=H["default"];return this.isFullscreen(!0),a.requestFullscreen?(p.on(l["default"],a.fullscreenchange,t.bind(this,function b(c){this.isFullscreen(l["default"][a.fullscreenElement]),!1===this.isFullscreen()&&p.off(l["default"],a.fullscreenchange,b),this.trigger("fullscreenchange")})),this.el_[a.requestFullscreen]()):this.tech_.supportsFullScreen()?this.techCall_("enterFullScreen"):(this.enterFullWindow(),this.trigger("fullscreenchange")),this},b.prototype.exitFullscreen=function(){var a=H["default"];return this.isFullscreen(!1),a.requestFullscreen?l["default"][a.exitFullscreen]():this.tech_.supportsFullScreen()?this.techCall_("exitFullScreen"):(this.exitFullWindow(),this.trigger("fullscreenchange")),this},b.prototype.enterFullWindow=function(){this.isFullWindow=!0,this.docOrigOverflow=l["default"].documentElement.style.overflow,p.on(l["default"],"keydown",t.bind(this,this.fullWindowOnEscKey)),l["default"].documentElement.style.overflow="hidden",r.addElClass(l["default"].body,"vjs-full-window"),this.trigger("enterFullWindow")},b.prototype.fullWindowOnEscKey=function(a){27===a.keyCode&&(!0===this.isFullscreen()?this.exitFullscreen():this.exitFullWindow())},b.prototype.exitFullWindow=function(){this.isFullWindow=!1,p.off(l["default"],"keydown",this.fullWindowOnEscKey),l["default"].documentElement.style.overflow=this.docOrigOverflow,r.removeElClass(l["default"].body,"vjs-full-window"),this.trigger("exitFullWindow")},b.prototype.canPlayType=function(a){for(var b=void 0,c=0,d=this.options_.techOrder;c<d.length;c++){var e=(0,B["default"])(d[c]),f=U["default"].getTech(e);if(f||(f=j["default"].getComponent(e)),f){if(f.isSupported()&&(b=f.canPlayType(a)))return b}else z["default"].error('The "'+e+'" tech is undefined. Skipped browser support check for that tech.')}return""},b.prototype.selectSource=function(a){var b=this,c=this.options_.techOrder.map(B["default"]).map(function(a){return[a,U["default"].getTech(a)||j["default"].getComponent(a)]}).filter(function(a){var b=a[0],c=a[1];return c?c.isSupported():(z["default"].error('The "'+b+'" tech is undefined. Skipped browser support check for that tech.'),!1)}),d=function(a,b,c){var d=void 0;return a.some(function(a){return b.some(function(b){if(d=c(a,b))return!0})}),d},e=function(a,c){var d=a[0];if(a[1].canPlaySource(c,b.options_[d.toLowerCase()]))return{source:c,tech:d}};return(this.options_.sourceOrder?d(a,c,function(a){return function(b,c){return a(c,b)}}(e)):d(c,a,e))||!1},b.prototype.src=function(a){if(a===undefined)return this.techGet_("src");var b=U["default"].getTech(this.techName_);return b||(b=j["default"].getComponent(this.techName_)),Array.isArray(a)?this.sourceList_(a):"string"==typeof a?this.src({src:a}):a instanceof Object&&(a.type&&!b.canPlaySource(a,this.options_[this.techName_.toLowerCase()])?this.sourceList_([a]):(this.cache_.sources=null,this.cache_.source=a,this.cache_.src=a.src,this.currentType_=a.type||"",this.ready(function(){b.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",a):this.techCall_("src",a.src),"auto"===this.options_.preload&&this.load(),this.options_.autoplay&&this.play()},!0))),this},b.prototype.sourceList_=function(a){var b=this.selectSource(a);b?(b.tech===this.techName_?this.src(b.source):this.loadTech_(b.tech,b.source),this.cache_.sources=a):(this.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0),this.triggerReady())},b.prototype.load=function(){return this.techCall_("load"),this},b.prototype.reset=function(){return this.loadTech_((0,B["default"])(this.options_.techOrder[0]),null),this.techCall_("reset"),this},b.prototype.currentSources=function(){var a=this.currentSource(),b=[];return 0!==Object.keys(a).length&&b.push(a),this.cache_.sources||b},b.prototype.currentSource=function(){var a={},b=this.currentSrc();return b&&(a.src=b),this.cache_.source||a},b.prototype.currentSrc=function(){return this.techGet_("currentSrc")||this.cache_.src||""},b.prototype.currentType=function(){return this.currentType_||""},b.prototype.preload=function(a){return a!==undefined?(this.techCall_("setPreload",a),this.options_.preload=a,this):this.techGet_("preload")},b.prototype.autoplay=function(a){return a!==undefined?(this.techCall_("setAutoplay",a),this.options_.autoplay=a,this):this.techGet_("autoplay",a)},b.prototype.playsinline=function(a){return a!==undefined?(this.techCall_("setPlaysinline",a),this.options_.playsinline=a,this):this.techGet_("playsinline")},b.prototype.loop=function(a){return a!==undefined?(this.techCall_("setLoop",a),this.options_.loop=a,this):this.techGet_("loop")},b.prototype.poster=function(a){return a===undefined?this.poster_:(a||(a=""),this.poster_=a,this.techCall_("setPoster",a),this.trigger("posterchange"),this)},b.prototype.handleTechPosterChange_=function(){!this.poster_&&this.tech_&&this.tech_.poster&&(this.poster_=this.tech_.poster()||"",this.trigger("posterchange"))},b.prototype.controls=function(a){return a!==undefined?(a=!!a,this.controls_!==a&&(this.controls_=a,this.usingNativeControls()&&this.techCall_("setControls",a),a?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_())),this):!!this.controls_},b.prototype.usingNativeControls=function(a){return a!==undefined?(a=!!a,this.usingNativeControls_!==a&&(this.usingNativeControls_=a,a?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols"))),this):!!this.usingNativeControls_},b.prototype.error=function(a){return a===undefined?this.error_||null:null===a?(this.error_=a,this.removeClass("vjs-error"),this.errorDisplay&&this.errorDisplay.close(),this):(this.error_=new J["default"](a),this.addClass("vjs-error"),z["default"].error("(CODE:"+this.error_.code+" "+J["default"].errorTypes[this.error_.code]+")",this.error_.message,this.error_),this.trigger("error"),this)},b.prototype.reportUserActivity=function(a){this.userActivity_=!0},b.prototype.userActive=function(a){return a!==undefined?(a=!!a,a!==this.userActive_&&(this.userActive_=a,a?(this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),this.trigger("useractive")):(this.userActivity_=!1,this.tech_&&this.tech_.one("mousemove",function(a){a.stopPropagation(),a.preventDefault()}),this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive"))),this):this.userActive_},b.prototype.listenForUserActivity_=function(){var a=void 0,b=void 0,c=void 0,d=t.bind(this,this.reportUserActivity),e=function(a){a.screenX===b&&a.screenY===c||(b=a.screenX,c=a.screenY,d())},f=function(){d(),this.clearInterval(a),a=this.setInterval(d,250)},g=function(b){d(),this.clearInterval(a)};this.on("mousedown",f),this.on("mousemove",e),this.on("mouseup",g),this.on("keydown",d),this.on("keyup",d);var h=void 0;this.setInterval(function(){if(this.userActivity_){this.userActivity_=!1,this.userActive(!0),this.clearTimeout(h);var a=this.options_.inactivityTimeout;a>0&&(h=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},a))}},250)},b.prototype.playbackRate=function(a){return a!==undefined?(this.techCall_("setPlaybackRate",a),this):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("playbackRate"):1},b.prototype.isAudio=function(a){return a!==undefined?(this.isAudio_=!!a,this):!!this.isAudio_},b.prototype.videoTracks=function(){return this.tech_?this.tech_.videoTracks():(this.videoTracks_=this.videoTracks_||new Y["default"],this.videoTracks_)},b.prototype.audioTracks=function(){return this.tech_?this.tech_.audioTracks():(this.audioTracks_=this.audioTracks_||new W["default"],this.audioTracks_)},b.prototype.textTracks=function(){if(this.tech_)return this.tech_.textTracks()},b.prototype.remoteTextTracks=function(){if(this.tech_)return this.tech_.remoteTextTracks()},b.prototype.remoteTextTrackEls=function(){if(this.tech_)return this.tech_.remoteTextTrackEls()},b.prototype.addTextTrack=function(a,b,c){if(this.tech_)return this.tech_.addTextTrack(a,b,c)},b.prototype.addRemoteTextTrack=function(a,b){if(this.tech_)return this.tech_.addRemoteTextTrack(a,b)},b.prototype.removeRemoteTextTrack=function(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},b=a.track,c=b===undefined?arguments[0]:b;if(this.tech_)return this.tech_.removeRemoteTextTrack(c)},b.prototype.getVideoPlaybackQuality=function(){return this.techGet_("getVideoPlaybackQuality")},b.prototype.videoWidth=function(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0},b.prototype.videoHeight=function(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0},b.prototype.language=function(a){return a===undefined?this.language_:(this.language_=String(a).toLowerCase(),this)},b.prototype.languages=function(){return(0,O["default"])(b.prototype.options_.languages,this.languages_)},b.prototype.toJSON=function(){var a=(0,O["default"])(this.options_),b=a.tracks;a.tracks=[];for(var c=0;c<b.length;c++){var d=b[c];d=(0,O["default"])(d),d.player=undefined,a.tracks[c]=d}return a},b.prototype.createModal=function(a,b){var c=this;b=b||{},b.content=a||"";var d=new S["default"](this,b);return this.addChild(d),d.on("dispose",function(){c.removeChild(d)}),d.open()},b.getTagSettings=function(a){var b={sources:[],tracks:[]},c=r.getElAttributes(a),d=c["data-setup"];if(r.hasElClass(a,"vjs-fluid")&&(c.fluid=!0),null!==d){var e=(0,L["default"])(d||"{}"),f=e[0],g=e[1];f&&z["default"].error(f),(0,M.assign)(c,g)}if((0,M.assign)(b,c),a.hasChildNodes())for(var h=a.childNodes,i=0,j=h.length;i<j;i++){var k=h[i],l=k.nodeName.toLowerCase();"source"===l?b.sources.push(r.getElAttributes(k)):"track"===l&&b.tracks.push(r.getElAttributes(k))}return b},b.prototype.flexNotSupported_=function(){var a=l["default"].createElement("i");return!("flexBasis"in a.style||"webkitFlexBasis"in a.style||"mozFlexBasis"in a.style||"msFlexBasis"in a.style||"msFlexOrder"in a.style)},b}(j["default"]);$.players={};var _=n["default"].navigator;$.prototype.options_={techOrder:["html5","flash"],html5:{},flash:{},defaultVolume:0,inactivityTimeout:2e3,playbackRates:[],children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","controlBar","errorDisplay","textTrackSettings"],language:_&&(_.languages&&_.languages[0]||_.userLanguage||_.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media."},["ended","seeking","seekable","networkState","readyState"].forEach(function(a){$.prototype[a]=function(){return this.techGet_(a)}}),Z.forEach(function(a){$.prototype["handleTech"+(0,B["default"])(a)+"_"]=function(){return this.trigger(a)}}),j["default"].registerComponent("Player",$),c["default"]=$},{1:1,100:100,4:4,41:41,44:44,45:45,46:46,5:5,50:50,55:55,59:59,60:60,61:61,62:62,63:63,68:68,69:69,71:71,76:76,78:78,79:79,8:8,81:81,82:82,83:83,85:85,86:86,87:87,88:88,89:89,90:90,91:91,96:96,97:97}],52:[function(a,b,c){"use strict";c.__esModule=!0;var d=a(51),e=function(a){return a&&a.__esModule?a:{"default":a}}(d),f=function(a,b){e["default"].prototype[a]=b};c["default"]=f},{51:51}],53:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(3),i=d(h),j=a(5),k=d(j),l=function(a){function b(c){var d=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};e(this,b);var g=f(this,a.call(this,c,d));return g.update(),g}return g(b,a),b.prototype.update=function(){var a=this.createPopup();this.popup&&this.removeChild(this.popup),this.popup=a,this.addChild(a),this.items&&0===this.items.length?this.hide():this.items&&this.items.length>1&&this.show()},b.prototype.createPopup=function(){},b.prototype.createEl=function(){return a.prototype.createEl.call(this,"div",{className:this.buildCSSClass()})},b.prototype.buildCSSClass=function(){var b="vjs-menu-button";return!0===this.options_.inline?b+="-inline":b+="-popup","vjs-menu-button "+b+" "+a.prototype.buildCSSClass.call(this)},b}(i["default"]);k["default"].registerComponent("PopupButton",l),c["default"]=l},{3:3,5:5}],54:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(5),i=function(a){return a&&a.__esModule?a:{"default":a}}(h),j=a(81),k=d(j),l=a(83),m=d(l),n=a(82),o=d(n),p=function(a){function b(){return e(this,b),f(this,a.apply(this,arguments))}return g(b,a),b.prototype.addItem=function(a){this.addChild(a),a.on("click",m.bind(this,function(){this.unlockShowing()}))},b.prototype.createEl=function(){var b=this.options_.contentElType||"ul";this.contentEl_=k.createEl(b,{className:"vjs-menu-content"});var c=a.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});return c.appendChild(this.contentEl_),o.on(c,"click",function(a){a.preventDefault(),a.stopImmediatePropagation()}),c},b}(i["default"]);i["default"].registerComponent("Popup",p),c["default"]=p},{5:5,81:81,82:82,83:83}],55:[function(a,b,c){"use strict";function d(a){
if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var i=a(3),j=e(i),k=a(5),l=e(k),m=a(83),n=d(m),o=a(81),p=d(o),q=a(78),r=d(q),s=function(a){function b(c,d){f(this,b);var e=g(this,a.call(this,c,d));return e.update(),c.on("posterchange",n.bind(e,e.update)),e}return h(b,a),b.prototype.dispose=function(){this.player().off("posterchange",this.update),a.prototype.dispose.call(this)},b.prototype.createEl=function(){var a=p.createEl("div",{className:"vjs-poster",tabIndex:-1});return r.BACKGROUND_SIZE_SUPPORTED||(this.fallbackImg_=p.createEl("img"),a.appendChild(this.fallbackImg_)),a},b.prototype.update=function(a){var b=this.player().poster();this.setSrc(b),b?this.show():this.hide()},b.prototype.setSrc=function(a){if(this.fallbackImg_)this.fallbackImg_.src=a;else{var b="";a&&(b='url("'+a+'")'),this.el_.style.backgroundImage=b}},b.prototype.handleClick=function(a){this.player_.controls()&&(this.player_.paused()?this.player_.play():this.player_.pause())},b}(j["default"]);l["default"].registerComponent("PosterImage",s),c["default"]=s},{3:3,5:5,78:78,81:81,83:83}],56:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function f(a,b){b&&(p=b),n["default"].setTimeout(q,a)}c.__esModule=!0,c.hasLoaded=c.autoSetupTimeout=c.autoSetup=undefined;var g=a(81),h=e(g),i=a(82),j=e(i),k=a(96),l=d(k),m=a(97),n=d(m),o=!1,p=void 0,q=function(){if(h.isReal()){var a=l["default"].getElementsByTagName("video"),b=l["default"].getElementsByTagName("audio"),c=[];if(a&&a.length>0)for(var d=0,e=a.length;d<e;d++)c.push(a[d]);if(b&&b.length>0)for(var g=0,i=b.length;g<i;g++)c.push(b[g]);if(c&&c.length>0)for(var j=0,k=c.length;j<k;j++){var m=c[j];if(!m||!m.getAttribute){f(1);break}if(m.player===undefined){var n=m.getAttribute("data-setup");null!==n&&p(m)}}else o||f(1)}};h.isReal()&&"complete"===l["default"].readyState?o=!0:j.one(n["default"],"load",function(){o=!0});var r=function(){return o};c.autoSetup=q,c.autoSetupTimeout=f,c.hasLoaded=r},{81:81,82:82,96:96,97:97}],57:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var g=a(5),h=function(a){return a&&a.__esModule?a:{"default":a}}(g),i=a(81),j=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(i),k=a(88),l=function(a){function b(c,f){d(this,b);var g=e(this,a.call(this,c,f));return g.bar=g.getChild(g.options_.barName),g.vertical(!!g.options_.vertical),g.on("mousedown",g.handleMouseDown),g.on("touchstart",g.handleMouseDown),g.on("focus",g.handleFocus),g.on("blur",g.handleBlur),g.on("click",g.handleClick),g.on(c,"controlsvisible",g.update),g.on(c,g.playerEvent,g.update),g}return f(b,a),b.prototype.createEl=function(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return c.className=c.className+" vjs-slider",c=(0,k.assign)({tabIndex:0},c),d=(0,k.assign)({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},d),a.prototype.createEl.call(this,b,c,d)},b.prototype.handleMouseDown=function(a){var b=this.bar.el_.ownerDocument;a.preventDefault(),j.blockTextSelection(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(b,"mousemove",this.handleMouseMove),this.on(b,"mouseup",this.handleMouseUp),this.on(b,"touchmove",this.handleMouseMove),this.on(b,"touchend",this.handleMouseUp),this.handleMouseMove(a)},b.prototype.handleMouseMove=function(a){},b.prototype.handleMouseUp=function(){var a=this.bar.el_.ownerDocument;j.unblockTextSelection(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(a,"mousemove",this.handleMouseMove),this.off(a,"mouseup",this.handleMouseUp),this.off(a,"touchmove",this.handleMouseMove),this.off(a,"touchend",this.handleMouseUp),this.update()},b.prototype.update=function(){if(this.el_){var a=this.getPercent(),b=this.bar;if(b){("number"!=typeof a||a!==a||a<0||a===Infinity)&&(a=0);var c=(100*a).toFixed(2)+"%";this.vertical()?b.el().style.height=c:b.el().style.width=c}}},b.prototype.calculateDistance=function(a){var b=j.getPointerPosition(this.el_,a);return this.vertical()?b.y:b.x},b.prototype.handleFocus=function(){this.on(this.bar.el_.ownerDocument,"keydown",this.handleKeyPress)},b.prototype.handleKeyPress=function(a){37===a.which||40===a.which?(a.preventDefault(),this.stepBack()):38!==a.which&&39!==a.which||(a.preventDefault(),this.stepForward())},b.prototype.handleBlur=function(){this.off(this.bar.el_.ownerDocument,"keydown",this.handleKeyPress)},b.prototype.handleClick=function(a){a.stopImmediatePropagation(),a.preventDefault()},b.prototype.vertical=function(a){return a===undefined?this.vertical_||!1:(this.vertical_=!!a,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal"),this)},b}(h["default"]);h["default"].registerComponent("Slider",l),c["default"]=l},{5:5,81:81,88:88}],58:[function(a,b,c){"use strict";function d(a){return a.streamingFormats={"rtmp/mp4":"MP4","rtmp/flv":"FLV"},a.streamFromParts=function(a,b){return a+"&"+b},a.streamToParts=function(a){var b={connection:"",stream:""};if(!a)return b;var c=a.search(/&(?!\w+=)/),d=void 0;return-1!==c?d=c+1:0===(c=d=a.lastIndexOf("/")+1)&&(c=d=a.length),b.connection=a.substring(0,c),b.stream=a.substring(d,a.length),b},a.isStreamingType=function(b){return b in a.streamingFormats},a.RTMP_RE=/^rtmp[set]?:\/\//i,a.isStreamingSrc=function(b){return a.RTMP_RE.test(b)},a.rtmpSourceHandler={},a.rtmpSourceHandler.canPlayType=function(b){return a.isStreamingType(b)?"maybe":""},a.rtmpSourceHandler.canHandleSource=function(b,c){var d=a.rtmpSourceHandler.canPlayType(b.type);return d||(a.isStreamingSrc(b.src)?"maybe":"")},a.rtmpSourceHandler.handleSource=function(b,c,d){var e=a.streamToParts(b.src);c.setRtmpConnection(e.connection),c.setRtmpStream(e.stream)},a.registerSourceHandler(a.rtmpSourceHandler),a}c.__esModule=!0,c["default"]=d},{}],59:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function i(a){z[a]=function(){return this.el_.vjs_getProperty(a)}}c.__esModule=!0;for(var j=a(62),k=e(j),l=a(81),m=d(l),n=a(92),o=d(n),p=a(90),q=a(58),r=e(q),s=a(5),t=e(s),u=a(97),v=e(u),w=a(88),x=v["default"].navigator,y=function(a){function b(c,d){f(this,b);var e=g(this,a.call(this,c,d));return c.source&&e.ready(function(){this.setSource(c.source)},!0),c.startTime&&e.ready(function(){this.load(),this.play(),this.currentTime(c.startTime)},!0),v["default"].videojs=v["default"].videojs||{},v["default"].videojs.Flash=v["default"].videojs.Flash||{},v["default"].videojs.Flash.onReady=b.onReady,v["default"].videojs.Flash.onEvent=b.onEvent,v["default"].videojs.Flash.onError=b.onError,e.on("seeked",function(){this.lastSeekTarget_=undefined}),e}return h(b,a),b.prototype.createEl=function(){var a=this.options_;if(!a.swf){a.swf="//vjs.zencdn.net/swf/5.4.1/video-js.swf"}var c=a.techId,d=(0,w.assign)({readyFunction:"videojs.Flash.onReady",eventProxyFunction:"videojs.Flash.onEvent",errorEventProxyFunction:"videojs.Flash.onError",autoplay:a.autoplay,preload:a.preload,loop:a.loop,muted:a.muted},a.flashVars),e=(0,w.assign)({wmode:"opaque",bgcolor:"#000000"},a.params),f=(0,w.assign)({id:c,name:c,"class":"vjs-tech"},a.attributes);return this.el_=b.embed(a.swf,d,e,f),this.el_.tech=this,this.el_},b.prototype.play=function(){this.ended()&&this.setCurrentTime(0),this.el_.vjs_play()},b.prototype.pause=function(){this.el_.vjs_pause()},b.prototype.src=function(a){return a===undefined?this.currentSrc():this.setSrc(a)},b.prototype.setSrc=function(a){var b=this;a=o.getAbsoluteURL(a),this.el_.vjs_src(a),this.autoplay()&&this.setTimeout(function(){return b.play()},0)},b.prototype.seeking=function(){return this.lastSeekTarget_!==undefined},b.prototype.setCurrentTime=function(b){var c=this.seekable();c.length&&(b=b>c.start(0)?b:c.start(0),b=b<c.end(c.length-1)?b:c.end(c.length-1),this.lastSeekTarget_=b,this.trigger("seeking"),this.el_.vjs_setProperty("currentTime",b),a.prototype.setCurrentTime.call(this))},b.prototype.currentTime=function(){return this.seeking()?this.lastSeekTarget_||0:this.el_.vjs_getProperty("currentTime")},b.prototype.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.vjs_getProperty("currentSrc")},b.prototype.duration=function(){if(0===this.readyState())return NaN;var a=this.el_.vjs_getProperty("duration");return a>=0?a:Infinity},b.prototype.load=function(){this.el_.vjs_load()},b.prototype.poster=function(){this.el_.vjs_getProperty("poster")},b.prototype.setPoster=function(){},b.prototype.seekable=function(){var a=this.duration();return 0===a?(0,p.createTimeRange)():(0,p.createTimeRange)(0,a)},b.prototype.buffered=function(){var a=this.el_.vjs_getProperty("buffered");return 0===a.length?(0,p.createTimeRange)():(0,p.createTimeRange)(a[0][0],a[0][1])},b.prototype.supportsFullScreen=function(){return!1},b.prototype.enterFullScreen=function(){return!1},b.prototype.getVideoPlaybackQuality=function(){var a=this.el_.vjs_getProperty("getVideoPlaybackQuality");return v["default"].performance&&"function"==typeof v["default"].performance.now?a.creationTime=v["default"].performance.now():v["default"].performance&&v["default"].performance.timing&&"number"==typeof v["default"].performance.timing.navigationStart&&(a.creationTime=v["default"].Date.now()-v["default"].performance.timing.navigationStart),a},b}(k["default"]),z=y.prototype,A="rtmpConnection,rtmpStream,preload,defaultPlaybackRate,playbackRate,autoplay,loop,mediaGroup,controller,controls,volume,muted,defaultMuted".split(","),B="networkState,readyState,initialTime,startOffsetTime,paused,ended,videoWidth,videoHeight".split(","),C=0;C<A.length;C++)i(A[C]),function(a){var b=a.charAt(0).toUpperCase()+a.slice(1);z["set"+b]=function(b){return this.el_.vjs_setProperty(a,b)}}(A[C]);for(var D=0;D<B.length;D++)i(B[D]);y.isSupported=function(){return y.version()[0]>=10},k["default"].withSourceHandlers(y),y.nativeSourceHandler={},y.nativeSourceHandler.canPlayType=function(a){return a in y.formats?"maybe":""},y.nativeSourceHandler.canHandleSource=function(a,b){var c=void 0;return c=a.type?a.type.replace(/;.*/,"").toLowerCase():function(a){var b=o.getFileExtension(a);return b?"video/"+b:""}(a.src),y.nativeSourceHandler.canPlayType(c)},y.nativeSourceHandler.handleSource=function(a,b,c){b.setSrc(a.src)},y.nativeSourceHandler.dispose=function(){},y.registerSourceHandler(y.nativeSourceHandler),y.formats={"video/flv":"FLV","video/x-flv":"FLV","video/mp4":"MP4","video/m4v":"MP4"},y.onReady=function(a){var b=m.getEl(a),c=b&&b.tech;c&&c.el()&&y.checkReady(c)},y.checkReady=function(a){a.el()&&(a.el().vjs_getProperty?a.triggerReady():this.setTimeout(function(){y.checkReady(a)},50))},y.onEvent=function(a,b){var c=m.getEl(a).tech,d=Array.prototype.slice.call(arguments,2);c.setTimeout(function(){c.trigger(b,d)},1)},y.onError=function(a,b){var c=m.getEl(a).tech;if("srcnotfound"===b)return c.error(4);c.error("FLASH: "+b)},y.version=function(){var a="0,0,0";try{a=new v["default"].ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(b){try{x.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&(a=(x.plugins["Shockwave Flash 2.0"]||x.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1])}catch(c){}}return a.split(",")},y.embed=function(a,b,c,d){var e=y.getEmbedCode(a,b,c,d);return m.createEl("div",{innerHTML:e}).childNodes[0]},y.getEmbedCode=function(a,b,c,d){var e="",f="",g="";return b&&Object.getOwnPropertyNames(b).forEach(function(a){e+=a+"="+b[a]+"&amp;"}),c=(0,w.assign)({movie:a,flashvars:e,allowScriptAccess:"always",allowNetworking:"all"},c),Object.getOwnPropertyNames(c).forEach(function(a){f+='<param name="'+a+'" value="'+c[a]+'" />'}),d=(0,w.assign)({data:a,width:"100%",height:"100%"},d),Object.getOwnPropertyNames(d).forEach(function(a){g+=a+'="'+d[a]+'" '}),'<object type="application/x-shockwave-flash" '+g+">"+f+"</object>"},(0,r["default"])(y),t["default"].registerComponent("Flash",y),k["default"].registerTech("Flash",y),c["default"]=y},{5:5,58:58,62:62,81:81,88:88,90:90,92:92,97:97}],60:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var i=function(a,b){return a.raw=b,a}(["Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\n            This may prevent text tracks from loading."],["Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\n            This may prevent text tracks from loading."]),j=a(62),k=e(j),l=a(5),m=e(l),n=a(81),o=d(n),p=a(92),q=d(p),r=a(83),s=d(r),t=a(86),u=e(t),v=a(102),w=e(v),x=a(78),y=d(x),z=a(96),A=e(z),B=a(97),C=e(B),D=a(88),E=a(87),F=e(E),G=a(91),H=e(G),I=function(a){function b(c,d){f(this,b);var e=g(this,a.call(this,c,d)),h=c.source,j=!1;if(h&&(e.el_.currentSrc!==h.src||c.tag&&3===c.tag.initNetworkState_)?e.setSource(h):e.handleLateInit_(e.el_),e.el_.hasChildNodes()){for(var k=e.el_.childNodes,l=k.length,m=[];l--;){var n=k[l];"track"===n.nodeName.toLowerCase()&&(e.featuresNativeTextTracks?(e.remoteTextTrackEls().addTrackElement_(n),e.remoteTextTracks().addTrack_(n.track),j||e.el_.hasAttribute("crossorigin")||!q.isCrossOrigin(n.src)||(j=!0)):m.push(n))}for(var o=0;o<m.length;o++)e.el_.removeChild(m[o])}return["audio","video"].forEach(function(a){var b=e.el()[a+"Tracks"],c=e[a+"Tracks"](),d=(0,H["default"])(a);e["featuresNative"+d+"Tracks"]&&b&&b.addEventListener&&(e["handle"+d+"TrackChange_"]=function(a){c.trigger({type:"change",target:c,currentTarget:c,srcElement:c})},e["handle"+d+"TrackAdd_"]=function(a){return c.addTrack(a.track)},e["handle"+d+"TrackRemove_"]=function(a){return c.removeTrack(a.track)},b.addEventListener("change",e["handle"+d+"TrackChange_"]),b.addEventListener("addtrack",e["handle"+d+"TrackAdd_"]),b.addEventListener("removetrack",e["handle"+d+"TrackRemove_"]),e["removeOld"+d+"Tracks_"]=function(a){return e.removeOldTracks_(c,b)},e.on("loadstart",e["removeOld"+d+"Tracks_"]))}),e.featuresNativeTextTracks&&(j&&u["default"].warn((0,w["default"])(i)),e.handleTextTrackChange_=s.bind(e,e.handleTextTrackChange),e.handleTextTrackAdd_=s.bind(e,e.handleTextTrackAdd),e.handleTextTrackRemove_=s.bind(e,e.handleTextTrackRemove),e.proxyNativeTextTracks_()),e.restoreMetadataTracksInIOSNativePlayer_(),(y.TOUCH_ENABLED||y.IS_IPHONE||y.IS_NATIVE_ANDROID)&&!0===c.nativeControlsForTouch&&e.setControls(!0),e.proxyWebkitFullscreen_(),e.triggerReady(),e}return h(b,a),b.prototype.dispose=function(){var c=this;["audio","video","text"].forEach(function(a){var b=(0,H["default"])(a),d=c.el_[a+"Tracks"];d&&d.removeEventListener&&(d.removeEventListener("change",c["handle"+b+"TrackChange_"]),d.removeEventListener("addtrack",c["handle"+b+"TrackAdd_"]),d.removeEventListener("removetrack",c["handle"+b+"TrackRemove_"])),d&&c.off("loadstart",c["removeOld"+b+"Tracks_"])}),b.disposeMediaElement(this.el_),a.prototype.dispose.call(this)},b.prototype.restoreMetadataTracksInIOSNativePlayer_=function(){var a=this.textTracks(),b=void 0,c=function(){b=[];for(var c=0;c<a.length;c++){var d=a[c];"metadata"===d.kind&&b.push({track:d,storedMode:d.mode})}};c(),a.addEventListener("change",c);var d=function e(){for(var c=0;c<b.length;c++){var d=b[c];"disabled"===d.track.mode&&d.track.mode!==d.storedMode&&(d.track.mode=d.storedMode)}a.removeEventListener("change",e)};this.on("webkitbeginfullscreen",function(){a.removeEventListener("change",c),a.removeEventListener("change",d),a.addEventListener("change",d)}),this.on("webkitendfullscreen",function(){a.removeEventListener("change",c),a.addEventListener("change",c),a.removeEventListener("change",d)})},b.prototype.createEl=function(){var a=this.options_.tag;if(!a||!this.options_.playerElIngest&&!this.movingMediaElementInDOM){if(a){var c=a.cloneNode(!0);a.parentNode&&a.parentNode.insertBefore(c,a),b.disposeMediaElement(a),a=c}else{a=A["default"].createElement("video");var d=this.options_.tag&&o.getElAttributes(this.options_.tag),e=(0,F["default"])({},d);y.TOUCH_ENABLED&&!0===this.options_.nativeControlsForTouch||delete e.controls,o.setElAttributes(a,(0,D.assign)(e,{id:this.options_.techId,"class":"vjs-tech"}))}a.playerId=this.options_.playerId}"undefined"!=typeof this.options_.preload&&o.setAttribute(a,"preload",this.options_.preload);for(var f=["loop","muted","playsinline","autoplay"],g=f.length-1;g>=0;g--){var h=f[g],i=this.options_[h];void 0!==i&&(i?o.setAttribute(a,h,h):o.removeAttribute(a,h),a[h]=i)}return a},b.prototype.handleLateInit_=function(a){if(0!==a.networkState&&3!==a.networkState){if(0===a.readyState){var b=!1,c=function(){b=!0};this.on("loadstart",c);var d=function(){b||this.trigger("loadstart")};return this.on("loadedmetadata",d),void this.ready(function(){this.off("loadstart",c),this.off("loadedmetadata",d),b||this.trigger("loadstart")})}var e=["loadstart"];e.push("loadedmetadata"),a.readyState>=2&&e.push("loadeddata"),a.readyState>=3&&e.push("canplay"),a.readyState>=4&&e.push("canplaythrough"),this.ready(function(){e.forEach(function(a){this.trigger(a)},this)})}},b.prototype.proxyNativeTextTracks_=function(){var a=this.el().textTracks;if(a){for(var b=0;b<a.length;b++)this.textTracks().addTrack_(a[b]);a.addEventListener&&(a.addEventListener("change",this.handleTextTrackChange_),a.addEventListener("addtrack",this.handleTextTrackAdd_),a.addEventListener("removetrack",this.handleTextTrackRemove_)),this.on("loadstart",this.removeOldTextTracks_)}},b.prototype.handleTextTrackChange=function(a){var b=this.textTracks();this.textTracks().trigger({type:"change",target:b,currentTarget:b,srcElement:b})},b.prototype.handleTextTrackAdd=function(a){this.textTracks().addTrack_(a.track)},b.prototype.handleTextTrackRemove=function(a){this.textTracks().removeTrack_(a.track)},b.prototype.removeOldTracks_=function(a,b){var c=[];if(b){for(var d=0;d<a.length;d++){for(var e=a[d],f=!1,g=0;g<b.length;g++)if(b[g]===e){f=!0;break}f||c.push(e)}for(var h=0;h<c.length;h++){var i=c[h];a.removeTrack_(i)}}},b.prototype.removeOldTextTracks_=function(a){var b=this.textTracks(),c=this.el().textTracks;this.removeOldTracks_(b,c)},b.prototype.play=function(){var a=this.el_.play();a!==undefined&&"function"==typeof a.then&&a.then(null,function(a){})},b.prototype.setCurrentTime=function(a){try{this.el_.currentTime=a}catch(b){(0,u["default"])(b,"Video is not ready. (Video.js)")}},b.prototype.duration=function(){var a=this;if(this.el_.duration===Infinity&&y.IS_ANDROID&&y.IS_CHROME&&0===this.el_.currentTime){var b=function c(){a.el_.currentTime>0&&(a.el_.duration===Infinity&&a.trigger("durationchange"),a.off("timeupdate",c))};return this.on("timeupdate",b),NaN}return this.el_.duration||NaN},b.prototype.width=function(){return this.el_.offsetWidth},b.prototype.height=function(){return this.el_.offsetHeight},b.prototype.proxyWebkitFullscreen_=function(){var a=this;if("webkitDisplayingFullscreen"in this.el_){var b=function(){this.trigger("fullscreenchange",{isFullscreen:!1})},c=function(){"webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode&&(this.one("webkitendfullscreen",b),this.trigger("fullscreenchange",{isFullscreen:!0}))};this.on("webkitbeginfullscreen",c),this.on("dispose",function(){a.off("webkitbeginfullscreen",c),a.off("webkitendfullscreen",b)})}},b.prototype.supportsFullScreen=function(){if("function"==typeof this.el_.webkitEnterFullScreen){var a=C["default"].navigator&&C["default"].navigator.userAgent||"";if(/Android/.test(a)||!/Chrome|Mac OS X 10.5/.test(a))return!0}return!1},b.prototype.enterFullScreen=function(){var a=this.el_;a.paused&&a.networkState<=a.HAVE_METADATA?(this.el_.play(),this.setTimeout(function(){a.pause(),a.webkitEnterFullScreen()},0)):a.webkitEnterFullScreen()},b.prototype.exitFullScreen=function(){this.el_.webkitExitFullScreen()},b.prototype.src=function(a){if(a===undefined)return this.el_.src;this.setSrc(a)},b.prototype.reset=function(){b.resetMediaElement(this.el_)},b.prototype.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc},b.prototype.setControls=function(a){this.el_.controls=!!a},b.prototype.addTextTrack=function(b,c,d){return this.featuresNativeTextTracks?this.el_.addTextTrack(b,c,d):a.prototype.addTextTrack.call(this,b,c,d)},b.prototype.createRemoteTextTrack=function(b){if(!this.featuresNativeTextTracks)return a.prototype.createRemoteTextTrack.call(this,b);var c=A["default"].createElement("track");return b.kind&&(c.kind=b.kind),b.label&&(c.label=b.label),(b.language||b.srclang)&&(c.srclang=b.language||b.srclang),b["default"]&&(c["default"]=b["default"]),b.id&&(c.id=b.id),b.src&&(c.src=b.src),c},b.prototype.addRemoteTextTrack=function(b,c){var d=a.prototype.addRemoteTextTrack.call(this,b,c);return this.featuresNativeTextTracks&&this.el().appendChild(d),d},b.prototype.removeRemoteTextTrack=function(b){if(a.prototype.removeRemoteTextTrack.call(this,b),this.featuresNativeTextTracks)for(var c=this.$$("track"),d=c.length;d--;)b!==c[d]&&b!==c[d].track||this.el().removeChild(c[d])},b.prototype.getVideoPlaybackQuality=function(){if("function"==typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();var a={};return"undefined"!=typeof this.el().webkitDroppedFrameCount&&"undefined"!=typeof this.el().webkitDecodedFrameCount&&(a.droppedVideoFrames=this.el().webkitDroppedFrameCount,a.totalVideoFrames=this.el().webkitDecodedFrameCount),C["default"].performance&&"function"==typeof C["default"].performance.now?a.creationTime=C["default"].performance.now():C["default"].performance&&C["default"].performance.timing&&"number"==typeof C["default"].performance.timing.navigationStart&&(a.creationTime=C["default"].Date.now()-C["default"].performance.timing.navigationStart),a},b}(k["default"]);if(o.isReal()){I.TEST_VID=A["default"].createElement("video");var J=A["default"].createElement("track");J.kind="captions",J.srclang="en",J.label="English",I.TEST_VID.appendChild(J)}I.isSupported=function(){try{I.TEST_VID.volume=.5}catch(a){return!1}return!(!I.TEST_VID||!I.TEST_VID.canPlayType)},I.canControlVolume=function(){try{var a=I.TEST_VID.volume;return I.TEST_VID.volume=a/2+.1,a!==I.TEST_VID.volume}catch(b){return!1}},I.canControlPlaybackRate=function(){if(y.IS_ANDROID&&y.IS_CHROME&&y.CHROME_VERSION<58)return!1;try{var a=I.TEST_VID.playbackRate;return I.TEST_VID.playbackRate=a/2+.1,a!==I.TEST_VID.playbackRate}catch(b){return!1}},I.supportsNativeTextTracks=function(){return y.IS_ANY_SAFARI},I.supportsNativeVideoTracks=function(){return!(!I.TEST_VID||!I.TEST_VID.videoTracks)},I.supportsNativeAudioTracks=function(){return!(!I.TEST_VID||!I.TEST_VID.audioTracks)},I.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","volumechange"],I.prototype.featuresVolumeControl=I.canControlVolume(),I.prototype.featuresPlaybackRate=I.canControlPlaybackRate(),I.prototype.movingMediaElementInDOM=!y.IS_IOS,I.prototype.featuresFullscreenResize=!0,I.prototype.featuresProgressEvents=!0,I.prototype.featuresTimeupdateEvents=!0,I.prototype.featuresNativeTextTracks=I.supportsNativeTextTracks(),I.prototype.featuresNativeVideoTracks=I.supportsNativeVideoTracks(),I.prototype.featuresNativeAudioTracks=I.supportsNativeAudioTracks();var K=I.TEST_VID&&I.TEST_VID.constructor.prototype.canPlayType,L=/^application\/(?:x-|vnd\.apple\.)mpegurl/i,M=/^video\/mp4/i;I.patchCanPlayType=function(){y.ANDROID_VERSION>=4&&!y.IS_FIREFOX?I.TEST_VID.constructor.prototype.canPlayType=function(a){return a&&L.test(a)?"maybe":K.call(this,a)}:y.IS_OLD_ANDROID&&(I.TEST_VID.constructor.prototype.canPlayType=function(a){return a&&M.test(a)?"maybe":K.call(this,a)})},I.unpatchCanPlayType=function(){var a=I.TEST_VID.constructor.prototype.canPlayType;return I.TEST_VID.constructor.prototype.canPlayType=K,a},I.patchCanPlayType(),I.disposeMediaElement=function(a){if(a){for(a.parentNode&&a.parentNode.removeChild(a);a.hasChildNodes();)a.removeChild(a.firstChild);a.removeAttribute("src"),"function"==typeof a.load&&function(){try{a.load()}catch(b){}}()}},I.resetMediaElement=function(a){if(a){for(var b=a.querySelectorAll("source"),c=b.length;c--;)a.removeChild(b[c]);a.removeAttribute("src"),"function"==typeof a.load&&function(){try{a.load()}catch(b){}}()}},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(a){I.prototype[a]=function(){return this.el_[a]||this.el_.hasAttribute(a)}}),["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(a){I.prototype["set"+(0,H["default"])(a)]=function(b){this.el_[a]=b,b?this.el_.setAttribute(a,a):this.el_.removeAttribute(a)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","played","networkState","readyState","videoWidth","videoHeight"].forEach(function(a){I.prototype[a]=function(){return this.el_[a]}}),["volume","src","poster","preload","playbackRate"].forEach(function(a){I.prototype["set"+(0,H["default"])(a)]=function(b){this.el_[a]=b}}),["pause","load"].forEach(function(a){I.prototype[a]=function(){return this.el_[a]()}}),k["default"].withSourceHandlers(I),I.nativeSourceHandler={},I.nativeSourceHandler.canPlayType=function(a){try{return I.TEST_VID.canPlayType(a)}catch(b){return""}},I.nativeSourceHandler.canHandleSource=function(a,b){if(a.type)return I.nativeSourceHandler.canPlayType(a.type);if(a.src){var c=q.getFileExtension(a.src);return I.nativeSourceHandler.canPlayType("video/"+c)}return""},I.nativeSourceHandler.handleSource=function(a,b,c){b.setSrc(a.src)},I.nativeSourceHandler.dispose=function(){},I.registerSourceHandler(I.nativeSourceHandler),m["default"].registerComponent("Html5",I),k["default"].registerTech("Html5",I),c["default"]=I},{102:102,5:5,62:62,78:78,81:81,83:83,86:86,87:87,88:88,91:91,92:92,96:96,97:97}],61:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(5),i=d(h),j=a(62),k=d(j),l=a(91),m=d(l),n=function(a){function b(c,d,g){e(this,b);var h=f(this,a.call(this,c,d,g));if(d.playerOptions.sources&&0!==d.playerOptions.sources.length)c.src(d.playerOptions.sources);else for(var j=0,l=d.playerOptions.techOrder;j<l.length;j++){var n=(0,m["default"])(l[j]),o=k["default"].getTech(n);if(n||(o=i["default"].getComponent(n)),o&&o.isSupported()){c.loadTech_(n);break}}return h}return g(b,a),b}(i["default"]);i["default"].registerComponent("MediaLoader",n),c["default"]=n},{5:5,62:62,91:91}],62:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function h(a,b,c,d){var e=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{},f=a.textTracks();e.kind=b,c&&(e.label=c),d&&(e.language=d),e.tech=a;var g=new r["default"](e);return f.addTrack_(g),g}c.__esModule=!0;var i=a(5),j=d(i),k=a(66),l=d(k),m=a(65),n=d(m),o=a(87),p=d(o),q=a(72),r=d(q),s=a(70),t=d(s),u=a(76),v=d(u),w=a(63),x=d(w),y=a(83),z=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(y),A=a(86),B=d(A),C=a(90),D=a(79),E=a(46),F=d(E),G=a(97),H=d(G),I=a(96),J=d(I),K=a(88),L=function(b){function c(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},d=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(){};e(this,c),a.reportTouchActivity=!1;var g=f(this,b.call(this,null,a,d));return g.hasStarted_=!1,g.on("playing",function(){this.hasStarted_=!0}),g.on("loadstart",function(){this.hasStarted_=!1}),g.textTracks_=a.textTracks,g.videoTracks_=a.videoTracks,g.audioTracks_=a.audioTracks,g.featuresProgressEvents||g.manualProgressOn(),g.featuresTimeupdateEvents||g.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(function(b){
!1===a["native"+b+"Tracks"]&&(g["featuresNative"+b+"Tracks"]=!1)}),!1===a.nativeCaptions&&(g.featuresNativeTextTracks=!1),g.featuresNativeTextTracks||g.emulateTextTracks(),g.autoRemoteTextTracks_=new t["default"],g.initTextTrackListeners(),g.initTrackListeners(),a.nativeControlsForTouch||g.emitTapEvents(),g.constructor&&(g.name_=g.constructor.name||"Unknown Tech"),g}return g(c,b),c.prototype.manualProgressOn=function(){this.on("durationchange",this.onDurationChange),this.manualProgress=!0,this.one("ready",this.trackProgress)},c.prototype.manualProgressOff=function(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange)},c.prototype.trackProgress=function(a){this.stopTrackingProgress(),this.progressInterval=this.setInterval(z.bind(this,function(){var a=this.bufferedPercent();this.bufferedPercent_!==a&&this.trigger("progress"),this.bufferedPercent_=a,1===a&&this.stopTrackingProgress()}),500)},c.prototype.onDurationChange=function(a){this.duration_=this.duration()},c.prototype.buffered=function(){return(0,C.createTimeRange)(0,0)},c.prototype.bufferedPercent=function(){return(0,D.bufferedPercent)(this.buffered(),this.duration_)},c.prototype.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)},c.prototype.manualTimeUpdatesOn=function(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime),this.on("pause",this.stopTrackingCurrentTime)},c.prototype.manualTimeUpdatesOff=function(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime),this.off("pause",this.stopTrackingCurrentTime)},c.prototype.trackCurrentTime=function(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)},c.prototype.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},c.prototype.dispose=function(){this.clearTracks(["audio","video","text"]),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),b.prototype.dispose.call(this)},c.prototype.clearTracks=function(a){var b=this;a=[].concat(a),a.forEach(function(a){for(var c=b[a+"Tracks"]()||[],d=c.length;d--;){var e=c[d];"text"===a&&b.removeRemoteTextTrack(e),c.removeTrack_(e)}})},c.prototype.cleanupAutoTextTracks=function(){for(var a=this.autoRemoteTextTracks_||[],b=a.length;b--;){var c=a[b];this.removeRemoteTextTrack(c)}},c.prototype.reset=function(){},c.prototype.error=function(a){return a!==undefined&&(this.error_=new F["default"](a),this.trigger("error")),this.error_},c.prototype.played=function(){return this.hasStarted_?(0,C.createTimeRange)(0,0):(0,C.createTimeRange)()},c.prototype.setCurrentTime=function(){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},c.prototype.initTextTrackListeners=function(){var a=z.bind(this,function(){this.trigger("texttrackchange")}),b=this.textTracks();b&&(b.addEventListener("removetrack",a),b.addEventListener("addtrack",a),this.on("dispose",z.bind(this,function(){b.removeEventListener("removetrack",a),b.removeEventListener("addtrack",a)})))},c.prototype.initTrackListeners=function(){var a=this;["video","audio"].forEach(function(b){var c=function(){a.trigger(b+"trackchange")},d=a[b+"Tracks"]();d.addEventListener("removetrack",c),d.addEventListener("addtrack",c),a.on("dispose",function(){d.removeEventListener("removetrack",c),d.removeEventListener("addtrack",c)})})},c.prototype.addWebVttScript_=function(){var b=this;if(!H["default"].WebVTT)if(J["default"].body.contains(this.el())){var c=a(103);if(!this.options_["vtt.js"]&&(0,K.isPlain)(c)&&Object.keys(c).length>0)return void this.trigger("vttjsloaded");var d=J["default"].createElement("script");d.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.12.4/vtt.min.js",d.onload=function(){b.trigger("vttjsloaded")},d.onerror=function(){b.trigger("vttjserror")},this.on("dispose",function(){d.onload=null,d.onerror=null}),H["default"].WebVTT=!0,this.el().parentNode.appendChild(d)}else this.ready(this.addWebVttScript_)},c.prototype.emulateTextTracks=function(){var a=this,b=this.textTracks();if(b){var c=this.remoteTextTracks(),d=function(a){return b.addTrack_(a.track)},e=function(a){return b.removeTrack_(a.track)};c.on("addtrack",d),c.on("removetrack",e),this.addWebVttScript_();var f=function(){return a.trigger("texttrackchange")},g=function(){f();for(var a=0;a<b.length;a++){var c=b[a];c.removeEventListener("cuechange",f),"showing"===c.mode&&c.addEventListener("cuechange",f)}};g(),b.addEventListener("change",g),b.addEventListener("addtrack",g),b.addEventListener("removetrack",g),this.on("dispose",function(){c.off("addtrack",d),c.off("removetrack",e),b.removeEventListener("change",g),b.removeEventListener("addtrack",g),b.removeEventListener("removetrack",g);for(var a=0;a<b.length;a++){b[a].removeEventListener("cuechange",f)}})}},c.prototype.videoTracks=function(){return this.videoTracks_=this.videoTracks_||new v["default"],this.videoTracks_},c.prototype.audioTracks=function(){return this.audioTracks_=this.audioTracks_||new x["default"],this.audioTracks_},c.prototype.textTracks=function(){return this.textTracks_=this.textTracks_||new t["default"],this.textTracks_},c.prototype.remoteTextTracks=function(){return this.remoteTextTracks_=this.remoteTextTracks_||new t["default"],this.remoteTextTracks_},c.prototype.remoteTextTrackEls=function(){return this.remoteTextTrackEls_=this.remoteTextTrackEls_||new n["default"],this.remoteTextTrackEls_},c.prototype.addTextTrack=function(a,b,c){if(!a)throw new Error("TextTrack kind is required but was not provided");return h(this,a,b,c)},c.prototype.createRemoteTextTrack=function(a){var b=(0,p["default"])(a,{tech:this});return new l["default"](b)},c.prototype.addRemoteTextTrack=function(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},b=arguments[1],c=this.createRemoteTextTrack(a);return!0!==b&&!1!==b&&(B["default"].warn('Calling addRemoteTextTrack without explicitly setting the "manualCleanup" parameter to `true` is deprecated and default to `false` in future version of video.js'),b=!0),this.remoteTextTrackEls().addTrackElement_(c),this.remoteTextTracks().addTrack_(c.track),!0!==b&&this.autoRemoteTextTracks_.addTrack_(c.track),c},c.prototype.removeRemoteTextTrack=function(a){var b=this.remoteTextTrackEls().getTrackElementByTrack_(a);this.remoteTextTrackEls().removeTrackElement_(b),this.remoteTextTracks().removeTrack_(a),this.autoRemoteTextTracks_.removeTrack_(a)},c.prototype.getVideoPlaybackQuality=function(){return{}},c.prototype.setPoster=function(){},c.prototype.playsinline=function(){},c.prototype.setPlaysinline=function(){},c.prototype.canPlayType=function(){return""},c.isTech=function(a){return a.prototype instanceof c||a instanceof c||a===c},c.registerTech=function(a,b){if(c.techs_||(c.techs_={}),!c.isTech(b))throw new Error("Tech "+a+" must be a Tech");return c.techs_[a]=b,b},c.getTech=function(a){return c.techs_&&c.techs_[a]?c.techs_[a]:H["default"]&&H["default"].videojs&&H["default"].videojs[a]?(B["default"].warn("The "+a+" tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)"),H["default"].videojs[a]):void 0},c}(j["default"]);L.prototype.textTracks_,L.prototype.audioTracks_,L.prototype.videoTracks_,L.prototype.featuresVolumeControl=!0,L.prototype.featuresFullscreenResize=!1,L.prototype.featuresPlaybackRate=!1,L.prototype.featuresProgressEvents=!1,L.prototype.featuresTimeupdateEvents=!1,L.prototype.featuresNativeTextTracks=!1,L.withSourceHandlers=function(a){a.registerSourceHandler=function(b,c){var d=a.sourceHandlers;d||(d=a.sourceHandlers=[]),c===undefined&&(c=d.length),d.splice(c,0,b)},a.canPlayType=function(b){for(var c=a.sourceHandlers||[],d=void 0,e=0;e<c.length;e++)if(d=c[e].canPlayType(b))return d;return""},a.selectSourceHandler=function(b,c){for(var d=a.sourceHandlers||[],e=0;e<d.length;e++)if(d[e].canHandleSource(b,c))return d[e];return null},a.canPlaySource=function(b,c){var d=a.selectSourceHandler(b,c);return d?d.canHandleSource(b,c):""},["seekable","duration"].forEach(function(a){var b=this[a];"function"==typeof b&&(this[a]=function(){return this.sourceHandler_&&this.sourceHandler_[a]?this.sourceHandler_[a].apply(this.sourceHandler_,arguments):b.apply(this,arguments)})},a.prototype),a.prototype.setSource=function(b){var c=a.selectSourceHandler(b,this.options_);return c||(a.nativeSourceHandler?c=a.nativeSourceHandler:B["default"].error("No source hander found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler),c!==a.nativeSourceHandler&&(this.currentSource_=b,this.off(this.el_,"loadstart",a.prototype.firstLoadStartListener_),this.off(this.el_,"loadstart",a.prototype.successiveLoadStartListener_),this.one(this.el_,"loadstart",a.prototype.firstLoadStartListener_)),this.sourceHandler_=c.handleSource(b,this,this.options_),this.on("dispose",this.disposeSourceHandler),this},a.prototype.firstLoadStartListener_=function(){this.one(this.el_,"loadstart",a.prototype.successiveLoadStartListener_)},a.prototype.successiveLoadStartListener_=function(){this.disposeSourceHandler(),this.one(this.el_,"loadstart",a.prototype.successiveLoadStartListener_)},a.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.off(this.el_,"loadstart",a.prototype.firstLoadStartListener_),this.off(this.el_,"loadstart",a.prototype.successiveLoadStartListener_),this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},j["default"].registerComponent("Tech",L),j["default"].registerComponent("MediaTechController",L),L.registerTech("Tech",L),c["default"]=L},{103:103,46:46,5:5,63:63,65:65,66:66,70:70,72:72,76:76,79:79,83:83,86:86,87:87,88:88,90:90,96:96,97:97}],63:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(74),i=d(h),j=a(78),k=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(j),l=a(96),m=d(l),n=function(a,b){for(var c=0;c<a.length;c++)b.id!==a[c].id&&(a[c].enabled=!1)},o=function(a){function b(){var c,d,g=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];e(this,b);for(var h=void 0,j=g.length-1;j>=0;j--)if(g[j].enabled){n(g,g[j]);break}if(k.IS_IE8){h=m["default"].createElement("custom");for(var l in i["default"].prototype)"constructor"!==l&&(h[l]=i["default"].prototype[l]);for(var o in b.prototype)"constructor"!==o&&(h[o]=b.prototype[o])}return h=c=f(this,a.call(this,g,h)),h.changing_=!1,d=h,f(c,d)}return g(b,a),b.prototype.addTrack_=function(b){var c=this;b.enabled&&n(this,b),a.prototype.addTrack_.call(this,b),b.addEventListener&&b.addEventListener("enabledchange",function(){c.changing_||(c.changing_=!0,n(c,b),c.changing_=!1,c.trigger("change"))})},b.prototype.addTrack=function(a){this.addTrack_(a)},b.prototype.removeTrack=function(b){a.prototype.removeTrack_.call(this,b)},b}(i["default"]);c["default"]=o},{74:74,78:78,96:96}],64:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(73),i=a(75),j=d(i),k=a(87),l=d(k),m=a(78),n=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(m),o=function(a){function b(){var c,d,g=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};e(this,b);var i=(0,l["default"])(g,{kind:h.AudioTrackKind[g.kind]||""}),j=c=f(this,a.call(this,i)),k=!1;if(n.IS_IE8)for(var m in b.prototype)"constructor"!==m&&(j[m]=b.prototype[m]);return Object.defineProperty(j,"enabled",{get:function(){return k},set:function(a){"boolean"==typeof a&&a!==k&&(k=a,this.trigger("enabledchange"))}}),i.enabled&&(j.enabled=i.enabled),j.loaded_=!0,d=j,f(c,d)}return g(b,a),b}(j["default"]);c["default"]=o},{73:73,75:75,78:78,87:87}],65:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.__esModule=!0;var e=a(78),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(e),g=a(96),h=function(a){return a&&a.__esModule?a:{"default":a}}(g),i=function(){function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];d(this,a);var c=this;if(f.IS_IE8){c=h["default"].createElement("custom");for(var e in a.prototype)"constructor"!==e&&(c[e]=a.prototype[e])}c.trackElements_=[],Object.defineProperty(c,"length",{get:function(){return this.trackElements_.length}});for(var g=0,i=b.length;g<i;g++)c.addTrackElement_(b[g]);if(f.IS_IE8)return c}return a.prototype.addTrackElement_=function(a){var b=this.trackElements_.length;""+b in this||Object.defineProperty(this,b,{get:function(){return this.trackElements_[b]}}),-1===this.trackElements_.indexOf(a)&&this.trackElements_.push(a)},a.prototype.getTrackElementByTrack_=function(a){for(var b=void 0,c=0,d=this.trackElements_.length;c<d;c++)if(a===this.trackElements_[c].track){b=this.trackElements_[c];break}return b},a.prototype.removeTrackElement_=function(a){for(var b=0,c=this.trackElements_.length;b<c;b++)if(a===this.trackElements_[b]){this.trackElements_.splice(b,1);break}},a}();c["default"]=i},{78:78,96:96}],66:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(78),i=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(h),j=a(96),k=d(j),l=a(42),m=d(l),n=a(72),o=d(n),p=0,q=2,r=function(a){function b(){var c=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};e(this,b);var d=f(this,a.call(this)),g=void 0,h=d;if(i.IS_IE8){h=k["default"].createElement("custom");for(var j in b.prototype)"constructor"!==j&&(h[j]=b.prototype[j])}var l=new o["default"](c);if(h.kind=l.kind,h.src=l.src,h.srclang=l.language,h.label=l.label,h["default"]=l["default"],Object.defineProperty(h,"readyState",{get:function(){return g}}),Object.defineProperty(h,"track",{get:function(){return l}}),g=p,l.addEventListener("loadeddata",function(){g=q,h.trigger({type:"load",target:h})}),i.IS_IE8){var m;return m=h,f(d,m)}return d}return g(b,a),b}(m["default"]);r.prototype.allowedEvents_={load:"load"},r.NONE=p,r.LOADING=1,r.LOADED=q,r.ERROR=3,c["default"]=r},{42:42,72:72,78:78,96:96}],67:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.__esModule=!0;var e=a(78),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(e),g=a(96),h=function(a){return a&&a.__esModule?a:{"default":a}}(g),i=function(){function a(b){d(this,a);var c=this;if(f.IS_IE8){c=h["default"].createElement("custom");for(var e in a.prototype)"constructor"!==e&&(c[e]=a.prototype[e])}if(a.prototype.setCues_.call(c,b),Object.defineProperty(c,"length",{get:function(){return this.length_}}),f.IS_IE8)return c}return a.prototype.setCues_=function(a){var b=this.length||0,c=0,d=a.length;this.cues_=a,this.length_=a.length;var e=function(a){""+a in this||Object.defineProperty(this,""+a,{get:function(){return this.cues_[a]}})};if(b<d)for(c=b;c<d;c++)e.call(this,c)},a.prototype.getCueById=function(a){for(var b=null,c=0,d=this.length;c<d;c++){var e=this[c];if(e.id===a){b=e;break}}return b},a}();c["default"]=i},{78:78,96:96}],68:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function h(a,b){return"rgba("+parseInt(a[1]+a[1],16)+","+parseInt(a[2]+a[2],16)+","+parseInt(a[3]+a[3],16)+","+b+")"}function i(a,b,c){try{a.style[b]=c}catch(d){return}}c.__esModule=!0;var j=a(5),k=d(j),l=a(83),m=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(l),n=a(97),o=d(n),p={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'},q=function(a){function b(c,d,g){e(this,b);var h=f(this,a.call(this,c,d,g));return c.on("loadstart",m.bind(h,h.toggleDisplay)),c.on("texttrackchange",m.bind(h,h.updateDisplay)),c.ready(m.bind(h,function(){if(c.tech_&&c.tech_.featuresNativeTextTracks)return void this.hide();c.on("fullscreenchange",m.bind(this,this.updateDisplay));for(var a=this.options_.playerOptions.tracks||[],b=0;b<a.length;b++)this.player_.addRemoteTextTrack(a[b],!0);var d={captions:1,subtitles:1},e=this.player_.textTracks(),f=void 0,g=void 0;if(e){for(var h=0;h<e.length;h++){var i=e[h];i["default"]&&("descriptions"!==i.kind||f?i.kind in d&&!g&&(g=i):f=i)}g?g.mode="showing":f&&(f.mode="showing")}})),h}return g(b,a),b.prototype.toggleDisplay=function(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()},b.prototype.createEl=function(){return a.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"},{"aria-live":"off","aria-atomic":"true"})},b.prototype.clearDisplay=function(){"function"==typeof o["default"].WebVTT&&o["default"].WebVTT.processCues(o["default"],[],this.el_)},b.prototype.updateDisplay=function(){var a=this.player_.textTracks();if(this.clearDisplay(),a){for(var b=null,c=null,d=a.length;d--;){var e=a[d];"showing"===e.mode&&("descriptions"===e.kind?b=e:c=e)}c?("off"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","off"),this.updateForTrack(c)):b&&("assertive"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","assertive"),this.updateForTrack(b))}},b.prototype.updateForTrack=function(a){if("function"==typeof o["default"].WebVTT&&a.activeCues){for(var b=this.player_.textTrackSettings.getValues(),c=[],d=0;d<a.activeCues.length;d++)c.push(a.activeCues[d]);o["default"].WebVTT.processCues(o["default"],c,this.el_);for(var e=c.length;e--;){var f=c[e];if(f){var g=f.displayState;if(b.color&&(g.firstChild.style.color=b.color),b.textOpacity&&i(g.firstChild,"color",h(b.color||"#fff",b.textOpacity)),b.backgroundColor&&(g.firstChild.style.backgroundColor=b.backgroundColor),b.backgroundOpacity&&i(g.firstChild,"backgroundColor",h(b.backgroundColor||"#000",b.backgroundOpacity)),b.windowColor&&(b.windowOpacity?i(g,"backgroundColor",h(b.windowColor,b.windowOpacity)):g.style.backgroundColor=b.windowColor),b.edgeStyle&&("dropshadow"===b.edgeStyle?g.firstChild.style.textShadow="2px 2px 3px #222, 2px 2px 4px #222, 2px 2px 5px #222":"raised"===b.edgeStyle?g.firstChild.style.textShadow="1px 1px #222, 2px 2px #222, 3px 3px #222":"depressed"===b.edgeStyle?g.firstChild.style.textShadow="1px 1px #ccc, 0 1px #ccc, -1px -1px #222, 0 -1px #222":"uniform"===b.edgeStyle&&(g.firstChild.style.textShadow="0 0 4px #222, 0 0 4px #222, 0 0 4px #222, 0 0 4px #222")),b.fontPercent&&1!==b.fontPercent){var j=o["default"].parseFloat(g.style.fontSize);g.style.fontSize=j*b.fontPercent+"px",g.style.height="auto",g.style.top="auto",g.style.bottom="2px"}b.fontFamily&&"default"!==b.fontFamily&&("small-caps"===b.fontFamily?g.firstChild.style.fontVariant="small-caps":g.firstChild.style.fontFamily=p[b.fontFamily])}}}},b}(k["default"]);k["default"].registerComponent("TextTrackDisplay",q),c["default"]=q},{5:5,83:83,97:97}],69:[function(a,b,c){"use strict";c.__esModule=!0;var d=function(a){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(function(b,c,d){return a[c]&&(b[c]=a[c]),b},{cues:a.cues&&Array.prototype.map.call(a.cues,function(a){return{startTime:a.startTime,endTime:a.endTime,text:a.text,id:a.id}})})},e=function(a){var b=a.$$("track"),c=Array.prototype.map.call(b,function(a){return a.track});return Array.prototype.map.call(b,function(a){var b=d(a.track);return a.src&&(b.src=a.src),b}).concat(Array.prototype.filter.call(a.textTracks(),function(a){return-1===c.indexOf(a)}).map(d))},f=function(a,b){return a.forEach(function(a){var c=b.addRemoteTextTrack(a).track;!a.src&&a.cues&&a.cues.forEach(function(a){return c.addCue(a)})}),b.textTracks()};c["default"]={textTracksToJson:e,jsonToTextTracks:f,trackToJson_:d}},{}],70:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var i=a(74),j=e(i),k=a(83),l=d(k),m=a(78),n=d(m),o=a(96),p=e(o),q=function(a){function b(){var c,d,e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];f(this,b);var h=void 0;if(n.IS_IE8){h=p["default"].createElement("custom");for(var i in j["default"].prototype)"constructor"!==i&&(h[i]=j["default"].prototype[i]);for(var k in b.prototype)"constructor"!==k&&(h[k]=b.prototype[k])}return h=c=g(this,a.call(this,e,h)),d=h,g(c,d)}return h(b,a),b.prototype.addTrack_=function(b){a.prototype.addTrack_.call(this,b),b.addEventListener("modechange",l.bind(this,function(){this.trigger("change")}))},b}(j["default"]);c["default"]=q},{74:74,78:78,83:83,96:96}],71:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function i(a,b){if(b&&(a=b(a)),a&&"none"!==a)return a}function j(a,b){return i(a.options[a.options.selectedIndex].value,b)}function k(a,b,c){if(b)for(var d=0;d<a.options.length;d++)if(i(a.options[d].value,c)===b){a.selectedIndex=d;break}}c.__esModule=!0;var l=a(97),m=e(l),n=a(5),o=e(n),p=a(81),q=a(83),r=d(q),s=a(88),t=d(s),u=a(86),v=e(u),w=["#000","Black"],x=["#00F","Blue"],y=["#0FF","Cyan"],z=["#0F0","Green"],A=["#F0F","Magenta"],B=["#F00","Red"],C=["#FFF","White"],D=["#FF0","Yellow"],E=["1","Opaque"],F=["0.5","Semi-Transparent"],G=["0","Transparent"],H={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[w,C,B,z,x,D,A,y]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Transparency",options:[E,F,G]},color:{selector:".vjs-fg-color > select",id:"captions-foreground-color-%s",label:"Color",options:[C,w,B,z,x,D,A,y]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],"default":2,parser:function(a){return"1.00"===a?null:Number(a)}},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Transparency",options:[E,F]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Transparency",options:[G,F,E]}};H.windowColor.options=H.backgroundColor.options;var I=function(a){function b(c,d){f(this,b);var e=g(this,a.call(this,c,d));return e.setDefaults(),e.hide(),e.updateDisplay=r.bind(e,e.updateDisplay),d.persistTextTrackSettings===undefined&&(e.options_.persistTextTrackSettings=e.options_.playerOptions.persistTextTrackSettings),e.on(e.$(".vjs-done-button"),"click",function(){e.saveSettings(),e.hide()}),e.on(e.$(".vjs-default-button"),"click",function(){e.setDefaults(),e.updateDisplay()}),t.each(H,function(a){e.on(e.$(a.selector),"change",e.updateDisplay)}),e.options_.persistTextTrackSettings&&e.restoreSettings(),e}return h(b,a),b.prototype.createElSelect_=function(a){var b=this,c=H[a],d=c.id.replace("%s",this.id_);return[(0,p.createEl)("label",{className:"vjs-label",textContent:c.label},{"for":d}),(0,p.createEl)("select",{id:d},undefined,c.options.map(function(a){return(0,p.createEl)("option",{textContent:b.localize(a[1]),value:a[0]})}))]},b.prototype.createElFgColor_=function(){var a=(0,p.createEl)("legend",{textContent:this.localize("Text")}),b=this.createElSelect_("color"),c=(0,p.createEl)("span",{className:"vjs-text-opacity vjs-opacity"},undefined,this.createElSelect_("textOpacity"));return(0,p.createEl)("fieldset",{className:"vjs-fg-color vjs-tracksetting"},undefined,[a].concat(b,c))},b.prototype.createElBgColor_=function(){var a=(0,p.createEl)("legend",{textContent:this.localize("Background")}),b=this.createElSelect_("backgroundColor"),c=(0,p.createEl)("span",{className:"vjs-bg-opacity vjs-opacity"},undefined,this.createElSelect_("backgroundOpacity"));return(0,p.createEl)("fieldset",{className:"vjs-bg-color vjs-tracksetting"},undefined,[a].concat(b,c))},b.prototype.createElWinColor_=function(){var a=(0,p.createEl)("legend",{textContent:this.localize("Window")}),b=this.createElSelect_("windowColor"),c=(0,p.createEl)("span",{className:"vjs-window-opacity vjs-opacity"},undefined,this.createElSelect_("windowOpacity"));return(0,p.createEl)("fieldset",{className:"vjs-window-color vjs-tracksetting"},undefined,[a].concat(b,c))},b.prototype.createElColors_=function(){return(0,p.createEl)("div",{className:"vjs-tracksettings-colors"},undefined,[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()])},b.prototype.createElFont_=function(){var a=(0,p.createEl)("div",{className:"vjs-font-percent vjs-tracksetting"},undefined,this.createElSelect_("fontPercent")),b=(0,p.createEl)("div",{className:"vjs-edge-style vjs-tracksetting"},undefined,this.createElSelect_("edgeStyle")),c=(0,p.createEl)("div",{className:"vjs-font-family vjs-tracksetting"},undefined,this.createElSelect_("fontFamily"));return(0,p.createEl)("div",{className:"vjs-tracksettings-font"},undefined,[a,b,c])},b.prototype.createElControls_=function(){var a=(0,p.createEl)("button",{className:"vjs-default-button",textContent:this.localize("Defaults")}),b=(0,p.createEl)("button",{className:"vjs-done-button",textContent:"Done"});return(0,p.createEl)("div",{className:"vjs-tracksettings-controls"},undefined,[a,b])},b.prototype.createEl=function(){var a=(0,p.createEl)("div",{className:"vjs-tracksettings"},undefined,[this.createElColors_(),this.createElFont_(),this.createElControls_()]),b=(0,p.createEl)("div",{className:"vjs-control-text",id:"TTsettingsDialogLabel-"+this.id_,textContent:"Caption Settings Dialog"},{"aria-level":"1",role:"heading"}),c=(0,p.createEl)("div",{className:"vjs-control-text",id:"TTsettingsDialogDescription-"+this.id_,textContent:"Beginning of dialog window. Escape will cancel and close the window."}),d=(0,p.createEl)("div",undefined,{role:"document"},[b,c,a]);return(0,p.createEl)("div",{className:"vjs-caption-settings vjs-modal-overlay",tabIndex:-1},{role:"dialog","aria-labelledby":b.id,"aria-describedby":c.id},d)},b.prototype.getValues=function(){var a=this;return t.reduce(H,function(b,c,d){var e=j(a.$(c.selector),c.parser);return e!==undefined&&(b[d]=e),b},{})},b.prototype.setValues=function(a){var b=this;t.each(H,function(c,d){k(b.$(c.selector),a[d],c.parser)})},b.prototype.setDefaults=function(){var a=this;t.each(H,function(b){var c=b.hasOwnProperty("default")?b["default"]:0;a.$(b.selector).selectedIndex=c})},b.prototype.restoreSettings=function(){var a=void 0;try{a=JSON.parse(m["default"].localStorage.getItem("vjs-text-track-settings"))}catch(b){v["default"].warn(b)}a&&this.setValues(a)},b.prototype.saveSettings=function(){if(this.options_.persistTextTrackSettings){var a=this.getValues();try{
Object.keys(a).length?m["default"].localStorage.setItem("vjs-text-track-settings",JSON.stringify(a)):m["default"].localStorage.removeItem("vjs-text-track-settings")}catch(b){v["default"].warn(b)}}},b.prototype.updateDisplay=function(){var a=this.player_.getChild("textTrackDisplay");a&&a.updateDisplay()},b}(o["default"]);o["default"].registerComponent("TextTrackSettings",I),c["default"]=I},{5:5,81:81,83:83,86:86,88:88,97:97}],72:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var i=a(67),j=e(i),k=a(83),l=d(k),m=a(73),n=a(86),o=e(n),p=a(97),q=e(p),r=a(75),s=e(r),t=a(92),u=a(108),v=e(u),w=a(87),x=e(w),y=a(78),z=d(y),A=function(a,b){var c=new q["default"].WebVTT.Parser(q["default"],q["default"].vttjs,q["default"].WebVTT.StringDecoder()),d=[];c.oncue=function(a){b.addCue(a)},c.onparsingerror=function(a){d.push(a)},c.onflush=function(){b.trigger({type:"loadeddata",target:b})},c.parse(a),d.length>0&&(q["default"].console&&q["default"].console.groupCollapsed&&q["default"].console.groupCollapsed("Text Track parsing errors for "+b.src),d.forEach(function(a){return o["default"].error(a)}),q["default"].console&&q["default"].console.groupEnd&&q["default"].console.groupEnd()),c.flush()},B=function(a,b){var c={uri:a},d=(0,t.isCrossOrigin)(a);d&&(c.cors=d),(0,v["default"])(c,l.bind(this,function(a,c,d){if(a)return o["default"].error(a,c);if(b.loaded_=!0,"function"!=typeof q["default"].WebVTT){if(b.tech_){var e=function(){return A(d,b)};b.tech_.on("vttjsloaded",e),b.tech_.on("vttjserror",function(){o["default"].error("vttjs failed to load, stopping trying to process "+b.src),b.tech_.off("vttjsloaded",e)})}}else A(d,b)}))},C=function(a){function b(){var c,d,e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(f(this,b),!e.tech)throw new Error("A tech was not provided.");var h=(0,x["default"])(e,{kind:m.TextTrackKind[e.kind]||"subtitles",language:e.language||e.srclang||""}),i=m.TextTrackMode[h.mode]||"disabled",k=h["default"];"metadata"!==h.kind&&"chapters"!==h.kind||(i="hidden");var n=c=g(this,a.call(this,h));if(n.tech_=h.tech,z.IS_IE8)for(var o in b.prototype)"constructor"!==o&&(n[o]=b.prototype[o]);n.cues_=[],n.activeCues_=[];var p=new j["default"](n.cues_),q=new j["default"](n.activeCues_),r=!1,s=l.bind(n,function(){this.activeCues,r&&(this.trigger("cuechange"),r=!1)});return"disabled"!==i&&n.tech_.ready(function(){n.tech_.on("timeupdate",s)},!0),Object.defineProperty(n,"default",{get:function(){return k},set:function(){}}),Object.defineProperty(n,"mode",{get:function(){return i},set:function(a){var b=this;m.TextTrackMode[a]&&(i=a,"showing"===i&&this.tech_.ready(function(){b.tech_.on("timeupdate",s)},!0),this.trigger("modechange"))}}),Object.defineProperty(n,"cues",{get:function(){return this.loaded_?p:null},set:function(){}}),Object.defineProperty(n,"activeCues",{get:function(){if(!this.loaded_)return null;if(0===this.cues.length)return q;for(var a=this.tech_.currentTime(),b=[],c=0,d=this.cues.length;c<d;c++){var e=this.cues[c];e.startTime<=a&&e.endTime>=a?b.push(e):e.startTime===e.endTime&&e.startTime<=a&&e.startTime+.5>=a&&b.push(e)}if(r=!1,b.length!==this.activeCues_.length)r=!0;else for(var f=0;f<b.length;f++)-1===this.activeCues_.indexOf(b[f])&&(r=!0);return this.activeCues_=b,q.setCues_(this.activeCues_),q},set:function(){}}),h.src?(n.src=h.src,B(h.src,n)):n.loaded_=!0,d=n,g(c,d)}return h(b,a),b.prototype.addCue=function(a){var b=a;if(q["default"].vttjs&&!(a instanceof q["default"].vttjs.VTTCue)){b=new q["default"].vttjs.VTTCue(a.startTime,a.endTime,a.text);for(var c in a)c in b||(b[c]=a[c]);b.id=a.id,b.originalCue_=a}var d=this.tech_.textTracks();if(d)for(var e=0;e<d.length;e++)d[e]!==this&&d[e].removeCue(b);this.cues_.push(b),this.cues.setCues_(this.cues_)},b.prototype.removeCue=function(a){for(var b=this.cues_.length;b--;){var c=this.cues_[b];if(c===a||c.originalCue_&&c.originalCue_===a){this.cues_.splice(b,1),this.cues.setCues_(this.cues_);break}}},b}(s["default"]);C.prototype.allowedEvents_={cuechange:"cuechange"},c["default"]=C},{108:108,67:67,73:73,75:75,78:78,83:83,86:86,87:87,92:92,97:97}],73:[function(a,b,c){"use strict";c.__esModule=!0;c.VideoTrackKind={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},c.AudioTrackKind={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},c.TextTrackKind={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},c.TextTrackMode={disabled:"disabled",hidden:"hidden",showing:"showing"}},{}],74:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(42),i=d(h),j=a(78),k=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(j),l=a(96),m=d(l),n=function(a){function b(){var c,d=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[],g=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;e(this,b);var h=f(this,a.call(this));if(!g&&(g=h,k.IS_IE8)){g=m["default"].createElement("custom");for(var i in b.prototype)"constructor"!==i&&(g[i]=b.prototype[i])}g.tracks_=[],Object.defineProperty(g,"length",{get:function(){return this.tracks_.length}});for(var j=0;j<d.length;j++)g.addTrack_(d[j]);return c=g,f(h,c)}return g(b,a),b.prototype.addTrack_=function(a){var b=this.tracks_.length;""+b in this||Object.defineProperty(this,b,{get:function(){return this.tracks_[b]}}),-1===this.tracks_.indexOf(a)&&(this.tracks_.push(a),this.trigger({track:a,type:"addtrack"}))},b.prototype.removeTrack_=function(a){for(var b=void 0,c=0,d=this.length;c<d;c++)if(this[c]===a){b=this[c],b.off&&b.off(),this.tracks_.splice(c,1);break}b&&this.trigger({track:b,type:"removetrack"})},b.prototype.getTrackById=function(a){for(var b=null,c=0,d=this.length;c<d;c++){var e=this[c];if(e.id===a){b=e;break}}return b},b}(i["default"]);n.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack"};for(var o in n.prototype.allowedEvents_)n.prototype["on"+o]=null;c["default"]=n},{42:42,78:78,96:96}],75:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var i=a(78),j=e(i),k=a(96),l=d(k),m=a(85),n=e(m),o=a(42),p=d(o),q=function(a){function b(){var c,d=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};f(this,b);var e=g(this,a.call(this)),h=e;if(j.IS_IE8){h=l["default"].createElement("custom");for(var i in b.prototype)"constructor"!==i&&(h[i]=b.prototype[i])}var k={id:d.id||"vjs_track_"+n.newGUID(),kind:d.kind||"",label:d.label||"",language:d.language||""};for(var m in k)!function(a){Object.defineProperty(h,a,{get:function(){return k[a]},set:function(){}})}(m);return c=h,g(e,c)}return h(b,a),b}(p["default"]);c["default"]=q},{42:42,78:78,85:85,96:96}],76:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(74),i=d(h),j=a(78),k=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(j),l=a(96),m=d(l),n=function(a,b){for(var c=0;c<a.length;c++)b.id!==a[c].id&&(a[c].selected=!1)},o=function(a){function b(){var c,d,g=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];e(this,b);for(var h=void 0,j=g.length-1;j>=0;j--)if(g[j].selected){n(g,g[j]);break}if(k.IS_IE8){h=m["default"].createElement("custom");for(var l in i["default"].prototype)"constructor"!==l&&(h[l]=i["default"].prototype[l]);for(var o in b.prototype)"constructor"!==o&&(h[o]=b.prototype[o])}return h=c=f(this,a.call(this,g,h)),h.changing_=!1,Object.defineProperty(h,"selectedIndex",{get:function(){for(var a=0;a<this.length;a++)if(this[a].selected)return a;return-1},set:function(){}}),d=h,f(c,d)}return g(b,a),b.prototype.addTrack_=function(b){var c=this;b.selected&&n(this,b),a.prototype.addTrack_.call(this,b),b.addEventListener&&b.addEventListener("selectedchange",function(){c.changing_||(c.changing_=!0,n(c,b),c.changing_=!1,c.trigger("change"))})},b.prototype.addTrack=function(a){this.addTrack_(a)},b.prototype.removeTrack=function(b){a.prototype.removeTrack_.call(this,b)},b}(i["default"]);c["default"]=o},{74:74,78:78,96:96}],77:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a(73),i=a(75),j=d(i),k=a(87),l=d(k),m=a(78),n=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(m),o=function(a){function b(){var c,d,g=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};e(this,b);var i=(0,l["default"])(g,{kind:h.VideoTrackKind[g.kind]||""}),j=c=f(this,a.call(this,i)),k=!1;if(n.IS_IE8)for(var m in b.prototype)"constructor"!==m&&(j[m]=b.prototype[m]);return Object.defineProperty(j,"selected",{get:function(){return k},set:function(a){"boolean"==typeof a&&a!==k&&(k=a,this.trigger("selectedchange"))}}),i.selected&&(j.selected=i.selected),d=j,f(c,d)}return g(b,a),b}(j["default"]);c["default"]=o},{73:73,75:75,78:78,87:87}],78:[function(a,b,c){"use strict";c.__esModule=!0,c.BACKGROUND_SIZE_SUPPORTED=c.TOUCH_ENABLED=c.IS_ANY_SAFARI=c.IS_SAFARI=c.IE_VERSION=c.IS_IE8=c.CHROME_VERSION=c.IS_CHROME=c.IS_EDGE=c.IS_FIREFOX=c.IS_NATIVE_ANDROID=c.IS_OLD_ANDROID=c.ANDROID_VERSION=c.IS_ANDROID=c.IOS_VERSION=c.IS_IOS=c.IS_IPOD=c.IS_IPHONE=c.IS_IPAD=undefined;var d=a(81),e=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(d),f=a(97),g=function(a){return a&&a.__esModule?a:{"default":a}}(f),h=g["default"].navigator&&g["default"].navigator.userAgent||"",i=/AppleWebKit\/([\d.]+)/i.exec(h),j=i?parseFloat(i.pop()):null,k=c.IS_IPAD=/iPad/i.test(h),l=c.IS_IPHONE=/iPhone/i.test(h)&&!k,m=c.IS_IPOD=/iPod/i.test(h),n=c.IS_IOS=l||k||m,o=(c.IOS_VERSION=function(){var a=h.match(/OS (\d+)_/i);return a&&a[1]?a[1]:null}(),c.IS_ANDROID=/Android/i.test(h)),p=c.ANDROID_VERSION=function(){var a=h.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!a)return null;var b=a[1]&&parseFloat(a[1]),c=a[2]&&parseFloat(a[2]);return b&&c?parseFloat(a[1]+"."+a[2]):b||null}(),q=(c.IS_OLD_ANDROID=o&&/webkit/i.test(h)&&p<2.3,c.IS_NATIVE_ANDROID=o&&p<5&&j<537,c.IS_FIREFOX=/Firefox/i.test(h),c.IS_EDGE=/Edge/i.test(h)),r=c.IS_CHROME=!q&&/Chrome/i.test(h),s=(c.CHROME_VERSION=function(){var a=h.match(/Chrome\/(\d+)/);return a&&a[1]?parseFloat(a[1]):null}(),c.IS_IE8=/MSIE\s8\.0/.test(h),c.IE_VERSION=function(){var a=/MSIE\s(\d+)\.\d/.exec(h),b=a&&parseFloat(a[1]);return!b&&/Trident\/7.0/i.test(h)&&/rv:11.0/.test(h)&&(b=11),b}(),c.IS_SAFARI=/Safari/i.test(h)&&!r&&!o&&!q);c.IS_ANY_SAFARI=s||n,c.TOUCH_ENABLED=e.isReal()&&("ontouchstart"in g["default"]||g["default"].DocumentTouch&&g["default"].document instanceof g["default"].DocumentTouch),c.BACKGROUND_SIZE_SUPPORTED=e.isReal()&&"backgroundSize"in g["default"].document.createElement("video").style},{81:81,97:97}],79:[function(a,b,c){"use strict";function d(a,b){var c=0,d=void 0,f=void 0;if(!b)return 0;a&&a.length||(a=(0,e.createTimeRange)(0,0));for(var g=0;g<a.length;g++)d=a.start(g),f=a.end(g),f>b&&(f=b),c+=f-d;return c/b}c.__esModule=!0,c.bufferedPercent=d;var e=a(90)},{90:90}],80:[function(a,b,c){"use strict";function d(a,b){if(!a||!b)return"";if("function"==typeof f["default"].getComputedStyle){var c=f["default"].getComputedStyle(a);return c?c[b]:""}return a.currentStyle[b]||""}c.__esModule=!0,c["default"]=d;var e=a(97),f=function(a){return a&&a.__esModule?a:{"default":a}}(e)},{97:97}],81:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){return"string"==typeof a&&/\S/.test(a)}function f(a){if(/\s/.test(a))throw new Error("class has illegal whitespace characters")}function g(a){return new RegExp("(^|\\s)"+a+"($|\\s)")}function h(){return L["default"]===N["default"].document&&"undefined"!=typeof L["default"].createElement}function i(a){return(0,U.isObject)(a)&&1===a.nodeType}function j(a){return function(b,c){if(!e(b))return L["default"][a](null);e(c)&&(c=L["default"].querySelector(c));var d=i(c)?c:L["default"];return d[a]&&d[a](b)}}function k(a){return 0===a.indexOf("#")&&(a=a.slice(1)),L["default"].getElementById(a)}function l(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"div",b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},d=arguments[3],e=L["default"].createElement(a);return Object.getOwnPropertyNames(b).forEach(function(a){var c=b[a];-1!==a.indexOf("aria-")||"role"===a||"type"===a?(R["default"].warn((0,T["default"])(J,a,c)),e.setAttribute(a,c)):"textContent"===a?m(e,c):e[a]=c}),Object.getOwnPropertyNames(c).forEach(function(a){e.setAttribute(a,c[a])}),d&&H(e,d),e}function m(a,b){return"undefined"==typeof a.textContent?a.innerText=b:a.textContent=b,a}function n(a,b){b.firstChild?b.insertBefore(a,b.firstChild):b.appendChild(a)}function o(a){var b=a[W];return b||(b=a[W]=P.newGUID()),V[b]||(V[b]={}),V[b]}function p(a){var b=a[W];return!!b&&!!Object.getOwnPropertyNames(V[b]).length}function q(a){var b=a[W];if(b){delete V[b];try{delete a[W]}catch(c){a.removeAttribute?a.removeAttribute(W):a[W]=null}}}function r(a,b){return f(b),a.classList?a.classList.contains(b):g(b).test(a.className)}function s(a,b){return a.classList?a.classList.add(b):r(a,b)||(a.className=(a.className+" "+b).trim()),a}function t(a,b){return a.classList?a.classList.remove(b):(f(b),a.className=a.className.split(/\s+/).filter(function(a){return a!==b}).join(" ")),a}function u(a,b,c){var d=r(a,b);if("function"==typeof c&&(c=c(a,b)),"boolean"!=typeof c&&(c=!d),c!==d)return c?s(a,b):t(a,b),a}function v(a,b){Object.getOwnPropertyNames(b).forEach(function(c){var d=b[c];null===d||void 0===d||!1===d?a.removeAttribute(c):a.setAttribute(c,!0===d?"":d)})}function w(a){var b={};if(a&&a.attributes&&a.attributes.length>0)for(var c=a.attributes,d=c.length-1;d>=0;d--){var e=c[d].name,f=c[d].value;"boolean"!=typeof a[e]&&-1===",autoplay,controls,playsinline,loop,muted,default,defaultMuted,".indexOf(","+e+",")||(f=null!==f),b[e]=f}return b}function x(a,b){return a.getAttribute(b)}function y(a,b,c){a.setAttribute(b,c)}function z(a,b){a.removeAttribute(b)}function A(){L["default"].body.focus(),L["default"].onselectstart=function(){return!1}}function B(){L["default"].onselectstart=function(){return!0}}function C(a){var b=void 0;if(a.getBoundingClientRect&&a.parentNode&&(b=a.getBoundingClientRect()),!b)return{left:0,top:0};var c=L["default"].documentElement,d=L["default"].body,e=c.clientLeft||d.clientLeft||0,f=N["default"].pageXOffset||d.scrollLeft,g=b.left+f-e,h=c.clientTop||d.clientTop||0,i=N["default"].pageYOffset||d.scrollTop,j=b.top+i-h;return{left:Math.round(g),top:Math.round(j)}}function D(a,b){var c={},d=C(a),e=a.offsetWidth,f=a.offsetHeight,g=d.top,h=d.left,i=b.pageY,j=b.pageX;return b.changedTouches&&(j=b.changedTouches[0].pageX,i=b.changedTouches[0].pageY),c.y=Math.max(0,Math.min(1,(g-i+f)/f)),c.x=Math.max(0,Math.min(1,(j-h)/e)),c}function E(a){return(0,U.isObject)(a)&&3===a.nodeType}function F(a){for(;a.firstChild;)a.removeChild(a.firstChild);return a}function G(a){return"function"==typeof a&&(a=a()),(Array.isArray(a)?a:[a]).map(function(a){return"function"==typeof a&&(a=a()),i(a)||E(a)?a:"string"==typeof a&&/\S/.test(a)?L["default"].createTextNode(a):void 0}).filter(function(a){return a})}function H(a,b){return G(b).forEach(function(b){return a.appendChild(b)}),a}function I(a,b){return H(F(a),b)}c.__esModule=!0,c.$$=c.$=undefined;var J=function(a,b){return a.raw=b,a}(["Setting attributes in the second argument of createEl()\n                has been deprecated. Use the third argument instead.\n                createEl(type, properties, attributes). Attempting to set "," to ","."],["Setting attributes in the second argument of createEl()\n                has been deprecated. Use the third argument instead.\n                createEl(type, properties, attributes). Attempting to set "," to ","."]);c.isReal=h,c.isEl=i,c.getEl=k,c.createEl=l,c.textContent=m,c.insertElFirst=n,c.getElData=o,c.hasElData=p,c.removeElData=q,c.hasElClass=r,c.addElClass=s,c.removeElClass=t,c.toggleElClass=u,c.setElAttributes=v,c.getElAttributes=w,c.getAttribute=x,c.setAttribute=y,c.removeAttribute=z,c.blockTextSelection=A,c.unblockTextSelection=B,c.findElPosition=C,c.getPointerPosition=D,c.isTextNode=E,c.emptyEl=F,c.normalizeContent=G,c.appendContent=H,c.insertContent=I;var K=a(96),L=d(K),M=a(97),N=d(M),O=a(85),P=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}(O),Q=a(86),R=d(Q),S=a(102),T=d(S),U=a(88),V={},W="vdata"+(new Date).getTime();c.$=j("querySelector"),c.$$=j("querySelectorAll")},{102:102,85:85,86:86,88:88,96:96,97:97}],82:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function f(a,b){var c=n.getElData(a);0===c.handlers[b].length&&(delete c.handlers[b],a.removeEventListener?a.removeEventListener(b,c.dispatcher,!1):a.detachEvent&&a.detachEvent("on"+b,c.dispatcher)),Object.getOwnPropertyNames(c.handlers).length<=0&&(delete c.handlers,delete c.dispatcher,delete c.disabled),0===Object.getOwnPropertyNames(c).length&&n.removeElData(a)}function g(a,b,c,d){c.forEach(function(c){a(b,c,d)})}function h(a){function b(){return!0}function c(){return!1}if(!a||!a.isPropagationStopped){var d=a||t["default"].event;a={};for(var e in d)"layerX"!==e&&"layerY"!==e&&"keyLocation"!==e&&"webkitMovementX"!==e&&"webkitMovementY"!==e&&("returnValue"===e&&d.preventDefault||(a[e]=d[e]));if(a.target||(a.target=a.srcElement||v["default"]),a.relatedTarget||(a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement),a.preventDefault=function(){d.preventDefault&&d.preventDefault(),a.returnValue=!1,d.returnValue=!1,a.defaultPrevented=!0},a.defaultPrevented=!1,a.stopPropagation=function(){d.stopPropagation&&d.stopPropagation(),a.cancelBubble=!0,d.cancelBubble=!0,a.isPropagationStopped=b},a.isPropagationStopped=c,a.stopImmediatePropagation=function(){d.stopImmediatePropagation&&d.stopImmediatePropagation(),a.isImmediatePropagationStopped=b,a.stopPropagation()},a.isImmediatePropagationStopped=c,null!==a.clientX&&a.clientX!==undefined){var f=v["default"].documentElement,g=v["default"].body;a.pageX=a.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=a.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)}a.which=a.charCode||a.keyCode,null!==a.button&&a.button!==undefined&&(a.button=1&a.button?0:4&a.button?1:2&a.button?2:0)}return a}function i(a,b,c){if(Array.isArray(b))return g(i,a,b,c);var d=n.getElData(a);if(d.handlers||(d.handlers={}),d.handlers[b]||(d.handlers[b]=[]),c.guid||(c.guid=p.newGUID()),d.handlers[b].push(c),d.dispatcher||(d.disabled=!1,d.dispatcher=function(b,c){if(!d.disabled){b=h(b);var e=d.handlers[b.type];if(e)for(var f=e.slice(0),g=0,i=f.length;g<i&&!b.isImmediatePropagationStopped();g++)try{f[g].call(a,b,c)}catch(j){r["default"].error(j)}}}),1===d.handlers[b].length)if(a.addEventListener){var e=!1;w&&x.indexOf(b)>-1&&(e={passive:!0}),a.addEventListener(b,d.dispatcher,e)}else a.attachEvent&&a.attachEvent("on"+b,d.dispatcher)}function j(a,b,c){if(n.hasElData(a)){var d=n.getElData(a);if(d.handlers){if(Array.isArray(b))return g(j,a,b,c);var e=function(b){d.handlers[b]=[],f(a,b)};if(b){var h=d.handlers[b];if(h){if(!c)return void e(b);if(c.guid)for(var i=0;i<h.length;i++)h[i].guid===c.guid&&h.splice(i--,1);f(a,b)}}else for(var k in d.handlers)e(k)}}}function k(a,b,c){var d=n.hasElData(a)?n.getElData(a):{},e=a.parentNode||a.ownerDocument;if("string"==typeof b&&(b={type:b,target:a}),b=h(b),d.dispatcher&&d.dispatcher.call(a,b,c),e&&!b.isPropagationStopped()&&!0===b.bubbles)k.call(null,e,b,c);else if(!e&&!b.defaultPrevented){var f=n.getElData(b.target);b.target[b.type]&&(f.disabled=!0,"function"==typeof b.target[b.type]&&b.target[b.type](),f.disabled=!1)}return!b.defaultPrevented}function l(a,b,c){if(Array.isArray(b))return g(l,a,b,c);var d=function e(){j(a,b,e),c.apply(this,arguments)};d.guid=c.guid=c.guid||p.newGUID(),i(a,b,d)}c.__esModule=!0,c.fixEvent=h,c.on=i,c.off=j,c.trigger=k,c.one=l;var m=a(81),n=e(m),o=a(85),p=e(o),q=a(86),r=d(q),s=a(97),t=d(s),u=a(96),v=d(u),w=!1;!function(){try{var a=Object.defineProperty({},"passive",{get:function(){w=!0}});t["default"].addEventListener("test",null,a)}catch(b){}}();var x=["touchstart","touchmove"]},{81:81,85:85,86:86,96:96,97:97}],83:[function(a,b,c){"use strict";c.__esModule=!0,c.throttle=c.bind=undefined;var d=a(85);c.bind=function(a,b,c){b.guid||(b.guid=(0,d.newGUID)());var e=function(){return b.apply(a,arguments)};return e.guid=c?c+"_"+b.guid:b.guid,e},c.throttle=function(a,b){var c=Date.now();return function(){var d=Date.now();d-c>=b&&(a.apply(undefined,arguments),c=d)}}},{85:85}],84:[function(a,b,c){"use strict";function d(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:a;a=a<0?0:a;var c=Math.floor(a%60),d=Math.floor(a/60%60),e=Math.floor(a/3600),f=Math.floor(b/60%60),g=Math.floor(b/3600);return(isNaN(a)||a===Infinity)&&(e=d=c="-"),e=e>0||g>0?e+":":"",d=((e||f>=10)&&d<10?"0"+d:d)+":",c=c<10?"0"+c:c,e+d+c}c.__esModule=!0,c["default"]=d},{}],85:[function(a,b,c){"use strict";function d(){return e++}c.__esModule=!0,c.newGUID=d;var e=1},{}],86:[function(a,b,c){"use strict";c.__esModule=!0,c.logByType=undefined;var d=a(97),e=function(a){return a&&a.__esModule?a:{"default":a}}(d),f=a(78),g=a(88),h=void 0,i=c.logByType=function(a,b){var c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!!f.IE_VERSION&&f.IE_VERSION<11;"log"!==a&&b.unshift(a.toUpperCase()+":"),h.history.push(b),b.unshift("VIDEOJS:");var d=e["default"].console&&e["default"].console[a];d&&(c&&(b=b.map(function(a){if((0,g.isObject)(a)||Array.isArray(a))try{return JSON.stringify(a)}catch(b){return String(a)}return String(a)}).join(" ")),d.apply?d[Array.isArray(b)?"apply":"call"](e["default"].console,b):d(b))};h=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];i("log",b)},h.history=[],h.error=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return i("error",b)},h.warn=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return i("warn",b)},c["default"]=h},{78:78,88:88,97:97}],87:[function(a,b,c){"use strict";function d(){for(var a={},b=arguments.length,c=Array(b),f=0;f<b;f++)c[f]=arguments[f];return c.forEach(function(b){b&&(0,e.each)(b,function(b,c){if(!(0,e.isPlain)(b))return void(a[c]=b);(0,e.isPlain)(a[c])||(a[c]={}),a[c]=d(a[c],b)})}),a}c.__esModule=!0,c["default"]=d;var e=a(88)},{88:88}],88:[function(a,b,c){"use strict";function d(a,b){k(a).forEach(function(c){return b(a[c],c)})}function e(a,b){var c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;return k(a).reduce(function(c,d){return b(c,a[d],d)},c)}function f(a){for(var b=arguments.length,c=Array(b>1?b-1:0),e=1;e<b;e++)c[e-1]=arguments[e];return Object.assign?Object.assign.apply(Object,[a].concat(c)):(c.forEach(function(b){b&&d(b,function(b,c){a[c]=b})}),a)}function g(a){return!!a&&"object"===(void 0===a?"undefined":i(a))}function h(a){return g(a)&&"[object Object]"===j.call(a)&&a.constructor===Object}c.__esModule=!0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};c.each=d,c.reduce=e,c.assign=f,c.isObject=g,c.isPlain=h;var j=Object.prototype.toString,k=function(a){return g(a)?Object.keys(a):[]}},{}],89:[function(a,b,c){"use strict";c.__esModule=!0,c.setTextContent=c.createStyleElement=undefined;var d=a(96),e=function(a){return a&&a.__esModule?a:{"default":a}}(d);c.createStyleElement=function(a){var b=e["default"].createElement("style");return b.className=a,b},c.setTextContent=function(a,b){a.styleSheet?a.styleSheet.cssText=b:a.textContent=b}},{96:96}],90:[function(a,b,c){"use strict";function d(a,b,c){if(b<0||b>c)throw new Error("Failed to execute '"+a+"' on 'TimeRanges': The index provided ("+b+") is greater than or equal to the maximum bound ("+c+").")}function e(a,b,c,e){return e===undefined&&(i["default"].warn("DEPRECATED: Function '"+a+"' on 'TimeRanges' called without an index argument."),e=0),d(a,e,c.length-1),c[e][b]}function f(a){return a===undefined||0===a.length?{length:0,start:function(){throw new Error("This TimeRanges object is empty")},end:function(){throw new Error("This TimeRanges object is empty")}}:{length:a.length,start:e.bind(null,"start",0,a),end:e.bind(null,"end",1,a)}}function g(a,b){return Array.isArray(a)?f(a):a===undefined||b===undefined?f():f([[a,b]])}c.__esModule=!0,c.createTimeRange=undefined,c.createTimeRanges=g;var h=a(86),i=function(a){return a&&a.__esModule?a:{"default":a}}(h);c.createTimeRange=g},{86:86}],91:[function(a,b,c){"use strict";function d(a){return"string"!=typeof a?a:a.charAt(0).toUpperCase()+a.slice(1)}c.__esModule=!0,c["default"]=d},{}],92:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}c.__esModule=!0,c.isCrossOrigin=c.getFileExtension=c.getAbsoluteURL=c.parseUrl=undefined;var e=a(96),f=d(e),g=a(97),h=d(g),i=c.parseUrl=function(a){var b=["protocol","hostname","port","pathname","search","hash","host"],c=f["default"].createElement("a");c.href=a;var d=""===c.host&&"file:"!==c.protocol,e=void 0;d&&(e=f["default"].createElement("div"),e.innerHTML='<a href="'+a+'"></a>',c=e.firstChild,e.setAttribute("style","display:none; position:absolute;"),f["default"].body.appendChild(e));for(var g={},h=0;h<b.length;h++)g[b[h]]=c[b[h]];return"http:"===g.protocol&&(g.host=g.host.replace(/:80$/,"")),"https:"===g.protocol&&(g.host=g.host.replace(/:443$/,"")),d&&f["default"].body.removeChild(e),g};c.getAbsoluteURL=function(a){if(!a.match(/^https?:\/\//)){var b=f["default"].createElement("div");b.innerHTML='<a href="'+a+'">x</a>',a=b.firstChild.href}return a},c.getFileExtension=function(a){if("string"==typeof a){var b=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/i,c=b.exec(a);if(c)return c.pop().toLowerCase()}return""},c.isCrossOrigin=function(a){var b=h["default"].location,c=i(a);return(":"===c.protocol?b.protocol:c.protocol)+c.host!==b.protocol+b.host}},{96:96,97:97}],93:[function(b,c,d){"use strict";function e(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function f(a){return a&&a.__esModule?a:{"default":a}}function g(a,b,c){var d=void 0;if("string"==typeof a){if(0===a.indexOf("#")&&(a=a.slice(1)),g.getPlayers()[a])return b&&S["default"].warn('Player "'+a+'" is already initialised. Options will not be applied.'),c&&g.getPlayers()[a].ready(c),g.getPlayers()[a];d=p.getEl(a)}else d=a;if(!d||!d.nodeName)throw new TypeError("The element or ID supplied is not valid. (videojs)");if(d.player||B["default"].players[d.playerId])return d.player||B["default"].players[d.playerId];b=b||{},g.hooks("beforesetup").forEach(function(a){var c=a(d,(0,F["default"])(b));if(!(0,V.isObject)(c)||Array.isArray(c))return void S["default"].error("please return an object in beforesetup hooks");b=(0,F["default"])(b,c)});var e=v["default"].getComponent("Player"),f=new e(d,b,c);return g.hooks("setup").forEach(function(a){return a(f)}),f}d.__esModule=!0;var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},i=b(97),j=f(i),k=b(96),l=f(k),m=b(78),n=e(m),o=b(81),p=e(o),q=b(56),r=e(q),s=b(89),t=e(s),u=b(5),v=f(u),w=b(42),x=f(w),y=b(82),z=e(y),A=b(51),B=f(A),C=b(52),D=f(C),E=b(87),F=f(E),G=b(83),H=e(G),I=b(72),J=f(I),K=b(64),L=f(K),M=b(77),N=f(M),O=b(90),P=b(84),Q=f(P),R=b(86),S=f(R),T=b(92),U=e(T),V=b(88),W=b(80),X=f(W),Y=b(43),Z=f(Y),$=b(108),_=f($),aa=b(62),ba=f(aa);if("undefined"==typeof HTMLVideoElement&&p.isReal()&&(l["default"].createElement("video"),l["default"].createElement("audio"),l["default"].createElement("track")),g.hooks_={},g.hooks=function(a,b){return g.hooks_[a]=g.hooks_[a]||[],b&&(g.hooks_[a]=g.hooks_[a].concat(b)),g.hooks_[a]},g.hook=function(a,b){g.hooks(a,b)},g.removeHook=function(a,b){var c=g.hooks(a).indexOf(b)
;return!(c<=-1)&&(g.hooks_[a]=g.hooks_[a].slice(),g.hooks_[a].splice(c,1),!0)},!0!==j["default"].VIDEOJS_NO_DYNAMIC_STYLE&&p.isReal()){var ca=p.$(".vjs-styles-defaults");if(!ca){ca=t.createStyleElement("vjs-styles-defaults");var da=p.$("head");da&&da.insertBefore(ca,da.firstChild),t.setTextContent(ca,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid {\n        padding-top: 56.25%\n      }\n    ")}}r.autoSetupTimeout(1,g),g.VERSION="5.20.4",g.options=B["default"].prototype.options_,g.getPlayers=function(){return B["default"].players},g.players=B["default"].players,g.getComponent=v["default"].getComponent,g.registerComponent=function(a,b){ba["default"].isTech(b)&&S["default"].warn("The "+a+" tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)"),v["default"].registerComponent.call(v["default"],a,b)},g.getTech=ba["default"].getTech,g.registerTech=ba["default"].registerTech,g.browser=n,g.TOUCH_ENABLED=n.TOUCH_ENABLED,g.extend=Z["default"],g.mergeOptions=F["default"],g.bind=H.bind,g.plugin=D["default"],g.addLanguage=function(a,b){var c;return a=(""+a).toLowerCase(),g.options.languages=(0,F["default"])(g.options.languages,(c={},c[a]=b,c)),g.options.languages[a]},g.log=S["default"],g.createTimeRange=g.createTimeRanges=O.createTimeRanges,g.formatTime=Q["default"],g.parseUrl=U.parseUrl,g.isCrossOrigin=U.isCrossOrigin,g.EventTarget=x["default"],g.on=z.on,g.one=z.one,g.off=z.off,g.trigger=z.trigger,g.xhr=_["default"],g.TextTrack=J["default"],g.AudioTrack=L["default"],g.VideoTrack=N["default"],g.isEl=p.isEl,g.isTextNode=p.isTextNode,g.createEl=p.createEl,g.hasClass=p.hasElClass,g.addClass=p.addElClass,g.removeClass=p.removeElClass,g.toggleClass=p.toggleElClass,g.setAttributes=p.setElAttributes,g.getAttributes=p.getElAttributes,g.emptyEl=p.emptyEl,g.appendContent=p.appendContent,g.insertContent=p.insertContent,g.computedStyle=X["default"],"function"==typeof a&&a.amd?a("videojs",[],function(){return g}):"object"===(void 0===d?"undefined":h(d))&&"object"===(void 0===c?"undefined":h(c))&&(c.exports=g),d["default"]=g},{108:108,42:42,43:43,5:5,51:51,52:52,56:56,62:62,64:64,72:72,77:77,78:78,80:80,81:81,82:82,83:83,84:84,86:86,87:87,88:88,89:89,90:90,92:92,96:96,97:97}],94:[function(a,b,c){},{}],95:[function(a,b,c){function d(a,b,c){if(!h(b))throw new TypeError("iterator must be a function");arguments.length<3&&(c=this),"[object Array]"===i.call(a)?e(a,b,c):"string"==typeof a?f(a,b,c):g(a,b,c)}function e(a,b,c){for(var d=0,e=a.length;d<e;d++)j.call(a,d)&&b.call(c,a[d],d,a)}function f(a,b,c){for(var d=0,e=a.length;d<e;d++)b.call(c,a.charAt(d),d,a)}function g(a,b,c){for(var d in a)j.call(a,d)&&b.call(c,a[d],d,a)}var h=a(98);b.exports=d;var i=Object.prototype.toString,j=Object.prototype.hasOwnProperty},{98:98}],96:[function(a,b,c){(function(c){var d=void 0!==c?c:"undefined"!=typeof window?window:{},e=a(94);if("undefined"!=typeof document)b.exports=document;else{var f=d["__GLOBAL_DOCUMENT_CACHE@4"];f||(f=d["__GLOBAL_DOCUMENT_CACHE@4"]=e),b.exports=f}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{94:94}],97:[function(a,b,c){(function(a){"undefined"!=typeof window?b.exports=window:void 0!==a?b.exports=a:"undefined"!=typeof self?b.exports=self:b.exports={}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],98:[function(a,b,c){function d(a){var b=e.call(a);return"[object Function]"===b||"function"==typeof a&&"[object RegExp]"!==b||"undefined"!=typeof window&&(a===window.setTimeout||a===window.alert||a===window.confirm||a===window.prompt)}b.exports=d;var e=Object.prototype.toString},{}],99:[function(a,b,c){var d=a(101),e=a(95),f=function(a){return"[object Array]"===Object.prototype.toString.call(a)};b.exports=function(a){if(!a)return{};var b={};return e(d(a).split("\n"),function(a){var c=a.indexOf(":"),e=d(a.slice(0,c)).toLowerCase(),g=d(a.slice(c+1));"undefined"==typeof b[e]?b[e]=g:f(b[e])?b[e].push(g):b[e]=[b[e],g]}),b}},{101:101,95:95}],100:[function(a,b,c){function d(a,b){var c,d=null;try{c=JSON.parse(a,b)}catch(e){d=e}return[d,c]}b.exports=d},{}],101:[function(a,b,c){function d(a){return a.replace(/^\s*|\s*$/g,"")}c=b.exports=d,c.left=function(a){return a.replace(/^\s*/,"")},c.right=function(a){return a.replace(/\s*$/,"")}},{}],102:[function(a,b,c){function d(a){return a.replace(/\n\r?\s*/g,"")}b.exports=function(a){for(var b="",c=0;c<arguments.length;c++)b+=d(a[c])+(arguments[c+1]||"");return b}},{}],103:[function(a,b,c){var d=a(107),e=b.exports={WebVTT:a(104),VTTCue:a(105),VTTRegion:a(106)};d.vttjs=e,d.WebVTT=e.WebVTT;var f=e.VTTCue,g=e.VTTRegion,h=d.VTTCue,i=d.VTTRegion;e.shim=function(){d.VTTCue=f,d.VTTRegion=g},e.restore=function(){d.VTTCue=h,d.VTTRegion=i},d.VTTCue||e.shim()},{104:104,105:105,106:106,107:107}],104:[function(a,b,c){function d(a,b){this.name="ParsingError",this.code=a.code,this.message=b||a.message}function e(a){function b(a,b,c,d){return 3600*(0|a)+60*(0|b)+(0|c)+(0|d)/1e3}var c=a.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return c?c[3]?b(c[1],c[2],c[3].replace(":",""),c[4]):c[1]>59?b(c[1],c[2],0,c[4]):b(0,c[1],c[2],c[4]):null}function f(){this.values=r(null)}function g(a,b,c,d){var e=d?a.split(d):[a];for(var f in e)if("string"==typeof e[f]){var g=e[f].split(c);if(2===g.length){var h=g[0],i=g[1];b(h,i)}}}function h(a,b,c){function h(){var b=e(a);if(null===b)throw new d(d.Errors.BadTimeStamp,"Malformed timestamp: "+j);return a=a.replace(/^[^\sa-zA-Z-]+/,""),b}function i(){a=a.replace(/^\s+/,"")}var j=a;if(i(),b.startTime=h(),i(),"--\x3e"!==a.substr(0,3))throw new d(d.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+j);a=a.substr(3),i(),b.endTime=h(),i(),function(a,b){var d=new f;g(a,function(a,b){switch(a){case"region":for(var e=c.length-1;e>=0;e--)if(c[e].id===b){d.set(a,c[e].region);break}break;case"vertical":d.alt(a,b,["rl","lr"]);break;case"line":var f=b.split(","),g=f[0];d.integer(a,g),d.percent(a,g)&&d.set("snapToLines",!1),d.alt(a,g,["auto"]),2===f.length&&d.alt("lineAlign",f[1],["start","middle","end"]);break;case"position":f=b.split(","),d.percent(a,f[0]),2===f.length&&d.alt("positionAlign",f[1],["start","middle","end"]);break;case"size":d.percent(a,b);break;case"align":d.alt(a,b,["start","middle","end","left","right"])}},/:/,/\s/),b.region=d.get("region",null),b.vertical=d.get("vertical",""),b.line=d.get("line","auto"),b.lineAlign=d.get("lineAlign","start"),b.snapToLines=d.get("snapToLines",!0),b.size=d.get("size",100),b.align=d.get("align","middle"),b.position=d.get("position",{start:0,left:0,middle:50,end:100,right:100},b.align),b.positionAlign=d.get("positionAlign",{start:"start",left:"start",middle:"middle",end:"end",right:"end"},b.align)}(a,b)}function i(a,b){function c(a){return s[a]}for(var d,f=a.document.createElement("div"),g=f,h=[];null!==(d=function(){if(!b)return null;var a=b.match(/^([^<]*)(<[^>]+>?)?/);return function(a){return b=b.substr(a.length),a}(a[1]?a[1]:a[2])}());)if("<"!==d[0])g.appendChild(a.document.createTextNode(function(a){for(;k=a.match(/&(amp|lt|gt|lrm|rlm|nbsp);/);)a=a.replace(k[0],c);return a}(d)));else{if("/"===d[1]){h.length&&h[h.length-1]===d.substr(2).replace(">","")&&(h.pop(),g=g.parentNode);continue}var i,j=e(d.substr(1,d.length-2));if(j){i=a.document.createProcessingInstruction("timestamp",j),g.appendChild(i);continue}var k=d.match(/^<([^.\s\/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!k)continue;if(!(i=function(b,c){var d=t[b];if(!d)return null;var e=a.document.createElement(d);e.localName=d;var f=u[b];return f&&c&&(e[f]=c.trim()),e}(k[1],k[3])))continue;if(!function(a,b){return!v[b.localName]||v[b.localName]===a.localName}(g,i))continue;k[2]&&(i.className=k[2].substr(1).replace("."," ")),h.push(k[1]),g.appendChild(i),g=i}return f}function j(a){for(var b=0;b<w.length;b++){var c=w[b];if(a>=c[0]&&a<=c[1])return!0}return!1}function k(a){function b(a,b){for(var c=b.childNodes.length-1;c>=0;c--)a.push(b.childNodes[c])}function c(a){if(!a||!a.length)return null;var d=a.pop(),e=d.textContent||d.innerText;if(e){var f=e.match(/^.*(\n|\r)/);return f?(a.length=0,f[0]):e}return"ruby"===d.tagName?c(a):d.childNodes?(b(a,d),c(a)):void 0}var d,e=[],f="";if(!a||!a.childNodes)return"ltr";for(b(e,a);f=c(e);)for(var g=0;g<f.length;g++)if(d=f.charCodeAt(g),j(d))return"rtl";return"ltr"}function l(a){if("number"==typeof a.line&&(a.snapToLines||a.line>=0&&a.line<=100))return a.line;if(!a.track||!a.track.textTrackList||!a.track.textTrackList.mediaElement)return-1;for(var b=a.track,c=b.textTrackList,d=0,e=0;e<c.length&&c[e]!==b;e++)"showing"===c[e].mode&&d++;return-1*++d}function m(){}function n(a,b,c){var d=/MSIE\s8\.0/.test(navigator.userAgent),e="rgba(255, 255, 255, 1)",f="rgba(0, 0, 0, 0.8)";d&&(e="rgb(255, 255, 255)",f="rgb(0, 0, 0)"),m.call(this),this.cue=b,this.cueDiv=i(a,b.text);var g={color:e,backgroundColor:f,position:"relative",left:0,right:0,top:0,bottom:0,display:"inline"};d||(g.writingMode=""===b.vertical?"horizontal-tb":"lr"===b.vertical?"vertical-lr":"vertical-rl",g.unicodeBidi="plaintext"),this.applyStyles(g,this.cueDiv),this.div=a.document.createElement("div"),g={textAlign:"middle"===b.align?"center":b.align,font:c.font,whiteSpace:"pre-line",position:"absolute"},d||(g.direction=k(this.cueDiv),g.writingMode=""===b.vertical?"horizontal-tb":"lr"===b.vertical?"vertical-lr":"vertical-rl".stylesunicodeBidi="plaintext"),this.applyStyles(g),this.div.appendChild(this.cueDiv);var h=0;switch(b.positionAlign){case"start":h=b.position;break;case"middle":h=b.position-b.size/2;break;case"end":h=b.position-b.size}""===b.vertical?this.applyStyles({left:this.formatStyle(h,"%"),width:this.formatStyle(b.size,"%")}):this.applyStyles({top:this.formatStyle(h,"%"),height:this.formatStyle(b.size,"%")}),this.move=function(a){this.applyStyles({top:this.formatStyle(a.top,"px"),bottom:this.formatStyle(a.bottom,"px"),left:this.formatStyle(a.left,"px"),right:this.formatStyle(a.right,"px"),height:this.formatStyle(a.height,"px"),width:this.formatStyle(a.width,"px")})}}function o(a){var b,c,d,e,f=/MSIE\s8\.0/.test(navigator.userAgent);if(a.div){c=a.div.offsetHeight,d=a.div.offsetWidth,e=a.div.offsetTop;var g=(g=a.div.childNodes)&&(g=g[0])&&g.getClientRects&&g.getClientRects();a=a.div.getBoundingClientRect(),b=g?Math.max(g[0]&&g[0].height||0,a.height/g.length):0}this.left=a.left,this.right=a.right,this.top=a.top||e,this.height=a.height||c,this.bottom=a.bottom||e+(a.height||c),this.width=a.width||d,this.lineHeight=b!==undefined?b:a.lineHeight,f&&!this.lineHeight&&(this.lineHeight=13)}function p(a,b,c,d){var e=new o(b),f=b.cue,g=l(f),h=[];if(f.snapToLines){var i;switch(f.vertical){case"":h=["+y","-y"],i="height";break;case"rl":h=["+x","-x"],i="width";break;case"lr":h=["-x","+x"],i="width"}var j=e.lineHeight,k=j*Math.round(g),m=c[i]+j,n=h[0];Math.abs(k)>m&&(k=k<0?-1:1,k*=Math.ceil(m/j)*j),g<0&&(k+=""===f.vertical?c.height:c.width,h=h.reverse()),e.move(n,k)}else{var p=e.lineHeight/c.height*100;switch(f.lineAlign){case"middle":g-=p/2;break;case"end":g-=p}switch(f.vertical){case"":b.applyStyles({top:b.formatStyle(g,"%")});break;case"rl":b.applyStyles({left:b.formatStyle(g,"%")});break;case"lr":b.applyStyles({right:b.formatStyle(g,"%")})}h=["+y","-x","+x","-y"],e=new o(b)}var q=function(a,b){for(var e,f=new o(a),g=1,h=0;h<b.length;h++){for(;a.overlapsOppositeAxis(c,b[h])||a.within(c)&&a.overlapsAny(d);)a.move(b[h]);if(a.within(c))return a;var i=a.intersectPercentage(c);g>i&&(e=new o(a),g=i),a=new o(f)}return e||f}(e,h);b.move(q.toCSSCompatValues(c))}function q(){}var r=Object.create||function(){function a(){}return function(b){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return a.prototype=b,new a}}();d.prototype=r(Error.prototype),d.prototype.constructor=d,d.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},f.prototype={set:function(a,b){this.get(a)||""===b||(this.values[a]=b)},get:function(a,b,c){return c?this.has(a)?this.values[a]:b[c]:this.has(a)?this.values[a]:b},has:function(a){return a in this.values},alt:function(a,b,c){for(var d=0;d<c.length;++d)if(b===c[d]){this.set(a,b);break}},integer:function(a,b){/^-?\d+$/.test(b)&&this.set(a,parseInt(b,10))},percent:function(a,b){return!!(b.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(b=parseFloat(b))>=0&&b<=100)&&(this.set(a,b),!0)}};var s={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"‎","&rlm;":"‏","&nbsp;":" "},t={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},u={v:"title",lang:"lang"},v={rt:"ruby"},w=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];m.prototype.applyStyles=function(a,b){b=b||this.div;for(var c in a)a.hasOwnProperty(c)&&(b.style[c]=a[c])},m.prototype.formatStyle=function(a,b){return 0===a?0:a+b},n.prototype=r(m.prototype),n.prototype.constructor=n,o.prototype.move=function(a,b){switch(b=b!==undefined?b:this.lineHeight,a){case"+x":this.left+=b,this.right+=b;break;case"-x":this.left-=b,this.right-=b;break;case"+y":this.top+=b,this.bottom+=b;break;case"-y":this.top-=b,this.bottom-=b}},o.prototype.overlaps=function(a){return this.left<a.right&&this.right>a.left&&this.top<a.bottom&&this.bottom>a.top},o.prototype.overlapsAny=function(a){for(var b=0;b<a.length;b++)if(this.overlaps(a[b]))return!0;return!1},o.prototype.within=function(a){return this.top>=a.top&&this.bottom<=a.bottom&&this.left>=a.left&&this.right<=a.right},o.prototype.overlapsOppositeAxis=function(a,b){switch(b){case"+x":return this.left<a.left;case"-x":return this.right>a.right;case"+y":return this.top<a.top;case"-y":return this.bottom>a.bottom}},o.prototype.intersectPercentage=function(a){return Math.max(0,Math.min(this.right,a.right)-Math.max(this.left,a.left))*Math.max(0,Math.min(this.bottom,a.bottom)-Math.max(this.top,a.top))/(this.height*this.width)},o.prototype.toCSSCompatValues=function(a){return{top:this.top-a.top,bottom:a.bottom-this.bottom,left:this.left-a.left,right:a.right-this.right,height:this.height,width:this.width}},o.getSimpleBoxPosition=function(a){var b=a.div?a.div.offsetHeight:a.tagName?a.offsetHeight:0,c=a.div?a.div.offsetWidth:a.tagName?a.offsetWidth:0,d=a.div?a.div.offsetTop:a.tagName?a.offsetTop:0;return a=a.div?a.div.getBoundingClientRect():a.tagName?a.getBoundingClientRect():a,{left:a.left,right:a.right,top:a.top||d,height:a.height||b,bottom:a.bottom||d+(a.height||b),width:a.width||c}},q.StringDecoder=function(){return{decode:function(a){if(!a)return"";if("string"!=typeof a)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(a))}}},q.convertCueToDOMTree=function(a,b){return a&&b?i(a,b):null};q.processCues=function(a,b,c){if(!a||!b||!c)return null;for(;c.firstChild;)c.removeChild(c.firstChild);var d=a.document.createElement("div");if(d.style.position="absolute",d.style.left="0",d.style.right="0",d.style.top="0",d.style.bottom="0",d.style.margin="1.5%",c.appendChild(d),function(a){for(var b=0;b<a.length;b++)if(a[b].hasBeenReset||!a[b].displayState)return!0;return!1}(b)){var e=[],f=o.getSimpleBoxPosition(d),g=Math.round(.05*f.height*100)/100,h={font:g+"px sans-serif"};!function(){for(var c,g,i=0;i<b.length;i++)g=b[i],c=new n(a,g,h),d.appendChild(c.div),p(a,c,f,e),g.displayState=c.div,e.push(o.getSimpleBoxPosition(c))}()}else for(var i=0;i<b.length;i++)d.appendChild(b[i].displayState)},q.Parser=function(a,b,c){c||(c=b,b={}),b||(b={}),this.window=a,this.vttjs=b,this.state="INITIAL",this.buffer="",this.decoder=c||new TextDecoder("utf8"),this.regionList=[]},q.Parser.prototype={reportOrThrowError:function(a){if(!(a instanceof d))throw a;this.onparsingerror&&this.onparsingerror(a)},parse:function(a){function b(){for(var a=j.buffer,b=0;b<a.length&&"\r"!==a[b]&&"\n"!==a[b];)++b;var c=a.substr(0,b);return"\r"===a[b]&&++b,"\n"===a[b]&&++b,j.buffer=a.substr(b),c}function c(a){var b=new f;if(g(a,function(a,c){switch(a){case"id":b.set(a,c);break;case"width":b.percent(a,c);break;case"lines":b.integer(a,c);break;case"regionanchor":case"viewportanchor":var d=c.split(",");if(2!==d.length)break;var e=new f;if(e.percent("x",d[0]),e.percent("y",d[1]),!e.has("x")||!e.has("y"))break;b.set(a+"X",e.get("x")),b.set(a+"Y",e.get("y"));break;case"scroll":b.alt(a,c,["up"])}},/=/,/\s/),b.has("id")){var c=new(j.vttjs.VTTRegion||j.window.VTTRegion);c.width=b.get("width",100),c.lines=b.get("lines",3),c.regionAnchorX=b.get("regionanchorX",0),c.regionAnchorY=b.get("regionanchorY",100),c.viewportAnchorX=b.get("viewportanchorX",0),c.viewportAnchorY=b.get("viewportanchorY",100),c.scroll=b.get("scroll",""),j.onregion&&j.onregion(c),j.regionList.push({id:b.get("id"),region:c})}}function i(a){var b=new f;g(a,function(a,c){switch(a){case"MPEGT":b.integer(a+"S",c);break;case"LOCA":b.set(a+"L",e(c))}},/[^\d]:/,/,/),j.ontimestampmap&&j.ontimestampmap({MPEGTS:b.get("MPEGTS"),LOCAL:b.get("LOCAL")})}var j=this;a&&(j.buffer+=j.decoder.decode(a,{stream:!0}));try{var k;if("INITIAL"===j.state){if(!/\r\n|\n/.test(j.buffer))return this;k=b();var l=k.match(/^WEBVTT([ \t].*)?$/);if(!l||!l[0])throw new d(d.Errors.BadSignature);j.state="HEADER"}for(var m=!1;j.buffer;){if(!/\r\n|\n/.test(j.buffer))return this;switch(m?m=!1:k=b(),j.state){case"HEADER":/:/.test(k)?function(a){a.match(/X-TIMESTAMP-MAP/)?g(a,function(a,b){switch(a){case"X-TIMESTAMP-MAP":i(b)}},/=/):g(a,function(a,b){switch(a){case"Region":c(b)}},/:/)}(k):k||(j.state="ID");continue;case"NOTE":k||(j.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(k)){j.state="NOTE";break}if(!k)continue;if(j.cue=new(j.vttjs.VTTCue||j.window.VTTCue)(0,0,""),j.state="CUE",-1===k.indexOf("--\x3e")){j.cue.id=k;continue}case"CUE":try{h(k,j.cue,j.regionList)}catch(o){j.reportOrThrowError(o),j.cue=null,j.state="BADCUE";continue}j.state="CUETEXT";continue;case"CUETEXT":var n=-1!==k.indexOf("--\x3e");if(!k||n&&(m=!0)){j.oncue&&j.oncue(j.cue),j.cue=null,j.state="ID";continue}j.cue.text&&(j.cue.text+="\n"),j.cue.text+=k;continue;case"BADCUE":k||(j.state="ID");continue}}}catch(o){j.reportOrThrowError(o),"CUETEXT"===j.state&&j.cue&&j.oncue&&j.oncue(j.cue),j.cue=null,j.state="INITIAL"===j.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var a=this;try{if(a.buffer+=a.decoder.decode(),(a.cue||"HEADER"===a.state)&&(a.buffer+="\n\n",a.parse()),"INITIAL"===a.state)throw new d(d.Errors.BadSignature)}catch(b){a.reportOrThrowError(b)}return a.onflush&&a.onflush(),this}},b.exports=q},{}],105:[function(a,b,c){function d(a){return"string"==typeof a&&(!!i[a.toLowerCase()]&&a.toLowerCase())}function e(a){return"string"==typeof a&&(!!j[a.toLowerCase()]&&a.toLowerCase())}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)a[d]=c[d]}return a}function g(a,b,c){var g=this,i=/MSIE\s8\.0/.test(navigator.userAgent),j={};i?g=document.createElement("custom"):j.enumerable=!0,g.hasBeenReset=!1;var k="",l=!1,m=a,n=b,o=c,p=null,q="",r=!0,s="auto",t="start",u=50,v="middle",w=50,x="middle";if(Object.defineProperty(g,"id",f({},j,{get:function(){return k},set:function(a){k=""+a}})),Object.defineProperty(g,"pauseOnExit",f({},j,{get:function(){return l},set:function(a){l=!!a}})),Object.defineProperty(g,"startTime",f({},j,{get:function(){return m},set:function(a){if("number"!=typeof a)throw new TypeError("Start time must be set to a number.");m=a,this.hasBeenReset=!0}})),Object.defineProperty(g,"endTime",f({},j,{get:function(){return n},set:function(a){if("number"!=typeof a)throw new TypeError("End time must be set to a number.");n=a,this.hasBeenReset=!0}})),Object.defineProperty(g,"text",f({},j,{get:function(){return o},set:function(a){o=""+a,this.hasBeenReset=!0}})),Object.defineProperty(g,"region",f({},j,{get:function(){return p},set:function(a){p=a,this.hasBeenReset=!0}})),Object.defineProperty(g,"vertical",f({},j,{get:function(){return q},set:function(a){var b=d(a);if(!1===b)throw new SyntaxError("An invalid or illegal string was specified.");q=b,this.hasBeenReset=!0}})),Object.defineProperty(g,"snapToLines",f({},j,{get:function(){return r},set:function(a){r=!!a,this.hasBeenReset=!0}})),Object.defineProperty(g,"line",f({},j,{get:function(){return s},set:function(a){if("number"!=typeof a&&a!==h)throw new SyntaxError("An invalid number or illegal string was specified.");s=a,this.hasBeenReset=!0}})),Object.defineProperty(g,"lineAlign",f({},j,{get:function(){return t},set:function(a){var b=e(a);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");t=b,this.hasBeenReset=!0}})),Object.defineProperty(g,"position",f({},j,{get:function(){return u},set:function(a){if(a<0||a>100)throw new Error("Position must be between 0 and 100.");u=a,this.hasBeenReset=!0}})),Object.defineProperty(g,"positionAlign",f({},j,{get:function(){return v},set:function(a){var b=e(a);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");v=b,this.hasBeenReset=!0}})),Object.defineProperty(g,"size",f({},j,{get:function(){return w},set:function(a){if(a<0||a>100)throw new Error("Size must be between 0 and 100.");w=a,this.hasBeenReset=!0}})),Object.defineProperty(g,"align",f({},j,{get:function(){return x},set:function(a){var b=e(a);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");x=b,this.hasBeenReset=!0}})),g.displayState=undefined,i)return g}var h="auto",i={"":!0,lr:!0,rl:!0},j={start:!0,middle:!0,end:!0,left:!0,right:!0};g.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},b.exports=g},{}],106:[function(a,b,c){function d(a){return"string"==typeof a&&(!!g[a.toLowerCase()]&&a.toLowerCase())}function e(a){return"number"==typeof a&&a>=0&&a<=100}function f(){var a=100,b=3,c=0,f=100,g=0,h=100,i="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return a},set:function(b){if(!e(b))throw new Error("Width must be between 0 and 100.");a=b}},lines:{enumerable:!0,get:function(){return b},set:function(a){if("number"!=typeof a)throw new TypeError("Lines must be set to a number.");b=a}},regionAnchorY:{enumerable:!0,get:function(){return f},set:function(a){if(!e(a))throw new Error("RegionAnchorX must be between 0 and 100.");f=a}},regionAnchorX:{enumerable:!0,get:function(){return c},set:function(a){if(!e(a))throw new Error("RegionAnchorY must be between 0 and 100.");c=a}},viewportAnchorY:{enumerable:!0,get:function(){return h},set:function(a){if(!e(a))throw new Error("ViewportAnchorY must be between 0 and 100.");h=a}},viewportAnchorX:{enumerable:!0,get:function(){return g},set:function(a){if(!e(a))throw new Error("ViewportAnchorX must be between 0 and 100.");g=a}},scroll:{enumerable:!0,get:function(){return i},set:function(a){var b=d(a);if(!1===b)throw new SyntaxError("An invalid or illegal string was specified.");i=b}}})}var g={"":!0,up:!0};b.exports=f},{}],107:[function(a,b,c){(function(a){var c;c="undefined"!=typeof window?window:void 0!==a?a:"undefined"!=typeof self?self:{},b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],108:[function(a,b,c){"use strict";function d(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function e(a,b,c){var d=a;return k(b)?(c=b,"string"==typeof a&&(d={uri:a})):d=m(b,{uri:a}),d.callback=c,d}function f(a,b,c){return b=e(a,b,c),g(b)}function g(a){function b(){4===m.readyState&&g()}function c(){var a=undefined;if(a=m.response?m.response:m.responseText||h(m),v)try{a=JSON.parse(a)}catch(b){}return a}function e(a){return clearTimeout(p),a instanceof Error||(a=new Error(""+(a||"Unknown XMLHttpRequest Error"))),a.statusCode=0,j(a,k)}function g(){if(!o){var b;clearTimeout(p),b=a.useXDR&&m.status===undefined?200:1223===m.status?204:m.status;var d=k,e=null;return 0!==b?(d={body:c(),statusCode:b,method:r,headers:{},url:q,rawRequest:m},m.getAllResponseHeaders&&(d.headers=l(m.getAllResponseHeaders()))):e=new Error("Internal XMLHttpRequest Error"),j(e,d,d.body)}}if("undefined"==typeof a.callback)throw new Error("callback argument missing");var i=!1,j=function(b,c,d){i||(i=!0,a.callback(b,c,d))},k={body:undefined,headers:{},statusCode:0,method:r,url:q,rawRequest:m},m=a.xhr||null;m||(m=a.cors||a.useXDR?new f.XDomainRequest:new f.XMLHttpRequest);var n,o,p,q=m.url=a.uri||a.url,r=m.method=a.method||"GET",s=a.body||a.data||null,t=m.headers=a.headers||{},u=!!a.sync,v=!1;if("json"in a&&(v=!0,t.accept||t.Accept||(t.Accept="application/json"),"GET"!==r&&"HEAD"!==r&&(t["content-type"]||t["Content-Type"]||(t["Content-Type"]="application/json"),s=JSON.stringify(a.json))),m.onreadystatechange=b,m.onload=g,m.onerror=e,m.onprogress=function(){},m.ontimeout=e,m.open(r,q,!u,a.username,a.password),u||(m.withCredentials=!!a.withCredentials),!u&&a.timeout>0&&(p=setTimeout(function(){o=!0,m.abort("timeout");var a=new Error("XMLHttpRequest timeout");a.code="ETIMEDOUT",e(a)},a.timeout)),m.setRequestHeader)for(n in t)t.hasOwnProperty(n)&&m.setRequestHeader(n,t[n]);else if(a.headers&&!d(a.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in a&&(m.responseType=a.responseType),"beforeSend"in a&&"function"==typeof a.beforeSend&&a.beforeSend(m),m.send(s),m}function h(a){if("document"===a.responseType)return a.responseXML;var b=204===a.status&&a.responseXML&&"parsererror"===a.responseXML.documentElement.nodeName;return""!==a.responseType||b?null:a.responseXML}function i(){}var j=a(97),k=a(98),l=a(99),m=a(109);b.exports=f,f.XMLHttpRequest=j.XMLHttpRequest||i,f.XDomainRequest="withCredentials"in new f.XMLHttpRequest?f.XMLHttpRequest:j.XDomainRequest,function(a,b){for(var c=0;c<a.length;c++)b(a[c])}(["get","put","post","patch","head","delete"],function(a){f["delete"===a?"del":a]=function(b,c,d){return c=e(b,c,d),c.method=a.toUpperCase(),g(c)}})},{109:109,97:97,98:98,99:99}],109:[function(a,b,c){function d(){for(var a={},b=0;b<arguments.length;b++){var c=arguments[b];for(var d in c)e.call(c,d)&&(a[d]=c[d])}return a}b.exports=d;var e=Object.prototype.hasOwnProperty},{}]},{},[93])(93)});
(function(factory){
  if (typeof define === 'function' && define.amd) {
    define(['jquery'], factory);
  } else if (typeof exports === 'object') {
    factory(require('jquery'));
  } else {
    factory(jQuery);
  }
}(function($) {
  $.fn.qubit = function(options) {
    return this.each(function() {
      new Qubit(this, options);
    });
  };
  var Qubit = function(el) {
    var self = this;
    this.scope = $(el);
    var handler = function(e) {
      if (!self.suspendListeners) {
        self.process(e.target);
      }
    };
    this.scope.on('change', 'input[type=checkbox]', handler);
    // workaround for IE<10
    if (document.documentMode && document.documentMode <= 9) {
      this.scope.on('click', 'input[type=checkbox]:indeterminate', handler);
    }
    this.processParents();
  };
  Qubit.prototype = {
    itemSelector: 'li',
    process: function(checkbox) {
      checkbox = $(checkbox);
      var parentItems = checkbox.parentsUntil(this.scope, this.itemSelector);
      var self = this;
      try {
        this.suspendListeners = true;
        // all children inherit my state
        parentItems.eq(0).find('input[type=checkbox]').not(':disabled')
          .filter(checkbox.prop('checked') ? ':not(:checked)' : ':checked')
          .each(function() {
            if (!$(this).parent().hasClass('hidden')) {
              self.setChecked($(this), checkbox.prop('checked'));
            }
          });
        this.processParents();
      } finally {
        this.suspendListeners = false;
      }
    },
    processParents: function() {
      var self = this, changed = false;
      this.scope.find('input[type=checkbox]').not(':disabled').each(function() {
        var $this = $(this);
        var parent = $this.closest(self.itemSelector);
        var children = parent.find('input[type=checkbox]').not(':disabled').not($this);
        var numChecked = children.filter(function() {
          return $(this).prop('checked') || $(this).prop('indeterminate');
        }).length;

        if (children.length) {
          if (numChecked === 0) {
            self.setChecked($this, false) && (changed = true);
          }
          else if (numChecked == children.length) {
            self.setChecked($this, true) && (changed = true);
          }
          else {
            self.setIndeterminate($this, true) && (changed = true);
          }
        }
        else {
          self.setIndeterminate($this, false) && (changed = true);
        }
      });
      if (changed) this.processParents();
    },
    setChecked: function(checkbox, value, event) {
      var changed = false;
      if (checkbox.prop('indeterminate')) {
        checkbox.prop('indeterminate', false);
        changed = true;
      }
      if (checkbox.prop('checked') != value) {
        checkbox.prop('checked', value).trigger('change');
        changed = true;
      }
      return changed;
    },
    setIndeterminate: function(checkbox, value) {
      if (value) {
        checkbox.prop('checked', false);
      }
      if (checkbox.prop('indeterminate') != value) {
        checkbox.prop('indeterminate', value);
        return true;
      }
    }
  };
}));

(function($){
  $.fn.bonsai = function(options) {
    var args = arguments;
    return this.each(function() {
      var bonsai = $(this).data('bonsai');
      if (!bonsai) {
        bonsai = new Bonsai(this, options);
        $(this).data('bonsai', bonsai);
      }
      if (typeof options == 'string') {
        var method = options;
        return bonsai[method].apply(bonsai, [].slice.call(args, 1));
      }
    });
  };
  $.bonsai = {};
  $.bonsai.defaults = {
    expandAll: false, // expand all items
    expand: null, // optional function to expand an item
    collapse: null, // optional function to collapse an item
    addExpandAll: false, // add a link to expand all items
    addSelectAll: false, // add a link to select all checkboxes
    selectAllExclude: null, // a filter selector or function for selectAll
    idAttribute: 'id', // which attribute of the list items to use as an id

    // createInputs: create checkboxes or radio buttons for each list item
    // by setting createInputs to "checkbox" or "radio".
    //
    // The name and value for the inputs can be declared in the
    // markup using `data-name` and `data-value`.
    //
    // The name is inherited from parent items if not specified.
    //
    // Checked state can be indicated using `data-checked`.
    createInputs: false,
    // checkboxes: run qubit(this.options) on the root node (requires jquery.qubit)
    checkboxes: false,
    // handleDuplicateCheckboxes: update any other checkboxes that
    // have the same value
    handleDuplicateCheckboxes: false,
    // createRadioButtons: creates radio buttons for each list item.
    //
    // The name and value for the checkboxes can be declared in the
    // markup using `data-name` and `data-value`.
    //
    // The name is inherited from parent items if not specified.
    //
    // Checked state can be indicated using `data-checked`.
    createRadioButtons: false
  };
  var Bonsai = function(el, options) {
    var self = this;
    options = options || {};
    this.options = $.extend({}, $.bonsai.defaults, options);
    this.el = $(el).addClass('bonsai').data('bonsai', this);

    // store the scope in the options for child nodes
    if (!this.options.scope) {
      this.options.scope = this.el;
    }
    this.update();
    if (this.isRootNode()) {
      if (this.options.createCheckboxes) this.createInputs = 'checkbox';
      if (this.options.handleDuplicateCheckboxes) this.handleDuplicateCheckboxes();
      if (this.options.checkboxes) this.el.qubit(this.options);
      if (this.options.addExpandAll) this.addExpandAllLink();
      if (this.options.addSelectAll) this.addSelectAllLink();
      this.el.on('click', '.thumb', function(ev) {
        self.toggle($(ev.currentTarget).closest('li'));
      });
    }
    if (this.options.expandAll) this.expandAll();
  };
  Bonsai.prototype = {
    isRootNode: function() {
      return this.options.scope == this.el;
    },
    listItem: function(id) {
      if (typeof id === 'object') return $(id);
      return this.el.find('[' + this.options.idAttribute + '="' + id + '"]');
    },
    toggle: function(listItem) {
      if (!$(listItem).hasClass('expanded')) {
        return this.expand(listItem);
      }
      else {
        return this.collapse(listItem);
      }
    },
    expand: function(listItem) {
      return this.setExpanded(listItem, true);
    },
    collapse: function(listItem) {
      return this.setExpanded(listItem, false);
    },
    setExpanded: function(listItem, expanded) {
      var $li = this.listItem(listItem);
      if ($li.length > 1) {
        var self = this;
        $li.each(function() {
          self.setExpanded(this, expanded);
        });
        return;
      }
      if (expanded) {
        if (!$li.data('subList')) return;
        $li = $($li).addClass('expanded').removeClass('collapsed');
        $($li.data('subList')).css('height', 'auto');
      }
      else {
        $li = $($li).addClass('collapsed')
          .removeClass('expanded');
        $($li.data('subList')).height(0);
      }
      return $li;
    },
    expandAll: function() {
      this.expand(this.el.find('li'));
    },
    collapseAll: function() {
      this.collapse(this.el.find('li'));
    },
    expandTo: function(listItem) {
      var self = this;
      var $li = this.listItem(listItem);
      $li.parents('li').each(function () {
        self.expand($(this));
      });
      return $li;
    },
    update: function() {
      var self = this;
      // look for a nested list (if any)
      this.el.children().each(function() {
        var item = $(this);
        if (self.options.createInputs) self.insertInput(item);

        // insert a thumb if it doesn't already exist
        if (item.children().filter('.thumb').length == 0) {
          var thumb = $('<div class="thumb"></div>');
          item.prepend(thumb);
        }
        var subLists = item.children().filter('ol, ul');
        item.toggleClass('has-children', subLists.find('li').length > 0);
        // if there is a child list
        subLists.each(function() {
          // that's not empty
          if ($('li', this).length == 0) {
            return;
          }
          // then this el has children
          item.data('subList', this);
          // collapse the nested list
          if (item.hasClass('expanded')) {
            self.expand(item);
          }
          else {
            self.collapse(item);
          }
          // handle any deeper nested lists
          var exists = !!$(this).data('bonsai');
          $(this).bonsai(exists ? 'update' : self.options);
        });
      });

      this.expand = this.options.expand || this.expand;
      this.collapse = this.options.collapse || this.collapse;
    },
    serialize: function() {
      var idAttr = this.options.idAttribute;
      return this.el.find('li').toArray().reduce(function(acc, li) {
        var $li = $(li);
        var id = $li.attr(idAttr);
        // only items with IDs can be serialized
        if (id) {
          var state = $li.hasClass('expanded')
              ? 'expanded'
              : ($li.hasClass('collapsed') ? 'collapsed' : null);
          if (state) acc[$li.hasClass('expanded') ? 'expanded' : 'collapsed'].push(id);
        }
        return acc;
      }, {expanded: [], collapsed: [], version: 2});
    },
    restore: function(state) {
      var self = this;
      if (state.version > 1) {
        state.expanded.map(this.expand.bind(this));
        state.collapsed.map(this.collapse.bind(this));
      }
      else {
        Object.keys(state).forEach(function(id) {
          self.setExpanded(id, state[id] === 'expanded');
        });
      }
    },
    insertInput: function(listItem) {
      var type = this.options.createInputs;
      if (listItem.find('> input[type=' + type + ']').length) return;
      var id = this.inputIdFor(listItem);
      var checkbox = $('<input type="' + type + '" name="'
        + this.inputNameFor(listItem) + '" id="' + id + '" /> '
      );
      var children = listItem.children();
      // get the first text node for the label
      var text = listItem.contents().filter(function() {
        return this.nodeType == 3;
      }).first();
      checkbox.val(listItem.data('value'));
      checkbox.prop('checked', listItem.data('checked'))
      children.detach();
      listItem.append(checkbox)
        .append(
          $('<label for="' + id + '">').append(text.length > 0 ? text : children.first())
        )
        .append(text.length > 0 ? children : children.slice(1));
    },
    checkboxPrefix: 'bonsai-checkbox-',
    inputIdFor: function(listItem) {
      var id = $(listItem).data('id');
      while (!id || ($('#' + id).length > 0)) {
        id = this.checkboxPrefix + Bonsai.uniqueId++;
      }
      return id;
    },
    inputNameFor: function(listItem) {
      return listItem.data('name')
        || listItem.parents().filter('[data-name]').data('name');
    },
    handleDuplicateCheckboxes: function() {
      var self = this;
      self.el.on('change', 'input[type=checkbox]', function(ev) {
        var checkbox = $(ev.target);
        if (!checkbox.val()) return;
        // select all duplicate checkboxes that need to be updated
        var selector = 'input[type=checkbox]'
          + '[value="' + checkbox.val() + '"]'
          + (checkbox.attr('name') ? '[name="' + checkbox.attr('name') + '"]' : '')
          + (checkbox.prop('checked') ? ':not(:checked)' : ':checked');
        self.el.find(selector).prop({
          checked: checkbox.prop('checked'),
          indeterminate: checkbox.prop('indeterminate')
        }).trigger('change');
      });
    },
    addExpandAllLink: function() {
      var self = this;
      $('<div class="expand-all">')
        .append(
          $('<a class="all">Expand all</a>').on('click', function() {
            self.expandAll();
          })
        )
        .append('<i class="separator"></i>')
        .append(
          $('<a class="none">Collapse all</a>').on('click', function() {
            self.collapseAll();
          })
        )
        .insertBefore(this.el);
    },
    addSelectAllLink: function() {
      var scope = this.options.scope;
      var self = this;
      function getCheckboxes() {
        // return all checkboxes that are not in hidden list items
        return scope.find('li')
          .filter(self.options.selectAllExclude || function() {
            return $(this).css('display') != 'none';
          })
          .find('> input[type=checkbox]');
      }
      $('<div class="check-all">')
        .append($('<a class="all">Select all</a>')
          .css('cursor', 'pointer')
          .on('click', function() {
            getCheckboxes().prop({
              checked: true,
              indeterminate: false
            });
          }))
        .append('<i class="separator"></i>')
        .append($('<a class="none">Select none</a>')
          .css('cursor', 'pointer')
          .on('click', function() {
            getCheckboxes().prop({
              checked: false,
              indeterminate: false
            });
          })
      )
        .insertAfter(this.el);
    },
    setCheckedValues: function(values) {
      var all = this.options.scope.find('input[type=checkbox]');
      $.each(values, function(key, value) {
        all.filter('[value="' + value + '"]')
          .prop('checked', true)
          .trigger('change');
      });
    }
  };
  $.extend(Bonsai, {
    uniqueId: 0
  });
}(jQuery));

/*
 *	jQuery dotdotdot 3.2.2
 *	@requires jQuery 1.7.0 or later
 *
 *	dotdotdot.frebsite.nl
 *
 *	Copyright (c) Fred Heusschen
 *	www.frebsite.nl
 *
 *	License: CC-BY-NC-4.0
 *	http://creativecommons.org/licenses/by-nc/4.0/
 */

(function( $ ) {
	'use strict';
	
	var _PLUGIN_    = 'dotdotdot';
	var _VERSION_   = '3.2.2';

	if ( $[ _PLUGIN_ ] && $[ _PLUGIN_ ].version > _VERSION_ )
	{
		return;
	}



	/*
		The class
	*/
	$[ _PLUGIN_ ] = function( $container, opts )
	{
		this.$dot 	= $container;
		this.api	= [ 'getInstance', 'truncate', 'restore', 'destroy', 'watch', 'unwatch' ];
		this.opts	= opts;

		var oldAPI = this.$dot.data( _PLUGIN_ );
		if ( oldAPI )
		{
			oldAPI.destroy();
		}

		this.init();
		this.truncate();

		if ( this.opts.watch )
		{
			this.watch();
		}

		return this;
	};

	$[ _PLUGIN_ ].version 	= _VERSION_;
	$[ _PLUGIN_ ].uniqueId 	= 0;

	$[ _PLUGIN_ ].defaults  = {
		ellipsis		: '\u2026 ',
		callback		: function( isTruncated ) {},
		truncate 		: 'word',
		tolerance		: 0,
		keep			: null,
		watch			: 'window',
		height 			: null
	};


	$[ _PLUGIN_ ].prototype = {

		init: function()
		{
			this.watchTimeout		= null;
			this.watchInterval		= null;
			this.uniqueId 			= $[ _PLUGIN_ ].uniqueId++;
			this.originalStyle		= this.$dot.attr( 'style' ) || '';
			this.originalContent 	= this._getOriginalContent();
			
			if ( this.$dot.css( 'word-wrap' ) !== 'break-word' )
			{
				this.$dot.css( 'word-wrap', 'break-word' );
			}
			if ( this.$dot.css( 'white-space' ) === 'nowrap' )
			{
				this.$dot.css( 'white-space', 'normal' );
			}

			if ( this.opts.height === null )
			{
				this.opts.height = this._getMaxHeight();
			}

			if ( typeof this.opts.ellipsis == 'string' )
			{
				this.opts.ellipsis = document.createTextNode( this.opts.ellipsis );
			}
		},

		getInstance: function()
		{
			return this;
		},

		truncate: function()
		{
			var that = this;


			//	Add inner node for measuring the height
			this.$inner = this.$dot
				.wrapInner( '<div />' )
				.children()
				.css({
					'display'	: 'block',
					'height'	: 'auto',
					'width'		: 'auto',
					'border'	: 'none',
					'padding'	: 0,
					'margin'	: 0
				});


			//	Set original content
			this.$inner
				.empty()
				.append( this.originalContent.clone( true ) );


			//	Get max height
			this.maxHeight = this._getMaxHeight();


			//	Truncate the text
			var isTruncated = false;
			if ( !this._fits() )
			{
				isTruncated = true;
				this._truncateToNode( this.$inner[ 0 ] );
			}

			this.$dot[ isTruncated ? 'addClass' : 'removeClass' ]( _c.truncated );


			//	Remove inner node
			this.$inner.replaceWith( this.$inner.contents() );
			this.$inner = null;


			//	 Callback
			this.opts.callback.call( this.$dot[ 0 ], isTruncated );

			return isTruncated;
		},

		restore: function()
		{
			this.unwatch();

			this.$dot
				.empty()
				.append( this.originalContent )
				.attr( 'style', this.originalStyle )
				.removeClass( _c.truncated );
		},

		destroy: function()
		{
			this.restore();
			this.$dot.data( _PLUGIN_, null );
		},

		watch: function()
		{
			var that = this;

			this.unwatch();

			var oldSizes = {};

			if ( this.opts.watch == 'window' )
			{
				$wndw.on(
					_e.resize + that.uniqueId,
					function( e )
					{
						if ( that.watchTimeout )
						{
							clearTimeout( that.watchTimeout );
						}
						that.watchTimeout = setTimeout(
							function() {

								oldSizes = that._watchSizes( oldSizes, $wndw, 'width', 'height' );

							}, 100
						);
					}
				);

			}
			else
			{
				this.watchInterval = setInterval(
					function()
					{
						oldSizes = that._watchSizes( oldSizes, that.$dot, 'innerWidth', 'innerHeight' );

					}, 500
				);
			}
		},

		unwatch: function()
		{
			$wndw.off( _e.resize + this.uniqueId );

			if ( this.watchInterval )
			{
				clearInterval( this.watchInterval );
			}

			if ( this.watchTimeout )
			{
				clearTimeout( this.watchTimeout );
			}
		},

		_api: function()
		{
			var that = this,
				api = {};

			$.each( this.api,
				function( i )
				{
					var fn = this;
					api[ fn ] = function()
					{
						var re = that[ fn ].apply( that, arguments );
						return ( typeof re == 'undefined' ) ? api : re;
					};
				}
			);
			return api;
		},

		_truncateToNode: function( _elem )
		{

			var that = this;

			var _coms = [],
				_elms = [];

			//	Empty the node 
			//		-> replace all contents with comments
			$(_elem)
				.contents()
				.each(
					function()
					{
						var $e = $(this);
						if ( !$e.hasClass( _c.keep ) )
						{
							var c = document.createComment( '' );
							$e.replaceWith( c );

							_elms.push( this );
							_coms.push( c );
						}
					}
				);

			if ( !_elms.length )
			{
				return;
			}

			//	Re-fill the node 
			//		-> replace comments with contents until it doesn't fit anymore
			for ( var e = 0; e < _elms.length; e++ )
			{

				$(_coms[ e ]).replaceWith( _elms[ e ] );

				$(_elms[ e ]).append( this.opts.ellipsis );
				var fits = this._fits();
				$(this.opts.ellipsis, _elms[ e ]).remove();

				if ( !fits )
				{
					if ( this.opts.truncate == 'node' && e > 1 )
					{
						$(_elms[ e - 2 ]).remove();
						return;
					}
					break;
				}
			}

			//	Remove left over comments
			for ( var c = e; c < _coms.length; c++ )
			{
				$(_coms[ c ]).remove();
			}

			//	Get last node 
			//		-> the node that overflows

			var _last = _elms[ Math.max( 0, Math.min( e, _elms.length - 1 ) ) ];

			//	Border case
			//		-> the last node with only an ellipsis in it...
			if ( _last.nodeType == 1 )
			{

				var $e = $('<' + _last.nodeName + ' />');
				$e.append( this.opts.ellipsis );

				$(_last).replaceWith( $e );

				//	... fits
				//		-> Restore the full last node
				if ( this._fits() )
				{
					$e.replaceWith( _last );
				}

				//	... doesn't fit
				//		-> remove it and go back one node
				else
				{
					$e.remove();
					_last = _elms[ Math.max( 0, e - 1 ) ];
				}
			}

			//	Proceed inside last node
			if ( _last.nodeType == 1 )
			{
				this._truncateToNode( _last );
			}
			else
			{
				this._truncateToWord( _last );
			}
		},

		_truncateToWord: function( _elem )
		{

			var e = _elem;

			var that = this;

			var txt = this.__getTextContent( e ),
				sep = ( txt.indexOf( ' ' ) !== -1 ) ? ' ' : '\u3000',
				arr = txt.split( sep ),
				str = '';

			for ( var a = arr.length; a >= 0; a-- )
			{
				str = arr.slice( 0, a ).join( sep );

				that.__setTextContent( e, that._addEllipsis( str ) );

				if ( that._fits() )
				{
					if ( that.opts.truncate == 'letter' )
					{
						that.__setTextContent( e, arr.slice( 0, a + 1 ).join( sep ) );
						that._truncateToLetter( e );
					}
					break;
				}
			}
		},

		_truncateToLetter: function( e )
		{
			var that = this;

			var txt = this.__getTextContent( e ),
				arr = txt.split( '' ),
				str = '';

			for ( var a = arr.length; a >= 0; a-- )
			{
				str = arr.slice( 0, a ).join( '' );

				if ( !str.length )
				{
					continue;
				}

				that.__setTextContent( e, that._addEllipsis( str ) );

				if ( that._fits() )
				{
					break;
				}
			}
		},

		_fits: function()
		{
			return ( this.$inner.innerHeight() <= this.maxHeight + this.opts.tolerance );
		},

		_addEllipsis: function( txt )
		{
			var remove = [' ', '\u3000', ',', ';', '.', '!', '?'];

			while ( $.inArray( txt.slice( -1 ), remove ) > -1 )
			{
				txt = txt.slice( 0, -1 );
			}
			txt += this.__getTextContent( this.opts.ellipsis );

			return txt;
		},

		_getOriginalContent: function()
		{
			var that = this;

			//	Add "keep" class to nodes to keep
			this.$dot
				.find( 'script, style' )
				.addClass( _c.keep );

			if ( this.opts.keep )
			{
				this.$dot
					.find( this.opts.keep )
					.addClass( _c.keep );
			}

			//	Filter out unneeded whitespace
			this.$dot
				.find( '*' )
				.not( '.' + _c.keep )
				.add( this.$dot )
				.contents()
				.each(
					function()
					{

						var e = this,
							$e = $(this);

						//	Text nodes
						if ( e.nodeType == 3 )
						{

							//	Remove whitespace where it does not take up space in the DOM
							if ( $.trim( that.__getTextContent( e ) ) == '' )
							{
								if ( $e.parent().is( 'table, thead, tbody, tfoot, tr, dl, ul, ol, video' ) )
								{
									$e.remove();
									return;
								}
								if ( $e.prev().is( 'div, p, table, td, td, dt, dd, li' ) )
								{
									$e.remove();
									return;
								}
								if ( $e.next().is( 'div, p, table, td, td, dt, dd, li' ) )
								{
									$e.remove();
									return;
								}
								if ( !$e.prev().length )
								{
									$e.remove();
									return;
								}
								if ( !$e.next().length )
								{
									$e.remove();
									return;
								}
							}
						}

						//	Comment nodes
						else if ( e.nodeType == 8 )
						{
							$e.remove();
						}

					}
				);

			return this.$dot.contents();
		},

		_getMaxHeight: function()
		{
			if ( typeof this.opts.height == 'number' )
			{
				return this.opts.height;
			}

			//	Find smallest CSS height
			var arr = [ 'maxHeight', 'height' ],
				hgh = 0;
 
			for ( var a = 0; a < arr.length; a++ )
			{
				hgh = window.getComputedStyle( this.$dot[ 0 ] )[ arr[ a ] ];
				if ( hgh.slice( -2 ) == 'px' )
				{
					hgh = parseFloat( hgh );
					break;
				}
			}

			//	Remove padding-top/bottom when needed.
			var arr = [];
			switch ( this.$dot.css( 'boxSizing' ) )
			{
				case 'border-box':
					arr.push( 'borderTopWidth' );
					arr.push( 'borderBottomWidth' );
					//	no break -> padding needs to be added too

				case 'padding-box':
					arr.push( 'paddingTop' );
					arr.push( 'paddingBottom' );
					break;
			}
			for ( var a = 0; a < arr.length; a++ )
			{
				var p = window.getComputedStyle( this.$dot[ 0 ] )[ arr[ a ] ];
				if ( p.slice( -2 ) == 'px' )
				{
					hgh -= parseFloat( p );
				}
			}

			//	Sanitize
			return Math.max( hgh, 0 );
		},

		_watchSizes: function( oldSizes, $elem, width, height )
		{
			if ( this.$dot.is( ':visible' ) )
			{
				var newSizes = {
					'width'		: $elem[ width  ](),
					'height'	: $elem[ height ]()
				};

				if ( oldSizes.width != newSizes.width || oldSizes.height != newSizes.height )
				{
					this.truncate();
				}

				return newSizes;
			}
			return oldSizes;
		},

		__getTextContent: function( elem )
		{
			var arr = [ 'nodeValue', 'textContent', 'innerText' ];
			for ( var a = 0; a < arr.length; a++ )
			{
				if ( typeof elem[ arr[ a ] ] == 'string' )
				{
					return elem[ arr[ a ] ];
				}
			}
			return '';
		},
		__setTextContent: function( elem, content )
		{
			var arr = [ 'nodeValue', 'textContent', 'innerText' ];
			for ( var a = 0; a < arr.length; a++ )
			{
				elem[ arr[ a ] ] = content;
			}
		}
	};



	/*
		The jQuery plugin
	*/
	$.fn[ _PLUGIN_ ] = function( opts )
	{
		initPlugin();

		opts = $.extend( true, {}, $[ _PLUGIN_ ].defaults, opts );

		return this.each(
			function()
			{
				$(this).data( _PLUGIN_, new $[ _PLUGIN_ ]( $(this), opts )._api() );
			}
		);
	};



	/*
		Global variables
	*/
	var _c, _d, _e, $wndw;

	function initPlugin()
	{
		$wndw = $(window);

		//	Classnames, Datanames, Eventnames
		_c = {};
		_d = {};
		_e = {};

		$.each( [ _c, _d, _e ],
			function( i, o )
			{
				o.add = function( a )
				{
					a = a.split( ' ' );
					for ( var b = 0, l = a.length; b < l; b++ )
					{
						o[ a[ b ] ] = o.ddd( a[ b ] );
					}
				};
			}
		);

		//	Classnames
		_c.ddd = function( c ) { return 'ddd-' + c; };
		_c.add( 'truncated keep' );

		//	Datanames
		_d.ddd = function( d ) { return 'ddd-' + d; };

		//	Eventnames
		_e.ddd = function( e ) { return e + '.ddd'; };
		_e.add( 'resize' );


		//	Only once
		initPlugin = function() {};

	}


})( jQuery );

/*!
 *         ,/
 *       ,'/
 *     ,' /
 *   ,'  /_____,
 * .'____    ,'
 *      /  ,'
 *     / ,'
 *    /,'
 *   /'
 *
 * Selectric ϟ v1.13.0 (Aug 21 2017) - http://lcdsantos.github.io/jQuery-Selectric/
 *
 * Copyright (c) 2017 Leonardo Santos; MIT License
 *
 */

(function(factory) {
  /* global define */
  /* istanbul ignore next */
  if ( typeof define === 'function' && define.amd ) {
    define(['jquery'], factory);
  } else if ( typeof module === 'object' && module.exports ) {
    // Node/CommonJS
    module.exports = function( root, jQuery ) {
      if ( jQuery === undefined ) {
        if ( typeof window !== 'undefined' ) {
          jQuery = require('jquery');
        } else {
          jQuery = require('jquery')(root);
        }
      }
      factory(jQuery);
      return jQuery;
    };
  } else {
    // Browser globals
    factory(jQuery);
  }
}(function($) {
  'use strict';

  var $doc = $(document);
  var $win = $(window);

  var pluginName = 'selectric';
  var classList = 'Input Items Open Disabled TempShow HideSelect Wrapper Focus Hover Responsive Above Below Scroll Group GroupLabel';
  var eventNamespaceSuffix = '.sl';

  var chars = ['a', 'e', 'i', 'o', 'u', 'n', 'c', 'y'];
  var diacritics = [
    /[\xE0-\xE5]/g, // a
    /[\xE8-\xEB]/g, // e
    /[\xEC-\xEF]/g, // i
    /[\xF2-\xF6]/g, // o
    /[\xF9-\xFC]/g, // u
    /[\xF1]/g,      // n
    /[\xE7]/g,      // c
    /[\xFD-\xFF]/g  // y
  ];

  /**
   * Create an instance of Selectric
   *
   * @constructor
   * @param {Node} element - The &lt;select&gt; element
   * @param {object}  opts - Options
   */
  var Selectric = function(element, opts) {
    var _this = this;

    _this.element = element;
    _this.$element = $(element);

    _this.state = {
      multiple       : !!_this.$element.attr('multiple'),
      enabled        : false,
      opened         : false,
      currValue      : -1,
      selectedIdx    : -1,
      highlightedIdx : -1
    };

    _this.eventTriggers = {
      open    : _this.open,
      close   : _this.close,
      destroy : _this.destroy,
      refresh : _this.refresh,
      init    : _this.init
    };

    _this.init(opts);
  };

  Selectric.prototype = {
    utils: {
      /**
       * Detect mobile browser
       *
       * @return {boolean}
       */
      isMobile: function() {
        return /android|ip(hone|od|ad)/i.test(navigator.userAgent);
      },

      /**
       * Escape especial characters in string (https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions)
       *
       * @param  {string} str - The string to be escaped
       * @return {string}       The string with the special characters escaped
       */
      escapeRegExp: function(str) {
        return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); // $& means the whole matched string
      },

      /**
       * Replace diacritics
       *
       * @param  {string} str - The string to replace the diacritics
       * @return {string}       The string with diacritics replaced with ascii characters
       */
      replaceDiacritics: function(str) {
        var k = diacritics.length;

        while (k--) {
          str = str.toLowerCase().replace(diacritics[k], chars[k]);
        }

        return str;
      },

      /**
       * Format string
       * https://gist.github.com/atesgoral/984375
       *
       * @param  {string} f - String to be formated
       * @return {string}     String formated
       */
      format: function(f) {
        var a = arguments; // store outer arguments
        return ('' + f) // force format specifier to String
          .replace( // replace tokens in format specifier
            /\{(?:(\d+)|(\w+))\}/g, // match {token} references
            function(
              s, // the matched string (ignored)
              i, // an argument index
              p // a property name
            ) {
              return p && a[1] // if property name and first argument exist
                ? a[1][p] // return property from first argument
                : a[i]; // assume argument index and return i-th argument
            });
      },

      /**
       * Get the next enabled item in the options list.
       *
       * @param  {object} selectItems - The options object.
       * @param  {number}    selected - Index of the currently selected option.
       * @return {object}               The next enabled item.
       */
      nextEnabledItem: function(selectItems, selected) {
        while ( selectItems[ selected = (selected + 1) % selectItems.length ].disabled ) {
          // empty
        }
        return selected;
      },

      /**
       * Get the previous enabled item in the options list.
       *
       * @param  {object} selectItems - The options object.
       * @param  {number}    selected - Index of the currently selected option.
       * @return {object}               The previous enabled item.
       */
      previousEnabledItem: function(selectItems, selected) {
        while ( selectItems[ selected = (selected > 0 ? selected : selectItems.length) - 1 ].disabled ) {
          // empty
        }
        return selected;
      },

      /**
       * Transform camelCase string to dash-case.
       *
       * @param  {string} str - The camelCased string.
       * @return {string}       The string transformed to dash-case.
       */
      toDash: function(str) {
        return str.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase();
      },

      /**
       * Calls the events registered with function name.
       *
       * @param {string}    fn - The name of the function.
       * @param {number} scope - Scope that should be set on the function.
       */
      triggerCallback: function(fn, scope) {
        var elm = scope.element;
        var func = scope.options['on' + fn];
        var args = [elm].concat([].slice.call(arguments).slice(1));

        if ( $.isFunction(func) ) {
          func.apply(elm, args);
        }

        $(elm).trigger(pluginName + '-' + this.toDash(fn), args);
      },

      /**
       * Transform array list to concatenated string and remove empty values
       * @param  {array} arr - Class list
       * @return {string}      Concatenated string
       */
      arrayToClassname: function(arr) {
        var newArr = $.grep(arr, function(item) {
          return !!item;
        });

        return $.trim(newArr.join(' '));
      }
    },

    /** Initializes */
    init: function(opts) {
      var _this = this;

      // Set options
      _this.options = $.extend(true, {}, $.fn[pluginName].defaults, _this.options, opts);

      _this.utils.triggerCallback('BeforeInit', _this);

      // Preserve data
      _this.destroy(true);

      // Disable on mobile browsers
      if ( _this.options.disableOnMobile && _this.utils.isMobile() ) {
        _this.disableOnMobile = true;
        return;
      }

      // Get classes
      _this.classes = _this.getClassNames();

      // Create elements
      var input              = $('<input/>', { 'class': _this.classes.input, 'readonly': _this.utils.isMobile() });
      var items              = $('<div/>',   { 'class': _this.classes.items, 'tabindex': -1 });
      var itemsScroll        = $('<div/>',   { 'class': _this.classes.scroll });
      var wrapper            = $('<div/>',   { 'class': _this.classes.prefix, 'html': _this.options.arrowButtonMarkup });
      var label              = $('<span/>',  { 'class': 'label' });
      var outerWrapper       = _this.$element.wrap('<div/>').parent().append(wrapper.prepend(label), items, input);
      var hideSelectWrapper  = $('<div/>',   { 'class': _this.classes.hideselect });

      _this.elements = {
        input        : input,
        items        : items,
        itemsScroll  : itemsScroll,
        wrapper      : wrapper,
        label        : label,
        outerWrapper : outerWrapper
      };

      if ( _this.options.nativeOnMobile && _this.utils.isMobile() ) {
        _this.elements.input = undefined;
        hideSelectWrapper.addClass(_this.classes.prefix + '-is-native');

        _this.$element.on('change', function() {
          _this.refresh();
        });
      }

      _this.$element
        .on(_this.eventTriggers)
        .wrap(hideSelectWrapper);

      _this.originalTabindex = _this.$element.prop('tabindex');
      _this.$element.prop('tabindex', -1);

      _this.populate();
      _this.activate();

      _this.utils.triggerCallback('Init', _this);
    },

    /** Activates the plugin */
    activate: function() {
      var _this = this;
      var hiddenChildren = _this.elements.items.closest(':visible').children(':hidden').addClass(_this.classes.tempshow);
      var originalWidth = _this.$element.width();

      hiddenChildren.removeClass(_this.classes.tempshow);

      _this.utils.triggerCallback('BeforeActivate', _this);

      _this.elements.outerWrapper.prop('class',
        _this.utils.arrayToClassname([
          _this.classes.wrapper,
          _this.$element.prop('class').replace(/\S+/g, _this.classes.prefix + '-$&'),
          _this.options.responsive ? _this.classes.responsive : ''
        ])
      );

      if ( _this.options.inheritOriginalWidth && originalWidth > 0 ) {
        _this.elements.outerWrapper.width(originalWidth);
      }

      _this.unbindEvents();

      if ( !_this.$element.prop('disabled') ) {
        _this.state.enabled = true;

        // Not disabled, so... Removing disabled class
        _this.elements.outerWrapper.removeClass(_this.classes.disabled);

        // Remove styles from items box
        // Fix incorrect height when refreshed is triggered with fewer options
        _this.$li = _this.elements.items.removeAttr('style').find('li');

        _this.bindEvents();
      } else {
        _this.elements.outerWrapper.addClass(_this.classes.disabled);

        if ( _this.elements.input ) {
          _this.elements.input.prop('disabled', true);
        }
      }

      _this.utils.triggerCallback('Activate', _this);
    },

    /**
     * Generate classNames for elements
     *
     * @return {object} Classes object
     */
    getClassNames: function() {
      var _this = this;
      var customClass = _this.options.customClass;
      var classesObj = {};

      $.each(classList.split(' '), function(i, currClass) {
        var c = customClass.prefix + currClass;
        classesObj[currClass.toLowerCase()] = customClass.camelCase ? c : _this.utils.toDash(c);
      });

      classesObj.prefix = customClass.prefix;

      return classesObj;
    },

    /** Set the label text */
    setLabel: function() {
      var _this = this;
      var labelBuilder = _this.options.labelBuilder;

      if ( _this.state.multiple ) {
        // Make sure currentValues is an array
        var currentValues = $.isArray(_this.state.currValue) ? _this.state.currValue : [_this.state.currValue];
        // I'm not happy with this, but currentValues can be an empty
        // array and we need to fallback to the default option.
        currentValues = currentValues.length === 0 ? [0] : currentValues;

        var labelMarkup = $.map(currentValues, function(value) {
          return $.grep(_this.lookupItems, function(item) {
            return item.index === value;
          })[0]; // we don't want nested arrays here
        });

        labelMarkup = $.grep(labelMarkup, function(item) {
          // Hide default (please choose) if more then one element were selected.
          // If no option value were given value is set to option text by default
          if ( labelMarkup.length > 1 || labelMarkup.length === 0 ) {
            return $.trim(item.value) !== '';
          }
          return item;
        });

        labelMarkup = $.map(labelMarkup, function(item) {
          return $.isFunction(labelBuilder)
            ? labelBuilder(item)
            : _this.utils.format(labelBuilder, item);
        });

        // Limit the amount of selected values shown in label
        if ( _this.options.multiple.maxLabelEntries ) {
          if ( labelMarkup.length >= _this.options.multiple.maxLabelEntries + 1 ) {
            labelMarkup = labelMarkup.slice(0, _this.options.multiple.maxLabelEntries);
            labelMarkup.push(
              $.isFunction(labelBuilder)
                ? labelBuilder({ text: '...' })
                : _this.utils.format(labelBuilder, { text: '...' }));
          } else {
            labelMarkup.slice(labelMarkup.length - 1);
          }
        }
        _this.elements.label.html(labelMarkup.join(_this.options.multiple.separator));

      } else {
        var currItem = _this.lookupItems[_this.state.currValue];

        _this.elements.label.html(
          $.isFunction(labelBuilder)
            ? labelBuilder(currItem)
            : _this.utils.format(labelBuilder, currItem)
        );
      }
    },

    /** Get and save the available options */
    populate: function() {
      var _this = this;
      var $options = _this.$element.children();
      var $justOptions = _this.$element.find('option');
      var $selected = $justOptions.filter(':selected');
      var selectedIndex = $justOptions.index($selected);
      var currIndex = 0;
      var emptyValue = (_this.state.multiple ? [] : 0);

      if ( $selected.length > 1 && _this.state.multiple ) {
        selectedIndex = [];
        $selected.each(function() {
          selectedIndex.push($(this).index());
        });
      }

      _this.state.currValue = (~selectedIndex ? selectedIndex : emptyValue);
      _this.state.selectedIdx = _this.state.currValue;
      _this.state.highlightedIdx = _this.state.currValue;
      _this.items = [];
      _this.lookupItems = [];

      if ( $options.length ) {
        // Build options markup
        $options.each(function(i) {
          var $elm = $(this);

          if ( $elm.is('optgroup') ) {

            var optionsGroup = {
              element       : $elm,
              label         : $elm.prop('label'),
              groupDisabled : $elm.prop('disabled'),
              items         : []
            };

            $elm.children().each(function(i) {
              var $elm = $(this);

              optionsGroup.items[i] = _this.getItemData(currIndex, $elm, optionsGroup.groupDisabled || $elm.prop('disabled'));

              _this.lookupItems[currIndex] = optionsGroup.items[i];

              currIndex++;
            });

            _this.items[i] = optionsGroup;

          } else {

            _this.items[i] = _this.getItemData(currIndex, $elm, $elm.prop('disabled'));

            _this.lookupItems[currIndex] = _this.items[i];

            currIndex++;

          }
        });

        _this.setLabel();
        _this.elements.items.append( _this.elements.itemsScroll.html( _this.getItemsMarkup(_this.items) ) );
      }
    },

    /**
     * Generate items object data
     * @param  {integer} index      - Current item index
     * @param  {node}    $elm       - Current element node
     * @param  {boolean} isDisabled - Current element disabled state
     * @return {object}               Item object
     */
    getItemData: function(index, $elm, isDisabled) {
      var _this = this;

      return {
        index     : index,
        element   : $elm,
        value     : $elm.val(),
        className : $elm.prop('class'),
        text      : $elm.html(),
        slug      : $.trim(_this.utils.replaceDiacritics($elm.html())),
        selected  : $elm.prop('selected'),
        disabled  : isDisabled
      };
    },

    /**
     * Generate options markup
     *
     * @param  {object} items - Object containing all available options
     * @return {string}         HTML for the options box
     */
    getItemsMarkup: function(items) {
      var _this = this;
      var markup = '<ul>';

      if ( $.isFunction(_this.options.listBuilder) && _this.options.listBuilder ) {
        items = _this.options.listBuilder(items);
      }

      $.each(items, function(i, elm) {
        if ( elm.label !== undefined ) {

          markup += _this.utils.format('<ul class="{1}"><li class="{2}">{3}</li>',
            _this.utils.arrayToClassname([
              _this.classes.group,
              elm.groupDisabled ? 'disabled' : '',
              elm.element.prop('class')
            ]),
            _this.classes.grouplabel,
            elm.element.prop('label')
          );

          $.each(elm.items, function(i, elm) {
            markup += _this.getItemMarkup(elm.index, elm);
          });

          markup += '</ul>';

        } else {

          markup += _this.getItemMarkup(elm.index, elm);

        }
      });

      return markup + '</ul>';
    },

    /**
     * Generate every option markup
     *
     * @param  {number} index    - Index of current item
     * @param  {object} itemData - Current item
     * @return {string}            HTML for the option
     */
    getItemMarkup: function(index, itemData) {
      var _this = this;
      var itemBuilder = _this.options.optionsItemBuilder;
      // limit access to item data to provide a simple interface
      // to most relevant options.
      var filteredItemData = {
        value: itemData.value,
        text : itemData.text,
        slug : itemData.slug,
        index: itemData.index
      };

      return _this.utils.format('<li data-index="{1}" class="{2}">{3}</li>',
        index,
        _this.utils.arrayToClassname([
          itemData.className,
          index === _this.items.length - 1  ? 'last'     : '',
          itemData.disabled                 ? 'disabled' : '',
          itemData.selected                 ? 'selected' : ''
        ]),
        $.isFunction(itemBuilder)
          ? _this.utils.format(itemBuilder(itemData, this.$element, index), itemData)
          : _this.utils.format(itemBuilder, filteredItemData)
      );
    },

    /** Remove events on the elements */
    unbindEvents: function() {
      var _this = this;

      _this.elements.wrapper
        .add(_this.$element)
        .add(_this.elements.outerWrapper)
        .add(_this.elements.input)
        .off(eventNamespaceSuffix);
    },

    /** Bind events on the elements */
    bindEvents: function() {
      var _this = this;

      _this.elements.outerWrapper.on('mouseenter' + eventNamespaceSuffix + ' mouseleave' + eventNamespaceSuffix, function(e) {
        $(this).toggleClass(_this.classes.hover, e.type === 'mouseenter');

        // Delay close effect when openOnHover is true
        if ( _this.options.openOnHover ) {
          clearTimeout(_this.closeTimer);

          if ( e.type === 'mouseleave' ) {
            _this.closeTimer = setTimeout($.proxy(_this.close, _this), _this.options.hoverIntentTimeout);
          } else {
            _this.open();
          }
        }
      });

      // Toggle open/close
      _this.elements.wrapper.on('click' + eventNamespaceSuffix, function(e) {
        _this.state.opened ? _this.close() : _this.open(e);
      });

      // Translate original element focus event to dummy input.
      // Disabled on mobile devices because the default option list isn't
      // shown due the fact that hidden input gets focused
      if ( !(_this.options.nativeOnMobile && _this.utils.isMobile()) ) {
        _this.$element.on('focus' + eventNamespaceSuffix, function() {
          _this.elements.input.focus();
        });

        _this.elements.input
          .prop({ tabindex: _this.originalTabindex, disabled: false })
          .on('keydown' + eventNamespaceSuffix, $.proxy(_this.handleKeys, _this))
          .on('focusin' + eventNamespaceSuffix, function(e) {
            _this.elements.outerWrapper.addClass(_this.classes.focus);

            // Prevent the flicker when focusing out and back again in the browser window
            _this.elements.input.one('blur', function() {
              _this.elements.input.blur();
            });

            if ( _this.options.openOnFocus && !_this.state.opened ) {
              _this.open(e);
            }
          })
          .on('focusout' + eventNamespaceSuffix, function() {
            _this.elements.outerWrapper.removeClass(_this.classes.focus);
          })
          .on('input propertychange', function() {
            var val = _this.elements.input.val();
            var searchRegExp = new RegExp('^' + _this.utils.escapeRegExp(val), 'i');

            // Clear search
            clearTimeout(_this.resetStr);
            _this.resetStr = setTimeout(function() {
              _this.elements.input.val('');
            }, _this.options.keySearchTimeout);

            if ( val.length ) {
              // Search in select options
              $.each(_this.items, function(i, elm) {
                if ( !elm.disabled && searchRegExp.test(elm.text) || searchRegExp.test(elm.slug) ) {
                  _this.highlight(i);
                  return;
                }
              });
            }
          });
      }

      _this.$li.on({
        // Prevent <input> blur on Chrome
        mousedown: function(e) {
          e.preventDefault();
          e.stopPropagation();
        },
        click: function() {
          _this.select($(this).data('index'));

          // Chrome doesn't close options box if select is wrapped with a label
          // We need to 'return false' to avoid that
          return false;
        }
      });
    },

    /**
     * Behavior when keyboard keys is pressed
     *
     * @param {object} e - Event object
     */
    handleKeys: function(e) {
      var _this = this;
      var key = e.which;
      var keys = _this.options.keys;

      var isPrevKey = $.inArray(key, keys.previous) > -1;
      var isNextKey = $.inArray(key, keys.next) > -1;
      var isSelectKey = $.inArray(key, keys.select) > -1;
      var isOpenKey = $.inArray(key, keys.open) > -1;
      var idx = _this.state.highlightedIdx;
      var isFirstOrLastItem = (isPrevKey && idx === 0) || (isNextKey && (idx + 1) === _this.items.length);
      var goToItem = 0;

      // Enter / Space
      if ( key === 13 || key === 32 ) {
        e.preventDefault();
      }

      // If it's a directional key
      if ( isPrevKey || isNextKey ) {
        if ( !_this.options.allowWrap && isFirstOrLastItem ) {
          return;
        }

        if ( isPrevKey ) {
          goToItem = _this.utils.previousEnabledItem(_this.lookupItems, idx);
        }

        if ( isNextKey ) {
          goToItem = _this.utils.nextEnabledItem(_this.lookupItems, idx);
        }

        _this.highlight(goToItem);
      }

      // Tab / Enter / ESC
      if ( isSelectKey && _this.state.opened ) {
        _this.select(idx);

        if ( !_this.state.multiple || !_this.options.multiple.keepMenuOpen ) {
          _this.close();
        }

        return;
      }

      // Space / Enter / Left / Up / Right / Down
      if ( isOpenKey && !_this.state.opened ) {
        _this.open();
      }
    },

    /** Update the items object */
    refresh: function() {
      var _this = this;

      _this.populate();
      _this.activate();
      _this.utils.triggerCallback('Refresh', _this);
    },

    /** Set options box width/height */
    setOptionsDimensions: function() {
      var _this = this;

      // Calculate options box height
      // Set a temporary class on the hidden parent of the element
      var hiddenChildren = _this.elements.items.closest(':visible').children(':hidden').addClass(_this.classes.tempshow);
      var maxHeight = _this.options.maxHeight;
      var itemsWidth = _this.elements.items.outerWidth();
      var wrapperWidth = _this.elements.wrapper.outerWidth() - (itemsWidth - _this.elements.items.width());

      // Set the dimensions, minimum is wrapper width, expand for long items if option is true
      if ( !_this.options.expandToItemText || wrapperWidth > itemsWidth ) {
        _this.finalWidth = wrapperWidth;
      } else {
        // Make sure the scrollbar width is included
        _this.elements.items.css('overflow', 'scroll');

        // Set a really long width for _this.elements.outerWrapper
        _this.elements.outerWrapper.width(9e4);
        _this.finalWidth = _this.elements.items.width();
        // Set scroll bar to auto
        _this.elements.items.css('overflow', '');
        _this.elements.outerWrapper.width('');
      }

      _this.elements.items.width(_this.finalWidth).height() > maxHeight && _this.elements.items.height(maxHeight);

      // Remove the temporary class
      hiddenChildren.removeClass(_this.classes.tempshow);
    },

    /** Detect if the options box is inside the window */
    isInViewport: function() {
      var _this = this;

      if (_this.options.forceRenderAbove === true) {
        _this.elements.outerWrapper.addClass(_this.classes.above);
      } else if (_this.options.forceRenderBelow === true) {
        _this.elements.outerWrapper.addClass(_this.classes.below);
      } else {
        var scrollTop = $win.scrollTop();
        var winHeight = $win.height();
        var uiPosX = _this.elements.outerWrapper.offset().top;
        var uiHeight = _this.elements.outerWrapper.outerHeight();

        var fitsDown = (uiPosX + uiHeight + _this.itemsHeight) <= (scrollTop + winHeight);
        var fitsAbove = (uiPosX - _this.itemsHeight) > scrollTop;

        // If it does not fit below, only render it
        // above it fit's there.
        // It's acceptable that the user needs to
        // scroll the viewport to see the cut off UI
        var renderAbove = !fitsDown && fitsAbove;
        var renderBelow = !renderAbove;

        _this.elements.outerWrapper.toggleClass(_this.classes.above, renderAbove);
        _this.elements.outerWrapper.toggleClass(_this.classes.below, renderBelow);
      }
    },

    /**
     * Detect if currently selected option is visible and scroll the options box to show it
     *
     * @param {Number|Array} index - Index of the selected items
     */
    detectItemVisibility: function(index) {
      var _this = this;
      var $filteredLi = _this.$li.filter('[data-index]');

      if ( _this.state.multiple ) {
        // If index is an array, we can assume a multiple select and we
        // want to scroll to the uppermost selected item!
        // Math.min.apply(Math, index) returns the lowest entry in an Array.
        index = ($.isArray(index) && index.length === 0) ? 0 : index;
        index = $.isArray(index) ? Math.min.apply(Math, index) : index;
      }

      var liHeight = $filteredLi.eq(index).outerHeight();
      var liTop = $filteredLi[index].offsetTop;
      var itemsScrollTop = _this.elements.itemsScroll.scrollTop();
      var scrollT = liTop + liHeight * 2;

      _this.elements.itemsScroll.scrollTop(
        scrollT > itemsScrollTop + _this.itemsHeight ? scrollT - _this.itemsHeight :
          liTop - liHeight < itemsScrollTop ? liTop - liHeight :
            itemsScrollTop
      );
    },

    /**
     * Open the select options box
     *
     * @param {Event} e - Event
     */
    open: function(e) {
      var _this = this;

      if ( _this.options.nativeOnMobile && _this.utils.isMobile()) {
        return false;
      }

      _this.utils.triggerCallback('BeforeOpen', _this);

      if ( e ) {
        e.preventDefault();
        if (_this.options.stopPropagation) {
          e.stopPropagation();
        }
      }

      if ( _this.state.enabled ) {
        _this.setOptionsDimensions();

        // Find any other opened instances of select and close it
        $('.' + _this.classes.hideselect, '.' + _this.classes.open).children()[pluginName]('close');

        _this.state.opened = true;
        _this.itemsHeight = _this.elements.items.outerHeight();
        _this.itemsInnerHeight = _this.elements.items.height();

        // Toggle options box visibility
        _this.elements.outerWrapper.addClass(_this.classes.open);

        // Give dummy input focus
        _this.elements.input.val('');
        if ( e && e.type !== 'focusin' ) {
          _this.elements.input.focus();
        }

        // Delayed binds events on Document to make label clicks work
        setTimeout(function() {
          $doc
            .on('click' + eventNamespaceSuffix, $.proxy(_this.close, _this))
            .on('scroll' + eventNamespaceSuffix, $.proxy(_this.isInViewport, _this));
        }, 1);

        _this.isInViewport();

        // Prevent window scroll when using mouse wheel inside items box
        if ( _this.options.preventWindowScroll ) {
          /* istanbul ignore next */
          $doc.on('mousewheel' + eventNamespaceSuffix + ' DOMMouseScroll' + eventNamespaceSuffix, '.' + _this.classes.scroll, function(e) {
            var orgEvent = e.originalEvent;
            var scrollTop = $(this).scrollTop();
            var deltaY = 0;

            if ( 'detail'      in orgEvent ) { deltaY = orgEvent.detail * -1; }
            if ( 'wheelDelta'  in orgEvent ) { deltaY = orgEvent.wheelDelta;  }
            if ( 'wheelDeltaY' in orgEvent ) { deltaY = orgEvent.wheelDeltaY; }
            if ( 'deltaY'      in orgEvent ) { deltaY = orgEvent.deltaY * -1; }

            if ( scrollTop === (this.scrollHeight - _this.itemsInnerHeight) && deltaY < 0 || scrollTop === 0 && deltaY > 0 ) {
              e.preventDefault();
            }
          });
        }

        _this.detectItemVisibility(_this.state.selectedIdx);

        _this.highlight(_this.state.multiple ? -1 : _this.state.selectedIdx);

        _this.utils.triggerCallback('Open', _this);
      }
    },

    /** Close the select options box */
    close: function() {
      var _this = this;

      _this.utils.triggerCallback('BeforeClose', _this);

      // Remove custom events on document
      $doc.off(eventNamespaceSuffix);

      // Remove visible class to hide options box
      _this.elements.outerWrapper.removeClass(_this.classes.open);

      _this.state.opened = false;

      _this.utils.triggerCallback('Close', _this);
    },

    /** Select current option and change the label */
    change: function() {
      var _this = this;

      _this.utils.triggerCallback('BeforeChange', _this);

      if ( _this.state.multiple ) {
        // Reset old selected
        $.each(_this.lookupItems, function(idx) {
          _this.lookupItems[idx].selected = false;
          _this.$element.find('option').prop('selected', false);
        });

        // Set new selected
        $.each(_this.state.selectedIdx, function(idx, value) {
          _this.lookupItems[value].selected = true;
          _this.$element.find('option').eq(value).prop('selected', true);
        });

        _this.state.currValue = _this.state.selectedIdx;

        _this.setLabel();

        _this.utils.triggerCallback('Change', _this);
      } else if ( _this.state.currValue !== _this.state.selectedIdx ) {
        // Apply changed value to original select
        _this.$element
          .prop('selectedIndex', _this.state.currValue = _this.state.selectedIdx)
          .data('value', _this.lookupItems[_this.state.selectedIdx].text);

        // Change label text
        _this.setLabel();

        _this.utils.triggerCallback('Change', _this);
      }
    },

    /**
     * Highlight option
     * @param {number} index - Index of the options that will be highlighted
     */
    highlight: function(index) {
      var _this = this;
      var $filteredLi = _this.$li.filter('[data-index]').removeClass('highlighted');

      _this.utils.triggerCallback('BeforeHighlight', _this);

      // Parameter index is required and should not be a disabled item
      if ( index === undefined || index === -1 || _this.lookupItems[index].disabled ) {
        return;
      }

      $filteredLi
        .eq(_this.state.highlightedIdx = index)
        .addClass('highlighted');

      _this.detectItemVisibility(index);

      _this.utils.triggerCallback('Highlight', _this);
    },

    /**
     * Select option
     *
     * @param {number} index - Index of the option that will be selected
     */
    select: function(index) {
      var _this = this;
      var $filteredLi = _this.$li.filter('[data-index]');

      _this.utils.triggerCallback('BeforeSelect', _this, index);

      // Parameter index is required and should not be a disabled item
      if ( index === undefined || index === -1 || _this.lookupItems[index].disabled ) {
        return;
      }

      if ( _this.state.multiple ) {
        // Make sure selectedIdx is an array
        _this.state.selectedIdx = $.isArray(_this.state.selectedIdx) ? _this.state.selectedIdx : [_this.state.selectedIdx];

        var hasSelectedIndex = $.inArray(index, _this.state.selectedIdx);
        if ( hasSelectedIndex !== -1 ) {
          _this.state.selectedIdx.splice(hasSelectedIndex, 1);
        } else {
          _this.state.selectedIdx.push(index);
        }

        $filteredLi
          .removeClass('selected')
          .filter(function(index) {
            return $.inArray(index, _this.state.selectedIdx) !== -1;
          })
          .addClass('selected');
      } else {
        $filteredLi
          .removeClass('selected')
          .eq(_this.state.selectedIdx = index)
          .addClass('selected');
      }

      if ( !_this.state.multiple || !_this.options.multiple.keepMenuOpen ) {
        _this.close();
      }

      _this.change();

      _this.utils.triggerCallback('Select', _this, index);
    },

    /**
     * Unbind and remove
     *
     * @param {boolean} preserveData - Check if the data on the element should be removed too
     */
    destroy: function(preserveData) {
      var _this = this;

      if ( _this.state && _this.state.enabled ) {
        _this.elements.items.add(_this.elements.wrapper).add(_this.elements.input).remove();

        if ( !preserveData ) {
          _this.$element.removeData(pluginName).removeData('value');
        }

        _this.$element.prop('tabindex', _this.originalTabindex).off(eventNamespaceSuffix).off(_this.eventTriggers).unwrap().unwrap();

        _this.state.enabled = false;
      }
    }
  };

  // A really lightweight plugin wrapper around the constructor,
  // preventing against multiple instantiations
  $.fn[pluginName] = function(args) {
    return this.each(function() {
      var data = $.data(this, pluginName);

      if ( data && !data.disableOnMobile ) {
        (typeof args === 'string' && data[args]) ? data[args]() : data.init(args);
      } else {
        $.data(this, pluginName, new Selectric(this, args));
      }
    });
  };

  /**
   * Default plugin options
   *
   * @type {object}
   */
  $.fn[pluginName].defaults = {
    onChange             : function(elm) { $(elm).change(); },
    maxHeight            : 300,
    keySearchTimeout     : 500,
    arrowButtonMarkup    : '<b class="button">&#x25be;</b>',
    disableOnMobile      : false,
    nativeOnMobile       : true,
    openOnFocus          : true,
    openOnHover          : false,
    hoverIntentTimeout   : 500,
    expandToItemText     : false,
    responsive           : false,
    preventWindowScroll  : true,
    inheritOriginalWidth : false,
    allowWrap            : true,
    forceRenderAbove     : false,
    forceRenderBelow     : false,
    stopPropagation      : true,
    optionsItemBuilder   : '{text}', // function(itemData, element, index)
    labelBuilder         : '{text}', // function(currItem)
    listBuilder          : false,    // function(items)
    keys                 : {
      previous : [37, 38],                 // Left / Up
      next     : [39, 40],                 // Right / Down
      select   : [9, 13, 27],              // Tab / Enter / Escape
      open     : [13, 32, 37, 38, 39, 40], // Enter / Space / Left / Up / Right / Down
      close    : [9, 27]                   // Tab / Escape
    },
    customClass          : {
      prefix: pluginName,
      camelCase: false
    },
    multiple              : {
      separator: ', ',
      keepMenuOpen: true,
      maxLabelEntries: false
    }
  };
}));

/**
 * This library was changed 08/03/21
 * Every initialized element receives object as data attribute "menuAim"
 * This object provides method "destroy" that unbinds events.
 *
 * THIS IS A FORK IN ORDER TO PROVIDE A NPM PACKAGE OF IT!
 *
 * ORIGINAL:
 * Copyright © 2016 Ben Kamens | MIT license | https://github.com/kamens/jQuery-menu-aim
 *
 * menu-aim is a jQuery plugin for dropdown menus that can differentiate
 * between a user trying hover over a dropdown item vs trying to navigate into
 * a submenu's contents.
 *
 * menu-aim assumes that you have are using a menu with submenus that expand
 * to the menu's right. It will fire events when the user's mouse enters a new
 * dropdown item *and* when that item is being intentionally hovered over.
 *
 * __________________________
 * | Monkeys  >|   Gorilla  |
 * | Gorillas >|   Content  |
 * | Chimps   >|   Here     |
 * |___________|____________|
 *
 * In the above example, "Gorillas" is selected and its submenu content is
 * being shown on the right. Imagine that the user's cursor is hovering over
 * "Gorillas." When they move their mouse into the "Gorilla Content" area, they
 * may briefly hover over "Chimps." This shouldn't close the "Gorilla Content"
 * area.
 *
 * This problem is normally solved using timeouts and delays. menu-aim tries to
 * solve this by detecting the direction of the user's mouse movement. This can
 * make for quicker transitions when navigating up and down the menu. The
 * experience is hopefully similar to amazon.com/'s "Shop by Department"
 * dropdown.
 *
 * Use like so:
 *
 *      $("#menu").menuAim({
 *          activate: $.noop,  // fired on row activation
 *          deactivate: $.noop  // fired on row deactivation
 *      });
 *
 *  ...to receive events when a menu's row has been purposefully (de)activated.
 *
 * The following options can be passed to menuAim. All functions execute with
 * the relevant row's HTML element as the execution context ('this'):
 *
 *      .menuAim({
 *          // Function to call when a row is purposefully activated. Use this
 *          // to show a submenu's content for the activated row.
 *          activate: function() {},
 *
 *          // Function to call when a row is deactivated.
 *          deactivate: function() {},
 *
 *          // Function to call when mouse enters a menu row. Entering a row
 *          // does not mean the row has been activated, as the user may be
 *          // mousing over to a submenu.
 *          enter: function() {},
 *
 *          // Function to call when mouse exits a menu row.
 *          exit: function() {},
 *
 *          // Selector for identifying which elements in the menu are rows
 *          // that can trigger the above events. Defaults to "> li".
 *          rowSelector: "> li",
 *
 *          // You may have some menu rows that aren't submenus and therefore
 *          // shouldn't ever need to "activate." If so, filter submenu rows w/
 *          // this selector. Defaults to "*" (all elements).
 *          submenuSelector: "*",
 *
 *          // Direction the submenu opens relative to the main menu. Can be
 *          // left, right, above, or below. Defaults to "right".
 *          submenuDirection: "right"
 *      });
 *
*/
(function (factory) {
    if (typeof exports === 'object') {
        factory(require('jquery'));
    } else if (typeof define === 'function' && define.amd) {
        define(['jquery'], factory);
    } else {
        factory(jQuery);
    }
  }(function ($) {
      $.fn.menuAim = function(opts) {
          // Initialize menu-aim for all elements in jQuery collection
          this.each(function() {
              init.call(this, opts);
          });

          return this;
      };

      function init(opts) {
          var $menu = $(this),
              activeRow = null,
              mouseLocs = [],
              lastDelayLoc = null,
              timeoutId = null,
              options = $.extend({
                  rowSelector: "> li",
                  submenuSelector: "*",
                  submenuDirection: "right",
                  tolerance: 75,  // bigger = more forgivey when entering submenu
                  enter: $.noop,
                  exit: $.noop,
                  activate: $.noop,
                  deactivate: $.noop,
                  exitMenu: $.noop
              }, opts);

          var MOUSE_LOCS_TRACKED = 3,  // number of past mouse locations to track
              DELAY = 300;  // ms delay when user appears to be entering submenu

          /**
           * Keep track of the last few locations of the mouse.
           */
          var mousemoveDocument = function(e) {
                  mouseLocs.push({x: e.pageX, y: e.pageY});

                  if (mouseLocs.length > MOUSE_LOCS_TRACKED) {
                      mouseLocs.shift();
                  }
              };

          /**
           * Cancel possible row activations when leaving the menu entirely
           */
          var mouseleaveMenu = function() {
                  if (timeoutId) {
                      clearTimeout(timeoutId);
                  }

                  // If exitMenu is supplied and returns true, deactivate the
                  // currently active row on menu exit.
                  if (options.exitMenu(this)) {
                      if (activeRow) {
                          options.deactivate(activeRow);
                      }

                      activeRow = null;
                  }
              };

          /**
           * Trigger a possible row activation whenever entering a new row.
           */
          var mouseenterRow = function() {
                  if (timeoutId) {
                      // Cancel any previous activation delays
                      clearTimeout(timeoutId);
                  }

                  options.enter(this);
                  possiblyActivate(this);
              },
              mouseleaveRow = function() {
                  options.exit(this);
              };

          /*
           * Immediately activate a row if the user clicks on it.
           */
          var clickRow = function() {
                  activate(this);
              };

          /**
           * Activate a menu row.
           */
          var activate = function(row) {
                  if (row == activeRow) {
                      return;
                  }

                  if (activeRow) {
                      options.deactivate(activeRow);
                  }

                  options.activate(row);
                  activeRow = row;
              };

          /**
           * Possibly activate a menu row. If mouse movement indicates that we
           * shouldn't activate yet because user may be trying to enter
           * a submenu's content, then delay and check again later.
           */
          var possiblyActivate = function(row) {
                  var delay = activationDelay();

                  if (delay) {
                      timeoutId = setTimeout(function() {
                          possiblyActivate(row);
                      }, delay);
                  } else {
                      activate(row);
                  }
              };

          /**
           * Return the amount of time that should be used as a delay before the
           * currently hovered row is activated.
           *
           * Returns 0 if the activation should happen immediately. Otherwise,
           * returns the number of milliseconds that should be delayed before
           * checking again to see if the row should be activated.
           */
          var activationDelay = function() {
                  if (!activeRow || !$(activeRow).is(options.submenuSelector)) {
                      // If there is no other submenu row already active, then
                      // go ahead and activate immediately.
                      return 0;
                  }

                  var offset = $menu.offset(),
                      upperLeft = {
                          x: offset.left,
                          y: offset.top - options.tolerance
                      },
                      upperRight = {
                          x: offset.left + $menu.outerWidth(),
                          y: upperLeft.y
                      },
                      lowerLeft = {
                          x: offset.left,
                          y: offset.top + $menu.outerHeight() + options.tolerance
                      },
                      lowerRight = {
                          x: offset.left + $menu.outerWidth(),
                          y: lowerLeft.y
                      },
                      loc = mouseLocs[mouseLocs.length - 1],
                      prevLoc = mouseLocs[0];

                  if (!loc) {
                      return 0;
                  }

                  if (!prevLoc) {
                      prevLoc = loc;
                  }

                  if (prevLoc.x < offset.left || prevLoc.x > lowerRight.x ||
                      prevLoc.y < offset.top || prevLoc.y > lowerRight.y) {
                      // If the previous mouse location was outside of the entire
                      // menu's bounds, immediately activate.
                      return 0;
                  }

                  if (lastDelayLoc &&
                          loc.x == lastDelayLoc.x && loc.y == lastDelayLoc.y) {
                      // If the mouse hasn't moved since the last time we checked
                      // for activation status, immediately activate.
                      return 0;
                  }

                  // Detect if the user is moving towards the currently activated
                  // submenu.
                  //
                  // If the mouse is heading relatively clearly towards
                  // the submenu's content, we should wait and give the user more
                  // time before activating a new row. If the mouse is heading
                  // elsewhere, we can immediately activate a new row.
                  //
                  // We detect this by calculating the slope formed between the
                  // current mouse location and the upper/lower right points of
                  // the menu. We do the same for the previous mouse location.
                  // If the current mouse location's slopes are
                  // increasing/decreasing appropriately compared to the
                  // previous's, we know the user is moving toward the submenu.
                  //
                  // Note that since the y-axis increases as the cursor moves
                  // down the screen, we are looking for the slope between the
                  // cursor and the upper right corner to decrease over time, not
                  // increase (somewhat counterintuitively).
                  function slope(a, b) {
                      return (b.y - a.y) / (b.x - a.x);
                  };

                  var decreasingCorner = upperRight,
                      increasingCorner = lowerRight;

                  // Our expectations for decreasing or increasing slope values
                  // depends on which direction the submenu opens relative to the
                  // main menu. By default, if the menu opens on the right, we
                  // expect the slope between the cursor and the upper right
                  // corner to decrease over time, as explained above. If the
                  // submenu opens in a different direction, we change our slope
                  // expectations.
                  if (options.submenuDirection == "left") {
                      decreasingCorner = lowerLeft;
                      increasingCorner = upperLeft;
                  } else if (options.submenuDirection == "below") {
                      decreasingCorner = lowerRight;
                      increasingCorner = lowerLeft;
                  } else if (options.submenuDirection == "above") {
                      decreasingCorner = upperLeft;
                      increasingCorner = upperRight;
                  }

                  var decreasingSlope = slope(loc, decreasingCorner),
                      increasingSlope = slope(loc, increasingCorner),
                      prevDecreasingSlope = slope(prevLoc, decreasingCorner),
                      prevIncreasingSlope = slope(prevLoc, increasingCorner);

                  if (decreasingSlope < prevDecreasingSlope &&
                          increasingSlope > prevIncreasingSlope) {
                      // Mouse is moving from previous location towards the
                      // currently activated submenu. Delay before activating a
                      // new menu row, because user may be moving into submenu.
                      lastDelayLoc = loc;
                      return DELAY;
                  }

                  lastDelayLoc = null;
                  return 0;
              };

          /**
           * Hook up initial menu events
           */
          $menu
              .on('mouseleave', mouseleaveMenu)
              .find(options.rowSelector)
                  .on('mouseenter', mouseenterRow)
                  .on('mouseleave', mouseleaveRow)
                  .on('click', clickRow);

          $(document).on('mousemove', mousemoveDocument);

          /**
           * Adds object to initialized element.
           */
          $menu.data('menuAim', {
              /**
               * Unbinds events.
               */
              destroy: function () {
                  $menu
                      .off('mouseleave', mouseleaveMenu)
                      .find(options.rowSelector)
                          .off('mouseenter', mouseenterRow)
                          .off('mouseleave', mouseleaveRow)
                          .off('click', clickRow);

                  $(document).off('mousemove', mousemoveDocument);
              }
          });
      };
  }));

(function( $ ){
	$.fn.qrcode = function(options) {
		// if options is string, 
		if( typeof options === 'string' ){
			options	= { text: options };
		}

		// set default values
		// typeNumber < 1 for automatic calculation
		options	= $.extend( {}, {
			render		: "canvas",
			width		: 256,
			height		: 256,
			typeNumber	: -1,
			correctLevel	: QRErrorCorrectLevel.H,
                        background      : "#ffffff",
                        foreground      : "#000000"
		}, options);

		var createCanvas	= function(){
			// create the qrcode itself
			var qrcode	= new QRCode(options.typeNumber, options.correctLevel);
			qrcode.addData(options.text);
			qrcode.make();

			// create canvas element
			var canvas	= document.createElement('canvas');
			canvas.width	= options.width;
			canvas.height	= options.height;
			var ctx		= canvas.getContext('2d');

			// compute tileW/tileH based on options.width/options.height
			var tileW	= options.width  / qrcode.getModuleCount();
			var tileH	= options.height / qrcode.getModuleCount();

			// draw in the canvas
			for( var row = 0; row < qrcode.getModuleCount(); row++ ){
				for( var col = 0; col < qrcode.getModuleCount(); col++ ){
					ctx.fillStyle = qrcode.isDark(row, col) ? options.foreground : options.background;
					var w = (Math.ceil((col+1)*tileW) - Math.floor(col*tileW));
					var h = (Math.ceil((row+1)*tileW) - Math.floor(row*tileW));
					ctx.fillRect(Math.round(col*tileW),Math.round(row*tileH), w, h);  
				}	
			}
			// return just built canvas
			return canvas;
		}

		// from Jon-Carlos Rivera (https://github.com/imbcmdth)
		var createTable	= function(){
			// create the qrcode itself
			var qrcode	= new QRCode(options.typeNumber, options.correctLevel);
			qrcode.addData(options.text);
			qrcode.make();
			
			// create table element
			var $table	= $('<table></table>')
				.css("width", options.width+"px")
				.css("height", options.height+"px")
				.css("border", "0px")
				.css("border-collapse", "collapse")
				.css('background-color', options.background);
		  
			// compute tileS percentage
			var tileW	= options.width / qrcode.getModuleCount();
			var tileH	= options.height / qrcode.getModuleCount();

			// draw in the table
			for(var row = 0; row < qrcode.getModuleCount(); row++ ){
				var $row = $('<tr></tr>').css('height', tileH+"px").appendTo($table);
				
				for(var col = 0; col < qrcode.getModuleCount(); col++ ){
					$('<td></td>')
						.css('width', tileW+"px")
						.css('background-color', qrcode.isDark(row, col) ? options.foreground : options.background)
						.appendTo($row);
				}	
			}
			// return just built canvas
			return $table;
		}
  

		return this.each(function(){
			var element	= options.render == "canvas" ? createCanvas() : createTable();
			$(element).appendTo(this);
		});
	};
})( jQuery );

//---------------------------------------------------------------------
// QRCode for JavaScript
//
// Copyright (c) 2009 Kazuhiko Arase
//
// URL: http://www.d-project.com/
//
// Licensed under the MIT license:
//   http://www.opensource.org/licenses/mit-license.php
//
// The word "QR Code" is registered trademark of 
// DENSO WAVE INCORPORATED
//   http://www.denso-wave.com/qrcode/faqpatent-e.html
//
//---------------------------------------------------------------------

//---------------------------------------------------------------------
// QR8bitByte
//---------------------------------------------------------------------

function QR8bitByte(data) {
	this.mode = QRMode.MODE_8BIT_BYTE;
	this.data = data;
}

QR8bitByte.prototype = {

	getLength : function(buffer) {
		return this.data.length;
	},
	
	write : function(buffer) {
		for (var i = 0; i < this.data.length; i++) {
			// not JIS ...
			buffer.put(this.data.charCodeAt(i), 8);
		}
	}
};

//---------------------------------------------------------------------
// QRCode
//---------------------------------------------------------------------

function QRCode(typeNumber, errorCorrectLevel) {
	this.typeNumber = typeNumber;
	this.errorCorrectLevel = errorCorrectLevel;
	this.modules = null;
	this.moduleCount = 0;
	this.dataCache = null;
	this.dataList = new Array();
}

QRCode.prototype = {
	
	addData : function(data) {
		var newData = new QR8bitByte(data);
		this.dataList.push(newData);
		this.dataCache = null;
	},
	
	isDark : function(row, col) {
		if (row < 0 || this.moduleCount <= row || col < 0 || this.moduleCount <= col) {
			throw new Error(row + "," + col);
		}
		return this.modules[row][col];
	},

	getModuleCount : function() {
		return this.moduleCount;
	},
	
	make : function() {
		// Calculate automatically typeNumber if provided is < 1
		if (this.typeNumber < 1 ){
			var typeNumber = 1;
			for (typeNumber = 1; typeNumber < 40; typeNumber++) {
				var rsBlocks = QRRSBlock.getRSBlocks(typeNumber, this.errorCorrectLevel);

				var buffer = new QRBitBuffer();
				var totalDataCount = 0;
				for (var i = 0; i < rsBlocks.length; i++) {
					totalDataCount += rsBlocks[i].dataCount;
				}

				for (var i = 0; i < this.dataList.length; i++) {
					var data = this.dataList[i];
					buffer.put(data.mode, 4);
					buffer.put(data.getLength(), QRUtil.getLengthInBits(data.mode, typeNumber) );
					data.write(buffer);
				}
				if (buffer.getLengthInBits() <= totalDataCount * 8)
					break;
			}
			this.typeNumber = typeNumber;
		}
		this.makeImpl(false, this.getBestMaskPattern() );
	},
	
	makeImpl : function(test, maskPattern) {
		
		this.moduleCount = this.typeNumber * 4 + 17;
		this.modules = new Array(this.moduleCount);
		
		for (var row = 0; row < this.moduleCount; row++) {
			
			this.modules[row] = new Array(this.moduleCount);
			
			for (var col = 0; col < this.moduleCount; col++) {
				this.modules[row][col] = null;//(col + row) % 3;
			}
		}
	
		this.setupPositionProbePattern(0, 0);
		this.setupPositionProbePattern(this.moduleCount - 7, 0);
		this.setupPositionProbePattern(0, this.moduleCount - 7);
		this.setupPositionAdjustPattern();
		this.setupTimingPattern();
		this.setupTypeInfo(test, maskPattern);
		
		if (this.typeNumber >= 7) {
			this.setupTypeNumber(test);
		}
	
		if (this.dataCache == null) {
			this.dataCache = QRCode.createData(this.typeNumber, this.errorCorrectLevel, this.dataList);
		}
	
		this.mapData(this.dataCache, maskPattern);
	},

	setupPositionProbePattern : function(row, col)  {
		
		for (var r = -1; r <= 7; r++) {
			
			if (row + r <= -1 || this.moduleCount <= row + r) continue;
			
			for (var c = -1; c <= 7; c++) {
				
				if (col + c <= -1 || this.moduleCount <= col + c) continue;
				
				if ( (0 <= r && r <= 6 && (c == 0 || c == 6) )
						|| (0 <= c && c <= 6 && (r == 0 || r == 6) )
						|| (2 <= r && r <= 4 && 2 <= c && c <= 4) ) {
					this.modules[row + r][col + c] = true;
				} else {
					this.modules[row + r][col + c] = false;
				}
			}		
		}		
	},
	
	getBestMaskPattern : function() {
	
		var minLostPoint = 0;
		var pattern = 0;
	
		for (var i = 0; i < 8; i++) {
			
			this.makeImpl(true, i);
	
			var lostPoint = QRUtil.getLostPoint(this);
	
			if (i == 0 || minLostPoint >  lostPoint) {
				minLostPoint = lostPoint;
				pattern = i;
			}
		}
	
		return pattern;
	},
	
	createMovieClip : function(target_mc, instance_name, depth) {
	
		var qr_mc = target_mc.createEmptyMovieClip(instance_name, depth);
		var cs = 1;
	
		this.make();

		for (var row = 0; row < this.modules.length; row++) {
			
			var y = row * cs;
			
			for (var col = 0; col < this.modules[row].length; col++) {
	
				var x = col * cs;
				var dark = this.modules[row][col];
			
				if (dark) {
					qr_mc.beginFill(0, 100);
					qr_mc.moveTo(x, y);
					qr_mc.lineTo(x + cs, y);
					qr_mc.lineTo(x + cs, y + cs);
					qr_mc.lineTo(x, y + cs);
					qr_mc.endFill();
				}
			}
		}
		
		return qr_mc;
	},

	setupTimingPattern : function() {
		
		for (var r = 8; r < this.moduleCount - 8; r++) {
			if (this.modules[r][6] != null) {
				continue;
			}
			this.modules[r][6] = (r % 2 == 0);
		}
	
		for (var c = 8; c < this.moduleCount - 8; c++) {
			if (this.modules[6][c] != null) {
				continue;
			}
			this.modules[6][c] = (c % 2 == 0);
		}
	},
	
	setupPositionAdjustPattern : function() {
	
		var pos = QRUtil.getPatternPosition(this.typeNumber);
		
		for (var i = 0; i < pos.length; i++) {
		
			for (var j = 0; j < pos.length; j++) {
			
				var row = pos[i];
				var col = pos[j];
				
				if (this.modules[row][col] != null) {
					continue;
				}
				
				for (var r = -2; r <= 2; r++) {
				
					for (var c = -2; c <= 2; c++) {
					
						if (r == -2 || r == 2 || c == -2 || c == 2 
								|| (r == 0 && c == 0) ) {
							this.modules[row + r][col + c] = true;
						} else {
							this.modules[row + r][col + c] = false;
						}
					}
				}
			}
		}
	},
	
	setupTypeNumber : function(test) {
	
		var bits = QRUtil.getBCHTypeNumber(this.typeNumber);
	
		for (var i = 0; i < 18; i++) {
			var mod = (!test && ( (bits >> i) & 1) == 1);
			this.modules[Math.floor(i / 3)][i % 3 + this.moduleCount - 8 - 3] = mod;
		}
	
		for (var i = 0; i < 18; i++) {
			var mod = (!test && ( (bits >> i) & 1) == 1);
			this.modules[i % 3 + this.moduleCount - 8 - 3][Math.floor(i / 3)] = mod;
		}
	},
	
	setupTypeInfo : function(test, maskPattern) {
	
		var data = (this.errorCorrectLevel << 3) | maskPattern;
		var bits = QRUtil.getBCHTypeInfo(data);
	
		// vertical		
		for (var i = 0; i < 15; i++) {
	
			var mod = (!test && ( (bits >> i) & 1) == 1);
	
			if (i < 6) {
				this.modules[i][8] = mod;
			} else if (i < 8) {
				this.modules[i + 1][8] = mod;
			} else {
				this.modules[this.moduleCount - 15 + i][8] = mod;
			}
		}
	
		// horizontal
		for (var i = 0; i < 15; i++) {
	
			var mod = (!test && ( (bits >> i) & 1) == 1);
			
			if (i < 8) {
				this.modules[8][this.moduleCount - i - 1] = mod;
			} else if (i < 9) {
				this.modules[8][15 - i - 1 + 1] = mod;
			} else {
				this.modules[8][15 - i - 1] = mod;
			}
		}
	
		// fixed module
		this.modules[this.moduleCount - 8][8] = (!test);
	
	},
	
	mapData : function(data, maskPattern) {
		
		var inc = -1;
		var row = this.moduleCount - 1;
		var bitIndex = 7;
		var byteIndex = 0;
		
		for (var col = this.moduleCount - 1; col > 0; col -= 2) {
	
			if (col == 6) col--;
	
			while (true) {
	
				for (var c = 0; c < 2; c++) {
					
					if (this.modules[row][col - c] == null) {
						
						var dark = false;
	
						if (byteIndex < data.length) {
							dark = ( ( (data[byteIndex] >>> bitIndex) & 1) == 1);
						}
	
						var mask = QRUtil.getMask(maskPattern, row, col - c);
	
						if (mask) {
							dark = !dark;
						}
						
						this.modules[row][col - c] = dark;
						bitIndex--;
	
						if (bitIndex == -1) {
							byteIndex++;
							bitIndex = 7;
						}
					}
				}
								
				row += inc;
	
				if (row < 0 || this.moduleCount <= row) {
					row -= inc;
					inc = -inc;
					break;
				}
			}
		}
		
	}

};

QRCode.PAD0 = 0xEC;
QRCode.PAD1 = 0x11;

QRCode.createData = function(typeNumber, errorCorrectLevel, dataList) {
	
	var rsBlocks = QRRSBlock.getRSBlocks(typeNumber, errorCorrectLevel);
	
	var buffer = new QRBitBuffer();
	
	for (var i = 0; i < dataList.length; i++) {
		var data = dataList[i];
		buffer.put(data.mode, 4);
		buffer.put(data.getLength(), QRUtil.getLengthInBits(data.mode, typeNumber) );
		data.write(buffer);
	}

	// calc num max data.
	var totalDataCount = 0;
	for (var i = 0; i < rsBlocks.length; i++) {
		totalDataCount += rsBlocks[i].dataCount;
	}

	if (buffer.getLengthInBits() > totalDataCount * 8) {
		throw new Error("code length overflow. ("
			+ buffer.getLengthInBits()
			+ ">"
			+  totalDataCount * 8
			+ ")");
	}

	// end code
	if (buffer.getLengthInBits() + 4 <= totalDataCount * 8) {
		buffer.put(0, 4);
	}

	// padding
	while (buffer.getLengthInBits() % 8 != 0) {
		buffer.putBit(false);
	}

	// padding
	while (true) {
		
		if (buffer.getLengthInBits() >= totalDataCount * 8) {
			break;
		}
		buffer.put(QRCode.PAD0, 8);
		
		if (buffer.getLengthInBits() >= totalDataCount * 8) {
			break;
		}
		buffer.put(QRCode.PAD1, 8);
	}

	return QRCode.createBytes(buffer, rsBlocks);
}

QRCode.createBytes = function(buffer, rsBlocks) {

	var offset = 0;
	
	var maxDcCount = 0;
	var maxEcCount = 0;
	
	var dcdata = new Array(rsBlocks.length);
	var ecdata = new Array(rsBlocks.length);
	
	for (var r = 0; r < rsBlocks.length; r++) {

		var dcCount = rsBlocks[r].dataCount;
		var ecCount = rsBlocks[r].totalCount - dcCount;

		maxDcCount = Math.max(maxDcCount, dcCount);
		maxEcCount = Math.max(maxEcCount, ecCount);
		
		dcdata[r] = new Array(dcCount);
		
		for (var i = 0; i < dcdata[r].length; i++) {
			dcdata[r][i] = 0xff & buffer.buffer[i + offset];
		}
		offset += dcCount;
		
		var rsPoly = QRUtil.getErrorCorrectPolynomial(ecCount);
		var rawPoly = new QRPolynomial(dcdata[r], rsPoly.getLength() - 1);

		var modPoly = rawPoly.mod(rsPoly);
		ecdata[r] = new Array(rsPoly.getLength() - 1);
		for (var i = 0; i < ecdata[r].length; i++) {
            var modIndex = i + modPoly.getLength() - ecdata[r].length;
			ecdata[r][i] = (modIndex >= 0)? modPoly.get(modIndex) : 0;
		}

	}
	
	var totalCodeCount = 0;
	for (var i = 0; i < rsBlocks.length; i++) {
		totalCodeCount += rsBlocks[i].totalCount;
	}

	var data = new Array(totalCodeCount);
	var index = 0;

	for (var i = 0; i < maxDcCount; i++) {
		for (var r = 0; r < rsBlocks.length; r++) {
			if (i < dcdata[r].length) {
				data[index++] = dcdata[r][i];
			}
		}
	}

	for (var i = 0; i < maxEcCount; i++) {
		for (var r = 0; r < rsBlocks.length; r++) {
			if (i < ecdata[r].length) {
				data[index++] = ecdata[r][i];
			}
		}
	}

	return data;

}

//---------------------------------------------------------------------
// QRMode
//---------------------------------------------------------------------

var QRMode = {
	MODE_NUMBER :		1 << 0,
	MODE_ALPHA_NUM : 	1 << 1,
	MODE_8BIT_BYTE : 	1 << 2,
	MODE_KANJI :		1 << 3
};

//---------------------------------------------------------------------
// QRErrorCorrectLevel
//---------------------------------------------------------------------
 
var QRErrorCorrectLevel = {
	L : 1,
	M : 0,
	Q : 3,
	H : 2
};

//---------------------------------------------------------------------
// QRMaskPattern
//---------------------------------------------------------------------

var QRMaskPattern = {
	PATTERN000 : 0,
	PATTERN001 : 1,
	PATTERN010 : 2,
	PATTERN011 : 3,
	PATTERN100 : 4,
	PATTERN101 : 5,
	PATTERN110 : 6,
	PATTERN111 : 7
};

//---------------------------------------------------------------------
// QRUtil
//---------------------------------------------------------------------
 
var QRUtil = {

    PATTERN_POSITION_TABLE : [
	    [],
	    [6, 18],
	    [6, 22],
	    [6, 26],
	    [6, 30],
	    [6, 34],
	    [6, 22, 38],
	    [6, 24, 42],
	    [6, 26, 46],
	    [6, 28, 50],
	    [6, 30, 54],		
	    [6, 32, 58],
	    [6, 34, 62],
	    [6, 26, 46, 66],
	    [6, 26, 48, 70],
	    [6, 26, 50, 74],
	    [6, 30, 54, 78],
	    [6, 30, 56, 82],
	    [6, 30, 58, 86],
	    [6, 34, 62, 90],
	    [6, 28, 50, 72, 94],
	    [6, 26, 50, 74, 98],
	    [6, 30, 54, 78, 102],
	    [6, 28, 54, 80, 106],
	    [6, 32, 58, 84, 110],
	    [6, 30, 58, 86, 114],
	    [6, 34, 62, 90, 118],
	    [6, 26, 50, 74, 98, 122],
	    [6, 30, 54, 78, 102, 126],
	    [6, 26, 52, 78, 104, 130],
	    [6, 30, 56, 82, 108, 134],
	    [6, 34, 60, 86, 112, 138],
	    [6, 30, 58, 86, 114, 142],
	    [6, 34, 62, 90, 118, 146],
	    [6, 30, 54, 78, 102, 126, 150],
	    [6, 24, 50, 76, 102, 128, 154],
	    [6, 28, 54, 80, 106, 132, 158],
	    [6, 32, 58, 84, 110, 136, 162],
	    [6, 26, 54, 82, 110, 138, 166],
	    [6, 30, 58, 86, 114, 142, 170]
    ],

    G15 : (1 << 10) | (1 << 8) | (1 << 5) | (1 << 4) | (1 << 2) | (1 << 1) | (1 << 0),
    G18 : (1 << 12) | (1 << 11) | (1 << 10) | (1 << 9) | (1 << 8) | (1 << 5) | (1 << 2) | (1 << 0),
    G15_MASK : (1 << 14) | (1 << 12) | (1 << 10)	| (1 << 4) | (1 << 1),

    getBCHTypeInfo : function(data) {
	    var d = data << 10;
	    while (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G15) >= 0) {
		    d ^= (QRUtil.G15 << (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G15) ) ); 	
	    }
	    return ( (data << 10) | d) ^ QRUtil.G15_MASK;
    },

    getBCHTypeNumber : function(data) {
	    var d = data << 12;
	    while (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G18) >= 0) {
		    d ^= (QRUtil.G18 << (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G18) ) ); 	
	    }
	    return (data << 12) | d;
    },

    getBCHDigit : function(data) {

	    var digit = 0;

	    while (data != 0) {
		    digit++;
		    data >>>= 1;
	    }

	    return digit;
    },

    getPatternPosition : function(typeNumber) {
	    return QRUtil.PATTERN_POSITION_TABLE[typeNumber - 1];
    },

    getMask : function(maskPattern, i, j) {
	    
	    switch (maskPattern) {
		    
	    case QRMaskPattern.PATTERN000 : return (i + j) % 2 == 0;
	    case QRMaskPattern.PATTERN001 : return i % 2 == 0;
	    case QRMaskPattern.PATTERN010 : return j % 3 == 0;
	    case QRMaskPattern.PATTERN011 : return (i + j) % 3 == 0;
	    case QRMaskPattern.PATTERN100 : return (Math.floor(i / 2) + Math.floor(j / 3) ) % 2 == 0;
	    case QRMaskPattern.PATTERN101 : return (i * j) % 2 + (i * j) % 3 == 0;
	    case QRMaskPattern.PATTERN110 : return ( (i * j) % 2 + (i * j) % 3) % 2 == 0;
	    case QRMaskPattern.PATTERN111 : return ( (i * j) % 3 + (i + j) % 2) % 2 == 0;

	    default :
		    throw new Error("bad maskPattern:" + maskPattern);
	    }
    },

    getErrorCorrectPolynomial : function(errorCorrectLength) {

	    var a = new QRPolynomial([1], 0);

	    for (var i = 0; i < errorCorrectLength; i++) {
		    a = a.multiply(new QRPolynomial([1, QRMath.gexp(i)], 0) );
	    }

	    return a;
    },

    getLengthInBits : function(mode, type) {

	    if (1 <= type && type < 10) {

		    // 1 - 9

		    switch(mode) {
		    case QRMode.MODE_NUMBER 	: return 10;
		    case QRMode.MODE_ALPHA_NUM 	: return 9;
		    case QRMode.MODE_8BIT_BYTE	: return 8;
		    case QRMode.MODE_KANJI  	: return 8;
		    default :
			    throw new Error("mode:" + mode);
		    }

	    } else if (type < 27) {

		    // 10 - 26

		    switch(mode) {
		    case QRMode.MODE_NUMBER 	: return 12;
		    case QRMode.MODE_ALPHA_NUM 	: return 11;
		    case QRMode.MODE_8BIT_BYTE	: return 16;
		    case QRMode.MODE_KANJI  	: return 10;
		    default :
			    throw new Error("mode:" + mode);
		    }

	    } else if (type < 41) {

		    // 27 - 40

		    switch(mode) {
		    case QRMode.MODE_NUMBER 	: return 14;
		    case QRMode.MODE_ALPHA_NUM	: return 13;
		    case QRMode.MODE_8BIT_BYTE	: return 16;
		    case QRMode.MODE_KANJI  	: return 12;
		    default :
			    throw new Error("mode:" + mode);
		    }

	    } else {
		    throw new Error("type:" + type);
	    }
    },

    getLostPoint : function(qrCode) {
	    
	    var moduleCount = qrCode.getModuleCount();
	    
	    var lostPoint = 0;
	    
	    // LEVEL1
	    
	    for (var row = 0; row < moduleCount; row++) {

		    for (var col = 0; col < moduleCount; col++) {

			    var sameCount = 0;
			    var dark = qrCode.isDark(row, col);

				for (var r = -1; r <= 1; r++) {

				    if (row + r < 0 || moduleCount <= row + r) {
					    continue;
				    }

				    for (var c = -1; c <= 1; c++) {

					    if (col + c < 0 || moduleCount <= col + c) {
						    continue;
					    }

					    if (r == 0 && c == 0) {
						    continue;
					    }

					    if (dark == qrCode.isDark(row + r, col + c) ) {
						    sameCount++;
					    }
				    }
			    }

			    if (sameCount > 5) {
				    lostPoint += (3 + sameCount - 5);
			    }
		    }
	    }

	    // LEVEL2

	    for (var row = 0; row < moduleCount - 1; row++) {
		    for (var col = 0; col < moduleCount - 1; col++) {
			    var count = 0;
			    if (qrCode.isDark(row,     col    ) ) count++;
			    if (qrCode.isDark(row + 1, col    ) ) count++;
			    if (qrCode.isDark(row,     col + 1) ) count++;
			    if (qrCode.isDark(row + 1, col + 1) ) count++;
			    if (count == 0 || count == 4) {
				    lostPoint += 3;
			    }
		    }
	    }

	    // LEVEL3

	    for (var row = 0; row < moduleCount; row++) {
		    for (var col = 0; col < moduleCount - 6; col++) {
			    if (qrCode.isDark(row, col)
					    && !qrCode.isDark(row, col + 1)
					    &&  qrCode.isDark(row, col + 2)
					    &&  qrCode.isDark(row, col + 3)
					    &&  qrCode.isDark(row, col + 4)
					    && !qrCode.isDark(row, col + 5)
					    &&  qrCode.isDark(row, col + 6) ) {
				    lostPoint += 40;
			    }
		    }
	    }

	    for (var col = 0; col < moduleCount; col++) {
		    for (var row = 0; row < moduleCount - 6; row++) {
			    if (qrCode.isDark(row, col)
					    && !qrCode.isDark(row + 1, col)
					    &&  qrCode.isDark(row + 2, col)
					    &&  qrCode.isDark(row + 3, col)
					    &&  qrCode.isDark(row + 4, col)
					    && !qrCode.isDark(row + 5, col)
					    &&  qrCode.isDark(row + 6, col) ) {
				    lostPoint += 40;
			    }
		    }
	    }

	    // LEVEL4
	    
	    var darkCount = 0;

	    for (var col = 0; col < moduleCount; col++) {
		    for (var row = 0; row < moduleCount; row++) {
			    if (qrCode.isDark(row, col) ) {
				    darkCount++;
			    }
		    }
	    }
	    
	    var ratio = Math.abs(100 * darkCount / moduleCount / moduleCount - 50) / 5;
	    lostPoint += ratio * 10;

	    return lostPoint;		
    }

};


//---------------------------------------------------------------------
// QRMath
//---------------------------------------------------------------------

var QRMath = {

	glog : function(n) {
	
		if (n < 1) {
			throw new Error("glog(" + n + ")");
		}
		
		return QRMath.LOG_TABLE[n];
	},
	
	gexp : function(n) {
	
		while (n < 0) {
			n += 255;
		}
	
		while (n >= 256) {
			n -= 255;
		}
	
		return QRMath.EXP_TABLE[n];
	},
	
	EXP_TABLE : new Array(256),
	
	LOG_TABLE : new Array(256)

};
	
for (var i = 0; i < 8; i++) {
	QRMath.EXP_TABLE[i] = 1 << i;
}
for (var i = 8; i < 256; i++) {
	QRMath.EXP_TABLE[i] = QRMath.EXP_TABLE[i - 4]
		^ QRMath.EXP_TABLE[i - 5]
		^ QRMath.EXP_TABLE[i - 6]
		^ QRMath.EXP_TABLE[i - 8];
}
for (var i = 0; i < 255; i++) {
	QRMath.LOG_TABLE[QRMath.EXP_TABLE[i] ] = i;
}

//---------------------------------------------------------------------
// QRPolynomial
//---------------------------------------------------------------------

function QRPolynomial(num, shift) {

	if (num.length == undefined) {
		throw new Error(num.length + "/" + shift);
	}

	var offset = 0;

	while (offset < num.length && num[offset] == 0) {
		offset++;
	}

	this.num = new Array(num.length - offset + shift);
	for (var i = 0; i < num.length - offset; i++) {
		this.num[i] = num[i + offset];
	}
}

QRPolynomial.prototype = {

	get : function(index) {
		return this.num[index];
	},
	
	getLength : function() {
		return this.num.length;
	},
	
	multiply : function(e) {
	
		var num = new Array(this.getLength() + e.getLength() - 1);
	
		for (var i = 0; i < this.getLength(); i++) {
			for (var j = 0; j < e.getLength(); j++) {
				num[i + j] ^= QRMath.gexp(QRMath.glog(this.get(i) ) + QRMath.glog(e.get(j) ) );
			}
		}
	
		return new QRPolynomial(num, 0);
	},
	
	mod : function(e) {
	
		if (this.getLength() - e.getLength() < 0) {
			return this;
		}
	
		var ratio = QRMath.glog(this.get(0) ) - QRMath.glog(e.get(0) );
	
		var num = new Array(this.getLength() );
		
		for (var i = 0; i < this.getLength(); i++) {
			num[i] = this.get(i);
		}
		
		for (var i = 0; i < e.getLength(); i++) {
			num[i] ^= QRMath.gexp(QRMath.glog(e.get(i) ) + ratio);
		}
	
		// recursive call
		return new QRPolynomial(num, 0).mod(e);
	}
};

//---------------------------------------------------------------------
// QRRSBlock
//---------------------------------------------------------------------

function QRRSBlock(totalCount, dataCount) {
	this.totalCount = totalCount;
	this.dataCount  = dataCount;
}

QRRSBlock.RS_BLOCK_TABLE = [

	// L
	// M
	// Q
	// H

	// 1
	[1, 26, 19],
	[1, 26, 16],
	[1, 26, 13],
	[1, 26, 9],
	
	// 2
	[1, 44, 34],
	[1, 44, 28],
	[1, 44, 22],
	[1, 44, 16],

	// 3
	[1, 70, 55],
	[1, 70, 44],
	[2, 35, 17],
	[2, 35, 13],

	// 4		
	[1, 100, 80],
	[2, 50, 32],
	[2, 50, 24],
	[4, 25, 9],
	
	// 5
	[1, 134, 108],
	[2, 67, 43],
	[2, 33, 15, 2, 34, 16],
	[2, 33, 11, 2, 34, 12],
	
	// 6
	[2, 86, 68],
	[4, 43, 27],
	[4, 43, 19],
	[4, 43, 15],
	
	// 7		
	[2, 98, 78],
	[4, 49, 31],
	[2, 32, 14, 4, 33, 15],
	[4, 39, 13, 1, 40, 14],
	
	// 8
	[2, 121, 97],
	[2, 60, 38, 2, 61, 39],
	[4, 40, 18, 2, 41, 19],
	[4, 40, 14, 2, 41, 15],
	
	// 9
	[2, 146, 116],
	[3, 58, 36, 2, 59, 37],
	[4, 36, 16, 4, 37, 17],
	[4, 36, 12, 4, 37, 13],
	
	// 10		
	[2, 86, 68, 2, 87, 69],
	[4, 69, 43, 1, 70, 44],
	[6, 43, 19, 2, 44, 20],
	[6, 43, 15, 2, 44, 16],

	// 11
	[4, 101, 81],
	[1, 80, 50, 4, 81, 51],
	[4, 50, 22, 4, 51, 23],
	[3, 36, 12, 8, 37, 13],

	// 12
	[2, 116, 92, 2, 117, 93],
	[6, 58, 36, 2, 59, 37],
	[4, 46, 20, 6, 47, 21],
	[7, 42, 14, 4, 43, 15],

	// 13
	[4, 133, 107],
	[8, 59, 37, 1, 60, 38],
	[8, 44, 20, 4, 45, 21],
	[12, 33, 11, 4, 34, 12],

	// 14
	[3, 145, 115, 1, 146, 116],
	[4, 64, 40, 5, 65, 41],
	[11, 36, 16, 5, 37, 17],
	[11, 36, 12, 5, 37, 13],

	// 15
	[5, 109, 87, 1, 110, 88],
	[5, 65, 41, 5, 66, 42],
	[5, 54, 24, 7, 55, 25],
	[11, 36, 12],

	// 16
	[5, 122, 98, 1, 123, 99],
	[7, 73, 45, 3, 74, 46],
	[15, 43, 19, 2, 44, 20],
	[3, 45, 15, 13, 46, 16],

	// 17
	[1, 135, 107, 5, 136, 108],
	[10, 74, 46, 1, 75, 47],
	[1, 50, 22, 15, 51, 23],
	[2, 42, 14, 17, 43, 15],

	// 18
	[5, 150, 120, 1, 151, 121],
	[9, 69, 43, 4, 70, 44],
	[17, 50, 22, 1, 51, 23],
	[2, 42, 14, 19, 43, 15],

	// 19
	[3, 141, 113, 4, 142, 114],
	[3, 70, 44, 11, 71, 45],
	[17, 47, 21, 4, 48, 22],
	[9, 39, 13, 16, 40, 14],

	// 20
	[3, 135, 107, 5, 136, 108],
	[3, 67, 41, 13, 68, 42],
	[15, 54, 24, 5, 55, 25],
	[15, 43, 15, 10, 44, 16],

	// 21
	[4, 144, 116, 4, 145, 117],
	[17, 68, 42],
	[17, 50, 22, 6, 51, 23],
	[19, 46, 16, 6, 47, 17],

	// 22
	[2, 139, 111, 7, 140, 112],
	[17, 74, 46],
	[7, 54, 24, 16, 55, 25],
	[34, 37, 13],

	// 23
	[4, 151, 121, 5, 152, 122],
	[4, 75, 47, 14, 76, 48],
	[11, 54, 24, 14, 55, 25],
	[16, 45, 15, 14, 46, 16],

	// 24
	[6, 147, 117, 4, 148, 118],
	[6, 73, 45, 14, 74, 46],
	[11, 54, 24, 16, 55, 25],
	[30, 46, 16, 2, 47, 17],

	// 25
	[8, 132, 106, 4, 133, 107],
	[8, 75, 47, 13, 76, 48],
	[7, 54, 24, 22, 55, 25],
	[22, 45, 15, 13, 46, 16],

	// 26
	[10, 142, 114, 2, 143, 115],
	[19, 74, 46, 4, 75, 47],
	[28, 50, 22, 6, 51, 23],
	[33, 46, 16, 4, 47, 17],

	// 27
	[8, 152, 122, 4, 153, 123],
	[22, 73, 45, 3, 74, 46],
	[8, 53, 23, 26, 54, 24],
	[12, 45, 15, 28, 46, 16],

	// 28
	[3, 147, 117, 10, 148, 118],
	[3, 73, 45, 23, 74, 46],
	[4, 54, 24, 31, 55, 25],
	[11, 45, 15, 31, 46, 16],

	// 29
	[7, 146, 116, 7, 147, 117],
	[21, 73, 45, 7, 74, 46],
	[1, 53, 23, 37, 54, 24],
	[19, 45, 15, 26, 46, 16],

	// 30
	[5, 145, 115, 10, 146, 116],
	[19, 75, 47, 10, 76, 48],
	[15, 54, 24, 25, 55, 25],
	[23, 45, 15, 25, 46, 16],

	// 31
	[13, 145, 115, 3, 146, 116],
	[2, 74, 46, 29, 75, 47],
	[42, 54, 24, 1, 55, 25],
	[23, 45, 15, 28, 46, 16],

	// 32
	[17, 145, 115],
	[10, 74, 46, 23, 75, 47],
	[10, 54, 24, 35, 55, 25],
	[19, 45, 15, 35, 46, 16],

	// 33
	[17, 145, 115, 1, 146, 116],
	[14, 74, 46, 21, 75, 47],
	[29, 54, 24, 19, 55, 25],
	[11, 45, 15, 46, 46, 16],

	// 34
	[13, 145, 115, 6, 146, 116],
	[14, 74, 46, 23, 75, 47],
	[44, 54, 24, 7, 55, 25],
	[59, 46, 16, 1, 47, 17],

	// 35
	[12, 151, 121, 7, 152, 122],
	[12, 75, 47, 26, 76, 48],
	[39, 54, 24, 14, 55, 25],
	[22, 45, 15, 41, 46, 16],

	// 36
	[6, 151, 121, 14, 152, 122],
	[6, 75, 47, 34, 76, 48],
	[46, 54, 24, 10, 55, 25],
	[2, 45, 15, 64, 46, 16],

	// 37
	[17, 152, 122, 4, 153, 123],
	[29, 74, 46, 14, 75, 47],
	[49, 54, 24, 10, 55, 25],
	[24, 45, 15, 46, 46, 16],

	// 38
	[4, 152, 122, 18, 153, 123],
	[13, 74, 46, 32, 75, 47],
	[48, 54, 24, 14, 55, 25],
	[42, 45, 15, 32, 46, 16],

	// 39
	[20, 147, 117, 4, 148, 118],
	[40, 75, 47, 7, 76, 48],
	[43, 54, 24, 22, 55, 25],
	[10, 45, 15, 67, 46, 16],

	// 40
	[19, 148, 118, 6, 149, 119],
	[18, 75, 47, 31, 76, 48],
	[34, 54, 24, 34, 55, 25],
	[20, 45, 15, 61, 46, 16]
];

QRRSBlock.getRSBlocks = function(typeNumber, errorCorrectLevel) {
	
	var rsBlock = QRRSBlock.getRsBlockTable(typeNumber, errorCorrectLevel);
	
	if (rsBlock == undefined) {
		throw new Error("bad rs block @ typeNumber:" + typeNumber + "/errorCorrectLevel:" + errorCorrectLevel);
	}

	var length = rsBlock.length / 3;
	
	var list = new Array();
	
	for (var i = 0; i < length; i++) {

		var count = rsBlock[i * 3 + 0];
		var totalCount = rsBlock[i * 3 + 1];
		var dataCount  = rsBlock[i * 3 + 2];

		for (var j = 0; j < count; j++) {
			list.push(new QRRSBlock(totalCount, dataCount) );	
		}
	}
	
	return list;
}

QRRSBlock.getRsBlockTable = function(typeNumber, errorCorrectLevel) {

	switch(errorCorrectLevel) {
	case QRErrorCorrectLevel.L :
		return QRRSBlock.RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 0];
	case QRErrorCorrectLevel.M :
		return QRRSBlock.RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 1];
	case QRErrorCorrectLevel.Q :
		return QRRSBlock.RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 2];
	case QRErrorCorrectLevel.H :
		return QRRSBlock.RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 3];
	default :
		return undefined;
	}
}

//---------------------------------------------------------------------
// QRBitBuffer
//---------------------------------------------------------------------

function QRBitBuffer() {
	this.buffer = new Array();
	this.length = 0;
}

QRBitBuffer.prototype = {

	get : function(index) {
		var bufIndex = Math.floor(index / 8);
		return ( (this.buffer[bufIndex] >>> (7 - index % 8) ) & 1) == 1;
	},
	
	put : function(num, length) {
		for (var i = 0; i < length; i++) {
			this.putBit( ( (num >>> (length - i - 1) ) & 1) == 1);
		}
	},
	
	getLengthInBits : function() {
		return this.length;
	},
	
	putBit : function(bit) {
	
		var bufIndex = Math.floor(this.length / 8);
		if (this.buffer.length <= bufIndex) {
			this.buffer.push(0);
		}
	
		if (bit) {
			this.buffer[bufIndex] |= (0x80 >>> (this.length % 8) );
		}
	
		this.length++;
	}
};

/*!
 * Colcade v0.2.0
 * Lightweight masonry layout
 * by David DeSandro
 * MIT license
 */

/*jshint browser: true, undef: true, unused: true */

( function( window, factory ) {
  // universal module definition
  /*jshint strict: false */
  /*global define: false, module: false */
  if ( typeof define == 'function' && define.amd ) {
    // AMD
    define( factory );
  } else if ( typeof module == 'object' && module.exports ) {
    // CommonJS
    module.exports = factory();
  } else {
    // browser global
    window.Colcade = factory();
  }

}( window, function factory() {

// -------------------------- Colcade -------------------------- //

function Colcade( element, options ) {
  element = getQueryElement( element );

  // do not initialize twice on same element
  if ( element && element.colcadeGUID ) {
    var instance = instances[ element.colcadeGUID ];
    instance.option( options );
    return instance;
  }

  this.element = element;
  // options
  this.options = {};
  this.option( options );
  // kick things off
  this.create();
}

var proto = Colcade.prototype;

proto.option = function( options ) {
  this.options = extend( this.options, options );
};

// globally unique identifiers
var GUID = 0;
// internal store of all Colcade intances
var instances = {};

proto.create = function() {
  this.errorCheck();
  // add guid for Colcade.data
  var guid = this.guid = ++GUID;
  this.element.colcadeGUID = guid;
  instances[ guid ] = this; // associate via id
  // update initial properties & layout
  this.reload();
  // events
  this._windowResizeHandler = this.onWindowResize.bind( this );
  this._loadHandler = this.onLoad.bind( this );
  window.addEventListener( 'resize', this._windowResizeHandler );
  this.element.addEventListener( 'load', this._loadHandler, true );
};

proto.errorCheck = function() {
  var errors = [];
  if ( !this.element ) {
    errors.push( 'Bad element: ' + this.element );
  }
  if ( !this.options.columns ) {
    errors.push( 'columns option required: ' + this.options.columns );
  }
  if ( !this.options.items ) {
    errors.push( 'items option required: ' + this.options.items );
  }

  if ( errors.length ) {
    throw new Error( '[Colcade error] ' + errors.join('. ') );
  }
};

// update properties and do layout
proto.reload = function() {
  this.updateColumns();
  this.updateItems();
  this.layout();
};

proto.updateColumns = function() {
  this.columns = querySelect( this.options.columns, this.element );
};

proto.updateItems = function() {
  this.items = querySelect( this.options.items, this.element );
};

proto.getActiveColumns = function() {
  return this.columns.filter( function( column ) {
    var style = getComputedStyle( column );
    return style.display != 'none';
  });
};

// ----- layout ----- //

// public, updates activeColumns
proto.layout = function() {
  this.activeColumns = this.getActiveColumns();
  this._layout();
};

// private, does not update activeColumns
proto._layout = function() {
  // reset column heights
  this.columnHeights = this.activeColumns.map( function() {
    return 0;
  });
  // layout all items
  this.layoutItems( this.items );
};

proto.layoutItems = function( items ) {
  items.forEach( this.layoutItem, this );
};

proto.layoutItem = function( item ) {
  // layout item by appending to column
  var minHeight = Math.min.apply( Math, this.columnHeights );
  var index = this.columnHeights.indexOf( minHeight );
  this.activeColumns[ index ].appendChild( item );
  // at least 1px, if item hasn't loaded
  // Not exactly accurate, but it's cool
  this.columnHeights[ index ] += item.offsetHeight || 1;
};

// ----- adding items ----- //

proto.append = function( elems ) {
  var items = this.getQueryItems( elems );
  // add items to collection
  this.items = this.items.concat( items );
  // lay them out
  this.layoutItems( items );
};

proto.prepend = function( elems ) {
  var items = this.getQueryItems( elems );
  // add items to collection
  this.items = items.concat( this.items );
  // lay out everything
  this._layout();
};

proto.getQueryItems = function( elems ) {
  elems = makeArray( elems );
  var fragment = document.createDocumentFragment();
  elems.forEach( function( elem ) {
    fragment.appendChild( elem );
  });
  return querySelect( this.options.items, fragment );
};

// ----- measure column height ----- //

proto.measureColumnHeight = function( elem ) {
  var boundingRect = this.element.getBoundingClientRect();
  this.activeColumns.forEach( function( column, i ) {
    // if elem, measure only that column
    // if no elem, measure all columns
    if ( !elem || column.contains( elem ) ) {
      var lastChildRect = column.lastElementChild.getBoundingClientRect();
      // not an exact calculation as it includes top border, and excludes item bottom margin
      this.columnHeights[ i ] = lastChildRect.bottom - boundingRect.top;
    }
  }, this );
};

// ----- events ----- //

proto.onWindowResize = function() {
  clearTimeout( this.resizeTimeout );
  this.resizeTimeout = setTimeout( function() {
    this.onDebouncedResize();
  }.bind( this ), 100 );
};

proto.onDebouncedResize = function() {
  var activeColumns = this.getActiveColumns();
  // check if columns changed
  var isSameLength = activeColumns.length == this.activeColumns.length;
  var isSameColumns = true;
  this.activeColumns.forEach( function( column, i ) {
    isSameColumns = isSameColumns && column == activeColumns[i];
  });
  if ( isSameLength && isSameColumns ) {
    return;
  }
  // activeColumns changed
  this.activeColumns = activeColumns;
  this._layout();
};

proto.onLoad = function( event ) {
  this.measureColumnHeight( event.target );
};

// ----- destroy ----- //

proto.destroy = function() {
  // move items back to container
  this.items.forEach( function( item ) {
    this.element.appendChild( item );
  }, this );
  // remove events
  window.removeEventListener( 'resize', this._windowResizeHandler );
  this.element.removeEventListener( 'load', this._loadHandler, true );
  // remove data
  delete this.element.colcadeGUID;
  delete instances[ this.guid ];
};

// -------------------------- HTML init -------------------------- //

docReady( function() {
  var dataElems = querySelect('[data-colcade]');
  dataElems.forEach( htmlInit );
});

function htmlInit( elem ) {
  // convert attribute "foo: bar, qux: baz" into object
  var attr = elem.getAttribute('data-colcade');
  var attrParts = attr.split(',');
  var options = {};
  attrParts.forEach( function( part ) {
    var pair = part.split(':');
    var key = pair[0].trim();
    var value = pair[1].trim();
    options[ key ] = value;
  });

  new Colcade( elem, options );
}

Colcade.data = function( elem ) {
  elem = getQueryElement( elem );
  var id = elem && elem.colcadeGUID;
  return id && instances[ id ];
};

// -------------------------- jQuery -------------------------- //

Colcade.makeJQueryPlugin = function( $ ) {
  $ = $ || window.jQuery;
  if ( !$ ) {
    return;
  }

  $.fn.colcade = function( arg0 /*, arg1 */) {
    // method call $().colcade( 'method', { options } )
    if ( typeof arg0 == 'string' ) {
      // shift arguments by 1
      var args = Array.prototype.slice.call( arguments, 1 );
      return methodCall( this, arg0, args );
    }
    // just $().colcade({ options })
    plainCall( this, arg0 );
    return this;
  };

  function methodCall( $elems, methodName, args ) {
    var returnValue;
    $elems.each( function( i, elem ) {
      // get instance
      var colcade = $.data( elem, 'colcade' );
      if ( !colcade ) {
        return;
      }
      // apply method, get return value
      var value = colcade[ methodName ].apply( colcade, args );
      // set return value if value is returned, use only first value
      returnValue = returnValue === undefined ? value : returnValue;
    });
    return returnValue !== undefined ? returnValue : $elems;
  }

  function plainCall( $elems, options ) {
    $elems.each( function( i, elem ) {
      var colcade = $.data( elem, 'colcade' );
      if ( colcade ) {
        // set options & init
        colcade.option( options );
        colcade.layout();
      } else {
        // initialize new instance
        colcade = new Colcade( elem, options );
        $.data( elem, 'colcade', colcade );
      }
    });
  }
};

// try making plugin
Colcade.makeJQueryPlugin();

// -------------------------- utils -------------------------- //

function extend( a, b ) {
  for ( var prop in b ) {
    a[ prop ] = b[ prop ];
  }
  return a;
}

// turn element or nodeList into an array
function makeArray( obj ) {
  var ary = [];
  if ( Array.isArray( obj ) ) {
    // use object if already an array
    ary = obj;
  } else if ( obj && typeof obj.length == 'number' ) {
    // convert nodeList to array
    for ( var i=0; i < obj.length; i++ ) {
      ary.push( obj[i] );
    }
  } else {
    // array of single index
    ary.push( obj );
  }
  return ary;
}

// get array of elements
function querySelect( selector, elem ) {
  elem = elem || document;
  var elems = elem.querySelectorAll( selector );
  return makeArray( elems );
}

function getQueryElement( elem ) {
  if ( typeof elem == 'string' ) {
    elem = document.querySelector( elem );
  }
  return elem;
}

function docReady( onReady ) {
  if ( document.readyState == 'complete' ) {
    onReady();
    return;
  }
  document.addEventListener( 'DOMContentLoaded', onReady );
}

// -------------------------- end -------------------------- //

return Colcade;

}));

/*!
 * enquire.js v2.1.6 - Awesome Media Queries in JavaScript
 * Copyright (c) 2017 Nick Williams - http://wicky.nillia.ms/enquire.js
 * License: MIT */


(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.enquire = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var QueryHandler = require(3);
var each = require(4).each;

/**
 * Represents a single media query, manages it's state and registered handlers for this query
 *
 * @constructor
 * @param {string} query the media query string
 * @param {boolean} [isUnconditional=false] whether the media query should run regardless of whether the conditions are met. Primarily for helping older browsers deal with mobile-first design
 */
function MediaQuery(query, isUnconditional) {
    this.query = query;
    this.isUnconditional = isUnconditional;
    this.handlers = [];
    this.mql = window.matchMedia(query);

    var self = this;
    this.listener = function(mql) {
        // Chrome passes an MediaQueryListEvent object, while other browsers pass MediaQueryList directly
        self.mql = mql.currentTarget || mql;
        self.assess();
    };
    this.mql.addListener(this.listener);
}

MediaQuery.prototype = {

    constuctor : MediaQuery,

    /**
     * add a handler for this query, triggering if already active
     *
     * @param {object} handler
     * @param {function} handler.match callback for when query is activated
     * @param {function} [handler.unmatch] callback for when query is deactivated
     * @param {function} [handler.setup] callback for immediate execution when a query handler is registered
     * @param {boolean} [handler.deferSetup=false] should the setup callback be deferred until the first time the handler is matched?
     */
    addHandler : function(handler) {
        var qh = new QueryHandler(handler);
        this.handlers.push(qh);

        this.matches() && qh.on();
    },

    /**
     * removes the given handler from the collection, and calls it's destroy methods
     *
     * @param {object || function} handler the handler to remove
     */
    removeHandler : function(handler) {
        var handlers = this.handlers;
        each(handlers, function(h, i) {
            if(h.equals(handler)) {
                h.destroy();
                return !handlers.splice(i,1); //remove from array and exit each early
            }
        });
    },

    /**
     * Determine whether the media query should be considered a match
     *
     * @return {Boolean} true if media query can be considered a match, false otherwise
     */
    matches : function() {
        return this.mql.matches || this.isUnconditional;
    },

    /**
     * Clears all handlers and unbinds events
     */
    clear : function() {
        each(this.handlers, function(handler) {
            handler.destroy();
        });
        this.mql.removeListener(this.listener);
        this.handlers.length = 0; //clear array
    },

    /*
        * Assesses the query, turning on all handlers if it matches, turning them off if it doesn't match
        */
    assess : function() {
        var action = this.matches() ? 'on' : 'off';

        each(this.handlers, function(handler) {
            handler[action]();
        });
    }
};

module.exports = MediaQuery;

},{"3":3,"4":4}],2:[function(require,module,exports){
var MediaQuery = require(1);
var Util = require(4);
var each = Util.each;
var isFunction = Util.isFunction;
var isArray = Util.isArray;

/**
 * Allows for registration of query handlers.
 * Manages the query handler's state and is responsible for wiring up browser events
 *
 * @constructor
 */
function MediaQueryDispatch () {
    if(!window.matchMedia) {
        throw new Error('matchMedia not present, legacy browsers require a polyfill');
    }

    this.queries = {};
    this.browserIsIncapable = !window.matchMedia('only all').matches;
}

MediaQueryDispatch.prototype = {

    constructor : MediaQueryDispatch,

    /**
     * Registers a handler for the given media query
     *
     * @param {string} q the media query
     * @param {object || Array || Function} options either a single query handler object, a function, or an array of query handlers
     * @param {function} options.match fired when query matched
     * @param {function} [options.unmatch] fired when a query is no longer matched
     * @param {function} [options.setup] fired when handler first triggered
     * @param {boolean} [options.deferSetup=false] whether setup should be run immediately or deferred until query is first matched
     * @param {boolean} [shouldDegrade=false] whether this particular media query should always run on incapable browsers
     */
    register : function(q, options, shouldDegrade) {
        var queries         = this.queries,
            isUnconditional = shouldDegrade && this.browserIsIncapable;

        if(!queries[q]) {
            queries[q] = new MediaQuery(q, isUnconditional);
        }

        //normalise to object in an array
        if(isFunction(options)) {
            options = { match : options };
        }
        if(!isArray(options)) {
            options = [options];
        }
        each(options, function(handler) {
            if (isFunction(handler)) {
                handler = { match : handler };
            }
            queries[q].addHandler(handler);
        });

        return this;
    },

    /**
     * unregisters a query and all it's handlers, or a specific handler for a query
     *
     * @param {string} q the media query to target
     * @param {object || function} [handler] specific handler to unregister
     */
    unregister : function(q, handler) {
        var query = this.queries[q];

        if(query) {
            if(handler) {
                query.removeHandler(handler);
            }
            else {
                query.clear();
                delete this.queries[q];
            }
        }

        return this;
    }
};

module.exports = MediaQueryDispatch;

},{"1":1,"4":4}],3:[function(require,module,exports){
/**
 * Delegate to handle a media query being matched and unmatched.
 *
 * @param {object} options
 * @param {function} options.match callback for when the media query is matched
 * @param {function} [options.unmatch] callback for when the media query is unmatched
 * @param {function} [options.setup] one-time callback triggered the first time a query is matched
 * @param {boolean} [options.deferSetup=false] should the setup callback be run immediately, rather than first time query is matched?
 * @constructor
 */
function QueryHandler(options) {
    this.options = options;
    !options.deferSetup && this.setup();
}

QueryHandler.prototype = {

    constructor : QueryHandler,

    /**
     * coordinates setup of the handler
     *
     * @function
     */
    setup : function() {
        if(this.options.setup) {
            this.options.setup();
        }
        this.initialised = true;
    },

    /**
     * coordinates setup and triggering of the handler
     *
     * @function
     */
    on : function() {
        !this.initialised && this.setup();
        this.options.match && this.options.match();
    },

    /**
     * coordinates the unmatch event for the handler
     *
     * @function
     */
    off : function() {
        this.options.unmatch && this.options.unmatch();
    },

    /**
     * called when a handler is to be destroyed.
     * delegates to the destroy or unmatch callbacks, depending on availability.
     *
     * @function
     */
    destroy : function() {
        this.options.destroy ? this.options.destroy() : this.off();
    },

    /**
     * determines equality by reference.
     * if object is supplied compare options, if function, compare match callback
     *
     * @function
     * @param {object || function} [target] the target for comparison
     */
    equals : function(target) {
        return this.options === target || this.options.match === target;
    }

};

module.exports = QueryHandler;

},{}],4:[function(require,module,exports){
/**
 * Helper function for iterating over a collection
 *
 * @param collection
 * @param fn
 */
function each(collection, fn) {
    var i      = 0,
        length = collection.length,
        cont;

    for(i; i < length; i++) {
        cont = fn(collection[i], i);
        if(cont === false) {
            break; //allow early exit
        }
    }
}

/**
 * Helper function for determining whether target object is an array
 *
 * @param target the object under test
 * @return {Boolean} true if array, false otherwise
 */
function isArray(target) {
    return Object.prototype.toString.apply(target) === '[object Array]';
}

/**
 * Helper function for determining whether target object is a function
 *
 * @param target the object under test
 * @return {Boolean} true if function, false otherwise
 */
function isFunction(target) {
    return typeof target === 'function';
}

module.exports = {
    isFunction : isFunction,
    isArray : isArray,
    each : each
};

},{}],5:[function(require,module,exports){
var MediaQueryDispatch = require(2);
module.exports = new MediaQueryDispatch();

},{"2":2}]},{},[5])(5)
});
(function (global, factory) {
  if (typeof define === "function" && define.amd) {
    define(['exports'], factory);
  } else if (typeof exports !== "undefined") {
    factory(exports);
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports);
    global.bodyScrollLock = mod.exports;
  }
})(this, function (exports) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  function _toConsumableArray(arr) {
    if (Array.isArray(arr)) {
      for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {
        arr2[i] = arr[i];
      }

      return arr2;
    } else {
      return Array.from(arr);
    }
  }

  // Older browsers don't support event options, feature detect it.
  var hasPassiveEvents = false;
  // Adopted and modified solution from Bohdan Didukh (2017)
  // https://stackoverflow.com/questions/41594997/ios-10-safari-prevent-scrolling-behind-a-fixed-overlay-and-maintain-scroll-posi

  var isIosDevice = typeof window !== 'undefined' && window.navigator && window.navigator.platform && /iPad|iPhone|iPod|(iPad Simulator)|(iPhone Simulator)|(iPod Simulator)/.test(window.navigator.platform);


  var firstTargetElement = null;
  var allTargetElements = [];
  var documentListenerAdded = false;
  var initialClientY = -1;
  var previousBodyOverflowSetting = void 0;
  var previousBodyPaddingRight = void 0;

  var preventDefault = function preventDefault(rawEvent) {
    var e = rawEvent || window.event;

    // Do not prevent if the event has more than one touch (usually meaning this is a multi touch gesture like pinch to zoom)
    if (e.touches.length > 1) return true;

    if (e.preventDefault) e.preventDefault();

    return false;
  };

  var setOverflowHidden = function setOverflowHidden(options) {
    // Setting overflow on body/documentElement synchronously in Desktop Safari slows down
    // the responsiveness for some reason. Setting within a setTimeout fixes this.
    setTimeout(function () {
      // If previousBodyPaddingRight is already set, don't set it again.
      if (previousBodyPaddingRight === undefined) {
        var _reserveScrollBarGap = !!options && options.reserveScrollBarGap === true;
        var scrollBarGap = window.innerWidth - document.documentElement.clientWidth;

        if (_reserveScrollBarGap && scrollBarGap > 0) {
          previousBodyPaddingRight = document.body.style.paddingRight;
          document.body.style.paddingRight = scrollBarGap + 'px';
        }
      }

      // If previousBodyOverflowSetting is already set, don't set it again.
      if (previousBodyOverflowSetting === undefined) {
        previousBodyOverflowSetting = document.body.style.overflow;
        document.body.style.overflow = 'hidden';
      }
    });
  };

  var restoreOverflowSetting = function restoreOverflowSetting() {
    // Setting overflow on body/documentElement synchronously in Desktop Safari slows down
    // the responsiveness for some reason. Setting within a setTimeout fixes this.
    setTimeout(function () {
      if (previousBodyPaddingRight !== undefined) {
        document.body.style.paddingRight = previousBodyPaddingRight;

        // Restore previousBodyPaddingRight to undefined so setOverflowHidden knows it
        // can be set again.
        previousBodyPaddingRight = undefined;
      }

      if (previousBodyOverflowSetting !== undefined) {
        document.body.style.overflow = previousBodyOverflowSetting;

        // Restore previousBodyOverflowSetting to undefined
        // so setOverflowHidden knows it can be set again.
        previousBodyOverflowSetting = undefined;
      }
    });
  };

  // https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollHeight#Problems_and_solutions
  var isTargetElementTotallyScrolled = function isTargetElementTotallyScrolled(targetElement) {
    return targetElement ? targetElement.scrollHeight - targetElement.scrollTop <= targetElement.clientHeight : false;
  };

  var handleScroll = function handleScroll(event, targetElement) {
    var clientY = event.targetTouches[0].clientY - initialClientY;

    if (targetElement && targetElement.scrollTop === 0 && clientY > 0) {
      // element is at the top of its scroll
      return preventDefault(event);
    }

    if (isTargetElementTotallyScrolled(targetElement) && clientY < 0) {
      // element is at the top of its scroll
      return preventDefault(event);
    }

    event.stopPropagation();
    return true;
  };

  var disableBodyScroll = exports.disableBodyScroll = function disableBodyScroll(targetElement, options) {
    if (isIosDevice) {
      // targetElement must be provided, and disableBodyScroll must not have been
      // called on this targetElement before.
      if (targetElement && !allTargetElements.includes(targetElement)) {
        allTargetElements = [].concat(_toConsumableArray(allTargetElements), [targetElement]);

        targetElement.ontouchstart = function (event) {
          if (event.targetTouches.length === 1) {
            // detect single touch
            initialClientY = event.targetTouches[0].clientY;
          }
        };
        targetElement.ontouchmove = function (event) {
          if (event.targetTouches.length === 1) {
            // detect single touch
            handleScroll(event, targetElement);
          }
        };

        if (!documentListenerAdded) {
          document.addEventListener('touchmove', preventDefault, hasPassiveEvents ? { passive: false } : undefined);
          documentListenerAdded = true;
        }
      }
    } else {
      setOverflowHidden(options);

      if (!firstTargetElement) firstTargetElement = targetElement;
    }
  };

  var clearAllBodyScrollLocks = exports.clearAllBodyScrollLocks = function clearAllBodyScrollLocks() {
    if (isIosDevice) {
      // Clear all allTargetElements ontouchstart/ontouchmove handlers, and the references
      allTargetElements.forEach(function (targetElement) {
        targetElement.ontouchstart = null;
        targetElement.ontouchmove = null;
      });

      if (documentListenerAdded) {
        document.removeEventListener('touchmove', preventDefault, hasPassiveEvents ? { passive: false } : undefined);
        documentListenerAdded = false;
      }

      allTargetElements = [];

      // Reset initial clientY
      initialClientY = -1;
    } else {
      restoreOverflowSetting();

      firstTargetElement = null;
    }
  };

  var enableBodyScroll = exports.enableBodyScroll = function enableBodyScroll(targetElement) {
    if (isIosDevice) {
      targetElement.ontouchstart = null;
      targetElement.ontouchmove = null;

      allTargetElements = allTargetElements.filter(function (element) {
        return element !== targetElement;
      });

      if (documentListenerAdded && allTargetElements.length === 0) {
        document.removeEventListener('touchmove', preventDefault, hasPassiveEvents ? { passive: false } : undefined);
        documentListenerAdded = false;
      }
    } else if (firstTargetElement === targetElement) {
      restoreOverflowSetting();

      firstTargetElement = null;
    }
  };
});
/*
This plugin extends lazySizes to lazyLoad:
background images, videos/posters and scripts

Background-Image:
For background images, use data-bg attribute:
<div class="lazyload" data-bg="bg-img.jpg"></div>

 Video:
 For video/audio use data-poster and preload="none":
 <video class="lazyload" preload="none" data-poster="poster.jpg" src="src.mp4">
 <!-- sources -->
 </video>

 For video that plays automatically if in view:
 <video
	class="lazyload"
	preload="none"
	muted=""
	data-autoplay=""
	data-poster="poster.jpg"
	src="src.mp4">
</video>

 Scripts:
 For scripts use data-script:
 <div class="lazyload" data-script="module-name.js"></div>


 Script modules using require:
 For modules using require use data-require:
 <div class="lazyload" data-require="module-name"></div>
*/

(function(window, factory) {
    var globalInstall = function(){
        factory(window.lazySizes);
        window.removeEventListener('lazyunveilread', globalInstall, true);
    };

    factory = factory.bind(null, window, window.document);

    if(typeof module == 'object' && module.exports){
        factory(require('lazysizes'));
    } else if (typeof define == 'function' && define.amd) {
        define(['lazysizes'], factory);
    } else if(window.lazySizes) {
        globalInstall();
    } else {
        window.addEventListener('lazyunveilread', globalInstall, true);
    }
}(window, function(window, document, lazySizes) {
    /*jshint eqnull:true */
    'use strict';
    var bgLoad, regBgUrlEscape;
    var uniqueUrls = {};

    if(document.addEventListener){
        regBgUrlEscape = /\(|\)|\s|'/;

        bgLoad = function (url, cb){
            var img = document.createElement('img');
            img.onload = function(){
                img.onload = null;
                img.onerror = null;
                img = null;
                cb();
            };
            img.onerror = img.onload;

            img.src = url;

            if(img && img.complete && img.onload){
                img.onload();
            }
        };

        addEventListener('lazybeforeunveil', function(e){
            if(e.detail.instance != lazySizes){return;}

            var tmp, load, bg, poster;
            if(!e.defaultPrevented) {

                var target = e.target;

                if(target.preload == 'none'){
                    target.preload = target.getAttribute('data-preload') || 'auto';
                }

                if (target.getAttribute('data-autoplay') != null) {
                    if (target.getAttribute('data-expand') && !target.autoplay) {
                        try {
                            target.play();
                        } catch (er) {}
                    } else {
                        requestAnimationFrame(function () {
                            target.setAttribute('data-expand', '-10');
                            lazySizes.aC(target, lazySizes.cfg.lazyClass);
                        });
                    }
                }

                tmp = target.getAttribute('data-link');
                if(tmp){
                    addStyleScript(tmp, true);
                }

                // handle data-script
                tmp = target.getAttribute('data-script');
                if(tmp){
                    e.detail.firesLoad = true;
                    load = function(){
                        e.detail.firesLoad = false;
                        lazySizes.fire(target, '_lazyloaded', {}, true, true);
                    };
                    addStyleScript(tmp, null, load);
                }

                // handle data-require
                tmp = target.getAttribute('data-require');
                if(tmp){
                    if(lazySizes.cfg.requireJs){
                        lazySizes.cfg.requireJs([tmp]);
                    } else {
                        addStyleScript(tmp);
                    }
                }

                // handle data-bg
                bg = target.getAttribute('data-bg');
                if (bg) {
                    e.detail.firesLoad = true;
                    load = function(){
                        target.style.backgroundImage = 'url(' + (regBgUrlEscape.test(bg) ? JSON.stringify(bg) : bg ) + ')';
                        e.detail.firesLoad = false;
                        lazySizes.fire(target, '_lazyloaded', {}, true, true);
                    };

                    bgLoad(bg, load);
                }

                // handle data-poster
                poster = target.getAttribute('data-poster');
                if(poster){
                    e.detail.firesLoad = true;
                    load = function(){
                        target.poster = poster;
                        e.detail.firesLoad = false;
                        lazySizes.fire(target, '_lazyloaded', {}, true, true);
                    };

                    bgLoad(poster, load);

                }
            }
        }, false);

    }

    function addStyleScript(src, style, cb){
        if(uniqueUrls[src]){
            return;
        }
        var elem = document.createElement(style ? 'link' : 'script');
        var insertElem = document.getElementsByTagName('script')[0];

        if(style){
            elem.rel = 'stylesheet';
            elem.href = src;
        } else {
            elem.onload = function(){
                elem.onerror = null;
                elem.onload = null;
                cb();
            };
            elem.onerror = elem.onload;

            elem.src = src;
        }
        uniqueUrls[src] = true;
        uniqueUrls[elem.src || elem.href] = true;
        insertElem.parentNode.insertBefore(elem, insertElem);
    }
}));
(function(window, factory) {
	var lazySizes = factory(window, window.document);
	window.lazySizes = lazySizes;
	if(typeof module == 'object' && module.exports){
		module.exports = lazySizes;
	}
}(window, function l(window, document) {
	'use strict';
	/*jshint eqnull:true */
	if(!document.getElementsByClassName){return;}

	var lazysizes, lazySizesConfig;

	var docElem = document.documentElement;

	var Date = window.Date;

	var supportPicture = window.HTMLPictureElement;

	var _addEventListener = 'addEventListener';

	var _getAttribute = 'getAttribute';

	var addEventListener = window[_addEventListener];

	var setTimeout = window.setTimeout;

	var requestAnimationFrame = window.requestAnimationFrame || setTimeout;

	var requestIdleCallback = window.requestIdleCallback;

	var regPicture = /^picture$/i;

	var loadEvents = ['load', 'error', 'lazyincluded', '_lazyloaded'];

	var regClassCache = {};

	var forEach = Array.prototype.forEach;

	var hasClass = function(ele, cls) {
		if(!regClassCache[cls]){
			regClassCache[cls] = new RegExp('(\\s|^)'+cls+'(\\s|$)');
		}
		return regClassCache[cls].test(ele[_getAttribute]('class') || '') && regClassCache[cls];
	};

	var addClass = function(ele, cls) {
		if (!hasClass(ele, cls)){
			ele.setAttribute('class', (ele[_getAttribute]('class') || '').trim() + ' ' + cls);
		}
	};

	var removeClass = function(ele, cls) {
		var reg;
		if ((reg = hasClass(ele,cls))) {
			ele.setAttribute('class', (ele[_getAttribute]('class') || '').replace(reg, ' '));
		}
	};

	var addRemoveLoadEvents = function(dom, fn, add){
		var action = add ? _addEventListener : 'removeEventListener';
		if(add){
			addRemoveLoadEvents(dom, fn);
		}
		loadEvents.forEach(function(evt){
			dom[action](evt, fn);
		});
	};

	var triggerEvent = function(elem, name, detail, noBubbles, noCancelable){
		var event = document.createEvent('Event');

		if(!detail){
			detail = {};
		}

		detail.instance = lazysizes;

		event.initEvent(name, !noBubbles, !noCancelable);

		event.detail = detail;

		elem.dispatchEvent(event);
		return event;
	};

	var updatePolyfill = function (el, full){
		var polyfill;
		if( !supportPicture && ( polyfill = (window.picturefill || lazySizesConfig.pf) ) ){
			if(full && full.src && !el[_getAttribute]('srcset')){
				el.setAttribute('srcset', full.src);
			}
			polyfill({reevaluate: true, elements: [el]});
		} else if(full && full.src){
			el.src = full.src;
		}
	};

	var getCSS = function (elem, style){
		return (getComputedStyle(elem, null) || {})[style];
	};

	var getWidth = function(elem, parent, width){
		width = width || elem.offsetWidth;

		while(width < lazySizesConfig.minSize && parent && !elem._lazysizesWidth){
			width =  parent.offsetWidth;
			parent = parent.parentNode;
		}

		return width;
	};

	var rAF = (function(){
		var running, waiting;
		var firstFns = [];
		var secondFns = [];
		var fns = firstFns;

		var run = function(){
			var runFns = fns;

			fns = firstFns.length ? secondFns : firstFns;

			running = true;
			waiting = false;

			while(runFns.length){
				runFns.shift()();
			}

			running = false;
		};

		var rafBatch = function(fn, queue){
			if(running && !queue){
				fn.apply(this, arguments);
			} else {
				fns.push(fn);

				if(!waiting){
					waiting = true;
					(document.hidden ? setTimeout : requestAnimationFrame)(run);
				}
			}
		};

		rafBatch._lsFlush = run;

		return rafBatch;
	})();

	var rAFIt = function(fn, simple){
		return simple ?
			function() {
				rAF(fn);
			} :
			function(){
				var that = this;
				var args = arguments;
				rAF(function(){
					fn.apply(that, args);
				});
			}
		;
	};

	var throttle = function(fn){
		var running;
		var lastTime = 0;
		var gDelay = lazySizesConfig.throttleDelay;
		var rICTimeout = lazySizesConfig.ricTimeout;
		var run = function(){
			running = false;
			lastTime = Date.now();
			fn();
		};
		var idleCallback = requestIdleCallback && rICTimeout > 49 ?
			function(){
				requestIdleCallback(run, {timeout: rICTimeout});

				if(rICTimeout !== lazySizesConfig.ricTimeout){
					rICTimeout = lazySizesConfig.ricTimeout;
				}
			} :
			rAFIt(function(){
				setTimeout(run);
			}, true)
		;

		return function(isPriority){
			var delay;

			if((isPriority = isPriority === true)){
				rICTimeout = 33;
			}

			if(running){
				return;
			}

			running =  true;

			delay = gDelay - (Date.now() - lastTime);

			if(delay < 0){
				delay = 0;
			}

			if(isPriority || delay < 9){
				idleCallback();
			} else {
				setTimeout(idleCallback, delay);
			}
		};
	};

	//based on http://modernjavascript.blogspot.de/2013/08/building-better-debounce.html
	var debounce = function(func) {
		var timeout, timestamp;
		var wait = 99;
		var run = function(){
			timeout = null;
			func();
		};
		var later = function() {
			var last = Date.now() - timestamp;

			if (last < wait) {
				setTimeout(later, wait - last);
			} else {
				(requestIdleCallback || run)(run);
			}
		};

		return function() {
			timestamp = Date.now();

			if (!timeout) {
				timeout = setTimeout(later, wait);
			}
		};
	};

	(function(){
		var prop;

		var lazySizesDefaults = {
			lazyClass: 'lazyload',
			loadedClass: 'lazyloaded',
			loadingClass: 'lazyloading',
			preloadClass: 'lazypreload',
			errorClass: 'lazyerror',
			//strictClass: 'lazystrict',
			autosizesClass: 'lazyautosizes',
			srcAttr: 'data-src',
			srcsetAttr: 'data-srcset',
			sizesAttr: 'data-sizes',
			//preloadAfterLoad: false,
			minSize: 40,
			customMedia: {},
			init: true,
			expFactor: 1.5,
			hFac: 0.8,
			loadMode: 2,
			loadHidden: true,
			ricTimeout: 0,
			throttleDelay: 125,
		};

		lazySizesConfig = window.lazySizesConfig || window.lazysizesConfig || {};

		for(prop in lazySizesDefaults){
			if(!(prop in lazySizesConfig)){
				lazySizesConfig[prop] = lazySizesDefaults[prop];
			}
		}

		window.lazySizesConfig = lazySizesConfig;

		setTimeout(function(){
			if(lazySizesConfig.init){
				init();
			}
		});
	})();

	var loader = (function(){
		var preloadElems, isCompleted, resetPreloadingTimer, loadMode, started;

		var eLvW, elvH, eLtop, eLleft, eLright, eLbottom, isBodyHidden;

		var regImg = /^img$/i;
		var regIframe = /^iframe$/i;

		var supportScroll = ('onscroll' in window) && !(/(gle|ing)bot/.test(navigator.userAgent));

		var shrinkExpand = 0;
		var currentExpand = 0;

		var isLoading = 0;
		var lowRuns = -1;

		var resetPreloading = function(e){
			isLoading--;
			if(!e || isLoading < 0 || !e.target){
				isLoading = 0;
			}
		};

		var isVisible = function (elem) {
			if (isBodyHidden == null) {
				isBodyHidden = getCSS(document.body, 'visibility') == 'hidden';
			}

			return isBodyHidden || (getCSS(elem.parentNode, 'visibility') != 'hidden' && getCSS(elem, 'visibility') != 'hidden');
		};

		var isNestedVisible = function(elem, elemExpand){
			var outerRect;
			var parent = elem;
			var visible = isVisible(elem);

			eLtop -= elemExpand;
			eLbottom += elemExpand;
			eLleft -= elemExpand;
			eLright += elemExpand;

			while(visible && (parent = parent.offsetParent) && parent != document.body && parent != docElem){
				visible = ((getCSS(parent, 'opacity') || 1) > 0);

				if(visible && getCSS(parent, 'overflow') != 'visible'){
					outerRect = parent.getBoundingClientRect();
					visible = eLright > outerRect.left &&
						eLleft < outerRect.right &&
						eLbottom > outerRect.top - 1 &&
						eLtop < outerRect.bottom + 1
					;
				}
			}

			return visible;
		};

		var checkElements = function() {
			var eLlen, i, rect, autoLoadElem, loadedSomething, elemExpand, elemNegativeExpand, elemExpandVal,
				beforeExpandVal, defaultExpand, preloadExpand, hFac;
			var lazyloadElems = lazysizes.elements;

			if((loadMode = lazySizesConfig.loadMode) && isLoading < 8 && (eLlen = lazyloadElems.length)){

				i = 0;

				lowRuns++;

				defaultExpand = (!lazySizesConfig.expand || lazySizesConfig.expand < 1) ?
					docElem.clientHeight > 500 && docElem.clientWidth > 500 ? 500 : 370 :
					lazySizesConfig.expand;

				lazysizes._defEx = defaultExpand;

				preloadExpand = defaultExpand * lazySizesConfig.expFactor;
				hFac = lazySizesConfig.hFac;
				isBodyHidden = null;

				if(currentExpand < preloadExpand && isLoading < 1 && lowRuns > 2 && loadMode > 2 && !document.hidden){
					currentExpand = preloadExpand;
					lowRuns = 0;
				} else if(loadMode > 1 && lowRuns > 1 && isLoading < 6){
					currentExpand = defaultExpand;
				} else {
					currentExpand = shrinkExpand;
				}

				for(; i < eLlen; i++){

					if(!lazyloadElems[i] || lazyloadElems[i]._lazyRace){continue;}

					if(!supportScroll){unveilElement(lazyloadElems[i]);continue;}

					if(!(elemExpandVal = lazyloadElems[i][_getAttribute]('data-expand')) || !(elemExpand = elemExpandVal * 1)){
						elemExpand = currentExpand;
					}

					if(beforeExpandVal !== elemExpand){
						eLvW = innerWidth + (elemExpand * hFac);
						elvH = innerHeight + elemExpand;
						elemNegativeExpand = elemExpand * -1;
						beforeExpandVal = elemExpand;
					}

					rect = lazyloadElems[i].getBoundingClientRect();

					if ((eLbottom = rect.bottom) >= elemNegativeExpand &&
						(eLtop = rect.top) <= elvH &&
						(eLright = rect.right) >= elemNegativeExpand * hFac &&
						(eLleft = rect.left) <= eLvW &&
						(eLbottom || eLright || eLleft || eLtop) &&
						(lazySizesConfig.loadHidden || isVisible(lazyloadElems[i])) &&
						((isCompleted && isLoading < 3 && !elemExpandVal && (loadMode < 3 || lowRuns < 4)) || isNestedVisible(lazyloadElems[i], elemExpand))){
						unveilElement(lazyloadElems[i]);
						loadedSomething = true;
						if(isLoading > 9){break;}
					} else if(!loadedSomething && isCompleted && !autoLoadElem &&
						isLoading < 4 && lowRuns < 4 && loadMode > 2 &&
						(preloadElems[0] || lazySizesConfig.preloadAfterLoad) &&
						(preloadElems[0] || (!elemExpandVal && ((eLbottom || eLright || eLleft || eLtop) || lazyloadElems[i][_getAttribute](lazySizesConfig.sizesAttr) != 'auto')))){
						autoLoadElem = preloadElems[0] || lazyloadElems[i];
					}
				}

				if(autoLoadElem && !loadedSomething){
					unveilElement(autoLoadElem);
				}
			}
		};

		var throttledCheckElements = throttle(checkElements);

		var switchLoadingClass = function(e){
			var elem = e.target;

			if (elem._lazyCache) {
				delete elem._lazyCache;
				return;
			}

			resetPreloading(e);
			addClass(elem, lazySizesConfig.loadedClass);
			removeClass(elem, lazySizesConfig.loadingClass);
			addRemoveLoadEvents(elem, rafSwitchLoadingClass);
			triggerEvent(elem, 'lazyloaded');
		};
		var rafedSwitchLoadingClass = rAFIt(switchLoadingClass);
		var rafSwitchLoadingClass = function(e){
			rafedSwitchLoadingClass({target: e.target});
		};

		var changeIframeSrc = function(elem, src){
			try {
				elem.contentWindow.location.replace(src);
			} catch(e){
				elem.src = src;
			}
		};

		var handleSources = function(source){
			var customMedia;

			var sourceSrcset = source[_getAttribute](lazySizesConfig.srcsetAttr);

			if( (customMedia = lazySizesConfig.customMedia[source[_getAttribute]('data-media') || source[_getAttribute]('media')]) ){
				source.setAttribute('media', customMedia);
			}

			if(sourceSrcset){
				source.setAttribute('srcset', sourceSrcset);
			}
		};

		var lazyUnveil = rAFIt(function (elem, detail, isAuto, sizes, isImg){
			var src, srcset, parent, isPicture, event, firesLoad;

			if(!(event = triggerEvent(elem, 'lazybeforeunveil', detail)).defaultPrevented){

				if(sizes){
					if(isAuto){
						addClass(elem, lazySizesConfig.autosizesClass);
					} else {
						elem.setAttribute('sizes', sizes);
					}
				}

				srcset = elem[_getAttribute](lazySizesConfig.srcsetAttr);
				src = elem[_getAttribute](lazySizesConfig.srcAttr);

				if(isImg) {
					parent = elem.parentNode;
					isPicture = parent && regPicture.test(parent.nodeName || '');
				}

				firesLoad = detail.firesLoad || (('src' in elem) && (srcset || src || isPicture));

				event = {target: elem};

				addClass(elem, lazySizesConfig.loadingClass);

				if(firesLoad){
					clearTimeout(resetPreloadingTimer);
					resetPreloadingTimer = setTimeout(resetPreloading, 2500);
					addRemoveLoadEvents(elem, rafSwitchLoadingClass, true);
				}

				if(isPicture){
					forEach.call(parent.getElementsByTagName('source'), handleSources);
				}

				if(srcset){
					elem.setAttribute('srcset', srcset);
				} else if(src && !isPicture){
					if(regIframe.test(elem.nodeName)){
						changeIframeSrc(elem, src);
					} else {
						elem.src = src;
					}
				}

				if(isImg && (srcset || isPicture)){
					updatePolyfill(elem, {src: src});
				}
			}

			if(elem._lazyRace){
				delete elem._lazyRace;
			}
			removeClass(elem, lazySizesConfig.lazyClass);

			rAF(function(){
				// Part of this can be removed as soon as this fix is older: https://bugs.chromium.org/p/chromium/issues/detail?id=7731 (2015)
				var isLoaded = elem.complete && elem.naturalWidth > 1;

				if( !firesLoad || isLoaded){
					if (isLoaded) {
						addClass(elem, 'ls-is-cached');
					}
					switchLoadingClass(event);
					elem._lazyCache = true;
					setTimeout(function(){
						if ('_lazyCache' in elem) {
							delete elem._lazyCache;
						}
					}, 9);
				}
			}, true);
		});

		var unveilElement = function (elem){
			var detail;

			var isImg = regImg.test(elem.nodeName);

			//allow using sizes="auto", but don't use. it's invalid. Use data-sizes="auto" or a valid value for sizes instead (i.e.: sizes="80vw")
			var sizes = isImg && (elem[_getAttribute](lazySizesConfig.sizesAttr) || elem[_getAttribute]('sizes'));
			var isAuto = sizes == 'auto';

			if( (isAuto || !isCompleted) && isImg && (elem[_getAttribute]('src') || elem.srcset) && !elem.complete && !hasClass(elem, lazySizesConfig.errorClass) && hasClass(elem, lazySizesConfig.lazyClass)){return;}

			detail = triggerEvent(elem, 'lazyunveilread').detail;

			if(isAuto){
				 autoSizer.updateElem(elem, true, elem.offsetWidth);
			}

			elem._lazyRace = true;
			isLoading++;

			lazyUnveil(elem, detail, isAuto, sizes, isImg);
		};

		var onload = function(){
			if(isCompleted){return;}
			if(Date.now() - started < 999){
				setTimeout(onload, 999);
				return;
			}
			var afterScroll = debounce(function(){
				lazySizesConfig.loadMode = 3;
				throttledCheckElements();
			});

			isCompleted = true;

			lazySizesConfig.loadMode = 3;

			throttledCheckElements();

			addEventListener('scroll', function(){
				if(lazySizesConfig.loadMode == 3){
					lazySizesConfig.loadMode = 2;
				}
				afterScroll();
			}, true);
		};

		return {
			_: function(){
				started = Date.now();

				lazysizes.elements = document.getElementsByClassName(lazySizesConfig.lazyClass);
				preloadElems = document.getElementsByClassName(lazySizesConfig.lazyClass + ' ' + lazySizesConfig.preloadClass);

				addEventListener('scroll', throttledCheckElements, true);

				addEventListener('resize', throttledCheckElements, true);

				if(window.MutationObserver){
					new MutationObserver( throttledCheckElements ).observe( docElem, {childList: true, subtree: true, attributes: true} );
				} else {
					docElem[_addEventListener]('DOMNodeInserted', throttledCheckElements, true);
					docElem[_addEventListener]('DOMAttrModified', throttledCheckElements, true);
					setInterval(throttledCheckElements, 999);
				}

				addEventListener('hashchange', throttledCheckElements, true);

				//, 'fullscreenchange'
				['focus', 'mouseover', 'click', 'load', 'transitionend', 'animationend', 'webkitAnimationEnd'].forEach(function(name){
					document[_addEventListener](name, throttledCheckElements, true);
				});

				if((/d$|^c/.test(document.readyState))){
					onload();
				} else {
					addEventListener('load', onload);
					document[_addEventListener]('DOMContentLoaded', throttledCheckElements);
					setTimeout(onload, 20000);
				}

				if(lazysizes.elements.length){
					checkElements();
					rAF._lsFlush();
				} else {
					throttledCheckElements();
				}
			},
			checkElems: throttledCheckElements,
			unveil: unveilElement
		};
	})();


	var autoSizer = (function(){
		var autosizesElems;

		var sizeElement = rAFIt(function(elem, parent, event, width){
			var sources, i, len;
			elem._lazysizesWidth = width;
			width += 'px';

			elem.setAttribute('sizes', width);

			if(regPicture.test(parent.nodeName || '')){
				sources = parent.getElementsByTagName('source');
				for(i = 0, len = sources.length; i < len; i++){
					sources[i].setAttribute('sizes', width);
				}
			}

			if(!event.detail.dataAttr){
				updatePolyfill(elem, event.detail);
			}
		});
		var getSizeElement = function (elem, dataAttr, width){
			var event;
			var parent = elem.parentNode;

			if(parent){
				width = getWidth(elem, parent, width);
				event = triggerEvent(elem, 'lazybeforesizes', {width: width, dataAttr: !!dataAttr});

				if(!event.defaultPrevented){
					width = event.detail.width;

					if(width && width !== elem._lazysizesWidth){
						sizeElement(elem, parent, event, width);
					}
				}
			}
		};

		var updateElementsSizes = function(){
			var i;
			var len = autosizesElems.length;
			if(len){
				i = 0;

				for(; i < len; i++){
					getSizeElement(autosizesElems[i]);
				}
			}
		};

		var debouncedUpdateElementsSizes = debounce(updateElementsSizes);

		return {
			_: function(){
				autosizesElems = document.getElementsByClassName(lazySizesConfig.autosizesClass);
				addEventListener('resize', debouncedUpdateElementsSizes);
			},
			checkElems: debouncedUpdateElementsSizes,
			updateElem: getSizeElement
		};
	})();

	var init = function(){
		if(!init.i){
			init.i = true;
			autoSizer._();
			loader._();
		}
	};

	lazysizes = {
		cfg: lazySizesConfig,
		autoSizer: autoSizer,
		loader: loader,
		init: init,
		uP: updatePolyfill,
		aC: addClass,
		rC: removeClass,
		hC: hasClass,
		fire: triggerEvent,
		gW: getWidth,
		rAF: rAF,
	};

	return lazysizes;
}
));

//Custom Slick.js for fixing this bug: https://github.com/kenwheeler/slick/pull/2635
/*
     _ _      _       _
 ___| (_) ___| | __  (_)___
/ __| | |/ __| |/ /  | / __|
\__ \ | | (__|   < _ | \__ \
|___/_|_|\___|_|\_(_)/ |___/
                   |__/

 Version: 1.6.0
  Author: Ken Wheeler
 Website: http://kenwheeler.github.io
    Docs: http://kenwheeler.github.io/slick
    Repo: http://github.com/kenwheeler/slick
  Issues: http://github.com/kenwheeler/slick/issues

 */
/* global window, document, define, jQuery, setInterval, clearInterval */
(function(factory) {
    'use strict';
    if (typeof define === 'function' && define.amd) {
        define(['jquery'], factory);
    } else if (typeof exports !== 'undefined') {
        module.exports = factory(require('jquery'));
    } else {
        factory(jQuery);
    }

}(function($) {
    'use strict';
    var Slick = window.Slick || {};

    Slick = (function() {

        var instanceUid = 0;

        function Slick(element, settings) {

            var _ = this, dataSettings;

            _.defaults = {
                accessibility: true,
                adaptiveHeight: false,
                appendArrows: $(element),
                appendDots: $(element),
                arrows: true,
                asNavFor: null,
                prevArrow: '<button type="button" data-role="none" class="slick-prev" aria-label="Previous" tabindex="0" role="button">Previous</button>',
                nextArrow: '<button type="button" data-role="none" class="slick-next" aria-label="Next" tabindex="0" role="button">Next</button>',
                autoplay: false,
                autoplaySpeed: 3000,
                centerMode: false,
                centerPadding: '50px',
                cssEase: 'ease',
                customPaging: function(slider, i) {
                    return $('<button type="button" data-role="none" role="button" tabindex="0" />').text(i + 1);
                },
                dots: false,
                dotsClass: 'slick-dots',
                draggable: true,
                easing: 'linear',
                edgeFriction: 0.35,
                fade: false,
                focusOnSelect: false,
                infinite: true,
                initialSlide: 0,
                lazyLoad: 'ondemand',
                mobileFirst: false,
                outerEdgeLimit: false,
                pauseOnHover: true,
                pauseOnFocus: true,
                pauseOnDotsHover: false,
                respondTo: 'window',
                responsive: null,
                rows: 1,
                rtl: false,
                slide: '',
                slidesPerRow: 1,
                slidesToShow: 1,
                slidesToScroll: 1,
                speed: 500,
                swipe: true,
                swipeToSlide: false,
                touchMove: true,
                touchThreshold: 5,
                useCSS: true,
                useTransform: true,
                variableWidth: false,
                vertical: false,
                verticalSwiping: false,
                waitForAnimate: true,
                zIndex: 1000
            };

            _.initials = {
                animating: false,
                dragging: false,
                autoPlayTimer: null,
                currentDirection: 0,
                currentLeft: null,
                currentSlide: 0,
                direction: 1,
                $dots: null,
                listWidth: null,
                listHeight: null,
                loadIndex: 0,
                $nextArrow: null,
                $prevArrow: null,
                scrolling: false,
                slideCount: null,
                slideWidth: null,
                $slideTrack: null,
                $slides: null,
                sliding: false,
                slideOffset: 0,
                swipeLeft: null,
                swiping: false,
                $list: null,
                touchObject: {},
                transformsEnabled: false,
                unslicked: false
            };

            $.extend(_, _.initials);

            _.activeBreakpoint = null;
            _.animType = null;
            _.animProp = null;
            _.breakpoints = [];
            _.breakpointSettings = [];
            _.cssTransitions = false;
            _.focussed = false;
            _.interrupted = false;
            _.hidden = 'hidden';
            _.paused = true;
            _.positionProp = null;
            _.respondTo = null;
            _.rowCount = 1;
            _.shouldClick = true;
            _.$slider = $(element);
            _.$slidesCache = null;
            _.transformType = null;
            _.transitionType = null;
            _.visibilityChange = 'visibilitychange';
            _.windowWidth = 0;
            _.windowTimer = null;

            dataSettings = $(element).data('slick') || {};

            _.options = $.extend({}, _.defaults, settings, dataSettings);

            _.currentSlide = _.options.initialSlide;

            _.originalSettings = _.options;

            if (typeof document.mozHidden !== 'undefined') {
                _.hidden = 'mozHidden';
                _.visibilityChange = 'mozvisibilitychange';
            } else if (typeof document.webkitHidden !== 'undefined') {
                _.hidden = 'webkitHidden';
                _.visibilityChange = 'webkitvisibilitychange';
            }

            _.autoPlay = $.proxy(_.autoPlay, _);
            _.autoPlayClear = $.proxy(_.autoPlayClear, _);
            _.autoPlayIterator = $.proxy(_.autoPlayIterator, _);
            _.changeSlide = $.proxy(_.changeSlide, _);
            _.clickHandler = $.proxy(_.clickHandler, _);
            _.selectHandler = $.proxy(_.selectHandler, _);
            _.setPosition = $.proxy(_.setPosition, _);
            _.swipeHandler = $.proxy(_.swipeHandler, _);
            _.dragHandler = $.proxy(_.dragHandler, _);
            _.keyHandler = $.proxy(_.keyHandler, _);

            _.instanceUid = instanceUid++;

            // A simple way to check for HTML strings
            // Strict HTML recognition (must start with <)
            // Extracted from jQuery v1.11 source
            _.htmlExpr = /^(?:\s*(<[\w\W]+>)[^>]*)$/;


            _.registerBreakpoints();
            _.init(true);

        }

        return Slick;

    }());

    Slick.prototype.activateADA = function() {
        var _ = this;
        var $slideTrack = _.$slideTrack || $();

        $slideTrack.find('.slick-active').attr({
            'aria-hidden': 'false'
        }).find('a, input, button, select').attr({
            'tabindex': '0'
        });

    };

    Slick.prototype.addSlide = Slick.prototype.slickAdd = function(markup, index, addBefore) {

        var _ = this;

        if (typeof(index) === 'boolean') {
            addBefore = index;
            index = null;
        } else if (index < 0 || (index >= _.slideCount)) {
            return false;
        }

        _.unload();

        if (typeof(index) === 'number') {
            if (index === 0 && _.$slides.length === 0) {
                $(markup).appendTo(_.$slideTrack);
            } else if (addBefore) {
                $(markup).insertBefore(_.$slides.eq(index));
            } else {
                $(markup).insertAfter(_.$slides.eq(index));
            }
        } else {
            if (addBefore === true) {
                $(markup).prependTo(_.$slideTrack);
            } else {
                $(markup).appendTo(_.$slideTrack);
            }
        }

        _.$slides = _.$slideTrack.children(this.options.slide);

        _.$slideTrack.children(this.options.slide).detach();

        _.$slideTrack.append(_.$slides);

        _.$slides.each(function(index, element) {
            $(element).attr('data-slick-index', index);
        });

        _.$slidesCache = _.$slides;

        _.reinit();

    };

    Slick.prototype.animateHeight = function() {
        var _ = this;
        if (_.options.slidesToShow === 1 && _.options.adaptiveHeight === true && _.options.vertical === false) {
            var targetHeight = _.$slides.eq(_.currentSlide).outerHeight(true);
            _.$list.animate({
                height: targetHeight
            }, _.options.speed);
        }
    };

    Slick.prototype.animateSlide = function(targetLeft, callback) {

        var animProps = {},
            _ = this;

        _.animateHeight();

        if (_.options.rtl === true && _.options.vertical === false) {
            targetLeft = -targetLeft;
        }
        if (_.transformsEnabled === false) {
            if (_.options.vertical === false) {
                _.$slideTrack.animate({
                    left: targetLeft
                }, _.options.speed, _.options.easing, callback);
            } else {
                _.$slideTrack.animate({
                    top: targetLeft
                }, _.options.speed, _.options.easing, callback);
            }

        } else {

            if (_.cssTransitions === false) {
                if (_.options.rtl === true) {
                    _.currentLeft = -(_.currentLeft);
                }
                $({
                    animStart: _.currentLeft
                }).animate({
                    animStart: targetLeft
                }, {
                    duration: _.options.speed,
                    easing: _.options.easing,
                    step: function(now) {
                        now = Math.ceil(now);
                        if (_.options.vertical === false) {
                            animProps[_.animType] = 'translate(' +
                                now + 'px, 0px)';
                            _.$slideTrack.css(animProps);
                        } else {
                            animProps[_.animType] = 'translate(0px,' +
                                now + 'px)';
                            _.$slideTrack.css(animProps);
                        }
                    },
                    complete: function() {
                        if (callback) {
                            callback.call();
                        }
                    }
                });

            } else {

                _.applyTransition();
                targetLeft = Math.ceil(targetLeft);

                if (_.options.vertical === false) {
                    animProps[_.animType] = 'translate3d(' + targetLeft + 'px, 0px, 0px)';
                } else {
                    animProps[_.animType] = 'translate3d(0px,' + targetLeft + 'px, 0px)';
                }
                _.$slideTrack.css(animProps);

                if (callback) {
                    setTimeout(function() {

                        _.disableTransition();

                        callback.call();
                    }, _.options.speed);
                }

            }

        }

    };

    Slick.prototype.getNavTarget = function() {

        var _ = this,
            asNavFor = _.options.asNavFor;

        if ( asNavFor && asNavFor !== null ) {
            asNavFor = $(asNavFor).not(_.$slider);
        }

        return asNavFor;

    };

    Slick.prototype.asNavFor = function(index) {

        var _ = this,
            asNavFor = _.getNavTarget();

        if ( asNavFor !== null && typeof asNavFor === 'object' ) {
            asNavFor.each(function() {
                var target = $(this).slick('getSlick');
                if(!target.unslicked) {
                    target.slideHandler(index, true);
                }
            });
        }

    };

    Slick.prototype.applyTransition = function(slide) {

        var _ = this,
            transition = {};

        if (_.options.fade === false) {
            transition[_.transitionType] = _.transformType + ' ' + _.options.speed + 'ms ' + _.options.cssEase;
        } else {
            transition[_.transitionType] = 'opacity ' + _.options.speed + 'ms ' + _.options.cssEase;
        }

        if (_.options.fade === false) {
            _.$slideTrack.css(transition);
        } else {
            _.$slides.eq(slide).css(transition);
        }

    };

    Slick.prototype.autoPlay = function() {

        var _ = this;

        _.autoPlayClear();

        if ( _.slideCount > _.options.slidesToShow ) {
            _.autoPlayTimer = setInterval( _.autoPlayIterator, _.options.autoplaySpeed );
        }

    };

    Slick.prototype.autoPlayClear = function() {

        var _ = this;

        if (_.autoPlayTimer) {
            clearInterval(_.autoPlayTimer);
        }

    };

    Slick.prototype.autoPlayIterator = function() {

        var _ = this,
            slideTo = _.currentSlide + _.options.slidesToScroll;

        if ( !_.paused && !_.interrupted && !_.focussed ) {

            if ( _.options.infinite === false ) {

                if ( _.direction === 1 && ( _.currentSlide + 1 ) === ( _.slideCount - 1 )) {
                    _.direction = 0;
                }

                else if ( _.direction === 0 ) {

                    slideTo = _.currentSlide - _.options.slidesToScroll;

                    if ( _.currentSlide - 1 === 0 ) {
                        _.direction = 1;
                    }

                }

            }

            _.slideHandler( slideTo );

        }

    };

    Slick.prototype.buildArrows = function() {

        var _ = this;

        if (_.options.arrows === true ) {

            _.$prevArrow = $(_.options.prevArrow).addClass('slick-arrow');
            _.$nextArrow = $(_.options.nextArrow).addClass('slick-arrow');

            if( _.slideCount > _.options.slidesToShow ) {

                _.$prevArrow.removeClass('slick-hidden').removeAttr('aria-hidden tabindex');
                _.$nextArrow.removeClass('slick-hidden').removeAttr('aria-hidden tabindex');

                if (_.htmlExpr.test(_.options.prevArrow)) {
                    _.$prevArrow.prependTo(_.options.appendArrows);
                }

                if (_.htmlExpr.test(_.options.nextArrow)) {
                    _.$nextArrow.appendTo(_.options.appendArrows);
                }

                if (_.options.infinite !== true) {
                    _.$prevArrow
                        .addClass('slick-disabled')
                        .attr('aria-disabled', 'true');
                }

            } else {

                _.$prevArrow.add( _.$nextArrow )

                    .addClass('slick-hidden')
                    .attr({
                        'aria-disabled': 'true',
                        'tabindex': '-1'
                    });

            }

        }

    };

    Slick.prototype.buildDots = function() {

        var _ = this,
            i, dot;

        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {

            _.$slider.addClass('slick-dotted');

            dot = $('<ul />').addClass(_.options.dotsClass);

            for (i = 0; i <= _.getDotCount(); i += 1) {
                dot.append($('<li />').append(_.options.customPaging.call(this, _, i)));
            }

            _.$dots = dot.appendTo(_.options.appendDots);

            _.$dots.find('li').first().addClass('slick-active').attr('aria-hidden', 'false');

        }

    };

    Slick.prototype.buildOut = function() {

        var _ = this;

        _.$slides =
            _.$slider
                .children( _.options.slide + ':not(.slick-cloned)')
                .addClass('slick-slide');

        _.slideCount = _.$slides.length;

        _.$slides.each(function(index, element) {
            $(element)
                .attr('data-slick-index', index)
                .data('originalStyling', $(element).attr('style') || '');
        });

        _.$slider.addClass('slick-slider');

        _.$slideTrack = (_.slideCount === 0) ?
            $('<div class="slick-track" aria-label="Tabs"/>').appendTo(_.$slider) :
            _.$slides.wrapAll('<div class="slick-track" aria-label="Tabs"/>').parent();

        _.$list = _.$slideTrack.wrap(
            '<div aria-live="polite" class="slick-list"/>').parent();
        _.$slideTrack.css('opacity', 0);

        if (_.options.centerMode === true || _.options.swipeToSlide === true) {
            _.options.slidesToScroll = 1;
        }

        $('img[data-lazy]', _.$slider).not('[src]').addClass('slick-loading');

        _.setupInfinite();

        _.buildArrows();

        _.buildDots();

        _.updateDots();


        _.setSlideClasses(typeof _.currentSlide === 'number' ? _.currentSlide : 0);

        if (_.options.draggable === true) {
            _.$list.addClass('draggable');
        }

    };

    Slick.prototype.buildRows = function() {

        var _ = this, a, b, c, newSlides, numOfSlides, originalSlides,slidesPerSection;

        newSlides = document.createDocumentFragment();
        originalSlides = _.$slider.children();

        if(_.options.rows > 1) {

            slidesPerSection = _.options.slidesPerRow * _.options.rows;
            numOfSlides = Math.ceil(
                originalSlides.length / slidesPerSection
            );

            for(a = 0; a < numOfSlides; a++){
                var slide = document.createElement('div');
                for(b = 0; b < _.options.rows; b++) {
                    var row = document.createElement('div');
                    for(c = 0; c < _.options.slidesPerRow; c++) {
                        var target = (a * slidesPerSection + ((b * _.options.slidesPerRow) + c));
                        if (originalSlides.get(target)) {
                            row.appendChild(originalSlides.get(target));
                        }
                    }
                    slide.appendChild(row);
                }
                newSlides.appendChild(slide);
            }

            _.$slider.empty().append(newSlides);
            _.$slider.children().children().children()
                .css({
                    'width':(100 / _.options.slidesPerRow) + '%',
                    'display': 'inline-block'
                });

        }

    };

    Slick.prototype.checkResponsive = function(initial, forceUpdate) {

        var _ = this,
            breakpoint, targetBreakpoint, respondToWidth, triggerBreakpoint = false;
        var sliderWidth = _.$slider.width();
        var windowWidth = window.innerWidth || $(window).width();

        if (_.respondTo === 'window') {
            respondToWidth = windowWidth;
        } else if (_.respondTo === 'slider') {
            respondToWidth = sliderWidth;
        } else if (_.respondTo === 'min') {
            respondToWidth = Math.min(windowWidth, sliderWidth);
        }

        if ( _.options.responsive &&
            _.options.responsive.length &&
            _.options.responsive !== null) {

            targetBreakpoint = null;

            for (breakpoint in _.breakpoints) {
                if (_.breakpoints.hasOwnProperty(breakpoint)) {
                    if (_.originalSettings.mobileFirst === false) {
                        if (respondToWidth < _.breakpoints[breakpoint]) {
                            targetBreakpoint = _.breakpoints[breakpoint];
                        }
                    } else {
                        if (respondToWidth > _.breakpoints[breakpoint]) {
                            targetBreakpoint = _.breakpoints[breakpoint];
                        }
                    }
                }
            }

            if (targetBreakpoint !== null) {
                if (_.activeBreakpoint !== null) {
                    if (targetBreakpoint !== _.activeBreakpoint || forceUpdate) {
                        _.activeBreakpoint =
                            targetBreakpoint;
                        if (_.breakpointSettings[targetBreakpoint] === 'unslick') {
                            _.unslick(targetBreakpoint);
                        } else {
                            _.options = $.extend({}, _.originalSettings,
                                _.breakpointSettings[
                                    targetBreakpoint]);
                            if (initial === true) {
                                _.currentSlide = _.options.initialSlide;
                            }
                            _.refresh(initial);
                        }
                        triggerBreakpoint = targetBreakpoint;
                    }
                } else {
                    _.activeBreakpoint = targetBreakpoint;
                    if (_.breakpointSettings[targetBreakpoint] === 'unslick') {
                        _.unslick(targetBreakpoint);
                    } else {
                        _.options = $.extend({}, _.originalSettings,
                            _.breakpointSettings[
                                targetBreakpoint]);
                        if (initial === true) {
                            _.currentSlide = _.options.initialSlide;
                        }
                        _.refresh(initial);
                    }
                    triggerBreakpoint = targetBreakpoint;
                }
            } else {
                if (_.activeBreakpoint !== null) {
                    _.activeBreakpoint = null;
                    _.options = _.originalSettings;
                    if (initial === true) {
                        _.currentSlide = _.options.initialSlide;
                    }
                    _.refresh(initial);
                    triggerBreakpoint = targetBreakpoint;
                }
            }

            // only trigger breakpoints during an actual break. not on initialize.
            if( !initial && triggerBreakpoint !== false ) {
                _.$slider.trigger('breakpoint', [_, triggerBreakpoint]);
            }
        }

    };

    Slick.prototype.changeSlide = function(event, dontAnimate) {

        var _ = this,
            $target = $(event.currentTarget),
            indexOffset, slideOffset, unevenOffset;

        // If target is a link, prevent default action.
        if($target.is('a')) {
            event.preventDefault();
        }

        // If target is not the <li> element (ie: a child), find the <li>.
        if(!$target.is('li')) {
            $target = $target.closest('li');
        }

        unevenOffset = (_.slideCount % _.options.slidesToScroll !== 0);
        indexOffset = unevenOffset ? 0 : (_.slideCount - _.currentSlide) % _.options.slidesToScroll;

        switch (event.data.message) {

            case 'previous':
                slideOffset = indexOffset === 0 ? _.options.slidesToScroll : _.options.slidesToShow - indexOffset;
                if (_.slideCount > _.options.slidesToShow) {
                    _.slideHandler(_.currentSlide - slideOffset, false, dontAnimate);
                }
                break;

            case 'next':
                slideOffset = indexOffset === 0 ? _.options.slidesToScroll : indexOffset;
                if (_.slideCount > _.options.slidesToShow) {
                    _.slideHandler(_.currentSlide + slideOffset, false, dontAnimate);
                }
                break;

            case 'index':
                var index = event.data.index === 0 ? 0 :
                    event.data.index || $target.index() * _.options.slidesToScroll;

                _.slideHandler(_.checkNavigable(index), false, dontAnimate);
                $target.children().trigger('focus');
                break;

            default:
                return;
        }

    };

    Slick.prototype.checkNavigable = function(index) {

        var _ = this,
            navigables, prevNavigable;

        navigables = _.getNavigableIndexes();
        prevNavigable = 0;
        if (index > navigables[navigables.length - 1]) {
            index = navigables[navigables.length - 1];
        } else {
            for (var n in navigables) {
                if (index < navigables[n]) {
                    index = prevNavigable;
                    break;
                }
                prevNavigable = navigables[n];
            }
        }

        return index;
    };

    Slick.prototype.cleanUpEvents = function() {

        var _ = this;

        if (_.options.dots && _.$dots !== null) {

            $('li', _.$dots)
                .off('click.slick', _.changeSlide)
                .off('mouseenter.slick', $.proxy(_.interrupt, _, true))
                .off('mouseleave.slick', $.proxy(_.interrupt, _, false));

        }

        _.$slider.off('focus.slick blur.slick');

        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {
            _.$prevArrow && _.$prevArrow.off('click.slick', _.changeSlide);
            _.$nextArrow && _.$nextArrow.off('click.slick', _.changeSlide);
        }

        _.$list.off('touchstart.slick mousedown.slick', _.swipeHandler);
        _.$list.off('touchmove.slick mousemove.slick', _.swipeHandler);
        _.$list.off('touchend.slick mouseup.slick', _.swipeHandler);
        _.$list.off('touchcancel.slick mouseleave.slick', _.swipeHandler);

        _.$list.off('click.slick', _.clickHandler);

        $(document).off(_.visibilityChange, _.visibility);

        _.cleanUpSlideEvents();

        if (_.options.accessibility === true) {
            _.$list.off('keydown.slick', _.keyHandler);
        }

        if (_.options.focusOnSelect === true) {
            $(_.$slideTrack).children().off('click.slick', _.selectHandler);
        }

        $(window).off('orientationchange.slick.slick-' + _.instanceUid, _.orientationChange);

        $(window).off('resize.slick.slick-' + _.instanceUid, _.resize);

        $('[draggable!=true]', _.$slideTrack).off('dragstart', _.preventDefault);

        $(window).off('load.slick.slick-' + _.instanceUid, _.setPosition);
        $(document).off('ready.slick.slick-' + _.instanceUid, _.setPosition);

    };

    Slick.prototype.cleanUpSlideEvents = function() {

        var _ = this;

        _.$list.off('mouseenter.slick', $.proxy(_.interrupt, _, true));
        _.$list.off('mouseleave.slick', $.proxy(_.interrupt, _, false));

    };

    Slick.prototype.cleanUpRows = function() {

        var _ = this, originalSlides;

        if(_.options.rows > 1) {
            originalSlides = _.$slides.children().children();
            originalSlides.removeAttr('style');
            _.$slider.empty().append(originalSlides);
        }

    };

    Slick.prototype.clickHandler = function(event) {

        var _ = this;

        if (_.shouldClick === false) {
            event.stopImmediatePropagation();
            event.stopPropagation();
            event.preventDefault();
        }

    };

    Slick.prototype.destroy = function(refresh) {

        var _ = this;

        _.autoPlayClear();

        _.touchObject = {};

        _.cleanUpEvents();

        $('.slick-cloned', _.$slider).detach();

        if (_.$dots) {
            _.$dots.remove();
        }


        if ( _.$prevArrow && _.$prevArrow.length ) {

            _.$prevArrow
                .removeClass('slick-disabled slick-arrow slick-hidden')
                .removeAttr('aria-hidden aria-disabled tabindex')
                .css('display','');

            if ( _.htmlExpr.test( _.options.prevArrow )) {
                _.$prevArrow.remove();
            }
        }

        if ( _.$nextArrow && _.$nextArrow.length ) {

            _.$nextArrow
                .removeClass('slick-disabled slick-arrow slick-hidden')
                .removeAttr('aria-hidden aria-disabled tabindex')
                .css('display','');

            if ( _.htmlExpr.test( _.options.nextArrow )) {
                _.$nextArrow.remove();
            }

        }


        if (_.$slides) {

            _.$slides
                .removeClass('slick-slide slick-active slick-center slick-visible slick-current')
                .removeAttr('aria-hidden')
                .removeAttr('data-slick-index')
                .each(function(){
                    $(this).attr('style', $(this).data('originalStyling'));
                });

            _.$slideTrack.children(this.options.slide).detach();

            _.$slideTrack.detach();

            _.$list.detach();

            _.$slider.append(_.$slides);
        }

        _.cleanUpRows();

        _.$slider.removeClass('slick-slider');
        _.$slider.removeClass('slick-initialized');
        _.$slider.removeClass('slick-dotted');

        _.unslicked = true;

        if(!refresh) {
            _.$slider.trigger('destroy', [_]);
        }

    };

    Slick.prototype.disableTransition = function(slide) {

        var _ = this,
            transition = {};

        transition[_.transitionType] = '';

        if (_.options.fade === false) {
            _.$slideTrack.css(transition);
        } else {
            _.$slides.eq(slide).css(transition);
        }

    };

    Slick.prototype.fadeSlide = function(slideIndex, callback) {

        var _ = this;

        if (_.cssTransitions === false) {

            _.$slides.eq(slideIndex).css({
                zIndex: _.options.zIndex
            });

            _.$slides.eq(slideIndex).animate({
                opacity: 1
            }, _.options.speed, _.options.easing, callback);

        } else {

            _.applyTransition(slideIndex);

            _.$slides.eq(slideIndex).css({
                opacity: 1,
                zIndex: _.options.zIndex
            });

            if (callback) {
                setTimeout(function() {

                    _.disableTransition(slideIndex);

                    callback.call();
                }, _.options.speed);
            }

        }

    };

    Slick.prototype.fadeSlideOut = function(slideIndex) {

        var _ = this;

        if (_.cssTransitions === false) {

            _.$slides.eq(slideIndex).animate({
                opacity: 0,
                zIndex: _.options.zIndex - 2
            }, _.options.speed, _.options.easing);

        } else {

            _.applyTransition(slideIndex);

            _.$slides.eq(slideIndex).css({
                opacity: 0,
                zIndex: _.options.zIndex - 2
            });

        }

    };

    Slick.prototype.filterSlides = Slick.prototype.slickFilter = function(filter) {

        var _ = this;

        if (filter !== null) {

            _.$slidesCache = _.$slides;

            _.unload();

            _.$slideTrack.children(this.options.slide).detach();

            _.$slidesCache.filter(filter).appendTo(_.$slideTrack);

            _.reinit();

        }

    };

    Slick.prototype.focusHandler = function() {

        var _ = this;

        _.$slider
            .off('focus.slick blur.slick')
            .on('focus.slick blur.slick',
                '*:not(.slick-arrow)', function(event) {

                    event.stopImmediatePropagation();
                    var $sf = $(this);

                    setTimeout(function() {

                        if( _.options.pauseOnFocus ) {
                            _.focussed = $sf.is(':focus');
                            _.autoPlay();
                        }

                    }, 0);

                });
    };

    Slick.prototype.getCurrent = Slick.prototype.slickCurrentSlide = function() {

        var _ = this;
        return _.currentSlide;

    };

    Slick.prototype.getDotCount = function() {

        var _ = this;

        var breakPoint = 0;
        var counter = 0;
        var pagerQty = 0;

        if (_.options.infinite === true) {
            while (breakPoint < _.slideCount) {
                ++pagerQty;
                breakPoint = counter + _.options.slidesToScroll;
                counter += _.options.slidesToScroll <= _.options.slidesToShow ? _.options.slidesToScroll : _.options.slidesToShow;
            }
        } else if (_.options.centerMode === true) {
            pagerQty = _.slideCount;
        } else if(!_.options.asNavFor) {
            pagerQty = 1 + Math.ceil((_.slideCount - _.options.slidesToShow) / _.options.slidesToScroll);
        }else {
            while (breakPoint < _.slideCount) {
                ++pagerQty;
                breakPoint = counter + _.options.slidesToScroll;
                counter += _.options.slidesToScroll <= _.options.slidesToShow ? _.options.slidesToScroll : _.options.slidesToShow;
            }
        }

        return pagerQty - 1;

    };

    Slick.prototype.getLeft = function(slideIndex) {

        var _ = this,
            targetLeft,
            verticalHeight,
            verticalOffset = 0,
            targetSlide;

        _.slideOffset = 0;
        verticalHeight = _.$slides.first().outerHeight(true);

        if (_.options.infinite === true) {
            if (_.slideCount > _.options.slidesToShow) {
                _.slideOffset = (_.slideWidth * _.options.slidesToShow) * -1;
                verticalOffset = (verticalHeight * _.options.slidesToShow) * -1;
            }
            if (_.slideCount % _.options.slidesToScroll !== 0) {
                if (slideIndex + _.options.slidesToScroll > _.slideCount && _.slideCount > _.options.slidesToShow) {
                    if (slideIndex > _.slideCount) {
                        _.slideOffset = ((_.options.slidesToShow - (slideIndex - _.slideCount)) * _.slideWidth) * -1;
                        verticalOffset = ((_.options.slidesToShow - (slideIndex - _.slideCount)) * verticalHeight) * -1;
                    } else {
                        _.slideOffset = ((_.slideCount % _.options.slidesToScroll) * _.slideWidth) * -1;
                        verticalOffset = ((_.slideCount % _.options.slidesToScroll) * verticalHeight) * -1;
                    }
                }
            }
        } else {
            if (slideIndex + _.options.slidesToShow > _.slideCount) {
                _.slideOffset = ((slideIndex + _.options.slidesToShow) - _.slideCount) * _.slideWidth;
                verticalOffset = ((slideIndex + _.options.slidesToShow) - _.slideCount) * verticalHeight;
            }
        }

        if (_.slideCount <= _.options.slidesToShow) {
            _.slideOffset = 0;
            verticalOffset = 0;
        }

        if (_.options.centerMode === true && _.options.infinite === true) {
            _.slideOffset += _.slideWidth * Math.floor(_.options.slidesToShow / 2) - _.slideWidth;
        } else if (_.options.centerMode === true) {
            _.slideOffset = 0;
            _.slideOffset += _.slideWidth * Math.floor(_.options.slidesToShow / 2);
        }

        if (_.options.vertical === false) {
            targetLeft = ((slideIndex * _.slideWidth) * -1) + _.slideOffset;
        } else {
            targetLeft = ((slideIndex * verticalHeight) * -1) + verticalOffset;
        }

        if (_.options.variableWidth === true) {

            if (_.slideCount <= _.options.slidesToShow || _.options.infinite === false) {
                targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex);
            } else {
                targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex + _.options.slidesToShow);
            }

            if (_.options.rtl === true) {
                if (targetSlide[0]) {
                    targetLeft = (_.$slideTrack.width() - targetSlide[0].offsetLeft - targetSlide.width()) * -1;
                } else {
                    targetLeft =  0;
                }
            } else {
                targetLeft = targetSlide[0] ? targetSlide[0].offsetLeft * -1 : 0;
            }

            if (_.options.centerMode === true) {
                if (_.slideCount <= _.options.slidesToShow || _.options.infinite === false) {
                    targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex);
                } else {
                    targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex + _.options.slidesToShow + 1);
                }

                if (_.options.rtl === true) {
                    if (targetSlide[0]) {
                        targetLeft = (_.$slideTrack.width() - targetSlide[0].offsetLeft - targetSlide.width()) * -1;
                    } else {
                        targetLeft =  0;
                    }
                } else {
                    targetLeft = targetSlide[0] ? targetSlide[0].offsetLeft * -1 : 0;
                }

                targetLeft += (_.$list.width() - targetSlide.outerWidth()) / 2;
            } else if (_.options.outerEdgeLimit) {
                var lastSlide,
                    lastLeft,
                    outerEdgeLimit;
                lastSlide = _.$slides.last();
                lastLeft = lastSlide[0] ? lastSlide[0].offsetLeft * -1 : 0;
                outerEdgeLimit = lastLeft - lastSlide.width() + this.$slider.width();
                targetLeft = Math.min(Math.max(targetLeft, outerEdgeLimit), 0);
            }
        }

        return targetLeft;

    };

    Slick.prototype.getOption = Slick.prototype.slickGetOption = function(option) {

        var _ = this;

        return _.options[option];

    };

    Slick.prototype.getNavigableIndexes = function() {

        var _ = this,
            breakPoint = 0,
            counter = 0,
            indexes = [],
            max;

        if (_.options.infinite === false) {
            max = _.slideCount;
        } else {
            breakPoint = _.options.slidesToScroll * -1;
            counter = _.options.slidesToScroll * -1;
            max = _.slideCount * 2;
        }

        while (breakPoint < max) {
            indexes.push(breakPoint);
            breakPoint = counter + _.options.slidesToScroll;
            counter += _.options.slidesToScroll <= _.options.slidesToShow ? _.options.slidesToScroll : _.options.slidesToShow;
        }

        return indexes;

    };

    Slick.prototype.getSlick = function() {

        return this;

    };

    Slick.prototype.getSlideCount = function() {

        var _ = this,
            slidesTraversed, swipedSlide, centerOffset;

        centerOffset = _.options.centerMode === true ? _.slideWidth * Math.floor(_.options.slidesToShow / 2) : 0;

        if (_.options.swipeToSlide === true) {
            _.$slideTrack.find('.slick-slide').each(function(index, slide) {
                if (slide.offsetLeft - centerOffset + ($(slide).outerWidth() / 2) > (_.swipeLeft * -1)) {
                    swipedSlide = slide;
                    return false;
                }
            });

            slidesTraversed = Math.abs($(swipedSlide).attr('data-slick-index') - _.currentSlide) || 1;

            return slidesTraversed;

        } else {
            return _.options.slidesToScroll;
        }

    };

    Slick.prototype.goTo = Slick.prototype.slickGoTo = function(slide, dontAnimate) {

        var _ = this;

        _.changeSlide({
            data: {
                message: 'index',
                index: parseInt(slide)
            }
        }, dontAnimate);

    };

    Slick.prototype.init = function(creation) {

        var _ = this;

        if (!$(_.$slider).hasClass('slick-initialized')) {

            $(_.$slider).addClass('slick-initialized');

            _.buildRows();
            _.buildOut();
            _.setProps();
            _.startLoad();
            _.loadSlider();
            _.initializeEvents();
            _.updateArrows();
            _.updateDots();
            _.checkResponsive(true);
            _.focusHandler();

        }

        if (creation) {
            _.$slider.trigger('init', [_]);
        }

        if (_.options.accessibility === true) {
            _.initADA();
        }

        if ( _.options.autoplay ) {

            _.paused = false;
            _.autoPlay();

        }

    };

    Slick.prototype.initADA = function() {
        var _ = this;
        var $slides = _.$slides || $();
        var $slideTrack = _.$slideTrack || $();

        $slides.add($slideTrack.find('.slick-cloned')).attr({
            'aria-hidden': 'true',
            'tabindex': '-1'
        }).find('a, input, button, select').attr({
            'tabindex': '-1'
        });

        if (_.$slideTrack) {
            _.$slideTrack.attr('role', 'listbox');
        }

        $slides.not($slideTrack.find('.slick-cloned')).each(function(i) {
            $(this).attr({
                'role': 'option',
                'aria-describedby': 'slick-slide' + _.instanceUid + i + ''
            });
        });

        if (_.$dots !== null) {
            _.$dots.attr('role', 'tablist').find('li').each(function(i) {
                $(this).attr({
                    'role': 'presentation',
                    'aria-selected': 'false',
                    'aria-controls': 'navigation' + _.instanceUid + i + '',
                    'id': 'slick-slide' + _.instanceUid + i + ''
                });
            })
                .first().attr('aria-selected', 'true').end()
                .find('button').attr('role', 'button').end()
                .closest('div').attr('role', 'toolbar');
        }
        _.activateADA();

    };

    Slick.prototype.initArrowEvents = function() {

        var _ = this;

        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {
            _.$prevArrow
                .off('click.slick')
                .on('click.slick', {
                    message: 'previous'
                }, _.changeSlide);
            _.$nextArrow
                .off('click.slick')
                .on('click.slick', {
                    message: 'next'
                }, _.changeSlide);
        }

    };

    Slick.prototype.initDotEvents = function() {

        var _ = this;

        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {
            $('li', _.$dots).on('click.slick', {
                message: 'index'
            }, _.changeSlide);
        }

        if ( _.options.dots === true && _.options.pauseOnDotsHover === true ) {

            $('li', _.$dots)
                .on('mouseenter.slick', $.proxy(_.interrupt, _, true))
                .on('mouseleave.slick', $.proxy(_.interrupt, _, false));

        }

    };

    Slick.prototype.initSlideEvents = function() {

        var _ = this;

        if ( _.options.pauseOnHover ) {

            _.$list.on('mouseenter.slick', $.proxy(_.interrupt, _, true));
            _.$list.on('mouseleave.slick', $.proxy(_.interrupt, _, false));

        }

    };

    Slick.prototype.initializeEvents = function() {

        var _ = this;

        _.initArrowEvents();

        _.initDotEvents();
        _.initSlideEvents();

        _.$list.on('touchstart.slick mousedown.slick', {
            action: 'start'
        }, _.swipeHandler);
        _.$list.on('touchmove.slick mousemove.slick', {
            action: 'move'
        }, _.swipeHandler);
        _.$list.on('touchend.slick mouseup.slick', {
            action: 'end'
        }, _.swipeHandler);
        _.$list.on('touchcancel.slick mouseleave.slick', {
            action: 'end'
        }, _.swipeHandler);

        _.$list.on('click.slick', _.clickHandler);

        $(document).on(_.visibilityChange, $.proxy(_.visibility, _));

        if (_.options.accessibility === true) {
            _.$list.on('keydown.slick', _.keyHandler);
        }

        if (_.options.focusOnSelect === true) {
            $(_.$slideTrack).children().on('click.slick', _.selectHandler);
        }

        $(window).on('orientationchange.slick.slick-' + _.instanceUid, $.proxy(_.orientationChange, _));

        $(window).on('resize.slick.slick-' + _.instanceUid, $.proxy(_.resize, _));

        $('[draggable!=true]', _.$slideTrack).on('dragstart', _.preventDefault);

        $(window).on('load.slick.slick-' + _.instanceUid, _.setPosition);
        $(document).on('ready.slick.slick-' + _.instanceUid, _.setPosition);

    };

    Slick.prototype.initUI = function() {

        var _ = this;

        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {

            _.$prevArrow.show();
            _.$nextArrow.show();

        }

        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {

            _.$dots.show();

        }

    };

    Slick.prototype.keyHandler = function(event) {

        var _ = this;
        //Dont slide if the cursor is inside the form fields and arrow keys are pressed
        if(!event.target.tagName.match('TEXTAREA|INPUT|SELECT')) {
            if (event.keyCode === 37 && _.options.accessibility === true) {
                _.changeSlide({
                    data: {
                        message: _.options.rtl === true ? 'next' :  'previous'
                    }
                });
            } else if (event.keyCode === 39 && _.options.accessibility === true) {
                _.changeSlide({
                    data: {
                        message: _.options.rtl === true ? 'previous' : 'next'
                    }
                });
            }
        }

    };

    Slick.prototype.lazyLoad = function() {

        var _ = this,
            loadRange, cloneRange, rangeStart, rangeEnd;

        function loadImages(imagesScope) {

            $('img[data-lazy]', imagesScope).each(function() {

                var image = $(this),
                    imageSource = $(this).attr('data-lazy'),
                    imageToLoad = document.createElement('img');

                imageToLoad.onload = function() {

                    image
                        .animate({ opacity: 0 }, 100, function() {
                            image
                                .attr('src', imageSource)
                                .animate({ opacity: 1 }, 200, function() {
                                    image
                                        .removeAttr('data-lazy')
                                        .removeClass('slick-loading');
                                });
                            _.$slider.trigger('lazyLoaded', [_, image, imageSource]);
                        });

                };

                imageToLoad.onerror = function() {

                    image
                        .removeAttr( 'data-lazy' )
                        .removeClass( 'slick-loading' )
                        .addClass( 'slick-lazyload-error' );

                    _.$slider.trigger('lazyLoadError', [ _, image, imageSource ]);

                };

                imageToLoad.src = imageSource;

            });

        }

        if (_.options.centerMode === true) {
            if (_.options.infinite === true) {
                rangeStart = _.currentSlide + (_.options.slidesToShow / 2 + 1);
                rangeEnd = rangeStart + _.options.slidesToShow + 2;
            } else {
                rangeStart = Math.max(0, _.currentSlide - (_.options.slidesToShow / 2 + 1));
                rangeEnd = 2 + (_.options.slidesToShow / 2 + 1) + _.currentSlide;
            }
        } else {
            rangeStart = _.options.infinite ? _.options.slidesToShow + _.currentSlide : _.currentSlide;
            rangeEnd = Math.ceil(rangeStart + _.options.slidesToShow);
            if (_.options.fade === true) {
                if (rangeStart > 0) rangeStart--;
                if (rangeEnd <= _.slideCount) rangeEnd++;
            }
        }

        loadRange = _.$slider.find('.slick-slide').slice(rangeStart, rangeEnd);
        loadImages(loadRange);

        if (_.slideCount <= _.options.slidesToShow) {
            cloneRange = _.$slider.find('.slick-slide');
            loadImages(cloneRange);
        } else
        if (_.currentSlide >= _.slideCount - _.options.slidesToShow) {
            cloneRange = _.$slider.find('.slick-cloned').slice(0, _.options.slidesToShow);
            loadImages(cloneRange);
        } else if (_.currentSlide === 0) {
            cloneRange = _.$slider.find('.slick-cloned').slice(_.options.slidesToShow * -1);
            loadImages(cloneRange);
        }

    };

    Slick.prototype.loadSlider = function() {

        var _ = this;

        _.setPosition();

        _.$slideTrack.css({
            opacity: 1
        });

        _.$slider.removeClass('slick-loading');

        _.initUI();

        if (_.options.lazyLoad === 'progressive') {
            _.progressiveLazyLoad();
        }

    };

    Slick.prototype.next = Slick.prototype.slickNext = function() {

        var _ = this;

        _.changeSlide({
            data: {
                message: 'next'
            }
        });

    };

    Slick.prototype.orientationChange = function() {

        var _ = this;

        _.checkResponsive();
        _.setPosition();

    };

    Slick.prototype.pause = Slick.prototype.slickPause = function() {

        var _ = this;

        _.autoPlayClear();
        _.paused = true;

    };

    Slick.prototype.play = Slick.prototype.slickPlay = function() {

        var _ = this;

        _.autoPlay();
        _.options.autoplay = true;
        _.paused = false;
        _.focussed = false;
        _.interrupted = false;

    };

    Slick.prototype.postSlide = function(index) {

        var _ = this;

        if( !_.unslicked ) {

            _.$slider.trigger('afterChange', [_, index]);
            _.updateArrows();

            _.animating = false;

            _.setPosition();

            _.swipeLeft = null;

            if ( _.options.autoplay ) {
                _.autoPlay();
            }

            if (_.options.accessibility === true) {
                _.initADA();
            }

        }

    };

    Slick.prototype.prev = Slick.prototype.slickPrev = function() {

        var _ = this;

        _.changeSlide({
            data: {
                message: 'previous'
            }
        });

    };

    Slick.prototype.preventDefault = function(event) {

        event.preventDefault();

    };

    Slick.prototype.progressiveLazyLoad = function( tryCount ) {

        tryCount = tryCount || 1;

        var _ = this,
            $imgsToLoad = $( 'img[data-lazy]', _.$slider ),
            image,
            imageSource,
            imageToLoad;

        if ( $imgsToLoad.length ) {

            image = $imgsToLoad.first();
            imageSource = image.attr('data-lazy');
            imageToLoad = document.createElement('img');

            imageToLoad.onload = function() {

                image
                    .attr( 'src', imageSource )
                    .removeAttr('data-lazy')
                    .removeClass('slick-loading');

                if ( _.options.adaptiveHeight === true ) {
                    _.setPosition();
                }

                _.$slider.trigger('lazyLoaded', [ _, image, imageSource ]);
                _.progressiveLazyLoad();

            };

            imageToLoad.onerror = function() {

                if ( tryCount < 3 ) {

                    /**
                     * try to load the image 3 times,
                     * leave a slight delay so we don't get
                     * servers blocking the request.
                     */
                    setTimeout( function() {
                        _.progressiveLazyLoad( tryCount + 1 );
                    }, 500 );

                } else {

                    image
                        .removeAttr( 'data-lazy' )
                        .removeClass( 'slick-loading' )
                        .addClass( 'slick-lazyload-error' );

                    _.$slider.trigger('lazyLoadError', [ _, image, imageSource ]);

                    _.progressiveLazyLoad();

                }

            };

            imageToLoad.src = imageSource;

        } else {

            _.$slider.trigger('allImagesLoaded', [ _ ]);

        }

    };

    Slick.prototype.refresh = function( initializing ) {

        var _ = this, currentSlide, lastVisibleIndex;

        lastVisibleIndex = _.slideCount - _.options.slidesToShow;

        // in non-infinite sliders, we don't want to go past the
        // last visible index.
        if( !_.options.infinite && ( _.currentSlide > lastVisibleIndex )) {
            _.currentSlide = lastVisibleIndex;
        }

        // if less slides than to show, go to start.
        if ( _.slideCount <= _.options.slidesToShow ) {
            _.currentSlide = 0;

        }

        currentSlide = _.currentSlide;

        _.destroy(true);

        $.extend(_, _.initials, { currentSlide: currentSlide });

        _.init();

        if( !initializing ) {

            _.changeSlide({
                data: {
                    message: 'index',
                    index: currentSlide
                }
            }, false);

        }

    };

    Slick.prototype.registerBreakpoints = function() {

        var _ = this, breakpoint, currentBreakpoint, l,
            responsiveSettings = _.options.responsive || null;

        if ( $.type(responsiveSettings) === 'array' && responsiveSettings.length ) {

            _.respondTo = _.options.respondTo || 'window';

            for ( breakpoint in responsiveSettings ) {

                l = _.breakpoints.length-1;
                currentBreakpoint = responsiveSettings[breakpoint].breakpoint;

                if (responsiveSettings.hasOwnProperty(breakpoint)) {

                    // loop through the breakpoints and cut out any existing
                    // ones with the same breakpoint number, we don't want dupes.
                    while( l >= 0 ) {
                        if( _.breakpoints[l] && _.breakpoints[l] === currentBreakpoint ) {
                            _.breakpoints.splice(l,1);
                        }
                        l--;
                    }

                    _.breakpoints.push(currentBreakpoint);
                    _.breakpointSettings[currentBreakpoint] = responsiveSettings[breakpoint].settings;

                }

            }

            _.breakpoints.sort(function(a, b) {
                return ( _.options.mobileFirst ) ? a-b : b-a;
            });

        }

    };

    Slick.prototype.reinit = function() {

        var _ = this;

        _.$slides =
            _.$slideTrack
                .children(_.options.slide)
                .addClass('slick-slide');

        _.slideCount = _.$slides.length;

        if (_.currentSlide >= _.slideCount && _.currentSlide !== 0) {
            _.currentSlide = _.currentSlide - _.options.slidesToScroll;
        }

        if (_.slideCount <= _.options.slidesToShow) {
            _.currentSlide = 0;
        }

        _.registerBreakpoints();

        _.setProps();
        _.setupInfinite();
        _.buildArrows();
        _.updateArrows();
        _.initArrowEvents();
        _.buildDots();
        _.updateDots();
        _.initDotEvents();
        _.cleanUpSlideEvents();
        _.initSlideEvents();

        _.checkResponsive(false, true);

        if (_.options.focusOnSelect === true) {
            $(_.$slideTrack).children().on('click.slick', _.selectHandler);
        }

        _.setSlideClasses(typeof _.currentSlide === 'number' ? _.currentSlide : 0);

        _.setPosition();
        _.focusHandler();

        _.paused = !_.options.autoplay;
        _.autoPlay();

        _.$slider.trigger('reInit', [_]);

    };

    Slick.prototype.resize = function() {

        var _ = this;

        if ($(window).width() !== _.windowWidth) {
            clearTimeout(_.windowDelay);
            _.windowDelay = window.setTimeout(function() {
                _.windowWidth = $(window).width();
                _.checkResponsive();
                if( !_.unslicked ) { _.setPosition(); }
            }, 50);
        }
    };

    Slick.prototype.removeSlide = Slick.prototype.slickRemove = function(index, removeBefore, removeAll) {

        var _ = this;

        if (typeof(index) === 'boolean') {
            removeBefore = index;
            index = removeBefore === true ? 0 : _.slideCount - 1;
        } else {
            index = removeBefore === true ? --index : index;
        }

        if (_.slideCount < 1 || index < 0 || index > _.slideCount - 1) {
            return false;
        }

        _.unload();

        if (removeAll === true) {
            _.$slideTrack.children().remove();
        } else {
            _.$slideTrack.children(this.options.slide).eq(index).remove();
        }

        _.$slides = _.$slideTrack.children(this.options.slide);

        _.$slideTrack.children(this.options.slide).detach();

        _.$slideTrack.append(_.$slides);

        _.$slidesCache = _.$slides;

        _.reinit();

    };

    Slick.prototype.setCSS = function(position) {

        var _ = this,
            positionProps = {},
            x, y;

        if (_.options.rtl === true) {
            position = -position;
        }
        x = _.positionProp == 'left' ? Math.ceil(position) + 'px' : '0px';
        y = _.positionProp == 'top' ? Math.ceil(position) + 'px' : '0px';

        positionProps[_.positionProp] = position;

        if (_.transformsEnabled === false) {
            _.$slideTrack.css(positionProps);
        } else {
            positionProps = {};
            if (_.cssTransitions === false) {
                positionProps[_.animType] = 'translate(' + x + ', ' + y + ')';
                _.$slideTrack.css(positionProps);
            } else {
                positionProps[_.animType] = 'translate3d(' + x + ', ' + y + ', 0px)';
                _.$slideTrack.css(positionProps);
            }
        }

    };

    Slick.prototype.setDimensions = function() {

        var _ = this;

        if (_.options.vertical === false) {
            if (_.options.centerMode === true) {
                _.$list.css({
                    padding: ('0px ' + _.options.centerPadding)
                });
            }
        } else {
            _.$list.height(_.$slides.first().outerHeight(true) * _.options.slidesToShow);
            if (_.options.centerMode === true) {
                _.$list.css({
                    padding: (_.options.centerPadding + ' 0px')
                });
            }
        }

        _.listWidth = _.$list.width();
        _.listHeight = _.$list.height();


        if (_.options.vertical === false && _.options.variableWidth === false) {
            _.slideWidth = Math.ceil(_.listWidth / _.options.slidesToShow);
            _.$slideTrack.width(Math.ceil((_.slideWidth * _.$slideTrack.children('.slick-slide').length)));

        } else if (_.options.variableWidth === true) {
            _.$slideTrack.width(5000 * _.slideCount);
        } else {
            _.slideWidth = Math.ceil(_.listWidth);
            _.$slideTrack.height(Math.ceil((_.$slides.first().outerHeight(true) * _.$slideTrack.children('.slick-slide').length)));
        }

        var offset = _.$slides.first().outerWidth(true) - _.$slides.first().width();
        if (_.options.variableWidth === false) _.$slideTrack.children('.slick-slide').width(_.slideWidth - offset);

    };

    Slick.prototype.setFade = function() {

        var _ = this,
            targetLeft;

        _.$slides.each(function(index, element) {
            targetLeft = (_.slideWidth * index) * -1;
            if (_.options.rtl === true) {
                $(element).css({
                    position: 'relative',
                    right: targetLeft,
                    top: 0,
                    zIndex: _.options.zIndex - 2,
                    opacity: 0
                });
            } else {
                $(element).css({
                    position: 'relative',
                    left: targetLeft,
                    top: 0,
                    zIndex: _.options.zIndex - 2,
                    opacity: 0
                });
            }
        });

        _.$slides.eq(_.currentSlide).css({
            zIndex: _.options.zIndex - 1,
            opacity: 1
        });

    };

    Slick.prototype.setHeight = function() {

        var _ = this;

        if (_.options.slidesToShow === 1 && _.options.adaptiveHeight === true && _.options.vertical === false) {
            var targetHeight = _.$slides.eq(_.currentSlide).outerHeight(true);
            _.$list.css('height', targetHeight);
        }

    };

    Slick.prototype.setOption =
        Slick.prototype.slickSetOption = function() {

            /**
             * accepts arguments in format of:
             *
             *  - for changing a single option's value:
             *     .slick("setOption", option, value, refresh )
             *
             *  - for changing a set of responsive options:
             *     .slick("setOption", 'responsive', [{}, ...], refresh )
             *
             *  - for updating multiple values at once (not responsive)
             *     .slick("setOption", { 'option': value, ... }, refresh )
             */

            var _ = this, l, item, option, value, refresh = false, type;

            if( $.type( arguments[0] ) === 'object' ) {

                option =  arguments[0];
                refresh = arguments[1];
                type = 'multiple';

            } else if ( $.type( arguments[0] ) === 'string' ) {

                option =  arguments[0];
                value = arguments[1];
                refresh = arguments[2];

                if ( arguments[0] === 'responsive' && $.type( arguments[1] ) === 'array' ) {

                    type = 'responsive';

                } else if ( typeof arguments[1] !== 'undefined' ) {

                    type = 'single';

                }

            }

            if ( type === 'single' ) {

                _.options[option] = value;


            } else if ( type === 'multiple' ) {

                $.each( option , function( opt, val ) {

                    _.options[opt] = val;

                });


            } else if ( type === 'responsive' ) {

                for ( item in value ) {

                    if( $.type( _.options.responsive ) !== 'array' ) {

                        _.options.responsive = [ value[item] ];

                    } else {

                        l = _.options.responsive.length-1;

                        // loop through the responsive object and splice out duplicates.
                        while( l >= 0 ) {

                            if( _.options.responsive[l].breakpoint === value[item].breakpoint ) {

                                _.options.responsive.splice(l,1);

                            }

                            l--;

                        }

                        _.options.responsive.push( value[item] );

                    }

                }

            }

            if ( refresh ) {

                _.unload();
                _.reinit();

            }

        };

    Slick.prototype.setPosition = function() {

        var _ = this;

        _.setDimensions();

        _.setHeight();

        if (_.options.fade === false) {
            _.setCSS(_.getLeft(_.currentSlide));
        } else {
            _.setFade();
        }

        _.$slider.trigger('setPosition', [_]);

    };

    Slick.prototype.setProps = function() {

        var _ = this,
            bodyStyle = document.body.style;

        _.positionProp = _.options.vertical === true ? 'top' : 'left';

        if (_.positionProp === 'top') {
            _.$slider.addClass('slick-vertical');
        } else {
            _.$slider.removeClass('slick-vertical');
        }

        if (bodyStyle.WebkitTransition !== undefined ||
            bodyStyle.MozTransition !== undefined ||
            bodyStyle.msTransition !== undefined) {
            if (_.options.useCSS === true) {
                _.cssTransitions = true;
            }
        }

        if ( _.options.fade ) {
            if ( typeof _.options.zIndex === 'number' ) {
                if( _.options.zIndex < 3 ) {
                    _.options.zIndex = 3;
                }
            } else {
                _.options.zIndex = _.defaults.zIndex;
            }
        }

        if (bodyStyle.OTransform !== undefined) {
            _.animType = 'OTransform';
            _.transformType = '-o-transform';
            _.transitionType = 'OTransition';
            if (bodyStyle.perspectiveProperty === undefined && bodyStyle.webkitPerspective === undefined) _.animType = false;
        }
        if (bodyStyle.MozTransform !== undefined) {
            _.animType = 'MozTransform';
            _.transformType = '-moz-transform';
            _.transitionType = 'MozTransition';
            if (bodyStyle.perspectiveProperty === undefined && bodyStyle.MozPerspective === undefined) _.animType = false;
        }
        if (bodyStyle.webkitTransform !== undefined) {
            _.animType = 'webkitTransform';
            _.transformType = '-webkit-transform';
            _.transitionType = 'webkitTransition';
            if (bodyStyle.perspectiveProperty === undefined && bodyStyle.webkitPerspective === undefined) _.animType = false;
        }
        if (bodyStyle.msTransform !== undefined) {
            _.animType = 'msTransform';
            _.transformType = '-ms-transform';
            _.transitionType = 'msTransition';
            if (bodyStyle.msTransform === undefined) _.animType = false;
        }
        if (bodyStyle.transform !== undefined && _.animType !== false) {
            _.animType = 'transform';
            _.transformType = 'transform';
            _.transitionType = 'transition';
        }
        _.transformsEnabled = _.options.useTransform && (_.animType !== null && _.animType !== false);
    };


    Slick.prototype.setSlideClasses = function(index) {

        var _ = this,
            centerOffset, allSlides, indexOffset, remainder;

        allSlides = _.$slider
            .find('.slick-slide')
            .removeClass('slick-active slick-center slick-current')
            .attr('aria-hidden', 'true');

        _.$slides
            .eq(index)
            .addClass('slick-current');

        if (_.options.centerMode === true) {

            centerOffset = Math.floor(_.options.slidesToShow / 2);

            if (_.options.infinite === true) {

                if (index >= centerOffset && index <= (_.slideCount - 1) - centerOffset) {

                    _.$slides
                        .slice(index - centerOffset, index + centerOffset + 1)
                        .addClass('slick-active')
                        .attr('aria-hidden', 'false');

                } else {

                    indexOffset = _.options.slidesToShow + index;
                    allSlides
                        .slice(indexOffset - centerOffset + 1, indexOffset + centerOffset + 2)
                        .addClass('slick-active')
                        .attr('aria-hidden', 'false');

                }

                if (index === 0) {

                    allSlides
                        .eq(allSlides.length - 1 - _.options.slidesToShow)
                        .addClass('slick-center');

                } else if (index === _.slideCount - 1) {

                    allSlides
                        .eq(_.options.slidesToShow)
                        .addClass('slick-center');

                }

            }

            _.$slides
                .eq(index)
                .addClass('slick-center');

        } else {

            if (index >= 0 && index <= (_.slideCount - _.options.slidesToShow)) {

                _.$slides
                    .slice(index, index + _.options.slidesToShow)
                    .addClass('slick-active')
                    .attr('aria-hidden', 'false');

            } else if (allSlides.length <= _.options.slidesToShow) {

                allSlides
                    .addClass('slick-active')
                    .attr('aria-hidden', 'false');

            } else {

                remainder = _.slideCount % _.options.slidesToShow;
                indexOffset = _.options.infinite === true ? _.options.slidesToShow + index : index;

                if (_.options.slidesToShow == _.options.slidesToScroll && (_.slideCount - index) < _.options.slidesToShow) {

                    allSlides
                        .slice(indexOffset - (_.options.slidesToShow - remainder), indexOffset + remainder)
                        .addClass('slick-active')
                        .attr('aria-hidden', 'false');

                } else {

                    allSlides
                        .slice(indexOffset, indexOffset + _.options.slidesToShow)
                        .addClass('slick-active')
                        .attr('aria-hidden', 'false');

                }

            }

        }

        if (_.options.lazyLoad === 'ondemand') {
            _.lazyLoad();
        }

    };

    Slick.prototype.setupInfinite = function() {

        var _ = this,
            i, slideIndex, infiniteCount;

        if (_.options.fade === true) {
            _.options.centerMode = false;
        }

        if (_.options.infinite === true && _.options.fade === false) {

            slideIndex = null;

            if (_.slideCount > _.options.slidesToShow) {

                if (_.options.centerMode === true) {
                    infiniteCount = _.options.slidesToShow + 1;
                } else {
                    infiniteCount = _.options.slidesToShow;
                }

                for (i = _.slideCount; i > (_.slideCount -
                    infiniteCount); i -= 1) {
                    slideIndex = i - 1;
                    $(_.$slides[slideIndex]).clone(true).attr('id', '')
                        .attr('data-slick-index', slideIndex - _.slideCount)
                        .prependTo(_.$slideTrack).addClass('slick-cloned');
                }
                for (i = 0; i < infiniteCount; i += 1) {
                    slideIndex = i;
                    $(_.$slides[slideIndex]).clone(true).attr('id', '')
                        .attr('data-slick-index', slideIndex + _.slideCount)
                        .appendTo(_.$slideTrack).addClass('slick-cloned');
                }
                _.$slideTrack.find('.slick-cloned').find('[id]').each(function() {
                    $(this).attr('id', '');
                });

            }

        }

    };

    Slick.prototype.interrupt = function( toggle ) {

        var _ = this;

        if( !toggle ) {
            _.autoPlay();
        }
        _.interrupted = toggle;

    };

    Slick.prototype.selectHandler = function(event) {

        var _ = this;

        var targetElement =
            $(event.target).is('.slick-slide') ?
                $(event.target) :
                $(event.target).parents('.slick-slide');

        var index = parseInt(targetElement.attr('data-slick-index'));

        if (!index) index = 0;

        if (_.slideCount <= _.options.slidesToShow) {

            _.setSlideClasses(index);
            _.asNavFor(index);
            return;

        }

        _.slideHandler(index);

    };

    Slick.prototype.slideHandler = function(index, sync, dontAnimate) {

        var targetSlide, animSlide, oldSlide, slideLeft, targetLeft = null,
            _ = this, navTarget;

        sync = sync || false;

        if (_.animating === true && _.options.waitForAnimate === true) {
            return;
        }

        if (_.options.fade === true && _.currentSlide === index) {
            return;
        }

        if (_.slideCount <= _.options.slidesToShow) {
            return;
        }

        if (sync === false) {
            _.asNavFor(index);
        }

        targetSlide = index;
        targetLeft = _.getLeft(targetSlide);
        slideLeft = _.getLeft(_.currentSlide);

        _.currentLeft = _.swipeLeft === null ? slideLeft : _.swipeLeft;

        if (_.options.infinite === false && _.options.centerMode === false && (index < 0 || index > _.getDotCount() * _.options.slidesToScroll)) {
            if (_.options.fade === false) {
                targetSlide = _.currentSlide;
                if (dontAnimate !== true) {
                    _.animateSlide(slideLeft, function() {
                        _.postSlide(targetSlide);
                    });
                } else {
                    _.postSlide(targetSlide);
                }
            }
            return;
        } else if (_.options.infinite === false && _.options.centerMode === true && (index < 0 || index > (_.slideCount - _.options.slidesToScroll))) {
            if (_.options.fade === false) {
                targetSlide = _.currentSlide;
                if (dontAnimate !== true) {
                    _.animateSlide(slideLeft, function() {
                        _.postSlide(targetSlide);
                    });
                } else {
                    _.postSlide(targetSlide);
                }
            }
            return;
        }

        if ( _.options.autoplay ) {
            clearInterval(_.autoPlayTimer);
        }

        if (targetSlide < 0) {
            if (_.slideCount % _.options.slidesToScroll !== 0) {
                animSlide = _.slideCount - (_.slideCount % _.options.slidesToScroll);
            } else {
                animSlide = _.slideCount + targetSlide;
            }
        } else if (targetSlide >= _.slideCount) {
            if (_.slideCount % _.options.slidesToScroll !== 0) {
                animSlide = 0;
            } else {
                animSlide = targetSlide - _.slideCount;
            }
        } else {
            animSlide = targetSlide;
        }

        _.animating = true;

        _.$slider.trigger('beforeChange', [_, _.currentSlide, animSlide]);

        oldSlide = _.currentSlide;
        _.currentSlide = animSlide;

        _.setSlideClasses(_.currentSlide);

        if ( _.options.asNavFor ) {

            navTarget = _.getNavTarget();
            navTarget = navTarget.slick('getSlick');

            if ( navTarget.slideCount <= navTarget.options.slidesToShow ) {
                navTarget.setSlideClasses(_.currentSlide);
            }

        }

        _.updateDots();
        _.updateArrows();

        if (_.options.fade === true) {
            if (dontAnimate !== true) {

                _.fadeSlideOut(oldSlide);

                _.fadeSlide(animSlide, function() {
                    _.postSlide(animSlide);
                });

            } else {
                _.postSlide(animSlide);
            }
            _.animateHeight();
            return;
        }

        if (dontAnimate !== true) {
            _.animateSlide(targetLeft, function() {
                _.postSlide(animSlide);
            });
        } else {
            _.postSlide(animSlide);
        }

    };

    Slick.prototype.startLoad = function() {

        var _ = this;

        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {

            _.$prevArrow.hide();
            _.$nextArrow.hide();

        }

        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {

            _.$dots.hide();

        }

        _.$slider.addClass('slick-loading');

    };

    Slick.prototype.swipeDirection = function() {

        var xDist, yDist, r, swipeAngle, _ = this;

        xDist = _.touchObject.startX - _.touchObject.curX;
        yDist = _.touchObject.startY - _.touchObject.curY;
        r = Math.atan2(yDist, xDist);

        swipeAngle = Math.round(r * 180 / Math.PI);
        if (swipeAngle < 0) {
            swipeAngle = 360 - Math.abs(swipeAngle);
        }

        if ((swipeAngle <= 45) && (swipeAngle >= 0)) {
            return (_.options.rtl === false ? 'left' : 'right');
        }
        if ((swipeAngle <= 360) && (swipeAngle >= 315)) {
            return (_.options.rtl === false ? 'left' : 'right');
        }
        if ((swipeAngle >= 135) && (swipeAngle <= 225)) {
            return (_.options.rtl === false ? 'right' : 'left');
        }
        if (_.options.verticalSwiping === true) {
            if ((swipeAngle >= 35) && (swipeAngle <= 135)) {
                return 'down';
            } else {
                return 'up';
            }
        }

        return 'vertical';

    };

    Slick.prototype.swipeEnd = function(event) {

        var _ = this,
            slideCount,
            direction;

        _.dragging = false;
        _.swiping = false;

        if (_.scrolling) {
            _.scrolling = false;
            return false;
        }
        _.interrupted = false;
        _.shouldClick = ( _.touchObject.swipeLength > 10 ) ? false : true;

        if ( _.touchObject.curX === undefined ) {
            return false;
        }

        if ( _.touchObject.edgeHit === true ) {
            _.$slider.trigger('edge', [_, _.swipeDirection() ]);
        }

        if ( _.touchObject.swipeLength >= _.touchObject.minSwipe ) {

            direction = _.swipeDirection();

            switch ( direction ) {

                case 'left':
                case 'down':

                    slideCount =
                        _.options.swipeToSlide ?
                            _.checkNavigable( _.currentSlide + _.getSlideCount() ) :
                            _.currentSlide + _.getSlideCount();

                    _.currentDirection = 0;

                    break;

                case 'right':
                case 'up':

                    slideCount =
                        _.options.swipeToSlide ?
                            _.checkNavigable( _.currentSlide - _.getSlideCount() ) :
                            _.currentSlide - _.getSlideCount();

                    _.currentDirection = 1;

                    break;

                default:


            }

            if( direction != 'vertical' ) {

                _.slideHandler( slideCount );
                _.touchObject = {};
                _.$slider.trigger('swipe', [_, direction ]);

            }

        } else {

            if ( _.touchObject.startX !== _.touchObject.curX ) {

                _.slideHandler( _.currentSlide );
                _.touchObject = {};

            }

        }

    };

    Slick.prototype.swipeHandler = function(event) {

        var _ = this;

        if ((_.options.swipe === false) || ('ontouchend' in document && _.options.swipe === false)) {
            return;
        } else if (_.options.draggable === false && event.type.indexOf('mouse') !== -1) {
            return;
        }

        _.touchObject.fingerCount = event.originalEvent && event.originalEvent.touches !== undefined ?
            event.originalEvent.touches.length : 1;

        _.touchObject.minSwipe = _.listWidth / _.options
            .touchThreshold;

        if (_.options.verticalSwiping === true) {
            _.touchObject.minSwipe = _.listHeight / _.options
                .touchThreshold;
        }

        switch (event.data.action) {

            case 'start':
                _.swipeStart(event);
                break;

            case 'move':
                _.swipeMove(event);
                break;

            case 'end':
                _.swipeEnd(event);
                break;

        }

    };

    Slick.prototype.swipeMove = function(event) {

        var _ = this,
            edgeWasHit = false,
            curLeft, swipeDirection, swipeLength, positionOffset, touches, verticalSwipeLength;

        touches = event.originalEvent !== undefined ? event.originalEvent.touches : null;

        if (!_.dragging || _.scrolling || touches && touches.length !== 1) {
            return false;
        }

        curLeft = _.getLeft(_.currentSlide);

        _.touchObject.curX = touches !== undefined ? touches[0].pageX : event.clientX;
        _.touchObject.curY = touches !== undefined ? touches[0].pageY : event.clientY;

        _.touchObject.swipeLength = Math.round(Math.sqrt(
            Math.pow(_.touchObject.curX - _.touchObject.startX, 2)));

        verticalSwipeLength = Math.round(Math.sqrt(
            Math.pow(_.touchObject.curY - _.touchObject.startY, 2)));

        if (!_.options.verticalSwiping && !_.swiping && verticalSwipeLength > 4) {
            _.scrolling = true;
            return false;
        }

        if (_.options.verticalSwiping === true) {
            _.touchObject.swipeLength = verticalSwipeLength;
        }

        swipeDirection = _.swipeDirection();

        if (event.originalEvent !== undefined && _.touchObject.swipeLength > 4) {
            _.swiping = true;
            event.preventDefault();
        }

        positionOffset = (_.options.rtl === false ? 1 : -1) * (_.touchObject.curX > _.touchObject.startX ? 1 : -1);
        if (_.options.verticalSwiping === true) {
            positionOffset = _.touchObject.curY > _.touchObject.startY ? 1 : -1;
        }


        swipeLength = _.touchObject.swipeLength;

        _.touchObject.edgeHit = false;

        if (_.options.infinite === false) {
            if ((_.currentSlide === 0 && swipeDirection === 'right') || (_.currentSlide >= _.getDotCount() && swipeDirection === 'left')) {
                swipeLength = _.touchObject.swipeLength * _.options.edgeFriction;
                _.touchObject.edgeHit = true;
            }
        }

        if (_.options.vertical === false) {
            _.swipeLeft = curLeft + swipeLength * positionOffset;
        } else {
            _.swipeLeft = curLeft + (swipeLength * (_.$list.height() / _.listWidth)) * positionOffset;
        }
        if (_.options.verticalSwiping === true) {
            _.swipeLeft = curLeft + swipeLength * positionOffset;
        }

        if (_.options.fade === true || _.options.touchMove === false) {
            return false;
        }

        if (_.animating === true) {
            _.swipeLeft = null;
            return false;
        }

        _.setCSS(_.swipeLeft);

    };

    Slick.prototype.swipeStart = function(event) {

        var _ = this,
            touches;

        _.interrupted = true;

        if (_.touchObject.fingerCount !== 1 || _.slideCount <= _.options.slidesToShow) {
            _.touchObject = {};
            return false;
        }

        if (event.originalEvent !== undefined && event.originalEvent.touches !== undefined) {
            touches = event.originalEvent.touches[0];
        }

        _.touchObject.startX = _.touchObject.curX = touches !== undefined ? touches.pageX : event.clientX;
        _.touchObject.startY = _.touchObject.curY = touches !== undefined ? touches.pageY : event.clientY;

        _.dragging = true;

    };

    Slick.prototype.unfilterSlides = Slick.prototype.slickUnfilter = function() {

        var _ = this;

        if (_.$slidesCache !== null) {

            _.unload();

            _.$slideTrack.children(this.options.slide).detach();

            _.$slidesCache.appendTo(_.$slideTrack);

            _.reinit();

        }

    };

    Slick.prototype.unload = function() {

        var _ = this;

        $('.slick-cloned', _.$slider).remove();

        if (_.$dots) {
            _.$dots.remove();
        }

        if (_.$prevArrow && _.htmlExpr.test(_.options.prevArrow)) {
            _.$prevArrow.remove();
        }

        if (_.$nextArrow && _.htmlExpr.test(_.options.nextArrow)) {
            _.$nextArrow.remove();
        }

        _.$slides
            .removeClass('slick-slide slick-active slick-visible slick-current')
            .attr('aria-hidden', 'true')
            .css('width', '');

    };

    Slick.prototype.unslick = function(fromBreakpoint) {

        var _ = this;
        _.$slider.trigger('unslick', [_, fromBreakpoint]);
        _.destroy();

    };

    Slick.prototype.updateArrows = function() {

        var _ = this,
            centerOffset;

        centerOffset = Math.floor(_.options.slidesToShow / 2);

        if ( _.options.arrows === true &&
            _.slideCount > _.options.slidesToShow &&
            !_.options.infinite ) {

            _.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');
            _.$nextArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');

            if (_.currentSlide === 0) {

                _.$prevArrow.addClass('slick-disabled').attr('aria-disabled', 'true');
                _.$nextArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');

            } else if (_.currentSlide >= _.slideCount - _.options.slidesToShow && _.options.centerMode === false) {

                _.$nextArrow.addClass('slick-disabled').attr('aria-disabled', 'true');
                _.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');

            } else if (_.currentSlide >= _.slideCount - 1 && _.options.centerMode === true) {

                _.$nextArrow.addClass('slick-disabled').attr('aria-disabled', 'true');
                _.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');

            }

        }
        if ( _.options.arrows === true &&
            _.slideCount > _.options.slidesToShow &&
            !_.options.infinite && _.options.outerEdgeLimit){

            var lastSlide = _.$slides.last();
            var lastSlideOffsetRight = ($(window).width() - (lastSlide.offset().left + lastSlide.outerWidth()));
            var sliderOffsetRight = ($(window).width() - (_.$slider.offset().left + _.$slider.outerWidth()));
            var lastSlideOffsetSlider = lastSlideOffsetRight - sliderOffsetRight;

            if(lastSlideOffsetSlider > -1) {
                _.$nextArrow.addClass('slick-disabled').attr('aria-disabled', 'true');
            }
            else {
                _.$nextArrow.removeClass('slick-disabled').attr('aria-disabled', 'true');
            }
        }

    };

    Slick.prototype.updateDots = function() {

        var _ = this;

        if (_.$dots !== null) {

            _.$dots
                .find('li')
                .removeClass('slick-active')
                .attr('aria-hidden', 'true');

            _.$dots
                .find('li')
                .eq(Math.floor(_.currentSlide / _.options.slidesToScroll))
                .addClass('slick-active')
                .attr('aria-hidden', 'false');

        }

    };

    Slick.prototype.visibility = function() {

        var _ = this;

        if ( _.options.autoplay ) {

            if ( document[_.hidden] ) {

                _.interrupted = true;

            } else {

                _.interrupted = false;

            }

        }

    };

    $.fn.slick = function() {
        var _ = this,
            opt = arguments[0],
            args = Array.prototype.slice.call(arguments, 1),
            l = _.length,
            i,
            ret;
        for (i = 0; i < l; i++) {
            if (typeof opt == 'object' || typeof opt == 'undefined')
                _[i].slick = new Slick(_[i], opt);
            else
                ret = _[i].slick[opt].apply(_[i].slick, args);
            if (typeof ret != 'undefined') return ret;
        }
        return _;
    };

}));

var CustomDataLayer = function(){
    if (!window.digitalData) {
        window.digitalData = {};
    }
};

CustomDataLayer.prototype.setMultipleDownloadFile = function (filename, remove) {
    var files = (window.digitalData.multipleDownloadFiles || '').split(',');
    var updatedFiles = [];

    files.forEach(function (file) {
        if (file && filename !== file) {
            updatedFiles.push(file);
        }
    });

    if (!remove) {
        updatedFiles.push(filename);
    }

    window.digitalData.multipleDownloadFiles = updatedFiles.join(',');
};

window.STFED = STFED || {};
window.STFED.CustomDataLayer = new CustomDataLayer();

/*! jQuery UI - v1.12.1 - 2018-07-12
* http://jqueryui.com
* Includes: widget.js, position.js, data.js, keycode.js, scroll-parent.js, unique-id.js, widgets/sortable.js, widgets/autocomplete.js, widgets/datepicker.js, widgets/menu.js, widgets/mouse.js, widgets/slider.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */

(function (factory) {
	if (typeof define === "function" && define.amd) {

		// AMD. Register as an anonymous module.
		define(["jquery"], factory);
	} else {

		// Browser globals
		factory(jQuery);
	}
}(function ($) {

	$.ui = $.ui || {};

	var version = $.ui.version = "1.12.1";


	/*!
 * jQuery UI Widget 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Widget
//>>group: Core
//>>description: Provides a factory for creating stateful widgets with a common API.
//>>docs: http://api.jqueryui.com/jQuery.widget/
//>>demos: http://jqueryui.com/widget/


	var widgetUuid = 0;
	var widgetSlice = Array.prototype.slice;

	$.cleanData = (function (orig) {
		return function (elems) {
			var events, elem, i;
			for (i = 0; (elem = elems[i]) != null; i++) {
				try {

					// Only trigger remove when necessary to save time
					events = $._data(elem, "events");
					if (events && events.remove) {
						$(elem).triggerHandler("remove");
					}

					// Http://bugs.jquery.com/ticket/8235
				} catch (e) {
				}
			}
			orig(elems);
		};
	})($.cleanData);

	$.widget = function (name, base, prototype) {
		var existingConstructor, constructor, basePrototype;

		// ProxiedPrototype allows the provided prototype to remain unmodified
		// so that it can be used as a mixin for multiple widgets (#8876)
		var proxiedPrototype = {};

		var namespace = name.split(".")[0];
		name = name.split(".")[1];
		var fullName = namespace + "-" + name;

		if (!prototype) {
			prototype = base;
			base = $.Widget;
		}

		if ($.isArray(prototype)) {
			prototype = $.extend.apply(null, [{}].concat(prototype));
		}

		// Create selector for plugin
		$.expr[":"][fullName.toLowerCase()] = function (elem) {
			return !!$.data(elem, fullName);
		};

		$[namespace] = $[namespace] || {};
		existingConstructor = $[namespace][name];
		constructor = $[namespace][name] = function (options, element) {

			// Allow instantiation without "new" keyword
			if (!this._createWidget) {
				return new constructor(options, element);
			}

			// Allow instantiation without initializing for simple inheritance
			// must use "new" keyword (the code above always passes args)
			if (arguments.length) {
				this._createWidget(options, element);
			}
		};

		// Extend with the existing constructor to carry over any static properties
		$.extend(constructor, existingConstructor, {
			version: prototype.version,

			// Copy the object used to create the prototype in case we need to
			// redefine the widget later
			_proto: $.extend({}, prototype),

			// Track widgets that inherit from this widget in case this widget is
			// redefined after a widget inherits from it
			_childConstructors: []
		});

		basePrototype = new base();

		// We need to make the options hash a property directly on the new instance
		// otherwise we'll modify the options hash on the prototype that we're
		// inheriting from
		basePrototype.options = $.widget.extend({}, basePrototype.options);
		$.each(prototype, function (prop, value) {
			if (!$.isFunction(value)) {
				proxiedPrototype[prop] = value;
				return;
			}
			proxiedPrototype[prop] = (function () {
				function _super() {
					return base.prototype[prop].apply(this, arguments);
				}

				function _superApply(args) {
					return base.prototype[prop].apply(this, args);
				}

				return function () {
					var __super = this._super;
					var __superApply = this._superApply;
					var returnValue;

					this._super = _super;
					this._superApply = _superApply;

					returnValue = value.apply(this, arguments);

					this._super = __super;
					this._superApply = __superApply;

					return returnValue;
				};
			})();
		});
		constructor.prototype = $.widget.extend(basePrototype, {

			// TODO: remove support for widgetEventPrefix
			// always use the name + a colon as the prefix, e.g., draggable:start
			// don't prefix for widgets that aren't DOM-based
			widgetEventPrefix: existingConstructor ? (basePrototype.widgetEventPrefix || name) : name
		}, proxiedPrototype, {
			constructor: constructor,
			namespace: namespace,
			widgetName: name,
			widgetFullName: fullName
		});

		// If this widget is being redefined then we need to find all widgets that
		// are inheriting from it and redefine all of them so that they inherit from
		// the new version of this widget. We're essentially trying to replace one
		// level in the prototype chain.
		if (existingConstructor) {
			$.each(existingConstructor._childConstructors, function (i, child) {
				var childPrototype = child.prototype;

				// Redefine the child widget using the same prototype that was
				// originally used, but inherit from the new version of the base
				$.widget(childPrototype.namespace + "." + childPrototype.widgetName, constructor,
					child._proto);
			});

			// Remove the list of existing child constructors from the old constructor
			// so the old child constructors can be garbage collected
			delete existingConstructor._childConstructors;
		} else {
			base._childConstructors.push(constructor);
		}

		$.widget.bridge(name, constructor);

		return constructor;
	};

	$.widget.extend = function (target) {
		var input = widgetSlice.call(arguments, 1);
		var inputIndex = 0;
		var inputLength = input.length;
		var key;
		var value;

		for (; inputIndex < inputLength; inputIndex++) {
			for (key in input[inputIndex]) {
				value = input[inputIndex][key];
				if (input[inputIndex].hasOwnProperty(key) && value !== undefined) {

					// Clone objects
					if ($.isPlainObject(value)) {
						target[key] = $.isPlainObject(target[key]) ?
							$.widget.extend({}, target[key], value) :

							// Don't extend strings, arrays, etc. with objects
							$.widget.extend({}, value);

						// Copy everything else by reference
					} else {
						target[key] = value;
					}
				}
			}
		}
		return target;
	};

	$.widget.bridge = function (name, object) {
		var fullName = object.prototype.widgetFullName || name;
		$.fn[name] = function (options) {
			var isMethodCall = typeof options === "string";
			var args = widgetSlice.call(arguments, 1);
			var returnValue = this;

			if (isMethodCall) {

				// If this is an empty collection, we need to have the instance method
				// return undefined instead of the jQuery instance
				if (!this.length && options === "instance") {
					returnValue = undefined;
				} else {
					this.each(function () {
						var methodValue;
						var instance = $.data(this, fullName);

						if (options === "instance") {
							returnValue = instance;
							return false;
						}

						if (!instance) {
							return $.error("cannot call methods on " + name +
								" prior to initialization; " +
								"attempted to call method '" + options + "'");
						}

						if (!$.isFunction(instance[options]) || options.charAt(0) === "_") {
							return $.error("no such method '" + options + "' for " + name +
								" widget instance");
						}

						methodValue = instance[options].apply(instance, args);

						if (methodValue !== instance && methodValue !== undefined) {
							returnValue = methodValue && methodValue.jquery ?
								returnValue.pushStack(methodValue.get()) :
								methodValue;
							return false;
						}
					});
				}
			} else {

				// Allow multiple hashes to be passed on init
				if (args.length) {
					options = $.widget.extend.apply(null, [options].concat(args));
				}

				this.each(function () {
					var instance = $.data(this, fullName);
					if (instance) {
						instance.option(options || {});
						if (instance._init) {
							instance._init();
						}
					} else {
						$.data(this, fullName, new object(options, this));
					}
				});
			}

			return returnValue;
		};
	};

	$.Widget = function (/* options, element */) {
	};
	$.Widget._childConstructors = [];

	$.Widget.prototype = {
		widgetName: "widget",
		widgetEventPrefix: "",
		defaultElement: "<div>",

		options: {
			classes: {},
			disabled: false,

			// Callbacks
			create: null
		},

		_createWidget: function (options, element) {
			element = $(element || this.defaultElement || this)[0];
			this.element = $(element);
			this.uuid = widgetUuid++;
			this.eventNamespace = "." + this.widgetName + this.uuid;

			this.bindings = $();
			this.hoverable = $();
			this.focusable = $();
			this.classesElementLookup = {};

			if (element !== this) {
				$.data(element, this.widgetFullName, this);
				this._on(true, this.element, {
					remove: function (event) {
						if (event.target === element) {
							this.destroy();
						}
					}
				});
				this.document = $(element.style ?

					// Element within the document
					element.ownerDocument :

					// Element is window or document
					element.document || element);
				this.window = $(this.document[0].defaultView || this.document[0].parentWindow);
			}

			this.options = $.widget.extend({},
				this.options,
				this._getCreateOptions(),
				options);

			this._create();

			if (this.options.disabled) {
				this._setOptionDisabled(this.options.disabled);
			}

			this._trigger("create", null, this._getCreateEventData());
			this._init();
		},

		_getCreateOptions: function () {
			return {};
		},

		_getCreateEventData: $.noop,

		_create: $.noop,

		_init: $.noop,

		destroy: function () {
			var that = this;

			this._destroy();
			$.each(this.classesElementLookup, function (key, value) {
				that._removeClass(value, key);
			});

			// We can probably remove the unbind calls in 2.0
			// all event bindings should go through this._on()
			this.element
				.off(this.eventNamespace)
				.removeData(this.widgetFullName);
			this.widget()
				.off(this.eventNamespace)
				.removeAttr("aria-disabled");

			// Clean up events and states
			this.bindings.off(this.eventNamespace);
		},

		_destroy: $.noop,

		widget: function () {
			return this.element;
		},

		option: function (key, value) {
			var options = key;
			var parts;
			var curOption;
			var i;

			if (arguments.length === 0) {

				// Don't return a reference to the internal hash
				return $.widget.extend({}, this.options);
			}

			if (typeof key === "string") {

				// Handle nested keys, e.g., "foo.bar" => { foo: { bar: ___ } }
				options = {};
				parts = key.split(".");
				key = parts.shift();
				if (parts.length) {
					curOption = options[key] = $.widget.extend({}, this.options[key]);
					for (i = 0; i < parts.length - 1; i++) {
						curOption[parts[i]] = curOption[parts[i]] || {};
						curOption = curOption[parts[i]];
					}
					key = parts.pop();
					if (arguments.length === 1) {
						return curOption[key] === undefined ? null : curOption[key];
					}
					curOption[key] = value;
				} else {
					if (arguments.length === 1) {
						return this.options[key] === undefined ? null : this.options[key];
					}
					options[key] = value;
				}
			}

			this._setOptions(options);

			return this;
		},

		_setOptions: function (options) {
			var key;

			for (key in options) {
				this._setOption(key, options[key]);
			}

			return this;
		},

		_setOption: function (key, value) {
			if (key === "classes") {
				this._setOptionClasses(value);
			}

			this.options[key] = value;

			if (key === "disabled") {
				this._setOptionDisabled(value);
			}

			return this;
		},

		_setOptionClasses: function (value) {
			var classKey, elements, currentElements;

			for (classKey in value) {
				currentElements = this.classesElementLookup[classKey];
				if (value[classKey] === this.options.classes[classKey] ||
					!currentElements ||
					!currentElements.length) {
					continue;
				}

				// We are doing this to create a new jQuery object because the _removeClass() call
				// on the next line is going to destroy the reference to the current elements being
				// tracked. We need to save a copy of this collection so that we can add the new classes
				// below.
				elements = $(currentElements.get());
				this._removeClass(currentElements, classKey);

				// We don't use _addClass() here, because that uses this.options.classes
				// for generating the string of classes. We want to use the value passed in from
				// _setOption(), this is the new value of the classes option which was passed to
				// _setOption(). We pass this value directly to _classes().
				elements.addClass(this._classes({
					element: elements,
					keys: classKey,
					classes: value,
					add: true
				}));
			}
		},

		_setOptionDisabled: function (value) {
			this._toggleClass(this.widget(), this.widgetFullName + "-disabled", null, !!value);

			// If the widget is becoming disabled, then nothing is interactive
			if (value) {
				this._removeClass(this.hoverable, null, "ui-state-hover");
				this._removeClass(this.focusable, null, "ui-state-focus");
			}
		},

		enable: function () {
			return this._setOptions({disabled: false});
		},

		disable: function () {
			return this._setOptions({disabled: true});
		},

		_classes: function (options) {
			var full = [];
			var that = this;

			options = $.extend({
				element: this.element,
				classes: this.options.classes || {}
			}, options);

			function processClassString(classes, checkOption) {
				var current, i;
				for (i = 0; i < classes.length; i++) {
					current = that.classesElementLookup[classes[i]] || $();
					if (options.add) {
						current = $($.unique(current.get().concat(options.element.get())));
					} else {
						current = $(current.not(options.element).get());
					}
					that.classesElementLookup[classes[i]] = current;
					full.push(classes[i]);
					if (checkOption && options.classes[classes[i]]) {
						full.push(options.classes[classes[i]]);
					}
				}
			}

			this._on(options.element, {
				"remove": "_untrackClassesElement"
			});

			if (options.keys) {
				processClassString(options.keys.match(/\S+/g) || [], true);
			}
			if (options.extra) {
				processClassString(options.extra.match(/\S+/g) || []);
			}

			return full.join(" ");
		},

		_untrackClassesElement: function (event) {
			var that = this;
			$.each(that.classesElementLookup, function (key, value) {
				if ($.inArray(event.target, value) !== -1) {
					that.classesElementLookup[key] = $(value.not(event.target).get());
				}
			});
		},

		_removeClass: function (element, keys, extra) {
			return this._toggleClass(element, keys, extra, false);
		},

		_addClass: function (element, keys, extra) {
			return this._toggleClass(element, keys, extra, true);
		},

		_toggleClass: function (element, keys, extra, add) {
			add = (typeof add === "boolean") ? add : extra;
			var shift = (typeof element === "string" || element === null),
				options = {
					extra: shift ? keys : extra,
					keys: shift ? element : keys,
					element: shift ? this.element : element,
					add: add
				};
			options.element.toggleClass(this._classes(options), add);
			return this;
		},

		_on: function (suppressDisabledCheck, element, handlers) {
			var delegateElement;
			var instance = this;

			// No suppressDisabledCheck flag, shuffle arguments
			if (typeof suppressDisabledCheck !== "boolean") {
				handlers = element;
				element = suppressDisabledCheck;
				suppressDisabledCheck = false;
			}

			// No element argument, shuffle and use this.element
			if (!handlers) {
				handlers = element;
				element = this.element;
				delegateElement = this.widget();
			} else {
				element = delegateElement = $(element);
				this.bindings = this.bindings.add(element);
			}

			$.each(handlers, function (event, handler) {
				function handlerProxy() {

					// Allow widgets to customize the disabled handling
					// - disabled as an array instead of boolean
					// - disabled class as method for disabling individual parts
					if (!suppressDisabledCheck &&
						(instance.options.disabled === true ||
							$(this).hasClass("ui-state-disabled"))) {
						return;
					}
					return (typeof handler === "string" ? instance[handler] : handler)
						.apply(instance, arguments);
				}

				// Copy the guid so direct unbinding works
				if (typeof handler !== "string") {
					handlerProxy.guid = handler.guid =
						handler.guid || handlerProxy.guid || $.guid++;
				}

				var match = event.match(/^([\w:-]*)\s*(.*)$/);
				var eventName = match[1] + instance.eventNamespace;
				var selector = match[2];

				if (selector) {
					delegateElement.on(eventName, selector, handlerProxy);
				} else {
					element.on(eventName, handlerProxy);
				}
			});
		},

		_off: function (element, eventName) {
			eventName = (eventName || "").split(" ").join(this.eventNamespace + " ") +
				this.eventNamespace;
			element.off(eventName).off(eventName);

			// Clear the stack to avoid memory leaks (#10056)
			this.bindings = $(this.bindings.not(element).get());
			this.focusable = $(this.focusable.not(element).get());
			this.hoverable = $(this.hoverable.not(element).get());
		},

		_delay: function (handler, delay) {
			function handlerProxy() {
				return (typeof handler === "string" ? instance[handler] : handler)
					.apply(instance, arguments);
			}

			var instance = this;
			return setTimeout(handlerProxy, delay || 0);
		},

		_hoverable: function (element) {
			this.hoverable = this.hoverable.add(element);
			this._on(element, {
				mouseenter: function (event) {
					this._addClass($(event.currentTarget), null, "ui-state-hover");
				},
				mouseleave: function (event) {
					this._removeClass($(event.currentTarget), null, "ui-state-hover");
				}
			});
		},

		_focusable: function (element) {
			this.focusable = this.focusable.add(element);
			this._on(element, {
				focusin: function (event) {
					this._addClass($(event.currentTarget), null, "ui-state-focus");
				},
				focusout: function (event) {
					this._removeClass($(event.currentTarget), null, "ui-state-focus");
				}
			});
		},

		_trigger: function (type, event, data) {
			var prop, orig;
			var callback = this.options[type];

			data = data || {};
			event = $.Event(event);
			event.type = (type === this.widgetEventPrefix ?
				type :
				this.widgetEventPrefix + type).toLowerCase();

			// The original event may come from any element
			// so we need to reset the target on the new event
			event.target = this.element[0];

			// Copy original event properties over to the new event
			orig = event.originalEvent;
			if (orig) {
				for (prop in orig) {
					if (!(prop in event)) {
						event[prop] = orig[prop];
					}
				}
			}

			this.element.trigger(event, data);
			return !($.isFunction(callback) &&
				callback.apply(this.element[0], [event].concat(data)) === false ||
				event.isDefaultPrevented());
		}
	};

	$.each({show: "fadeIn", hide: "fadeOut"}, function (method, defaultEffect) {
		$.Widget.prototype["_" + method] = function (element, options, callback) {
			if (typeof options === "string") {
				options = {effect: options};
			}

			var hasOptions;
			var effectName = !options ?
				method :
				options === true || typeof options === "number" ?
					defaultEffect :
					options.effect || defaultEffect;

			options = options || {};
			if (typeof options === "number") {
				options = {duration: options};
			}

			hasOptions = !$.isEmptyObject(options);
			options.complete = callback;

			if (options.delay) {
				element.delay(options.delay);
			}

			if (hasOptions && $.effects && $.effects.effect[effectName]) {
				element[method](options);
			} else if (effectName !== method && element[effectName]) {
				element[effectName](options.duration, options.easing, callback);
			} else {
				element.queue(function (next) {
					$(this)[method]();
					if (callback) {
						callback.call(element[0]);
					}
					next();
				});
			}
		};
	});

	var widget = $.widget;


	/*!
 * jQuery UI Position 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/position/
 */

//>>label: Position
//>>group: Core
//>>description: Positions elements relative to other elements.
//>>docs: http://api.jqueryui.com/position/
//>>demos: http://jqueryui.com/position/


	(function () {
		var cachedScrollbarWidth,
			max = Math.max,
			abs = Math.abs,
			rhorizontal = /left|center|right/,
			rvertical = /top|center|bottom/,
			roffset = /[\+\-]\d+(\.[\d]+)?%?/,
			rposition = /^\w+/,
			rpercent = /%$/,
			_position = $.fn.position;

		function getOffsets(offsets, width, height) {
			return [
				parseFloat(offsets[0]) * (rpercent.test(offsets[0]) ? width / 100 : 1),
				parseFloat(offsets[1]) * (rpercent.test(offsets[1]) ? height / 100 : 1)
			];
		}

		function parseCss(element, property) {
			return parseInt($.css(element, property), 10) || 0;
		}

		function getDimensions(elem) {
			var raw = elem[0];
			if (raw.nodeType === 9) {
				return {
					width: elem.width(),
					height: elem.height(),
					offset: {top: 0, left: 0}
				};
			}
			if ($.isWindow(raw)) {
				return {
					width: elem.width(),
					height: elem.height(),
					offset: {top: elem.scrollTop(), left: elem.scrollLeft()}
				};
			}
			if (raw.preventDefault) {
				return {
					width: 0,
					height: 0,
					offset: {top: raw.pageY, left: raw.pageX}
				};
			}
			return {
				width: elem.outerWidth(),
				height: elem.outerHeight(),
				offset: elem.offset()
			};
		}

		$.position = {
			scrollbarWidth: function () {
				if (cachedScrollbarWidth !== undefined) {
					return cachedScrollbarWidth;
				}
				var w1, w2,
					div = $("<div " +
						"style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'>" +
						"<div style='height:100px;width:auto;'></div></div>"),
					innerDiv = div.children()[0];

				$("body").append(div);
				w1 = innerDiv.offsetWidth;
				div.css("overflow", "scroll");

				w2 = innerDiv.offsetWidth;

				if (w1 === w2) {
					w2 = div[0].clientWidth;
				}

				div.remove();

				return (cachedScrollbarWidth = w1 - w2);
			},
			getScrollInfo: function (within) {
				var overflowX = within.isWindow || within.isDocument ? "" :
					within.element.css("overflow-x"),
					overflowY = within.isWindow || within.isDocument ? "" :
						within.element.css("overflow-y"),
					hasOverflowX = overflowX === "scroll" ||
						(overflowX === "auto" && within.width < within.element[0].scrollWidth),
					hasOverflowY = overflowY === "scroll" ||
						(overflowY === "auto" && within.height < within.element[0].scrollHeight);
				return {
					width: hasOverflowY ? $.position.scrollbarWidth() : 0,
					height: hasOverflowX ? $.position.scrollbarWidth() : 0
				};
			},
			getWithinInfo: function (element) {
				var withinElement = $(element || window),
					isWindow = $.isWindow(withinElement[0]),
					isDocument = !!withinElement[0] && withinElement[0].nodeType === 9,
					hasOffset = !isWindow && !isDocument;
				return {
					element: withinElement,
					isWindow: isWindow,
					isDocument: isDocument,
					offset: hasOffset ? $(element).offset() : {left: 0, top: 0},
					scrollLeft: withinElement.scrollLeft(),
					scrollTop: withinElement.scrollTop(),
					width: withinElement.outerWidth(),
					height: withinElement.outerHeight()
				};
			}
		};

		$.fn.position = function (options) {
			if (!options || !options.of) {
				return _position.apply(this, arguments);
			}

			// Make a copy, we don't want to modify arguments
			options = $.extend({}, options);

			var atOffset, targetWidth, targetHeight, targetOffset, basePosition, dimensions,
				target = $(options.of),
				within = $.position.getWithinInfo(options.within),
				scrollInfo = $.position.getScrollInfo(within),
				collision = (options.collision || "flip").split(" "),
				offsets = {};

			dimensions = getDimensions(target);
			if (target[0].preventDefault) {

				// Force left top to allow flipping
				options.at = "left top";
			}
			targetWidth = dimensions.width;
			targetHeight = dimensions.height;
			targetOffset = dimensions.offset;

			// Clone to reuse original targetOffset later
			basePosition = $.extend({}, targetOffset);

			// Force my and at to have valid horizontal and vertical positions
			// if a value is missing or invalid, it will be converted to center
			$.each(["my", "at"], function () {
				var pos = (options[this] || "").split(" "),
					horizontalOffset,
					verticalOffset;

				if (pos.length === 1) {
					pos = rhorizontal.test(pos[0]) ?
						pos.concat(["center"]) :
						rvertical.test(pos[0]) ?
							["center"].concat(pos) :
							["center", "center"];
				}
				pos[0] = rhorizontal.test(pos[0]) ? pos[0] : "center";
				pos[1] = rvertical.test(pos[1]) ? pos[1] : "center";

				// Calculate offsets
				horizontalOffset = roffset.exec(pos[0]);
				verticalOffset = roffset.exec(pos[1]);
				offsets[this] = [
					horizontalOffset ? horizontalOffset[0] : 0,
					verticalOffset ? verticalOffset[0] : 0
				];

				// Reduce to just the positions without the offsets
				options[this] = [
					rposition.exec(pos[0])[0],
					rposition.exec(pos[1])[0]
				];
			});

			// Normalize collision option
			if (collision.length === 1) {
				collision[1] = collision[0];
			}

			if (options.at[0] === "right") {
				basePosition.left += targetWidth;
			} else if (options.at[0] === "center") {
				basePosition.left += targetWidth / 2;
			}

			if (options.at[1] === "bottom") {
				basePosition.top += targetHeight;
			} else if (options.at[1] === "center") {
				basePosition.top += targetHeight / 2;
			}

			atOffset = getOffsets(offsets.at, targetWidth, targetHeight);
			basePosition.left += atOffset[0];
			basePosition.top += atOffset[1];

			return this.each(function () {
				var collisionPosition, using,
					elem = $(this),
					elemWidth = elem.outerWidth(),
					elemHeight = elem.outerHeight(),
					marginLeft = parseCss(this, "marginLeft"),
					marginTop = parseCss(this, "marginTop"),
					collisionWidth = elemWidth + marginLeft + parseCss(this, "marginRight") +
						scrollInfo.width,
					collisionHeight = elemHeight + marginTop + parseCss(this, "marginBottom") +
						scrollInfo.height,
					position = $.extend({}, basePosition),
					myOffset = getOffsets(offsets.my, elem.outerWidth(), elem.outerHeight());

				if (options.my[0] === "right") {
					position.left -= elemWidth;
				} else if (options.my[0] === "center") {
					position.left -= elemWidth / 2;
				}

				if (options.my[1] === "bottom") {
					position.top -= elemHeight;
				} else if (options.my[1] === "center") {
					position.top -= elemHeight / 2;
				}

				position.left += myOffset[0];
				position.top += myOffset[1];

				collisionPosition = {
					marginLeft: marginLeft,
					marginTop: marginTop
				};

				$.each(["left", "top"], function (i, dir) {
					if ($.ui.position[collision[i]]) {
						$.ui.position[collision[i]][dir](position, {
							targetWidth: targetWidth,
							targetHeight: targetHeight,
							elemWidth: elemWidth,
							elemHeight: elemHeight,
							collisionPosition: collisionPosition,
							collisionWidth: collisionWidth,
							collisionHeight: collisionHeight,
							offset: [atOffset[0] + myOffset[0], atOffset [1] + myOffset[1]],
							my: options.my,
							at: options.at,
							within: within,
							elem: elem
						});
					}
				});

				if (options.using) {

					// Adds feedback as second argument to using callback, if present
					using = function (props) {
						var left = targetOffset.left - position.left,
							right = left + targetWidth - elemWidth,
							top = targetOffset.top - position.top,
							bottom = top + targetHeight - elemHeight,
							feedback = {
								target: {
									element: target,
									left: targetOffset.left,
									top: targetOffset.top,
									width: targetWidth,
									height: targetHeight
								},
								element: {
									element: elem,
									left: position.left,
									top: position.top,
									width: elemWidth,
									height: elemHeight
								},
								horizontal: right < 0 ? "left" : left > 0 ? "right" : "center",
								vertical: bottom < 0 ? "top" : top > 0 ? "bottom" : "middle"
							};
						if (targetWidth < elemWidth && abs(left + right) < targetWidth) {
							feedback.horizontal = "center";
						}
						if (targetHeight < elemHeight && abs(top + bottom) < targetHeight) {
							feedback.vertical = "middle";
						}
						if (max(abs(left), abs(right)) > max(abs(top), abs(bottom))) {
							feedback.important = "horizontal";
						} else {
							feedback.important = "vertical";
						}
						options.using.call(this, props, feedback);
					};
				}

				elem.offset($.extend(position, {using: using}));
			});
		};

		$.ui.position = {
			fit: {
				left: function (position, data) {
					var within = data.within,
						withinOffset = within.isWindow ? within.scrollLeft : within.offset.left,
						outerWidth = within.width,
						collisionPosLeft = position.left - data.collisionPosition.marginLeft,
						overLeft = withinOffset - collisionPosLeft,
						overRight = collisionPosLeft + data.collisionWidth - outerWidth - withinOffset,
						newOverRight;

					// Element is wider than within
					if (data.collisionWidth > outerWidth) {

						// Element is initially over the left side of within
						if (overLeft > 0 && overRight <= 0) {
							newOverRight = position.left + overLeft + data.collisionWidth - outerWidth -
								withinOffset;
							position.left += overLeft - newOverRight;

							// Element is initially over right side of within
						} else if (overRight > 0 && overLeft <= 0) {
							position.left = withinOffset;

							// Element is initially over both left and right sides of within
						} else {
							if (overLeft > overRight) {
								position.left = withinOffset + outerWidth - data.collisionWidth;
							} else {
								position.left = withinOffset;
							}
						}

						// Too far left -> align with left edge
					} else if (overLeft > 0) {
						position.left += overLeft;

						// Too far right -> align with right edge
					} else if (overRight > 0) {
						position.left -= overRight;

						// Adjust based on position and margin
					} else {
						position.left = max(position.left - collisionPosLeft, position.left);
					}
				},
				top: function (position, data) {
					var within = data.within,
						withinOffset = within.isWindow ? within.scrollTop : within.offset.top,
						outerHeight = data.within.height,
						collisionPosTop = position.top - data.collisionPosition.marginTop,
						overTop = withinOffset - collisionPosTop,
						overBottom = collisionPosTop + data.collisionHeight - outerHeight - withinOffset,
						newOverBottom;

					// Element is taller than within
					if (data.collisionHeight > outerHeight) {

						// Element is initially over the top of within
						if (overTop > 0 && overBottom <= 0) {
							newOverBottom = position.top + overTop + data.collisionHeight - outerHeight -
								withinOffset;
							position.top += overTop - newOverBottom;

							// Element is initially over bottom of within
						} else if (overBottom > 0 && overTop <= 0) {
							position.top = withinOffset;

							// Element is initially over both top and bottom of within
						} else {
							if (overTop > overBottom) {
								position.top = withinOffset + outerHeight - data.collisionHeight;
							} else {
								position.top = withinOffset;
							}
						}

						// Too far up -> align with top
					} else if (overTop > 0) {
						position.top += overTop;

						// Too far down -> align with bottom edge
					} else if (overBottom > 0) {
						position.top -= overBottom;

						// Adjust based on position and margin
					} else {
						position.top = max(position.top - collisionPosTop, position.top);
					}
				}
			},
			flip: {
				left: function (position, data) {
					var within = data.within,
						withinOffset = within.offset.left + within.scrollLeft,
						outerWidth = within.width,
						offsetLeft = within.isWindow ? within.scrollLeft : within.offset.left,
						collisionPosLeft = position.left - data.collisionPosition.marginLeft,
						overLeft = collisionPosLeft - offsetLeft,
						overRight = collisionPosLeft + data.collisionWidth - outerWidth - offsetLeft,
						myOffset = data.my[0] === "left" ?
							-data.elemWidth :
							data.my[0] === "right" ?
								data.elemWidth :
								0,
						atOffset = data.at[0] === "left" ?
							data.targetWidth :
							data.at[0] === "right" ?
								-data.targetWidth :
								0,
						offset = -2 * data.offset[0],
						newOverRight,
						newOverLeft;

					if (overLeft < 0) {
						newOverRight = position.left + myOffset + atOffset + offset + data.collisionWidth -
							outerWidth - withinOffset;
						if (newOverRight < 0 || newOverRight < abs(overLeft)) {
							position.left += myOffset + atOffset + offset;
						}
					} else if (overRight > 0) {
						newOverLeft = position.left - data.collisionPosition.marginLeft + myOffset +
							atOffset + offset - offsetLeft;
						if (newOverLeft > 0 || abs(newOverLeft) < overRight) {
							position.left += myOffset + atOffset + offset;
						}
					}
				},
				top: function (position, data) {
					var within = data.within,
						withinOffset = within.offset.top + within.scrollTop,
						outerHeight = within.height,
						offsetTop = within.isWindow ? within.scrollTop : within.offset.top,
						collisionPosTop = position.top - data.collisionPosition.marginTop,
						overTop = collisionPosTop - offsetTop,
						overBottom = collisionPosTop + data.collisionHeight - outerHeight - offsetTop,
						top = data.my[1] === "top",
						myOffset = top ?
							-data.elemHeight :
							data.my[1] === "bottom" ?
								data.elemHeight :
								0,
						atOffset = data.at[1] === "top" ?
							data.targetHeight :
							data.at[1] === "bottom" ?
								-data.targetHeight :
								0,
						offset = -2 * data.offset[1],
						newOverTop,
						newOverBottom;
					if (overTop < 0) {
						newOverBottom = position.top + myOffset + atOffset + offset + data.collisionHeight -
							outerHeight - withinOffset;
						if (newOverBottom < 0 || newOverBottom < abs(overTop)) {
							position.top += myOffset + atOffset + offset;
						}
					} else if (overBottom > 0) {
						newOverTop = position.top - data.collisionPosition.marginTop + myOffset + atOffset +
							offset - offsetTop;
						if (newOverTop > 0 || abs(newOverTop) < overBottom) {
							position.top += myOffset + atOffset + offset;
						}
					}
				}
			},
			flipfit: {
				left: function () {
					$.ui.position.flip.left.apply(this, arguments);
					$.ui.position.fit.left.apply(this, arguments);
				},
				top: function () {
					$.ui.position.flip.top.apply(this, arguments);
					$.ui.position.fit.top.apply(this, arguments);
				}
			}
		};

	})();

	var position = $.ui.position;


	/*!
 * jQuery UI :data 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: :data Selector
//>>group: Core
//>>description: Selects elements which have data stored under the specified key.
//>>docs: http://api.jqueryui.com/data-selector/


	var data = $.extend($.expr[":"], {
		data: $.expr.createPseudo ?
			$.expr.createPseudo(function (dataName) {
				return function (elem) {
					return !!$.data(elem, dataName);
				};
			}) :

			// Support: jQuery <1.8
			function (elem, i, match) {
				return !!$.data(elem, match[3]);
			}
	});

	/*!
 * jQuery UI Keycode 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Keycode
//>>group: Core
//>>description: Provide keycodes as keynames
//>>docs: http://api.jqueryui.com/jQuery.ui.keyCode/


	var keycode = $.ui.keyCode = {
		BACKSPACE: 8,
		COMMA: 188,
		DELETE: 46,
		DOWN: 40,
		END: 35,
		ENTER: 13,
		ESCAPE: 27,
		HOME: 36,
		LEFT: 37,
		PAGE_DOWN: 34,
		PAGE_UP: 33,
		PERIOD: 190,
		RIGHT: 39,
		SPACE: 32,
		TAB: 9,
		UP: 38
	};


	/*!
 * jQuery UI Scroll Parent 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: scrollParent
//>>group: Core
//>>description: Get the closest ancestor element that is scrollable.
//>>docs: http://api.jqueryui.com/scrollParent/


	var scrollParent = $.fn.scrollParent = function (includeHidden) {
		var position = this.css("position"),
			excludeStaticParent = position === "absolute",
			overflowRegex = includeHidden ? /(auto|scroll|hidden)/ : /(auto|scroll)/,
			scrollParent = this.parents().filter(function () {
				var parent = $(this);
				if (excludeStaticParent && parent.css("position") === "static") {
					return false;
				}
				return overflowRegex.test(parent.css("overflow") + parent.css("overflow-y") +
					parent.css("overflow-x"));
			}).eq(0);

		return position === "fixed" || !scrollParent.length ?
			$(this[0].ownerDocument || document) :
			scrollParent;
	};


	/*!
 * jQuery UI Unique ID 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: uniqueId
//>>group: Core
//>>description: Functions to generate and remove uniqueId's
//>>docs: http://api.jqueryui.com/uniqueId/


	var uniqueId = $.fn.extend({
		uniqueId: (function () {
			var uuid = 0;

			return function () {
				return this.each(function () {
					if (!this.id) {
						this.id = "ui-id-" + (++uuid);
					}
				});
			};
		})(),

		removeUniqueId: function () {
			return this.each(function () {
				if (/^ui-id-\d+$/.test(this.id)) {
					$(this).removeAttr("id");
				}
			});
		}
	});


// This file is deprecated
	var ie = $.ui.ie = !!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());

	/*!
 * jQuery UI Mouse 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Mouse
//>>group: Widgets
//>>description: Abstracts mouse-based interactions to assist in creating certain widgets.
//>>docs: http://api.jqueryui.com/mouse/


	var mouseHandled = false;
	$(document).on("mouseup", function () {
		mouseHandled = false;
	});

	var widgetsMouse = $.widget("ui.mouse", {
		version: "1.12.1",
		options: {
			cancel: "input, textarea, button, select, option",
			distance: 1,
			delay: 0
		},
		_mouseInit: function () {
			var that = this;

			this.element
				.on("mousedown." + this.widgetName, function (event) {
					return that._mouseDown(event);
				})
				.on("click." + this.widgetName, function (event) {
					if (true === $.data(event.target, that.widgetName + ".preventClickEvent")) {
						$.removeData(event.target, that.widgetName + ".preventClickEvent");
						event.stopImmediatePropagation();
						return false;
					}
				});

			this.started = false;
		},

		// TODO: make sure destroying one instance of mouse doesn't mess with
		// other instances of mouse
		_mouseDestroy: function () {
			this.element.off("." + this.widgetName);
			if (this._mouseMoveDelegate) {
				this.document
					.off("mousemove." + this.widgetName, this._mouseMoveDelegate)
					.off("mouseup." + this.widgetName, this._mouseUpDelegate);
			}
		},

		_mouseDown: function (event) {

			// don't let more than one widget handle mouseStart
			if (mouseHandled) {
				return;
			}

			this._mouseMoved = false;

			// We may have missed mouseup (out of window)
			(this._mouseStarted && this._mouseUp(event));

			this._mouseDownEvent = event;

			var that = this,
				btnIsLeft = (event.which === 1),

				// event.target.nodeName works around a bug in IE 8 with
				// disabled inputs (#7620)
				elIsCancel = (typeof this.options.cancel === "string" && event.target.nodeName ?
					$(event.target).closest(this.options.cancel).length : false);
			if (!btnIsLeft || elIsCancel || !this._mouseCapture(event)) {
				return true;
			}

			this.mouseDelayMet = !this.options.delay;
			if (!this.mouseDelayMet) {
				this._mouseDelayTimer = setTimeout(function () {
					that.mouseDelayMet = true;
				}, this.options.delay);
			}

			if (this._mouseDistanceMet(event) && this._mouseDelayMet(event)) {
				this._mouseStarted = (this._mouseStart(event) !== false);
				if (!this._mouseStarted) {
					event.preventDefault();
					return true;
				}
			}

			// Click event may never have fired (Gecko & Opera)
			if (true === $.data(event.target, this.widgetName + ".preventClickEvent")) {
				$.removeData(event.target, this.widgetName + ".preventClickEvent");
			}

			// These delegates are required to keep context
			this._mouseMoveDelegate = function (event) {
				return that._mouseMove(event);
			};
			this._mouseUpDelegate = function (event) {
				return that._mouseUp(event);
			};

			this.document
				.on("mousemove." + this.widgetName, this._mouseMoveDelegate)
				.on("mouseup." + this.widgetName, this._mouseUpDelegate);

			event.preventDefault();

			mouseHandled = true;
			return true;
		},

		_mouseMove: function (event) {

			// Only check for mouseups outside the document if you've moved inside the document
			// at least once. This prevents the firing of mouseup in the case of IE<9, which will
			// fire a mousemove event if content is placed under the cursor. See #7778
			// Support: IE <9
			if (this._mouseMoved) {

				// IE mouseup check - mouseup happened when mouse was out of window
				if ($.ui.ie && (!document.documentMode || document.documentMode < 9) &&
					!event.button) {
					return this._mouseUp(event);

					// Iframe mouseup check - mouseup occurred in another document
				} else if (!event.which) {

					// Support: Safari <=8 - 9
					// Safari sets which to 0 if you press any of the following keys
					// during a drag (#14461)
					if (event.originalEvent.altKey || event.originalEvent.ctrlKey ||
						event.originalEvent.metaKey || event.originalEvent.shiftKey) {
						this.ignoreMissingWhich = true;
					} else if (!this.ignoreMissingWhich) {
						return this._mouseUp(event);
					}
				}
			}

			if (event.which || event.button) {
				this._mouseMoved = true;
			}

			if (this._mouseStarted) {
				this._mouseDrag(event);
				return event.preventDefault();
			}

			if (this._mouseDistanceMet(event) && this._mouseDelayMet(event)) {
				this._mouseStarted =
					(this._mouseStart(this._mouseDownEvent, event) !== false);
				(this._mouseStarted ? this._mouseDrag(event) : this._mouseUp(event));
			}

			return !this._mouseStarted;
		},

		_mouseUp: function (event) {
			this.document
				.off("mousemove." + this.widgetName, this._mouseMoveDelegate)
				.off("mouseup." + this.widgetName, this._mouseUpDelegate);

			if (this._mouseStarted) {
				this._mouseStarted = false;

				if (event.target === this._mouseDownEvent.target) {
					$.data(event.target, this.widgetName + ".preventClickEvent", true);
				}

				this._mouseStop(event);
			}

			if (this._mouseDelayTimer) {
				clearTimeout(this._mouseDelayTimer);
				delete this._mouseDelayTimer;
			}

			this.ignoreMissingWhich = false;
			mouseHandled = false;
			event.preventDefault();
		},

		_mouseDistanceMet: function (event) {
			return (Math.max(
					Math.abs(this._mouseDownEvent.pageX - event.pageX),
					Math.abs(this._mouseDownEvent.pageY - event.pageY)
				) >= this.options.distance
			);
		},

		_mouseDelayMet: function (/* event */) {
			return this.mouseDelayMet;
		},

		// These are placeholder methods, to be overriden by extending plugin
		_mouseStart: function (/* event */) {
		},
		_mouseDrag: function (/* event */) {
		},
		_mouseStop: function (/* event */) {
		},
		_mouseCapture: function (/* event */) {
			return true;
		}
	});


	/*!
 * jQuery UI Sortable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Sortable
//>>group: Interactions
//>>description: Enables items in a list to be sorted using the mouse.
//>>docs: http://api.jqueryui.com/sortable/
//>>demos: http://jqueryui.com/sortable/
//>>css.structure: ../../themes/base/sortable.css


	var widgetsSortable = $.widget("ui.sortable", $.ui.mouse, {
		version: "1.12.1",
		widgetEventPrefix: "sort",
		ready: false,
		options: {
			appendTo: "parent",
			axis: false,
			connectWith: false,
			containment: false,
			cursor: "auto",
			cursorAt: false,
			dropOnEmpty: true,
			forcePlaceholderSize: false,
			forceHelperSize: false,
			grid: false,
			handle: false,
			helper: "original",
			items: "> *",
			opacity: false,
			placeholder: false,
			revert: false,
			scroll: true,
			scrollSensitivity: 20,
			scrollSpeed: 20,
			scope: "default",
			tolerance: "intersect",
			zIndex: 1000,

			// Callbacks
			activate: null,
			beforeStop: null,
			change: null,
			deactivate: null,
			out: null,
			over: null,
			receive: null,
			remove: null,
			sort: null,
			start: null,
			stop: null,
			update: null
		},

		_isOverAxis: function (x, reference, size) {
			return (x >= reference) && (x < (reference + size));
		},

		_isFloating: function (item) {
			return (/left|right/).test(item.css("float")) ||
				(/inline|table-cell/).test(item.css("display"));
		},

		_create: function () {
			this.containerCache = {};
			this._addClass("ui-sortable");

			//Get the items
			this.refresh();

			//Let's determine the parent's offset
			this.offset = this.element.offset();

			//Initialize mouse events for interaction
			this._mouseInit();

			this._setHandleClassName();

			//We're ready to go
			this.ready = true;

		},

		_setOption: function (key, value) {
			this._super(key, value);

			if (key === "handle") {
				this._setHandleClassName();
			}
		},

		_setHandleClassName: function () {
			var that = this;
			this._removeClass(this.element.find(".ui-sortable-handle"), "ui-sortable-handle");
			$.each(this.items, function () {
				that._addClass(
					this.instance.options.handle ?
						this.item.find(this.instance.options.handle) :
						this.item,
					"ui-sortable-handle"
				);
			});
		},

		_destroy: function () {
			this._mouseDestroy();

			for (var i = this.items.length - 1; i >= 0; i--) {
				this.items[i].item.removeData(this.widgetName + "-item");
			}

			return this;
		},

		_mouseCapture: function (event, overrideHandle) {
			var currentItem = null,
				validHandle = false,
				that = this;

			if (this.reverting) {
				return false;
			}

			if (this.options.disabled || this.options.type === "static") {
				return false;
			}

			//We have to refresh the items data once first
			this._refreshItems(event);

			//Find out if the clicked node (or one of its parents) is a actual item in this.items
			$(event.target).parents().each(function () {
				if ($.data(this, that.widgetName + "-item") === that) {
					currentItem = $(this);
					return false;
				}
			});
			if ($.data(event.target, that.widgetName + "-item") === that) {
				currentItem = $(event.target);
			}

			if (!currentItem) {
				return false;
			}
			if (this.options.handle && !overrideHandle) {
				$(this.options.handle, currentItem).find("*").addBack().each(function () {
					if (this === event.target) {
						validHandle = true;
					}
				});
				if (!validHandle) {
					return false;
				}
			}

			this.currentItem = currentItem;
			this._removeCurrentsFromItems();
			return true;

		},

		_mouseStart: function (event, overrideHandle, noActivation) {

			var i, body,
				o = this.options;

			this.currentContainer = this;

			//We only need to call refreshPositions, because the refreshItems call has been moved to
			// mouseCapture
			this.refreshPositions();

			//Create and append the visible helper
			this.helper = this._createHelper(event);

			//Cache the helper size
			this._cacheHelperProportions();

			/*
		 * - Position generation -
		 * This block generates everything position related - it's the core of draggables.
		 */

			//Cache the margins of the original element
			this._cacheMargins();

			//Get the next scrolling parent
			this.scrollParent = this.helper.scrollParent();

			//The element's absolute position on the page minus margins
			this.offset = this.currentItem.offset();
			this.offset = {
				top: this.offset.top - this.margins.top,
				left: this.offset.left - this.margins.left
			};

			$.extend(this.offset, {
				click: { //Where the click happened, relative to the element
					left: event.pageX - this.offset.left,
					top: event.pageY - this.offset.top
				},
				parent: this._getParentOffset(),

				// This is a relative to absolute position minus the actual position calculation -
				// only used for relative positioned helper
				relative: this._getRelativeOffset()
			});

			// Only after we got the offset, we can change the helper's position to absolute
			// TODO: Still need to figure out a way to make relative sorting possible
			this.helper.css("position", "absolute");
			this.cssPosition = this.helper.css("position");

			//Generate the original position
			this.originalPosition = this._generatePosition(event);
			this.originalPageX = event.pageX;
			this.originalPageY = event.pageY;

			//Adjust the mouse offset relative to the helper if "cursorAt" is supplied
			(o.cursorAt && this._adjustOffsetFromHelper(o.cursorAt));

			//Cache the former DOM position
			this.domPosition = {
				prev: this.currentItem.prev()[0],
				parent: this.currentItem.parent()[0]
			};

			// If the helper is not the original, hide the original so it's not playing any role during
			// the drag, won't cause anything bad this way
			if (this.helper[0] !== this.currentItem[0]) {
				this.currentItem.hide();
			}

			//Create the placeholder
			this._createPlaceholder();

			//Set a containment if given in the options
			if (o.containment) {
				this._setContainment();
			}

			if (o.cursor && o.cursor !== "auto") { // cursor option
				body = this.document.find("body");

				// Support: IE
				this.storedCursor = body.css("cursor");
				body.css("cursor", o.cursor);

				this.storedStylesheet =
					$("<style>*{ cursor: " + o.cursor + " !important; }</style>").appendTo(body);
			}

			if (o.opacity) { // opacity option
				if (this.helper.css("opacity")) {
					this._storedOpacity = this.helper.css("opacity");
				}
				this.helper.css("opacity", o.opacity);
			}

			if (o.zIndex) { // zIndex option
				if (this.helper.css("zIndex")) {
					this._storedZIndex = this.helper.css("zIndex");
				}
				this.helper.css("zIndex", o.zIndex);
			}

			//Prepare scrolling
			if (this.scrollParent[0] !== this.document[0] &&
				this.scrollParent[0].tagName !== "HTML") {
				this.overflowOffset = this.scrollParent.offset();
			}

			//Call callbacks
			this._trigger("start", event, this._uiHash());

			//Recache the helper size
			if (!this._preserveHelperProportions) {
				this._cacheHelperProportions();
			}

			//Post "activate" events to possible containers
			if (!noActivation) {
				for (i = this.containers.length - 1; i >= 0; i--) {
					this.containers[i]._trigger("activate", event, this._uiHash(this));
				}
			}

			//Prepare possible droppables
			if ($.ui.ddmanager) {
				$.ui.ddmanager.current = this;
			}

			if ($.ui.ddmanager && !o.dropBehaviour) {
				$.ui.ddmanager.prepareOffsets(this, event);
			}

			this.dragging = true;

			this._addClass(this.helper, "ui-sortable-helper");

			// Execute the drag once - this causes the helper not to be visiblebefore getting its
			// correct position
			this._mouseDrag(event);
			return true;

		},

		_mouseDrag: function (event) {
			var i, item, itemElement, intersection,
				o = this.options,
				scrolled = false;

			//Compute the helpers position
			this.position = this._generatePosition(event);
			this.positionAbs = this._convertPositionTo("absolute");

			if (!this.lastPositionAbs) {
				this.lastPositionAbs = this.positionAbs;
			}

			//Do scrolling
			if (this.options.scroll) {
				if (this.scrollParent[0] !== this.document[0] &&
					this.scrollParent[0].tagName !== "HTML") {

					if ((this.overflowOffset.top + this.scrollParent[0].offsetHeight) -
						event.pageY < o.scrollSensitivity) {
						this.scrollParent[0].scrollTop =
							scrolled = this.scrollParent[0].scrollTop + o.scrollSpeed;
					} else if (event.pageY - this.overflowOffset.top < o.scrollSensitivity) {
						this.scrollParent[0].scrollTop =
							scrolled = this.scrollParent[0].scrollTop - o.scrollSpeed;
					}

					if ((this.overflowOffset.left + this.scrollParent[0].offsetWidth) -
						event.pageX < o.scrollSensitivity) {
						this.scrollParent[0].scrollLeft = scrolled =
							this.scrollParent[0].scrollLeft + o.scrollSpeed;
					} else if (event.pageX - this.overflowOffset.left < o.scrollSensitivity) {
						this.scrollParent[0].scrollLeft = scrolled =
							this.scrollParent[0].scrollLeft - o.scrollSpeed;
					}

				} else {

					if (event.pageY - this.document.scrollTop() < o.scrollSensitivity) {
						scrolled = this.document.scrollTop(this.document.scrollTop() - o.scrollSpeed);
					} else if (this.window.height() - (event.pageY - this.document.scrollTop()) <
						o.scrollSensitivity) {
						scrolled = this.document.scrollTop(this.document.scrollTop() + o.scrollSpeed);
					}

					if (event.pageX - this.document.scrollLeft() < o.scrollSensitivity) {
						scrolled = this.document.scrollLeft(
							this.document.scrollLeft() - o.scrollSpeed
						);
					} else if (this.window.width() - (event.pageX - this.document.scrollLeft()) <
						o.scrollSensitivity) {
						scrolled = this.document.scrollLeft(
							this.document.scrollLeft() + o.scrollSpeed
						);
					}

				}

				if (scrolled !== false && $.ui.ddmanager && !o.dropBehaviour) {
					$.ui.ddmanager.prepareOffsets(this, event);
				}
			}

			//Regenerate the absolute position used for position checks
			this.positionAbs = this._convertPositionTo("absolute");

			//Set the helper position
			if (!this.options.axis || this.options.axis !== "y") {
				this.helper[0].style.left = this.position.left + "px";
			}
			if (!this.options.axis || this.options.axis !== "x") {
				this.helper[0].style.top = this.position.top + "px";
			}

			//Rearrange
			for (i = this.items.length - 1; i >= 0; i--) {

				//Cache variables and intersection, continue if no intersection
				item = this.items[i];
				itemElement = item.item[0];
				intersection = this._intersectsWithPointer(item);
				if (!intersection) {
					continue;
				}

				// Only put the placeholder inside the current Container, skip all
				// items from other containers. This works because when moving
				// an item from one container to another the
				// currentContainer is switched before the placeholder is moved.
				//
				// Without this, moving items in "sub-sortables" can cause
				// the placeholder to jitter between the outer and inner container.
				if (item.instance !== this.currentContainer) {
					continue;
				}

				// Cannot intersect with itself
				// no useless actions that have been done before
				// no action if the item moved is the parent of the item checked
				if (itemElement !== this.currentItem[0] &&
					this.placeholder[intersection === 1 ? "next" : "prev"]()[0] !== itemElement &&
					!$.contains(this.placeholder[0], itemElement) &&
					(this.options.type === "semi-dynamic" ?
							!$.contains(this.element[0], itemElement) :
							true
					)
				) {

					this.direction = intersection === 1 ? "down" : "up";

					if (this.options.tolerance === "pointer" || this._intersectsWithSides(item)) {
						this._rearrange(event, item);
					} else {
						break;
					}

					this._trigger("change", event, this._uiHash());
					break;
				}
			}

			//Post events to containers
			this._contactContainers(event);

			//Interconnect with droppables
			if ($.ui.ddmanager) {
				$.ui.ddmanager.drag(this, event);
			}

			//Call callbacks
			this._trigger("sort", event, this._uiHash());

			this.lastPositionAbs = this.positionAbs;
			return false;

		},

		_mouseStop: function (event, noPropagation) {

			if (!event) {
				return;
			}

			//If we are using droppables, inform the manager about the drop
			if ($.ui.ddmanager && !this.options.dropBehaviour) {
				$.ui.ddmanager.drop(this, event);
			}

			if (this.options.revert) {
				var that = this,
					cur = this.placeholder.offset(),
					axis = this.options.axis,
					animation = {};

				if (!axis || axis === "x") {
					animation.left = cur.left - this.offset.parent.left - this.margins.left +
						(this.offsetParent[0] === this.document[0].body ?
								0 :
								this.offsetParent[0].scrollLeft
						);
				}
				if (!axis || axis === "y") {
					animation.top = cur.top - this.offset.parent.top - this.margins.top +
						(this.offsetParent[0] === this.document[0].body ?
								0 :
								this.offsetParent[0].scrollTop
						);
				}
				this.reverting = true;
				$(this.helper).animate(
					animation,
					parseInt(this.options.revert, 10) || 500,
					function () {
						that._clear(event);
					}
				);
			} else {
				this._clear(event, noPropagation);
			}

			return false;

		},

		cancel: function () {

			if (this.dragging) {

				this._mouseUp(new $.Event("mouseup", {target: null}));

				if (this.options.helper === "original") {
					this.currentItem.css(this._storedCSS);
					this._removeClass(this.currentItem, "ui-sortable-helper");
				} else {
					this.currentItem.show();
				}

				//Post deactivating events to containers
				for (var i = this.containers.length - 1; i >= 0; i--) {
					this.containers[i]._trigger("deactivate", null, this._uiHash(this));
					if (this.containers[i].containerCache.over) {
						this.containers[i]._trigger("out", null, this._uiHash(this));
						this.containers[i].containerCache.over = 0;
					}
				}

			}

			if (this.placeholder) {

				//$(this.placeholder[0]).remove(); would have been the jQuery way - unfortunately,
				// it unbinds ALL events from the original node!
				if (this.placeholder[0].parentNode) {
					this.placeholder[0].parentNode.removeChild(this.placeholder[0]);
				}
				if (this.options.helper !== "original" && this.helper &&
					this.helper[0].parentNode) {
					this.helper.remove();
				}

				$.extend(this, {
					helper: null,
					dragging: false,
					reverting: false,
					_noFinalSort: null
				});

				if (this.domPosition.prev) {
					$(this.domPosition.prev).after(this.currentItem);
				} else {
					$(this.domPosition.parent).prepend(this.currentItem);
				}
			}

			return this;

		},

		serialize: function (o) {

			var items = this._getItemsAsjQuery(o && o.connected),
				str = [];
			o = o || {};

			$(items).each(function () {
				var res = ($(o.item || this).attr(o.attribute || "id") || "")
					.match(o.expression || (/(.+)[\-=_](.+)/));
				if (res) {
					str.push(
						(o.key || res[1] + "[]") +
						"=" + (o.key && o.expression ? res[1] : res[2]));
				}
			});

			if (!str.length && o.key) {
				str.push(o.key + "=");
			}

			return str.join("&");

		},

		toArray: function (o) {

			var items = this._getItemsAsjQuery(o && o.connected),
				ret = [];

			o = o || {};

			items.each(function () {
				ret.push($(o.item || this).attr(o.attribute || "id") || "");
			});
			return ret;

		},

		/* Be careful with the following core functions */
		_intersectsWith: function (item) {

			var x1 = this.positionAbs.left,
				x2 = x1 + this.helperProportions.width,
				y1 = this.positionAbs.top,
				y2 = y1 + this.helperProportions.height,
				l = item.left,
				r = l + item.width,
				t = item.top,
				b = t + item.height,
				dyClick = this.offset.click.top,
				dxClick = this.offset.click.left,
				isOverElementHeight = (this.options.axis === "x") || ((y1 + dyClick) > t &&
					(y1 + dyClick) < b),
				isOverElementWidth = (this.options.axis === "y") || ((x1 + dxClick) > l &&
					(x1 + dxClick) < r),
				isOverElement = isOverElementHeight && isOverElementWidth;

			if (this.options.tolerance === "pointer" ||
				this.options.forcePointerForContainers ||
				(this.options.tolerance !== "pointer" &&
					this.helperProportions[this.floating ? "width" : "height"] >
					item[this.floating ? "width" : "height"])
			) {
				return isOverElement;
			} else {

				return (l < x1 + (this.helperProportions.width / 2) && // Right Half
					x2 - (this.helperProportions.width / 2) < r && // Left Half
					t < y1 + (this.helperProportions.height / 2) && // Bottom Half
					y2 - (this.helperProportions.height / 2) < b); // Top Half

			}
		},

		_intersectsWithPointer: function (item) {
			var verticalDirection, horizontalDirection,
				isOverElementHeight = (this.options.axis === "x") ||
					this._isOverAxis(
						this.positionAbs.top + this.offset.click.top, item.top, item.height),
				isOverElementWidth = (this.options.axis === "y") ||
					this._isOverAxis(
						this.positionAbs.left + this.offset.click.left, item.left, item.width),
				isOverElement = isOverElementHeight && isOverElementWidth;

			if (!isOverElement) {
				return false;
			}

			verticalDirection = this._getDragVerticalDirection();
			horizontalDirection = this._getDragHorizontalDirection();

			return this.floating ?
				((horizontalDirection === "right" || verticalDirection === "down") ? 2 : 1)
				: (verticalDirection && (verticalDirection === "down" ? 2 : 1));

		},

		_intersectsWithSides: function (item) {

			var isOverBottomHalf = this._isOverAxis(this.positionAbs.top +
				this.offset.click.top, item.top + (item.height / 2), item.height),
				isOverRightHalf = this._isOverAxis(this.positionAbs.left +
					this.offset.click.left, item.left + (item.width / 2), item.width),
				verticalDirection = this._getDragVerticalDirection(),
				horizontalDirection = this._getDragHorizontalDirection();

			if (this.floating && horizontalDirection) {
				return ((horizontalDirection === "right" && isOverRightHalf) ||
					(horizontalDirection === "left" && !isOverRightHalf));
			} else {
				return verticalDirection && ((verticalDirection === "down" && isOverBottomHalf) ||
					(verticalDirection === "up" && !isOverBottomHalf));
			}

		},

		_getDragVerticalDirection: function () {
			var delta = this.positionAbs.top - this.lastPositionAbs.top;
			return delta !== 0 && (delta > 0 ? "down" : "up");
		},

		_getDragHorizontalDirection: function () {
			var delta = this.positionAbs.left - this.lastPositionAbs.left;
			return delta !== 0 && (delta > 0 ? "right" : "left");
		},

		refresh: function (event) {
			this._refreshItems(event);
			this._setHandleClassName();
			this.refreshPositions();
			return this;
		},

		_connectWith: function () {
			var options = this.options;
			return options.connectWith.constructor === String ?
				[options.connectWith] :
				options.connectWith;
		},

		_getItemsAsjQuery: function (connected) {

			var i, j, cur, inst,
				items = [],
				queries = [],
				connectWith = this._connectWith();

			if (connectWith && connected) {
				for (i = connectWith.length - 1; i >= 0; i--) {
					cur = $(connectWith[i], this.document[0]);
					for (j = cur.length - 1; j >= 0; j--) {
						inst = $.data(cur[j], this.widgetFullName);
						if (inst && inst !== this && !inst.options.disabled) {
							queries.push([$.isFunction(inst.options.items) ?
								inst.options.items.call(inst.element) :
								$(inst.options.items, inst.element)
									.not(".ui-sortable-helper")
									.not(".ui-sortable-placeholder"), inst]);
						}
					}
				}
			}

			queries.push([$.isFunction(this.options.items) ?
				this.options.items
					.call(this.element, null, {options: this.options, item: this.currentItem}) :
				$(this.options.items, this.element)
					.not(".ui-sortable-helper")
					.not(".ui-sortable-placeholder"), this]);

			function addItems() {
				items.push(this);
			}

			for (i = queries.length - 1; i >= 0; i--) {
				queries[i][0].each(addItems);
			}

			return $(items);

		},

		_removeCurrentsFromItems: function () {

			var list = this.currentItem.find(":data(" + this.widgetName + "-item)");

			this.items = $.grep(this.items, function (item) {
				for (var j = 0; j < list.length; j++) {
					if (list[j] === item.item[0]) {
						return false;
					}
				}
				return true;
			});

		},

		_refreshItems: function (event) {

			this.items = [];
			this.containers = [this];

			var i, j, cur, inst, targetData, _queries, item, queriesLength,
				items = this.items,
				queries = [[$.isFunction(this.options.items) ?
					this.options.items.call(this.element[0], event, {item: this.currentItem}) :
					$(this.options.items, this.element), this]],
				connectWith = this._connectWith();

			//Shouldn't be run the first time through due to massive slow-down
			if (connectWith && this.ready) {
				for (i = connectWith.length - 1; i >= 0; i--) {
					cur = $(connectWith[i], this.document[0]);
					for (j = cur.length - 1; j >= 0; j--) {
						inst = $.data(cur[j], this.widgetFullName);
						if (inst && inst !== this && !inst.options.disabled) {
							queries.push([$.isFunction(inst.options.items) ?
								inst.options.items
									.call(inst.element[0], event, {item: this.currentItem}) :
								$(inst.options.items, inst.element), inst]);
							this.containers.push(inst);
						}
					}
				}
			}

			for (i = queries.length - 1; i >= 0; i--) {
				targetData = queries[i][1];
				_queries = queries[i][0];

				for (j = 0, queriesLength = _queries.length; j < queriesLength; j++) {
					item = $(_queries[j]);

					// Data for target checking (mouse manager)
					item.data(this.widgetName + "-item", targetData);

					items.push({
						item: item,
						instance: targetData,
						width: 0, height: 0,
						left: 0, top: 0
					});
				}
			}

		},

		refreshPositions: function (fast) {

			// Determine whether items are being displayed horizontally
			this.floating = this.items.length ?
				this.options.axis === "x" || this._isFloating(this.items[0].item) :
				false;

			//This has to be redone because due to the item being moved out/into the offsetParent,
			// the offsetParent's position will change
			if (this.offsetParent && this.helper) {
				this.offset.parent = this._getParentOffset();
			}

			var i, item, t, p;

			for (i = this.items.length - 1; i >= 0; i--) {
				item = this.items[i];

				//We ignore calculating positions of all connected containers when we're not over them
				if (item.instance !== this.currentContainer && this.currentContainer &&
					item.item[0] !== this.currentItem[0]) {
					continue;
				}

				t = this.options.toleranceElement ?
					$(this.options.toleranceElement, item.item) :
					item.item;

				if (!fast) {
					item.width = t.outerWidth();
					item.height = t.outerHeight();
				}

				p = t.offset();
				item.left = p.left;
				item.top = p.top;
			}

			if (this.options.custom && this.options.custom.refreshContainers) {
				this.options.custom.refreshContainers.call(this);
			} else {
				for (i = this.containers.length - 1; i >= 0; i--) {
					p = this.containers[i].element.offset();
					this.containers[i].containerCache.left = p.left;
					this.containers[i].containerCache.top = p.top;
					this.containers[i].containerCache.width =
						this.containers[i].element.outerWidth();
					this.containers[i].containerCache.height =
						this.containers[i].element.outerHeight();
				}
			}

			return this;
		},

		_createPlaceholder: function (that) {
			that = that || this;
			var className,
				o = that.options;

			if (!o.placeholder || o.placeholder.constructor === String) {
				className = o.placeholder;
				o.placeholder = {
					element: function () {

						var nodeName = that.currentItem[0].nodeName.toLowerCase(),
							element = $("<" + nodeName + ">", that.document[0]);

						that._addClass(element, "ui-sortable-placeholder",
							className || that.currentItem[0].className)
							._removeClass(element, "ui-sortable-helper");

						if (nodeName === "tbody") {
							that._createTrPlaceholder(
								that.currentItem.find("tr").eq(0),
								$("<tr>", that.document[0]).appendTo(element)
							);
						} else if (nodeName === "tr") {
							that._createTrPlaceholder(that.currentItem, element);
						} else if (nodeName === "img") {
							element.attr("src", that.currentItem.attr("src"));
						}

						if (!className) {
							element.css("visibility", "hidden");
						}

						return element;
					},
					update: function (container, p) {

						// 1. If a className is set as 'placeholder option, we don't force sizes -
						// the class is responsible for that
						// 2. The option 'forcePlaceholderSize can be enabled to force it even if a
						// class name is specified
						if (className && !o.forcePlaceholderSize) {
							return;
						}

						//If the element doesn't have a actual height by itself (without styles coming
						// from a stylesheet), it receives the inline height from the dragged item
						if (!p.height()) {
							p.height(
								that.currentItem.innerHeight() -
								parseInt(that.currentItem.css("paddingTop") || 0, 10) -
								parseInt(that.currentItem.css("paddingBottom") || 0, 10));
						}
						if (!p.width()) {
							p.width(
								that.currentItem.innerWidth() -
								parseInt(that.currentItem.css("paddingLeft") || 0, 10) -
								parseInt(that.currentItem.css("paddingRight") || 0, 10));
						}
					}
				};
			}

			//Create the placeholder
			that.placeholder = $(o.placeholder.element.call(that.element, that.currentItem));

			//Append it after the actual current item
			that.currentItem.after(that.placeholder);

			//Update the size of the placeholder (TODO: Logic to fuzzy, see line 316/317)
			o.placeholder.update(that, that.placeholder);

		},

		_createTrPlaceholder: function (sourceTr, targetTr) {
			var that = this;

			sourceTr.children().each(function () {
				$("<td>&#160;</td>", that.document[0])
					.attr("colspan", $(this).attr("colspan") || 1)
					.appendTo(targetTr);
			});
		},

		_contactContainers: function (event) {
			var i, j, dist, itemWithLeastDistance, posProperty, sizeProperty, cur, nearBottom,
				floating, axis,
				innermostContainer = null,
				innermostIndex = null;

			// Get innermost container that intersects with item
			for (i = this.containers.length - 1; i >= 0; i--) {

				// Never consider a container that's located within the item itself
				if ($.contains(this.currentItem[0], this.containers[i].element[0])) {
					continue;
				}

				if (this._intersectsWith(this.containers[i].containerCache)) {

					// If we've already found a container and it's more "inner" than this, then continue
					if (innermostContainer &&
						$.contains(
							this.containers[i].element[0],
							innermostContainer.element[0])) {
						continue;
					}

					innermostContainer = this.containers[i];
					innermostIndex = i;

				} else {

					// container doesn't intersect. trigger "out" event if necessary
					if (this.containers[i].containerCache.over) {
						this.containers[i]._trigger("out", event, this._uiHash(this));
						this.containers[i].containerCache.over = 0;
					}
				}

			}

			// If no intersecting containers found, return
			if (!innermostContainer) {
				return;
			}

			// Move the item into the container if it's not there already
			if (this.containers.length === 1) {
				if (!this.containers[innermostIndex].containerCache.over) {
					this.containers[innermostIndex]._trigger("over", event, this._uiHash(this));
					this.containers[innermostIndex].containerCache.over = 1;
				}
			} else {

				// When entering a new container, we will find the item with the least distance and
				// append our item near it
				dist = 10000;
				itemWithLeastDistance = null;
				floating = innermostContainer.floating || this._isFloating(this.currentItem);
				posProperty = floating ? "left" : "top";
				sizeProperty = floating ? "width" : "height";
				axis = floating ? "pageX" : "pageY";

				for (j = this.items.length - 1; j >= 0; j--) {
					if (!$.contains(
							this.containers[innermostIndex].element[0], this.items[j].item[0])
					) {
						continue;
					}
					if (this.items[j].item[0] === this.currentItem[0]) {
						continue;
					}

					cur = this.items[j].item.offset()[posProperty];
					nearBottom = false;
					if (event[axis] - cur > this.items[j][sizeProperty] / 2) {
						nearBottom = true;
					}

					if (Math.abs(event[axis] - cur) < dist) {
						dist = Math.abs(event[axis] - cur);
						itemWithLeastDistance = this.items[j];
						this.direction = nearBottom ? "up" : "down";
					}
				}

				//Check if dropOnEmpty is enabled
				if (!itemWithLeastDistance && !this.options.dropOnEmpty) {
					return;
				}

				if (this.currentContainer === this.containers[innermostIndex]) {
					if (!this.currentContainer.containerCache.over) {
						this.containers[innermostIndex]._trigger("over", event, this._uiHash());
						this.currentContainer.containerCache.over = 1;
					}
					return;
				}

				itemWithLeastDistance ?
					this._rearrange(event, itemWithLeastDistance, null, true) :
					this._rearrange(event, null, this.containers[innermostIndex].element, true);
				this._trigger("change", event, this._uiHash());
				this.containers[innermostIndex]._trigger("change", event, this._uiHash(this));
				this.currentContainer = this.containers[innermostIndex];

				//Update the placeholder
				this.options.placeholder.update(this.currentContainer, this.placeholder);

				this.containers[innermostIndex]._trigger("over", event, this._uiHash(this));
				this.containers[innermostIndex].containerCache.over = 1;
			}

		},

		_createHelper: function (event) {

			var o = this.options,
				helper = $.isFunction(o.helper) ?
					$(o.helper.apply(this.element[0], [event, this.currentItem])) :
					(o.helper === "clone" ? this.currentItem.clone() : this.currentItem);

			//Add the helper to the DOM if that didn't happen already
			if (!helper.parents("body").length) {
				$(o.appendTo !== "parent" ?
					o.appendTo :
					this.currentItem[0].parentNode)[0].appendChild(helper[0]);
			}

			if (helper[0] === this.currentItem[0]) {
				this._storedCSS = {
					width: this.currentItem[0].style.width,
					height: this.currentItem[0].style.height,
					position: this.currentItem.css("position"),
					top: this.currentItem.css("top"),
					left: this.currentItem.css("left")
				};
			}

			if (!helper[0].style.width || o.forceHelperSize) {
				helper.width(this.currentItem.width());
			}
			if (!helper[0].style.height || o.forceHelperSize) {
				helper.height(this.currentItem.height());
			}

			return helper;

		},

		_adjustOffsetFromHelper: function (obj) {
			if (typeof obj === "string") {
				obj = obj.split(" ");
			}
			if ($.isArray(obj)) {
				obj = {left: +obj[0], top: +obj[1] || 0};
			}
			if ("left" in obj) {
				this.offset.click.left = obj.left + this.margins.left;
			}
			if ("right" in obj) {
				this.offset.click.left = this.helperProportions.width - obj.right + this.margins.left;
			}
			if ("top" in obj) {
				this.offset.click.top = obj.top + this.margins.top;
			}
			if ("bottom" in obj) {
				this.offset.click.top = this.helperProportions.height - obj.bottom + this.margins.top;
			}
		},

		_getParentOffset: function () {

			//Get the offsetParent and cache its position
			this.offsetParent = this.helper.offsetParent();
			var po = this.offsetParent.offset();

			// This is a special case where we need to modify a offset calculated on start, since the
			// following happened:
			// 1. The position of the helper is absolute, so it's position is calculated based on the
			// next positioned parent
			// 2. The actual offset parent is a child of the scroll parent, and the scroll parent isn't
			// the document, which means that the scroll is included in the initial calculation of the
			// offset of the parent, and never recalculated upon drag
			if (this.cssPosition === "absolute" && this.scrollParent[0] !== this.document[0] &&
				$.contains(this.scrollParent[0], this.offsetParent[0])) {
				po.left += this.scrollParent.scrollLeft();
				po.top += this.scrollParent.scrollTop();
			}

			// This needs to be actually done for all browsers, since pageX/pageY includes this
			// information with an ugly IE fix
			if (this.offsetParent[0] === this.document[0].body ||
				(this.offsetParent[0].tagName &&
					this.offsetParent[0].tagName.toLowerCase() === "html" && $.ui.ie)) {
				po = {top: 0, left: 0};
			}

			return {
				top: po.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
				left: po.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
			};

		},

		_getRelativeOffset: function () {

			if (this.cssPosition === "relative") {
				var p = this.currentItem.position();
				return {
					top: p.top - (parseInt(this.helper.css("top"), 10) || 0) +
					this.scrollParent.scrollTop(),
					left: p.left - (parseInt(this.helper.css("left"), 10) || 0) +
					this.scrollParent.scrollLeft()
				};
			} else {
				return {top: 0, left: 0};
			}

		},

		_cacheMargins: function () {
			this.margins = {
				left: (parseInt(this.currentItem.css("marginLeft"), 10) || 0),
				top: (parseInt(this.currentItem.css("marginTop"), 10) || 0)
			};
		},

		_cacheHelperProportions: function () {
			this.helperProportions = {
				width: this.helper.outerWidth(),
				height: this.helper.outerHeight()
			};
		},

		_setContainment: function () {

			var ce, co, over,
				o = this.options;
			if (o.containment === "parent") {
				o.containment = this.helper[0].parentNode;
			}
			if (o.containment === "document" || o.containment === "window") {
				this.containment = [
					0 - this.offset.relative.left - this.offset.parent.left,
					0 - this.offset.relative.top - this.offset.parent.top,
					o.containment === "document" ?
						this.document.width() :
						this.window.width() - this.helperProportions.width - this.margins.left,
					(o.containment === "document" ?
							(this.document.height() || document.body.parentNode.scrollHeight) :
							this.window.height() || this.document[0].body.parentNode.scrollHeight
					) - this.helperProportions.height - this.margins.top
				];
			}

			if (!(/^(document|window|parent)$/).test(o.containment)) {
				ce = $(o.containment)[0];
				co = $(o.containment).offset();
				over = ($(ce).css("overflow") !== "hidden");

				this.containment = [
					co.left + (parseInt($(ce).css("borderLeftWidth"), 10) || 0) +
					(parseInt($(ce).css("paddingLeft"), 10) || 0) - this.margins.left,
					co.top + (parseInt($(ce).css("borderTopWidth"), 10) || 0) +
					(parseInt($(ce).css("paddingTop"), 10) || 0) - this.margins.top,
					co.left + (over ? Math.max(ce.scrollWidth, ce.offsetWidth) : ce.offsetWidth) -
					(parseInt($(ce).css("borderLeftWidth"), 10) || 0) -
					(parseInt($(ce).css("paddingRight"), 10) || 0) -
					this.helperProportions.width - this.margins.left,
					co.top + (over ? Math.max(ce.scrollHeight, ce.offsetHeight) : ce.offsetHeight) -
					(parseInt($(ce).css("borderTopWidth"), 10) || 0) -
					(parseInt($(ce).css("paddingBottom"), 10) || 0) -
					this.helperProportions.height - this.margins.top
				];
			}

		},

		_convertPositionTo: function (d, pos) {

			if (!pos) {
				pos = this.position;
			}
			var mod = d === "absolute" ? 1 : -1,
				scroll = this.cssPosition === "absolute" &&
				!(this.scrollParent[0] !== this.document[0] &&
					$.contains(this.scrollParent[0], this.offsetParent[0])) ?
					this.offsetParent :
					this.scrollParent,
				scrollIsRootNode = (/(html|body)/i).test(scroll[0].tagName);

			return {
				top: (

					// The absolute mouse position
					pos.top +

					// Only for relative positioned nodes: Relative offset from element to offset parent
					this.offset.relative.top * mod +

					// The offsetParent's offset without borders (offset + border)
					this.offset.parent.top * mod -
					((this.cssPosition === "fixed" ?
						-this.scrollParent.scrollTop() :
						(scrollIsRootNode ? 0 : scroll.scrollTop())) * mod)
				),
				left: (

					// The absolute mouse position
					pos.left +

					// Only for relative positioned nodes: Relative offset from element to offset parent
					this.offset.relative.left * mod +

					// The offsetParent's offset without borders (offset + border)
					this.offset.parent.left * mod -
					((this.cssPosition === "fixed" ?
						-this.scrollParent.scrollLeft() : scrollIsRootNode ? 0 :
							scroll.scrollLeft()) * mod)
				)
			};

		},

		_generatePosition: function (event) {

			var top, left,
				o = this.options,
				pageX = event.pageX,
				pageY = event.pageY,
				scroll = this.cssPosition === "absolute" &&
				!(this.scrollParent[0] !== this.document[0] &&
					$.contains(this.scrollParent[0], this.offsetParent[0])) ?
					this.offsetParent :
					this.scrollParent,
				scrollIsRootNode = (/(html|body)/i).test(scroll[0].tagName);

			// This is another very weird special case that only happens for relative elements:
			// 1. If the css position is relative
			// 2. and the scroll parent is the document or similar to the offset parent
			// we have to refresh the relative offset during the scroll so there are no jumps
			if (this.cssPosition === "relative" && !(this.scrollParent[0] !== this.document[0] &&
					this.scrollParent[0] !== this.offsetParent[0])) {
				this.offset.relative = this._getRelativeOffset();
			}

			/*
		 * - Position constraining -
		 * Constrain the position to a mix of grid, containment.
		 */

			if (this.originalPosition) { //If we are not dragging yet, we won't check for options

				if (this.containment) {
					if (event.pageX - this.offset.click.left < this.containment[0]) {
						pageX = this.containment[0] + this.offset.click.left;
					}
					if (event.pageY - this.offset.click.top < this.containment[1]) {
						pageY = this.containment[1] + this.offset.click.top;
					}
					if (event.pageX - this.offset.click.left > this.containment[2]) {
						pageX = this.containment[2] + this.offset.click.left;
					}
					if (event.pageY - this.offset.click.top > this.containment[3]) {
						pageY = this.containment[3] + this.offset.click.top;
					}
				}

				if (o.grid) {
					top = this.originalPageY + Math.round((pageY - this.originalPageY) /
						o.grid[1]) * o.grid[1];
					pageY = this.containment ?
						((top - this.offset.click.top >= this.containment[1] &&
							top - this.offset.click.top <= this.containment[3]) ?
							top :
							((top - this.offset.click.top >= this.containment[1]) ?
								top - o.grid[1] : top + o.grid[1])) :
						top;

					left = this.originalPageX + Math.round((pageX - this.originalPageX) /
						o.grid[0]) * o.grid[0];
					pageX = this.containment ?
						((left - this.offset.click.left >= this.containment[0] &&
							left - this.offset.click.left <= this.containment[2]) ?
							left :
							((left - this.offset.click.left >= this.containment[0]) ?
								left - o.grid[0] : left + o.grid[0])) :
						left;
				}

			}

			return {
				top: (

					// The absolute mouse position
					pageY -

					// Click offset (relative to the element)
					this.offset.click.top -

					// Only for relative positioned nodes: Relative offset from element to offset parent
					this.offset.relative.top -

					// The offsetParent's offset without borders (offset + border)
					this.offset.parent.top +
					((this.cssPosition === "fixed" ?
						-this.scrollParent.scrollTop() :
						(scrollIsRootNode ? 0 : scroll.scrollTop())))
				),
				left: (

					// The absolute mouse position
					pageX -

					// Click offset (relative to the element)
					this.offset.click.left -

					// Only for relative positioned nodes: Relative offset from element to offset parent
					this.offset.relative.left -

					// The offsetParent's offset without borders (offset + border)
					this.offset.parent.left +
					((this.cssPosition === "fixed" ?
						-this.scrollParent.scrollLeft() :
						scrollIsRootNode ? 0 : scroll.scrollLeft()))
				)
			};

		},

		_rearrange: function (event, i, a, hardRefresh) {

			a ? a[0].appendChild(this.placeholder[0]) :
				i.item[0].parentNode.insertBefore(this.placeholder[0],
					(this.direction === "down" ? i.item[0] : i.item[0].nextSibling));

			//Various things done here to improve the performance:
			// 1. we create a setTimeout, that calls refreshPositions
			// 2. on the instance, we have a counter variable, that get's higher after every append
			// 3. on the local scope, we copy the counter variable, and check in the timeout,
			// if it's still the same
			// 4. this lets only the last addition to the timeout stack through
			this.counter = this.counter ? ++this.counter : 1;
			var counter = this.counter;

			this._delay(function () {
				if (counter === this.counter) {

					//Precompute after each DOM insertion, NOT on mousemove
					this.refreshPositions(!hardRefresh);
				}
			});

		},

		_clear: function (event, noPropagation) {

			this.reverting = false;

			// We delay all events that have to be triggered to after the point where the placeholder
			// has been removed and everything else normalized again
			var i,
				delayedTriggers = [];

			// We first have to update the dom position of the actual currentItem
			// Note: don't do it if the current item is already removed (by a user), or it gets
			// reappended (see #4088)
			if (!this._noFinalSort && this.currentItem.parent().length) {
				this.placeholder.before(this.currentItem);
			}
			this._noFinalSort = null;

			if (this.helper[0] === this.currentItem[0]) {
				for (i in this._storedCSS) {
					if (this._storedCSS[i] === "auto" || this._storedCSS[i] === "static") {
						this._storedCSS[i] = "";
					}
				}
				this.currentItem.css(this._storedCSS);
				this._removeClass(this.currentItem, "ui-sortable-helper");
			} else {
				this.currentItem.show();
			}

			if (this.fromOutside && !noPropagation) {
				delayedTriggers.push(function (event) {
					this._trigger("receive", event, this._uiHash(this.fromOutside));
				});
			}
			if ((this.fromOutside ||
					this.domPosition.prev !==
					this.currentItem.prev().not(".ui-sortable-helper")[0] ||
					this.domPosition.parent !== this.currentItem.parent()[0]) && !noPropagation) {

				// Trigger update callback if the DOM position has changed
				delayedTriggers.push(function (event) {
					this._trigger("update", event, this._uiHash());
				});
			}

			// Check if the items Container has Changed and trigger appropriate
			// events.
			if (this !== this.currentContainer) {
				if (!noPropagation) {
					delayedTriggers.push(function (event) {
						this._trigger("remove", event, this._uiHash());
					});
					delayedTriggers.push((function (c) {
						return function (event) {
							c._trigger("receive", event, this._uiHash(this));
						};
					}).call(this, this.currentContainer));
					delayedTriggers.push((function (c) {
						return function (event) {
							c._trigger("update", event, this._uiHash(this));
						};
					}).call(this, this.currentContainer));
				}
			}

			//Post events to containers
			function delayEvent(type, instance, container) {
				return function (event) {
					container._trigger(type, event, instance._uiHash(instance));
				};
			}

			for (i = this.containers.length - 1; i >= 0; i--) {
				if (!noPropagation) {
					delayedTriggers.push(delayEvent("deactivate", this, this.containers[i]));
				}
				if (this.containers[i].containerCache.over) {
					delayedTriggers.push(delayEvent("out", this, this.containers[i]));
					this.containers[i].containerCache.over = 0;
				}
			}

			//Do what was originally in plugins
			if (this.storedCursor) {
				this.document.find("body").css("cursor", this.storedCursor);
				this.storedStylesheet.remove();
			}
			if (this._storedOpacity) {
				this.helper.css("opacity", this._storedOpacity);
			}
			if (this._storedZIndex) {
				this.helper.css("zIndex", this._storedZIndex === "auto" ? "" : this._storedZIndex);
			}

			this.dragging = false;

			if (!noPropagation) {
				this._trigger("beforeStop", event, this._uiHash());
			}

			//$(this.placeholder[0]).remove(); would have been the jQuery way - unfortunately,
			// it unbinds ALL events from the original node!
			this.placeholder[0].parentNode.removeChild(this.placeholder[0]);

			if (!this.cancelHelperRemoval) {
				if (this.helper[0] !== this.currentItem[0]) {
					this.helper.remove();
				}
				this.helper = null;
			}

			if (!noPropagation) {
				for (i = 0; i < delayedTriggers.length; i++) {

					// Trigger all delayed events
					delayedTriggers[i].call(this, event);
				}
				this._trigger("stop", event, this._uiHash());
			}

			this.fromOutside = false;
			return !this.cancelHelperRemoval;

		},

		_trigger: function () {
			if ($.Widget.prototype._trigger.apply(this, arguments) === false) {
				this.cancel();
			}
		},

		_uiHash: function (_inst) {
			var inst = _inst || this;
			return {
				helper: inst.helper,
				placeholder: inst.placeholder || $([]),
				position: inst.position,
				originalPosition: inst.originalPosition,
				offset: inst.positionAbs,
				item: inst.currentItem,
				sender: _inst ? _inst.element : null
			};
		}

	});


	var safeActiveElement = $.ui.safeActiveElement = function (document) {
		var activeElement;

		// Support: IE 9 only
		// IE9 throws an "Unspecified error" accessing document.activeElement from an <iframe>
		try {
			activeElement = document.activeElement;
		} catch (error) {
			activeElement = document.body;
		}

		// Support: IE 9 - 11 only
		// IE may return null instead of an element
		// Interestingly, this only seems to occur when NOT in an iframe
		if (!activeElement) {
			activeElement = document.body;
		}

		// Support: IE 11 only
		// IE11 returns a seemingly empty object in some cases when accessing
		// document.activeElement from an <iframe>
		if (!activeElement.nodeName) {
			activeElement = document.body;
		}

		return activeElement;
	};


	/*!
 * jQuery UI Menu 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Menu
//>>group: Widgets
//>>description: Creates nestable menus.
//>>docs: http://api.jqueryui.com/menu/
//>>demos: http://jqueryui.com/menu/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/menu.css
//>>css.theme: ../../themes/base/theme.css


	var widgetsMenu = $.widget("ui.menu", {
		version: "1.12.1",
		defaultElement: "<ul>",
		delay: 300,
		options: {
			icons: {
				submenu: "ui-icon-caret-1-e"
			},
			items: "> *",
			menus: "ul",
			position: {
				my: "left top",
				at: "right top"
			},
			role: "menu",

			// Callbacks
			blur: null,
			focus: null,
			select: null
		},

		_create: function () {
			this.activeMenu = this.element;

			// Flag used to prevent firing of the click handler
			// as the event bubbles up through nested menus
			this.mouseHandled = false;
			this.element
				.uniqueId()
				.attr({
					role: this.options.role,
					tabIndex: 0
				});

			this._addClass("ui-menu", "ui-widget ui-widget-content");
			this._on({

				// Prevent focus from sticking to links inside menu after clicking
				// them (focus should always stay on UL during navigation).
				"mousedown .ui-menu-item": function (event) {
					event.preventDefault();
				},
				"click .ui-menu-item": function (event) {
					var target = $(event.target);
					var active = $($.ui.safeActiveElement(this.document[0]));
					if (!this.mouseHandled && target.not(".ui-state-disabled").length) {
						this.select(event);

						// Only set the mouseHandled flag if the event will bubble, see #9469.
						if (!event.isPropagationStopped()) {
							this.mouseHandled = true;
						}

						// Open submenu on click
						if (target.has(".ui-menu").length) {
							this.expand(event);
						} else if (!this.element.is(":focus") &&
							active.closest(".ui-menu").length) {

							// Redirect focus to the menu
							this.element.trigger("focus", [true]);

							// If the active item is on the top level, let it stay active.
							// Otherwise, blur the active item since it is no longer visible.
							if (this.active && this.active.parents(".ui-menu").length === 1) {
								clearTimeout(this.timer);
							}
						}
					}
				},
				"mouseenter .ui-menu-item": function (event) {

					// Ignore mouse events while typeahead is active, see #10458.
					// Prevents focusing the wrong item when typeahead causes a scroll while the mouse
					// is over an item in the menu
					if (this.previousFilter) {
						return;
					}

					var actualTarget = $(event.target).closest(".ui-menu-item"),
						target = $(event.currentTarget);

					// Ignore bubbled events on parent items, see #11641
					if (actualTarget[0] !== target[0]) {
						return;
					}

					// Remove ui-state-active class from siblings of the newly focused menu item
					// to avoid a jump caused by adjacent elements both having a class with a border
					this._removeClass(target.siblings().children(".ui-state-active"),
						null, "ui-state-active");
					this.focus(event, target);
				},
				mouseleave: "collapseAll",
				"mouseleave .ui-menu": "collapseAll",
				focus: function (event, keepActiveItem) {

					// If there's already an active item, keep it active
					// If not, activate the first item
					var item = this.active || this.element.find(this.options.items).eq(0);

					if (!keepActiveItem) {
						this.focus(event, item);
					}
				},
				blur: function (event) {
					this._delay(function () {
						var notContained = !$.contains(
							this.element[0],
							$.ui.safeActiveElement(this.document[0])
						);
						if (notContained) {
							this.collapseAll(event);
						}
					});
				},
				keydown: "_keydown"
			});

			this.refresh();

			// Clicks outside of a menu collapse any open menus
			this._on(this.document, {
				click: function (event) {
					if (this._closeOnDocumentClick(event)) {
						this.collapseAll(event);
					}

					// Reset the mouseHandled flag
					this.mouseHandled = false;
				}
			});
		},

		_destroy: function () {
			var items = this.element.find(".ui-menu-item")
					.removeAttr("role aria-disabled"),
				submenus = items.children(".ui-menu-item-wrapper")
					.removeUniqueId()
					.removeAttr("tabIndex role aria-haspopup");

			// Destroy (sub)menus
			this.element
				.removeAttr("aria-activedescendant")
				.find(".ui-menu").addBack()
				.removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled " +
					"tabIndex")
				.removeUniqueId()
				.show();

			submenus.children().each(function () {
				var elem = $(this);
				if (elem.data("ui-menu-submenu-caret")) {
					elem.remove();
				}
			});
		},

		_keydown: function (event) {
			var match, prev, character, skip,
				preventDefault = true;

			switch (event.keyCode) {
				case $.ui.keyCode.PAGE_UP:
					this.previousPage(event);
					break;
				case $.ui.keyCode.PAGE_DOWN:
					this.nextPage(event);
					break;
				case $.ui.keyCode.HOME:
					this._move("first", "first", event);
					break;
				case $.ui.keyCode.END:
					this._move("last", "last", event);
					break;
				case $.ui.keyCode.UP:
					this.previous(event);
					break;
				case $.ui.keyCode.DOWN:
					this.next(event);
					break;
				case $.ui.keyCode.LEFT:
					this.collapse(event);
					break;
				case $.ui.keyCode.RIGHT:
					if (this.active && !this.active.is(".ui-state-disabled")) {
						this.expand(event);
					}
					break;
				case $.ui.keyCode.ENTER:
				case $.ui.keyCode.SPACE:
					this._activate(event);
					break;
				case $.ui.keyCode.ESCAPE:
					this.collapse(event);
					break;
				default:
					preventDefault = false;
					prev = this.previousFilter || "";
					skip = false;

					// Support number pad values
					character = event.keyCode >= 96 && event.keyCode <= 105 ?
						(event.keyCode - 96).toString() : String.fromCharCode(event.keyCode);

					clearTimeout(this.filterTimer);

					if (character === prev) {
						skip = true;
					} else {
						character = prev + character;
					}

					match = this._filterMenuItems(character);
					match = skip && match.index(this.active.next()) !== -1 ?
						this.active.nextAll(".ui-menu-item") :
						match;

					// If no matches on the current filter, reset to the last character pressed
					// to move down the menu to the first item that starts with that character
					if (!match.length) {
						character = String.fromCharCode(event.keyCode);
						match = this._filterMenuItems(character);
					}

					if (match.length) {
						this.focus(event, match);
						this.previousFilter = character;
						this.filterTimer = this._delay(function () {
							delete this.previousFilter;
						}, 1000);
					} else {
						delete this.previousFilter;
					}
			}

			if (preventDefault) {
				event.preventDefault();
			}
		},

		_activate: function (event) {
			if (this.active && !this.active.is(".ui-state-disabled")) {
				if (this.active.children("[aria-haspopup='true']").length) {
					this.expand(event);
				} else {
					this.select(event);
				}
			}
		},

		refresh: function () {
			var menus, items, newSubmenus, newItems, newWrappers,
				that = this,
				icon = this.options.icons.submenu,
				submenus = this.element.find(this.options.menus);

			this._toggleClass("ui-menu-icons", null, !!this.element.find(".ui-icon").length);

			// Initialize nested menus
			newSubmenus = submenus.filter(":not(.ui-menu)")
				.hide()
				.attr({
					role: this.options.role,
					"aria-hidden": "true",
					"aria-expanded": "false"
				})
				.each(function () {
					var menu = $(this),
						item = menu.prev(),
						submenuCaret = $("<span>").data("ui-menu-submenu-caret", true);

					that._addClass(submenuCaret, "ui-menu-icon", "ui-icon " + icon);
					item
						.attr("aria-haspopup", "true")
						.prepend(submenuCaret);
					menu.attr("aria-labelledby", item.attr("id"));
				});

			this._addClass(newSubmenus, "ui-menu", "ui-widget ui-widget-content ui-front");

			menus = submenus.add(this.element);
			items = menus.find(this.options.items);

			// Initialize menu-items containing spaces and/or dashes only as dividers
			items.not(".ui-menu-item").each(function () {
				var item = $(this);
				if (that._isDivider(item)) {
					that._addClass(item, "ui-menu-divider", "ui-widget-content");
				}
			});

			// Don't refresh list items that are already adapted
			newItems = items.not(".ui-menu-item, .ui-menu-divider");
			newWrappers = newItems.children()
				.not(".ui-menu")
				.uniqueId()
				.attr({
					tabIndex: -1,
					role: this._itemRole()
				});
			this._addClass(newItems, "ui-menu-item")
				._addClass(newWrappers, "ui-menu-item-wrapper");

			// Add aria-disabled attribute to any disabled menu item
			items.filter(".ui-state-disabled").attr("aria-disabled", "true");

			// If the active item has been removed, blur the menu
			if (this.active && !$.contains(this.element[0], this.active[0])) {
				this.blur();
			}
		},

		_itemRole: function () {
			return {
				menu: "menuitem",
				listbox: "option"
			}[this.options.role];
		},

		_setOption: function (key, value) {
			if (key === "icons") {
				var icons = this.element.find(".ui-menu-icon");
				this._removeClass(icons, null, this.options.icons.submenu)
					._addClass(icons, null, value.submenu);
			}
			this._super(key, value);
		},

		_setOptionDisabled: function (value) {
			this._super(value);

			this.element.attr("aria-disabled", String(value));
			this._toggleClass(null, "ui-state-disabled", !!value);
		},

		focus: function (event, item) {
			var nested, focused, activeParent;
			this.blur(event, event && event.type === "focus");

			this._scrollIntoView(item);

			this.active = item.first();

			focused = this.active.children(".ui-menu-item-wrapper");
			this._addClass(focused, null, "ui-state-active");

			// Only update aria-activedescendant if there's a role
			// otherwise we assume focus is managed elsewhere
			if (this.options.role) {
				this.element.attr("aria-activedescendant", focused.attr("id"));
			}

			// Highlight active parent menu item, if any
			activeParent = this.active
				.parent()
				.closest(".ui-menu-item")
				.children(".ui-menu-item-wrapper");
			this._addClass(activeParent, null, "ui-state-active");

			if (event && event.type === "keydown") {
				this._close();
			} else {
				this.timer = this._delay(function () {
					this._close();
				}, this.delay);
			}

			nested = item.children(".ui-menu");
			if (nested.length && event && (/^mouse/.test(event.type))) {
				this._startOpening(nested);
			}
			this.activeMenu = item.parent();

			this._trigger("focus", event, {item: item});
		},

		_scrollIntoView: function (item) {
			var borderTop, paddingTop, offset, scroll, elementHeight, itemHeight;
			if (this._hasScroll()) {
				borderTop = parseFloat($.css(this.activeMenu[0], "borderTopWidth")) || 0;
				paddingTop = parseFloat($.css(this.activeMenu[0], "paddingTop")) || 0;
				offset = item.offset().top - this.activeMenu.offset().top - borderTop - paddingTop;
				scroll = this.activeMenu.scrollTop();
				elementHeight = this.activeMenu.height();
				itemHeight = item.outerHeight();

				if (offset < 0) {
					this.activeMenu.scrollTop(scroll + offset);
				} else if (offset + itemHeight > elementHeight) {
					this.activeMenu.scrollTop(scroll + offset - elementHeight + itemHeight);
				}
			}
		},

		blur: function (event, fromFocus) {
			if (!fromFocus) {
				clearTimeout(this.timer);
			}

			if (!this.active) {
				return;
			}

			this._removeClass(this.active.children(".ui-menu-item-wrapper"),
				null, "ui-state-active");

			this._trigger("blur", event, {item: this.active});
			this.active = null;
		},

		_startOpening: function (submenu) {
			clearTimeout(this.timer);

			// Don't open if already open fixes a Firefox bug that caused a .5 pixel
			// shift in the submenu position when mousing over the caret icon
			if (submenu.attr("aria-hidden") !== "true") {
				return;
			}

			this.timer = this._delay(function () {
				this._close();
				this._open(submenu);
			}, this.delay);
		},

		_open: function (submenu) {
			var position = $.extend({
				of: this.active
			}, this.options.position);

			clearTimeout(this.timer);
			this.element.find(".ui-menu").not(submenu.parents(".ui-menu"))
				.hide()
				.attr("aria-hidden", "true");

			submenu
				.show()
				.removeAttr("aria-hidden")
				.attr("aria-expanded", "true")
				.position(position);
		},

		collapseAll: function (event, all) {
			clearTimeout(this.timer);
			this.timer = this._delay(function () {

				// If we were passed an event, look for the submenu that contains the event
				var currentMenu = all ? this.element :
					$(event && event.target).closest(this.element.find(".ui-menu"));

				// If we found no valid submenu ancestor, use the main menu to close all
				// sub menus anyway
				if (!currentMenu.length) {
					currentMenu = this.element;
				}

				this._close(currentMenu);

				this.blur(event);

				// Work around active item staying active after menu is blurred
				this._removeClass(currentMenu.find(".ui-state-active"), null, "ui-state-active");

				this.activeMenu = currentMenu;
			}, this.delay);
		},

		// With no arguments, closes the currently active menu - if nothing is active
		// it closes all menus.  If passed an argument, it will search for menus BELOW
		_close: function (startMenu) {
			if (!startMenu) {
				startMenu = this.active ? this.active.parent() : this.element;
			}

			startMenu.find(".ui-menu")
				.hide()
				.attr("aria-hidden", "true")
				.attr("aria-expanded", "false");
		},

		_closeOnDocumentClick: function (event) {
			return !$(event.target).closest(".ui-menu").length;
		},

		_isDivider: function (item) {

			// Match hyphen, em dash, en dash
			return !/[^\-\u2014\u2013\s]/.test(item.text());
		},

		collapse: function (event) {
			var newItem = this.active &&
				this.active.parent().closest(".ui-menu-item", this.element);
			if (newItem && newItem.length) {
				this._close();
				this.focus(event, newItem);
			}
		},

		expand: function (event) {
			var newItem = this.active &&
				this.active
					.children(".ui-menu ")
					.find(this.options.items)
					.first();

			if (newItem && newItem.length) {
				this._open(newItem.parent());

				// Delay so Firefox will not hide activedescendant change in expanding submenu from AT
				this._delay(function () {
					this.focus(event, newItem);
				});
			}
		},

		next: function (event) {
			this._move("next", "first", event);
		},

		previous: function (event) {
			this._move("prev", "last", event);
		},

		isFirstItem: function () {
			return this.active && !this.active.prevAll(".ui-menu-item").length;
		},

		isLastItem: function () {
			return this.active && !this.active.nextAll(".ui-menu-item").length;
		},

		_move: function (direction, filter, event) {
			var next;
			if (this.active) {
				if (direction === "first" || direction === "last") {
					next = this.active
						[direction === "first" ? "prevAll" : "nextAll"](".ui-menu-item")
						.eq(-1);
				} else {
					next = this.active
						[direction + "All"](".ui-menu-item")
						.eq(0);
				}
			}
			if (!next || !next.length || !this.active) {
				next = this.activeMenu.find(this.options.items)[filter]();
			}

			this.focus(event, next);
		},

		nextPage: function (event) {
			var item, base, height;

			if (!this.active) {
				this.next(event);
				return;
			}
			if (this.isLastItem()) {
				return;
			}
			if (this._hasScroll()) {
				base = this.active.offset().top;
				height = this.element.height();
				this.active.nextAll(".ui-menu-item").each(function () {
					item = $(this);
					return item.offset().top - base - height < 0;
				});

				this.focus(event, item);
			} else {
				this.focus(event, this.activeMenu.find(this.options.items)
					[!this.active ? "first" : "last"]());
			}
		},

		previousPage: function (event) {
			var item, base, height;
			if (!this.active) {
				this.next(event);
				return;
			}
			if (this.isFirstItem()) {
				return;
			}
			if (this._hasScroll()) {
				base = this.active.offset().top;
				height = this.element.height();
				this.active.prevAll(".ui-menu-item").each(function () {
					item = $(this);
					return item.offset().top - base + height > 0;
				});

				this.focus(event, item);
			} else {
				this.focus(event, this.activeMenu.find(this.options.items).first());
			}
		},

		_hasScroll: function () {
			return this.element.outerHeight() < this.element.prop("scrollHeight");
		},

		select: function (event) {

			// TODO: It should never be possible to not have an active item at this
			// point, but the tests don't trigger mouseenter before click.
			this.active = this.active || $(event.target).closest(".ui-menu-item");
			var ui = {item: this.active};
			if (!this.active.has(".ui-menu").length) {
				this.collapseAll(event, true);
			}
			this._trigger("select", event, ui);
		},

		_filterMenuItems: function (character) {
			var escapedCharacter = character.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&"),
				regex = new RegExp("^" + escapedCharacter, "i");

			return this.activeMenu
				.find(this.options.items)

				// Only match on items, not dividers or other content (#10571)
				.filter(".ui-menu-item")
				.filter(function () {
					return regex.test(
						$.trim($(this).children(".ui-menu-item-wrapper").text()));
				});
		}
	});


	/*!
 * jQuery UI Autocomplete 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Autocomplete
//>>group: Widgets
//>>description: Lists suggested words as the user is typing.
//>>docs: http://api.jqueryui.com/autocomplete/
//>>demos: http://jqueryui.com/autocomplete/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/autocomplete.css
//>>css.theme: ../../themes/base/theme.css


	$.widget("ui.autocomplete", {
		version: "1.12.1",
		defaultElement: "<input>",
		options: {
			appendTo: null,
			autoFocus: false,
			delay: 300,
			minLength: 1,
			position: {
				my: "left top",
				at: "left bottom",
				collision: "none"
			},
			source: null,

			// Callbacks
			change: null,
			close: null,
			focus: null,
			open: null,
			response: null,
			search: null,
			select: null
		},

		requestIndex: 0,
		pending: 0,

		_create: function () {

			// Some browsers only repeat keydown events, not keypress events,
			// so we use the suppressKeyPress flag to determine if we've already
			// handled the keydown event. #7269
			// Unfortunately the code for & in keypress is the same as the up arrow,
			// so we use the suppressKeyPressRepeat flag to avoid handling keypress
			// events when we know the keydown event was used to modify the
			// search term. #7799
			var suppressKeyPress, suppressKeyPressRepeat, suppressInput,
				nodeName = this.element[0].nodeName.toLowerCase(),
				isTextarea = nodeName === "textarea",
				isInput = nodeName === "input";

			// Textareas are always multi-line
			// Inputs are always single-line, even if inside a contentEditable element
			// IE also treats inputs as contentEditable
			// All other element types are determined by whether or not they're contentEditable
			this.isMultiLine = isTextarea || !isInput && this._isContentEditable(this.element);

			this.valueMethod = this.element[isTextarea || isInput ? "val" : "text"];
			this.isNewMenu = true;

			this._addClass("ui-autocomplete-input");
			this.element.attr("autocomplete", "off");

			this._on(this.element, {
				keydown: function (event) {
					if (this.element.prop("readOnly")) {
						suppressKeyPress = true;
						suppressInput = true;
						suppressKeyPressRepeat = true;
						return;
					}

					suppressKeyPress = false;
					suppressInput = false;
					suppressKeyPressRepeat = false;
					var keyCode = $.ui.keyCode;
					switch (event.keyCode) {
						case keyCode.PAGE_UP:
							suppressKeyPress = true;
							this._move("previousPage", event);
							break;
						case keyCode.PAGE_DOWN:
							suppressKeyPress = true;
							this._move("nextPage", event);
							break;
						case keyCode.UP:
							suppressKeyPress = true;
							this._keyEvent("previous", event);
							break;
						case keyCode.DOWN:
							suppressKeyPress = true;
							this._keyEvent("next", event);
							break;
						case keyCode.ENTER:

							// when menu is open and has focus
							if (this.menu.active) {

								// #6055 - Opera still allows the keypress to occur
								// which causes forms to submit
								suppressKeyPress = true;
								event.preventDefault();
								this.menu.select(event);
							}
							break;
						case keyCode.TAB:
							if (this.menu.active) {
								this.menu.select(event);
							}
							break;
						case keyCode.ESCAPE:
							if (this.menu.element.is(":visible")) {
								if (!this.isMultiLine) {
									this._value(this.term);
								}
								this.close(event);

								// Different browsers have different default behavior for escape
								// Single press can mean undo or clear
								// Double press in IE means clear the whole form
								event.preventDefault();
							}
							break;
						default:
							suppressKeyPressRepeat = true;

							// search timeout should be triggered before the input value is changed
							this._searchTimeout(event);
							break;
					}
				},
				keypress: function (event) {
					if (suppressKeyPress) {
						suppressKeyPress = false;
						if (!this.isMultiLine || this.menu.element.is(":visible")) {
							event.preventDefault();
						}
						return;
					}
					if (suppressKeyPressRepeat) {
						return;
					}

					// Replicate some key handlers to allow them to repeat in Firefox and Opera
					var keyCode = $.ui.keyCode;
					switch (event.keyCode) {
						case keyCode.PAGE_UP:
							this._move("previousPage", event);
							break;
						case keyCode.PAGE_DOWN:
							this._move("nextPage", event);
							break;
						case keyCode.UP:
							this._keyEvent("previous", event);
							break;
						case keyCode.DOWN:
							this._keyEvent("next", event);
							break;
					}
				},
				input: function (event) {
					if (suppressInput) {
						suppressInput = false;
						event.preventDefault();
						return;
					}
					this._searchTimeout(event);
				},
				focus: function () {
					this.selectedItem = null;
					this.previous = this._value();
				},
				blur: function (event) {
					if (this.cancelBlur) {
						delete this.cancelBlur;
						return;
					}

					clearTimeout(this.searching);
					this.close(event);
					this._change(event);
				}
			});

			this._initSource();
			this.menu = $("<ul>")
				.appendTo(this._appendTo())
				.menu({

					// disable ARIA support, the live region takes care of that
					role: null
				})
				.hide()
				.menu("instance");

			this._addClass(this.menu.element, "ui-autocomplete", "ui-front");
			this._on(this.menu.element, {
				mousedown: function (event) {

					// prevent moving focus out of the text field
					event.preventDefault();

					// IE doesn't prevent moving focus even with event.preventDefault()
					// so we set a flag to know when we should ignore the blur event
					this.cancelBlur = true;
					this._delay(function () {
						delete this.cancelBlur;

						// Support: IE 8 only
						// Right clicking a menu item or selecting text from the menu items will
						// result in focus moving out of the input. However, we've already received
						// and ignored the blur event because of the cancelBlur flag set above. So
						// we restore focus to ensure that the menu closes properly based on the user's
						// next actions.
						if (this.element[0] !== $.ui.safeActiveElement(this.document[0])) {
							this.element.trigger("focus");
						}
					});
				},
				menufocus: function (event, ui) {
					var label, item;

					// support: Firefox
					// Prevent accidental activation of menu items in Firefox (#7024 #9118)
					if (this.isNewMenu) {
						this.isNewMenu = false;
						if (event.originalEvent && /^mouse/.test(event.originalEvent.type)) {
							this.menu.blur();

							this.document.one("mousemove", function () {
								$(event.target).trigger(event.originalEvent);
							});

							return;
						}
					}

					item = ui.item.data("ui-autocomplete-item");
					if (false !== this._trigger("focus", event, {item: item})) {

						// use value to match what will end up in the input, if it was a key event
						if (event.originalEvent && /^key/.test(event.originalEvent.type)) {
							this._value(item.value);
						}
					}

					// Announce the value in the liveRegion
					label = ui.item.attr("aria-label") || item.value;
					if (label && $.trim(label).length) {
						this.liveRegion.children().hide();
						$("<div>").text(label).appendTo(this.liveRegion);
					}
				},
				menuselect: function (event, ui) {
					var item = ui.item.data("ui-autocomplete-item"),
						previous = this.previous;

					// Only trigger when focus was lost (click on menu)
					if (this.element[0] !== $.ui.safeActiveElement(this.document[0])) {
						this.element.trigger("focus");
						this.previous = previous;

						// #6109 - IE triggers two focus events and the second
						// is asynchronous, so we need to reset the previous
						// term synchronously and asynchronously :-(
						this._delay(function () {
							this.previous = previous;
							this.selectedItem = item;
						});
					}

					if (false !== this._trigger("select", event, {item: item})) {
						this._value(item.value);
					}

					// reset the term after the select event
					// this allows custom select handling to work properly
					this.term = this._value();

					this.close(event);
					this.selectedItem = item;
				}
			});

			this.liveRegion = $("<div>", {
				role: "status",
				"aria-live": "assertive",
				"aria-relevant": "additions"
			})
				.appendTo(this.document[0].body);

			this._addClass(this.liveRegion, null, "ui-helper-hidden-accessible");

			// Turning off autocomplete prevents the browser from remembering the
			// value when navigating through history, so we re-enable autocomplete
			// if the page is unloaded before the widget is destroyed. #7790
			this._on(this.window, {
				beforeunload: function () {
					this.element.removeAttr("autocomplete");
				}
			});
		},

		_destroy: function () {
			clearTimeout(this.searching);
			this.element.removeAttr("autocomplete");
			this.menu.element.remove();
			this.liveRegion.remove();
		},

		_setOption: function (key, value) {
			this._super(key, value);
			if (key === "source") {
				this._initSource();
			}
			if (key === "appendTo") {
				this.menu.element.appendTo(this._appendTo());
			}
			if (key === "disabled" && value && this.xhr) {
				this.xhr.abort();
			}
		},

		_isEventTargetInWidget: function (event) {
			var menuElement = this.menu.element[0];

			return event.target === this.element[0] ||
				event.target === menuElement ||
				$.contains(menuElement, event.target);
		},

		_closeOnClickOutside: function (event) {
			if (!this._isEventTargetInWidget(event)) {
				this.close();
			}
		},

		_appendTo: function () {
			var element = this.options.appendTo;

			if (element) {
				element = element.jquery || element.nodeType ?
					$(element) :
					this.document.find(element).eq(0);
			}

			if (!element || !element[0]) {
				element = this.element.closest(".ui-front, dialog");
			}

			if (!element.length) {
				element = this.document[0].body;
			}

			return element;
		},

		_initSource: function () {
			var array, url,
				that = this;
			if ($.isArray(this.options.source)) {
				array = this.options.source;
				this.source = function (request, response) {
					response($.ui.autocomplete.filter(array, request.term));
				};
			} else if (typeof this.options.source === "string") {
				url = this.options.source;
				this.source = function (request, response) {
					if (that.xhr) {
						that.xhr.abort();
					}
					that.xhr = $.ajax({
						url: url,
						data: request,
						dataType: "json",
						success: function (data) {
							response(data);
						},
						error: function () {
							response([]);
						}
					});
				};
			} else {
				this.source = this.options.source;
			}
		},

		_searchTimeout: function (event) {
			clearTimeout(this.searching);
			this.searching = this._delay(function () {

				// Search if the value has changed, or if the user retypes the same value (see #7434)
				var equalValues = this.term === this._value(),
					menuVisible = this.menu.element.is(":visible"),
					modifierKey = event.altKey || event.ctrlKey || event.metaKey || event.shiftKey;

				if (!equalValues || (equalValues && !menuVisible && !modifierKey)) {
					this.selectedItem = null;
					this.search(null, event);
				}
			}, this.options.delay);
		},

		search: function (value, event) {
			value = value != null ? value : this._value();

			// Always save the actual value, not the one passed as an argument
			this.term = this._value();

			if (value.length < this.options.minLength) {
				return this.close(event);
			}

			if (this._trigger("search", event) === false) {
				return;
			}

			return this._search(value);
		},

		_search: function (value) {
			this.pending++;
			this._addClass("ui-autocomplete-loading");
			this.cancelSearch = false;

			this.source({term: value}, this._response());
		},

		_response: function () {
			var index = ++this.requestIndex;

			return $.proxy(function (content) {
				if (index === this.requestIndex) {
					this.__response(content);
				}

				this.pending--;
				if (!this.pending) {
					this._removeClass("ui-autocomplete-loading");
				}
			}, this);
		},

		__response: function (content) {
			if (content) {
				content = this._normalize(content);
			}
			this._trigger("response", null, {content: content});
			if (!this.options.disabled && content && content.length && !this.cancelSearch) {
				this._suggest(content);
				this._trigger("open");
			} else {

				// use ._close() instead of .close() so we don't cancel future searches
				this._close();
			}
		},

		close: function (event) {
			this.cancelSearch = true;
			this._close(event);
		},

		_close: function (event) {

			// Remove the handler that closes the menu on outside clicks
			this._off(this.document, "mousedown");

			if (this.menu.element.is(":visible")) {
				this.menu.element.hide();
				this.menu.blur();
				this.isNewMenu = true;
				this._trigger("close", event);
			}
		},

		_change: function (event) {
			if (this.previous !== this._value()) {
				this._trigger("change", event, {item: this.selectedItem});
			}
		},

		_normalize: function (items) {

			// assume all items have the right format when the first item is complete
			if (items.length && items[0].label && items[0].value) {
				return items;
			}
			return $.map(items, function (item) {
				if (typeof item === "string") {
					return {
						label: item,
						value: item
					};
				}
				return $.extend({}, item, {
					label: item.label || item.value,
					value: item.value || item.label
				});
			});
		},

		_suggest: function (items) {
			var ul = this.menu.element.empty();
			this._renderMenu(ul, items);
			this.isNewMenu = true;
			this.menu.refresh();

			// Size and position menu
			ul.show();
			this._resizeMenu();
			ul.position($.extend({
				of: this.element
			}, this.options.position));

			if (this.options.autoFocus) {
				this.menu.next();
			}

			// Listen for interactions outside of the widget (#6642)
			this._on(this.document, {
				mousedown: "_closeOnClickOutside"
			});
		},

		_resizeMenu: function () {
			var ul = this.menu.element;
			ul.outerWidth(Math.max(
				// Firefox wraps long text (possibly a rounding bug)
				// so we add 1px to avoid the wrapping (#7513)
				ul.width("").outerWidth() + 1,
				this.element.outerWidth()
			));
		},

		_renderMenu: function (ul, items) {
			var that = this;
			$.each(items, function (index, item) {
				that._renderItemData(ul, item);
			});
		},

		_renderItemData: function (ul, item) {
			return this._renderItem(ul, item).data("ui-autocomplete-item", item);
		},

		_renderItem: function (ul, item) {
			return $("<li>")
				.append($("<div>").text(item.label))
				.appendTo(ul);
		},

		_move: function (direction, event) {
			if (!this.menu.element.is(":visible")) {
				this.search(null, event);
				return;
			}
			if (this.menu.isFirstItem() && /^previous/.test(direction) ||
				this.menu.isLastItem() && /^next/.test(direction)) {

				if (!this.isMultiLine) {
					this._value(this.term);
				}

				this.menu.blur();
				return;
			}
			this.menu[direction](event);
		},

		widget: function () {
			return this.menu.element;
		},

		_value: function () {
			return this.valueMethod.apply(this.element, arguments);
		},

		_keyEvent: function (keyEvent, event) {
			if (!this.isMultiLine || this.menu.element.is(":visible")) {
				this._move(keyEvent, event);

				// Prevents moving cursor to beginning/end of the text field in some browsers
				event.preventDefault();
			}
		},

		// Support: Chrome <=50
		// We should be able to just use this.element.prop( "isContentEditable" )
		// but hidden elements always report false in Chrome.
		// https://code.google.com/p/chromium/issues/detail?id=313082
		_isContentEditable: function (element) {
			if (!element.length) {
				return false;
			}

			var editable = element.prop("contentEditable");

			if (editable === "inherit") {
				return this._isContentEditable(element.parent());
			}

			return editable === "true";
		}
	});

	$.extend($.ui.autocomplete, {
		escapeRegex: function (value) {
			return value.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&");
		},
		filter: function (array, term) {
			var matcher = new RegExp($.ui.autocomplete.escapeRegex(term), "i");
			return $.grep(array, function (value) {
				return matcher.test(value.label || value.value || value);
			});
		}
	});

// Live region extension, adding a `messages` option
// NOTE: This is an experimental API. We are still investigating
// a full solution for string manipulation and internationalization.
	$.widget("ui.autocomplete", $.ui.autocomplete, {
		options: {
			messages: {
				noResults: "No search results.",
				results: function (amount) {
					return amount + (amount > 1 ? " results are" : " result is") +
						" available, use up and down arrow keys to navigate.";
				}
			}
		},

		__response: function (content) {
			var message;
			this._superApply(arguments);
			if (this.options.disabled || this.cancelSearch) {
				return;
			}
			if (content && content.length) {
				message = this.options.messages.results(content.length);
			} else {
				message = this.options.messages.noResults;
			}
			this.liveRegion.children().hide();
			$("<div>").text(message).appendTo(this.liveRegion);
		}
	});

	var widgetsAutocomplete = $.ui.autocomplete;


// jscs:disable maximumLineLength
	/* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
	/*!
 * jQuery UI Datepicker 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Datepicker
//>>group: Widgets
//>>description: Displays a calendar from an input or inline for selecting dates.
//>>docs: http://api.jqueryui.com/datepicker/
//>>demos: http://jqueryui.com/datepicker/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/datepicker.css
//>>css.theme: ../../themes/base/theme.css


	$.extend($.ui, {datepicker: {version: "1.12.1"}});

	var datepicker_instActive;

	function datepicker_getZindex(elem) {
		var position, value;
		while (elem.length && elem[0] !== document) {

			// Ignore z-index if position is set to a value where z-index is ignored by the browser
			// This makes behavior of this function consistent across browsers
			// WebKit always returns auto if the element is positioned
			position = elem.css("position");
			if (position === "absolute" || position === "relative" || position === "fixed") {

				// IE returns 0 when zIndex is not specified
				// other browsers return a string
				// we ignore the case of nested elements with an explicit value of 0
				// <div style="z-index: -10;"><div style="z-index: 0;"></div></div>
				value = parseInt(elem.css("zIndex"), 10);
				if (!isNaN(value) && value !== 0) {
					return value;
				}
			}
			elem = elem.parent();
		}

		return 0;
	}

	/* Date picker manager.
   Use the singleton instance of this class, $.datepicker, to interact with the date picker.
   Settings for (groups of) date pickers are maintained in an instance object,
   allowing multiple different settings on the same page. */

	function Datepicker() {
		this._curInst = null; // The current instance in use
		this._keyEvent = false; // If the last event was a key event
		this._disabledInputs = []; // List of date picker inputs that have been disabled
		this._datepickerShowing = false; // True if the popup picker is showing , false if not
		this._inDialog = false; // True if showing within a "dialog", false if not
		this._mainDivId = "ui-datepicker-div"; // The ID of the main datepicker division
		this._inlineClass = "ui-datepicker-inline"; // The name of the inline marker class
		this._appendClass = "ui-datepicker-append"; // The name of the append marker class
		this._triggerClass = "ui-datepicker-trigger"; // The name of the trigger marker class
		this._dialogClass = "ui-datepicker-dialog"; // The name of the dialog marker class
		this._disableClass = "ui-datepicker-disabled"; // The name of the disabled covering marker class
		this._unselectableClass = "ui-datepicker-unselectable"; // The name of the unselectable cell marker class
		this._currentClass = "ui-datepicker-current-day"; // The name of the current day marker class
		this._dayOverClass = "ui-datepicker-days-cell-over"; // The name of the day hover marker class
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[""] = { // Default regional settings
			closeText: "Done", // Display text for close link
			prevText: "Prev", // Display text for previous month link
			nextText: "Next", // Display text for next month link
			currentText: "Today", // Display text for current month link
			monthNames: ["January", "February", "March", "April", "May", "June",
				"July", "August", "September", "October", "November", "December"], // Names of months for drop-down and formatting
			monthNamesShort: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"], // For formatting
			dayNames: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"], // For formatting
			dayNamesShort: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"], // For formatting
			dayNamesMin: ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"], // Column headings for days starting at Sunday
			weekHeader: "Wk", // Column header for week of the year
			dateFormat: "mm/dd/yy", // See format options on parseDate
			firstDay: 0, // The first day of the week, Sun = 0, Mon = 1, ...
			isRTL: false, // True if right-to-left language, false if left-to-right
			showMonthAfterYear: false, // True if the year select precedes month, false for month then year
			yearSuffix: "" // Additional text to append to the year in the month headers
		};
		this._defaults = { // Global defaults for all the date picker instances
			showOn: "focus", // "focus" for popup on focus,
			// "button" for trigger button, or "both" for either
			showAnim: "fadeIn", // Name of jQuery animation for popup
			showOptions: {}, // Options for enhanced animations
			defaultDate: null, // Used when field is blank: actual date,
			// +/-number for offset from today, null for today
			appendText: "", // Display text following the input box, e.g. showing the format
			buttonText: "...", // Text for trigger button
			buttonImage: "", // URL for trigger button image
			buttonImageOnly: false, // True if the image appears alone, false if it appears on a button
			hideIfNoPrevNext: false, // True to hide next/previous month links
			// if not applicable, false to just disable them
			navigationAsDateFormat: false, // True if date formatting applied to prev/today/next links
			gotoCurrent: false, // True if today link goes back to current selection instead
			changeMonth: false, // True if month can be selected directly, false if only prev/next
			changeYear: false, // True if year can be selected directly, false if only prev/next
			yearRange: "c-10:c+10", // Range of years to display in drop-down,
			// either relative to today's year (-nn:+nn), relative to currently displayed year
			// (c-nn:c+nn), absolute (nnnn:nnnn), or a combination of the above (nnnn:-n)
			showOtherMonths: false, // True to show dates in other months, false to leave blank
			selectOtherMonths: false, // True to allow selection of dates in other months, false for unselectable
			showWeek: false, // True to show week of the year, false to not show it
			calculateWeek: this.iso8601Week, // How to calculate the week of the year,
			// takes a Date and returns the number of the week for it
			shortYearCutoff: "+10", // Short year values < this are in the current century,
			// > this are in the previous century,
			// string value starting with "+" for current year + value
			minDate: null, // The earliest selectable date, or null for no limit
			maxDate: null, // The latest selectable date, or null for no limit
			duration: "fast", // Duration of display/closure
			beforeShowDay: null, // Function that takes a date and returns an array with
			// [0] = true if selectable, false if not, [1] = custom CSS class name(s) or "",
			// [2] = cell title (optional), e.g. $.datepicker.noWeekends
			beforeShow: null, // Function that takes an input field and
			// returns a set of custom settings for the date picker
			onSelect: null, // Define a callback function when a date is selected
			onChangeMonthYear: null, // Define a callback function when the month or year is changed
			onClose: null, // Define a callback function when the datepicker is closed
			numberOfMonths: 1, // Number of months to show at a time
			showCurrentAtPos: 0, // The position in multipe months at which to show the current month (starting at 0)
			stepMonths: 1, // Number of months to step back/forward
			stepBigMonths: 12, // Number of months to step back/forward for the big links
			altField: "", // Selector for an alternate field to store selected dates into
			altFormat: "", // The date format to use for the alternate field
			constrainInput: true, // The input is constrained by the current date format
			showButtonPanel: false, // True to show button panel, false to not show it
			autoSize: false, // True to size the input for the date format, false to leave as is
			disabled: false // The initial disabled state
		};
		$.extend(this._defaults, this.regional[""]);
		this.regional.en = $.extend(true, {}, this.regional[""]);
		this.regional["en-US"] = $.extend(true, {}, this.regional.en);
		this.dpDiv = datepicker_bindHover($("<div id='" + this._mainDivId + "' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"));
	}

	$.extend(Datepicker.prototype, {
		/* Class name added to elements to indicate already configured with a date picker. */
		markerClassName: "hasDatepicker",

		//Keep track of the maximum number of rows displayed (see #7043)
		maxRows: 4,

		// TODO rename to "widget" when switching to widget factory
		_widgetDatepicker: function () {
			return this.dpDiv;
		},

		/* Override the default settings for all instances of the date picker.
	 * @param  settings  object - the new settings to use as defaults (anonymous object)
	 * @return the manager object
	 */
		setDefaults: function (settings) {
			datepicker_extendRemove(this._defaults, settings || {});
			return this;
		},

		/* Attach the date picker to a jQuery selection.
	 * @param  target	element - the target input field or division or span
	 * @param  settings  object - the new settings to use for this date picker instance (anonymous)
	 */
		_attachDatepicker: function (target, settings) {
			var nodeName, inline, inst;
			nodeName = target.nodeName.toLowerCase();
			inline = (nodeName === "div" || nodeName === "span");
			if (!target.id) {
				this.uuid += 1;
				target.id = "dp" + this.uuid;
			}
			inst = this._newInst($(target), inline);
			inst.settings = $.extend({}, settings || {});
			if (nodeName === "input") {
				this._connectDatepicker(target, inst);
			} else if (inline) {
				this._inlineDatepicker(target, inst);
			}
		},

		/* Create a new instance object. */
		_newInst: function (target, inline) {
			var id = target[0].id.replace(/([^A-Za-z0-9_\-])/g, "\\\\$1"); // escape jQuery meta chars
			return {
				id: id, input: target, // associated target
				selectedDay: 0, selectedMonth: 0, selectedYear: 0, // current selection
				drawMonth: 0, drawYear: 0, // month being drawn
				inline: inline, // is datepicker inline or not
				dpDiv: (!inline ? this.dpDiv : // presentation div
					datepicker_bindHover($("<div class='" + this._inlineClass + " ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")))
			};
		},

		/* Attach the date picker to an input field. */
		_connectDatepicker: function (target, inst) {
			var input = $(target);
			inst.append = $([]);
			inst.trigger = $([]);
			if (input.hasClass(this.markerClassName)) {
				return;
			}
			this._attachments(input, inst);
			input.addClass(this.markerClassName).on("keydown", this._doKeyDown).on("keypress", this._doKeyPress).on("keyup", this._doKeyUp);
			this._autoSize(inst);
			$.data(target, "datepicker", inst);

			//If disabled option is true, disable the datepicker once it has been attached to the input (see ticket #5665)
			if (inst.settings.disabled) {
				this._disableDatepicker(target);
			}
		},

		/* Make attachments based on settings. */
		_attachments: function (input, inst) {
			var showOn, buttonText, buttonImage,
				appendText = this._get(inst, "appendText"),
				isRTL = this._get(inst, "isRTL");

			if (inst.append) {
				inst.append.remove();
			}
			if (appendText) {
				inst.append = $("<span class='" + this._appendClass + "'>" + appendText + "</span>");
				input[isRTL ? "before" : "after"](inst.append);
			}

			input.off("focus", this._showDatepicker);

			if (inst.trigger) {
				inst.trigger.remove();
			}

			showOn = this._get(inst, "showOn");
			if (showOn === "focus" || showOn === "both") { // pop-up date picker when in the marked field
				input.on("focus", this._showDatepicker);
			}
			if (showOn === "button" || showOn === "both") { // pop-up date picker when button clicked
				buttonText = this._get(inst, "buttonText");
				buttonImage = this._get(inst, "buttonImage");
				inst.trigger = $(this._get(inst, "buttonImageOnly") ?
					$("<img/>").addClass(this._triggerClass).attr({
						src: buttonImage,
						alt: buttonText,
						title: buttonText
					}) :
					$("<button type='button'></button>").addClass(this._triggerClass).html(!buttonImage ? buttonText : $("<img/>").attr(
						{src: buttonImage, alt: buttonText, title: buttonText})));
				input[isRTL ? "before" : "after"](inst.trigger);
				inst.trigger.on("click", function () {
					if ($.datepicker._datepickerShowing && $.datepicker._lastInput === input[0]) {
						$.datepicker._hideDatepicker();
					} else if ($.datepicker._datepickerShowing && $.datepicker._lastInput !== input[0]) {
						$.datepicker._hideDatepicker();
						$.datepicker._showDatepicker(input[0]);
					} else {
						$.datepicker._showDatepicker(input[0]);
					}
					return false;
				});
			}
		},

		/* Apply the maximum length for the date format. */
		_autoSize: function (inst) {
			if (this._get(inst, "autoSize") && !inst.inline) {
				var findMax, max, maxI, i,
					date = new Date(2009, 12 - 1, 20), // Ensure double digits
					dateFormat = this._get(inst, "dateFormat");

				if (dateFormat.match(/[DM]/)) {
					findMax = function (names) {
						max = 0;
						maxI = 0;
						for (i = 0; i < names.length; i++) {
							if (names[i].length > max) {
								max = names[i].length;
								maxI = i;
							}
						}
						return maxI;
					};
					date.setMonth(findMax(this._get(inst, (dateFormat.match(/MM/) ?
						"monthNames" : "monthNamesShort"))));
					date.setDate(findMax(this._get(inst, (dateFormat.match(/DD/) ?
						"dayNames" : "dayNamesShort"))) + 20 - date.getDay());
				}
				inst.input.attr("size", this._formatDate(inst, date).length);
			}
		},

		/* Attach an inline date picker to a div. */
		_inlineDatepicker: function (target, inst) {
			var divSpan = $(target);
			if (divSpan.hasClass(this.markerClassName)) {
				return;
			}
			divSpan.addClass(this.markerClassName).append(inst.dpDiv);
			$.data(target, "datepicker", inst);
			this._setDate(inst, this._getDefaultDate(inst), true);
			this._updateDatepicker(inst);
			this._updateAlternate(inst);

			//If disabled option is true, disable the datepicker before showing it (see ticket #5665)
			if (inst.settings.disabled) {
				this._disableDatepicker(target);
			}

			// Set display:block in place of inst.dpDiv.show() which won't work on disconnected elements
			// http://bugs.jqueryui.com/ticket/7552 - A Datepicker created on a detached div has zero height
			inst.dpDiv.css("display", "block");
		},

		/* Pop-up the date picker in a "dialog" box.
	 * @param  input element - ignored
	 * @param  date	string or Date - the initial date to display
	 * @param  onSelect  function - the function to call when a date is selected
	 * @param  settings  object - update the dialog date picker instance's settings (anonymous object)
	 * @param  pos int[2] - coordinates for the dialog's position within the screen or
	 *					event - with x/y coordinates or
	 *					leave empty for default (screen centre)
	 * @return the manager object
	 */
		_dialogDatepicker: function (input, date, onSelect, settings, pos) {
			var id, browserWidth, browserHeight, scrollX, scrollY,
				inst = this._dialogInst; // internal instance

			if (!inst) {
				this.uuid += 1;
				id = "dp" + this.uuid;
				this._dialogInput = $("<input type='text' id='" + id +
					"' style='position: absolute; top: -100px; width: 0px;'/>");
				this._dialogInput.on("keydown", this._doKeyDown);
				$("body").append(this._dialogInput);
				inst = this._dialogInst = this._newInst(this._dialogInput, false);
				inst.settings = {};
				$.data(this._dialogInput[0], "datepicker", inst);
			}
			datepicker_extendRemove(inst.settings, settings || {});
			date = (date && date.constructor === Date ? this._formatDate(inst, date) : date);
			this._dialogInput.val(date);

			this._pos = (pos ? (pos.length ? pos : [pos.pageX, pos.pageY]) : null);
			if (!this._pos) {
				browserWidth = document.documentElement.clientWidth;
				browserHeight = document.documentElement.clientHeight;
				scrollX = document.documentElement.scrollLeft || document.body.scrollLeft;
				scrollY = document.documentElement.scrollTop || document.body.scrollTop;
				this._pos = // should use actual width/height below
					[(browserWidth / 2) - 100 + scrollX, (browserHeight / 2) - 150 + scrollY];
			}

			// Move input on screen for focus, but hidden behind dialog
			this._dialogInput.css("left", (this._pos[0] + 20) + "px").css("top", this._pos[1] + "px");
			inst.settings.onSelect = onSelect;
			this._inDialog = true;
			this.dpDiv.addClass(this._dialogClass);
			this._showDatepicker(this._dialogInput[0]);
			if ($.blockUI) {
				$.blockUI(this.dpDiv);
			}
			$.data(this._dialogInput[0], "datepicker", inst);
			return this;
		},

		/* Detach a datepicker from its control.
	 * @param  target	element - the target input field or division or span
	 */
		_destroyDatepicker: function (target) {
			var nodeName,
				$target = $(target),
				inst = $.data(target, "datepicker");

			if (!$target.hasClass(this.markerClassName)) {
				return;
			}

			nodeName = target.nodeName.toLowerCase();
			$.removeData(target, "datepicker");
			if (nodeName === "input") {
				inst.append.remove();
				inst.trigger.remove();
				$target.removeClass(this.markerClassName).off("focus", this._showDatepicker).off("keydown", this._doKeyDown).off("keypress", this._doKeyPress).off("keyup", this._doKeyUp);
			} else if (nodeName === "div" || nodeName === "span") {
				$target.removeClass(this.markerClassName).empty();
			}

			if (datepicker_instActive === inst) {
				datepicker_instActive = null;
			}
		},

		/* Enable the date picker to a jQuery selection.
	 * @param  target	element - the target input field or division or span
	 */
		_enableDatepicker: function (target) {
			var nodeName, inline,
				$target = $(target),
				inst = $.data(target, "datepicker");

			if (!$target.hasClass(this.markerClassName)) {
				return;
			}

			nodeName = target.nodeName.toLowerCase();
			if (nodeName === "input") {
				target.disabled = false;
				inst.trigger.filter("button").each(function () {
					this.disabled = false;
				}).end().filter("img").css({opacity: "1.0", cursor: ""});
			} else if (nodeName === "div" || nodeName === "span") {
				inline = $target.children("." + this._inlineClass);
				inline.children().removeClass("ui-state-disabled");
				inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled", false);
			}
			this._disabledInputs = $.map(this._disabledInputs,
				function (value) {
					return (value === target ? null : value);
				}); // delete entry
		},

		/* Disable the date picker to a jQuery selection.
	 * @param  target	element - the target input field or division or span
	 */
		_disableDatepicker: function (target) {
			var nodeName, inline,
				$target = $(target),
				inst = $.data(target, "datepicker");

			if (!$target.hasClass(this.markerClassName)) {
				return;
			}

			nodeName = target.nodeName.toLowerCase();
			if (nodeName === "input") {
				target.disabled = true;
				inst.trigger.filter("button").each(function () {
					this.disabled = true;
				}).end().filter("img").css({opacity: "0.5", cursor: "default"});
			} else if (nodeName === "div" || nodeName === "span") {
				inline = $target.children("." + this._inlineClass);
				inline.children().addClass("ui-state-disabled");
				inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled", true);
			}
			this._disabledInputs = $.map(this._disabledInputs,
				function (value) {
					return (value === target ? null : value);
				}); // delete entry
			this._disabledInputs[this._disabledInputs.length] = target;
		},

		/* Is the first field in a jQuery collection disabled as a datepicker?
	 * @param  target	element - the target input field or division or span
	 * @return boolean - true if disabled, false if enabled
	 */
		_isDisabledDatepicker: function (target) {
			if (!target) {
				return false;
			}
			for (var i = 0; i < this._disabledInputs.length; i++) {
				if (this._disabledInputs[i] === target) {
					return true;
				}
			}
			return false;
		},

		/* Retrieve the instance data for the target control.
	 * @param  target  element - the target input field or division or span
	 * @return  object - the associated instance data
	 * @throws  error if a jQuery problem getting data
	 */
		_getInst: function (target) {
			try {
				return $.data(target, "datepicker");
			}
			catch (err) {
				throw "Missing instance data for this datepicker";
			}
		},

		/* Update or retrieve the settings for a date picker attached to an input field or division.
	 * @param  target  element - the target input field or division or span
	 * @param  name	object - the new settings to update or
	 *				string - the name of the setting to change or retrieve,
	 *				when retrieving also "all" for all instance settings or
	 *				"defaults" for all global defaults
	 * @param  value   any - the new value for the setting
	 *				(omit if above is an object or to retrieve a value)
	 */
		_optionDatepicker: function (target, name, value) {
			var settings, date, minDate, maxDate,
				inst = this._getInst(target);

			if (arguments.length === 2 && typeof name === "string") {
				return (name === "defaults" ? $.extend({}, $.datepicker._defaults) :
					(inst ? (name === "all" ? $.extend({}, inst.settings) :
						this._get(inst, name)) : null));
			}

			settings = name || {};
			if (typeof name === "string") {
				settings = {};
				settings[name] = value;
			}

			if (inst) {
				if (this._curInst === inst) {
					this._hideDatepicker();
				}

				date = this._getDateDatepicker(target, true);
				minDate = this._getMinMaxDate(inst, "min");
				maxDate = this._getMinMaxDate(inst, "max");
				datepicker_extendRemove(inst.settings, settings);

				// reformat the old minDate/maxDate values if dateFormat changes and a new minDate/maxDate isn't provided
				if (minDate !== null && settings.dateFormat !== undefined && settings.minDate === undefined) {
					inst.settings.minDate = this._formatDate(inst, minDate);
				}
				if (maxDate !== null && settings.dateFormat !== undefined && settings.maxDate === undefined) {
					inst.settings.maxDate = this._formatDate(inst, maxDate);
				}
				if ("disabled" in settings) {
					if (settings.disabled) {
						this._disableDatepicker(target);
					} else {
						this._enableDatepicker(target);
					}
				}
				this._attachments($(target), inst);
				this._autoSize(inst);
				this._setDate(inst, date);
				this._updateAlternate(inst);
				this._updateDatepicker(inst);
			}
		},

		// Change method deprecated
		_changeDatepicker: function (target, name, value) {
			this._optionDatepicker(target, name, value);
		},

		/* Redraw the date picker attached to an input field or division.
	 * @param  target  element - the target input field or division or span
	 */
		_refreshDatepicker: function (target) {
			var inst = this._getInst(target);
			if (inst) {
				this._updateDatepicker(inst);
			}
		},

		/* Set the dates for a jQuery selection.
	 * @param  target element - the target input field or division or span
	 * @param  date	Date - the new date
	 */
		_setDateDatepicker: function (target, date) {
			var inst = this._getInst(target);
			if (inst) {
				this._setDate(inst, date);
				this._updateDatepicker(inst);
				this._updateAlternate(inst);
			}
		},

		/* Get the date(s) for the first entry in a jQuery selection.
	 * @param  target element - the target input field or division or span
	 * @param  noDefault boolean - true if no default date is to be used
	 * @return Date - the current date
	 */
		_getDateDatepicker: function (target, noDefault) {
			var inst = this._getInst(target);
			if (inst && !inst.inline) {
				this._setDateFromField(inst, noDefault);
			}
			return (inst ? this._getDate(inst) : null);
		},

		/* Handle keystrokes. */
		_doKeyDown: function (event) {
			var onSelect, dateStr, sel,
				inst = $.datepicker._getInst(event.target),
				handled = true,
				isRTL = inst.dpDiv.is(".ui-datepicker-rtl");

			inst._keyEvent = true;
			if ($.datepicker._datepickerShowing) {
				switch (event.keyCode) {
					case 9:
						$.datepicker._hideDatepicker();
						handled = false;
						break; // hide on tab out
					case 13:
						sel = $("td." + $.datepicker._dayOverClass + ":not(." +
							$.datepicker._currentClass + ")", inst.dpDiv);
						if (sel[0]) {
							$.datepicker._selectDay(event.target, inst.selectedMonth, inst.selectedYear, sel[0]);
						}

						onSelect = $.datepicker._get(inst, "onSelect");
						if (onSelect) {
							dateStr = $.datepicker._formatDate(inst);

							// Trigger custom callback
							onSelect.apply((inst.input ? inst.input[0] : null), [dateStr, inst]);
						} else {
							$.datepicker._hideDatepicker();
						}

						return false; // don't submit the form
					case 27:
						$.datepicker._hideDatepicker();
						break; // hide on escape
					case 33:
						$.datepicker._adjustDate(event.target, (event.ctrlKey ?
							-$.datepicker._get(inst, "stepBigMonths") :
							-$.datepicker._get(inst, "stepMonths")), "M");
						break; // previous month/year on page up/+ ctrl
					case 34:
						$.datepicker._adjustDate(event.target, (event.ctrlKey ?
							+$.datepicker._get(inst, "stepBigMonths") :
							+$.datepicker._get(inst, "stepMonths")), "M");
						break; // next month/year on page down/+ ctrl
					case 35:
						if (event.ctrlKey || event.metaKey) {
							$.datepicker._clearDate(event.target);
						}
						handled = event.ctrlKey || event.metaKey;
						break; // clear on ctrl or command +end
					case 36:
						if (event.ctrlKey || event.metaKey) {
							$.datepicker._gotoToday(event.target);
						}
						handled = event.ctrlKey || event.metaKey;
						break; // current on ctrl or command +home
					case 37:
						if (event.ctrlKey || event.metaKey) {
							$.datepicker._adjustDate(event.target, (isRTL ? +1 : -1), "D");
						}
						handled = event.ctrlKey || event.metaKey;

						// -1 day on ctrl or command +left
						if (event.originalEvent.altKey) {
							$.datepicker._adjustDate(event.target, (event.ctrlKey ?
								-$.datepicker._get(inst, "stepBigMonths") :
								-$.datepicker._get(inst, "stepMonths")), "M");
						}

						// next month/year on alt +left on Mac
						break;
					case 38:
						if (event.ctrlKey || event.metaKey) {
							$.datepicker._adjustDate(event.target, -7, "D");
						}
						handled = event.ctrlKey || event.metaKey;
						break; // -1 week on ctrl or command +up
					case 39:
						if (event.ctrlKey || event.metaKey) {
							$.datepicker._adjustDate(event.target, (isRTL ? -1 : +1), "D");
						}
						handled = event.ctrlKey || event.metaKey;

						// +1 day on ctrl or command +right
						if (event.originalEvent.altKey) {
							$.datepicker._adjustDate(event.target, (event.ctrlKey ?
								+$.datepicker._get(inst, "stepBigMonths") :
								+$.datepicker._get(inst, "stepMonths")), "M");
						}

						// next month/year on alt +right
						break;
					case 40:
						if (event.ctrlKey || event.metaKey) {
							$.datepicker._adjustDate(event.target, +7, "D");
						}
						handled = event.ctrlKey || event.metaKey;
						break; // +1 week on ctrl or command +down
					default:
						handled = false;
				}
			} else if (event.keyCode === 36 && event.ctrlKey) { // display the date picker on ctrl+home
				$.datepicker._showDatepicker(this);
			} else {
				handled = false;
			}

			if (handled) {
				event.preventDefault();
				event.stopPropagation();
			}
		},

		/* Filter entered characters - based on date format. */
		_doKeyPress: function (event) {
			var chars, chr,
				inst = $.datepicker._getInst(event.target);

			if ($.datepicker._get(inst, "constrainInput")) {
				chars = $.datepicker._possibleChars($.datepicker._get(inst, "dateFormat"));
				chr = String.fromCharCode(event.charCode == null ? event.keyCode : event.charCode);
				return event.ctrlKey || event.metaKey || (chr < " " || !chars || chars.indexOf(chr) > -1);
			}
		},

		/* Synchronise manual entry and field/alternate field. */
		_doKeyUp: function (event) {
			var date,
				inst = $.datepicker._getInst(event.target);

			if (inst.input.val() !== inst.lastVal) {
				try {
					date = $.datepicker.parseDate($.datepicker._get(inst, "dateFormat"),
						(inst.input ? inst.input.val() : null),
						$.datepicker._getFormatConfig(inst));

					if (date) { // only if valid
						$.datepicker._setDateFromField(inst);
						$.datepicker._updateAlternate(inst);
						$.datepicker._updateDatepicker(inst);
					}
				}
				catch (err) {
				}
			}
			return true;
		},

		/* Pop-up the date picker for a given input field.
	 * If false returned from beforeShow event handler do not show.
	 * @param  input  element - the input field attached to the date picker or
	 *					event - if triggered by focus
	 */
		_showDatepicker: function (input) {
			input = input.target || input;
			if (input.nodeName.toLowerCase() !== "input") { // find from button/image trigger
				input = $("input", input.parentNode)[0];
			}

			if ($.datepicker._isDisabledDatepicker(input) || $.datepicker._lastInput === input) { // already here
				return;
			}

			var inst, beforeShow, beforeShowSettings, isFixed,
				offset, showAnim, duration;

			inst = $.datepicker._getInst(input);
			if ($.datepicker._curInst && $.datepicker._curInst !== inst) {
				$.datepicker._curInst.dpDiv.stop(true, true);
				if (inst && $.datepicker._datepickerShowing) {
					$.datepicker._hideDatepicker($.datepicker._curInst.input[0]);
				}
			}

			beforeShow = $.datepicker._get(inst, "beforeShow");
			beforeShowSettings = beforeShow ? beforeShow.apply(input, [input, inst]) : {};
			if (beforeShowSettings === false) {
				return;
			}
			datepicker_extendRemove(inst.settings, beforeShowSettings);

			inst.lastVal = null;
			$.datepicker._lastInput = input;
			$.datepicker._setDateFromField(inst);

			if ($.datepicker._inDialog) { // hide cursor
				input.value = "";
			}
			if (!$.datepicker._pos) { // position below input
				$.datepicker._pos = $.datepicker._findPos(input);
				$.datepicker._pos[1] += input.offsetHeight; // add the height
			}

			isFixed = false;
			$(input).parents().each(function () {
				isFixed |= $(this).css("position") === "fixed";
				return !isFixed;
			});

			offset = {left: $.datepicker._pos[0], top: $.datepicker._pos[1]};
			$.datepicker._pos = null;

			//to avoid flashes on Firefox
			inst.dpDiv.empty();

			// determine sizing offscreen
			inst.dpDiv.css({position: "absolute", display: "block", top: "-1000px"});
			$.datepicker._updateDatepicker(inst);

			// fix width for dynamic number of date pickers
			// and adjust position before showing
			offset = $.datepicker._checkOffset(inst, offset, isFixed);
			inst.dpDiv.css({
				position: ($.datepicker._inDialog && $.blockUI ?
					"static" : (isFixed ? "fixed" : "absolute")), display: "none",
				left: offset.left + "px", top: offset.top + "px"
			});

			if (!inst.inline) {
				showAnim = $.datepicker._get(inst, "showAnim");
				duration = $.datepicker._get(inst, "duration");
				inst.dpDiv.css("z-index", datepicker_getZindex($(input)) + 1);
				$.datepicker._datepickerShowing = true;

				if ($.effects && $.effects.effect[showAnim]) {
					inst.dpDiv.show(showAnim, $.datepicker._get(inst, "showOptions"), duration);
				} else {
					inst.dpDiv[showAnim || "show"](showAnim ? duration : null);
				}

				if ($.datepicker._shouldFocusInput(inst)) {
					inst.input.trigger("focus");
				}

				$.datepicker._curInst = inst;
			}
		},

		/* Generate the date picker content. */
		_updateDatepicker: function (inst) {
			this.maxRows = 4; //Reset the max number of rows being displayed (see #7043)
			datepicker_instActive = inst; // for delegate hover events
			inst.dpDiv.empty().append(this._generateHTML(inst));
			this._attachHandlers(inst);

			var origyearshtml,
				numMonths = this._getNumberOfMonths(inst),
				cols = numMonths[1],
				width = 17,
				activeCell = inst.dpDiv.find("." + this._dayOverClass + " a");

			if (activeCell.length > 0) {
				datepicker_handleMouseover.apply(activeCell.get(0));
			}

			inst.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");
			if (cols > 1) {
				inst.dpDiv.addClass("ui-datepicker-multi-" + cols).css("width", (width * cols) + "em");
			}
			inst.dpDiv[(numMonths[0] !== 1 || numMonths[1] !== 1 ? "add" : "remove") +
			"Class"]("ui-datepicker-multi");
			inst.dpDiv[(this._get(inst, "isRTL") ? "add" : "remove") +
			"Class"]("ui-datepicker-rtl");

			if (inst === $.datepicker._curInst && $.datepicker._datepickerShowing && $.datepicker._shouldFocusInput(inst)) {
				inst.input.trigger("focus");
			}

			// Deffered render of the years select (to avoid flashes on Firefox)
			if (inst.yearshtml) {
				origyearshtml = inst.yearshtml;
				setTimeout(function () {

					//assure that inst.yearshtml didn't change.
					if (origyearshtml === inst.yearshtml && inst.yearshtml) {
						inst.dpDiv.find("select.ui-datepicker-year:first").replaceWith(inst.yearshtml);
					}
					origyearshtml = inst.yearshtml = null;
				}, 0);
			}
		},

		// #6694 - don't focus the input if it's already focused
		// this breaks the change event in IE
		// Support: IE and jQuery <1.9
		_shouldFocusInput: function (inst) {
			return inst.input && inst.input.is(":visible") && !inst.input.is(":disabled") && !inst.input.is(":focus");
		},

		/* Check positioning to remain on screen. */
		_checkOffset: function (inst, offset, isFixed) {
			var dpWidth = inst.dpDiv.outerWidth(),
				dpHeight = inst.dpDiv.outerHeight(),
				inputWidth = inst.input ? inst.input.outerWidth() : 0,
				inputHeight = inst.input ? inst.input.outerHeight() : 0,
				viewWidth = document.documentElement.clientWidth + (isFixed ? 0 : $(document).scrollLeft()),
				viewHeight = document.documentElement.clientHeight + (isFixed ? 0 : $(document).scrollTop());

			offset.left -= (this._get(inst, "isRTL") ? (dpWidth - inputWidth) : 0);
			offset.left -= (isFixed && offset.left === inst.input.offset().left) ? $(document).scrollLeft() : 0;
			offset.top -= (isFixed && offset.top === (inst.input.offset().top + inputHeight)) ? $(document).scrollTop() : 0;

			// Now check if datepicker is showing outside window viewport - move to a better place if so.
			offset.left -= Math.min(offset.left, (offset.left + dpWidth > viewWidth && viewWidth > dpWidth) ?
				Math.abs(offset.left + dpWidth - viewWidth) : 0);
			offset.top -= Math.min(offset.top, (offset.top + dpHeight > viewHeight && viewHeight > dpHeight) ?
				Math.abs(dpHeight + inputHeight) : 0);

			return offset;
		},

		/* Find an object's position on the screen. */
		_findPos: function (obj) {
			var position,
				inst = this._getInst(obj),
				isRTL = this._get(inst, "isRTL");

			while (obj && (obj.type === "hidden" || obj.nodeType !== 1 || $.expr.filters.hidden(obj))) {
				obj = obj[isRTL ? "previousSibling" : "nextSibling"];
			}

			position = $(obj).offset();
			return [position.left, position.top];
		},

		/* Hide the date picker from view.
	 * @param  input  element - the input field attached to the date picker
	 */
		_hideDatepicker: function (input) {
			var showAnim, duration, postProcess, onClose,
				inst = this._curInst;

			if (!inst || (input && inst !== $.data(input, "datepicker"))) {
				return;
			}

			if (this._datepickerShowing) {
				showAnim = this._get(inst, "showAnim");
				duration = this._get(inst, "duration");
				postProcess = function () {
					$.datepicker._tidyDialog(inst);
				};

				// DEPRECATED: after BC for 1.8.x $.effects[ showAnim ] is not needed
				if ($.effects && ($.effects.effect[showAnim] || $.effects[showAnim])) {
					inst.dpDiv.hide(showAnim, $.datepicker._get(inst, "showOptions"), duration, postProcess);
				} else {
					inst.dpDiv[(showAnim === "slideDown" ? "slideUp" :
						(showAnim === "fadeIn" ? "fadeOut" : "hide"))]((showAnim ? duration : null), postProcess);
				}

				if (!showAnim) {
					postProcess();
				}
				this._datepickerShowing = false;

				onClose = this._get(inst, "onClose");
				if (onClose) {
					onClose.apply((inst.input ? inst.input[0] : null), [(inst.input ? inst.input.val() : ""), inst]);
				}

				this._lastInput = null;
				if (this._inDialog) {
					this._dialogInput.css({position: "absolute", left: "0", top: "-100px"});
					if ($.blockUI) {
						$.unblockUI();
						$("body").append(this.dpDiv);
					}
				}
				this._inDialog = false;
			}
		},

		/* Tidy up after a dialog display. */
		_tidyDialog: function (inst) {
			inst.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar");
		},

		/* Close date picker if clicked elsewhere. */
		_checkExternalClick: function (event) {
			if (!$.datepicker._curInst) {
				return;
			}

			var $target = $(event.target),
				inst = $.datepicker._getInst($target[0]);

			if ((($target[0].id !== $.datepicker._mainDivId &&
					$target.parents("#" + $.datepicker._mainDivId).length === 0 &&
					!$target.hasClass($.datepicker.markerClassName) &&
					!$target.closest("." + $.datepicker._triggerClass).length &&
					$.datepicker._datepickerShowing && !($.datepicker._inDialog && $.blockUI))) ||
				($target.hasClass($.datepicker.markerClassName) && $.datepicker._curInst !== inst)) {
				$.datepicker._hideDatepicker();
			}
		},

		/* Adjust one of the date sub-fields. */
		_adjustDate: function (id, offset, period) {
			var target = $(id),
				inst = this._getInst(target[0]);

			if (this._isDisabledDatepicker(target[0])) {
				return;
			}
			this._adjustInstDate(inst, offset +
				(period === "M" ? this._get(inst, "showCurrentAtPos") : 0), // undo positioning
				period);
			this._updateDatepicker(inst);
		},

		/* Action for current link. */
		_gotoToday: function (id) {
			var date,
				target = $(id),
				inst = this._getInst(target[0]);

			if (this._get(inst, "gotoCurrent") && inst.currentDay) {
				inst.selectedDay = inst.currentDay;
				inst.drawMonth = inst.selectedMonth = inst.currentMonth;
				inst.drawYear = inst.selectedYear = inst.currentYear;
			} else {
				date = new Date();
				inst.selectedDay = date.getDate();
				inst.drawMonth = inst.selectedMonth = date.getMonth();
				inst.drawYear = inst.selectedYear = date.getFullYear();
			}
			this._notifyChange(inst);
			this._adjustDate(target);
		},

		/* Action for selecting a new month/year. */
		_selectMonthYear: function (id, select, period) {
			var target = $(id),
				inst = this._getInst(target[0]);

			inst["selected" + (period === "M" ? "Month" : "Year")] =
				inst["draw" + (period === "M" ? "Month" : "Year")] =
					parseInt(select.options[select.selectedIndex].value, 10);

			this._notifyChange(inst);
			this._adjustDate(target);
		},

		/* Action for selecting a day. */
		_selectDay: function (id, month, year, td) {
			var inst,
				target = $(id);

			if ($(td).hasClass(this._unselectableClass) || this._isDisabledDatepicker(target[0])) {
				return;
			}

			inst = this._getInst(target[0]);
			inst.selectedDay = inst.currentDay = $("a", td).html();
			inst.selectedMonth = inst.currentMonth = month;
			inst.selectedYear = inst.currentYear = year;
			this._selectDate(id, this._formatDate(inst,
				inst.currentDay, inst.currentMonth, inst.currentYear));
		},

		/* Erase the input field and hide the date picker. */
		_clearDate: function (id) {
			var target = $(id);
			this._selectDate(target, "");
		},

		/* Update the input field with the selected date. */
		_selectDate: function (id, dateStr) {
			var onSelect,
				target = $(id),
				inst = this._getInst(target[0]);

			dateStr = (dateStr != null ? dateStr : this._formatDate(inst));
			if (inst.input) {
				inst.input.val(dateStr);
			}
			this._updateAlternate(inst);

			onSelect = this._get(inst, "onSelect");
			if (onSelect) {
				onSelect.apply((inst.input ? inst.input[0] : null), [dateStr, inst]);  // trigger custom callback
			} else if (inst.input) {
				inst.input.trigger("change"); // fire the change event
			}

			if (inst.inline) {
				this._updateDatepicker(inst);
			} else {
				this._hideDatepicker();
				this._lastInput = inst.input[0];
				if (typeof(inst.input[0]) !== "object") {
					inst.input.trigger("focus"); // restore focus
				}
				this._lastInput = null;
			}
		},

		/* Update any alternate field to synchronise with the main field. */
		_updateAlternate: function (inst) {
			var altFormat, date, dateStr,
				altField = this._get(inst, "altField");

			if (altField) { // update alternate field too
				altFormat = this._get(inst, "altFormat") || this._get(inst, "dateFormat");
				date = this._getDate(inst);
				dateStr = this.formatDate(altFormat, date, this._getFormatConfig(inst));
				$(altField).val(dateStr);
			}
		},

		/* Set as beforeShowDay function to prevent selection of weekends.
	 * @param  date  Date - the date to customise
	 * @return [boolean, string] - is this date selectable?, what is its CSS class?
	 */
		noWeekends: function (date) {
			var day = date.getDay();
			return [(day > 0 && day < 6), ""];
		},

		/* Set as calculateWeek to determine the week of the year based on the ISO 8601 definition.
	 * @param  date  Date - the date to get the week for
	 * @return  number - the number of the week within the year that contains this date
	 */
		iso8601Week: function (date) {
			var time,
				checkDate = new Date(date.getTime());

			// Find Thursday of this week starting on Monday
			checkDate.setDate(checkDate.getDate() + 4 - (checkDate.getDay() || 7));

			time = checkDate.getTime();
			checkDate.setMonth(0); // Compare with Jan 1
			checkDate.setDate(1);
			return Math.floor(Math.round((time - checkDate) / 86400000) / 7) + 1;
		},

		/* Parse a string value into a date object.
	 * See formatDate below for the possible formats.
	 *
	 * @param  format string - the expected format of the date
	 * @param  value string - the date in the above format
	 * @param  settings Object - attributes include:
	 *					shortYearCutoff  number - the cutoff year for determining the century (optional)
	 *					dayNamesShort	string[7] - abbreviated names of the days from Sunday (optional)
	 *					dayNames		string[7] - names of the days from Sunday (optional)
	 *					monthNamesShort string[12] - abbreviated names of the months (optional)
	 *					monthNames		string[12] - names of the months (optional)
	 * @return  Date - the extracted date value or null if value is blank
	 */
		parseDate: function (format, value, settings) {
			if (format == null || value == null) {
				throw "Invalid arguments";
			}

			value = (typeof value === "object" ? value.toString() : value + "");
			if (value === "") {
				return null;
			}

			var iFormat, dim, extra,
				iValue = 0,
				shortYearCutoffTemp = (settings ? settings.shortYearCutoff : null) || this._defaults.shortYearCutoff,
				shortYearCutoff = (typeof shortYearCutoffTemp !== "string" ? shortYearCutoffTemp :
					new Date().getFullYear() % 100 + parseInt(shortYearCutoffTemp, 10)),
				dayNamesShort = (settings ? settings.dayNamesShort : null) || this._defaults.dayNamesShort,
				dayNames = (settings ? settings.dayNames : null) || this._defaults.dayNames,
				monthNamesShort = (settings ? settings.monthNamesShort : null) || this._defaults.monthNamesShort,
				monthNames = (settings ? settings.monthNames : null) || this._defaults.monthNames,
				year = -1,
				month = -1,
				day = -1,
				doy = -1,
				literal = false,
				date,

				// Check whether a format character is doubled
				lookAhead = function (match) {
					var matches = (iFormat + 1 < format.length && format.charAt(iFormat + 1) === match);
					if (matches) {
						iFormat++;
					}
					return matches;
				},

				// Extract a number from the string value
				getNumber = function (match) {
					var isDoubled = lookAhead(match),
						size = (match === "@" ? 14 : (match === "!" ? 20 :
							(match === "y" && isDoubled ? 4 : (match === "o" ? 3 : 2)))),
						minSize = (match === "y" ? size : 1),
						digits = new RegExp("^\\d{" + minSize + "," + size + "}"),
						num = value.substring(iValue).match(digits);
					if (!num) {
						throw "Missing number at position " + iValue;
					}
					iValue += num[0].length;
					return parseInt(num[0], 10);
				},

				// Extract a name from the string value and convert to an index
				getName = function (match, shortNames, longNames) {
					var index = -1,
						names = $.map(lookAhead(match) ? longNames : shortNames, function (v, k) {
							return [[k, v]];
						}).sort(function (a, b) {
							return -(a[1].length - b[1].length);
						});

					$.each(names, function (i, pair) {
						var name = pair[1];
						if (value.substr(iValue, name.length).toLowerCase() === name.toLowerCase()) {
							index = pair[0];
							iValue += name.length;
							return false;
						}
					});
					if (index !== -1) {
						return index + 1;
					} else {
						throw "Unknown name at position " + iValue;
					}
				},

				// Confirm that a literal character matches the string value
				checkLiteral = function () {
					if (value.charAt(iValue) !== format.charAt(iFormat)) {
						throw "Unexpected literal at position " + iValue;
					}
					iValue++;
				};

			for (iFormat = 0; iFormat < format.length; iFormat++) {
				if (literal) {
					if (format.charAt(iFormat) === "'" && !lookAhead("'")) {
						literal = false;
					} else {
						checkLiteral();
					}
				} else {
					switch (format.charAt(iFormat)) {
						case "d":
							day = getNumber("d");
							break;
						case "D":
							getName("D", dayNamesShort, dayNames);
							break;
						case "o":
							doy = getNumber("o");
							break;
						case "m":
							month = getNumber("m");
							break;
						case "M":
							month = getName("M", monthNamesShort, monthNames);
							break;
						case "y":
							year = getNumber("y");
							break;
						case "@":
							date = new Date(getNumber("@"));
							year = date.getFullYear();
							month = date.getMonth() + 1;
							day = date.getDate();
							break;
						case "!":
							date = new Date((getNumber("!") - this._ticksTo1970) / 10000);
							year = date.getFullYear();
							month = date.getMonth() + 1;
							day = date.getDate();
							break;
						case "'":
							if (lookAhead("'")) {
								checkLiteral();
							} else {
								literal = true;
							}
							break;
						default:
							checkLiteral();
					}
				}
			}

			if (iValue < value.length) {
				extra = value.substr(iValue);
				if (!/^\s+/.test(extra)) {
					throw "Extra/unparsed characters found in date: " + extra;
				}
			}

			if (year === -1) {
				year = new Date().getFullYear();
			} else if (year < 100) {
				year += new Date().getFullYear() - new Date().getFullYear() % 100 +
					(year <= shortYearCutoff ? 0 : -100);
			}

			if (doy > -1) {
				month = 1;
				day = doy;
				do {
					dim = this._getDaysInMonth(year, month - 1);
					if (day <= dim) {
						break;
					}
					month++;
					day -= dim;
				} while (true);
			}

			date = this._daylightSavingAdjust(new Date(year, month - 1, day));
			if (date.getFullYear() !== year || date.getMonth() + 1 !== month || date.getDate() !== day) {
				throw "Invalid date"; // E.g. 31/02/00
			}
			return date;
		},

		/* Standard date formats. */
		ATOM: "yy-mm-dd", // RFC 3339 (ISO 8601)
		COOKIE: "D, dd M yy",
		ISO_8601: "yy-mm-dd",
		RFC_822: "D, d M y",
		RFC_850: "DD, dd-M-y",
		RFC_1036: "D, d M y",
		RFC_1123: "D, d M yy",
		RFC_2822: "D, d M yy",
		RSS: "D, d M y", // RFC 822
		TICKS: "!",
		TIMESTAMP: "@",
		W3C: "yy-mm-dd", // ISO 8601

		_ticksTo1970: (((1970 - 1) * 365 + Math.floor(1970 / 4) - Math.floor(1970 / 100) +
			Math.floor(1970 / 400)) * 24 * 60 * 60 * 10000000),

		/* Format a date object into a string value.
	 * The format can be combinations of the following:
	 * d  - day of month (no leading zero)
	 * dd - day of month (two digit)
	 * o  - day of year (no leading zeros)
	 * oo - day of year (three digit)
	 * D  - day name short
	 * DD - day name long
	 * m  - month of year (no leading zero)
	 * mm - month of year (two digit)
	 * M  - month name short
	 * MM - month name long
	 * y  - year (two digit)
	 * yy - year (four digit)
	 * @ - Unix timestamp (ms since 01/01/1970)
	 * ! - Windows ticks (100ns since 01/01/0001)
	 * "..." - literal text
	 * '' - single quote
	 *
	 * @param  format string - the desired format of the date
	 * @param  date Date - the date value to format
	 * @param  settings Object - attributes include:
	 *					dayNamesShort	string[7] - abbreviated names of the days from Sunday (optional)
	 *					dayNames		string[7] - names of the days from Sunday (optional)
	 *					monthNamesShort string[12] - abbreviated names of the months (optional)
	 *					monthNames		string[12] - names of the months (optional)
	 * @return  string - the date in the above format
	 */
		formatDate: function (format, date, settings) {
			if (!date) {
				return "";
			}

			var iFormat,
				dayNamesShort = (settings ? settings.dayNamesShort : null) || this._defaults.dayNamesShort,
				dayNames = (settings ? settings.dayNames : null) || this._defaults.dayNames,
				monthNamesShort = (settings ? settings.monthNamesShort : null) || this._defaults.monthNamesShort,
				monthNames = (settings ? settings.monthNames : null) || this._defaults.monthNames,

				// Check whether a format character is doubled
				lookAhead = function (match) {
					var matches = (iFormat + 1 < format.length && format.charAt(iFormat + 1) === match);
					if (matches) {
						iFormat++;
					}
					return matches;
				},

				// Format a number, with leading zero if necessary
				formatNumber = function (match, value, len) {
					var num = "" + value;
					if (lookAhead(match)) {
						while (num.length < len) {
							num = "0" + num;
						}
					}
					return num;
				},

				// Format a name, short or long as requested
				formatName = function (match, value, shortNames, longNames) {
					return (lookAhead(match) ? longNames[value] : shortNames[value]);
				},
				output = "",
				literal = false;

			if (date) {
				for (iFormat = 0; iFormat < format.length; iFormat++) {
					if (literal) {
						if (format.charAt(iFormat) === "'" && !lookAhead("'")) {
							literal = false;
						} else {
							output += format.charAt(iFormat);
						}
					} else {
						switch (format.charAt(iFormat)) {
							case "d":
								output += formatNumber("d", date.getDate(), 2);
								break;
							case "D":
								output += formatName("D", date.getDay(), dayNamesShort, dayNames);
								break;
							case "o":
								output += formatNumber("o",
									Math.round((new Date(date.getFullYear(), date.getMonth(), date.getDate()).getTime() - new Date(date.getFullYear(), 0, 0).getTime()) / 86400000), 3);
								break;
							case "m":
								output += formatNumber("m", date.getMonth() + 1, 2);
								break;
							case "M":
								output += formatName("M", date.getMonth(), monthNamesShort, monthNames);
								break;
							case "y":
								output += (lookAhead("y") ? date.getFullYear() :
									(date.getFullYear() % 100 < 10 ? "0" : "") + date.getFullYear() % 100);
								break;
							case "@":
								output += date.getTime();
								break;
							case "!":
								output += date.getTime() * 10000 + this._ticksTo1970;
								break;
							case "'":
								if (lookAhead("'")) {
									output += "'";
								} else {
									literal = true;
								}
								break;
							default:
								output += format.charAt(iFormat);
						}
					}
				}
			}
			return output;
		},

		/* Extract all possible characters from the date format. */
		_possibleChars: function (format) {
			var iFormat,
				chars = "",
				literal = false,

				// Check whether a format character is doubled
				lookAhead = function (match) {
					var matches = (iFormat + 1 < format.length && format.charAt(iFormat + 1) === match);
					if (matches) {
						iFormat++;
					}
					return matches;
				};

			for (iFormat = 0; iFormat < format.length; iFormat++) {
				if (literal) {
					if (format.charAt(iFormat) === "'" && !lookAhead("'")) {
						literal = false;
					} else {
						chars += format.charAt(iFormat);
					}
				} else {
					switch (format.charAt(iFormat)) {
						case "d":
						case "m":
						case "y":
						case "@":
							chars += "0123456789";
							break;
						case "D":
						case "M":
							return null; // Accept anything
						case "'":
							if (lookAhead("'")) {
								chars += "'";
							} else {
								literal = true;
							}
							break;
						default:
							chars += format.charAt(iFormat);
					}
				}
			}
			return chars;
		},

		/* Get a setting value, defaulting if necessary. */
		_get: function (inst, name) {
			return inst.settings[name] !== undefined ?
				inst.settings[name] : this._defaults[name];
		},

		/* Parse existing date and initialise date picker. */
		_setDateFromField: function (inst, noDefault) {
			if (inst.input.val() === inst.lastVal) {
				return;
			}

			var dateFormat = this._get(inst, "dateFormat"),
				dates = inst.lastVal = inst.input ? inst.input.val() : null,
				defaultDate = this._getDefaultDate(inst),
				date = defaultDate,
				settings = this._getFormatConfig(inst);

			try {
				date = this.parseDate(dateFormat, dates, settings) || defaultDate;
			} catch (event) {
				dates = (noDefault ? "" : dates);
			}
			inst.selectedDay = date.getDate();
			inst.drawMonth = inst.selectedMonth = date.getMonth();
			inst.drawYear = inst.selectedYear = date.getFullYear();
			inst.currentDay = (dates ? date.getDate() : 0);
			inst.currentMonth = (dates ? date.getMonth() : 0);
			inst.currentYear = (dates ? date.getFullYear() : 0);
			this._adjustInstDate(inst);
		},

		/* Retrieve the default date shown on opening. */
		_getDefaultDate: function (inst) {
			return this._restrictMinMax(inst,
				this._determineDate(inst, this._get(inst, "defaultDate"), new Date()));
		},

		/* A date may be specified as an exact value or a relative one. */
		_determineDate: function (inst, date, defaultDate) {
			var offsetNumeric = function (offset) {
					var date = new Date();
					date.setDate(date.getDate() + offset);
					return date;
				},
				offsetString = function (offset) {
					try {
						return $.datepicker.parseDate($.datepicker._get(inst, "dateFormat"),
							offset, $.datepicker._getFormatConfig(inst));
					}
					catch (e) {

						// Ignore
					}

					var date = (offset.toLowerCase().match(/^c/) ?
						$.datepicker._getDate(inst) : null) || new Date(),
						year = date.getFullYear(),
						month = date.getMonth(),
						day = date.getDate(),
						pattern = /([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,
						matches = pattern.exec(offset);

					while (matches) {
						switch (matches[2] || "d") {
							case "d" :
							case "D" :
								day += parseInt(matches[1], 10);
								break;
							case "w" :
							case "W" :
								day += parseInt(matches[1], 10) * 7;
								break;
							case "m" :
							case "M" :
								month += parseInt(matches[1], 10);
								day = Math.min(day, $.datepicker._getDaysInMonth(year, month));
								break;
							case "y":
							case "Y" :
								year += parseInt(matches[1], 10);
								day = Math.min(day, $.datepicker._getDaysInMonth(year, month));
								break;
						}
						matches = pattern.exec(offset);
					}
					return new Date(year, month, day);
				},
				newDate = (date == null || date === "" ? defaultDate : (typeof date === "string" ? offsetString(date) :
					(typeof date === "number" ? (isNaN(date) ? defaultDate : offsetNumeric(date)) : new Date(date.getTime()))));

			newDate = (newDate && newDate.toString() === "Invalid Date" ? defaultDate : newDate);
			if (newDate) {
				newDate.setHours(0);
				newDate.setMinutes(0);
				newDate.setSeconds(0);
				newDate.setMilliseconds(0);
			}
			return this._daylightSavingAdjust(newDate);
		},

		/* Handle switch to/from daylight saving.
	 * Hours may be non-zero on daylight saving cut-over:
	 * > 12 when midnight changeover, but then cannot generate
	 * midnight datetime, so jump to 1AM, otherwise reset.
	 * @param  date  (Date) the date to check
	 * @return  (Date) the corrected date
	 */
		_daylightSavingAdjust: function (date) {
			if (!date) {
				return null;
			}
			date.setHours(date.getHours() > 12 ? date.getHours() + 2 : 0);
			return date;
		},

		/* Set the date(s) directly. */
		_setDate: function (inst, date, noChange) {
			var clear = !date,
				origMonth = inst.selectedMonth,
				origYear = inst.selectedYear,
				newDate = this._restrictMinMax(inst, this._determineDate(inst, date, new Date()));

			inst.selectedDay = inst.currentDay = newDate.getDate();
			inst.drawMonth = inst.selectedMonth = inst.currentMonth = newDate.getMonth();
			inst.drawYear = inst.selectedYear = inst.currentYear = newDate.getFullYear();
			if ((origMonth !== inst.selectedMonth || origYear !== inst.selectedYear) && !noChange) {
				this._notifyChange(inst);
			}
			this._adjustInstDate(inst);
			if (inst.input) {
				inst.input.val(clear ? "" : this._formatDate(inst));
			}
		},

		/* Retrieve the date(s) directly. */
		_getDate: function (inst) {
			var startDate = (!inst.currentYear || (inst.input && inst.input.val() === "") ? null :
				this._daylightSavingAdjust(new Date(
					inst.currentYear, inst.currentMonth, inst.currentDay)));
			return startDate;
		},

		/* Attach the onxxx handlers.  These are declared statically so
	 * they work with static code transformers like Caja.
	 */
		_attachHandlers: function (inst) {
			var stepMonths = this._get(inst, "stepMonths"),
				id = "#" + inst.id.replace(/\\\\/g, "\\");
			inst.dpDiv.find("[data-handler]").map(function () {
				var handler = {
					prev: function () {
						$.datepicker._adjustDate(id, -stepMonths, "M");
					},
					next: function () {
						$.datepicker._adjustDate(id, +stepMonths, "M");
					},
					hide: function () {
						$.datepicker._hideDatepicker();
					},
					today: function () {
						$.datepicker._gotoToday(id);
					},
					selectDay: function () {
						$.datepicker._selectDay(id, +this.getAttribute("data-month"), +this.getAttribute("data-year"), this);
						return false;
					},
					selectMonth: function () {
						$.datepicker._selectMonthYear(id, this, "M");
						return false;
					},
					selectYear: function () {
						$.datepicker._selectMonthYear(id, this, "Y");
						return false;
					}
				};
				$(this).on(this.getAttribute("data-event"), handler[this.getAttribute("data-handler")]);
			});
		},

		/* Generate the HTML for the current state of the date picker. */
		_generateHTML: function (inst) {
			var maxDraw, prevText, prev, nextText, next, currentText, gotoDate,
				controls, buttonPanel, firstDay, showWeek, dayNames, dayNamesMin,
				monthNames, monthNamesShort, beforeShowDay, showOtherMonths,
				selectOtherMonths, defaultDate, html, dow, row, group, col, selectedDate,
				cornerClass, calender, thead, day, daysInMonth, leadDays, curRows, numRows,
				printDate, dRow, tbody, daySettings, otherMonth, unselectable,
				tempDate = new Date(),
				today = this._daylightSavingAdjust(
					new Date(tempDate.getFullYear(), tempDate.getMonth(), tempDate.getDate())), // clear time
				isRTL = this._get(inst, "isRTL"),
				showButtonPanel = this._get(inst, "showButtonPanel"),
				hideIfNoPrevNext = this._get(inst, "hideIfNoPrevNext"),
				navigationAsDateFormat = this._get(inst, "navigationAsDateFormat"),
				numMonths = this._getNumberOfMonths(inst),
				showCurrentAtPos = this._get(inst, "showCurrentAtPos"),
				stepMonths = this._get(inst, "stepMonths"),
				isMultiMonth = (numMonths[0] !== 1 || numMonths[1] !== 1),
				currentDate = this._daylightSavingAdjust((!inst.currentDay ? new Date(9999, 9, 9) :
					new Date(inst.currentYear, inst.currentMonth, inst.currentDay))),
				minDate = this._getMinMaxDate(inst, "min"),
				maxDate = this._getMinMaxDate(inst, "max"),
				drawMonth = inst.drawMonth - showCurrentAtPos,
				drawYear = inst.drawYear;

			if (drawMonth < 0) {
				drawMonth += 12;
				drawYear--;
			}
			if (maxDate) {
				maxDraw = this._daylightSavingAdjust(new Date(maxDate.getFullYear(),
					maxDate.getMonth() - (numMonths[0] * numMonths[1]) + 1, maxDate.getDate()));
				maxDraw = (minDate && maxDraw < minDate ? minDate : maxDraw);
				while (this._daylightSavingAdjust(new Date(drawYear, drawMonth, 1)) > maxDraw) {
					drawMonth--;
					if (drawMonth < 0) {
						drawMonth = 11;
						drawYear--;
					}
				}
			}
			inst.drawMonth = drawMonth;
			inst.drawYear = drawYear;

			prevText = this._get(inst, "prevText");
			prevText = (!navigationAsDateFormat ? prevText : this.formatDate(prevText,
				this._daylightSavingAdjust(new Date(drawYear, drawMonth - stepMonths, 1)),
				this._getFormatConfig(inst)));

			prev = (this._canAdjustMonth(inst, -1, drawYear, drawMonth) ?
				"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click'" +
				" title='" + prevText + "'><span class='ui-icon ui-icon-circle-triangle-" + (isRTL ? "e" : "w") + "'>" + prevText + "</span></a>" :
				(hideIfNoPrevNext ? "" : "<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='" + prevText + "'><span class='ui-icon ui-icon-circle-triangle-" + (isRTL ? "e" : "w") + "'>" + prevText + "</span></a>"));

			nextText = this._get(inst, "nextText");
			nextText = (!navigationAsDateFormat ? nextText : this.formatDate(nextText,
				this._daylightSavingAdjust(new Date(drawYear, drawMonth + stepMonths, 1)),
				this._getFormatConfig(inst)));

			next = (this._canAdjustMonth(inst, +1, drawYear, drawMonth) ?
				"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click'" +
				" title='" + nextText + "'><span class='ui-icon ui-icon-circle-triangle-" + (isRTL ? "w" : "e") + "'>" + nextText + "</span></a>" :
				(hideIfNoPrevNext ? "" : "<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='" + nextText + "'><span class='ui-icon ui-icon-circle-triangle-" + (isRTL ? "w" : "e") + "'>" + nextText + "</span></a>"));

			currentText = this._get(inst, "currentText");
			gotoDate = (this._get(inst, "gotoCurrent") && inst.currentDay ? currentDate : today);
			currentText = (!navigationAsDateFormat ? currentText :
				this.formatDate(currentText, gotoDate, this._getFormatConfig(inst)));

			controls = (!inst.inline ? "<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>" +
				this._get(inst, "closeText") + "</button>" : "");

			buttonPanel = (showButtonPanel) ? "<div class='ui-datepicker-buttonpane ui-widget-content'>" + (isRTL ? controls : "") +
				(this._isInRange(inst, gotoDate) ? "<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'" +
					">" + currentText + "</button>" : "") + (isRTL ? "" : controls) + "</div>" : "";

			firstDay = parseInt(this._get(inst, "firstDay"), 10);
			firstDay = (isNaN(firstDay) ? 0 : firstDay);

			showWeek = this._get(inst, "showWeek");
			dayNames = this._get(inst, "dayNames");
			dayNamesMin = this._get(inst, "dayNamesMin");
			monthNames = this._get(inst, "monthNames");
			monthNamesShort = this._get(inst, "monthNamesShort");
			beforeShowDay = this._get(inst, "beforeShowDay");
			showOtherMonths = this._get(inst, "showOtherMonths");
			selectOtherMonths = this._get(inst, "selectOtherMonths");
			defaultDate = this._getDefaultDate(inst);
			html = "";

			for (row = 0; row < numMonths[0]; row++) {
				group = "";
				this.maxRows = 4;
				for (col = 0; col < numMonths[1]; col++) {
					selectedDate = this._daylightSavingAdjust(new Date(drawYear, drawMonth, inst.selectedDay));
					cornerClass = " ui-corner-all";
					calender = "";
					if (isMultiMonth) {
						calender += "<div class='ui-datepicker-group";
						if (numMonths[1] > 1) {
							switch (col) {
								case 0:
									calender += " ui-datepicker-group-first";
									cornerClass = " ui-corner-" + (isRTL ? "right" : "left");
									break;
								case numMonths[1] - 1:
									calender += " ui-datepicker-group-last";
									cornerClass = " ui-corner-" + (isRTL ? "left" : "right");
									break;
								default:
									calender += " ui-datepicker-group-middle";
									cornerClass = "";
									break;
							}
						}
						calender += "'>";
					}
					calender += "<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix" + cornerClass + "'>" +
						(/all|left/.test(cornerClass) && row === 0 ? (isRTL ? next : prev) : "") +
						(/all|right/.test(cornerClass) && row === 0 ? (isRTL ? prev : next) : "") +
						this._generateMonthYearHeader(inst, drawMonth, drawYear, minDate, maxDate,
							row > 0 || col > 0, monthNames, monthNamesShort) + // draw month headers
						"</div><table class='ui-datepicker-calendar'><thead>" +
						"<tr>";
					thead = (showWeek ? "<th class='ui-datepicker-week-col'>" + this._get(inst, "weekHeader") + "</th>" : "");
					for (dow = 0; dow < 7; dow++) { // days of the week
						day = (dow + firstDay) % 7;
						thead += "<th scope='col'" + ((dow + firstDay + 6) % 7 >= 5 ? " class='ui-datepicker-week-end'" : "") + ">" +
							"<span title='" + dayNames[day] + "'>" + dayNamesMin[day] + "</span></th>";
					}
					calender += thead + "</tr></thead><tbody>";
					daysInMonth = this._getDaysInMonth(drawYear, drawMonth);
					if (drawYear === inst.selectedYear && drawMonth === inst.selectedMonth) {
						inst.selectedDay = Math.min(inst.selectedDay, daysInMonth);
					}
					leadDays = (this._getFirstDayOfMonth(drawYear, drawMonth) - firstDay + 7) % 7;
					curRows = Math.ceil((leadDays + daysInMonth) / 7); // calculate the number of rows to generate
					numRows = (isMultiMonth ? this.maxRows > curRows ? this.maxRows : curRows : curRows); //If multiple months, use the higher number of rows (see #7043)
					this.maxRows = numRows;
					printDate = this._daylightSavingAdjust(new Date(drawYear, drawMonth, 1 - leadDays));
					for (dRow = 0; dRow < numRows; dRow++) { // create date picker rows
						calender += "<tr>";
						tbody = (!showWeek ? "" : "<td class='ui-datepicker-week-col'>" +
							this._get(inst, "calculateWeek")(printDate) + "</td>");
						for (dow = 0; dow < 7; dow++) { // create date picker days
							daySettings = (beforeShowDay ?
								beforeShowDay.apply((inst.input ? inst.input[0] : null), [printDate]) : [true, ""]);
							otherMonth = (printDate.getMonth() !== drawMonth);
							unselectable = (otherMonth && !selectOtherMonths) || !daySettings[0] ||
								(minDate && printDate < minDate) || (maxDate && printDate > maxDate);
							tbody += "<td class='" +
								((dow + firstDay + 6) % 7 >= 5 ? " ui-datepicker-week-end" : "") + // highlight weekends
								(otherMonth ? " ui-datepicker-other-month" : "") + // highlight days from other months
								((printDate.getTime() === selectedDate.getTime() && drawMonth === inst.selectedMonth && inst._keyEvent) || // user pressed key
								(defaultDate.getTime() === printDate.getTime() && defaultDate.getTime() === selectedDate.getTime()) ?

									// or defaultDate is current printedDate and defaultDate is selectedDate
									" " + this._dayOverClass : "") + // highlight selected day
								(unselectable ? " " + this._unselectableClass + " ui-state-disabled" : "") +  // highlight unselectable days
								(otherMonth && !showOtherMonths ? "" : " " + daySettings[1] + // highlight custom dates
									(printDate.getTime() === currentDate.getTime() ? " " + this._currentClass : "") + // highlight selected day
									(printDate.getTime() === today.getTime() ? " ui-datepicker-today" : "")) + "'" + // highlight today (if different)
								((!otherMonth || showOtherMonths) && daySettings[2] ? " title='" + daySettings[2].replace(/'/g, "&#39;") + "'" : "") + // cell title
								(unselectable ? "" : " data-handler='selectDay' data-event='click' data-month='" + printDate.getMonth() + "' data-year='" + printDate.getFullYear() + "'") + ">" + // actions
								(otherMonth && !showOtherMonths ? "&#xa0;" : // display for other months
									(unselectable ? "<span class='ui-state-default'>" + printDate.getDate() + "</span>" : "<a class='ui-state-default" +
										(printDate.getTime() === today.getTime() ? " ui-state-highlight" : "") +
										(printDate.getTime() === currentDate.getTime() ? " ui-state-active" : "") + // highlight selected day
										(otherMonth ? " ui-priority-secondary" : "") + // distinguish dates from other months
										"' href='#'>" + printDate.getDate() + "</a>")) + "</td>"; // display selectable date
							printDate.setDate(printDate.getDate() + 1);
							printDate = this._daylightSavingAdjust(printDate);
						}
						calender += tbody + "</tr>";
					}
					drawMonth++;
					if (drawMonth > 11) {
						drawMonth = 0;
						drawYear++;
					}
					calender += "</tbody></table>" + (isMultiMonth ? "</div>" +
						((numMonths[0] > 0 && col === numMonths[1] - 1) ? "<div class='ui-datepicker-row-break'></div>" : "") : "");
					group += calender;
				}
				html += group;
			}
			html += buttonPanel;
			inst._keyEvent = false;
			return html;
		},

		/* Generate the month and year header. */
		_generateMonthYearHeader: function (inst, drawMonth, drawYear, minDate, maxDate,
											secondary, monthNames, monthNamesShort) {

			var inMinYear, inMaxYear, month, years, thisYear, determineYear, year, endYear,
				changeMonth = this._get(inst, "changeMonth"),
				changeYear = this._get(inst, "changeYear"),
				showMonthAfterYear = this._get(inst, "showMonthAfterYear"),
				html = "<div class='ui-datepicker-title'>",
				monthHtml = "";

			// Month selection
			if (secondary || !changeMonth) {
				monthHtml += "<span class='ui-datepicker-month'>" + monthNames[drawMonth] + "</span>";
			} else {
				inMinYear = (minDate && minDate.getFullYear() === drawYear);
				inMaxYear = (maxDate && maxDate.getFullYear() === drawYear);
				monthHtml += "<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>";
				for (month = 0; month < 12; month++) {
					if ((!inMinYear || month >= minDate.getMonth()) && (!inMaxYear || month <= maxDate.getMonth())) {
						monthHtml += "<option value='" + month + "'" +
							(month === drawMonth ? " selected='selected'" : "") +
							">" + monthNamesShort[month] + "</option>";
					}
				}
				monthHtml += "</select>";
			}

			if (!showMonthAfterYear) {
				html += monthHtml + (secondary || !(changeMonth && changeYear) ? "&#xa0;" : "");
			}

			// Year selection
			if (!inst.yearshtml) {
				inst.yearshtml = "";
				if (secondary || !changeYear) {
					html += "<span class='ui-datepicker-year'>" + drawYear + "</span>";
				} else {

					// determine range of years to display
					years = this._get(inst, "yearRange").split(":");
					thisYear = new Date().getFullYear();
					determineYear = function (value) {
						var year = (value.match(/c[+\-].*/) ? drawYear + parseInt(value.substring(1), 10) :
							(value.match(/[+\-].*/) ? thisYear + parseInt(value, 10) :
								parseInt(value, 10)));
						return (isNaN(year) ? thisYear : year);
					};
					year = determineYear(years[0]);
					endYear = Math.max(year, determineYear(years[1] || ""));
					year = (minDate ? Math.max(year, minDate.getFullYear()) : year);
					endYear = (maxDate ? Math.min(endYear, maxDate.getFullYear()) : endYear);
					inst.yearshtml += "<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";
					for (; year <= endYear; year++) {
						inst.yearshtml += "<option value='" + year + "'" +
							(year === drawYear ? " selected='selected'" : "") +
							">" + year + "</option>";
					}
					inst.yearshtml += "</select>";

					html += inst.yearshtml;
					inst.yearshtml = null;
				}
			}

			html += this._get(inst, "yearSuffix");
			if (showMonthAfterYear) {
				html += (secondary || !(changeMonth && changeYear) ? "&#xa0;" : "") + monthHtml;
			}
			html += "</div>"; // Close datepicker_header
			return html;
		},

		/* Adjust one of the date sub-fields. */
		_adjustInstDate: function (inst, offset, period) {
			var year = inst.selectedYear + (period === "Y" ? offset : 0),
				month = inst.selectedMonth + (period === "M" ? offset : 0),
				day = Math.min(inst.selectedDay, this._getDaysInMonth(year, month)) + (period === "D" ? offset : 0),
				date = this._restrictMinMax(inst, this._daylightSavingAdjust(new Date(year, month, day)));

			inst.selectedDay = date.getDate();
			inst.drawMonth = inst.selectedMonth = date.getMonth();
			inst.drawYear = inst.selectedYear = date.getFullYear();
			if (period === "M" || period === "Y") {
				this._notifyChange(inst);
			}
		},

		/* Ensure a date is within any min/max bounds. */
		_restrictMinMax: function (inst, date) {
			var minDate = this._getMinMaxDate(inst, "min"),
				maxDate = this._getMinMaxDate(inst, "max"),
				newDate = (minDate && date < minDate ? minDate : date);
			return (maxDate && newDate > maxDate ? maxDate : newDate);
		},

		/* Notify change of month/year. */
		_notifyChange: function (inst) {
			var onChange = this._get(inst, "onChangeMonthYear");
			if (onChange) {
				onChange.apply((inst.input ? inst.input[0] : null),
					[inst.selectedYear, inst.selectedMonth + 1, inst]);
			}
		},

		/* Determine the number of months to show. */
		_getNumberOfMonths: function (inst) {
			var numMonths = this._get(inst, "numberOfMonths");
			return (numMonths == null ? [1, 1] : (typeof numMonths === "number" ? [1, numMonths] : numMonths));
		},

		/* Determine the current maximum date - ensure no time components are set. */
		_getMinMaxDate: function (inst, minMax) {
			return this._determineDate(inst, this._get(inst, minMax + "Date"), null);
		},

		/* Find the number of days in a given month. */
		_getDaysInMonth: function (year, month) {
			return 32 - this._daylightSavingAdjust(new Date(year, month, 32)).getDate();
		},

		/* Find the day of the week of the first of a month. */
		_getFirstDayOfMonth: function (year, month) {
			return new Date(year, month, 1).getDay();
		},

		/* Determines if we should allow a "next/prev" month display change. */
		_canAdjustMonth: function (inst, offset, curYear, curMonth) {
			var numMonths = this._getNumberOfMonths(inst),
				date = this._daylightSavingAdjust(new Date(curYear,
					curMonth + (offset < 0 ? offset : numMonths[0] * numMonths[1]), 1));

			if (offset < 0) {
				date.setDate(this._getDaysInMonth(date.getFullYear(), date.getMonth()));
			}
			return this._isInRange(inst, date);
		},

		/* Is the given date in the accepted range? */
		_isInRange: function (inst, date) {
			var yearSplit, currentYear,
				minDate = this._getMinMaxDate(inst, "min"),
				maxDate = this._getMinMaxDate(inst, "max"),
				minYear = null,
				maxYear = null,
				years = this._get(inst, "yearRange");
			if (years) {
				yearSplit = years.split(":");
				currentYear = new Date().getFullYear();
				minYear = parseInt(yearSplit[0], 10);
				maxYear = parseInt(yearSplit[1], 10);
				if (yearSplit[0].match(/[+\-].*/)) {
					minYear += currentYear;
				}
				if (yearSplit[1].match(/[+\-].*/)) {
					maxYear += currentYear;
				}
			}

			return ((!minDate || date.getTime() >= minDate.getTime()) &&
				(!maxDate || date.getTime() <= maxDate.getTime()) &&
				(!minYear || date.getFullYear() >= minYear) &&
				(!maxYear || date.getFullYear() <= maxYear));
		},

		/* Provide the configuration settings for formatting/parsing. */
		_getFormatConfig: function (inst) {
			var shortYearCutoff = this._get(inst, "shortYearCutoff");
			shortYearCutoff = (typeof shortYearCutoff !== "string" ? shortYearCutoff :
				new Date().getFullYear() % 100 + parseInt(shortYearCutoff, 10));
			return {
				shortYearCutoff: shortYearCutoff,
				dayNamesShort: this._get(inst, "dayNamesShort"), dayNames: this._get(inst, "dayNames"),
				monthNamesShort: this._get(inst, "monthNamesShort"), monthNames: this._get(inst, "monthNames")
			};
		},

		/* Format the given date for display. */
		_formatDate: function (inst, day, month, year) {
			if (!day) {
				inst.currentDay = inst.selectedDay;
				inst.currentMonth = inst.selectedMonth;
				inst.currentYear = inst.selectedYear;
			}
			var date = (day ? (typeof day === "object" ? day :
				this._daylightSavingAdjust(new Date(year, month, day))) :
				this._daylightSavingAdjust(new Date(inst.currentYear, inst.currentMonth, inst.currentDay)));
			return this.formatDate(this._get(inst, "dateFormat"), date, this._getFormatConfig(inst));
		}
	});

	/*
 * Bind hover events for datepicker elements.
 * Done via delegate so the binding only occurs once in the lifetime of the parent div.
 * Global datepicker_instActive, set by _updateDatepicker allows the handlers to find their way back to the active picker.
 */
	function datepicker_bindHover(dpDiv) {
		var selector = "button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";
		return dpDiv.on("mouseout", selector, function () {
			$(this).removeClass("ui-state-hover");
			if (this.className.indexOf("ui-datepicker-prev") !== -1) {
				$(this).removeClass("ui-datepicker-prev-hover");
			}
			if (this.className.indexOf("ui-datepicker-next") !== -1) {
				$(this).removeClass("ui-datepicker-next-hover");
			}
		})
			.on("mouseover", selector, datepicker_handleMouseover);
	}

	function datepicker_handleMouseover() {
		if (!$.datepicker._isDisabledDatepicker(datepicker_instActive.inline ? datepicker_instActive.dpDiv.parent()[0] : datepicker_instActive.input[0])) {
			$(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");
			$(this).addClass("ui-state-hover");
			if (this.className.indexOf("ui-datepicker-prev") !== -1) {
				$(this).addClass("ui-datepicker-prev-hover");
			}
			if (this.className.indexOf("ui-datepicker-next") !== -1) {
				$(this).addClass("ui-datepicker-next-hover");
			}
		}
	}

	/* jQuery extend now ignores nulls! */
	function datepicker_extendRemove(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] == null) {
				target[name] = props[name];
			}
		}
		return target;
	}

	/* Invoke the datepicker functionality.
   @param  options  string - a command, optionally followed by additional parameters or
					Object - settings for attaching new datepicker functionality
   @return  jQuery object */
	$.fn.datepicker = function (options) {

		/* Verify an empty collection wasn't passed - Fixes #6976 */
		if (!this.length) {
			return this;
		}

		/* Initialise the date picker. */
		if (!$.datepicker.initialized) {
			$(document).on("mousedown", $.datepicker._checkExternalClick);
			$.datepicker.initialized = true;
		}

		/* Append datepicker main container to body if not exist. */
		if ($("#" + $.datepicker._mainDivId).length === 0) {
			$("body").append($.datepicker.dpDiv);
		}

		var otherArgs = Array.prototype.slice.call(arguments, 1);
		if (typeof options === "string" && (options === "isDisabled" || options === "getDate" || options === "widget")) {
			return $.datepicker["_" + options + "Datepicker"].apply($.datepicker, [this[0]].concat(otherArgs));
		}
		if (options === "option" && arguments.length === 2 && typeof arguments[1] === "string") {
			return $.datepicker["_" + options + "Datepicker"].apply($.datepicker, [this[0]].concat(otherArgs));
		}
		return this.each(function () {
			typeof options === "string" ?
				$.datepicker["_" + options + "Datepicker"].apply($.datepicker, [this].concat(otherArgs)) :
				$.datepicker._attachDatepicker(this, options);
		});
	};

	$.datepicker = new Datepicker(); // singleton instance
	$.datepicker.initialized = false;
	$.datepicker.uuid = new Date().getTime();
	$.datepicker.version = "1.12.1";

	var widgetsDatepicker = $.datepicker;


	/*!
 * jQuery UI Slider 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Slider
//>>group: Widgets
//>>description: Displays a flexible slider with ranges and accessibility via keyboard.
//>>docs: http://api.jqueryui.com/slider/
//>>demos: http://jqueryui.com/slider/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/slider.css
//>>css.theme: ../../themes/base/theme.css


	var widgetsSlider = $.widget("ui.slider", $.ui.mouse, {
		version: "1.12.1",
		widgetEventPrefix: "slide",

		options: {
			animate: false,
			classes: {
				"ui-slider": "ui-corner-all",
				"ui-slider-handle": "ui-corner-all",

				// Note: ui-widget-header isn't the most fittingly semantic framework class for this
				// element, but worked best visually with a variety of themes
				"ui-slider-range": "ui-corner-all ui-widget-header"
			},
			distance: 0,
			max: 100,
			min: 0,
			orientation: "horizontal",
			range: false,
			step: 1,
			value: 0,
			values: null,

			// Callbacks
			change: null,
			slide: null,
			start: null,
			stop: null
		},

		// Number of pages in a slider
		// (how many times can you page up/down to go through the whole range)
		numPages: 5,

		_create: function () {
			this._keySliding = false;
			this._mouseSliding = false;
			this._animateOff = true;
			this._handleIndex = null;
			this._detectOrientation();
			this._mouseInit();
			this._calculateNewMax();

			this._addClass("ui-slider ui-slider-" + this.orientation,
				"ui-widget ui-widget-content");

			this._refresh();

			this._animateOff = false;
		},

		_refresh: function () {
			this._createRange();
			this._createHandles();
			this._setupEvents();
			this._refreshValue();
		},

		_createHandles: function () {
			var i, handleCount,
				options = this.options,
				existingHandles = this.element.find(".ui-slider-handle"),
				handle = "<span tabindex='0'></span>",
				handles = [];

			handleCount = (options.values && options.values.length) || 1;

			if (existingHandles.length > handleCount) {
				existingHandles.slice(handleCount).remove();
				existingHandles = existingHandles.slice(0, handleCount);
			}

			for (i = existingHandles.length; i < handleCount; i++) {
				handles.push(handle);
			}

			this.handles = existingHandles.add($(handles.join("")).appendTo(this.element));

			this._addClass(this.handles, "ui-slider-handle", "ui-state-default");

			this.handle = this.handles.eq(0);

			this.handles.each(function (i) {
				$(this)
					.data("ui-slider-handle-index", i)
					.attr("tabIndex", 0);
			});
		},

		_createRange: function () {
			var options = this.options;

			if (options.range) {
				if (options.range === true) {
					if (!options.values) {
						options.values = [this._valueMin(), this._valueMin()];
					} else if (options.values.length && options.values.length !== 2) {
						options.values = [options.values[0], options.values[0]];
					} else if ($.isArray(options.values)) {
						options.values = options.values.slice(0);
					}
				}

				if (!this.range || !this.range.length) {
					this.range = $("<div>")
						.appendTo(this.element);

					this._addClass(this.range, "ui-slider-range");
				} else {
					this._removeClass(this.range, "ui-slider-range-min ui-slider-range-max");

					// Handle range switching from true to min/max
					this.range.css({
						"left": "",
						"bottom": ""
					});
				}
				if (options.range === "min" || options.range === "max") {
					this._addClass(this.range, "ui-slider-range-" + options.range);
				}
			} else {
				if (this.range) {
					this.range.remove();
				}
				this.range = null;
			}
		},

		_setupEvents: function () {
			this._off(this.handles);
			this._on(this.handles, this._handleEvents);
			this._hoverable(this.handles);
			this._focusable(this.handles);
		},

		_destroy: function () {
			this.handles.remove();
			if (this.range) {
				this.range.remove();
			}

			this._mouseDestroy();
		},

		_mouseCapture: function (event) {
			var position, normValue, distance, closestHandle, index, allowed, offset, mouseOverHandle,
				that = this,
				o = this.options;

			if (o.disabled) {
				return false;
			}

			this.elementSize = {
				width: this.element.outerWidth(),
				height: this.element.outerHeight()
			};
			this.elementOffset = this.element.offset();

			position = {x: event.pageX, y: event.pageY};
			normValue = this._normValueFromMouse(position);
			distance = this._valueMax() - this._valueMin() + 1;
			this.handles.each(function (i) {
				var thisDistance = Math.abs(normValue - that.values(i));
				if ((distance > thisDistance) ||
					(distance === thisDistance &&
						(i === that._lastChangedValue || that.values(i) === o.min))) {
					distance = thisDistance;
					closestHandle = $(this);
					index = i;
				}
			});

			allowed = this._start(event, index);
			if (allowed === false) {
				return false;
			}
			this._mouseSliding = true;

			this._handleIndex = index;

			this._addClass(closestHandle, null, "ui-state-active");
			closestHandle.trigger("focus");

			offset = closestHandle.offset();
			mouseOverHandle = !$(event.target).parents().addBack().is(".ui-slider-handle");
			this._clickOffset = mouseOverHandle ? {left: 0, top: 0} : {
				left: event.pageX - offset.left - (closestHandle.width() / 2),
				top: event.pageY - offset.top -
				(closestHandle.height() / 2) -
				(parseInt(closestHandle.css("borderTopWidth"), 10) || 0) -
				(parseInt(closestHandle.css("borderBottomWidth"), 10) || 0) +
				(parseInt(closestHandle.css("marginTop"), 10) || 0)
			};

			if (!this.handles.hasClass("ui-state-hover")) {
				this._slide(event, index, normValue);
			}
			this._animateOff = true;
			return true;
		},

		_mouseStart: function () {
			return true;
		},

		_mouseDrag: function (event) {
			var position = {x: event.pageX, y: event.pageY},
				normValue = this._normValueFromMouse(position);

			this._slide(event, this._handleIndex, normValue);

			return false;
		},

		_mouseStop: function (event) {
			this._removeClass(this.handles, null, "ui-state-active");
			this._mouseSliding = false;

			this._stop(event, this._handleIndex);
			this._change(event, this._handleIndex);

			this._handleIndex = null;
			this._clickOffset = null;
			this._animateOff = false;

			return false;
		},

		_detectOrientation: function () {
			this.orientation = (this.options.orientation === "vertical") ? "vertical" : "horizontal";
		},

		_normValueFromMouse: function (position) {
			var pixelTotal,
				pixelMouse,
				percentMouse,
				valueTotal,
				valueMouse;

			if (this.orientation === "horizontal") {
				pixelTotal = this.elementSize.width;
				pixelMouse = position.x - this.elementOffset.left -
					(this._clickOffset ? this._clickOffset.left : 0);
			} else {
				pixelTotal = this.elementSize.height;
				pixelMouse = position.y - this.elementOffset.top -
					(this._clickOffset ? this._clickOffset.top : 0);
			}

			percentMouse = (pixelMouse / pixelTotal);
			if (percentMouse > 1) {
				percentMouse = 1;
			}
			if (percentMouse < 0) {
				percentMouse = 0;
			}
			if (this.orientation === "vertical") {
				percentMouse = 1 - percentMouse;
			}

			valueTotal = this._valueMax() - this._valueMin();
			valueMouse = this._valueMin() + percentMouse * valueTotal;

			return this._trimAlignValue(valueMouse);
		},

		_uiHash: function (index, value, values) {
			var uiHash = {
				handle: this.handles[index],
				handleIndex: index,
				value: value !== undefined ? value : this.value()
			};

			if (this._hasMultipleValues()) {
				uiHash.value = value !== undefined ? value : this.values(index);
				uiHash.values = values || this.values();
			}

			return uiHash;
		},

		_hasMultipleValues: function () {
			return this.options.values && this.options.values.length;
		},

		_start: function (event, index) {
			return this._trigger("start", event, this._uiHash(index));
		},

		_slide: function (event, index, newVal) {
			var allowed, otherVal,
				currentValue = this.value(),
				newValues = this.values();

			if (this._hasMultipleValues()) {
				otherVal = this.values(index ? 0 : 1);
				currentValue = this.values(index);

				if (this.options.values.length === 2 && this.options.range === true) {
					newVal = index === 0 ? Math.min(otherVal, newVal) : Math.max(otherVal, newVal);
				}

				newValues[index] = newVal;
			}

			if (newVal === currentValue) {
				return;
			}

			allowed = this._trigger("slide", event, this._uiHash(index, newVal, newValues));

			// A slide can be canceled by returning false from the slide callback
			if (allowed === false) {
				return;
			}

			if (this._hasMultipleValues()) {
				this.values(index, newVal);
			} else {
				this.value(newVal);
			}
		},

		_stop: function (event, index) {
			this._trigger("stop", event, this._uiHash(index));
		},

		_change: function (event, index) {
			if (!this._keySliding && !this._mouseSliding) {

				//store the last changed value index for reference when handles overlap
				this._lastChangedValue = index;
				this._trigger("change", event, this._uiHash(index));
			}
		},

		value: function (newValue) {
			if (arguments.length) {
				this.options.value = this._trimAlignValue(newValue);
				this._refreshValue();
				this._change(null, 0);
				return;
			}

			return this._value();
		},

		values: function (index, newValue) {
			var vals,
				newValues,
				i;

			if (arguments.length > 1) {
				this.options.values[index] = this._trimAlignValue(newValue);
				this._refreshValue();
				this._change(null, index);
				return;
			}

			if (arguments.length) {
				if ($.isArray(arguments[0])) {
					vals = this.options.values;
					newValues = arguments[0];
					for (i = 0; i < vals.length; i += 1) {
						vals[i] = this._trimAlignValue(newValues[i]);
						this._change(null, i);
					}
					this._refreshValue();
				} else {
					if (this._hasMultipleValues()) {
						return this._values(index);
					} else {
						return this.value();
					}
				}
			} else {
				return this._values();
			}
		},

		_setOption: function (key, value) {
			var i,
				valsLength = 0;

			if (key === "range" && this.options.range === true) {
				if (value === "min") {
					this.options.value = this._values(0);
					this.options.values = null;
				} else if (value === "max") {
					this.options.value = this._values(this.options.values.length - 1);
					this.options.values = null;
				}
			}

			if ($.isArray(this.options.values)) {
				valsLength = this.options.values.length;
			}

			this._super(key, value);

			switch (key) {
				case "orientation":
					this._detectOrientation();
					this._removeClass("ui-slider-horizontal ui-slider-vertical")
						._addClass("ui-slider-" + this.orientation);
					this._refreshValue();
					if (this.options.range) {
						this._refreshRange(value);
					}

					// Reset positioning from previous orientation
					this.handles.css(value === "horizontal" ? "bottom" : "left", "");
					break;
				case "value":
					this._animateOff = true;
					this._refreshValue();
					this._change(null, 0);
					this._animateOff = false;
					break;
				case "values":
					this._animateOff = true;
					this._refreshValue();

					// Start from the last handle to prevent unreachable handles (#9046)
					for (i = valsLength - 1; i >= 0; i--) {
						this._change(null, i);
					}
					this._animateOff = false;
					break;
				case "step":
				case "min":
				case "max":
					this._animateOff = true;
					this._calculateNewMax();
					this._refreshValue();
					this._animateOff = false;
					break;
				case "range":
					this._animateOff = true;
					this._refresh();
					this._animateOff = false;
					break;
			}
		},

		_setOptionDisabled: function (value) {
			this._super(value);

			this._toggleClass(null, "ui-state-disabled", !!value);
		},

		//internal value getter
		// _value() returns value trimmed by min and max, aligned by step
		_value: function () {
			var val = this.options.value;
			val = this._trimAlignValue(val);

			return val;
		},

		//internal values getter
		// _values() returns array of values trimmed by min and max, aligned by step
		// _values( index ) returns single value trimmed by min and max, aligned by step
		_values: function (index) {
			var val,
				vals,
				i;

			if (arguments.length) {
				val = this.options.values[index];
				val = this._trimAlignValue(val);

				return val;
			} else if (this._hasMultipleValues()) {

				// .slice() creates a copy of the array
				// this copy gets trimmed by min and max and then returned
				vals = this.options.values.slice();
				for (i = 0; i < vals.length; i += 1) {
					vals[i] = this._trimAlignValue(vals[i]);
				}

				return vals;
			} else {
				return [];
			}
		},

		// Returns the step-aligned value that val is closest to, between (inclusive) min and max
		_trimAlignValue: function (val) {
			if (val <= this._valueMin()) {
				return this._valueMin();
			}
			if (val >= this._valueMax()) {
				return this._valueMax();
			}
			var step = (this.options.step > 0) ? this.options.step : 1,
				valModStep = (val - this._valueMin()) % step,
				alignValue = val - valModStep;

			if (Math.abs(valModStep) * 2 >= step) {
				alignValue += (valModStep > 0) ? step : (-step);
			}

			// Since JavaScript has problems with large floats, round
			// the final value to 5 digits after the decimal point (see #4124)
			return parseFloat(alignValue.toFixed(5));
		},

		_calculateNewMax: function () {
			var max = this.options.max,
				min = this._valueMin(),
				step = this.options.step,
				aboveMin = Math.round((max - min) / step) * step;
			max = aboveMin + min;
			if (max > this.options.max) {

				//If max is not divisible by step, rounding off may increase its value
				max -= step;
			}
			this.max = parseFloat(max.toFixed(this._precision()));
		},

		_precision: function () {
			var precision = this._precisionOf(this.options.step);
			if (this.options.min !== null) {
				precision = Math.max(precision, this._precisionOf(this.options.min));
			}
			return precision;
		},

		_precisionOf: function (num) {
			var str = num.toString(),
				decimal = str.indexOf(".");
			return decimal === -1 ? 0 : str.length - decimal - 1;
		},

		_valueMin: function () {
			return this.options.min;
		},

		_valueMax: function () {
			return this.max;
		},

		_refreshRange: function (orientation) {
			if (orientation === "vertical") {
				this.range.css({"width": "", "left": ""});
			}
			if (orientation === "horizontal") {
				this.range.css({"height": "", "bottom": ""});
			}
		},

		_refreshValue: function () {
			var lastValPercent, valPercent, value, valueMin, valueMax,
				oRange = this.options.range,
				o = this.options,
				that = this,
				animate = (!this._animateOff) ? o.animate : false,
				_set = {};

			if (this._hasMultipleValues()) {
				this.handles.each(function (i) {
					valPercent = (that.values(i) - that._valueMin()) / (that._valueMax() -
						that._valueMin()) * 100;
					_set[that.orientation === "horizontal" ? "left" : "bottom"] = valPercent + "%";
					$(this).stop(1, 1)[animate ? "animate" : "css"](_set, o.animate);
					if (that.options.range === true) {
						if (that.orientation === "horizontal") {
							if (i === 0) {
								that.range.stop(1, 1)[animate ? "animate" : "css"]({
									left: valPercent + "%"
								}, o.animate);
							}
							if (i === 1) {
								that.range[animate ? "animate" : "css"]({
									width: (valPercent - lastValPercent) + "%"
								}, {
									queue: false,
									duration: o.animate
								});
							}
						} else {
							if (i === 0) {
								that.range.stop(1, 1)[animate ? "animate" : "css"]({
									bottom: (valPercent) + "%"
								}, o.animate);
							}
							if (i === 1) {
								that.range[animate ? "animate" : "css"]({
									height: (valPercent - lastValPercent) + "%"
								}, {
									queue: false,
									duration: o.animate
								});
							}
						}
					}
					lastValPercent = valPercent;
				});
			} else {
				value = this.value();
				valueMin = this._valueMin();
				valueMax = this._valueMax();
				valPercent = (valueMax !== valueMin) ?
					(value - valueMin) / (valueMax - valueMin) * 100 :
					0;
				_set[this.orientation === "horizontal" ? "left" : "bottom"] = valPercent + "%";
				this.handle.stop(1, 1)[animate ? "animate" : "css"](_set, o.animate);

				if (oRange === "min" && this.orientation === "horizontal") {
					this.range.stop(1, 1)[animate ? "animate" : "css"]({
						width: valPercent + "%"
					}, o.animate);
				}
				if (oRange === "max" && this.orientation === "horizontal") {
					this.range.stop(1, 1)[animate ? "animate" : "css"]({
						width: (100 - valPercent) + "%"
					}, o.animate);
				}
				if (oRange === "min" && this.orientation === "vertical") {
					this.range.stop(1, 1)[animate ? "animate" : "css"]({
						height: valPercent + "%"
					}, o.animate);
				}
				if (oRange === "max" && this.orientation === "vertical") {
					this.range.stop(1, 1)[animate ? "animate" : "css"]({
						height: (100 - valPercent) + "%"
					}, o.animate);
				}
			}
		},

		_handleEvents: {
			keydown: function (event) {
				var allowed, curVal, newVal, step,
					index = $(event.target).data("ui-slider-handle-index");

				switch (event.keyCode) {
					case $.ui.keyCode.HOME:
					case $.ui.keyCode.END:
					case $.ui.keyCode.PAGE_UP:
					case $.ui.keyCode.PAGE_DOWN:
					case $.ui.keyCode.UP:
					case $.ui.keyCode.RIGHT:
					case $.ui.keyCode.DOWN:
					case $.ui.keyCode.LEFT:
						event.preventDefault();
						if (!this._keySliding) {
							this._keySliding = true;
							this._addClass($(event.target), null, "ui-state-active");
							allowed = this._start(event, index);
							if (allowed === false) {
								return;
							}
						}
						break;
				}

				step = this.options.step;
				if (this._hasMultipleValues()) {
					curVal = newVal = this.values(index);
				} else {
					curVal = newVal = this.value();
				}

				switch (event.keyCode) {
					case $.ui.keyCode.HOME:
						newVal = this._valueMin();
						break;
					case $.ui.keyCode.END:
						newVal = this._valueMax();
						break;
					case $.ui.keyCode.PAGE_UP:
						newVal = this._trimAlignValue(
							curVal + ((this._valueMax() - this._valueMin()) / this.numPages)
						);
						break;
					case $.ui.keyCode.PAGE_DOWN:
						newVal = this._trimAlignValue(
							curVal - ((this._valueMax() - this._valueMin()) / this.numPages));
						break;
					case $.ui.keyCode.UP:
					case $.ui.keyCode.RIGHT:
						if (curVal === this._valueMax()) {
							return;
						}
						newVal = this._trimAlignValue(curVal + step);
						break;
					case $.ui.keyCode.DOWN:
					case $.ui.keyCode.LEFT:
						if (curVal === this._valueMin()) {
							return;
						}
						newVal = this._trimAlignValue(curVal - step);
						break;
				}

				this._slide(event, index, newVal);
			},
			keyup: function (event) {
				var index = $(event.target).data("ui-slider-handle-index");

				if (this._keySliding) {
					this._keySliding = false;
					this._stop(event, index);
					this._change(event, index);
					this._removeClass($(event.target), null, "ui-state-active");
				}
			}
		}
	});


}));

//decorator for $.fn.dotdotdot plugin, that elliminates a conflict between $.fn.dotdotdot and $.fn.foundation (STM-13198)
;(function() {
    var fn = $.fn.dotdotdot;
    $.fn.dotdotdot = function() {
        $(this).on('DOMNodeRemoved', function(e){
            e.stopPropagation();
        });
        return fn.apply(this, arguments);
    }
})();

//decorator for jquery UI datepicker to resolve resize issue with positioning and blinking cursor issue in IE11 when scrolling page
;(function() {
    var originalDatepicker = $.fn.datepicker;
    $.fn.datepicker = function(opts) {
        //$.datepicker is initialized only once and is never destroyed even when NO any element on a page uses it. So the condition below will be met only once
        if (!$.datepicker.initialized) {
            //datepicker doesn't support position recalculation on resize so the most clear way to work around misaligning issue is to close DP on resize
            $(window).on('resize.stdp', _.throttle(function() {
                if ($.datepicker._datepickerShowing) {
                    $.datepicker._curInst.input.datepicker('hide');
                    $.datepicker._curInst.input[0].blur();
                }
            }, 300));

            //remove focus from DDs input whenever scrolling page to prevent input's cursor from blinking underneeth fixed elements in IE11
            $(window).on('scroll.stdp', _.throttle(function() {
                $.datepicker._datepickerShowing && $.datepicker._curInst.input[0].blur();
            }, 300));
        }
        //remove scroll and resize listeners whenever all DPs on a page are destroyed
        if (typeof opts === 'string' && opts === 'destroy' && $('.hasDatepicker') === $(this).length) {
            $(window).off('scroll.stdp resize.stdp');
        }
        return originalDatepicker.apply(this, arguments);
    }
})();

;(function() {
    //in case if a Foundation tooltip should have a custom class - don't include data-tooltip at the beginning to the element and instead add data-tooltip-with-class="whatever-css-class"
    //usage 1 <element data-tooltip-with-class="custom-class" title="tooltips content"></element> -> autoinitialized with custom-class added to a tooltip
    //usage 2 <element data-tooltip-custom-class="custom-class2" title="tooltips content" ></element> -> should be initialized manually via $('elements-selector').customTooltipClass() and a classname will be taken from data-tooltip-custom-class attr
    $.fn.customTooltipClass = function() {
        var tooltipInitialTpl = Foundation.libs.tooltip.settings.tip_template;
        return $(this).each(function() {
            //class might be taken from either data-tooltip-with-class attribute or from data-tooltip-custom-class
            var customClass = $(this).attr('data-tooltip-with-class') || $(this).attr('data-tooltip-custom-class');
            Foundation.libs.tooltip.settings.tip_template = function (selector, content) {
                return '<span data-selector="' + selector + '" id="' + selector + '" class="' + customClass + ' '
                    + Foundation.libs.tooltip.settings.tooltip_class.substring(1)
                    + '" role="tooltip">' + content + '<span class="nub"></span></span>';
            }
            $(this).attr('data-tooltip', '').removeAttr('data-tooltip-with-class');
            $(this).parent().foundation();
            Foundation.libs.tooltip.settings.tip_template = tooltipInitialTpl;
        });
    }

    //autoinitialize tooltips with custom class
    $(function() {
        $('[data-tooltip-with-class]').customTooltipClass();
    });
})();
// accordion.js
$(document).ready(function () {
    $(function () {
        initReadMoreAccordion();

        $(document).on('click', '.js-st-accordion-link', function (event) {
            event.preventDefault();

            var accordionActiveClass = 'st-accordion__item--active';
            var accordionReadMoreClass = 'st-accordion--read-more';
            var isReadMore = false;

            // Find elements
            var $link = $(this);
            var $accordion = $link.closest('.st-accordion');
            var $item = $link.closest('.js-st-accordion-item');
            var $content = $item.find('.js-st-accordion-content');
            var height = +$(this).data('min-height') || 670;
            var maxLines = +$(this).data('max-lines');

            if (!isNaN(maxLines)) {
                height = getCollapseHeightForLines($content, maxLines);
            }

            // If read more accordion
            if($accordion.hasClass(accordionReadMoreClass)) {
                isReadMore = true;
            }

            if($item.hasClass(accordionActiveClass)) {
                if(isReadMore) {
                    $content.animate({
                        height: height
                    }, 200, function(){ checkBackToTopVisibility(); }); // trigger check if back to top button should be shown
                }
                $item.removeClass(accordionActiveClass);
            } else {
                if(isReadMore) {
                    $content.css({height: '100%'});
                    var contentHeight = $content.height();
                    $content.css({height: height});
                    $content.animate({
                        height: contentHeight
                    }, 200, function(){ checkBackToTopVisibility(); }); // trigger check if back to top button should be shown
                }
                $item.addClass(accordionActiveClass);
            }
        });

        // resize only on breakpoint from mobile to tablet and tablet to mobile
        var windowWidth = $(window).width();

        $(window).on('orientationchange resize', _.debounce(function () {
            if (($(window).width() < 642 && windowWidth > 642) || ($(window).width() > 642 && windowWidth < 642)) {
                $('.js-st-accordion-link').each(function () {
                    var $link = $(this);
                    var $item = $link.closest('.js-st-accordion-item');
                    var accordionActiveClass = 'st-accordion__item--active';
                    if ($item.hasClass(accordionActiveClass)) {
                        $link.click();
                    }
                });
            }
        }, 100));
        // resize end
    });
});


//establish name space for fed functions
var STFED = STFED || {};

//extend STFED with initAccordions function
STFED.accordions = {
    sidebarAccordionRedraw: function (accThis) {
        var _width = $(accThis).width();
        $(accThis).width(_width + 1).trigger('click');
        $(accThis).width(_width);
    },

    // contentAccordionRedraw: function (accThis) {
    //     $(accThis).find('.dataTable').DataTable().draw(false);
    //     var _width = $(accThis).width();
    //     $(accThis).width(_width + 1).trigger('click');
    //     $(window).trigger('resize');
    //     $(accThis).width(_width);
    //     $(accThis).find('.dataTable').DataTable().draw(false);
    //     $(window).trigger('resize');
    // },


    collapsiblePanels: function (context) {
        let intervalChecks = 0;
        context = context || document;

        const checkIntervalAccordion = setInterval(() => {
            intervalChecks++;
            var accordionsMenu = $('.js-st-accordion-menu', context);
            if (accordionsMenu.length) {
                clearInterval(checkIntervalAccordion);
                accordionsMenu.each(function () {
                    var accordion = $(this);
                    var expandAllDrops = accordion.closest('[data-auto-open-all-accordions]').length;

                    // [data-auto-open-all-accordions] attr might be present either on a root accordion <ul> or on any parent el.
                    // Whenever attr is on a root accordion <ul> element - ONLY this certain accordion will be auto expanded
                    // Whenever attr is on any parent level - ALL accordions inside will be auto expanded
                    if (expandAllDrops) {
                        accordion.find('> li > input[type="checkbox"]:not(.js-st-not-collapsible)').prop('checked', true);
                    }

                    $('input[type="checkbox"]:not(.js-st-not-collapsible)', accordion).each(function () {
                        ($(this).prop('checked')) ? $(this).parent('li').addClass('js-st-accordion-expanded') : $(this).parent('li').removeClass('js-st-accordion-expanded');
                    });

                    //detect change in the input[type="checkbox"] value
                    accordion.on('click', 'input[type="checkbox"]:not(.js-st-not-collapsible)', function () {
                        var checkbox = $(this);
                        var isChecked = checkbox.prop('checked');
                        var accordionElement = checkbox.parent('li');

                        if (isChecked) {
                            accordionElement.addClass('js-st-accordion-expanded');
                        } else {
                            accordionElement.removeClass('js-st-accordion-expanded');
                        }
                        var accordionElement = checkbox.parent();
                        var isTable = Boolean(accordionElement.find('.dataTable').length);
                        var isSidebar = Boolean(accordion.hasClass('st-sidebar__category-tree'));
                        var collapseOthers = checkbox.closest('.st-accordion-table-wrapper').data('collapse-others');

                        if (collapseOthers) {
                            accordionElement.siblings('.js-st-accordion-expanded').removeClass('js-st-accordion-expanded').children('input').prop('checked', false).siblings('ul').attr('style', 'display:block;').slideToggle(300, function () {
                                checkBackToTopVisibility();
                            }).prop('checked', false);
                        }

                        if (checkbox.prop('checked')) {
                            var animationCounter = 0;
                            checkbox.parent('li').addClass('js-st-accordion-expanded').children('ul').stop(true, false).attr('style', 'display: none; overflow: hidden;').slideToggle({
                                'duration': 300,
                                'step': $('body').hasClass('js-st-browser-ms') ? function (a) {
                                    animationCounter++;
                                    if (isTable && animationCounter % 6 === 0) {
                                        STFED.accordions.sidebarAccordionRedraw(this);
                                    } else if (isSidebar && (animationCounter === 1 || animationCounter % 5 === 0)) {
                                        STFED.accordions.sidebarAccordionRedraw(this);
                                    } else if (animationCounter % 6 === 0) {
                                        STFED.accordions.sidebarAccordionRedraw(this);
                                    }
                                } : function (a) {
                                },
                                'complete': function () {
                                    $(window).trigger('resize');
                                    $(window).trigger('focus');
                                    $(this).css('width', 0).removeAttr('style');
                                    emitCustomEvent('accordion-content-shown', {}, accordionElement[0]);
                                    checkBackToTopVisibility();
                                }
                            });
                        } else {
                            checkbox.parent('li').removeClass('js-st-accordion-expanded').children('ul').stop(true, false).attr('style', 'display:block;').slideToggle(300, function () {
                                checkBackToTopVisibility();
                            });
                        }
                    });
                });
                if (STFED.sidebar.collapsibleInitializedState == 0 || STFED.sidebar.collapsibleInitializedState == undefined) {
                    STFED.sidebar.collapsibleInitializedState = 1;
                }
            }

            if(intervalChecks > 15 || accordionsMenu.length) {
                clearInterval(checkIntervalAccordion);
            }
        }, 1000);
    },
    initGridColumns: function (context) {
        var $context = $(context || document);

        $context.find('.js-st-accordion-content .grid-columns:not(.is-initialized)').each(function () {
            var $gridColumns = $(this);
            var $columns = $gridColumns.find('> .columns');

            $gridColumns.addClass('is-initialized');

            if ($columns.length === 0) {
                $gridColumns.addClass('single-item');
                $gridColumns.append(
                    $('<div>')
                        .addClass('columns')
                        .append($gridColumns.children())
                );
                $columns = $gridColumns.find('> .columns');
            }

            $columns.each(function () {
                var $column = $(this);
                var $title = $column.find('h5');
                var $rest = $title.nextAll();
                var $header = $('<div class="heading">');
                var $content = $('<div class="description">');

                if ($title.length > 1) {
                    var $children = $title.children().detach();

                    $title.filter(':gt(0)').remove();
                    $title = $column.find('h5');
                    $title.append($children);
                }

                $header.append($title.prevAll().toArray().reverse(), $title);
                $content.append($rest);
                $gridColumns.append($header, $content);
                $column.remove();
            });

            var desktopColumn = 1;
            var desktopRow = 0;
            var tabletColumn = 1;
            var tabletRow = 0;

            $gridColumns.find('.heading').each(function (idx) {
                var currentDesktopRow = desktopRow * 2 + 1;
                var currentTabletRow = tabletRow * 2 + 1;

                var titleStyle = this.style;

                titleStyle.setProperty('--grid-column-lg', desktopColumn);
                titleStyle.setProperty('--grid-row-lg', currentDesktopRow);
                titleStyle.setProperty('--grid-column-md', tabletColumn);
                titleStyle.setProperty('--grid-row-md', currentTabletRow);

                var contentStyle = $(this).next('.description').get(0).style;

                contentStyle.setProperty('--grid-column-lg', desktopColumn);
                contentStyle.setProperty('--grid-row-lg', currentDesktopRow + 1);
                contentStyle.setProperty('--grid-column-md', tabletColumn);
                contentStyle.setProperty('--grid-row-md', currentTabletRow + 1);

                desktopColumn++;
                tabletColumn++;

                if (desktopColumn > 3) {
                    desktopRow++;
                    desktopColumn = 1;
                }
                if (tabletColumn > 2) {
                    tabletRow++;
                    tabletColumn = 1;
                }
            });
        });
    },
    init: function(context){
        context = context || document;

        STFED.accordions.initGridColumns(context);
        STFED.accordions.collapsiblePanels(context);
    }
};

(function($) {

    var once = true;

    var init = function () {
        if(window.lateralMenuLoaded instanceof Promise) {
            window.lateralMenuLoaded.then(function () {

                if(once) {
                    once = false;
                    STFED.accordions.init();
                }
            });
        }
        else {
            if(once) {
                once = false;
                STFED.accordions.init();
            }
        }
    };

    $(init);
    $(document).on('become-visible', init);

})(jQuery);

function getCollapseHeightForLines(content, maxLines) {
    var $content = $(content);
    var lines = 0;

    var headerHeight = $content.find('h4').first().outerHeight(true);
    var subHeaderHeight = 0;
    var $gridColumns = $content.find('.grid-columns');
    var $list = $content.find('.columns ul').first();
    var $listColumn = $content.find('.columns[data-automation-col]').first();
    var $textColumnParagraph = $content.find('.columns > p').first();
    var $multiTextColumnParagraph = $content.find('.columns > .column > p').first();
    var lineHeight = 14;

    if ($content.find('p').length === $content.children(':not(.st-accordion__overlay)').length) {
        var $singleItem = $content.find('p').first();
        lineHeight = parseInt(window.getComputedStyle($singleItem[0]).lineHeight);

        lines = Math.ceil($content.height() / lineHeight);
    } else if ($list.length) {
        var $singleItem = $list.find('li').first();
        lineHeight = parseInt(window.getComputedStyle($singleItem[0]).lineHeight);

        lines = Math.ceil($list.parent().height() / lineHeight);
    } else if ($listColumn.length) {
        var $singleItem = $listColumn.find('li').first();
        lineHeight = parseInt(window.getComputedStyle($singleItem[0]).lineHeight);

        lines = Math.ceil($listColumn.parent().height() / lineHeight);
    } else if ($textColumnParagraph.length) {
        var $parent = $textColumnParagraph.closest('.columns').parent();
        lineHeight = parseInt(window.getComputedStyle($textColumnParagraph[0]).lineHeight);
        subHeaderHeight = $textColumnParagraph.closest('.column, .columns').find('h5').first().outerHeight(true);

        lines = Math.ceil(($parent.height() - subHeaderHeight) / lineHeight);
    } else if ($gridColumns.length > 0) {
        var $firstHeader = $gridColumns.find('.heading:first');
        var $firstParagraph = $gridColumns.find('.heading:first + p:first');

        headerHeight = $firstHeader.outerHeight(true);
        if ($firstParagraph.length > 0) {
            lineHeight = parseInt(window.getComputedStyle($firstParagraph[0]).lineHeight);
        } else {
            lineHeight = 14;
        }
        lines = Math.ceil($gridColumns.height() / lineHeight);
    }

    if (lines > maxLines) {
        return lineHeight * maxLines + headerHeight + subHeaderHeight;
    }

    return 0;
}

function initReadMoreAccordion(context) {
    context = context || document;

    $('.js-st-accordion-link', context).each(function(){
        // Find elements
        var $link = $(this);
        var $item = $link.closest('.js-st-accordion-item');
        var $content = $item.find('.js-st-accordion-content');
        var $toggle = $item.find('.st-accordion__toggle');
        var $shadow = $('.st-accordion__overlay', $content);
        var height = +$(this).data('min-height') || 670;
        var maxLines = +$(this).data('max-lines');

        if (!isNaN(maxLines)) {
            height = getCollapseHeightForLines($content, maxLines);
        }

        var init = function() {
            $content.css({height: null});

            if(height === 0 || $content.height() < height) {
                $shadow.hide();
                $link.hide();
                $toggle.addClass('hidden');
            }
            else {
                $shadow.show();
                $link.show();
                $toggle.removeClass('hidden');
                $content.css({height: height});
            }
        };

        init();

        $(document).on('become-visible', function (event) {
            if ($(event.target).has($link).length > 0) {
                init();
            }
        });
    });
}
//establish name space for fed functions
var STFED = STFED || {};

//extend STFED with initAccordion function
STFED.accordion = {
    hideInactive: function(targetA){
        $(targetA + ' > li:not(.active) > div').hide();
    },
    doit: function(targetA){
        //hide all not active lis
        STFED.accordion.hideInactive(targetA);

        //if +/- is clicked do accordion functions
        $(document).on(
            'click',
            targetA + ' > li > a, ' + targetA + ' > li > label',
            function(e) {
                var $this = $(this);
                if (
                    $(e.target).hasClass('fa-plus') ||
                    $(e.target).hasClass('fa-minus') ||
                    $(e.target).hasClass('fa-chevron-up') ||
                    $(e.target).hasClass('fa-chevron-down') ||
                    $(e.target).hasClass('closed') ||
                    $(e.target).hasClass('opened') ||
                    $(e.target).hasClass('accordion-trigger')
                ){

                    var hasClassActive = $this.parent().hasClass('active');

    /*                if (targetA = '.st-accordion') {
                        $this.parent().parent().children().children('div').slideUp();
                        $this.parent().parent().children().removeClass('active');
                    }*/
                    var parentSecond = $this.parent();
                    var parent = parentSecond && parentSecond.parent();
                    if (hasClassActive) {
                        parentSecond.removeClass('active')
                        $this.siblings().slideUp();
                        if (parent && parent.hasClass("st-accordion-producttree") && parent.find("li.active a span i").length === 0) {
                            $('#showMoreOrLess').text("See all");
                        }
                    } else {
                        parentSecond.addClass('active')
                        $this.siblings().slideDown();
                        if (parent && parent.hasClass("st-accordion-producttree") && parent.find("li.active a span i").length > 0) {
                            $('#showMoreOrLess').text("Show less");
                        }
                    }

                    e.preventDefault();
                }

            }
        );
    },
    hideAll: function(targetA){
        var ASLevelCategory = $('.ASLevelCategory');
        if(ASLevelCategory.find('.fa')[0] == undefined){
            $('#showMoreOrLess').hide();
            return;
        }
        var text = $('#showMoreOrLess').text();
        if(text === "See all") {
            $(targetA + ' > li.active > div').hide();
            ASLevelCategory.parent().removeClass('active');
        }
    },
    showMoreOrLess: function(){
        var showMoreOrLess = $('#showMoreOrLess');
        var text = showMoreOrLess.text();
        var ASLevelCategory = $('.ASLevelCategory');
        if(text === "See all") {
            showMoreOrLess.text("Show less");
            ASLevelCategory.siblings().slideDown();
            ASLevelCategory.parent().addClass('active');
        } else {
            showMoreOrLess.text("See all");
            ASLevelCategory.siblings().slideUp();
            ASLevelCategory.parent().removeClass('active');
        }
    },
    showMoreOrLessOnClick: function(){
        $('#showMoreOrLess').click(function(){
            STFED.accordion.showMoreOrLess();
        });
    },
    init: function(){
        STFED.accordion.doit('.st-accordion');
        STFED.accordion.hideAll('.st-accordion');
        STFED.accordion.showMoreOrLessOnClick();
        if ($('.st-accordion-product-reference').length) {
            STFED.accordion.doit('.st-accordion-product-reference');
        }
    }
};

(function($) {
    STFED.accordion.init();
})(jQuery);
(function ($) {

    initLateralMenuActivityMapRegion();

})(jQuery);


function initLateralMenuActivityMapRegion() {
    if(window.lateralMenuLoaded) {
        window.lateralMenuLoaded.then(injectLateralMenuActivityMapRegion);
    }
    else {
        try {
            injectLateralMenuActivityMapRegion();
        }
        catch(err) {
            console.log(
                "could not inject lateral menu activity map region, reason:",
                err
            );
        }
    }
}

function injectLateralMenuActivityMapRegion() {

    var sidebarPresent = document
        .querySelector("main > div.st-sidebar.st-sidebar--tree");

    // if we have the lateral menu on the page, do the needful
    sidebarPresent && regionSuffix()
        .then(function (suffix) {

            // have to query for the menu again, as it may have been replaced
            var menu = document
                .querySelector("main > div.st-sidebar.st-sidebar--tree");

            if(!menu.getAttribute("id")) {
                menu.setAttribute(
                    "id",
                    "Accordion_Menu_" + suffix
                );
            }
        })
        .catch(function (err) {
            console.log(
                "could not inject activitymap region, error: ", err);
        });

}

/**
 * @returns {Promise<string>}
 */
function regionSuffix() {
    var tokens = window.digitalData.page.pageInfo.breadCrumbs.split(":");
    
    return topMenuData()   
        .then(function (topMenuSets) {

                var match = Object.entries(topMenuSets)
                    .find(function (pair) {
                        return pair[1].some(function (item) {
                            return item.titleEn ===
                                window.digitalData.page.pageInfo.titleEn;
                        });
                    });

                if(match) {

                    var category = match[0];

                    /**
                     * unfortunately there is no functional mapping between
                     * these string, we have to do it manually
                     */
                    if(category === "tools_and_software") {
                        return "Tools_and_Software";
                    }
                    else if(category === "about") {
                        return "About_ST"
                    }

                    return capitalize(category);
                }
                else if(location.href.includes("support")) {
                    return "Support_and_Community";
                }


            return null;
        })
        .then(function (match) {
            if(!match) {
                throw new Error("could not find match for page " + tokens);
            }

            return match;
        });

}


function capitalize(string) {
    var first = string.slice(0, 1), rest = string.slice(1);

    return first.toUpperCase().concat(rest || '');

}

function topMenuData() {

    // unfortunately the ajax call from the top menu itself happens too late to
    // be useful here, we need to make a separate one
    return (fetch("/bin/st/top_menu.en.json")
        .then(function (response) {return response.json();})
        .then(function (raw) {
            var ret = {};

            for(var key in raw) {

                var remote = raw[key];

                if("items" in remote) {
                    ret[key] = flattenTopMenuTree(remote.items);
                }
            }

            return ret;
        }));
}

/**
 * @returns {unknown[]}
 */
function flattenTopMenuTree(categoryRoot) {

    return  reduceTopMenuTree([], {children: categoryRoot})
        .filter(function (item) {return !!item.url;});

}

function reduceTopMenuTree(reduction, current) {

    if(!Array.isArray(current.children)) {
        return reduction;
    }

    reduction.push(current);

    current.children.forEach(function (child) {
        reduceTopMenuTree(reduction, child);
    });

    return reduction;    
}

function lastToken(string, separator) {
    var split = string.split(separator).filter(function (item) {
        return !!item;
    });

    return split.at(-1);
}


/* restore old logic as fallback */
(function ($) {
    $(function () {
        var navigatedRegion = window.sessionStorage.getItem('navigatedRegion');

        var menu = $('.st-sidebar--tree')[0];

        if (navigatedRegion !== null && menu && !menu.getAttribute("id")) {
            menu.setAttribute('id', 'Accordion_Menu_' + navigatedRegion);
        }

        if(window.lateralMenuLoaded) {
            window.lateralMenuLoaded.then(function() {

                $(document).on('click',
                    'aside.st-side-navigation[data-activitymap-region] a[href!="#"], ' +
                    'header .js-st-nav-menu-item[data-activitymap-region] a[href!="#"]',
                    function (event) {
                        var $submenu = $(this).closest('[data-activitymap-region]');

                    window.sessionStorage.setItem('navigatedRegion',
                        $submenu.data('activitymap-region').replace('Top_Menu_', ''));
                });

                var menu = $('.st-sidebar--tree')[0];

                if (navigatedRegion !== null && menu && !menu.getAttribute("id")) {
                    menu.setAttribute('id', 'Accordion_Menu_' + navigatedRegion);
                }
            });
        }

        $(document).on('click',
            'aside.st-side-navigation[data-activitymap-region] a[href!="#"], ' +
            'header .js-st-nav-menu-item[data-activitymap-region] a[href!="#"]',
            function (event) {
                var $submenu = $(this).closest('[data-activitymap-region]');

            window.sessionStorage.setItem('navigatedRegion',
                $submenu.data('activitymap-region').replace('Top_Menu_', ''));
        });
    });
})(jQuery);
$(document).ready(function() {
$(function () {
    var className = 'st-secondary-nav-tabs';
    var renderComponent = _.template(
        "<div class=\"js-slider slider\">" +
            "<% if (typeof tabs !== 'undefined') { %>" +
                "<% _.forEach(tabs, function(tab) { %>" +
                    "<div<%= typeof tab.isActive !== 'undefined' && tab.isActive ? ' class=\"is-active\"' : '' %>>" +
                        "<div class=\"untracked-tab<%= tab.isNew ? ' has-badge badge-right' : ''  %>\">" +
                            "<a title=\"<%= tab.alt %>\" data-section-id=\"<%= tab.sectionId %>\" href=\"<%= tab.hash %>\"><%= tab.title %></a>" +
                            "<% if (tab.isNew) { %>" +
                                "<svg class=\"st-svg st-svg-color--pink st-svg--tab-badge-new\"><use xlink:href=\"#icon-tab-badge-new\"></use></svg>" +
                            "<% } %>" +
                        "</div>" +
                    "</div>" +
                "<% }); %>" +
            "<% } %>" +
        "</div>"
    );

    function createSlider($slider) {
        if ($slider.length) {
            var defaultTabsAmount = $slider.data('default-tabs-amount');
            var allSlides = $('.untracked-tab', $slider);
            var slideAmount = allSlides.length;
            var biggerThanDefaultTabsAmount = (slideAmount > defaultTabsAmount);

            $(".st-tab-content-style-temp").remove();
            $slider.slick({
                arrows: true,
                autoplay: false,
                infinite: false,
                variableWidth: true,
                outerEdgeLimit: true,
                slidesToShow: 1,
                swipeToSlide: true,
                swipe: biggerThanDefaultTabsAmount,
                prevArrow: '<div class="slick-prev"><svg class="st-svg--arrow-tabs"><use xlink:href="#icon-arrow-left-filled"></use></svg></div>',
                nextArrow: '<div class="slick-next"><svg class="st-svg--arrow-tabs"><use xlink:href="#icon-arrow-right-filled"></use></svg></div>',
                responsive: [
                    {
                        breakpoint: 1024,
                        settings: {
                            swipe: true
                        }
                    }
                ]
            });

            $('.slick-slide', $slider).click(function (event) {
                event.preventDefault();

                var sectionId = $(event.target).data('section-id');

                if (sectionId) {
                    tryJumpToSection($(this), sectionId);
                }

                // TODO - Uncomment if we need activity class on slide
                $()
                    .add(this)
                    .add($('.slick-slide', $slider))
                    .removeClass('is-active')
                    .end() // resets chain to first added element
                    .addClass('is-active');
            });

            $(window).on('resize', _.debounce(function () {
                var slidesWidth = _.reduce($('.slick-slide:not(.slick-cloned)', $slider), function (result, slide) {
                    return result + $(slide).outerWidth(true);
                }, 0);

                $slider.find('.slick-next').toggleClass('slick-disabled', $slider.find('.slick-list').width() > slidesWidth);
            }, 250));
        }
    }

    function init($container, $context) {
        // fix secondary tabs for app page L0
        if (!$context.length) {
            $context = $(document.body);
        }

        if ($container.length && $context.length && $context.is(':visible')) {
            var mainTabHash = $context.data('nav-tab-content-id') || '#';
            var activeTab = $container.data('active-tab');

            var tabs = _.map($context.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id], .anchor-section[id]'), function (header) {
                var $header = $(header);
                var sectionId = $header.prop('id');
                var title = ($header.data('anchor-title') || $header.html() || '').replace(/\s+/, ' ').trim();
                var shortTitle = title.split(' ').slice(0, 3).join(' ');
                var isNew = $header.data('is-new') === true;

                return {
                    alt: title,
                    title: title.length > shortTitle.length ? shortTitle + '...' : title,
                    hash: mainTabHash + '&secondary=' + sectionId,
                    sectionId: sectionId,
                    isNew: isNew
                };
            });

            if (activeTab !== undefined && tabs[activeTab]) {
                tabs[activeTab].isActive = true;
            }

            if (tabs.length >= 3) {
                $container.html(renderComponent({
                    tabs: tabs
                }));
                createSlider($container.find('.js-slider'));
            } else {
                $navsContainer = $container.parents('.st-container').first();

                if ($navsContainer.find('.st-row:only-child > .columns:only-child > .st-secondary-nav-tabs:only-child').length === 1) {
                    if ($navsContainer.is(':only-child')) {
                        $navsContainer.parent().remove();
                    } else {
                        $navsContainer.remove();
                    }
                }
            }
        }

        $container.addClass('is-initialized');
    }

    function tryJumpToSection($element, sectionIdValue) {
        var $content = $element.closest('[data-page-content]');
        var sectionId = sectionIdValue;

        if (typeof sectionId === 'undefined' && (index = window.location.hash.indexOf('&secondary=')) > -1) {
            var id = window.location.hash.substr(index).split('=')[1];

            if (id) {
                sectionId = id.split('&')[0];
            }
        }

        if (sectionId) {
            var $section = $(document).find('#' + sectionId);

            var $heightSecondaryTabs = $element.height();
            var $header = $('.js-st-header');
            var $offsetScrollEnd = $heightSecondaryTabs;
            if ($header.hasClass('in-view')) {
                $offsetScrollEnd += $header.height();
            }
            if ($section.length) {
                history.replaceState(null, '', '#' + sectionId);
                window.emitCustomEvent('onstatechange'); // is needed to allow dynamic updating of link hashes in other places 
                $('html, body').animate({
                    scrollTop: $section.offset().top - $offsetScrollEnd
                }, 300);
            }
        }
    }

    function checkEmptySecondary($container) {
        if ($container.is(':empty') || $container.html().trim() === '') {
            init($container, $container.closest('[data-page-content]'));
        } else {
            createSlider($container.find('.js-slider'));
        }
    }

    $('.' + className).each(function () {
        var $container = $(this);

        checkEmptySecondary($container);
        tryJumpToSection($container);
    });

    $(document).on('become-visible', function (event) {

        $(' .' + className, $(event.target)).each(function () {
            var $container = $(this);

            checkEmptySecondary($container);
            tryJumpToSection($container);
        });
    });
});
});

var stslider_initialization = [];
var paramsUrl = location.search;
var tabSlider = $(".js-st-tab__slider");
var isPfProduct = STUtils.isPfProduct();
var defaultNavTab = tabSlider.children()[0];
var path = location.pathname;
var hash = location.hash;
var href = location.href;
var clickedTab;

if ((path.includes('/products.html') || path.includes('/documentation.html')) && (hash === '#products' || hash === '#documentation')) {
    location.hash = '';
    hash = '';
    history.pushState(null, '', location.href.slice(0, -1));
}

if (!isPfProduct && !href.includes('/new/selector.html#products') && !href.includes('/new/selector.html#documentation') && (hash === '#products' || hash === '#documentation')) {
    location.href = location.origin + path.replace('.html', '') + (hash === '#products' ? '/products.html' : '/documentation.html') + paramsUrl;
}

if (path.includes('/products.html') || hash === '#products') {
    clickedTab = 'products';
} else if (path.includes('/documentation.html') || hash === '#documentation') {
    clickedTab = 'documentation';
} else {
    clickedTab = defaultNavTab ? defaultNavTab.dataset.navTabId : "overview";
}

var tabContentHiding_interval = setInterval(function () {
    if ($(".js-st-tab__slider.slick-initialized").length) {
        clearInterval(tabContentHiding_interval);
        $(".st-tab-content-style-temp").remove();
    }
}, 100);

// Setup callback to fix a race condition with resource-hierarchy.js
window.STFED.initAllSlidersRan = new Promise(function (resolve) {
    window.STFED.initAllSlidersRanCb = resolve;
});

$(document).ready(function () {
    requestAnimationFrame(function() {
        requestAnimationFrame(function() {
            var subTabInit = false;
            var slingDynamicIncludeBlocks = $('[id^="dynamic_include_filter_div_"]');
            slingDynamicIncludeBlocks.each(function() {
                $(this).append('<div class="st-loading-spinner"></div>');
            });
            // Define a function to initialize the sliders
            function initSliders() {
                initAllSliders(null, true);
            }
            // Check if the target element exists, and if STFED.navigationTabs is defined, then initialize sliders
            function checkAndInitSliders() {
                console.log("checkAndInitSliders");

                var slingDynamicIncludeBlocks = $('[id^="dynamic_include_filter_div_"]');
                var contentHidden = $('.js-st-tabs-content--hidden').find('[id^="dynamic_include_filter_div_"]');

                if (contentHidden.length === 0 && !subTabInit) {
                    initAllSliders();
                    subTabInit = true
                }

                if (slingDynamicIncludeBlocks && !slingDynamicIncludeBlocks.length && typeof STFED !== 'undefined' && STFED.navigationTabs) {
                    initSliders();
                    observer.disconnect(); // Stop observing DOM changes once sliders are initialized
                }
            }
            // Check if the properties to be checked are already available
            if (slingDynamicIncludeBlocks && !slingDynamicIncludeBlocks.length && typeof STFED !== 'undefined' && STFED.navigationTabs) {
                initAllSliders();
            } else {
                // Create a MutationObserver
                var observer = new MutationObserver(checkAndInitSliders);
                // Start observing changes to the DOM
                observer.observe(document.body, {
                    childList: true, // Observe direct children being added/removed
                    subtree: true,   // Observe all descendants, not just direct children
                });
            }
        })
    })

});

function handleOverviewTabEmpty(childrenCount, $this) {
    if (childrenCount !== 0 && $this.data('nav-tab-content-id') === '#overview') {
        var tabId = $this.data('nav-tab-content-id').slice(1);
        let overviewContent = $('[data-nav-tab-content-id="#overview"]');
        let textContent = overviewContent.clone()    // Clone the item to preserve the original content
                            .find('script') 
                            .remove()                
                            .end()                
                            .text();                
        if (overviewContent && textContent.trim() === '' && window.STFED.overviewHtmlContentStringed) {
            $('.js-st-tab[data-nav-tab-id="' + tabId + '"]', tabSlider).css("display", "none");
            $this.css("display", "none");
        }
    }
}

function initAllSliders(context, skipInitialization) {
    context = context || document;
    //Common Slider
    $('.js-st-slider', context).each(function (index, element) {
        if ($(element).isInViewport()) {
            $(element).slick({
                arrows: true,
                dots: true,
                prevArrow: '<svg class="slick-prev .st-link__icon--arrow-large"><use xlink:href="#icon-arrow-right"></use></svg>',
                nextArrow: '<svg class="slick-next .st-link__icon--arrow-large"><use xlink:href="#icon-arrow-right"></use></svg>'
            });
        } else {
            stslider_initialization[index] = _.debounce(function () {
                if ($(element).isInViewport()) {
                    $(element).slick({
                        arrows: true,
                        dots: true,
                        prevArrow: '<svg class="slick-prev .st-link__icon--arrow-large"><use xlink:href="#icon-arrow-right"></use></svg>',
                        nextArrow: '<svg class="slick-next .st-link__icon--arrow-large"><use xlink:href="#icon-arrow-right"></use></svg>'
                    });
                    $(window).unbind("scroll", stslider_initialization[index]);
                }
            }, 100, {leading: true, trailing: false});
            $(window).bind("scroll", stslider_initialization[index]);
        }
    });

    //events slider
    $('.events-slider, .generic-slider', context).each(function () {
        var slickspeed = 1500;
        var slickautoplay = true;
        var slickautoplayspeed = 3000;

        $(this).removeClass('loading');

        if ($(this).data("slickjs-speed")) {
            slickspeed = $(this).data("slickjs-speed");
        }

        if ($(this).attr("data-slickjs-autoplay")) {
            slickautoplay = $(this).data("slickjs-autoplay");
        }

        if ($(this).data("slickjs-autoplayspeed")) {
            slickautoplayspeed = $(this).data("slickjs-autoplayspeed");
        }
        $(this).slick({
            arrows: false,
            dots: true,
            autoplay: slickautoplay,
            autoplaySpeed: slickautoplayspeed,
            speed: slickspeed
        });

    });

    //NOTE, the parent function is called multiple times (for each new tab content being loaded and other dynamic content to initialize it's context)
    //Make sure to prevent the logic to handle the code below in case if there is no tabSlider element in this context and don't perform doable init for 'clicks' etc.
    if ((!STFED.isCqEditMode || $('.js-st-tab__slider', context).attr('data-init-slider-on-author')) && tabSlider.length) {

        var hideEmptyTabs = function () {
            var $contents = $('.st-page-content.js-st-page-content', context).children('[data-page-content]');

            $contents.each(function () {
                var $this = $(this);
                var $wrapper = $this;
                var $firstChild = $wrapper.children().first().not('div.st-container, div.st-container-wrapper');
                if ($wrapper.children().length === 1 && $firstChild.length !== 0) {
                    $wrapper = $firstChild;
                }
                var $secondaryNavTabsContainer = $('.st-container-wrapper:has(.st-secondary-nav-tabs), .st-container:has(.st-secondary-nav-tabs)', $wrapper).first();
                var $children = $wrapper.children().not($secondaryNavTabsContainer).not('.js-tabs-search').not('.js-table-search').not('.no-items');
                var childrenCount = $children.length;

                var $dynamicContent = $(".dynamic-content", $wrapper);
                if ($dynamicContent.length !== 0) {
                    childrenCount = $dynamicContent[0].children.length;
                }

                handleOverviewTabEmpty(childrenCount, $this);

                if (childrenCount === 0 && !$this.data('contentUrl')) {
                    var tabId = $this.data('nav-tab-content-id').slice(1);
                    $('.js-st-tab[data-nav-tab-id="' + tabId + '"]', tabSlider).detach();
                    $this.remove();
                }
                var href = location.href;
                var meta = document.querySelector('meta[name="robots"][content="noindex"]');

                if (!meta) {
                    var documentationContent = document.querySelector('div[data-nav-tab-content-id="#documentation"]');
                    var productsContent = document.querySelector('div[data-nav-tab-content-id="#products"]');

                    if ((href.includes('/documentation.html') && !documentationContent) || (href.includes("/products.html") && !productsContent)) {
                        var metaTag = document.createElement("meta");
                        metaTag.setAttribute("name", "robots");
                        metaTag.setAttribute("content", "noindex");
                        document.head.appendChild(metaTag);
                    }
                }
            });
        }.bind(this);

        hideEmptyTabs();

        var tabsComponentJs = document.querySelector('.js-st-tabs');
        var tabsComponentPlaceholder = document.querySelector('.st-nav-tabs-placeholder');

        if (tabsComponentJs) {
            tabsComponentJs.style.visibility = 'visible';
        }

        if (tabsComponentPlaceholder) {
            tabsComponentPlaceholder.parentNode.removeChild(tabsComponentPlaceholder);
        }


        window.listenToCustomReplayEvent('fetched-no-items', function (event) {
            var $pageContent = $(event.target).closest('[data-page-content]');
            var $contents = $('.st-page-content.js-st-page-content', context).children('[data-page-content="' + $pageContent.data('page-content') + '"]');
            var i, len, $this, tabId, $tab;

            for (i = 0, len = $contents.length; i < len; i++) {
                $this = $($contents[i]);
                tabId = $this.data('nav-tab-content-id').slice(1);
                $tab = $('.js-st-tab[data-nav-tab-id="' + tabId + '"]', tabSlider);
                if ($tab.length) {
                    $tab.detach();
                }
                $this.remove();
            }
        });

        var currentTabName = (clickedTab === "products" || clickedTab === "documentation") ? '' : window.location.hash;

        var index;
        var liInDiv = false;
        if (~(index = currentTabName.indexOf('?'))) {
            currentTabName = currentTabName.slice(0, index);
        } else if (~(index = currentTabName.indexOf('-t='))) {
            var index2 = currentTabName.indexOf('-page');
            index += 3;
            if (index2 && index2 > index) {
                liInDiv = true;
                currentTabName = '#' + currentTabName.slice(index, index2);
            }
        }

        if (currentTabName) {
            currentTabName = currentTabName.split('&')[0];
        }

        var isValidHash = !isInvalidHash(currentTabName, tabSlider);

        var curTab;

        if (!liInDiv) {
            curTab = $('.js-st-tab[data-nav-tab-id="' + currentTabName.slice(1) + '"]', tabSlider) || tabSlider.children()[0];
        } else {
            curTab = $('a[href="' + currentTabName + '"].st-tabs-tab', tabSlider);

            if (curTab.length) {
                curTab = $(curTab[0]).parent();
            } else {
                curTab = tabSlider.children[0];
            }
        }

        if (!curTab || curTab.length === 0) {
            var array = Array.from(tabSlider.children());

            var el = array.find(function (el) {
                return el.dataset.navTabId === clickedTab
            });

            var index = array.indexOf(el);

            if (clickedTab) {
                curTab = $(tabSlider.children()[index]);
            } else {
                curTab = $(tabSlider.children()[0]);
            }
        }

        var mainTabsHasActivePageContentTab = false;

        $('.slick-slide', context).ready(function () {
            window.sliderReady = true;
        });

        function checkSliderVariablesInitialized() {
            if (tabSlider &&
                tabSlider.hasClass("slick-initialized") &&
                tabSlider.hasClass("slick-slider") &&
                window.sliderReady) {
                curTab.trigger('click');

                window.STFED.initAllSlidersRanCb()
            } else {
                requestAnimationFrame(checkSliderVariablesInitialized);
            }
        }

        requestAnimationFrame(checkSliderVariablesInitialized);

        //tab slider
        tabSlider.each(function () {
            var thisTabSlider = $(this);
            var wrapperShadow = thisTabSlider.data('wrapper-shadow');
            var contentDefault = thisTabSlider.data('content-default');
            var transformSlider = thisTabSlider.data('transform-slider');
            var currentSlide;
            var defaultTabsAmount = thisTabSlider.data('default-tabs-amount');
            var allSlides = $('.js-st-tabs-tab', thisTabSlider);
            var slideAmount = allSlides.length;
            var biggerThanDefaultTabsAmount = (slideAmount > defaultTabsAmount);
            var slideContents = {};
            var sliderId = thisTabSlider.data('slider-id');
            var contentSection = $('.js-st-tabs-content[data-content-slider="' + sliderId + '"]', context);
            var contentHidden = $('.js-st-tabs-content--hidden[data-parent-slider="' + sliderId + '"]', context);
            var hasChangePageContentTabs = false;
            var isMainTabsSlider = sliderId === 'st-nav-tabs--step-1';

            // if there are navigation tabs that change the page content
            if ($('.js-st-page-content', context).length) {
                hasChangePageContentTabs = true;
                var currentPage;
            }

            tabSlider.on('init', function (event, slick) {
                var allslickSlides = $('.slick-slide', thisTabSlider);
                var defaultTab = '';

                //push hidden content into array
                allSlides.each(function (i) {
                    var tabId = $(this).data('tab');
                    var tabContent = contentHidden.find('[data-content="' + tabId + '"]');
                    slideContents[tabId] = tabContent;
                    if (i === 0) {
                        defaultTab = tabId;
                    } else if (contentDefault && tabId === contentDefault) {
                        defaultTab = contentDefault;
                    }
                });

                //Don't remove hidden content from html since it might need to be proccessed by async loaded external scripts and need to exist in html for proccessing
                //Content will be removed anyway whenever a correspondent tab is opened (the exact DOM elements will be appended into .js-st-tab-content container so it will no longer be within hidden area)
                //Fix is needed for STM-14235
                //contentHidden.remove();

                //Set default content when the site loads
                if (contentDefault) {
                    contentSection.children('.js-st-tab-content').detach();
                    if (slideContents[defaultTab].length) {
                        contentSection.append(slideContents[defaultTab])
                    }
                } else {
                    contentSection.slideUp(300);
                }

                //Tab tooltip for init
                // STFED.navigationTabs.initTabTooltip();

                var hasUnspecifiedPageContentTab = hasChangePageContentTabs &&
                    (!currentTabName.slice(1) || currentTabName.slice(1) == 1);

                if (isMainTabsSlider && !isInvalidHash(currentTabName, tabSlider) && !hasUnspecifiedPageContentTab) {
                    mainTabsHasActivePageContentTab = true;
                }

                // if there are navigation tabs that change the page content
                // and the first tab is selected
                if (!mainTabsHasActivePageContentTab &&
                    (isInvalidHash(currentTabName, tabSlider) || hasUnspecifiedPageContentTab)) {
                    STFED.navigationTabs.openPageTab(1);
                }

                // Active State and Change Content
                function updateCurrentSlide(newSlide, tabId) {
                    allslickSlides.removeClass("js-st-active");
                    allSlides.removeClass("js-st-active");
                    newSlide.addClass("js-st-active");
                    STUtils.setActiveTab(tabId);
                    newSlide.parent().addClass("js-st-active");
                }

                function updateContentSection(tabContent, tabId) {
                    if (!wrapperShadow) {
                        contentSection.children('.js-st-tab-content').detach();
                        contentSection.append(tabContent);
                    } else {
                        handleContentSectionWithShadow(tabContent, tabId);
                    }
                }

                function handleContentSectionWithShadow(tabContent, tabId) {
                    if (tabContent && tabContent.length) {
                        thisTabSlider.parent().addClass('js-st-tabs-expanded');
                        contentSection.children('.js-st-tab-content').detach();
                        contentSection.append(tabContent);
                        contentSection.delay(5).slideDown(500);
                        window.emitCustomEvent('tab-submenu-become-visible', {
                            tabId: tabId
                        }, tabContent[0]);
                    } else {
                        thisTabSlider.parent().removeClass('js-st-tabs-expanded');
                        contentSection.slideUp(300);
                    }
                }

                thisTabSlider.on('click', '.slick-slide', function (e, data) {
                    var $this = $(this);
                    if ($this.hasClass('js-st-active')) {
                        e.preventDefault();

                        if (isPfProduct) {
                            location.hash = $this.data('nav-tab-id');
                        }

                        return;
                    }

                    if (isValidHash && $this.data('nav-tab-id')) {
                        clickedTab = $this.data('nav-tab-id');

                        var hashValue = (data && data.hashValue) || '#' + clickedTab;

                        if (hashValue === currentTabName && (addIndex = location.hash.indexOf('&')) > -1) {
                            hashValue += location.hash.substr(addIndex);
                        }

                        if (isPfProduct) {
                            e.preventDefault();
                            location.hash = hashValue;
                        } else {
                            if (clickedTab === 'products' || clickedTab === 'documentation') {
                                return;
                            }

                            var previousTab = $('.js-st-tab.js-st-active').data('nav-tab-id');
                            var defaultNavTabHref = defaultNavTab.getAttribute('href');
                            var defaultNavTabData = defaultNavTab.dataset.navTabId;

                            if ((previousTab === 'products' || previousTab === 'documentation') && (clickedTab !== 'products' || clickedTab !== 'documentation')) {
                                location.href = location.origin + defaultNavTabHref + (clickedTab === defaultNavTabData ? '' : hashValue);
                            } else {
                                e.preventDefault();

                                if (clickedTab === defaultNavTabData) {
                                    location.hash = '';
                                    history.pushState(null, '', location.href.slice(0, -1));
                                } else {
                                    location.hash = hashValue;
                                }
                            }
                        }
                    }

                    e.preventDefault();

                    isValidHash = true;

                    var currentTab = $('.js-st-tabs-tab.js-st-active', context);
                    var currentPage = null;
                    var newSlide = $(".js-st-tabs-tab", this);

                    if (currentTab.length) {
                        currentPage = currentTab;
                        if (newSlide[0] === currentTab[0]) {
                            return;
                        }
                    }

                    var tabId = newSlide.data("tab");
                    var tabContent = slideContents[tabId];

                    updateCurrentSlide(newSlide, tabId);
                    updateContentSection(tabContent, tabId);

                    if (contentSection.find(".js-st-edesign-tabs").length) {
                        reiniteDesignFunctionality();
                    }

                    if ($('[class *= "js-st-tabs-tab-tooltip-"]', context).length !== 0 && $('.js-st-tabs-tab-overview', this).length === 0) {
                        STFED.navigationTabs.removeTabTooltip();
                    }

                    if (newSlide.hasClass("js-st-tabs-tab-products")) {
                        if (!STFED.sidebar.isCategoryHidden) {
                            STFED.sidebar.minimizeCategoryTree();
                            STFED.sidebar.expandProductTree();
                        }
                    } else {
                        if (STFED.sidebar.isCategoryHidden) {
                            STFED.sidebar.expandCategoryTree();
                        }
                    }

                    selectNavTabsLayers(hasChangePageContentTabs, $('.st-nav-tabs-content--tools-software', context));
                    selectNavTabsLayers(hasChangePageContentTabs, $('.st-nav-tabs-content--resources', context));
                    emitCustomEvent('slider-tab-changed', {
                        tabId: tabId,
                        sliderId: sliderId
                    });

                    if (hasChangePageContentTabs) {
                        var newPage = $("div[data-page-nav]", this);
                        if (currentPage) {
                            if (newPage[0] === currentPage[0]) {
                                return;
                            }
                        }
                        STFED.navigationTabs.openPageTab(newPage.data("pageNav"), newPage.data("filterSidebar"));
                    }
                });
            });

            tabSlider.on('setPosition', function (event, slick) {
                //Transform slider of own height
                if (transformSlider) {
                    transformSliderFunction(this);
                }
            });

            if (!skipInitialization) {
                tabSlider.slick({
                    arrows: true,
                    autoplay: false,
                    infinite: false,
                    variableWidth: true,
                    outerEdgeLimit: true,
                    slidesToShow: 1,
                    swipeToSlide: true,
                    swipe: biggerThanDefaultTabsAmount,
                    prevArrow: '<div class="slick-prev"><svg class="st-svg--arrow-tabs"><use xlink:href="#icon-arrow-right"></use></svg></div>',
                    nextArrow: '<div class="slick-next"><svg class="st-svg--arrow-tabs"><use xlink:href="#icon-arrow-right"></use></svg></div>',
                    responsive: [
                        {
                            breakpoint: 1024,
                            settings: {
                                swipe: true
                            }
                        }
                    ]
                });
            } else if (window.initQuickLinksFromSSIComponent) {
                initQuickLinksFromSSIComponent();
                var currentIndex = $('.js-st-tabs-tab.js-st-active').data('page-nav')

                var $selectedSection = $('div[data-page-content="' + currentIndex + '"]');
                if ($selectedSection.length) {
                    STFED.TabActions.initDataTable($selectedSection[0]);
                }
            }
        });
    }

    //consider initial hash in URL invalid if it doesn't match any nav-tab-id
    function isInvalidHash(initialHash, slider) {
        var validIDs = slider.find('[data-nav-tab-id]').map(function () {
            return $.trim($(this).attr('data-nav-tab-id'));
        });
        initialHash = initialHash ? initialHash.replace('#', '') : '';
        return validIDs.get().indexOf(initialHash) == -1;
    }

    function reiniteDesignFunctionality() {
        $('.js-st-edesign-tabs', context).foundation();
        $('.st-edesign__tabs-form', context).foundation();
        formSelectric(context);
        numberInput(context);
    }

    function transformSliderFunction(current) {
        var minusHalfHeight = -$(current).height() / 2;
        $(current).closest('.js-st-tabs:not(.st-nav-tabs--search):not(.st-nav-tabs)').css({
            'transform': 'translateY(' + minusHalfHeight + 'px)',
            'margin-bottom': minusHalfHeight
        });
    }


    //footer slider
    var footerSlider = $(".js-st-footer__slider", context);
    var footerSliderNav = footerSlider.prev();

    var footerDot_interval;

    var footerDot_logical = function () {
        if ($('.st-press-teaser-footer__content', context).isInViewport()) {
            $('.st-press-teaser-footer__content', context).dotdotdot({
                watch: "window"
            });
        } else {
            var footerDot_initialization = _.debounce(function () {
                if ($('.st-press-teaser-footer__content', context).isInViewport()) {
                    $('.st-press-teaser-footer__content', context).dotdotdot({
                        watch: "window"
                    });
                    $(window).unbind("scroll", footerDot_initialization);
                }
            }, 100, {maxWait: 100});
            $(window).bind("scroll", footerDot_initialization);
        }
    };

    footerSlider.on('init', function (event, slick) {
        event.preventDefault();
        $('.st-slick-prev', footerSliderNav).click(function () {
            footerSlider.children('.slick-prev').trigger("click");
        });
        $('.st-slick-next', footerSliderNav).click(function () {
            footerSlider.children('.slick-next').trigger("click");
        });

        if ($("[data-page-content]").length) {
            footerDot_interval = setInterval(function () {
                if ($("[data-page-content]:not(.st-invisible)").length) {
                    clearInterval(footerDot_interval);
                    footerDot_logical();
                }
            }, 500);
        } else {
            footerDot_logical();
        }

    });

    if (footerSlider.isInViewport()) {
        footerSlider.slick({
            arrows: true,
            dots: false,
            accessibility: true
        });
    } else {
        var footerSlider_initialization = _.debounce(function () {
            if (footerSlider.isInViewport()) {
                footerSlider.slick({
                    arrows: true,
                    dots: false,
                    accessibility: true
                });
                $(window).unbind("scroll", footerSlider_initialization);
                $(".st-footer").unbind("mouseover touchstart", footerSlider_initialization);
            }
        }, 100, {maxWait: 100});
        $(window).bind("scroll", footerSlider_initialization);
        $(".st-footer").bind("mouseover touchstart", footerSlider_initialization);
    }

    //landing slider
    $('.js-st-landing-slider', context).slick({
        dots: true,
        speed: 300,
        slidesToShow: 1,
        variableWidth: true,
        adaptiveHeight: true,
        infinite: true,
        arrows: true,
        focusOnSelect: false,
        centerMode: true,
        dotsClass: "st-slider__dots",
        prevArrow: '<svg class="slick-prev .st-link__icon--arrow-large"><use xlink:href="#icon-arrow-right"></use></svg>',
        nextArrow: '<svg class="slick-next .st-link__icon--arrow-large"><use xlink:href="#icon-arrow-right"></use></svg>',
        responsive: [
            {
                breakpoint: 642,
                settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    infinite: true,
                    dots: true,
                    arrows: false
                }
            }
        ]
    });
}

$(document).ready(function() {

    $(".js-st-range-slider").each(function () {
        var rangeSlider = $(this);
        var minRange = rangeSlider.data('min-range');
        var maxRange = rangeSlider.data('max-range');
        var minValue = rangeSlider.data('min-value');
        var maxValue = rangeSlider.data('max-value');
        var rangeStep = rangeSlider.data('step');

        rangeSlider.slider({
            step: rangeStep,
            range: true,
            min: minRange,
            max: maxRange,
            values: [minValue, maxValue],
            slide: function (event, ui) {
                $(".js-st-range-amount-min", rangeSlider).val(ui.values[0]);
                $(".js-st-range-amount-max", rangeSlider).val(ui.values[1]);
            },
            stop: function (event, ui) {
                var parent = $(this).closest('.js-st-parent-checkbox__wrapper');
                var selectWrapper = parent.find('.js-st-range-slider-selected-values');
                var clearBtn = parent.find('.js-st-sidebar-clear-range-slider');

                if(ui.values[0] === minRange && ui.values[1] === maxRange) {
                    resetSliderSelected(selectWrapper, clearBtn);
                } else {
                    showSliderSelected(selectWrapper, clearBtn, ui);
                }
            }
        });

        window.addEventListener("touchmove", ontouchmove, {
            passive: false
        });

        function ontouchmove(e) {
            if (e.cancelable) {
                e.preventDefault();
            }
        }

        $(".js-st-range-amount-min", rangeSlider).val(rangeSlider.slider("values", 0));
        $(".js-st-range-amount-max", rangeSlider).val(rangeSlider.slider("values", 1));
    });

    function showSliderSelected(selectWrapper, clearBtn, ui) {
        selectWrapper.html('<div class="st-tree-checkboxes-selected-elements__element">[' + ui.values[0] + ' - ' + ui.values[1] + ']</div>');
        clearBtn.addClass('st-sidebar__clear-btn--visible');
    }
});

function resetSliderSelected(selectWrapper, clearBtn) {
    selectWrapper.empty();
    clearBtn.removeClass('st-sidebar__clear-btn--visible');
}
STFED.floatTheadTables = $('.sample-and-buy-grid, .quality-grid');
STFED.preventShowingHeader = false;

// Solved in input.js

//$('[placeholder]').focus(function () {
//  var input = $(this);
//  if (input.val() == input.attr('placeholder')) {
//    input.val('');
//    input.removeClass('placeholder');
//  }
//}).blur(function () {
//  var input = $(this);
//  if (input.val() == '' || input.val() == input.attr('placeholder')) {
//    input.addClass('placeholder');
//    input.val(input.attr('placeholder'));
//  }
//}).blur();

$(function () {
    $('#quicklinks').change(function () {
        var target = $(this).val();
        target = $('#' + target.slice(1));
        if (target.length) {
            $('html, body').animate({scrollTop: target.offset().top - 55}, 1000);
            return false;
        }
    });

    //@TODO: check if this is still needed (should't be used in the new design)
    //commercial banner init
    /*if ($('.commercial-banner').length) {
        $('.commercial-banner').each(function () {
            var slickspeed = 500; //transition
            var slickautoplay = true; //autoplay
            var slickautoplayspeed = 3000; //time to next transition

            if ($(this).data("slickjs-speed")) {
                slickspeed = $(this).data("slickjs-speed");
            }

            if ($(this).data("slickjs-autoplay")) {
                slickautoplay = $(this).data("slickjs-autoplay");
            }

            if ($(this).data("slickjs-autoplayspeed")) {
                slickautoplayspeed = $(this).data("slickjs-autoplayspeed");
            }

            $(this).slick({
                arrows: false,
                dots: false,
                autoplay: slickautoplay,
                autoplaySpeed: slickautoplayspeed,
                speed: slickspeed
            });
        });
    }*/

    var emptyComponentContainersToRemove = ['.custom-content-block', '.hero-image-carousel',
        '.product-blocks-container-wrapper', '.resources-container-wrapper'];
    $.each(emptyComponentContainersToRemove, function (index, componentSelector) {
        $(componentSelector).each(function (e) {
            if (!$(this).children().length) {
                $(this).remove();
            }
        });
    });

/*    var navTabsWrapper = $('.js-st-tab__slider');
    var validHash = false;
    var currentItemTab = window.location.hash;
    $('.st-page-content.js-st-page-content').children().each(function (index, item) {
        var $this = $(item);
        if (currentItemTab === $this.attr('data-nav-tab-content-id')) {
            $this.removeClass('hidden');
            $this.attr('data-page-first', true);
            validHash = true;
        }
        else  {
            $this.addClass('hidden');
        }
        if (!$this.find('.st-container').length > 0) {
            navTabsWrapper.find('[data-slick-index=' + index + ']').remove();
        }
    });

    $(document).ready(function () {
        var visibleNavs = $('.js-st-tab__slider');
        if (visibleNavs.find('.slick-slide').length == 1) {
            visibleNavs.hide();
            visibleNavs.parent().css('box-shadow', 'none');
        } else if (visibleNavs.find('.slick-slide').length < 5) {
            visibleNavs.find('.slick-arrow').remove();
        }
        if (currentItemTab && validHash) {
            $('[data-nav-tab-id=' + currentItemTab.substring(1, currentItemTab.length) +
                ']').find('.st-tabs-tab').addClass('js-st-active');
        } else {
            $('.js-st-tab__slider').find('.st-tabs-tab').first().addClass('js-st-active');
            $('[data-page-content=1]').removeClass('hidden');
        }
    });

    $(document).on('click', '.slick-slide', function () {
        var self = $(this);
        history.pushState(null, '', window.location.pathname + '#' + self.attr('data-nav-tab-id'));
    })*/

    //quicklinks
    $(document).on('change', '#quicklinks', function () {
        var $this = $(this);
        var togo = $(this).val();
        var tdef = $('#contentnav').height();
        if ($(togo).find('div:first-child > h2:first-child').length) {
            tdef -= $(togo).find('div:first-child > h2:first-child').outerHeight() + parseInt($(togo).find('div > h2:first-child').css("marginTop"));
        }
        if (togo) {
            $('html, body').animate({
                scrollTop: $(togo).offset().top - tdef
            }, 1000);
        }
    });

    if (("#back-hover-offset").length && $('.switchtag').length) {
        var header = $("#back-hover-offset");
        $(window).scroll(function () {
            var hr = $('.switchtag');
            var hroffset = hr.offset().top;
            var scroll = $(window).scrollTop();
            if (scroll >= hroffset) {
                header.css('height', $('#contentnav').height());
                header.show();
            } else {
                header.hide();
            }
        });
    }

    if ($(".search-sub-select-root").length) {
        $(".search-sub-select-root").change(function () {
            var selected_value = this.value;
            $.each($('.tabs-content').children(), function (i, e) {
                $(e).removeClass('active');
            });
            $('#' + selected_value).addClass('active');
        });
    }

    //expandable reusable
    if ($(".expandable").length) {
        $('.expandable').click(function (e) {
            var target = $(this).closest('.row').next('.row');
            e.preventDefault();
            target.find('.toggable-large').removeClass('large-9').addClass('large-12');
            target.find('.toggable-small').removeClass('large-3').addClass('large-12');
            $(this).addClass('hidden');
            $(this).closest('.row').find('.compressable').removeClass('hidden');
        });
    }

    if ($(".compressable").length) {
        $('.compressable').click(function (e) {
            var target = $(this).closest('.row').next('.row');
            e.preventDefault();
            target.find('.toggable-large').removeClass('large-12').addClass('large-9');
            target.find('.toggable-small').removeClass('large-12').addClass('large-3');
            $(this).addClass('hidden');
            $(this).closest('.row').find('.expandable').removeClass('hidden');
        });
    }

    if ($(".video-img").length) {
        var vidImgTimeout = 0;
        $(document).on('mouseenter', '.video-img', function () {
            var $this = $(this);
            vidImgTimeout = setTimeout(function () {
                $this.children('div.thumbnail-overlay').fadeIn();
            }, 100);
        });
        $(document).on('mouseleave', '.video-img', function () {
            clearTimeout(vidImgTimeout);
            $(this).children('div.thumbnail-overlay').fadeOut();
        });
    }

    if ($('.js-video-container').find('> div.featured-video-box').length >= 2) {
        $('.js-video-container').find('> div.featured-video-box').removeClass('medium-6').addClass('medium-4');
    }

    // read more
    $(document).on('click', '.js-st-read-more', function (e) {
        $(this).css('display', 'none');
        $(this).next('.st-more-content').css('display', 'inline');
        e.preventDefault();
    });

});
//end on ready


$('.fdatepicker').fdatepicker({
    language: 'en'
});


var disableFocusSolutionWidget = _.once(function () {
    if (document.location.search.indexOf('solution=') != -1 &&
        $('.solutions-widget-container.right-rail').length) {
        setTimeout(function () {
            $('html,body').scrollTop(0);
        }, 50);
    }
});

//old code, solved in breadcrumbs.js
// $('.rcrumbs').rcrumbs({animation: {activated: false}});
// $('#breadcrumb-container').addClass('hide-for-small');


//hide right flyout menu if not clicked on trigger or aside element
$('.inner-wrap').click(function(e) {
    if (
        !$(e.target).is('.left-off-canvas-menu') &&
        !$(e.target).closest('.left-off-canvas-menu').length &&
        !$(e.target).is('.left-off-canvas-toggle') &&
        !$(e.target).closest('.left-off-canvas-toggle').length &&
        $('.off-canvas-wrap').hasClass('move-right')

    ) {
        $('.off-canvas-wrap').removeClass('move-right');
    }
});

//ported from productfolder.js
$(document).on('click', '#contentnav:not(.disabled-nav) > a.scrollto', function (e) {
    e.preventDefault();
    history.replaceState({}, '', e.target.href);
    var element = document.getElementById(window.location.hash.replace('#', ''));
    if (element) {
        scrollToSection(window.location.hash);
    }
});

$(document).on('scroll', function () {
    throttledNavScroll();
});

$(window).load(function () {
    //fix overlapping first lines of text after scrolling to element from the top of the page
    // $(window).trigger('resize');

    var element = document.getElementById(window.location.hash.replace('#', ''));
    if (element) {
        scrollToSection(window.location.hash);
    } else {
        window.isAnimating = false;
    }

    $('.subscription-title').dotdotdot({
        ellipsis: '... ',
        wrap: 'letter',
        fallbackToLetter: true,
        watch: true,
        lastCharacter: {
            remove: [' ', ',', ';', '.', '!', '?']
        }
    });

    var uA = window.navigator.userAgent;
    var uAlow = window.navigator.userAgent.toLowerCase();
    var isIE = /msie\s|trident\/|edge\//i.test(uA) && !!(document.uniqueID || document.documentMode || window.ActiveXObject || window.MSInputMethodContext);
    var isEdge = /edge\//i.test(uA) && !(document.documentMode) && !!window.StyleMedia;
    function checkIE () {
        var myNav = navigator.userAgent.toLowerCase();
        return (myNav.indexOf('msie') != -1) ? parseInt(myNav.split('msie')[1]) : false;
    }
    if (isIE || isEdge) {
        $('body').addClass('js-st-browser-ms');
        if(checkIE() && checkIE() >= 9) {
            $('body').addClass('js-st-ms-9');
        }
        // console.log(/msie\s|trident\/|edge\//i.test(uA));
    }
});

//hide left flyout menu if not clicked on trigger or aside element
$(window).on('resize', function (e) {
    $('.tooltip').hide();
    $('.has-tip.open').removeClass('open');
    throttledNavScroll();
    equalizerProductBlocks();
});

var throttledNavScroll = _.throttle(function () {
    var navElements = $('#contentnav:not(.hidden)');
    if (navElements.length && $(window).width() > 641) {
        highlightStickyTab();
    }
}, 100, {trailing: true});

function scrollToSection(id) {
    var contentNav = $('#contentnav');
    var activeLink = contentNav.find('a.scrollto[href="' + id + '"]');
    var navHeight = $(window).width() < 624 ? 0 : contentNav.height();

    contentNav.find('a.scrollto.active').removeClass('active');
    activeLink.addClass('active');

    if (activeLink.hasClass("buy") || activeLink.hasClass("samples")) {
        testForAccodionClosures(activeLink);
    }

    window.isAnimating = true;
    $('html, body').stop().animate({
        scrollTop: Math.ceil($(id).offset().top - navHeight)
    }, 1000, function () {
        setTimeout(function () {
            window.isAnimating = false;
        }, 100);
    });
}

// pass as a parameter a section with the closest class '.js-auto-scroll'
function scrollToPageSection(context, preventShowHeader) {
    context = context || document;
    var $target = $(context).closest('.js-auto-scroll'); //target point for scrolling

    if ($target.length) {
        var $offsetScroll = 0;
        var $searchSection = $('.js-navigation-tabs-context:visible');

        if ($searchSection.length) {
            var $searchSectionHeight = $searchSection.height() || 0;
            $offsetScroll += $searchSectionHeight;
        }

        var targetStart = $target.offset().top - $offsetScroll;

        if (typeof window.emitCustomEvent !== 'undefined') {
            window.emitCustomEvent('scrolled-to-section', {}, $target[0]);
        }

        STFED.preventShowingHeader = preventShowHeader || false;

        $('html').animate({
            scrollTop: targetStart
        }, 300, function() {
            setTimeout(() => STFED.preventShowingHeader = false, 200)
        });
    }
}

function testForAccodionClosures($this) {
    if ($this.hasClass("buy")) {
        $('#panel6').addClass('active').closest('.accordion-navigation').addClass('active');
        $('#panel7').removeClass('active').closest('.accordion-navigation.active').removeClass('active');
    }
    else if ($this.hasClass("samples")) {
        $('#panel7').addClass('active').closest('.accordion-navigation').addClass('active');
        $('#panel6').removeClass('active').closest('.accordion-navigation.active').removeClass('active');
    }
}

function highlightStickyTab() {
    if (!window.isAnimating) {
        $('.nav-related').each(function (key, el) {
            var stickyPanel = $('#contentnav');
            var isBottomPosition = $(window).scrollTop() + $(window).height() >= $(document).height(),
                elPostition = ($(el).offset().top - stickyPanel.height() - $(window).scrollTop()),
                isCrossed = (elPostition < 0) && (elPostition > -$(el).height());

            if (typeof window.isAnimating !== "undefined" && (isBottomPosition || isCrossed)) {
                var blockId = $(el).find('div:first').attr('id');
                var linkTarget = $("a[href='#" + blockId + "']");
                if (linkTarget && !linkTarget.hasClass('hidden')) {
                    stickyPanel.find('a.active').removeClass('active');
                    linkTarget.addClass('active');
                    // history.replaceState({}, '', linkTarget.attr('href'));
                }
            }
        });
    }
}

$(document).on('click', '.panel-news-and-highlights .s-see-more a.see-more', function (e) {
    e.preventDefault();

    var list = $(e.target).closest('.s-see-more').prev(),
        listHeight = list.height(),
        hiddenLis = list.find('p').not(':visible'),
        nextLis = hiddenLis.slice(0, 3),
        nextLisHeight = 0;

    for (var i = 0; i < nextLis.length; i++) {
        nextLisHeight += $(nextLis[i]).outerHeight(true);
    }

    list.css({'height': listHeight});
    nextLis.show();
    list.animate({'height': listHeight + nextLisHeight}, 'slow', function () {
        list.css({'height': ''});
    });

    if (hiddenLis.length <= 3) {
        $(e.target).hide('fast');
    }
});

var siteMapTabs = $('.site-map-tabs'),
    siteMapTabsLength = siteMapTabs.find('.site-map-tab').length;

if (siteMapTabsLength == 1) {
    siteMapTabs.addClass('one');
} else if (siteMapTabsLength == 2) {
    siteMapTabs.addClass('two');
} else if (siteMapTabsLength == 3) {
    siteMapTabs.addClass('three');
}

equalizerProductBlocks();

function equalizerProductBlocks() {
    $('[data-st-equalizer]').each(function () {
        var targetElements = $(this).find('[data-st-equalizer-watch]');
        var maxHeight = 0;

        targetElements.each(function () {
            var elementHeight = $(this).height();
            if (maxHeight < elementHeight) {
                maxHeight = elementHeight;
            }
        });

        targetElements.css('min-height', maxHeight);
    });
}
$(document).ready(function () {
	(function($) {
		// mobile search
		$('.js-st-search-toggle').on('click', function() {
			var transitionEnd = 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend';
			var mobilesearch = $('.js-st-search--mobile');

			if($('.js-st-search--mobile').hasClass('block')) {
				mobilesearch.removeClass('fade-in');
				mobilesearch.removeClass('block');
			} else {
				mobilesearch.addClass('block').outerWidth(); // Reflow
				mobilesearch.addClass('fade-in').one(transitionEnd, function() {});
			}

			$('.js-st-search-toggle').toggleClass('active');
			$('body').toggleClass('noscroll');
			if($('.js-st-sidebar-active').length) {
				closeSidebar();
			}

			$(this).parents().eq(4).find(".st-search__input").focus();
		});
	})(jQuery);
});
function closeMobileSearch() {
	if($('.js-st-search--mobile').hasClass('block')) {
		$('.js-st-search--mobile').removeClass('fade-in');
		$('.js-st-search--mobile').removeClass('block');
	}

	$('.js-st-search-toggle').removeClass('active');
}


// old navigation

//(function($) {
//    "use strict";
//    $('body').on('click', function() {
//        if ($('.sf-menu>li>ul:visible').length) {
//            $('.sf-js-enabled').superclick('reset');
//        }
//    });
//})(jQuery);


(function($) {
    "use strict";

    $('#accordion-home > li > a').on('click', function(e) {
        var $this = $(this);
        if ($this.children('.text-closed').hasClass('hide')) {
            $this.children('.text-closed').removeClass('hide');
            $this.children('.text-opened').addClass('hide');
        } else {
            $this.children('.text-closed').addClass('hide');
            $this.children('.text-opened').removeClass('hide');
        }
        $(window).trigger("content-changed");
    });

    $('.accordion-navigation > a').on('click', function(e) {
        $(window).trigger("content-changed");
    });
})(jQuery);

//establish name space for fed functions
var STFED = STFED || {};

//extend STFED with edesign method
STFED.edesign = {
    activeClass: 'slick-active',
    currentClass: 'slick-current',
    contentActiveClass: 'active',
    initTabs: function($this) {
        var $slider = $this.find('.js-st-edesign-tabs');
        var $contentPanes = $('.st-edesign__tabs-content .content', $this);

        $slider.slick({
            arrows: false,
            autoplay: false,
            infinite: false,
            variableWidth: true,
            outerEdgeLimit: true,
            slidesToShow: 7,
            swipeToSlide: true,
            swipe: true,
            prevArrow: '<div class="slick-prev"><svg class="st-svg--arrow-tabs"><use xlink:href="#icon-arrow-left-filled"></use></svg></div>',
            nextArrow: '<div class="slick-next"><svg class="st-svg--arrow-tabs"><use xlink:href="#icon-arrow-right-filled"></use></svg></div>',
            responsive: [
                {
                    breakpoint: 768,
                    settings: {
                        arrows: true,
                        slidesToShow: 4,
                    }
                }
            ]
        });

        if ($contentPanes.filter('.' + this.contentActiveClass).length === 0) {
            $contentPanes.first().addClass(this.contentActiveClass);
        }

        $slider.on('beforeChange', this.onBeforeSlideChange);
        $('.slick-slide', $slider).click(this.onSlideClick);
        if (this.boundSliderArrowsUpdater) {
            $(window).off('resize', this.boundSliderArrowsUpdater);
        }
        this.boundSliderArrowsUpdater = this.updateSliderArrows.bind(this, $slider);
        this.boundSliderArrowsUpdater();
        $(window).on('resize', this.boundSliderArrowsUpdater);
    },
    updateTabsClasses: function ($slide) {
        $slide
            .siblings()
            .removeClass(this.currentClass);

        $slide.addClass(this.currentClass);

        var $pane = $('.st-edesign__tabs-content .content[id="' + $slide.find('a').attr('href').substr(1) + '"]');

        $pane
            .siblings()
            .removeClass(this.contentActiveClass);

        $pane.addClass(this.contentActiveClass);
    },
    onBeforeSlideChange: function (event, slick, currentSlide, nextSlide) {
        this.updateTabsClasses($('.js-st-edesign-tabs .slick-slide[data-slick-index="' + nextSlide +'"]'));
    },
    onSlideClick: function (event) {
        event.preventDefault();

        this.updateTabsClasses($(event.currentTarget));
    },
    updateSliderArrows: _.debounce(function ($slider) {
        var slidesWidth = _.reduce($('.slick-slide:not(.slick-cloned)', $slider), function (result, slide) {
            return result + $(slide).outerWidth(true);
        }, 0);

        $slider.find('.slick-next').toggleClass('slick-disabled', $slider.find('.slick-list').width() > slidesWidth);
    }),
    //adjusts [name] on inputs to their current index after additon or removal
    resetNameOrder: function($this,$subChild){
        $this.closest('fieldset').find($subChild).each(function(i){
            var type;
            if ($(this).hasClass('output-v')){
                type = ".v";
            }
            else {
                type = ".i";
            }
            $(this).attr('name',"msg.data.specs.output." + i + type);
        });
    },
    //transitioned math round function
    roundValue: function(val){
        var dec = 2;
        var result = Math.round(val * Math.pow(10, dec)) / Math.pow(10, dec);
        return result;
    },
    //mostly ported math from eds.js
    updateTotalPower: function($currentForm){
        var wattageTotal = 0;
		var outputTag = $currentForm.find(".output-power");
        for (var i = 0; i < $currentForm.find('fieldset > .editable-row').length; i++) {
            var tempvol = $currentForm.find('input[name="msg.data.specs.output.' + i + '.v"]').val();
            var tempcur = $currentForm.find('input[name="msg.data.specs.output.' + i + '.i"]').val();
            wattageTotal += tempvol * tempcur;
        }
        if (isNaN(wattageTotal)) {
            wattageTotal = 0;
        }
        if (wattageTotal != 0) {
            if (wattageTotal > 1000) {
				outputTag.text(outputTag.data("label") + STFED.edesign.roundValue(wattageTotal / 1000) + " kW");
            } else {
				outputTag.text(outputTag.data("label") + STFED.edesign.roundValue(wattageTotal) + " W");
            }
        } else {
			outputTag.text("");
        }
    },
    //mostly ported math from eds.js
    updateLEDTotal: function($currentForm){
        var VF = $currentForm.find('[name="msg.data.specs.led.VF"]').val();
        var IF = $currentForm.find('[name="msg.data.specs.led.IF"]').val();
        //update IF if DC DC
        if ($currentForm.find('[name="msg.data.specs.numLed.parallel"]').not('.not-for-urlarray').val()){
            IF = IF * $currentForm.find('[name="msg.data.specs.numLed.parallel"]').not('.not-for-urlarray').val();
        }

        var numSerie = $currentForm.find('[name="msg.data.specs.numLed.serie"]').val();
        var localVoltage = VF * numSerie;
        var W = localVoltage * IF;
		var outputTag = $currentForm.find('.ledvoltage-output');

        if (localVoltage < 1000 && localVoltage != "") {
			outputTag.text(outputTag.data("label") + STFED.edesign.roundValue(localVoltage) + " V");
        } else if (localVoltage != "") {
			outputTag.text(outputTag.data("label") + STFED.edesign.roundValue(localVoltage / 1000) + " kV");
        } else {
			outputTag.text("");
        }

        if (IF < 1000 && IF != "") {
            $currentForm.find('.ledcurrent-output').text(STFED.edesign.roundValue(IF) + " A");
        } else if (IF != "") {
            $currentForm.find('.ledcurrent-output').text(STFED.edesign.roundValue(IF / 1000) + " kA");
        } else {
			$currentForm.find('.ledcurrent-output').text("");
        }
        if (W < 1000 && W != "") {
            $currentForm.find('.ledpower-output').text(STFED.edesign.roundValue(W) + " W");
        } else if (W != "") {
            $currentForm.find('.ledpower-output').text(STFED.edesign.roundValue(W / 1000) + " kW");
        } else {
			$currentForm.find('.ledpower-output').text("");
        }
    },
    submit: function($currentForm){
        //set results address, pulled from 'action' attribute on form tag
        var resultAddress = $currentForm.attr('action');
        //set sub action address, pulled from 'data-sub-action' attribute on form tag
        var subActionAddress = $currentForm.data('sub-action');
        //init url array
        var urlarray = [];
        var rpn = window.rpn || "";
        var resultlogo = window.resultlogo || "";
        var urlstring;
        var ajaxurl;

        //set by inline js, adds CPN like "VIPER17" to query string
        if ($.trim(rpn) != '') {
            urlarray.push("rpn=" + rpn);
        }

        //set by inline js, adds resultlogo to string (untested)
        if ($.trim(resultlogo) != '') {
            urlarray.push("resultlogo=" + resultlogo);
        }

        //gather applicable values from current form, items with class not-for-urlarray are ignored
        urlarray.push($currentForm.find('input, select').not('.not-for-urlarray').serialize());

        //for filters tab: set urlstring and recordParams
        //if ($currentForm.hasClass('filters')){
        //    var currentSubTab = $currentForm.find('input[name="filter"]:checked').val();
        //    urlstring = resultAddress + currentSubTab + "/" + urlarray.join("&");
        //    ajaxurl= subActionAddress + currentSubTab + '&' + urlarray.join("&");
        //}
        //for antenna tab: set urlstring and recordParams
        //else if ($currentForm.hasClass('antenna')) {
        //    urlstring = resultAddress + urlarray.join("&");
        //    ajaxurl = subActionAddress + urlarray.join("&");
        //}
        //for other tabs: set urlstring
        //else {

        var domain = "https://eds.st.com/";

        if ($currentForm.hasClass('signalconditioning')) {
            var application = $currentForm.find('input[name="application"]:checked').val();
            var data = {};
            $currentForm.find('.filter').find('input, select').not('.not-for-urlarray').serializeArray().map(function(x){
                data[x.name] = x.value;
            });
            if (application === 'filter') {
                var specs = ',"specs":'+JSON.stringify(data);
            } else if (application === 'comparator') {
                var comparator = $currentForm.find('input[name="comparator"]:checked').val();
                var specs = ',"specs":{"type":"'+comparator+'"}';
            }
            var link = '{"data":{"application":"'+application+'_html"' + (specs || '') +'},"action":"new_design"}';
            urlstring = domain + application + "/?msg=" + link;
        } else if ($currentForm.hasClass('simulator')) {
            var simulator = $currentForm.find('input[name="radio-choice"]:checked').val();
            switch (simulator) {
                case 'triacs':
                    urlstring = 'https://eds.st.com/acswitch/#/';
                    break;
                case 'diodes':
                    urlstring = 'https://eds.st.com/schottkyferd/';
                    break;
                case 'powerstudio':
                    urlstring = 'https://www.st.com/content/st_com/en/products/embedded-software/evaluation-tool-software/stsw-powerstudio.html';
                    break;
                default: break;
            }
        } else if ($currentForm.hasClass('photovoltaic')) {
            var section = "photovoltaic";

            var value = {};
            var thisForm = $currentForm.find('input, select').not('.not-for-urlarray');
            thisForm.each(function() {
                value[this.name] = $(this).val();
            });

            var specs = '{"ic":"' + value.ic + '","vinRipple":"' + value.vinRipple + '","panel":{"vmp":"' + value.vmp + '","voc":"' + value.voc + '","isc":"' + value.isc + '","imp":"' + value.imp + '"},"output":[{"v":"' + value.v + '","i":"' + value.i + '","r":"' + value.r + '"}]}';

            var link = '{"data":{"application":"'+section+'_html", "specs":' + specs +'},"action":"new_design"}';
            urlstring = domain + section + "/?msg=" + link;
        } else {
            if(resultAddress.indexOf('?') !== -1){
                urlstring = resultAddress + "&" + urlarray;
            } else {
                urlstring = resultAddress + "?" + urlarray;
            }
        }
        //}

        //record antenna and filters ajax inputs, unused? Can't find this functionality in live build
        if ($currentForm.hasClass('antenna') || $currentForm.hasClass('filters')){
            try {
                jQuery.ajax({
                    url: ajaxurl,
                    dataType : "text",
                    crossDomain: true,
                    cache : false,
                    async: true,
                    success: function (data) {
                    }
                });
            } catch (e) {}
        }

        if (typeof _satellite !== 'undefined') {
            _satellite.track('targettesting');
        }

        window.open(urlstring, '_blank');

    },
    dcdcACDCInit: function(context){
        context = context || document;

        //test if dcdc or acdc, show as set in STFED.edesign.dcdcACDCSelector
        $('.dcdc-acdc-selector:checked', context).each(function(){
            STFED.edesign.dcdcACDCSelector($(this));
        });
    },
    dcdcACDCSelector: function($this){
        var v = $this.val();
        var $thisFormContentACDC = $this.closest('form').find('.acdc-settings');
        var $thisFormContentDCDC = $this.closest('form').find('.dcdc-settings');
        var $thisForm =  $this.closest('form');

        if (v == "dcdc" || v == "led_dcdc") {
            $thisFormContentACDC.slideUp().find('input[name="msg.data.specs.input.f"]').addClass('not-for-urlarray');
            $thisFormContentDCDC.slideDown().find('input[name="msg.data.specs.numLed.parallel"]').removeClass('not-for-urlarray');
            STFED.edesign.updateLEDTotal($thisForm);
        }
        else {
            $thisFormContentACDC.slideDown().find('input[name="msg.data.specs.input.f"]').removeClass('not-for-urlarray');
            $thisFormContentDCDC.slideUp().find('input[name="msg.data.specs.numLed.parallel"]').addClass('not-for-urlarray');
            STFED.edesign.updateLEDTotal($thisForm);
        }
    },
    eventHandlers: function(){
        $(document).on('change', '.st-edesign .dcdc-acdc-selector', function(){
            var $this = $(this);

            STFED.edesign.dcdcACDCSelector($this);

            var radioValue = $this.val();
            var $thisForm =  $this.closest('form');

            $thisForm.attr('action', $this.data('action-path'));
        });

        //ste-main blocks
        $(document).on('click', '.ste-main', function (e) {
            var m = $(this).val();
            var $thisFormContent = $(this).closest('form');
            $thisFormContent.find('.ste-sub-block').hide();
            $thisFormContent.find('.' + m).fadeIn();

            $('.ste-sub-block').find('.force-numeric').removeAttr('required').removeAttr('data-abide-validator');
            $('.' + m).find('.force-numeric').attr('required','');

            if (m === 'filter') {
                var v = $thisFormContent.find('input[name="filterType"]:checked').val();
                if (v === "bandpass") {
                    $thisFormContent.find('.band-settings').slideDown().find('input').attr('required','').removeClass('not-for-urlarray');
                } else {
                    $thisFormContent.find('.band-settings').slideUp().find('input').removeAttr('required').val('').addClass('not-for-urlarray');
                }
            }
        });
        //edesign-panel-g
        $(document).on('click', '.pass-selector', function (e) {
            var v = $(this).val();
            var $thisFormContent = $(this).closest('form');
            $thisFormContent.find('.pass-selector-img').hide();
            $thisFormContent.find('.select-' + v).fadeIn();

            if (v == "bandpass") {
                $thisFormContent.find('.band-settings').slideDown().find('input').attr('required','').removeClass('not-for-urlarray');
            }
            else {
                $thisFormContent.find('.band-settings').slideUp().find('input').removeAttr('required').val('').addClass('not-for-urlarray');
            }
            STFED.foundation.init();
        });

        //adds and deletes rows for output
        $(document).on('click', '.st-edesign .add-remove-output-row', function(e) {
            e.preventDefault();

            var $this =  $(this);
            var $thisForm =  $this.closest('form');
            var $container = $this.closest('fieldset');
            //if click on subtract row:
            if ($this.hasClass('minus')) {
                $this.closest('.editable-row').remove();
            }
            //test to see if less than 5 rows
            else if($container.find('> .editable-row').length < 5){
                //append rows
                $container.find('> .editable-row:last').after($this.closest('form').next('.output-row-template').find('.output-row').clone());
            }

            STFED.edesign.resetNameOrder($container, 'input.output-v');
            STFED.edesign.resetNameOrder($container, 'input.output-i');
            STFED.edesign.updateTotalPower($thisForm);
            $thisForm.foundation('abide');
            STFED.foundation.init();
        });

        //update total power on key up or blur
        $(document).on('keyup blur', '.st-edesign .editable-row input', function(e){
            STFED.edesign.updateTotalPower($(this).closest('form'));
        });

        //update total power on key up or blur
        $(document).on('keyup blur', '.st-edesign .led-total input', function(e){
            STFED.edesign.updateLEDTotal($(this).closest('form'));
        });

        //force numeric, shift key, comma, dot entry only
        $(document).on('keydown', '.st-edesign .force-numeric', function(e){
            var key = e.which || e.keyCode;

            if (!e.altKey && !e.ctrlKey &&
                    // numbers
                key >= 48 && key <= 57 ||
                    // Numeric keypad
                key >= 96 && key <= 105 ||
                    // period and minus, . on keypad key == 190 ||
                key == 190 || key == 109 || key == 110 ||
                    // Backspace and Tab and Enter
                key == 8 || key == 9 || key == 13 ||
                    // Home and End
                key == 35 || key == 36 ||
                    // left and right arrows
                key == 37 || key == 39 ||
                    // Del and Ins
                key == 46 || key == 45 ||
                    // Comma and Shift
                key == 188 || e.shiftKey ) return true;

            return false;
        });

        //voltage-presets, converted from inline js to data on options
        $(document).on('change blur selectric-change selectric-select', '.use-voltage-presets', function () {
            var $this = $(this).find('option:selected');
            if ($this.index() != 0) {
                //turn off click handlers for reset voltage preset
                $(document).off('keydown change', '.st-edesign .reset-voltage-preset');
                $this.closest('fieldset').find($this.data('hz')).click();
                $this.closest('fieldset').find('[name="msg.data.specs.input.v.min"]').val($this.data('volt-min')).trigger('change');
                $this.closest('fieldset').find('[name="msg.data.specs.input.v.max"]').val($this.data('volt-max')).trigger('change');
                $this.closest('fieldset').find('input[name]').addClass('reset-voltage-preset');
                //resetablish event handlers for reset voltage preset (on chagne or keydown turn off preset)
                $(document).on('keydown change', '.st-edesign .reset-voltage-preset', function(e){
                    var $this = $(this).closest('fieldset');
                    $this.find('.use-voltage-presets').find('option:eq(0)').prop('selected', true);
                    $this.find('.reset-voltage-preset').removeClass('reset-voltage-preset');
                });
            }
        });

        //submission
        $(document).on('submit', '.st-edesign form', function (e) {
            e.preventDefault();
            STFED.edesign.submit($(this));
        });
    },
    init: function(context) {
        context = context || document;

        this.eventHandlers();
        STFED.edesign.dcdcACDCInit(context);
        $('.st-edesign', context).each(function () {
            STFED.edesign.initTabs($(this));
        });
    }
};

STFED.edesign.onBeforeSlideChange = STFED.edesign.onBeforeSlideChange.bind(STFED.edesign);
STFED.edesign.onSlideClick = STFED.edesign.onSlideClick.bind(STFED.edesign);

$(document).ready(function() {
    (function($) {
        STFED.edesign.init();
    })(jQuery);
});
//find polyfill
Array.prototype.find = Array.prototype.find || function() {
    Object.defineProperty(Array.prototype, 'find', {
        value: function(predicate) {
            // 1. Let O be ? ToObject(this value).
            if (this == null) {
                throw new TypeError('"this" is null or not defined');
            }

            var o = Object(this);

            // 2. Let len be ? ToLength(? Get(O, "length")).
            var len = o.length >>> 0;

            // 3. If IsCallable(predicate) is false, throw a TypeError exception.
            if (typeof predicate !== 'function') {
                throw new TypeError('predicate must be a function');
            }

            // 4. If thisArg was supplied, let T be thisArg; else let T be undefined.
            var thisArg = arguments[1];

            // 5. Let k be 0.
            var k = 0;

            // 6. Repeat, while k < len
            while (k < len) {
                // a. Let Pk be ! ToString(k).
                // b. Let kValue be ? Get(O, Pk).
                // c. Let testResult be ToBoolean(? Call(predicate, T, « kValue, k, O »)).
                // d. If testResult is true, return kValue.
                var kValue = o[k];
                if (predicate.call(thisArg, kValue, k, o)) {
                    return kValue;
                }
                // e. Increase k by 1.
                k++;
            }

            // 7. Return undefined.
            return undefined;
        },
        configurable: true,
        writable: true
    });
};


//establish name space for fed functions
var STFED = STFED || {};

STFED.breakpoint = {
	smallMin: 0,
    smallMax: 641,
	mediumMin: 642,
    mediumMax: 1024,
	largeMin: 1025
};

STFED.window = {
    width: parseInt(window.innerWidth)
};
$(window).on('resize', function() {
    STFED.window = {
        width: parseInt(window.innerWidth)
    };
});

STFED.mediaQueries = {
	smallMax: "screen and (max-width:" + STFED.breakpoint.smallMax + "px)",
	mediumMin: "screen and (min-width:" + STFED.breakpoint.mediumMin + "px)",
	mediumMax: "screen and (max-width:" + STFED.breakpoint.mediumMax + "px)",
	largeMin: "screen and (min-width:" + STFED.breakpoint.largeMin + "px)"
};

//extend STFED with functions
STFED.breakpointsAndDevices = {
    iosClasses: function () {
        var results = navigator.userAgent.match(/(iPod|iPhone|iPad)/i);
        var isTouch = results || navigator.userAgent.match(/Android|Windows Phone|BlackBerry|webOS|IEMobile/i)

        if (results) {
            document.body.classList.add('ios-device', 'ios-' + results[0].toLowerCase());
        }
        if (isTouch) {
            document.body.classList.add('touch-device');
        }
    },
    init: function () {
        STFED.breakpointsAndDevices.iosClasses();
    }
};

    $(document).ready(function() {
        STFED.breakpointsAndDevices.init();
    });
$.fn.isInViewport = function () {
    var isInViewport_logical = function (element) {
        var elementTop = element.offset().top;
        var elementBottom = elementTop + element.outerHeight();

        var viewportTop = $(window).scrollTop();
        var viewportBottom = viewportTop + $(window).height();

        return elementBottom > viewportTop && elementTop < viewportBottom;
    };

    if (!$(this).length) {
        return false;
    } else if ($(this).length === 1) {
        return isInViewport_logical($(this));
    } else if ($(this).length > 1) {
        var atLeastOneInViewport = false;

        $(this).each(function() {
            if (!atLeastOneInViewport) {
                atLeastOneInViewport = isInViewport_logical($(this));
            }
        });

        return atLeastOneInViewport;
    }
};

$.fn.isVisibleInViewport = function () {
    var checkVisibility = function (element) {
        var rect =  element.getBoundingClientRect();

        return (rect.right - rect.left) > 0 && rect.height > 0 && rect.width > 0;
    };

    var isInViewport = $(this).isInViewport();

    if (isInViewport) {
        return !!$(this).toArray().find(function (element) {
            return checkVisibility(element);
        });
    }

    return false;
};

$(document).ready(function(){
	if(!!navigator.userAgent.match(/Trident.*rv\:11\./)){
		$("submit.st-button").wrap('<div class="st-button-submit-wrap"></div>');
		$(".st-button-submit-wrap").click(function(){
			if(!$(this).data("button-clicked")){
				$(this).data("button-clicked", true);
				$(this).find(".st-button").click();
			}
		})
	}
	STFED.breakpointsAndDevices.init();
});
//establish name space for fed functions
var STFED = STFED || {};

//extend STFED with widgetSlider functions
STFED.widgetSlider = {
    prevArrow: '<svg class="slick-prev .st-link__icon--arrow-large"><use xlink:href="#icon-arrow-right"></use></svg>',
    nextArrow: '<svg class="slick-next .st-link__icon--arrow-large"><use xlink:href="#icon-arrow-right"></use></svg>',

    isEmptyWidgetElement: function (el) {
        return !$.trim(el.html())
    },
    
    recommendedForYouWidgetSliderOption: {
        dots: true,
        speed: 300,
        variableWidth: false,
        infinite: true,
        focusOnSelect: false,
        dotsClass: "st-card__dots",
        arrows: true,
        responsive: [{
                breakpoint: STFED.breakpoint.smallMax,
                settings: {
                    arrows: false,
                    dots: true,
                    dotsClass: "st-card__dots",
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    variableWidth: false,
                }
            },
            {
                breakpoint: STFED.breakpoint.largeMin,
                settings: {
                    arrows: false,
                    dots: true,
                    dotsClass: "st-card__dots",
                    slidesToShow: 2,
                    slidesToScroll: 2,
                    variableWidth: false,
                }
            }
        ]
    },

    recommendedForYouWidgetSlider: function (slickWidget, slides) {
    	STFED.widgetSlider.recommendedForYouWidgetSliderOption.slidesToScroll = slides;
    	STFED.widgetSlider.recommendedForYouWidgetSliderOption.slidesToShow = slides;
    	STFED.widgetSlider.recommendedForYouWidgetSliderOption.appendArrows = $(slickWidget).parents(".st-widget");
    	STFED.widgetSlider.recommendedForYouWidgetSliderOption.prevArrow = STFED.widgetSlider.prevArrow;
    	STFED.widgetSlider.recommendedForYouWidgetSliderOption.nextArrow = STFED.widgetSlider.nextArrow;
    	
    	if($(slickWidget).isInViewport()){
    		$(slickWidget).slick(STFED.widgetSlider.recommendedForYouWidgetSliderOption);
    	} else {
    		STFED.widgetSlider.recommendedForYouWidgetSliderInitialization = _.debounce(function() {
                if($(slickWidget).isInViewport()){
                	$(slickWidget).slick(STFED.widgetSlider.recommendedForYouWidgetSliderOption);
                    $(window).unbind("scroll", STFED.widgetSlider.recommendedForYouWidgetSliderInitialization);
                }
            }, 100, {maxWait: 100});
            $(window).bind("scroll", STFED.widgetSlider.recommendedForYouWidgetSliderInitialization);
    	}
    },

    recommendedForYouWidget: function () {
        $('.js-st-widget').each(function (i, widgetWrapper) {

            //do not initialize plugin for <= 3 items on large screen
            var widget = $(widgetWrapper);
            var parent = $(this).parents('.st-container');
            var itemsList = widget.children();
            var countItems = $(this).children().length;
            var windowWidth = $(window).width();

            //remove the widget if it's empty
            if (STFED.widgetSlider.isEmptyWidgetElement($(this))) {
                parent.remove();
            } else {

                parent.show();

                if (countItems <= 2) {

                    if (windowWidth <= STFED.breakpoint.smallMax && countItems > 1) {
                        STFED.widgetSlider.recommendedForYouWidgetSlider(widget, 1);
                    } else if (countItems === 2) {
                        itemsList.each(function (key, value) {
                            $(value).wrap("<div class='medium-6 columns'></div>");
                        });
                    } else {
                        itemsList.each(function (key, value) {
                            $(value).wrap("<div class='medium-12 columns'></div>");
                        });
                    }
                } else if (countItems == 3) {

                    if (windowWidth <= STFED.breakpoint.smallMax && countItems > 1) {
                        STFED.widgetSlider.recommendedForYouWidgetSlider(widget, 1);
                    } else if (windowWidth <= STFED.breakpoint.mediumMax && countItems > 2) {
                        STFED.widgetSlider.recommendedForYouWidgetSlider(widget, 2);
                    } else {
                        itemsList.each(function (key, value) {
                            $(value).wrap("<div class='medium-4 columns'></div>");
                        });
                    }
                } else {
                    if (windowWidth <= STFED.breakpoint.smallMax) {
                        STFED.widgetSlider.recommendedForYouWidgetSlider(widget, 1);
                    } else if (windowWidth <= STFED.breakpoint.mediumMax) {
                        STFED.widgetSlider.recommendedForYouWidgetSlider(widget, 2);
                    } else {
                        STFED.widgetSlider.recommendedForYouWidgetSlider(widget, 3);
                    }
                }
            }
        });
    },
    
    labelLogoProgramSliderOption: {
        infinite: false,
        slidesToShow: 2,
        slidesToScroll: 1,
        arrows: true,
        prevArrow: this.prevArrow,
        nextArrow: this.nextArrow,
        appendArrows: $('.js-st-label-slider').parents(".st-grey-message-box"),
        responsive: [{
            breakpoint: STFED.breakpoint.smallMax,
            settings: {
                arrows: true,
                infinite: true,
                slidesToShow: 1,
                slidesToScroll: 1,
            }
        }]
    },

    labelLogoProgramSlider: function () {
    	if($('.js-st-label-slider').isInViewport()){
    		$('.js-st-label-slider').slick(STFED.widgetSlider.labelLogoProgramSliderOption);
    	} else {
    		STFED.widgetSlider.labelLogoProgramSliderInitialization = _.debounce(function() {
                if($('.js-st-label-slider').isInViewport()){
                	$('.js-st-label-slider').slick(STFED.widgetSlider.labelLogoProgramSliderOption);
                    $(window).unbind("scroll", STFED.widgetSlider.labelLogoProgramSliderInitialization);
                }
            }, 100, {maxWait: 100});
            $(window).bind("scroll", STFED.widgetSlider.labelLogoProgramSliderInitialization);
    	}
    },

    init: function () {
        STFED.widgetSlider.recommendedForYouWidget();
        STFED.widgetSlider.labelLogoProgramSlider();
    }
};

$(document).ready(function() {
    (function ($) {
        STFED.widgetSlider.init();
    })(jQuery);
});
//tablesInit.js
//description: this file inits data tables and fixed table headerss
//source: created from productfolder.js

//WYSIWYG Table
window.STFED = typeof STFED === 'undefined' ? {} : STFED;

var productCookieName = "gSProduct";
var licenseCookieName = "gSLicense";
var versionCookieName = "gSVersion";

window.addEventListener("load", function () {
    window.loadedForSoftware = true;
});

window.addEventListener("DOMContentLoaded", function () {
    window.readyForSoftware = true;
});

STFED.getSwTableDataRows = [];

//This is the method called to load the get-software component before it is visible
STFED.isGetSwLastStepFlow = function () {
    return STUtils.getCookieByName("gSLicense") !== undefined || window.location.href.indexOf('.license') > -1 ||
        window.location.href.indexOf('?dl=') > -1 ||
        window.location.href.indexOf('softwareProduct=') > -1
};

STFED.getSwTableHtmlTemporaryExtraction = function () {
    const start = performance.now();
    if (!STFED.isGetSwLastStepFlow()) {
        var $container = $(".getsw-init-components-container");
        if (!$container.length) {
            $container = $('<div class="getsw-init-components-container" style="display: none;"></div>').appendTo("body");
        }

        $(".table-sample-and-buy.get-software > tbody > tr").each(function (index, element) {
            var row = {};
            STFED.getSwTableDataRows[index] = row;

            row.$tr = $(element);
            row.$buttonsTd = row.$tr.find("td.buttons");
            row.getswButtonText = row.$buttonsTd.find(".st-magento").first().text().trim();

            row.$buttonsWrap = $('<div class="getsw-init-buttons-container" data-init-buttons-container-index="' + index + '"></div>').appendTo($container);
            row.$buttonsTd.contents().appendTo(row.$buttonsWrap);

            row.$initButton = $('<a class="table-button-blue st-flex-order--all-1 st-magento getsw-init-button">' + row.getswButtonText + '</a>').appendTo(row.$buttonsTd);

            var $selectVersionButton = row.$tr.find(".msw-selectversionbutton");
            if ($selectVersionButton.length) {
                row.$selectTd = $selectVersionButton.closest("td");

                row.$selectWrap = $('<div class="getsw-init-select-container" data-init-select-container-index="' + index + '"></div>').appendTo($container);
                row.$selectTd.contents().appendTo(row.$selectWrap);

                const selectVersionTranslations = {
                    en: 'Select version',
                    zh: '选择版本',
                    ja: 'バージョンを選択'
                };

                const match = window.location.pathname.match(/^\/(en|zh|ja)(\/|$)/);
                const lang = match ? match[1] : 'en';

                const selectVersionText = selectVersionTranslations[lang] || selectVersionTranslations['en'];

                row.$initSelect = $('<div class="msw-selectversionbutton getsw-init-select"><div class="msw-selectversionbutton-buttontext">' + selectVersionText + '</div><i class="softwareversionicon fa fa-angle-down"></i></div>').appendTo(row.$selectTd);

            }
        });
        const end = performance.now();
        console.log("getSwTableHtmlTemporaryExtraction took " + (end - start) + " milliseconds.");
    }
};
//STFED.getSwTableHtmlTemporaryExtraction();

STFED.getSwDtTableControlButtonBlock = "disabled";
STFED.getSwTableHtmlRestore = function () {
    if (!STFED.isGetSwLastStepFlow()) {
        _.forEach(STFED.getSwTableDataRows, function (row, rowIndex) {
            row.$initButton.remove();
            row.$buttonsWrap.children().each(function (buttonsWrapElementsIndex, element) {
                $(element).appendTo(row.$buttonsTd);
            });
            if (!row.$buttonsTd.is(":visible")) {
                if (!STFED.getswDtSubRowInterval) {
                    STFED.getswDtSubRowInterval = [];
                }
                row.$tr.find("td.control").click(function () {
                    if (STFED.getSwDtTableControlButtonBlock == "enabled") {
                        return false;
                    } else {
                        STFED.getSwDtTableControlButtonBlock == "enabled";
                        if (!row.$tr.hasClass("parent")) {
                            STFED.getswDtSubRowInterval[rowIndex] = setInterval(function () {
                                if (row.$tr.hasClass("parent")) {
                                    clearInterval(STFED.getswDtSubRowInterval[rowIndex]);

                                    var subRowInitButton = row.$tr.next().find(".getsw-init-button");
                                    row.$tr.find("td.buttons").wrapInner('<div class="getsw-dt-subrow-button-tdwrap"></div>');
                                    row.$tr.find(".getsw-dt-subrow-button-tdwrap").appendTo(subRowInitButton.parent());
                                    subRowInitButton.remove();

                                    var subRowInitSelect = row.$tr.next().find(".getsw-init-select");
                                    if (subRowInitSelect.length) {
                                        row.$tr.find(".msw-selectversionbutton").closest("td").addClass("msw-selectversionbutton-td--open").wrapInner('<div class="getsw-dt-subrow-select-tdwrap"></div>');
                                        row.$tr.find(".getsw-dt-subrow-select-tdwrap").prependTo(subRowInitSelect.parent());
                                        subRowInitSelect.remove();
                                    }
                                    STFED.getSwDtTableControlButtonBlock == "disabled";
                                }
                            }, 50);
                        } else {
                            row.$tr.next().find(".getsw-dt-subrow-button-tdwrap").children().each(function (subRowButtonsWrapElementsIndex, element) {
                                $(element).appendTo(row.$tr.find("td.buttons"));
                            });
                            var subRowSelectTdWrap = row.$tr.next().find(".getsw-dt-subrow-select-tdwrap");
                            if (subRowSelectTdWrap.length) {
                                subRowSelectTdWrap.children().each(function (subRowSelectsWrapElementsIndex, element) {
                                    $(element).appendTo(row.$tr.find(".msw-selectversionbutton-td--open"));
                                });
                            }
                            STFED.getSwDtTableControlButtonBlock == "disabled";
                        }
                    }
                });
            }

            if (row.$selectTd) {
                row.$initSelect.remove();
                row.$selectWrap.children().each(function (index, element) {
                    $(element).appendTo(row.$selectTd);
                });
            }

        });
        $(".getsw-init-components-container").remove();
    }
};

STFED.dtresponsiveDataTableOption = function ($this) {
    return $this.hasClass('estore') ? {
        ordering: true,
        order: [],
        columnDefs: [
            {
                className: 'control',
                orderable: false,
                targets: 0
            },
            {responsivePriority: 1, targets: 1},
            {responsivePriority: 2, targets: 0}

        ]
    } : {
        order: [[1, 'asc']],
        columnDefs: [
            {
                className: 'control',
                orderable: false,
                targets: 0
            },
            {responsivePriority: 1, targets: 1},
            {responsivePriority: 2, targets: 0},
            {responsivePriority: 3, targets: -1},
            {responsivePriority: 4, targets: -2}

        ]
    };
};

STFED.dtresponsiveOptimizedInit = function ($this, index) {

    var startTime = performance.now();
    if (!STFED.dtresponsiveOptimizedInitInterval) {
        STFED.dtresponsiveOptimizedInitInterval = [];
    }

    var $buttonTd, closestPageContent, closestLoadingPhase;

    function checkCondition() {
        closestPageContent = $this.closest("[data-page-content]");
        var condition = !closestPageContent.length || closestPageContent.is(":visible");

        if (condition) {
            window.cancelAnimationFrame(STFED.dtresponsiveOptimizedInitInterval[index]);

            $buttonTd = $this.find(" > tbody > tr > td.buttons");
            if ($buttonTd.height() == 0 || $buttonTd.width() < 80) {
                $buttonTd.append('<a class="table-button-blue st-flex-order--all-1 st-magento getsw-void-button-for-empty-case">Get latest</a>');
            }

            if ($.fn.DataTable.isDataTable($this)) {
                $this.DataTable().destroy();
            }

            $this.DataTable($.extend({
                info: false,
                paging: false,
                searching: false,
                responsive: {
                    details: {
                        type: 'column'
                    }
                }
            }, STFED.dtresponsiveDataTableOption($this)));

            $this.closest('.dt-loading-container').contents().unwrap();
            new $.fn.dataTable.FixedHeader($this);

            $buttonTd.find(".getsw-void-button-for-empty-case").remove();

            if (!STFED.dtresponsiveLoadingPhaseInverval) {
                STFED.dtresponsiveLoadingPhaseInverval = [];
            }

            function checkLoadingPhase() {
                closestLoadingPhase = $this.closest(".getsw-table-loading-phase");
                console.log('check loading phase');
                if ($this.hasClass("dtr-column") && closestLoadingPhase.length) {
                    window.cancelAnimationFrame(STFED.dtresponsiveLoadingPhaseInverval[index]);
                    closestLoadingPhase.removeClass("getsw-table-loading-phase");
                    STFED.getSwTableReady = true;
                    STFED.getSwTableHtmlRestore();
                    window.loadingComplete = true;
                } else {
                    STFED.dtresponsiveLoadingPhaseInverval[index] = window.requestAnimationFrame(checkLoadingPhase);
                }
            }

            STFED.dtresponsiveLoadingPhaseInverval[index] = window.requestAnimationFrame(checkLoadingPhase);

            let endTime = performance.now();
            console.log(`Time taken to execute STFED.dtresponsiveOptimizedInit: ${endTime - startTime} milliseconds`);

            var currentDocumentTableSWGrid = document.querySelector("#software-grid");
            if (currentDocumentTableSWGrid) {
                requestAnimationFrame( function () {
                    currentDocumentTableSWGrid.style.visibility = "visible";
                })
            }
        } else {
            STFED.dtresponsiveOptimizedInitInterval[index] = window.requestAnimationFrame(checkCondition);
        }

    }

    STFED.dtresponsiveOptimizedInitInterval[index] = window.requestAnimationFrame(checkCondition);
};

STFED.dtResponsiveInitInterval = [];
STFED.tableInit = function (context) {
    const start = performance.now();
    context = context || document;

    var $dtResponsiveElements = $('.dt-responsive', context);
    if ($dtResponsiveElements.length > 0) {
        $dtResponsiveElements.each(function (index, e) {
            var $this = $(this);

            // Check if this element is already initialized to avoid unnecessary operations
            if ($this.has('.datatable-initialized').length === 0) {
                // Add header control slot(s)
                $this.find('thead tr').prepend('<th class="datatable-initialized"></th>');

                // Add body control slot(s)
                $this.find('tbody tr').prepend('<td class="datatable-initialized"></td>');
            }

            var $closestSection = $this.closest("#section-get-software-table");


            if (!$closestSection.hasClass("getsw-table-loading-phase")) {
                $closestSection.addClass("getsw-table-loading-phase");

                console.log('lazy init table called');
                var isInViewport = $this.isInViewport();
                if (isInViewport || STFED.isGetSwLastStepFlow()) {
                    STFED.dtresponsiveOptimizedInit($this, index);
                } else {
                    if (!STFED.dtResponsiveInitInterval) {
                        STFED.dtResponsiveInitInterval = [];
                    }
                    STFED.dtResponsiveInitInterval[index] = _.debounce(function () {
                        if ($this.isInViewport()) {
                            STFED.dtresponsiveOptimizedInit($this, index);
                            $(window).off("scroll", STFED.dtResponsiveInitInterval[index]);
                        }
                    }, 100);
                    $(window).on("scroll", STFED.dtResponsiveInitInterval[index]);
                }
            }
            
        });
        const end = performance.now();
        console.log(`Time taken to execute STFED.tableInit: ${end - start} milliseconds`);
        
    }
};
STFED.runOnDataTableInit = function ($table, callback) {
    var onInit = function () {
        $table.off('init.dt', onInit);
        callback();
    };

    $table.on('init.dt', onInit);
};
STFED.keepPageLength = function ($table, api) {
    var pageLength = +_.defaultTo($table.attr('data-length'),
        _.defaultTo($table.data('max-visible-items'), -1));

    if (pageLength !== -1) {
        return api.page.len(pageLength);
    }

    return api;
};
STFED.bindPageLengthUpdateOnDataTable = function ($table) {
    $table.on('length.dt', function (event, settings, len) {
        $table.attr('data-length', len);
    });
};
STFED.addMaxVisibleItemsBehaviour = function ($element, options) {
    var maxVisibleItems = _.defaultTo(parseInt($element.data('max-visible-items'), 10), false);

    if (maxVisibleItems !== false) {
        options.pageLength = maxVisibleItems;
        options.paging = true;
    }

    return options;
};

var dataTableSortFirst_initialization = [];
var dataTableSortSecond_initialization = [];

function findDatatableCellIndexByName(settings, name) {
    return _.findIndex(settings.aoColumns, function (column) {
        return column.nTh.classList.contains(name);
    });
}

function getDatatableCellByName(settings, row, name) {
    var index = findDatatableCellIndexByName(settings, name);

    if (index > -1) {
        return row[index];
    }
}

$.fn.dataTable.ext.search.push(
    function (settings, row, index) {
        var cells = row;
        var data = $(settings.nTable).data();
        var draw = true;

        if (row.length > 1) {
            if (data.htmlData) {
                cells = settings.aoData[index].anCells.map(function (cell) {
                    return $(cell).text();
                });
            }

            if (data.searchQuery) {
                draw = cells.filter(function (str) {
                    return str.toLowerCase().indexOf(data.searchQuery) > -1;
                }).length > 0;
            }

            if (draw && data.location) {
                var cellIndex = findDatatableCellIndexByName(settings, 'col-location');

                draw = row[cellIndex].trim().toLowerCase().includes(data.location.name.trim().toLowerCase());
            }

            if (draw && data.showSuppliedBySt) {
                var supplier = getDatatableCellByName(settings, row, 'col-supplier');

                draw = supplier && supplier.toLowerCase() === 'st';
            }

            if (draw && data.searchFilterFiletype) {
                var filetype = getDatatableCellByName(settings, row, 'col-filetype');

                draw = filetype && filetype.toLowerCase().indexOf(data.searchFilterFiletype.toLowerCase()) > -1;
            }

            if (draw && data.searchFilterUpdate) {
                var update = getDatatableCellByName(settings, row, 'col-update');

                draw = update && update.indexOf(data.searchFilterUpdate) > -1;
            }
        }

        return draw;
    }
);

$.extend(jQuery.fn.dataTableExt.oSort, {
    "with-divisor-pre": function (colText) {
        if (typeof colText === "undefined") {
            return 0;
        }

        var value = +colText.split('/')[0].trim();

        return isNaN(value) ? 0 : value;
    },

    "with-divisor-asc": function (a, b) {
        return a - b;
    },

    "with-divisor-desc": function (a, b) {
        return b - a;
    },

    "by-date-pre": function (colText) {
        if (typeof colText === 'undefined') {
            return 0;
        }

        var value = +new Date(colText);

        return isNaN(value) ? 0 : value;
    },

    "by-date-asc": function (a, b) {
        return a - b;
    },

    "by-date-desc": function (a, b) {
        return b - a;
    }
});

$.extend($.fn.dataTable.ext.type.order, {
    "by-customversion-asc": function (val_1, val_2) {
        const version1 = val_1.split('.').map(Number);
        const version2 = val_2.split('.').map(Number);

        for (let i = 0; i < Math.max(version1.length, version2.length); i++) {
            const v1 = version1[i] || 0;
            const v2 = version2[i] || 0;

            if (v1 < v2) return -1;
            if (v1 > v2) return 1;
        }
        return 0;
    },

    "by-customversion-desc": function (val_1, val_2) {
        const version1 = val_1.split('.').map(Number);
        const version2 = val_2.split('.').map(Number);

        for (let i = 0; i < Math.max(version1.length, version2.length); i++) {
            const v1 = version1[i] || 0;
            const v2 = version2[i] || 0;

            if (v1 < v2) return 1;
            if (v1 > v2) return -1;
        }
        return 0;
    }
});


STFED.checkDynamicIncludeCompletedTableInit;
$(document).ready(function () {
    const start = performance.now();
    STFED.isGetSwPage = $("#st-get-software").length > 0;

    function checkDynamicIncludeCompletedTableInit() {
        var isGetSwTableLoaded = !!window.loadingComplete;
        var isSlingDynamicIncludeBlocksLoaded = !$('[id^="dynamic_include_filter_div_"]').length;

        var isGetSwPageReady = STFED.isGetSwPage && isGetSwTableLoaded && isSlingDynamicIncludeBlocksLoaded;

        if ((!STFED.isGetSwPage && isSlingDynamicIncludeBlocksLoaded) || isGetSwPageReady) {
            STFED.foundation.init();
            STFED.getSwTableHtmlTemporaryExtraction();
            STFED.tableInit();
            const end = performance.now();
            console.log('STFED.checkDynamicIncludeCompletedTableInit: ' + (end - start) + 'ms');
        } else {
            window.requestAnimationFrame(checkDynamicIncludeCompletedTableInit);
        }
    }

    window.requestAnimationFrame(checkDynamicIncludeCompletedTableInit);
});


function initAllDataTables(context) {
    context = context || document;

    if ($('.js-st-table-sort-first', context).length) {

        $(".js-st-table-sort-first", context).each(function (index, element) {
            var $element = $(element);
            var isSearchable = _.defaultTo($element.data('searching'), false);

            STFED.bindPageLengthUpdateOnDataTable($element);

            if ($element.isInViewport() && !$.fn.DataTable.isDataTable($element)) {
                $(".st-tab-content-style-temp").remove();
                $element.dataTable(STFED.addMaxVisibleItemsBehaviour($element, {
                    "paging": false,
                    "ordering": true,
                    "info": false,
                    "autoWidth": false,
                    "initComplete": resetToggleBtnText,
                    "searching": isSearchable,
                    "columnDefs": [
                        {
                            "targets": 'js-st-table-col-no-sort',
                            "orderable": false
                        },
                        {
                            "targets": "js-st-table-sorter--with-divisor",
                            "type": "with-divisor"
                        },
                        {
                            "targets": "js-st-table-sorter--by-date",
                            "type": "by-date"
                        },
                        {
                            "targets": 'js-st-table-sorter--by-customversion',
                            "type": 'by-customversion'
                        }
                    ],
                    "order": [[0, "asc"]]
                }));
            } else {
                dataTableSortFirst_initialization[index] = _.debounce(function () {
                    if ($element.isInViewport() && !$.fn.DataTable.isDataTable($element)) {
                        $element.dataTable(STFED.addMaxVisibleItemsBehaviour($element, {
                            "paging": false,
                            "ordering": true,
                            "info": false,
                            "initComplete": resetToggleBtnText,
                            "searching": false,
                            "autoWidth": false,
                            "columnDefs": [
                                {
                                    "targets": 'js-st-table-col-no-sort',
                                    "orderable": false
                                },
                                {
                                    "targets": "js-st-table-sorter--with-divisor",
                                    "type": "with-divisor"
                                }
                            ],
                            "order": [[0, "asc"]]
                        }));
                        $(window).unbind("scroll", dataTableSortFirst_initialization[index]);
                    }
                }, 100);
                $(window).bind("scroll", dataTableSortFirst_initialization[index]);
                bindTableInitToAccordionShown($element, dataTableSortFirst_initialization[index]);
            }
        });
    }

    if ($(".js-st-table-sort-second", context).length) {
        $(".js-st-table-sort-second", context).each(function (index, element) {
            var $element = $(element);

            STFED.bindPageLengthUpdateOnDataTable($element);

            if ($element.isInViewport() && !$.fn.DataTable.isDataTable($element)) {
                $(".st-tab-content-style-temp").remove();
                $element.dataTable(STFED.addMaxVisibleItemsBehaviour($element, {
                    "paging": false,
                    "ordering": true,
                    "info": false,
                    "initComplete": resetToggleBtnText,
                    "searching": false,
                    "autoWidth": false,
                    "columnDefs": [
                        {
                            "targets": 'js-st-table-col-no-sort',
                            "orderable": false
                        },
                        {
                            "targets": "js-st-table-sorter--with-divisor",
                            "type": "with-divisor"
                        }
                    ],
                    "order": [[1, "asc"]]
                }));
            } else {
                dataTableSortSecond_initialization[index] = _.debounce(function () {
                    if ($element.isInViewport() && !$.fn.DataTable.isDataTable($element)) {
                        $element.dataTable(STFED.addMaxVisibleItemsBehaviour($element, {
                            "paging": false,
                            "ordering": true,
                            "info": false,
                            "initComplete": resetToggleBtnText,
                            "searching": false,
                            "autoWidth": false,
                            "columnDefs": [
                                {
                                    "targets": 'js-st-table-col-no-sort',
                                    "orderable": false
                                },
                                {
                                    "targets": "js-st-table-sorter--with-divisor",
                                    "type": "with-divisor"
                                }
                            ],
                            "order": [[1, "asc"]]
                        }));
                        $(window).unbind("scroll", dataTableSortSecond_initialization[index]);
                    }
                }, 100);
                $(window).bind("scroll", dataTableSortSecond_initialization[index]);
                bindTableInitToAccordionShown($element, dataTableSortSecond_initialization[index]);
            }
        });
    }

    $('.js-st-table-sort-cols-page', context).each(function () {
        if ($.fn.DataTable.isDataTable(this)) {
            return;
        }
        $(this).dataTable({
            "paging": true,
            "pagingType": "full_numbers",
            "ordering": true,
            "info": false,
            "initComplete": resetToggleBtnText,
            "searching": false,
            "columnDefs": [
                {
                    "targets": 'js-st-table-col-no-sort',
                    "orderable": false
                },
                {
                    "targets": "js-st-table-sorter--with-divisor",
                    "type": "with-divisor"
                }
            ],
            "order": [[0, "asc"]],
            "bLengthChange": true,
            "language": {
                "paginate": {
                    "previous": '<span class="st-text-color--light-blue"><svg class="st-pagination__item-icon st-pagination__item-icon--left"><use xlink:href="#icon-arrow-right"></use></svg> ' + $('.st-table--pagination').attr('data-pagination-previous') + ' </span>',
                    "next": '<span class="st-text-color--light-blue"> ' + $('.st-table--pagination').attr('data-pagination-next') + ' <svg class="st-pagination__item-icon st-pagination__item-icon--right"><use xlink:href="#icon-arrow-right"></use></svg></span>'
                }
            }
        });
    });

    function resetToggleBtnText() {
        if ($('.js-st-quickview-toggle', context).length > 0) {
            $('.sorting, .sorting_asc, .sorting_desc', context).click(function () {
                var currTable = $(this).parents('table');
                $('.js-st-quickview-toggle', currTable).each(function () {
                    $(this).removeClass('js-active');
                    $('span', $(this)).text($(this).attr('data-btn-text'));
                });
            });
        }
    }

    $('#toolandsoftware-personalized', context).each(function () {
        if ($.fn.DataTable.isDataTable(this)) {
            return;
        }
        $(this).dataTable({
            "paging": false,
            "ordering": true,
            "info": false,
            "searching": false
        });
    });

    $('#search_result_estore_table', context).each(function () {
        if ($.fn.DataTable.isDataTable(this)) {
            return;
        }
        $(this).dataTable({
            "paging": false,
            "ordering": true,
            "info": false,
            "searching": false,
            "columnDefs": [{"targets": 6, "orderable": false}]
        });
    });

    //generalized table sorting
    if ($('.sortable-table', context).length) {

        $('.sortable-table', context).each(function (e) {
            var notSortableColumns = [];
            var table = $(this);
            table.find('th').each(function (i) {
                if ($(this).hasClass('not-sortable')) {
                    notSortableColumns.push({"targets": i, "orderable": false});
                }
            });

            var noAvailableDataTextLocalized = Granite.I18n.get('No data available in table', null, 'events') || "No data available in table";

            var defaultsObject = {
                "paging": false,
                "ordering": true,
                "info": false,
                "searching": false,
                "columnDefs": notSortableColumns,
                "language": {
                    "emptyTable": table.data('options-language-empty-table') || noAvailableDataTextLocalized
                }
            };

            //if first column is not sortable, disable default sorting
            if (typeof notSortableColumns[0] !== 'undefined' && notSortableColumns[0].orderable != true) {
                $.extend(defaultsObject, {
                    order: []
                });
            }

            if ($.fn.DataTable.isDataTable(table)) {
                table.DataTable().destroy();
            }
            var newtable = table.DataTable(defaultsObject);
            defaultsObject = null;


            //colreorders
            if (table.is('.sample-and-buy-grid')) {
                new $.fn.dataTable.ColReorder(table);

                //determined if all table cells -1 are visible, if yes, hide more info column
                var originalSampleThLength = $("#sample-and-buy-grid tr:first th", context).length;
                var originalMoreInfoIndex = $("#sample-and-buy-grid tr .more-info-cell:first", context).index();

                var checkAllSampleCellsVisible = function () {
                    var column = newtable.column(originalMoreInfoIndex);
                    if ($("#sample-and-buy-grid tr:first th:visible", context).length >= originalSampleThLength - 1) {
                        column.visible(!column.visible());
                    }
                }

                if (originalMoreInfoIndex >= 0) {
                    checkAllSampleCellsVisible();
                }

            }
        });
    }
}

function bindTableInitToAccordionShown($table, initializator) {
    var handler = function (event) {
        if ($(event.target).has($table).length > 0) {
            initializator();
            $(document).off('accordion-content-shown', handler);
        }
    };

    $(document).on('accordion-content-shown', handler);
}

function visualizeTableWhenReady(){
    STFED.dtResponsiveInitInterval.forEach(function(element, index) {
        element(STFED.dtResponsiveInitInterval[index]());
    });
}

function isTableVisible(entries, observer) {
    entries.forEach(entry => {
        console.log(entry);
        if(entry.isIntersecting) {
            if (window.location.href.includes('/solutions-reference-designs')) {
                visualizeTableWhenReady();
            }
            observer.disconnect();
        }
    });
}

const getSoftwareTable = document.getElementById('section-get-software-table');

if (getSoftwareTable) {
    const getSoftwareTableObserver = new IntersectionObserver(isTableVisible)

    getSoftwareTableObserver.observe(getSoftwareTable);
}
/*
* rwdImageMaps jQuery plugin v1.6
*
* Allows image maps to be used in a responsive design by recalculating the area coordinates to match the actual image size on load and window.resize
*
* Copyright (c) 2016 Matt Stow
* https://github.com/stowball/jQuery-rwdImageMaps
* http://mattstow.com
* Licensed under the MIT license
*
* Added custom changes: 
** #1-4: fixed STM-19008 map issue due to the page loading. When 'data-page-content' is hidden the size of all elements is 0 and it is written to a 'w' & 'h' variables.
** #5-6: added to avoid event handler and 'resize' trigger in one place.
*/
;
(function ($) {
    $.fn.rwdImageMaps = function () {
        var $img = this;

        var rwdImageMap = function () {
            $img.each(function () {
                if (typeof ($(this).attr('usemap')) == 'undefined')
                    return;

                var that = this,
                    $that = $(that);

                // Since WebKit doesn't know the height until after the image has loaded, perform everything in an onload copy
                $('<img />').on('load', function (e) {
                    var attrW = 'width',
                        attrH = 'height',
                        w = $that.attr(attrW),
                        h = $that.attr(attrH);

                    //#1 initialization after 'new Image()' has loaded
                    var imageLoaded = function () {
                        var wPercent = $that.width() / 100,
                            hPercent = $that.height() / 100,
                            map = $that.attr('usemap').replace('#', ''),
                            c = 'coords';

                        $('map[name="' + map + '"]').find('area').each(function () {
                            var $this = $(this);
                            if (!$this.data(c))
                                $this.data(c, $this.attr(c));

                            var coords = $this.data(c).split(','),
                                coordsPercent = new Array(coords.length);

                            for (var i = 0; i < coordsPercent.length; ++i) {
                                if (i % 2 === 0)
                                    coordsPercent[i] = parseInt(((coords[i] / w) * 100) * wPercent);
                                else
                                    coordsPercent[i] = parseInt(((coords[i] / h) * 100) * hPercent);
                            }
                            $this.attr(c, coordsPercent.toString());
                        });
                    }
                    if (!w || !h) {
                        var temp = new Image();
                        temp.onload = imageLoaded; //#2 call imageLoaded() if the image has loaded
                        temp.src = $that.attr('src');
                        if (!w)
                            w = e.currentTarget.width //#3 get width from event target
                        if (!h)
                            h = e.currentTarget.height //#4 get width from event target
                    }
                }).attr('src', $that.attr('src'));
            });
        };
        rwdImageMap(); //#5 call the function 

        $(window).on('resize', _.debounce(rwdImageMap, 250)) //#6 call the function if the window is resized

        return this;
    };
})(jQuery);

//establish name space for fed functions
var STFED = STFED || {};

//extend STFED with resImageMap function
STFED.resImageMap = {
    hoverOrClickOpen: function(transthis,transevent){
        var currentMousePos = {x: -1, y: -1};
        var $this = transthis;
        if ($this.data('popupmenu')) {
            var popupID = $('#' + $this.data('popupmenu'));
            var popupIDC = popupID.closest('.img-map-tt-wrapper');
            if(!popupIDC.hasClass('active')) {
                transevent.preventDefault();
                STFED.resImageMap.hoverOrClickClose();
                currentMousePos.x = transevent.pageX || transevent.originalEvent.touches[0].pageX;
                currentMousePos.y = transevent.pageY || transevent.originalEvent.touches[0].pageY;
                popupIDC.addClass('active').css({
                    left: currentMousePos.x,
                    top: currentMousePos.y
                });
                //fix for if item is against or off right side
                if (currentMousePos.x + popupIDC.width() >= $(window).width()){
                    popupIDC.css({
                        left: 'auto',
                        right: '20px'
                    });
                }
            }
        }
    },
    hoverOrClickClose: function(){
        $('.img-map-tt-wrapper').removeClass('active').css({
            left: '-999em',
            right: 'auto',
            top: '-999em'
        });
    },
    init: function(){
        if ($('img[usemap]').length){


            var tooltipTimeout;

            //init responsive image maps
            $('img[usemap]').rwdImageMaps();

            //remove previous class, add this modules custom class, ideally content would have img-map-tt over jqpopupmenu class.
            $('.image-map-container').find('.jqpopupmenu').addClass('img-map-tt').removeClass('jqpopupmenu');
            //move img-map-tt (tooltip) classed items to end of body, wrap in holder
            $('.img-map-tt').appendTo('body').wrap('<div class="img-map-tt-wrapper" />');

            //establish what to Area on touchstart tap or click (all about the same), mouseenter and mouse leave
            $('.image-map-container area').on('touchstart tap click mouseenter', function (e) {
                clearTimeout(tooltipTimeout);
                STFED.resImageMap.hoverOrClickOpen($(this),e);
            }).on('mouseleave', function (e){
                tooltipTimeout = setTimeout(STFED.resImageMap.hoverOrClickClose, 5000);
            });

            $('.img-map-tt-wrapper').on('mouseenter', function (e){
                clearTimeout(tooltipTimeout);
            }).on('mouseleave', function (e){
                tooltipTimeout = setTimeout(STFED.resImageMap.hoverOrClickClose, 5000);
            });

            $(document).on('click', function(e){
                if (
                    !$(e.target).is('area') &&
                    !$(e.target).is('.img-map-tt') &&
                    !$(e.target).closest('.img-map-tt').length
                ) {
                    STFED.resImageMap.hoverOrClickClose();
                }
            });

            $(window).on('resize', function(e){
                STFED.resImageMap.hoverOrClickClose();
            });

        }
    }
};

(function($) {
    STFED.resImageMap.init();

    $('.image-map-container map area[href="#"]').click(function(e){
       e.preventDefault();
    });
})(jQuery);

//establish name space for fed functions
var STFED = STFED || {};

//extend STFED with infinite method
STFED.infiniteLoad = {
    //sets current load status
    loading: false,

    //tests if conditions are met for scrolling or window resize
/*    testIfVisible: function(loaderLoc){
        if ($(document).scrollTop() + $(window).innerHeight() > loaderLoc && $('.infinite-load-loader').is(':visible') && !STFED.infiniteLoad.loading){
            STFED.infiniteLoad.ajaxLoad();
        }
    },*/

    //does the loading and pulls data
    ajaxLoad: function($clickSource) {
        STFED.infiniteLoad.loading = true;
        var container = $clickSource.closest('.infinite-load-container');
        container.addClass('loading');
        var dataSource = {
            basePath: container.data('infinite-load-src'),
            startNumber: container.data('infinite-load-start-number'),
            numberRequested: container.data('infinite-load-number-requested'),
            path: function(){
                return this.basePath + "?startNumber=" + this.startNumber + "&numberRequested=" + this.numberRequested;
            }
        };

        $.ajax({
          url:dataSource.path()
        }).done(
            function(msg){
                container.before(msg);
                STFED.infiniteLoad.loading = false;
                container.data('infinite-load-start-number', dataSource.startNumber + dataSource.numberRequested).removeClass('loading');
                STFED.dotdotdot.init();
            }
        ).fail(
            function(){
                container.hide();
            }
        );

    },

    //click events
    init: function(){
        if ($('.infinite-load-container').length){
/*            $(document).on('scroll', function(){
                STFED.infiniteLoad.testIfVisible($('.infinite-load-loader').offset().top);
            })
            $(window).on('resize', function(){
                STFED.infiniteLoad.testIfVisible($('.infinite-load-loader').offset().top);
            });*/
            $('.infinite-load-add-more a').on('click', function(e){
                e.preventDefault();
                $(this).blur();
                STFED.infiniteLoad.ajaxLoad($(this));
            });
            $(document).on('touchend', function(e){
                $('.infinite-load-add-more a').trigger("mouseout");
           });
            $('.infinite-load-add-more a').on('mouseout', function(e){
                $(this).blur();
            });

        }
    }

};

(function($) {
    STFED.infiniteLoad.init();
})(jQuery);

//establish name space for fed functions
var STFED = STFED || {};

//extend STFED with forms method
STFED.forms = {
    redirectToCityPage: function(){
        if ($('.redirect-to-city-submit').length){
            $(document).on('click', '.redirect-to-city-submit', function(e){
                var selectedCity = $(this).closest('.row').find('.selected-city').val();
                if (selectedCity != "") {
                    window.location = window.location.pathname.replace(".html", "/" + selectedCity + ".html");
                }
            });
        }

    },
    selectChaining: function($this){
        if ($this.val() != ""){
            $this.closest('.row').next('.row').show();
        }
    },
    init: function(){
        //checks for already chained selects
        $('select.chaining').each(function(e){
            if ($(this).val() != "") {
                STFED.forms.selectChaining($(this));
            }
        });
        //if change of select.chaining select, show next one
        $(document).on('change', 'select.chaining', function(){
            STFED.forms.selectChaining($(this));
        });

        //test if redirect to city is on page, if so, add event handler
        STFED.forms.redirectToCityPage();

        //set temp vars to be used for foundation validation of Avatar Requirements
        $(document).on('click', '.image-upload', function(e){
            $(this).data('image-event', e);
        });


        $('.image-upload').each(function(e){
            $(this).next().find('.validated-image-size').html($(this).data('max-image-size'));
        });
    }
	
};

(function($) {
    STFED.forms.init();
})(jQuery);

var stButtonLoadingSpinnerModal_interval;
$(document).ready(function(){
	if($(".js-st-button-loading-spinner").length){
		$("body").append("<img src='/etc/clientlibs/st-site-cx/media/app/images/loading-spinner.svg' style='display: none;'>");
		$("body").append('<div class="st-button-loading-spinner-modal-wrap"><div class="st-button-loading-spinner-modal modal-open modal"><div class="st-button-loading-spinner-modal-wrap-text"></div><div class="st-loading-spinner"></div></div></div>');
		
		$(".js-st-button-loading-spinner").click(function(){
			setTimeout(function(){
				if($("form.validationForm [data-fv-result]").length == $("form.validationForm [data-fv-result='VALID']").length){
					$(".st-button-loading-spinner-modal-wrap").show();
					stButtonLoadingSpinnerModal_interval = setInterval(function(){
						if($(".modal:visible:not(.st-button-loading-spinner-modal)").length || $("#globalError").text().trim() != ""){
							clearInterval(stButtonLoadingSpinnerModal_interval);
							$(".st-button-loading-spinner-modal-wrap").hide();
						}
					}, 50);
				}
			},50);
		});
	}
});
$(document).ready(function(){

    $('.dynamic-table').each(function(tableIndex) {
        var tableElement = $(this),
            rows = $(this).find('table tbody tr'),
            fetchNumber = parseInt($(this).data('fetch-number')),
            initNumber = parseInt($(this).data('init-number')),
            seeMore = tableElement.find('a.see-more');

        if(rows.length > initNumber){
            seeMore.show();
        }

        rows.each(function(rowIndex) {
            if((rowIndex+1) <= initNumber) {
                $(this).addClass('visible');
            }
        });

        seeMore.on('click', function(event) {
            event.preventDefault();

            var dynamicTable = $(this).closest('.dynamic-table'),
                rows = dynamicTable.find('table tbody tr'),
                visibleNumber = dynamicTable.find('table tbody tr.visible').length;

            rows.each(function(rowIndex) {
                if(!$(this).hasClass('visible')){
                    if((rowIndex+1) <= (visibleNumber + fetchNumber)) {
                        $(this).addClass('visible');
                    }
                }
            });

            if(dynamicTable.find('table tbody tr.visible').length == rows.length){
                $(this).hide();
            }

        });

    });


});
$(document).ready(function () {
    var $options,
        $distributorsHTML = $(".distributors-popup.template:first");
    var isInpageVersion = $('.solutions-widget-container').hasClass('main-body') ||
        $('.solutions-widget-container').hasClass('tab-type-parts-list') ||
        $('.solutions-widget-container').hasClass('tab-type') ||
        ($('.search').length > 0 && $('.search').hasClass('search-styling'));

    var pageType = 'default';
    if ($('.application-page-marker').length) {
        pageType = 'Application';
    } else if ($('.productFolder-page-marker').length) {
        pageType = 'productFolder';
    }

    $.fn.distributorExtend = {
        setOptions: function($this){
            $options = {
                inline: $this.hasClass('inline-distributor-spawn')
            };

            if($options.inline){
                $options.targetDiv = $this.closest('tr').next('.distributor-expand-content');
                $options.correctSlot = $options.targetDiv.find('td');
                $options.correctSlotForRender = $options.targetDiv.find('td');
            }else{
                $options.targetDiv = $('#distribModal');
                $options.correctSlot = $this.find('.modal-content');
                $options.correctSlotForRender = $options.targetDiv.find('.modal-content');
            }
        }
    };

    var digitalData = window.digitalData || {},
        trackingIDCookie = 'trackingID',
		cookieExp = null,
        cookiePath = "/",
        cookieDomain = null,
        cookieSecure = null;

    digitalData.event = digitalData.event || [];
    digitalData.product = digitalData.product || [];
    digitalData.product[0] = digitalData.product[0] || {};
    digitalData.product[0].productInfo = digitalData.product[0].productInfo || {};
    digitalData.product[0].productInfo.productID = digitalData.product[0].productInfo.productID || "";
    digitalData.product[0].productInfo.distributor = digitalData.product[0].productInfo.distributor || "";
    digitalData.product[0].productInfo.tree = digitalData.product[0].productInfo.tree || {};
    digitalData.product[0].productInfo.tree.level1 = digitalData.product[0].productInfo.tree.level1 || "";
    digitalData.product[0].productInfo.tree.level2 = digitalData.product[0].productInfo.tree.level2 || "";
    digitalData.product[0].productInfo.tree.level3 = digitalData.product[0].productInfo.tree.level3 || "";
    digitalData.product[0].productInfo.tree.level4 = digitalData.product[0].productInfo.tree.level4 || "";
    digitalData.product[0].productInfo.tree.level5 = digitalData.product[0].productInfo.tree.level5 || "";
    digitalData.product[0].productInfo.tree.level6 = digitalData.product[0].productInfo.tree.level6 || "";

    if(!STFED.cookieFactory.has(trackingIDCookie)){
        STFED.cookieFactory.set(trackingIDCookie, createSessionID(), cookieExp, cookiePath, cookieDomain, cookieSecure);
    }

    var marketoTrackingEnabled = new Promise(function (resolve) {
        if (document.documentElement.dataset.isMktoTrackingConfigLoaded) {
            resolve();
        } else {
            document.documentElement.addEventListener('mktoTrackingConfigLoaded', () => {
                resolve();
            });
        }
    }).then(function () {
        try {
            return STFED.Marketo.trackingConfig.legacyDistributorsStock;
        } catch (e) {
            console.error(e);
        }
    });

    function initSampleAndBuyTracking($items) {
        var sampleBuyBtns = $items || $('[data-sample-buy-btn]').not('#DataTables_Table_sample_and_buy [data-sample-buy-btn]'),
            sessionID = STFED.cookieFactory.get(trackingIDCookie);

        sampleBuyBtns.each(function(i, btn){
            var btnType = $(btn).data("sampleBuyBtn") || $(btn).attr("data-sample-buy-btn"),
                itemName = $(btn).data('iname') || $(btn).attr('data-iname'),
                trackingData = {
                    "product": [{
                        "productInfo": {
                            "tree": {
                                "level1": digitalData.product[0].productInfo.tree.level1,
                                "level2": digitalData.product[0].productInfo.tree.level2,
                                "level3": digitalData.product[0].productInfo.tree.level3,
                                "level4": digitalData.product[0].productInfo.tree.level4,
                                "level5": digitalData.product[0].productInfo.tree.level5,
                                "level6": digitalData.product[0].productInfo.tree.level6
                            },
                            "productID": itemName
                        }
                    }],
                    event: []
                },
                trackerOpts = {};

            switch(btnType){
                case "sample":
                    trackingData.event[31] = {
                        "eventInfo": {
                            "ProductFolder": {
                                "eventName": "FreeSampleClick"
                            }
                        }
                    };
                    trackingData.event[13] = {
                        "eventInfo": {
                            "eventName": "free sample",
                            "type": sessionID
                        }
                    };
                    break;

                case "buy":
                    trackingData.event[65] = {
                        "eventInfo": {
                            "ProductFolder": {
                                "eventName": "Buy Direct"
                            }
                        }
                    };
                    trackingData.event[13] = {
                        "eventInfo": {
                            "eventName": "buy direct",
                            "type": sessionID
                        }
                    };
                    break;

                default:
            }

            trackerOpts = {
                items: [{
                    ruleName: "DCProduct",
                    events: "click",
                    digitalData: trackingData
                }]
            };

            $(btn)
                .attr('data-tracker-opts', JSON.stringify(trackerOpts))
                .data('trackerOpts', JSON.stringify(trackerOpts))
                .tracker(trackerOpts);
        });
    }

    initSampleAndBuyTracking();

    document.addEventListener("sample-and-buy-initialized", function() {
        var $items = $('#DataTables_Table_sample_and_buy [data-sample-buy-btn]');

        if (!$items.length) {
            return;
        }

        initSampleAndBuyTracking($items);

    });

    $(document).on('click', '.solution-widget-table .inline-distributor-spawn', function(e){
        var $this = $(this),
            genericModalHandleUpdate = function(){
                var gM = $('#genericModalTrim');
                if(gM.is(":visible")){
                    gM.modal('handleUpdate');
                }
            };
        e.preventDefault();
        $this.blur();
        $(document).focus();
        $this.distributorExtend.setOptions($this);

        if($options.targetDiv.hasClass("hidden-but-loaded") && $options.targetDiv.hasClass("hidden")){
            $options.targetDiv.removeClass('hidden');
        }else if($options.targetDiv.hasClass("hidden")){
            $options.targetDiv.removeClass("hidden");
            distributorData($this, $(e.currentTarget), function(){
                genericModalHandleUpdate();
            });
        }else{
            $options.targetDiv.addClass('hidden hidden-but-loaded');
        }
        genericModalHandleUpdate();
        $('.modal').one('scroll', function(){
            genericModalHandleUpdate();
        });

    });

    $('#distribModal').on('show.bs.modal', function(e) {
        var $this = $(this);

        $this.distributorExtend.setOptions($this);

        distributorData($this, $(e.relatedTarget));
    });

    function distributorData($this, $e, callback){
        'use strict';
        $(document).focus();
        $options.correctSlot.empty().addClass('loading');

        var $button = $e,
          productID = $button.attr("data-pid"),
          referrer = $button.attr("data-referrer"),
          itemLocation = $button.attr("data-location"),
          itemName = $button.attr("data-iname");

        if(productID != void(0)){
            $.ajax({
                type: "GET",
                url: "/bin/st/distributor-search",
                data: {
                    pid: productID,
                    referrer: referrer
                },
                success: function (response) {
                    if (response) {
                        fillDistributors(response, itemName, $button, $options.targetDiv, itemLocation);
                        $options.correctSlot.removeClass('loading');
                    }
                    else {
                        errorDistributors();
                    }
                },
                error: function (error) {

                }
            });
        }else{
            if(!$options.inline){
                var closeButton = $options.targetDiv.find("h2.text-primary a");
                $options.targetDiv.find("h2.text-primary").empty().append(closeButton).append(itemName);
            }else{
                $options.targetDiv.find("h2.text-primary").empty().append(itemName);
            }
            errorDistributors();
        }
        if(typeof callback === "function" && callback !== null){
            callback();
        }
    }

    function errorDistributors() {
        var errorMessageTemplate = $(".distributors-popup .error-message:first");

        if(!$options.inline){
            $options.targetDiv.find("div.modal-content").append(errorMessageTemplate.show()).removeClass('loading');
        }else{
            $options.targetDiv.find("td").append(errorMessageTemplate.show()).removeClass('loading');
        }
    }

    function fillDistributors(response, itemName, $button, $targetDiv, itemLocation) {
        $options.correctSlotForRender.append($distributorsHTML.clone().removeClass("template"));

        var closeButton = $targetDiv.find(".st-h5.text-primary a");
        $targetDiv.find(".st-h5.text-primary").empty().append(closeButton);

        var statusText = $button.closest('tr').find('td.sample-buy-marketing-status-strip').text();
        $targetDiv.find("p.text-primary:first").text(statusText);

        var orderBtnText = $targetDiv.find("span.order-text").text();
        var headlineText = $targetDiv.find("span.js-st-distributor-headline").text();
        var reportedDateText = $targetDiv.find("span.js-st-distributor-reported-date").text();


        var reportedDate;

        var itemTh1 = $button.attr("data-thead-1"),
        itemTh2 = $button.attr("data-thead-2"),
        itemTh3 = $button.attr("data-thead-3"),
        itemTh4 = $button.attr("data-thead-4"),
        itemTh5 = $button.attr("data-thead-5"),
        itemTh6 = $button.attr("data-thead-6");

        $targetDiv.find('.js-st-distributor-table-content').append(
                '<p class="st-table__headline">' + headlineText + '\n' +
                '<span>' + itemName + '</span>' +
                '</p>\n' +
            '<div class="st-table st-table--distributor">\n' +
                '<table class="js-st-distributor-table-init js-st-table-sort-first">\n' +
                    '<thead>\n' +
                        '<tr>\n' +
                            '<th>' + itemTh1 + ' \n' +
                                '<div class="st-table__sort-icon js-st-table-sort">\n' +
                                    '<div class="st-table__sort-icon--arrow-up"></div>\n' +
                                    '<div class="st-table__sort-icon--arrow-down"></div>\n' +
                                '</div>\n' +
                            '<th class="js-st-table-col-no-sort">' + itemTh2 + '</th>\n' +
                            '<th class="js-st-table-col-no-sort">' + itemTh3 + '</th>\n' +
                            '<th class="js-st-table-col-no-sort">' + itemTh4 + '</th>\n' +
                            '<th class="js-st-table-col-no-sort">' + itemTh5 + '</th>\n' +
                        '</tr>\n' +
                    '</thead>\n' +
                '<tbody></tbody>\n' +
                '</table>\n' +
            '</div>'
        );

        $.each(response, function (index, value) {
            var row = $('<tr></tr>'),
                nameCell = $('<td>' + value.distributorName + '</td>'),
                regionCell = $('<td>' + value.region + '</td>'),
                stockCell = $('<td>' + value.currentStock + '</td>'),
                minOrderCell = $('<td>' + value.minOrder + '</td>'),
                btnCell = $('<td></td>'),
                orderBtn = $('<a class="st-button st-button--primary st-button--small js-st-distributor-order free-sample" target="_blank" href="' + value.link.replace("INSERTSTPC", itemName) + '">' + orderBtnText + '<svg class="st-button__icon st-button__icon--right"><use xlink:href="#icon-arrow-thin"></use></svg></a>'),

                mobileItem = $('<div class="st-table__item"></div>'),
            	mobileItemHeadline = $('<p class="st-table__cell-title">' + value.distributorName + '</p>'),
            	mobileItemInner = $('<div class="clearfix"></div>'),
            	mobileItemLeft = $(
                        '<div class="left">\n' +
                        '<p class="st-table__cell-label">' + itemTh3 + '</p>\n' +
                        '<span class="st-table__cell-value">' + value.currentStock + '</span>\n' +
                        '<div>\n' +
                        '<p class="st-table__cell-label">' + itemTh4 + '</p>\n' +
                        '<span class="st-table__cell-value">' + value.minOrder + '</span>\n' +
                        '</div>\n' +
                        '</div>'),
            	mobileItemRight = $(
                        '<div class="right">\n' +
                        '<p class="st-table__cell-label">' + itemTh2 + '</p>\n' +
                        '<span class="st-table__cell-value">' + value.region + '</span></div>'),
                orderBtnMob = $('<a class="st-button st-button--primary st-button--small js-st-distributor-order free-sample" target="_blank" href="' + value.link.replace("INSERTSTPC", itemName) + '">' + orderBtnText + '<svg class="st-button__icon st-button__icon--right"><use xlink:href="#icon-arrow-thin"></use></svg></a>'),



            trackingData = {
                "product": [{
                    "productInfo": {
                        "tree": {
                            "level1": digitalData.product[0].productInfo.tree.level1,
                            "level2": digitalData.product[0].productInfo.tree.level2,
                            "level3": digitalData.product[0].productInfo.tree.level3,
                            "level4": digitalData.product[0].productInfo.tree.level4,
                            "level5": digitalData.product[0].productInfo.tree.level5,
                            "level6": digitalData.product[0].productInfo.tree.level6
                        },
                        "productID": itemName,
                        "distributor": value.distributorName
                    }
                }],
                event: []
            };

            trackingData.event[30] = {
                "eventInfo": {
                    "ProductFolder": {
                        "eventName": "OrderNow"
                    }
                }
            };

            trackerOpts = {
                items: [{
                    ruleName: "DCProduct",
                    events: "click",
                    digitalData: trackingData
                }]
            };

            if (itemLocation != 'solution-widget') { //prevent analytics DCProduct call in solution widget
                orderBtn
                    .attr('data-tracker-opts', JSON.stringify(trackerOpts))
                    .data('trackerOpts', JSON.stringify(trackerOpts))
                    .tracker(trackerOpts);
                orderBtnMob
                    .attr('data-tracker-opts', JSON.stringify(trackerOpts))
                    .data('trackerOpts', JSON.stringify(trackerOpts))
                    .tracker(trackerOpts);

            }

            if (reportedDate == void(0) || (new Date(reportedDate) < new Date(value.dateUpdated))) {
                reportedDate = value.dateUpdated;
            }

            row
                .append(nameCell)
                .append(regionCell)
                .append(stockCell)
                .append(minOrderCell)
                .append(btnCell.append(orderBtn));

            mobileItem
            	.append(mobileItemHeadline)
            	.append(mobileItemInner.append(mobileItemLeft).append(mobileItemRight.append(orderBtnMob)));

            $targetDiv.find(".js-st-distributor-table-content tbody").append(row);
            $targetDiv.find(".js-st-distributor-table-content-mobile").append(mobileItem);
        });

        $targetDiv.find('.distributors-modal-content').append('<p class="st-table__subline"><span>' + reportedDateText + '</span><span>' + reportedDate + '</span></p>');

        $targetDiv.find("div.distributors-popup").show();

        $('.js-st-table-sort-first').DataTable({
            retrieve: true,
            paging: false,
            searching: false,
            info: false,
            columnDefs: [
                {
                    targets: 'js-st-table-col-no-sort',
                    orderable: false
                },
                {
                    targets: 'js-st-table-sorter--with-divisor',
                    type: 'with-divisor'
                },
                {
                    targets: 'js-st-table-sorter--by-date',
                    type: 'by-date'
                }
            ]
        });
    }


    $('#sampleBuyMoreInfoModal').on('show.bs.modal', function(e) {
        $(document).focus();
        var modalContent = $(this).find('.more-info-content');
        var html = '<thead><tr class="muted-blue-th"><th>Parameter Name</th><th>Parameter Value</th></tr></thead>';
        var button = $(e.relatedTarget);
        var headers = (button.closest('table').find('th.sample-buy-dynamic-strip').length > 0) ?
            button.closest('table').parent().find('th.sample-buy-dynamic-strip') :
            button.closest('table').siblings('.floatThead-container').find('th.sample-buy-dynamic-strip');

        //change modal title
        $(modalContent)
            .closest('.modal-content')
                .find('h2 span.editable')
                    .html(button.closest('tr').find('td.sample-buy-part-number-strip span').text());

        var status =    "<p class='text-blue'>" +
                        button.closest('tr').find('td.sample-buy-marketing-status-strip').text() +
                        "</p>";

        var sampleButtons = "<div class='row bottom-spacing10'><div class='small-12 columns'>" +
                            button.closest('tr').find('td.sample-buy-sample-strip').html() +
                            button.closest('tr').find('td.sample-buy-distributor-strip').html() +
                            "</div></div>";

        var cells = button.closest('tr').find('td.sample-buy-dynamic-strip');

        headers.each(function(index) {
            var header = '<td>' + $(this).text() + '</td>';
            var $cell = $(cells[index]);
            $cell.find('.hidden').remove();
            var cell = '<td>' + $cell.text() + '</td>';
            html += "<tr>" + header + cell + "</tr>";
        });

        modalContent.empty().html(status + sampleButtons + "<table >" + html + "</table>");
    });

    $(document).on('click', '.modal .modal-close', function(e){
        $('#sampleBuyMoreInfoModal').modal('hide');
    });

    $('body').on('click', '.st-table--distributor .st-order-btn', function (e) {
        var product = $(e.target).closest('[data-product-id]');
        var isMobile = product.parent().hasClass('st-table__col-right');
        // rpn name is stored in digitalData.product[0].productInfo.tree.level6
        var partNumber = digitalData.product[0].productInfo.tree.level6 || $.trim(isMobile ?
            product.find('.st-table__item:first .st-table__cell-title:first').text() :
            product.find('tbody:first tr:first td:first').text()),
            distributor = $.trim(isMobile ?
                $(e.target).closest('.st-table__item').find('.st-table__cell-title:first').text() :
                $(e.target).closest('tr').find('td:first').text()),
            productId = product.data('product-id'),
            trackingData = {
                solwidname: '',
                event: digitalData.event || []
            };

        trackingData.event[30] = {
            eventInfo: {
                ProductFolder: {
                    eventName: 'OrderNow'
                }
            }
        };

        digitalData.product[0].productInfo.productID = productId;
        digitalData.product[0].productInfo.distributor = distributor;
        digitalData.product[0].productInfo.tree.level6 = partNumber;

        if(isInpageVersion){
            trackingData.component = pageType + ":Solution In-page Window";
        } else {
            trackingData.component = pageType + ":Solution Modal Window";
        }
        $.extend(digitalData, trackingData);
        if (_satellite) {
            _satellite.setVar("DCorder link clicked", this.href);
        }
        satelliteTrack('DCorder');
    });

    $(window).resize(_.debounce(function () {
        $('.st-table--sample-buy table.dataTable').each(function () {
            var $table = $(this);
            var dt = $table.DataTable();

            $table.removeAttr('style');

            dt.columns.adjust();
        });
    }, 250));

    $('.js-st-page-content').on('click', '.st-table--sample-buy .js-st-row-distributor a.st-order-btn', function (event) {
        marketoTrackingEnabled.then(function (isEnabled) {
            if (!isEnabled) {
                return false;
            }

            var $btn = $(event.target);
            var $distr = $btn.closest('tr').find('td:eq(0)');

            var formattedDate = STFED.DateUtils.getDateString();
            var cpn = $btn.data('product-id');
            var distr = $distr.html();
            var paramStr = ' : ' + formattedDate + ' : ' + distr.trim() + ' : ' + cpn.trim();
            var data = {
                url: 'Distributor link click | ' + paramStr,
                params: paramStr
            };

            if (typeof Munchkin !== 'undefined') {
                Munchkin.munchkinFunction('clickLink', {
                    href: paramStr
                });
            } else {
                console.error('Distributor link click tracking failed');
            }
        });
    });
});

$(document).ready(function () {
(function($) {

    /*Scroll to section aimed to perform scroll for Get Software and Sample & Buy tables, but might scroll to any other
      table(by it's ID) which is within tabcontnet. But updating hash should happen as of July 11 2019 for only 2 mentioned above*/
    /* Feb 15 2021: added Documentation section */
    var hashMap = {
        'section-sample-and-buy': '#sample-and-buy',
        'section-get-software-table': '#get-software',
        'section-documentation': '#documentation'
    }

    $(".st-main").on("click",'.js-st-scroll-to-section', function (e){
        var $this = $(this);
        var href = "#" + $this.data('href');
        var targetElem = $(href);
        var tabId = targetElem.parents('[data-page-content]').attr('data-page-content') || $this.data('tabId');

        if (!tabId) {
            return; // exit because we don't have enough info
        }

        var selectedTab = $('[data-nav-tab-id="' + tabId + '"]');
        if (!selectedTab.length) {
            selectedTab = $('[data-tab="' + tabId + '"]')
        }

        var tabContent = $('[data-page-content="' + tabId + '"]');

        var isActiveTab = selectedTab.hasClass('js-st-active');
        var isDynamicTab = !!tabContent.data('contentUrl');
        var isLoaded = tabContent.hasClass('is-loaded');

        if (hashMap[$this.data('href')]) {
            hashMap.currentHref = $this.data('href');
            hashMap.hash = {
                hashValue: hashMap[$this.data('href')]
            }
        } else {
            hashMap.hash = {}
        }

        if (isDynamicTab && !isLoaded) {
            // on the off chance that the loaded event is fired multiple times
            // we want to avoid running this handler against it again
            tabContent.one('loaded', function (evt) {
                if (!targetElem.length) {
                    targetElem = $(href);
                }

                // give everything time to settle
                setTimeout(function(){
                    animateScroll();
                }, 500);
            });

            if (!isActiveTab) {
                selectedTab.trigger('click', hashMap.hash);
            }
        } else if (!isActiveTab) {
            selectedTab.trigger('click', hashMap.hash);

            // give everything time to settle
            setTimeout(function(){
                animateScroll();
            }, 500);
        } else {
            //update hash manually if clicked button's data-href is in hashMap
            if (hashMap.hash.hashValue) {
                window.location.hash = hashMap.hash.hashValue;
            }

            animateScroll();
        }

        function animateScroll() {
            if (!targetElem.length) {
                return; // exit because we don't have a target
            }

            $('html, body').animate({
                scrollTop: targetElem.offset().top
            }, 300);
        }
    });

    var matchedHash = getMatchedHash();

    //whenever open up a page with a predefined hash #sample-and-buy - perform a click at a sample-and-buy button to scroll to a correspondent page section
    if (matchedHash) {

        //prevent browser from trying to manually scroll to the last scrolling position if refresh page with #sample-and-buy having scrollTop of the page other than 0
        if ('scrollRestoration' in history) {
          history.scrollRestoration = 'manual';
        }
        $(window).on('load', function() {
            setTimeout(function() {
                $('.st-main .js-st-scroll-to-section[data-href="' + matchedHash + '"]').trigger('click');
            });
        });
    }

    function getMatchedHash() {
        var hash = window.location.hash;
        var matches = null;
        if (hash) {
            for (var i in hashMap) {
                if (hashMap.hasOwnProperty(i)) {
                    if (hash === hashMap[i]) {
                        matches = i;
                    }
                }
            }
        }
        return matches;
    }
})(jQuery);
});

//establish name space for fed functions
var STFED = STFED || {};

//extend namespace for video method
STFED.video = {
    breakpointType: '',
    selector: '.js-video-list-column a[data-reveal-id="videoModal"]:not(.kms-only-video), .tooltip a[data-reveal-id="videoModal"]:not(.kms-only-video), .resources-component a[data-reveal-id="videoModal"]:not(.kms-only-video), .js-featured-videos a[data-reveal-id="videoModal"]:not(.kms-only-video)',
    generateModalVideo: function(videoElementId, posterLink, vidSource, vidType){
        return '<video playsinline id="' + videoElementId + '" class="video-js vjs-default-skin vjs-big-play-centered" controls preload="none" poster="'+ posterLink + '" data-setup=\'{"language":"st","fluid":true}\'> <source src="' + vidSource +  '" type="' + vidType +  '" /> <p class="vjs-no-js">To view this video please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a></p> </video>'
    },
    getResponsivePoster: function(video, forModal) {
        var $video = $(video);
        var prefix = (typeof forModal !== 'undefined' && forModal && 'poster-modal') || 'poster';

        return $video.data(prefix + '-' + this.breakpointType) ||
            (this.breakpointType !== 'desktop' && $video.data(prefix + '-mobile')) ||
            $video.data(prefix) ||
            $video.data('original-poster');
    },
    setResponsivePoster: function() {
    	this.setResponsivePosterForSelector(this.selector);
    },
    setResponsivePosterForSelector: function(selector) {
        var _ = this;
        var $videoModal = $('#videoModal.open');

        $(selector).each(function () {
            var $video = $(this);

            $video.find('> img').attr('src', _.getResponsivePoster(this));
        });
        if ($videoModal.length > 0) {
            var $video = $(selector)
                .filter('[data-video-source="' + $videoModal.find('video > source').attr('src') +'"]');
            var poster = _.getResponsivePoster($video, true);

            $videoModal.find('.vjs-poster').css('backgroundImage', 'url("' + poster + '")');
        }
    },
    getBreakpointUpdater: function(breakpointType) {
    	this.getBreakpointUpdaterForSelector(breakpointType, this.selector);
    },
    getBreakpointUpdaterForSelector: function(breakpointType, selector) {
        return function() {
            this.breakpointType = breakpointType;
            this.setResponsivePosterForSelector(selector);
        }.bind(this);
    },
    bindTrackEventsToVideo: function(video) {
        function onLoadedMetaData() {
            digitalData.media.duration = this.duration;
        }
        function onPlay() {
            var event = new CustomEvent('videoViewed', {bubbles: true});
            document.querySelector('body').dispatchEvent(event);
        }
        function onTimeUpdate() {
            if (!this.milestone25) {
                if (this.currentTime / this.duration > 0.25) {
                    var event = new CustomEvent('videoPlayedMilestone25', {bubbles: true});
                    document.querySelector('body').dispatchEvent(event);
                    this.milestone25 = true;
                }
            }
            if (!this.milestone50) {
                if (this.currentTime / this.duration > 0.5) {
                    var event = new CustomEvent('videoPlayedMilestone50', {bubbles: true});
                    document.querySelector('body').dispatchEvent(event);
                    this.milestone50 = true;
                }
            }
            if (!this.milestone75) {
                if (this.currentTime / this.duration > 0.75) {
                    var event = new CustomEvent('videoPlayedMilestone75', {bubbles: true});
                    document.querySelector('body').dispatchEvent(event);
                    this.milestone75 = true;
                }
            }
            if (!this.milestone95) {
                if (this.currentTime / this.duration > 0.95) {
                    var event = new CustomEvent('videoPlayedMilestone95', {bubbles: true});
                    document.querySelector('body').dispatchEvent(event);
                    this.milestone95 = true;
                }
            }
        }

        video.addEventListener('loadedmetadata', onLoadedMetaData);
        video.addEventListener('play', onPlay);
        video.addEventListener('timeupdate', onTimeUpdate);

        return function () {
          video.removeEventListener('loadedmetadata', onLoadedMetaData);
          video.removeEventListener('play', onPlay);
          video.removeEventListener('timeupdate', onTimeUpdate);
        };
    },
    init: function(){
    	this.initForSelector(this.selector);
    },
    initForSelector: function (selector, isEmbeddedVideo) {
        var _ = this;
        enquire.register(STFED.mediaQueries.smallMax, this.getBreakpointUpdaterForSelector('phone', selector));
        enquire.register(STFED.mediaQueries.mediumMax, this.getBreakpointUpdaterForSelector('tablet', selector));
        enquire.register(STFED.mediaQueries.largeMin, this.getBreakpointUpdaterForSelector('desktop', selector));
        $(selector).each(function () {
            var $video = $(this);
            var parent = $video.closest('.videos-item');
            var poster = '';

            if (parent.find('.ivt').length > 0) {
                poster = parent.find('.ivt').attr('src');
            } else if ($video.data('modal-poster')) {
                poster = $video.data('modal-poster');
            } else if ($video.find('> img').length > 0) {
                poster = $video.find('> img').attr('src');
            }

            $video.data('original-poster', poster);
        });
        if(isEmbeddedVideo){
        	var title = $(selector).attr("data-video-title") || $(selector).attr("data-modal-title");
        	var videoLink = $(selector).attr('data-video-source');
        	var videoFileType = $(selector).data('video-type');
        	var posterLink = _.getResponsivePoster(selector, true);
        	_.generateVideoPlayer(title, videoLink, posterLink, videoFileType, false, isEmbeddedVideo, selector);
        	return;
        }
        $(document).on('click', selector, function (e) {
            //get data from element that was just clicked
            var $root = $(this);
            var parent = $root.closest('.videos-item');
            var title;
            parent.find('.video-title > a').trigger("originalContent", function (content) {
                if (content.length >= 1) {
                    title = content.filter(function (key, value) {
                        return value.nodeName === 'A';
                    })[0].innerHTML;
                }
            });
            if (title === undefined && parent.find('.video-title > a').text() !== "") {
                title = parent.find('.data-modal-title > a').html();
            }
            if (title === undefined) {
                title = $root.data("modal-title") && $root.data("modal-title").toString();
            }

            var autoOpenLink = $root.data('auto-open-link');
            var videoLink = $root.data('video-source');
            var videoFileType = $root.data('video-type');
            var dataLinkLabel = $root.data('iframe-link-label');
            //set data to modal window
            $('#videoModalTitle').show();
            $('#videoModalTitle').html(title);
            var posterLink = _.getResponsivePoster($root, true);

            //set Cta
            cta = $root.data("modal-cta");
            ctaLink = $root.data("modal-cta-link");
            if (ctaLink === undefined) {
                ctaLink = "",
                    $('#videoModalLink').hide();
            } else {
                $('#videoModalLink').show();
                $('#videoModalLink').attr("href", ctaLink);
                $('#videoModalCta').html(cta);
            }

            //iframe video
            if ($root.data('iframe-video-source') != undefined) {
                var isEPresentation = $root.hasClass('e-presentation');
                var $iframe = $('<iframe id="iframe" width="1200" height="720" src="" frameborder="0" allowfullscreen />');
                var onIframeLoad = function () {
                    $(this).contents().find('body').append('<video controls autoplay style="width: 100%; height: 100%"><source src="' + $root.data('iframe-video-source') + '" type="video/mp4"></video>');
                    var video = $(this).contents().find('video')[0];
                    _.onVideoDestroy = STFED.video.bindTrackEventsToVideo(video);

                };
                var $container = $('#videoModal .flex-video');
                if(!$('#videoModal .direct-link-container').length) {
                    $container.html('');
                    if (autoOpenLink) {
                        $container.append($('<a href="' + autoOpenLink + '" onclick="javascript: return false;" class="link-icon">' +
                            '<svg><use xlink:href="#icon-link"></use></svg>' +
                            '</a>'));
                    }
                    if (/\.html*$/i.test($root.data('iframe-video-source'))) {
                        digitalData = window.digitalData || {};
                        digitalData.media = digitalData.media || {};
                        digitalData.media = {
                            type: 'ePresentation',
                            name: $.trim($root.data('iframe-video-title')),
                            videoLink: $root.data('iframe-video-source'),
                            duration: 0,
                        };
                        satelliteTrack('DC epresentation');
                        $iframe[0].src = $root.data('iframe-video-source');
                    } else {
                        $iframe[0].onload = onIframeLoad;
                        $iframe[0].src = 'about:blank';
                        $iframe.attr('data-src', 'about:blank');
                    }
                    $container.append($iframe);

                    if ($root.data('iframe-link')) {
                        $container.parent().append('<div class="direct-link-container"><a class="direct-link st-button st-button--primary" target="_blank" href="' + $root.data('iframe-link') + '"><span>' + dataLinkLabel + '</span> <svg class="st-button__icon st-button__icon--right"><use xlink:href="#icon-arrow-thin"></use></svg></a></div>');
                    }
                }
                if (isEPresentation) {
                    $('#videoModal').addClass('e-presentation');

                    digitalData = window.digitalData || {};
                    digitalData.media = digitalData.media || {};
                    digitalData.media = {
                        type: 'ePresentation',
                        name: $.trim($root.data('iframe-video-title')),
                        videoLink: $root.data('iframe-video-source'),
                        duration: 0,
                    };
                } else {
                    digitalData = window.digitalData || {};
                    digitalData.media = digitalData.media || {};
                    digitalData.media = {
                        type: 'video',
                        name: $.trim($root.data('iframe-video-title')),
                        videoLink: $root.data('iframe-video-source'),
                        duration: 0,
                    };
                }
            }
            //videoplayer
            else {
            	_.generateVideoPlayer(title, videoLink, posterLink, videoFileType, autoOpenLink);
            }
        });
        $('#videoModal:not(.kms-only-video)').on('close.fndtn.reveal', function(e) {
            // prevent from trigger the event twice (Foundation 5 bug)
            // see also here: https://github.com/zurb/foundation-sites/issues/5482
            if (e.namespace !== 'fndtn.reveal') {
                var modal = $(this);
                
                //remove  delay when content slides up
                $('#videoModalLink').hide();
                $('#videoModalTitle').hide();
    
                if (modal.hasClass('e-presentation')) {
                    modal.removeClass('e-presentation');
                    if (_.onVideoDestroy) {
                        _.onVideoDestroy();
                    }
                }
                if ($('#videoModalContent').length) {
                    var player = videojs("videoModalContent");
                    if (_.onVideoDestroy) {
                        _.onVideoDestroy();
                    }
                    // destroy the player
                    player.dispose();
    
                    // remove the entire player from the dom
                    //$(player.el).remove();
                    // keep the player in the dom + remove all content from it, Chase edit
                }
    
                $('#videoModal .flex-video').html("");
    
                if ($('#videoModal .direct-link-container').length) {
                    $('#videoModal .direct-link-container').remove();
                }
            }
        });
        $(document).on('keydown', function (e) {
            e = e || window.event;
            if (e.keyCode === 27 || e.keyCode === 13) {
                //5140 hack to prevent modal close on esc when player is fullscreen
                setTimeout(function () {
                    window.isPlayerFullscreen = false;
                }, 10);
                if ($('.st-modal__video').children().length && $('#videoModal').is(':not(.kms-only-video)')) {
                    var player = videojs.players.videoModalContent;
                    if (player != null && player.isFullscreen()) {
                        player.exitFullscreen();
                    } else {
                        var modal = $('#videoModal');

                        //remove  delay when content slides up
                        $('#videoModalLink').hide();
                        $('#videoModalTitle').hide();

                        if (modal.hasClass('e-presentation')) {
                            modal.removeClass('e-presentation');
                            if (_.onVideoDestroy) {
                                _.onVideoDestroy();
                            }
                        }
                        if ($('#videoModalContent').length){
                            var player = videojs("videoModalContent");
                            if (_.onVideoDestroy) {
                                _.onVideoDestroy();
                            }
                            // destroy the player
                            player.dispose();

                            // remove the entire player from the dom
                            //$(player.el).remove();
                            // keep the player in the dom + remove all content from it, Chase edit
                        }

                        $('#videoModal .flex-video').html("");

                        if ($('#videoModal .direct-link-container').length) {
                            $('#videoModal .direct-link-container').remove();
                        }
                        modal.foundation('reveal', 'close');
                    }
                }
            }
        });
    }, 
    generateVideoPlayer: function(title, videoLink, posterLink, videoFileType, autoOpenLink, isEmbeddedVideo, selector){
        digitalData = window.digitalData || {};
        digitalData.media = digitalData.media || {};
        digitalData.media = {
            type: 'video',
            name: title && title.trim() || videoLink,
            videoLink: videoLink,
            duration: 0,
        };
        var videoElementId = !isEmbeddedVideo ? "videoModalContent" : (!selector ? "videoEmbeddedContent" : "video-embedded-content-" + STFED.video.getIdCounter());
        //create video player, Chase Edit
        var video = $(STFED.video.generateModalVideo(videoElementId, posterLink, videoLink, videoFileType));

        _.onVideoDestroy = STFED.video.bindTrackEventsToVideo(video[0]);

        if (!isEmbeddedVideo) {
            var $container = $('#videoModal .flex-video');
            
            $container.html("");

            if (typeof window.emitCustomEvent !== 'undefined') {
                window.emitCustomEvent('video-was-viewed', {
                    media: digitalData.media
                });
            }

            if (autoOpenLink) {
                $container.append($('<a href="' + autoOpenLink + '" onclick="javascript: return false;" class="link-icon">' +
                        '<svg><use xlink:href="#icon-link"></use></svg>' +
                    '</a>'));
            }

            $container.append(video);
        } else {
        	$(selector).append(video)
        }

        setTimeout(function() {
        	if(!isEmbeddedVideo){
        		videojs("videoModalContent", {}, function () {
        			var player = this;
        			
        			//init new video
        			//5140 hack to prevent modal close on esc when player is fullscreen
        			this.on("fullscreenchange", function () {
        				window.isPlayerFullscreen = true;
        			})
        		});
        	} else {
        		videojs(videoElementId, {});        		
        	}
        }, 250);
    },
    getIdCounter: function(){
    	if(!STFED.video.idCounter){
    		STFED.video.idCounter = 1;
    		return STFED.video.idCounter;
    	}
    	return STFED.video.idCounter++;
    }
};

$(document).ready(function () {
    (function($) {
        STFED.video.init();
    })(jQuery);
});

/* Video Center filters */
(function($, window){
    // example filter: video-page.html?q=searchterm&products=STM8AL21,DP15S3&applications=123,qwe32&order=recent&page=2
    // FED example filter: video_list_page/?products=large-bonsai-checkbox-5&applications=large-bonsai-checkbox-11&order=option2&count=200&q=STM32#

    var VideoFilters = function(element, options){
        this.element = element;
        this.options = options;
        this.defaults = {
            containerSelector: '.js-st-videoFilters',
            activeSidebar: '.js-st-sidebar-active',
            textQuerySelector: '.js-st-textQuery',
            productFilterSelector: '.js-st-productFilter',
            applicationFilterSelector: '.js-st-applicationFilter',
            filterSelector: '[data-filter]',
            orderSelector: '[data-order-filter]',
            countSelector: '[data-count-filter]',
            resetBtnSelector: '[data-clear-filters]',
            applyBtnSelector: '[data-apply-filters]',
            removeBtnsWrapper: '.js-st-sidebar-checkboxes-selected-elements',
            removeBtnSelector: '[data-remove-filter]',
            productParam: 'products',
            applicationParam: 'applications',
            orderParam: 'order',
            countParam: 'count',
            pageParam: 'page',
            textQueryParam: 'q',
            textBtnSelector: '#textQuery > button',
            featuredVideosRefererParam: 'featuredVideosReferer'
        };

        return this;
    };

    VideoFilters.prototype = {
        init: function(){
            var _ = this;

            _.settings = $.extend({}, _.defaults, _.options);

            // elements
            _.filterContainer = $(_.settings.containerSelector);
            _.orderFilter = $(_.settings.orderSelector);
            _.countFilter = $(_.settings.countSelector);
            _.filters = $(_.settings.filterSelector);
            _.resetBtn = $(_.settings.resetBtnSelector);
            _.removeBtns = $(_.settings.removeBtnSelector);
            _.removeBtnsWrapper = $(_.settings.removeBtnsWrapper);
            _.applyBtns = $(_.settings.applyBtnSelector);
            _.openSearchBtn = $(_.settings.textBtnSelector);

			_.featuredVideosReferer = _.getQueryVariable(_.settings.featuredVideosRefererParam);

            // filter params
            _.page = _.getQueryVariable(_.settings.pageParam);
            _.order = _.getQueryVariable(_.settings.orderParam);
            _.count = _.getQueryVariable(_.settings.countParam);
            _.products = _.getQueryVariable(_.settings.productParam) ? _.getQueryVariable(_.settings.productParam).split(",") : false;
            _.applications = _.getQueryVariable(_.settings.applicationParam) ? _.getQueryVariable(_.settings.applicationParam).split(",") : false;
            _.textQueryParam = _.getQueryVariable(_.settings.textQueryParam) ? _.getQueryVariable(_.settings.textQueryParam).split(",") : false;

            _.orderFilter.on('selectric-change', function(evt){
                _.order = $(this).val();
                _.applyFilters(true);
            });

            _.countFilter.on('selectric-change', function(evt){
                _.count = $(this).val();
                _.applyFilters(true);
            });

            if(_.order) {
               _.orderFilter.val(_.order).selectric('refresh'); ;
            }

            if(_.count) {
               _.countFilter.val(_.count).selectric('refresh'); ;
            }

            if (_.textQueryParam){
                $(_.settings.textQuerySelector + " input[type=text]").val(_.textQueryParam);
            }

            if (_.products){
                for(i=0; i<_.products.length; i++){
                    $(" input[name="+ _.products[i] + "]").prop('checked', true);
                }

                $(_.settings.productFilterSelector + " .js-st-sidebar-checkboxes").each(function(){
                    STFED.filterTreeCheckboxes.filterCheckboxHandler($(this));
                });
            }

            if (_.applications){
                for(i=0; i<_.applications.length; i++){
                    $(" input[name="+ _.applications[i] + "]").prop('checked', true);
                }

                $(_.settings.applicationFilterSelector + " .js-st-sidebar-checkboxes").each(function(){
                    STFED.filterTreeCheckboxes.filterCheckboxHandler($(this));
                });
            }
            
            _.applyBtns.on('click', function(evt){
                var selectedProducts = $(_.settings.activeSidebar + " " +  _.settings.productFilterSelector + " input[type=checkbox]:checked"),
                    selectedApplications = $(_.settings.activeSidebar + " " + _.settings.applicationFilterSelector + " input[type=checkbox]:checked"),
                    textQuery = $(_.settings.activeSidebar + " " + _.settings.textQuerySelector + " input[type=text]").pVal(),
                    i = 0;

                _.products = [];
                _.applications = [];
                _.page = false;

                for(i=0; i<selectedProducts.length; i++){
                    _.products.push($(selectedProducts[i]).attr("id"));
                }

                for(i=0; i<selectedApplications.length; i++){
                    _.applications.push($(selectedApplications[i]).attr("id"));
                }

                if(textQuery) {
                    _.textQueryParam = textQuery;
                }

                _.applyFilters();
            });

            _.resetBtn.on('click', function(evt){
                _.clearFilters();
            });


            _.removeBtnsWrapper.on('click', _.removeBtns, function(evt) {
                evt.preventDefault();

                var filter = $(evt.target).closest(".st-tree-checkboxes-selected-elements__element").data('checkbox-id') || $(evt.target).closest(".st-tree-checkboxes-selected-elements__element").attr('data-checkbox-id'),
                    i = 0,
                    removeItems = [];

                filter.replace(/ /g, "+");

                _.page = false;

                if($(evt.target).closest(".st-sidebar__filter").next(_.settings.productFilterSelector).length){
                    removeItems = [];

                    for(i=0; i<_.products.length; i++){
                        if(_.products[i] === filter){
                            removeItems.push(i);
                        }
                    }

                    for(i=0; i<removeItems.length; i++){
                        _.products.splice(removeItems[i], 1);
                    }
                }else if($(evt.target).closest(".st-sidebar__filter").next(_.settings.applicationFilterSelector).length){
                   removeItems = [];

                    for(i=0; i<_.applications.length; i++){
                        if(_.applications[i] === filter){
                            removeItems.push(i);
                        }
                    }

                    for(i=0; i<removeItems.length; i++){
                        _.applications.splice(removeItems[i], 1);
                    }
                }else if($(evt.target).closest(_.settings.textQuerySelector).length){
                    _.textQueryParam = false;
                }

                _.applyFilters();
            });
        },
        getQueryVariable: function(variable){
            var query = window.location.search.substring(1);
            var vars = query.split("&");

            for (var i=0;i<vars.length;i++){
                var pair = vars[i].split("=");

                if(pair[0] == variable){
                    return pair[1];
                }
            }

            return false;
        },
        buildQuery: function(isFilterByOrder){
            var _ = this,
                query = "";

            if(_.products && _.products.length){
                if(!query){
                    query = _.settings.productParam + "=" + _.products.join();
                }else{
                    query += "&" + _.settings.productParam + "=" + _.products.join();
                }
            }

            if(_.applications && _.applications.length){
                if(!query){
                    query = _.settings.applicationParam + "=" + _.applications.join();
                }else{
                    query += "&" + _.settings.applicationParam + "=" + _.applications.join();
                }
            }

            if(_.order){
                if(!query){
                    query = _.settings.orderParam + "=" + _.order;
                }else{
                    query += "&" + _.settings.orderParam + "=" + _.order;
                }
            }

            if(_.count){
                if(!query){
                    query = _.settings.countParam + "=" + _.count;
                }else{
                    query += "&" + _.settings.countParam + "=" + _.count;
                }
            }

            if(_.page){
                if(!query){
                    query = _.settings.pageParam + "=" + _.page;
                }else{
                    query += "&" + _.settings.pageParam + "=" + _.page;
                }
            }

            if(_.textQueryParam){
                if(!query){
                    query = _.settings.textQueryParam + "=" + _.textQueryParam;
                }else{
                    query += "&" + _.settings.textQueryParam + "=" + _.textQueryParam;
                }
            }

			if(_.featuredVideosReferer && isFilterByOrder){
                if(!query){
                    query = _.settings.featuredVideosRefererParam + "=" + _.featuredVideosReferer;
                }else{
                    query += "&" + _.settings.featuredVideosRefererParam + "=" + _.featuredVideosReferer;
                }
            }

            return encodeURI(query.replace(/ /g, "+"));
        },
        applyFilters: function(isFilterByOrder){
            var _ = this;

            window.location.search = _.buildQuery(isFilterByOrder);
            window.emitCustomEvent('onstatechange');
        },
        clearFilters: function(){
            window.location.search = "";
            window.emitCustomEvent('onstatechange');
        }
    };

    window.VideoFilters = VideoFilters;
})(jQuery, window);

var mktoFormScriptLoading = $.Deferred();
var NewsletterSubscription = {
    mktoFormScriptLoading: false,
    validSubmitted: false,

    init: function (selector) {
        var self = this;
        $(selector).each(function () {
            var form = $(this);
            var inputClassHelper = '.placenewsletter-helper';
            var validationForm = $('form.validation-form');
            var context = form.closest('.js-st-latest-from-st-widget').length ? form.closest('.js-st-latest-from-st-widget') : form;
            var mktoDomain = form.data('mkto-domain');
            var mktoMunchkinId = form.data('mkto-munchkin-id');
            var mktoFormId = form.data('mkto-form-id');
            var mktoPreferredLanguage = form.data('mkto-preferred-language');
            

            form.find('#placenewsletter').addClass(inputClassHelper.replace('.', ''));

            context.off('click', '.newsletter-submit').on('click', '.newsletter-submit', function (event) {
                if (!!mktoFormId && mktoFormScriptLoading.state() === "pending") {
                    $('body').append($('<form>').addClass('hidden').attr('id', mktoFormId));
                    mktoFormScriptLoading = $.getScript('//content.st.com/js/forms2/js/forms2.min.js')
                        .then(function () {
                            var formInitialization = $.Deferred();
                            if (typeof window.STFED !== 'undefined' && STFED.injectMarketoFields) {
                                STFED.injectMarketoFields();
                            }
                            MktoForms2.loadForm(mktoDomain, mktoMunchkinId, mktoFormId, function (mktoForm) {
                                if (mktoPreferredLanguage) {
                                    try {
                                        var marketoFieldId = window.STFED.Marketo.resolveFieldId('preferredLanguage');
                                        if (marketoFieldId) {
                                            var payload = {};
                                            payload[marketoFieldId] = mktoPreferredLanguage;
                                            mktoForm.addHiddenFields(payload);
                                        }
                                    } catch (ex) {
                                        console.error(ex);
                                    }
                                }
                                mktoForm.onSuccess(function () {
                                    return false;
                                });
                                formInitialization.resolve(mktoForm);
                            });
                            return formInitialization.promise();
                        });
                    
                }
                $('#newsletter-subscription-validation-popup').off('show.bs.modal').on('show.bs.modal', function (e) {
                    if (!self.isInputValid(form, inputClassHelper)[0]) {
                        e.preventDefault();
                    }
                    $('#validationEmail').val(form.find(inputClassHelper).pVal());
                    self.manageForm(validationForm, form, inputClassHelper);
                });
            });

            validationForm.off('click', '.newsletter-submit').on('click', '.newsletter-submit', function () {
                self.manageForm(validationForm, form, inputClassHelper);
                if (self.validSubmitted) {
                    $('#newsletter-subscription-confirmation-popup').modal('show');
                    self.validSubmitted = self.validateAndSubmit(validationForm, mktoFormScriptLoading);
                    $('#newsletter-subscription-validation-popup').modal('hide');
                }
            });

            context.on('keydown', inputClassHelper, function (e) {
                e = e || window.event;
                self.manageButton(context, inputClassHelper);
                if (e.keyCode == 13) {
                    e.preventDefault();
                    if (self.isInputValid(form, inputClassHelper)[0]) {
                        form.find('.newsletter-submit').click();
                    }
                }
            });

            context.on('keyup blur change paste', inputClassHelper, function (e) {
                self.manageButton(context, inputClassHelper);
            });

            validationForm.on('keyup blur change', '#validationEmail', function (e) {
                self.manageForm(validationForm, form, inputClassHelper);
            });

            validationForm.on('keydown', '#validationEmail', function (e) {
                e = e || window.event;
                self.manageForm(validationForm, form, inputClassHelper);
                if (e.keyCode == 13) {
                    e.preventDefault();
                    validationForm.find('.newsletter-submit').click();
                }
            });

            form.closest('.js-st-latest-from-st-widget').on('init', function () {
                var slider = $(this);
                slider.on('keyup blur change paste', inputClassHelper, function () {
                    var input = $(this);
                    setTimeout(function () {
                        var value = input.val();
                        slider.find(inputClassHelper).not(input).each(function () {
                            $(this).val(value);
                            self.manageButton(context, inputClassHelper);
                        });
                    });
                });
            });

            self.manageButton(context, inputClassHelper);
        });
    },

    isInputValid: function (form, inputClassHelper) {
        var emailRegEx = /[...]/;
        return [emailRegEx.test(form.find(inputClassHelper).pVal()), emailRegEx.test($('form.validation-form').find('#validationEmail').pVal())];
    },

    manageForm: function (validationForm, form, inputClassHelper) {
        if (this.isInputValid(form, inputClassHelper)[1]) {
            this.enableSubmit(validationForm);
            this.validSubmitted = true;
        } else {
            this.disableSubmit(validationForm);
            this.validSubmitted = false;
        }
    },

    manageButton: function (context, inputClassHelper) {
        if (this.isInputValid(context, inputClassHelper)[0]) {
            this.enableButton(context);
            this.validSubmitted = true;
        } else {
            this.disableButton(context);
            this.validSubmitted = false;
        }
    },

    enableButton: function (context) {
        context.find('.newsletter-submit').removeClass('disabled');
        context.find('.newsletter-error-message').addClass('hidden');
    },

    disableButton: function (context) {
        context.find('.newsletter-submit').addClass('disabled');
        if(context.find('#placenewsletter')[0].value.trim() !== '') {
            context.find('.newsletter-error-message').removeClass('hidden');
        }
    },

    enableSubmit: function (validationForm) {
        validationForm.find('.newsletter-submit').removeClass('disabled');
        validationForm.find('.newsletter-error-message').addClass('hidden');
    },

    disableSubmit: function (validationForm) {
        validationForm.find('.newsletter-submit').addClass('disabled');
        validationForm.find('.newsletter-error-message').removeClass('hidden');
    },

    validateAndSubmit: function (validationForm, mktoFormScriptLoading) {
        var email = validationForm.find('#validationEmail').pVal().toLowerCase();
        if (this.isInputValid(validationForm, '#validationEmail')) {
            mktoFormScriptLoading.then(function (form) {
                var vals = {'Email': email};
                var dVars = {};
                validationForm.find('input[type="hidden"][name*=\"enriched\"]').each(function () {
                    dVars[this.name] = this.value;
                });
                form.addHiddenFields(dVars);
                form.vals(vals);
                form.submit();
            });
            return true;
        }
        return false;
    }
};

(function ($) {
    $.fn.pVal = function () {
        var $this = $(this), val = $this.eq(0).val();
        return val === $this.attr('placeholder') ? '' : val;
    };
})(jQuery);
/*newsletter.js end*/
/*kampyle.js*/

/**
 * Workaround for Kampyle.js script. Kampyle feedback form calculates size of the screen incorrectly after some DOM
 * manipulations therefore we should trigger this event manually.
 */
(function($) {
  "use strict";
  $(window).on("content-changed", function() {
    var ua = navigator.userAgent;
    var isWebkitMobile = (ua.indexOf(" AppleWebKit") >= 0 && ua.indexOf("Mobile") >= 0 && ua.indexOf("iPad") < 0) || ua.indexOf("Nokia") >= 0 || ua.indexOf("BlackBerry") >= 0;
    if (isWebkitMobile){
      if(window.k_button){
        window.k_button.ff_link.style.top = -1000 + "px";
        setTimeout(function(){
          window.dispatchEvent(new Event('resize',{}));
        },500);
      }
    }
  });
})(jQuery);

/*kampyle.js end*/

/*body-lock.js*/

(function ($) {
    'use strict';

    var savedPosition;

    // PlEASE check 'open' and 'close' after foundation upgrade they are deprecated and may have been replaced by the namespaced 'open.fndtn.reveal' and 'close.fndtn.reveal' events

    $(document).on('open', '[data-reveal]', function () {
        var modalId = $(this).attr('id');
        var modal = document.querySelector("#" + modalId);

        $('html').addClass('st-has-active-modal');
        if ($(window).width() < 1025) {
            bodyScrollLock.disableBodyScroll(modal);
        }
    });

    $(document).on('body-locked', function (event) {
        if (event.originalEvent.detail.savePosition) {
            savedPosition = $(window).scrollTop();
            $(window).scrollTop(0);
        }
        bodyScrollLock.disableBodyScroll();
    });

    $(document).on('body-unlocked', function (event) {
        var restorePosition = event.originalEvent.detail.restorePosition;
        var position = restorePosition && savedPosition;

        if (restorePosition && restorePosition.constructor === Number) {
            position = restorePosition;
        }

        if (position) {
            $(window).scrollTop(position);
            savedPosition = null;
        }
        bodyScrollLock.clearAllBodyScrollLocks();
    });

    $(document).on('close', '[data-reveal]', function () {
        bodyScrollLock.clearAllBodyScrollLocks();
        $('html').removeClass('st-has-active-modal');
    });

    //on resize
    $(window).on('resize', _.debounce(function () {
        if ($('html').hasClass('st-has-active-modal')) {
            if ($(window).width() > 1024) {
                bodyScrollLock.clearAllBodyScrollLocks();
            } else {
                bodyScrollLock.disableBodyScroll();
            }
        }
    }, 100));
    // resize end


    $('.modal').on('shown.bs.modal', function () {
        var modalId = $(this).attr('id');
        var modal = document.querySelector("#" + modalId);
        bodyScrollLock.disableBodyScroll(modal);
    });
    $('.modal').on('hide.bs.modal', function () {
        bodyScrollLock.clearAllBodyScrollLocks();
    });

    $(document).on('keydown', function (e) {
        e = e || window.event;
        if (e.keyCode === 27 || e.keyCode === 13) {
            var $revealModalBg = $('.reveal-modal-bg');
            if ($revealModalBg.is(':visible')) {
                bodyScrollLock.clearAllBodyScrollLocks();
            }
        }
    });
})(jQuery);

/*body-lock.js end*/
(function ($) {
    var isMobile = false;

    enquire.register(STFED.mediaQueries.smallMax, {
        match : function() {
            isMobile = true;
        },
        unmatch : function() {
            isMobile = false;
        }
    });

    function TooltipPopup(options) {
        this.additionalClass = options.additionalClass;
        this.$toggler = options.toggler;
        this.$source = options.source;
        this.$popup = null;
        this.hideTimeout = null;
        this.hideTimer = null;
        this.$status = null;
        this.exitHandler = null;
        this.mouseMoveHandler = null;
    }

    TooltipPopup.prototype.show = function () {
        var self = this;

        this.stopHideAfterDelay();

        if (this.$popup) {
            return;
        }

        this.$popup = $('<div class="tooltip-popup">');
        if (this.additionalClass) {
            this.$popup.addClass(this.additionalClass);
        }
        this.$popup.html(this.$source.html());
        this.$status = this.$popup.find('.hide-status');

        this.$status.hide();
        this.$status.append($('<div/>'));

        $('body').append(this.$popup);

        this.setBestPosition();

        this.mouseMoveHandler = function (event) {
            var $target = $(event.target);

            if (self.$popup && (!self.hideTimeout && !self.hideTimer) && (!$target.is(self.$toggler) && self.$toggler.has($target).length === 0)) {
                self.startHideAfterDelay();
            }

            if ((self.hideTimeout || self.hideTimer) && ($target.is(self.$popup) || self.$popup.has($target).length !== 0)) {
                self.stopHideAfterDelay();
            }
        };

        this.exitHandler = function (event) {
            var $target = $(event.target);

            if (self.$popup.has($target) && $target.is('a[href]')) {
                self.hide();
            }
        };

        $(document).on('mousemove', this.mouseMoveHandler);
        $(document).on('click', this.exitHandler);
    }

    TooltipPopup.prototype.startHideAfterDelay = function () {
        var self = this;

        if (self.hideTimeout) {
            return;
        }

        self.hideTimeout = setTimeout(function () {
            self.stopHideAfterDelay();

            self.$status.show().find('div').width('100%');

            var invocations = 0;

            self.hideTimer = setInterval(function () {
                if (self.$status) {
                    self.$status.find('div').width(100 - ((50 * invocations) / 1000) * 100 + '%');
                }
                if (invocations > 20) {
                    self.hide();
                }
                invocations++;
            }, 50);
        }, 500);
    }

    TooltipPopup.prototype.stopHideAfterDelay = function () {
        var self = this;

        if (this.hideTimeout) {
            clearTimeout(this.hideTimeout);
            this.hideTimeout = null;
        }

        if (this.hideTimer) {
            clearInterval(this.hideTimer);
            this.hideTimer = null;
        }

        if (this.$status) {
            this.$status.hide();
        }
    }

    TooltipPopup.prototype.hide = function () {
        this.stopHideAfterDelay();

        if (this.mouseMoveHandler) {
            $(document).off('mousemove', this.mouseMoveHandler);
            this.mouseMoveHandler = null;
        }
        if (this.exitHandler) {
            $(document).off('click', this.exitHandler);
            this.exitHandler = null;
        }

        if (this.$popup) {
            this.$popup.remove();
            this.$popup = null;
            this.$status = null;
        }
    }

    TooltipPopup.prototype.setBestPosition = function () {
        var $window = $(window);
        var vw = $window.width();
        var vh = $window.height();
        var $toggler = this.$toggler;
        var $solutionCost = $('#solution-evaluation-kit-cost');
        var $distributorsToggler = $('.js-distributors-toggler:not(.hidden)');
        var $solutionButton = $('#solution-evaluation-kit-buy-button');

        if ($solutionButton.length > 0 && !$solutionButton.parent().is('.hidden')) {
            $toggler = $solutionButton;
        } else if ($distributorsToggler.length > 0) {
            $toggler = $distributorsToggler;
        } else if ($solutionCost.length > 0) {
            $toggler = $solutionCost;
        }

        var togglerWidth = $toggler.width();
        var togglerHeight = $toggler.height();
        var togglerOffset = $toggler.offset();
        var togglerLeft = togglerOffset.left;
        var togglerRight = togglerLeft + togglerWidth;
        var togglerTop = togglerOffset.top;
        var togglerBottom = togglerTop + togglerHeight;
        var togglerViewportOffsetTop = togglerTop - $window.scrollTop();
        var togglerViewportOffsetBottom = togglerViewportOffsetTop + togglerHeight;

        var bestPosition = {};

        this.$popup.removeClass('is-mobile');

        if (isMobile) {
            bestPosition.left = 0;
            this.$popup.addClass('is-mobile');
            this.$popup.removeClass('is-right-position');
        } else if (vw - (togglerRight - (togglerWidth / 2)) > 280) {
            this.$popup.removeClass('is-right-position');
            bestPosition.left = togglerRight - (togglerWidth / 2);
        } else if (togglerLeft > vw - togglerRight) {
            bestPosition.left = togglerLeft - 15;
            this.$popup.addClass('is-right-position');
        } else {
            this.$popup.removeClass('is-right-position');
            bestPosition.left = togglerRight + 15;
        }

        if (togglerViewportOffsetTop > 250 || togglerViewportOffsetTop > vh - togglerViewportOffsetBottom) {
            bestPosition.top = togglerTop - togglerHeight - 10;
            this.$popup.addClass('is-bottom-position');
        } else {
            this.$popup.removeClass('is-bottom-position');
            bestPosition.top = togglerBottom + togglerHeight + 10;
        }

        this.$popup.css(bestPosition);
    }

    $.fn.tooltipPopup = function (actionOrOptions) {
        if (typeof actionOrOptions === 'string') {
            var instance = this.data('tooltip-popup');

            if (instance) {
                if (instance[actionOrOptions]) {
                    instance[actionOrOptions]();
                } else {
                    console.error('tooltipPopup', 'Method ' + actionOrOptions + 'does not exist');
                }
            } else {
                console.error('tooltipPopup', 'Calling action on undefined instance is not permited');
            }
        } else if (!instance) {
            this.data('tooltip-popup', new TooltipPopup(actionOrOptions));
        }
    };
})(jQuery);

/*soco-window.js*/
/**
 * Support&Community modal window creation
 */
(function ($) {
  $(function () {
    var conatiner = $('#supportAndCommunityModal .communitylist')[0];
    if (conatiner) {
      conatiner = $(conatiner);
      var prmisId = conatiner.attr('data-prmisid');
      var template = _.template('<p><a href="<%= path %>.html"><%= title %></a><br><%= description %></p>');
      var defaultObject = { 'path': '#', 'title': '', 'description': '' };
      renderSupportAndCommunityList(conatiner, template, prmisId, defaultObject);
    }
  });
  /**
   * Insert community lists instead of specified container based on specified prmisId
   * @param container
   * @param template
   * @param prmisId
   */
  function renderSupportAndCommunityList(container, template, prmisId, defaultObject) {
    var linksList = "";
    if (template && prmisId) {
      $.ajax({
          url: "/bin/st/product-community.json?productId=" + prmisId,
          type: 'GET',
          dataType: 'json'
        })
        .done(function (data) {
          if (data && data.items) {
            var items = data.items;
            for (var i = items.length; i--;) {
              // generate list with links
              linksList += template($.extend(true, defaultObject, items[i]));
            }
            $(container).replaceWith(linksList);
          }
        });
    }
  }
})(jQuery);
/*soco-window.js end*/
/* Solution-widget.js */
(function($) {
//expand solution widget rows on item click
    var isInpageVersion = $('.solutions-widget-container').hasClass('main-body') ||
                      $('.solutions-widget-container').hasClass('tab-type-parts-list') ||
                      $('.solutions-widget-container').hasClass('tab-type') ||
                      ($('.search').length > 0 && $('.search').hasClass('search-styling'));
    var pageType = "default";
    if ($(".application-page-marker").length) {
        pageType = "Application";
    } else if ($(".productFolder-page-marker").length) {
        pageType = "productFolder";
    }
    var getQueryParams = function (qs) {
        qs = qs.split('+').join(' ');

        var params = {},
            tokens,
            re = /[?&]?([^=]+)=([^&]*)/g;

        while (tokens = re.exec(qs)) {
            params[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);
        }

        return params;
      },
      loadSolutionByName = function(solutionName){
        $('.solutions-widget-container').each(function(){
          var linkTarget = $(this).find('a[data-solution-name="'+ solutionName + '"]'),
              isRightRail = $(this).hasClass('right-rail'),
              parentDivOffset;

          if(!linkTarget) {
            return;
          }

          if (!linkTarget.closest('.row.hide-eligible-item').hasClass('active')) {
            linkTarget.trigger('click');
          }

          parentDivOffset = linkTarget.closest('div.row').offset();

          if(!parentDivOffset || isRightRail){
            return;
          }

          $('html,body').animate({
            scrollTop: parentDivOffset.top - 55
          }, 1000);
        });
      },
      digitalData = window.digitalData || {},
      buildHex = function(len){
        var hex = '0x1';

        for(var i=0;i<len;i++){
            hex += '0';
        }

        return parseInt(hex,16);
      },
      uniqueString = new Date().getTime() + Math.floor((Math.random() + 1) * buildHex(7)).toString(16).substring(1);

      /* 3.2.1 Loading of the page application or product/application folder start */
      if ($('.solutions-widget-container').length) {
          if (!digitalData.component) {
              digitalData.component = pageType;
          }
          satelliteTrack('DCpfapp');
      } else {
          if (!isInpageVersion) {
              if ((PartnerPages && PartnerPages.isPartnerPage) || (PartnerPages && PartnerPages.referrerIsPartnerPage)) {
                  digitalData.component = PartnerPages.component();
              } else {
                  if (!digitalData.component) {
                      digitalData.component = pageType;
                  }
                  satelliteTrack('DCpfapp');
              }
          }
      }
      /* 3.2.1 Loading of the page application or product/application folder end */

      /* 3.2.2 Click on "see all" in the widget start */
      $('.solutions-widget-container').on('click', '.toggle-eligible-items a.default', function(e){
        var linkText = 'See all',
            linkId = $(this).attr('id') || '',
            trackingData = {
              clicked: '0:' + linkId + ':' + linkText
            };

        if(isInpageVersion){
          return;
        } else {
          trackingData.component =  pageType + ':solution widget';
          $.extend(digitalData, trackingData);
          satelliteTrack('DCbtnclick');
        }
      });
      /* 3.2.2 Click on “see all" in the widget end */

      /* 3.2.3 Click on a “[solution part number link]” in the widget  start */
      $('.solutions-widget-container').on('click', 'a[data-toggle="modal"], .see-more-loader', function(e){
        var linkId = $(this).attr('id') || '',
            linkText = $(this).closest('.see-more-loader').data('solution-name'),
            linkIndex = $(this).closest('.js-st-accordion-menu').index();

        var position = isInpageVersion ? linkIndex/2 + 1 : linkIndex + 1; //starts from 1

        trackingData = {
          clicked: position + ':' + linkId + ':' + linkText,

          component: pageType + ':solution widget'
        };

		  if (pageType !== 'Application' || $(this).parents('#app-solutions-block-title').length > 0) {
              trackingData.solwidname = linkText;
          } else {
              if (digitalData.product && digitalData.product.length && digitalData.product[0].productInfo && digitalData.product[0].productInfo.tree) {
                  digitalData.product[0].productInfo.tree.level6 = linkText;
              }
          }

        $.extend(digitalData, trackingData);
        satelliteTrack('DCbtnclick');
      });
      /* 3.2.3 Click on a “[solution part number link]” in the widget  end */

      /* 3.2.4 Click on a “Product details” button in table quickview */
      $('#genericModalTrim, .solutions-widget-container').on('click', 'a.solution-widget-read-more', function(e){

        if ($(window).width() < STFED.breakpoint.mediumMin) {
            var targetTr = $(e.target).closest('.js-st-quickview').prev();
        } else {
            var targetTr = $(e.target).closest('tr').prev();
        }

        var linkId = $(this).attr('id') || '',
            partNumber = $(e.target).closest('a.solution-widget-read-more').data("part-number"),
            linkText = 'Product details',
            productId = targetTr.data('product-id'),
            level6 = targetTr.data('product-level6'),
            trackingData = {
              clicked: '0:' + linkId + ':' + linkText,
              solwidname: partNumber
            };

        if (pageType == 'productFolder') {
            digitalData.product[0].productInfo.productID = productId;
            digitalData.product[0].productInfo.tree.level6 = level6;
        }

        if(isInpageVersion){
          trackingData.component = pageType + ":Solution In-page Window";
        } else {
          trackingData.component = pageType + ":Solution Modal Window";
        }

        $.extend(digitalData, trackingData);
        satelliteTrack('DCbtnclick');
      });
      /* 3.2.4 Click on a “Product details” button in table quickview end */

    var setAttrsOnDownloadItems = function(productId, level6, activeTr) {
        /* 3.2.5 Download a file in the quickview  start */

        var activeSolution = activeTr;
        var partNumber = activeSolution.find('a.show-content').data('part-number');
        var solutionName;
        if(pageType === 'Application') {
            $.each($('.solutions-widget-container .js-st-accordion-expanded .see-more-loader'), function (key, val) {
                var value = $(val);
                solutionName = value.data('solution-name');
            });
        }

        activeSolution.next().find('a.solution-widget-download-file').each(function(index){
            var trackingData = {
                    solwidname: solutionName || partNumber
                };

            if (isInpageVersion) {
                trackingData.component = pageType + ":Solution In-page Window";
            } else {
                trackingData.component = pageType + ":Solution Modal Window";
            }
            trackingData.event = [];
            trackingData.event[10] = {};
            trackingData.event[10].eventInfo = {
                eventName: $(this).attr('href'),
                location: digitalData.page.pageInfo.pageName,
                eventAction: 'download',
                type: uniqueString,
                eventPoints: '1'
            };
            if (pageType == 'productFolder') {
                if (digitalData.product && digitalData.product.length && digitalData.product[0].productInfo && digitalData.product[0].productInfo.tree) {
                    trackingData.product = [{
                        productInfo: {
                            tree: {
                                level6: level6
                            },
                            productID: productId
                        }
                    }]
                }
            } else {
                if (digitalData.application && digitalData.application.length && digitalData.application[0].applicationInfo  && digitalData.application[0].applicationInfo.level3) {
                    trackingData.application = [{
                        applicationInfo: {
                            level3: digitalData.application[0].applicationInfo.level3
                        }
                    }]
                }
            }

            $(this).attr('data-tracking', JSON.stringify({ digitalData: trackingData}));
        });
    };
    /* 3.2.5 Download a file in the window quickview  end */

      /* 3.2.6 Click on “buy direct”  start */
      $('#genericModalTrim, .solutions-widget-container').on('click', '.solution-widget-table a[data-sample-buy-btn="buy"].buy-direct', function(e){
        var targetTr = $(e.target).closest('[data-product-id]'),
            partNumber = targetTr.find('a.show-content').data('part-number'),
            productId = targetTr.data('product-id'),
            level6 = targetTr.data('product-level6'),
            trackingData = {
              solwidname: partNumber,
              event: digitalData.event || []
            };

            trackingData.event[65] = {
              eventInfo: {
                ProductFolder: {
                  eventName: 'Buy Direct'
                }
              }
            };

            trackingData.event[13] = {
              eventInfo: {
                eventName: 'Buy Direct',
                type: uniqueString
              }
            };

        if (pageType == 'productFolder') {
          digitalData.product[0].productInfo.productID = productId;
          digitalData.product[0].productInfo.tree.level6 = level6;
        }

        if(isInpageVersion){
          trackingData.component = pageType + ":Solution In-page Window";
        } else {
          trackingData.component = pageType + ":Solution Modal Window";
        }

        $.extend(digitalData, trackingData);
        satelliteTrack('DCbuyd');
      });
      /* 3.2.6 Click on “buy direct” end */

      /* 3.2.7 Click on “Get Software” start */
      $('#genericModalTrim, .solutions-widget-container').on('click', '.solution-widget-table a[data-sample-buy-btn="buy"].get-software', function(e){
        var targetTr = $(e.target).closest('[data-product-id]'),
            partNumber = targetTr.find('a.show-content').data('part-number'),
            eventName = $(this).data('funnel-name'),
            productId = targetTr.data('product-id'),
            level6 = targetTr.data('product-level6'),
            trackingData = {
              solwidname: partNumber,
              event: digitalData.event || []
            };

        trackingData.event[97] = {
          eventInfo: {
            eventName: $.trim($(this).text())
          }
        };

        trackingData.event[13] = {
          eventInfo: {
            eventName: eventName,
            type: uniqueString
          }
        };

        if (pageType == 'productFolder') {
          digitalData.product[0].productInfo.productID = productId;
          digitalData.product[0].productInfo.tree.level6 = level6;
        }

        if(isInpageVersion){
          trackingData.component = pageType + ":Solution In-page Window";
        } else {
          trackingData.component = pageType + ":Solution Modal Window";
        }

        $.extend(digitalData, trackingData);
        satelliteTrack('DCDLSoft');
      });
      /* 3.2.7 Click on “Get Software” end */

      /* 3.2.8 Click on “order”  start */
      $('#genericModalTrim, .solutions-widget-container').on('click', '.solution-widget-table .distributors-popup table.table a:contains("ORDER")', function(e){
        var partNumber = $.trim($(e.target).closest('.distributor-expand-content').prev().find('a.show-content').text()),
            distributor = $.trim($(this).closest('tr').find('td:first').text()),
            distributorContent = $(e.target).closest('tr.distributor-expand-content'),
            targetTr = distributorContent.prev(),
            productId = targetTr.data('product-id'),
            level6 = targetTr.data('product-level6'),
            trackingData = {
              solwidname: partNumber,
              event: digitalData.event || []
            };


        trackingData.event[30] = {
          eventInfo: {
            ProductFolder: {
              eventName: 'OrderNow'
            }
          }
        };

        if (pageType == 'productFolder') {
            digitalData.product[0].productInfo.productID = productId;
            digitalData.product[0].productInfo.tree.level6 = level6;
            digitalData.product[0].productInfo.distributor = distributor;
        }

        if(isInpageVersion){
          trackingData.component = pageType + ':Solution In-page Window';
        } else {
          trackingData.component = pageType + ':Solution Modal Window';
        }

        $.extend(digitalData, trackingData);
        satelliteTrack('DCorder');
      });
      /* 3.2.8 Click on “order”  end */

  $(document).on('click', '.solution-widget-table a.show-content', function(e, initLoad){

    var $this = $(this),
      solutionWidgetTable = $this.closest('.solution-widget-table'),
      closestTr = $this.closest('[data-product-id]'),
      productId = closestTr.data('product-id'),
      level6 = closestTr.data('product-level6');

      $expandContent = closestTr.next().next('.expand-content');

    $this.closest('tr').toggleClass('active');

    e.preventDefault();

    if ($expandContent.is(":visible")){
      $expandContent.hide();
    }
    else {
      if(!initLoad){
          solutionWidgetTable.find('tr.expand-content:visible').hide();
          solutionWidgetTable.find('tr').not(closestTr).removeClass('active');
      }
      $expandContent.show();
      setAttrsOnDownloadItems(productId, level6, closestTr);
    }

    if (pageType == 'Application') {
        var targetLink = $(this).closest('.js-st-accordion-expanded').find('.see-more-loader');
		    var partNumber = $(this).data('part-number');

        var linkId = targetLink.attr('id') || '',
            linkText = targetLink.data('solution-name'),
            linkIndex = targetLink.closest('.js-st-accordion-menu').index();

        var position = isInpageVersion ? linkIndex/2 + 1 : linkIndex + 1; //starts from 1

        trackingData = {
            clicked: position + ':' + linkId + ':' + linkText,
            solwidname: linkText,
            component: 'Application:solution widget'
        };

		if (pageType === 'Application' && digitalData.product && digitalData.product.length && digitalData.product[0].productInfo && digitalData.product[0].productInfo.tree) {
            digitalData.product[0].productInfo.tree.level6 = partNumber;
        }

        $.extend(digitalData, trackingData);
        _satellite.track('DCbtnclick');
    }

    if($('#genericModalTrim').is(":visible")){
        $('#genericModalTrim').modal('handleUpdate');
    }
  });

  $(document).on('click', '.solution-widget-table a.enlarge-image', function(e){
    var $this = $(this),
      $thisContainer = $this.closest('.image-container'),
      $thisImg = $this.find('img');
      cssAniDelay = 300;
    if ($thisContainer.hasClass('active')) {
      $thisImg.attr('title', $thisImg.data('title'));
      $thisContainer.removeClass('active');
      setTimeout(function(){
        $thisContainer.next('.files-container').removeClass('active').next('.key-features-container').toggleClass('medium-5 medium-9');
      }, cssAniDelay);
    }
    else {
      $thisImg.data('title',$thisImg.attr('title')).attr('title', $thisImg.attr('data-alt-title'));
      $thisContainer.addClass('active').next('.files-container').addClass('active').next('.key-features-container').toggleClass('medium-5 medium-9');
    }

    setTimeout(function(){
      if($('#genericModalTrim').is(":visible")){
        $('#genericModalTrim').modal('handleUpdate'); //Update backdrop on modal show
      }
    }, cssAniDelay);

  });

  //hide data limited items
  if ($('.solutions-widget-container [data-limit-initial-items], .lateral-widget [data-limit-initial-items]').length){
      var hideEls = function($els, $thisVal){
      //hide elegible items
      $els.each(function(index){
        if ((index+1) > $thisVal){
          $(this).addClass('hidden');
          var seeLessButton = $(this).find('.see-more-loader.active');
          if (seeLessButton.length > 0) {
              seeLessButton.trigger('click');
          }
        }
      });
    }

    $('.solutions-widget-container:not(.tab-type) [data-limit-initial-items], .lateral-widget [data-limit-initial-items]').each(function(){
      var $this = $(this),
        $thisVal = $this.attr('data-limit-initial-items'),
        $els = $this.find('.hide-eligible-item');

      hideEls($els, $thisVal);

      //elements
      $this.on('click','.toggle-eligible-items',function(e){
        var $this = $(this);
        e.preventDefault();
        if (!$this.hasClass('active')) {
          $this.addClass('active');
          $els.removeClass('hidden');
        }
        else {
          $this.removeClass('active');
          hideEls($els, $thisVal);
          $('html, body').animate({
            scrollTop: $this.closest('[data-limit-initial-items]').offset().top
          }, 500);
        }
      })

    });

      var handleSeeMoreLoaderClick = function(clickTarget, initLoad) {
      var targetElement = clickTarget.closest('.float-block-container').next().find(clickTarget.attr('data-target')) ||
          clickTarget.closest('.row').next().find(clickTarget.attr('data-target')),
        isConstantText = clickTarget.hasClass('constant-text'),
        row = clickTarget.closest('.float-block-container') || clickTarget.closest('.row'),
        solutionsWidgetContainer =clickTarget.closest('.solutions-widget-container'),
        contentUrl = clickTarget.attr('data-content');

      //close expanded
      if(!initLoad){
        solutionsWidgetContainer.find('.see-more-loader.active').not(clickTarget).removeClass('active');
        solutionsWidgetContainer.find('.row.active').not(row).removeClass('active');
        solutionsWidgetContainer.find('.float-block-container.active').not(row).removeClass('active');
        solutionsWidgetContainer.find('.see-more-content.filled').not($(targetElement)).hide().removeClass('filled');
      }

      if(!clickTarget.hasClass('active')) {
        clickTarget.addClass('active');
        row.addClass('active');

        if (!initLoad) {
          $(document).scrollTop(clickTarget.closest('.hide-eligible-item').offset().top - $('.sticky').height());
        }

        if($(targetElement).length && $(targetElement).hasClass('filled')) {
          $(targetElement).show();
          if(!isConstantText){
            clickTarget.text('See less');
          }
        } else {
          $.ajax(contentUrl, {
            success: function (response) {
              $(targetElement).html(response).addClass('filled').show();
              highlightStickyTab();
              if(!isConstantText){
                clickTarget.text('See less');
              }
            }
          });
        }
      } else {
        clickTarget.removeClass('active');
        row.removeClass('active');
        $(targetElement).hide();

        if(!isConstantText){
            clickTarget.text('See more');
        }
      }
    }

    $('.solutions-widget-container .see-more-loader, .lateral-widget .see-more-loader').on('click', function (e, initLoad) {
      e.preventDefault();
      handleSeeMoreLoaderClick($(this), initLoad);
    });

	var queryString = getQueryParams(document.location.search);
    if(queryString && queryString.solution){
        var seeAll = $('.solutions-widget-container .toggle-eligible-items, .lateral-widget .toggle-eligible-items');
        if(seeAll && seeAll.length){
            seeAll.trigger('click');
        }

        $(document).ready(function() {
            setTimeout(function(){
                loadSolutionByName(queryString.solution);
            }, 500);
        });
    } else {
        //open first element on load tab type
        $('.solutions-widget-container.tab-type').each(function(){
            var targetAnchor = $(this).find('.float-block-container:first a.see-more-loader') ||
                $(this).find('.row:first a.see-more-loader');
            var content = targetAnchor[0] && targetAnchor[0].dataset && targetAnchor[0].dataset.content || '';
            if(~content.indexOf("hwEval-product-description")){
                return true;
            }
            handleSeeMoreLoaderClick(targetAnchor, true);
        });
    }

    $('.solutions-widget-container .float-block-container .solution-row-status a').on('click', function(e){
        e.preventDefault();
        $(this).closest('.float-block-container').find('.see-more-loader').trigger('click');
    });

    $('.solutions-widget-container .row .solution-row-status a').on('click', function(e){
      e.preventDefault();
      $(this).closest('.row').find('.see-more-loader').trigger('click');
    });

    $('.solutions-widget-container .solution-widget-table tr .solution-row-status a').on('click', function(e){
      e.preventDefault();
      $(this).closest('tr').find('.show-content').trigger('click');
    });

    //open first element on load tab-type-parts-list
    $('.solutions-widget-container.tab-type-parts-list').each(function(){
      $(this).find('table tbody tr:first td a.show-content').trigger('click', true);
    });

    $('#genericModalTrim').on('hide.bs.modal', function(event){
      /* 3.2.9 The modal window is closed  start */
      if($(event.target).find('.solution-widget-table-wrapper').length){
          if (!digitalData.component) {
              window.digitalData.component = pageType;
          }
      }
      /* 3.2.9 The modal window is closed  end */
    });

  }

})(jQuery);

$(function () {
    $(document).on('click', ".solutionsoftwares-softwaresbutton", function (e) {
        e.preventDefault();

        var currentSolutionGsContent = $(this).closest(".solution-gscontent");
        var softwaresButtonIcons = currentSolutionGsContent.find(".solutionsoftwares-softwaresbuttonicon i");
        softwaresButtonIcons.toggle();

        var softwaresSubPanelContent = getSoftwaresSubPanelContent(currentSolutionGsContent);
        expandCollapseSoftwaresSubPanel(softwaresSubPanelContent);
    });

    function expandCollapseSoftwaresSubPanel (softwaresSubPanelContent) {
        if (softwaresSubPanelContent.hasClass("collapse-softwaresubpanel")) {
            softwaresSubPanelContent.removeClass("collapse-softwaresubpanel");
            softwaresSubPanelContent.css("max-height", softwaresSubPanelContent[0].scrollHeight);
            var modalForm = $('#genericModalTrim');
            if(modalForm[0].offsetHeight && modalForm[0].offsetWidth) {
                setTimeout(function(){modalForm.modal('handleUpdate')}, 500);
            }
        } else {
            softwaresSubPanelContent.addClass("collapse-softwaresubpanel");
            softwaresSubPanelContent.css("max-height", "0");
        }
    }

    var addBackground = setInterval(function(){
        var rows = $('.solution-widget-table > tbody > tr');
        if(rows.length) {
            var rowsVisible = [];

            rows.each(function(){
                if($(this).data('productId')) {
                    rowsVisible.push(this);
                }
            });

            for (var i in rowsVisible) {
                if(i%2 !== 0) $(rowsVisible[i]).css('background', '#f9f9f9');
                else $(rowsVisible[i]).css('background', '#fff');
            }

            clearInterval(addBackground);
        }
    }, 500);

    function getSoftwaresSubPanelContent(currentSolutionGsContent) {
        return currentSolutionGsContent.parent()
            .next(".solution-gscontent.solutionsoftwares-subpanelrow")
            .find(".solutionsoftwares-softwaresubpanelcontent");
    }
});

(function ($) {
    function initTooltipPopup(toggler) {
        var $toggler = $(toggler);

        $('[data-tooltip-popup]').not($toggler).each(function () {
            if ($(this).data('tooltip-popup')) {
                $(this).data('tooltip-popup').hide();
            }
        });

        $toggler.tooltipPopup({
            additionalClass: 'solution-evaluation-kit-popup',
            toggler: $toggler,
            source: $('#' + $toggler.data('tooltip-popup-source'))
        });
        $toggler.tooltipPopup('show');
    }

    $(function () {
        var $form = $('.solution-evaluation-kit-form');
        var $button = $('#solution-evaluation-kit-buy-button', $form);
        var $buttonWrapper = $button.closest('.solution-evaluation-kit-buy-button-wrapper');
        var $cpns = $('input[type="checkbox"][data-cpn]', $form);
        var $opts = $('input[type="checkbox"][data-opt]', $form);
        var $checkboxes = $().add($cpns).add($opts);
        var $distributorsTables = $('.js-solution-evaluation-kit-distributors');
        var $distributorsTableToggler = $('.js-distributors-toggler', $form);

        $(document).on('mouseenter', '[data-tooltip-popup]', function (event) {
            initTooltipPopup(this);
        });
        $(document).on('touchstart click', '[data-tooltip-popup]', function (event) {
            event.preventDefault();
            initTooltipPopup(this);
        });

        function getCPNs() {
            return Array.prototype.concat.apply([], $cpns.filter(':checked').map(function () {
                var cpn = $(this).data('component-id');
                var quantity = $(this).data('quantity') || 1;

                return +quantity > 1 ? Array(quantity).fill('').map(function () { return cpn; }).join(',') : cpn;
            }));
        }

        function getSingleCheckedCPN() {
            var $checked = getSingleCheckedComponent();

            if ($checked !== false && $checked.is('[data-cpn]')) {
                return $checked;
            }

            return false;
        }

        function getSingleCheckedComponent() {
            var $checked = $checkboxes.filter(':checked');

            if ($checked.length === 1) {
                return $checked.first();
            }

            return false;
        }

        function getCorrespondingDistributorTable() {
            var $checkbox = getSingleCheckedComponent();

            if ($checkbox !== false) {
                var $table = $distributorsTables.filter('[data-component-id="' + $checkbox.data('component-id') + '"]');

                if ($table.length > 0) {
                    return $table;
                }
            }

            return false;
        }

        function updateDistributorToggler() {
            var $table = getCorrespondingDistributorTable();
            var $check = getSingleCheckedComponent();
            var isVisible = $table !== false && $check !== false && ($cpns.length === 0 || ($check.is('[data-cpn]') && $table.data('quantity')));

            if (isVisible)
            {
                $distributorsTableToggler.find('.quantity-label').text($table.data('quantity') + ' distributors');
                $distributorsTableToggler.toggleClass('hidden', false);
            } else {
                $distributorsTableToggler.toggleClass('hidden', true);
            }
        }

        function setInitialCPNDeSelection() {
            var $cpn = getSingleCheckedCPN();

            if ($cpn !== false) {
                $cpn.prop('disabled', true);
            }
        }

        function getCPNPrices() {
            return Array.prototype.concat.apply([], $cpns.filter(':checked')).reduce(function (accumulator, element) {

                var $element = $(element);
                var quantity = $element.data('quantity') || 1;

                return +accumulator + ($element.data('cost') * quantity);
            }, []);
        }

        function getOPTs() {
            return Array.prototype.concat.apply([], $opts.filter(':checked')).reduce(function (accumulator, element) {
                var $element = $(element);

                accumulator.push([$element.data('component-id'), $element.data('cost')]);

                return accumulator;
            }, []);
        }

        setInitialCPNDeSelection();
        updateDistributorToggler();


        if ($checkboxes.filter(':checked').length === 0 || $cpns.filter('[data-is-out-of-stock]:checked').length > 0) {
            $button.prop('disabled', 'disabled');
        }

        $(document).on('change', $cpns.selector + ', ' + $opts.selector, function () {
            var outOfStockError = $form.data('error-out-of-stock');
            var $cost = $form.find('#solution-evaluation-kit-cost .cost-value');
            var $checkedCpns = $cpns.filter(':checked');
            var $checkedOpts = $opts.filter(':checked');
            var $checked = $().add($checkedCpns).add($checkedOpts);
            var $allCheckedOutOfStock = $checked.filter('[data-is-out-of-stock]');
            var selectedOpts = getOPTs();
            var CPNTotalPrice = getCPNPrices();

            if (selectedOpts.length > 0) {
                $cost.html('$' + selectedOpts.reduce(function (accumulator, opt) {
                    return Math.round(accumulator + +opt[1]);
                }, CPNTotalPrice));
            } else {
                $cost.html('$'+ Math.round(CPNTotalPrice));
            }

            $('[data-opt]:not([disabled]) + label .out-of-stock-error', $form).remove();

            if ($allCheckedOutOfStock.length > 0) {
                $allCheckedOutOfStock.each(function () {
                   $(this).closest('tr').find('td:last-child')
                       .html('')
                       .append($('<span>')
                           .addClass('out-of-stock-error')
                           .text(' ' + outOfStockError));
                });
                $button.prop('disabled', 'disabled');
            } else if (($cpns.length > 0 && $checkedCpns.length === 0) || $checked.length === 0) {
                $button.prop('disabled', 'disabled');
            } else if (!$form.is('[data-is-out-of-stock]') &&
                (($cpns.length > 0 && $checkedCpns.length > 0) || $checkedOpts.length > 0))
            {
                $button.prop('disabled', null);
            }

            updateDistributorToggler();

            if ($checkedCpns.length > 1 || ($cpns.length === 0 && $checkedOpts.length > 1) || $checked.length === 0 ||
                $checked.length > 1)
            {
                $buttonWrapper.toggleClass('hidden', false);
                $distributorsTables.toggleClass('hidden', true);
            }

            // disable CPN checkboxes if 1, enable if not one
            $checkedCpns.prop('disabled', $checkedCpns.length === 1);
        });

        $(document).on('click', '#solution-evaluation-kit-buy-button', function () {
            var cpns = getCPNs();
            var opts = getOPTs();

            if ($form.data('redirect-to')) {
                var target = $form.data('redirect-to');

                window.open(target, '_blank');
            } else {
                var productsList = cpns.concat(opts.filter(function (opt) { return opt[0]; }).map(function (opt) { return opt[0]; }));
                var productsCart = {};

                // create productsCart with products and their quantity
                productsList.map(function (item) {
                    productsCart[item] ? productsCart[item] +=1 : productsCart[item] = 1;
                });

                //create inputs for unique products
                Object.keys(productsCart).forEach(function (productName) {
                    $form.append('<input type="hidden" name="products[' + productName + ']" value="'+ productsCart[productName] +'" />');
                })

                $form.submit();
            }
        });

        $(document).on('click', $distributorsTableToggler.selector + ', ' + $distributorsTables.selector + ' .st-table__close-button', function (event) {
           event.preventDefault();

           var $checkbox = getSingleCheckedComponent();

           if ($checkbox === false && $checkboxes.length === 1) {
               $checkbox = $checkboxes.first();
           }

           if ($checkbox !== false) {
               var table = $distributorsTables.filter('[data-component-id="' + $checkbox.data('component-id') + '"]')[0];
               var $table = $(table);
               var state = $table.hasClass('hidden');

               $distributorsTableToggler.toggleClass('expanded', state);
               $table.toggleClass('hidden', !state);
               $buttonWrapper.toggleClass('hidden', state);

               if (state) {
                   initAllDataTables($table[0]);
               }
           }
        });
    });
})(jQuery);
$(document).on('click', '#gatedContentDownloadButton', function(e) {
  e.preventDefault();
  $(e.target).hide();
  $('.s-gated-video').removeClass('hidden');
});
/* applications.js */
var STFED = STFED || {};

STFED.mobile = {
    check: function() {
        return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    }
};
(function($) {
    if ($('.application-page').length > 0) {
        var locale = $('meta[name=Content-Language]').attr("content") || "en";
        var digitalData = window.digitalData || {};

        digitalData.site = 'stcom';

        if (document.referrer != '') {
            digitalData.page.pageInfo.referringURL = document.referrer;
        }

        digitalData.page = digitalData.page || {};
        digitalData.page.attributes = digitalData.page.attributes || {};
        digitalData.page.attributes.language = STUtils.getLanguage(locale);
        digitalData.page.category = digitalData.page.category || {};
        digitalData.page.category.type = 'application';
        digitalData.page.category.primaryCategory = digitalData.page.category.primaryCategory || 'application';

        digitalData.event = digitalData.event || [];
        digitalData.application = digitalData.application || {};
        digitalData.application[0] = digitalData.application[0] || {};
        digitalData.application[0].applicationInfo = digitalData.application[0].applicationInfo || {};
        digitalData.application[0].applicationInfo.level0 = digitalData.application[0].applicationInfo.level0 || "";
        digitalData.application[0].applicationInfo.level1 = digitalData.application[0].applicationInfo.level1 || "";
        digitalData.application[0].applicationInfo.level2 = digitalData.application[0].applicationInfo.level2 || "";
        digitalData.application[0].applicationInfo.level3 = digitalData.application[0].applicationInfo.level3 || "";
        digitalData.application[0].applicationInfo.level4 = digitalData.application[0].applicationInfo.level4 || "";
    }

    var allProductBlock = $(".product-block-wrapper");

    for(var i = 0; i < allProductBlock.length; i++){

        var productTitle = allProductBlock[i].querySelectorAll('.product-block-title a')[0];
        var tooltipText = productTitle.innerText;

        $(productTitle).dotdotdot({
            ellipsis: "\u2026 ",
            truncate: "word"
        });

        $(productTitle).attr("style", "visibility: visible");

        if(~productTitle.innerHTML.indexOf("\u2026")){
            $(productTitle).attr('data-tooltip','true');
            $(productTitle).attr('title', tooltipText);
        }

        var productDescr = allProductBlock[i].querySelectorAll('.product-block-description')[0];
        var productDescrLink = allProductBlock[i].querySelectorAll('.product-block-link')[0];

        $(productDescr).dotdotdot({
            ellipsis: "\u2026 ",
            truncate: "word"
        });

        $(productDescr).attr("style", "visibility: visible");

        if(~productDescr.innerHTML.indexOf("\u2026")){
            $(productDescrLink).attr("style", "visibility: visible");
        } else {
            $(productDescrLink).attr("style", "visibility : hidden");
        }
    }

    var tooltip = $('.accept-terms-data span.read-more-tooltip');
    var topOffset = 0;
    var bottomOffset = 10;
    var heightToBottom = 0;
    var tooltipWidth = 0;
    var tooltipHeight = 0;
    var isMobile = STFED.mobile.check();
    var windowHeight = $(window).height();
    var termsBlock;
    var tooltipLeftOffset = 0;
    var tooltipMargin = 10;

    $('.accept-terms-data img, .st-read-more-label-wrap').hover(
        function(event){
            var modalDialog = $(this).closest('.modal-dialog')[0];
            tooltip = tooltip || $('.accept-terms-data span.read-more-tooltip');
            termsBlock = $(tooltip).closest('.accept-terms-data');

            if((tooltip.length > 1) || (modalDialog && (!topOffset || isMobile))) {
                if(modalDialog) {
                    var styleModal = window.getComputedStyle ? window.getComputedStyle(modalDialog.parentElement) : modalDialog.parentElement.currentStyle;

                    if(styleModal.display === 'block') {
                        var modalContent = $(modalDialog).find('.modal-content')[0];
                        var styleModalDialog = window.getComputedStyle ? window.getComputedStyle(modalDialog) : modalDialog.currentStyle;
                        var modalHeight = $(modalContent).outerHeight();

                        topOffset = parseInt(styleModalDialog.getPropertyValue('margin-top'));
                        tooltip = $(modalDialog).find('span.read-more-tooltip');

                        var modalWidth = $(modalContent).width();
                        var styleModalContent = window.getComputedStyle ? window.getComputedStyle(modalContent) : modalContent.currentStyle;
                        var paddingRightModalContent = parseInt(styleModalContent.getPropertyValue('padding-right'));

                        tooltipWidth = modalWidth + paddingRightModalContent - tooltipMargin;
                        tooltip.css("width", tooltipWidth);
                        tooltipHeight = tooltip.height();

                        if(isMobile){
                            heightToBottom = -1;
                            var modalDialogScrollTop = $(modalDialog).parent().scrollTop();
                            if(windowHeight < modalHeight + topOffset && modalDialogScrollTop + windowHeight < modalHeight + topOffset) {
                                bottomOffset = modalHeight + topOffset + tooltipMargin - modalDialogScrollTop - windowHeight;
                            } else {
                                bottomOffset = tooltipMargin;
                            }
                        } else {
                            heightToBottom = topOffset + modalHeight - event.clientY - tooltipHeight - tooltipMargin;
                        }
                    }
                } else {
                    termsBlock = $(this).closest('.accept-terms-data');
                    tooltipLeftOffset = termsBlock.offset().left + 'px';
                    tooltip = $(termsBlock.find('span.read-more-tooltip')[0]);
                }
            }

            if(!modalDialog) {
                tooltipWidth = termsBlock.width();
                tooltip.css("width", tooltipWidth);
                tooltipHeight = tooltip.height();
                heightToBottom = $(window).height() - event.clientY - tooltipHeight - tooltipMargin;
            } else {
                tooltip.css("width", tooltipWidth);
            }

            if(windowHeight < tooltipHeight + 2 * tooltipMargin) {
                tooltip.css("height", windowHeight - 2 * tooltipMargin);
                tooltip.css("overflow", "scroll");
            }

            heightToBottom >= 0 ? tooltip.css("top", event.clientY - topOffset) : tooltip.css("bottom", bottomOffset);
            tooltip.css("display", "block");
        },
        function(){
            tooltip.attr("style", "display: none");
        }
    );

    tooltip.hover(
        function(event){
            tooltip.css("display", "block");
            tooltip.css("width", tooltipWidth);
            tooltipHeight = tooltip.height();

            if(windowHeight < tooltipHeight + 2 * tooltipMargin) {
                tooltip.css("height", windowHeight - 2 * tooltipMargin);
                tooltip.css("overflow", "scroll");
            }

            tooltip.scrollTop(0);
            heightToBottom >= 0 ? tooltip.css("top", event.clientY - topOffset) : tooltip.css("bottom", bottomOffset);
        },
        function(){
            tooltip.css("display", "none");
        }
    );

    $(window).scroll(function() {
        tooltip.attr("style", "display: none");
    });
})(jQuery);

(function($) {
    $(".ap-relatesmodal-shower").click(function(){
        var relatesModal = $(this).closest(".ap-container").find(".ap-relatesmodal");
        relatesModal.fadeToggle(500);
    });
    $('.image-map-container').hover(function(){
        if($(".image-map-container area[coords='0,0,0,0']").length === $(".image-map-container area").length) {
            STFED.resImageMap.init();	
        }
    });    
})(jQuery);

(function ($) {
    function init() {
        if (!STFED.Marketo.trackingConfig.legacyApplication) {
            return;
        }
        //
        // CASE 1: Tracks downloads on application page
        //
        $('body').on('click', 'a[href]', function () {
            if (/\.(pdf|zip|jp?g|gif|doc?|xls?|ppt?)$/i.test(this.href) &&
                typeof window.digitalData !== 'undefined' && window.digitalData.component === 'Application') {
                if (typeof Munchkin !== 'undefined') {
                    var formattedDate = STFED.DateUtils.getDateString();
                    var $title = $(this).find('.title-description');
                    var title = $title.length > 0 ? $title.text().trim() : this.href;

                    // Munchkin.munchkinFunction('visitWebPage', {
                    //         'url': formattedDate + ' | ' + document.title + ' | Download | ' + title + ' | ',
                    //         'params': 'Application Successful Visit'
                    //     }
                    // );
                }
            }
        });
        //
        // CASE 2: Tracks product view after visiting application page
        //
        var applicationPageName = window.localStorage.getItem('applicationPageName');

        if (applicationPageName && document.referrer.indexOf('/applications/') > -1 &&
            typeof window.digitalData !== 'undefined' && window.digitalData.component.toLowerCase().indexOf('product') > -1) {
            if (typeof Munchkin !== 'undefined') {
                var formattedDate = STFED.DateUtils.getDateString();
                var title = typeof window.digitalData.product !== 'undefined' ? window.digitalData.product[0].productInfo.productName : location.href;

                // Munchkin.munchkinFunction('visitWebPage', {
                //         'url': formattedDate + ' | ' + applicationPageName + ' | Product view | ' + title + ' | ',
                //         'params': 'Application Successful Visit'
                //     }
                // );
            }
        }

        if (typeof window.digitalData !== 'undefined' && window.digitalData.component === 'Application') {
            window.localStorage.setItem('applicationPageName', document.title);
        } else {
            window.localStorage.removeItem('applicationPageName');
        }
        //
        // CASE 3: Tracks video view on application page
        //
        document.addEventListener('video-was-viewed', function (event) {
            if (typeof window.digitalData !== 'undefined' && window.digitalData.component === 'Application') {
                if (typeof Munchkin !== 'undefined') {
                    var formattedDate = STFED.DateUtils.getDateString();

                    // Munchkin.munchkinFunction('visitWebPage', {
                    //         'url': formattedDate + ' | ' + document.title + ' | Video view | ' + digitalData.media.name + ' | ',
                    //         'params': 'Application Successful Visit'
                    //     }
                    // );
                }
            }
        });
    }

    if (document.documentElement.dataset.isMktoTrackingConfigLoaded) {
        init();
    } else {
        document.documentElement.addEventListener('mktoTrackingConfigLoaded', () => {
            init();
        });
    }
})(jQuery);

(function ($) {
    $(function () {
        var $solutionTitle = $(this).find('.st-stage-product__header .st-h2');
        var solutionTitle = $solutionTitle.length > 0 ? $solutionTitle.text().trim() : document.title;
        var primaryCategory = _.get(window.digitalData, 'page.category.primaryCategory', '').toLowerCase();

        function init() {
            if (!STFED.Marketo.trackingConfig.legacySolutions) {
                return;
            }

            $('body').on('click', '.st-edesign-v2 button.st-edesign-v2-tool-nav', function () {
                window.parent.postMessage('eds-start-clicked');

                if (typeof _satellite !== 'undefined') {
                    _satellite.track('edesign_button-click');
                }
            });




            function receiveMessage(event) {
                if (event.data === 'eds-start-clicked' && typeof Munchkin !== 'undefined') {
                    var formattedDate = STFED.DateUtils.getDateString();

                    // Munchkin.munchkinFunction('visitWebPage', {
                    //         'url': formattedDate + ' | ' + solutionTitle + ' | eDesign | Start Design | ',
                    //         'params': 'Solution Successful Visit'
                    //     }
                    // );
                }
            }

            window.addEventListener('message', receiveMessage, false);

            if ((typeof window.digitalData !== 'undefined' && (window.digitalData.component.toLowerCase() === 'solution'
                    || primaryCategory.indexOf(':solution') > -1))
                || document.location.href.indexOf('/solution') > -1) {
                var productId = window.digitalData.product[0].productInfo.productID;

                //
                // CASE 1: Tracks downloads on solutions page
                //
                $('body').on('click', 'a[href]', function () {
                    if (/\.(pdf|zip|jp?g|gif|doc?|xls?|ppt?)$/i.test(this.href)) {
                        if (typeof Munchkin !== 'undefined') {
                            var formattedDate = STFED.DateUtils.getDateString();
                            var $title = $(this).find('.title-description');
                            var title = $title.length > 0 ? $title.text().trim() : this.href;

                            // Munchkin.munchkinFunction('visitWebPage', {
                            //         'url': formattedDate + ' | ' + solutionTitle + ' | Download | ' + title + ' | ',
                            //         'params': 'Solution Successful Visit'
                            //     }
                            // );
                        }
                    }
                });
                //
                // CASE 2: Tracks eStore view after visiting solution page
                //
                $('body').on('click', 'a[href*="estore."]', function () {
                    if (typeof Munchkin !== 'undefined') {
                        var formattedDate = STFED.DateUtils.getDateString();

                        // Munchkin.munchkinFunction('visitWebPage', {
                        //         'url': formattedDate + ' | ' + solutionTitle + ' | eStore | ' + productId + ' | ',
                        //         'params': 'Solution Successful Visit'
                        //     }
                        // );
                    }
                });
                //
                // CASE 2.1: Tracks form submits
                //
                $('body').on('submit', 'form[action*="estore."]', function () {
                    if (typeof Munchkin !== 'undefined') {
                        var formattedDate = STFED.DateUtils.getDateString();

                        // Munchkin.munchkinFunction('visitWebPage', {
                        //         'url': formattedDate + ' | ' + solutionTitle + ' | eStore | ' + productId + ' | ',
                        //         'params': 'Solution Successful Visit'
                        //     }
                        // );
                    }
                });
                //
                // CASE 3: Clicking order from distributor button on solution page
                //
                $('body').on('click', '.st-table--distributor a[href]', function () {
                    if (typeof Munchkin !== 'undefined') {
                        var formattedDate = STFED.DateUtils.getDateString();

                        // Munchkin.munchkinFunction('visitWebPage', {
                        //         'url': formattedDate + ' | ' + solutionTitle + ' | Distributor Order | ' + $(this).closest('tr').find('td:first').text() + ' | ',
                        //         'params': 'Solution Successful Visit'
                        //     }
                        // );
                    }
                });
                //
                // CASE 4: Clicking "Start Design" on solution page within iframe
                //
                $('body').on('click', '.st-edesign-v2 button.st-edesign-v2-tool-nav', function () {
                    if (typeof Munchkin !== 'undefined') {
                        var formattedDate = STFED.DateUtils.getDateString();

                        // Munchkin.munchkinFunction('visitWebPage', {
                        //         'url': formattedDate + ' | ' + solutionTitle + ' | eDesign | Start Design | ',
                        //         'params': 'Solution Successful Visit'
                        //     }
                        // );
                    }
                });
            }
        }

        if (document.documentElement.dataset.isMktoTrackingConfigLoaded) {
            init();
        } else {
            document.documentElement.addEventListener('mktoTrackingConfigLoaded', () => {
                init();
            });
        }
    });
})(jQuery);

(function ($, ns) {
    ns.injectMarketoFields = function () {
        function injectAkamaiCountryField(formApi) {
            var akamaiCookie = /ak_es_cc=([a-z]+);/i.exec(document.cookie);

            if (akamaiCookie && akamaiCookie[1]) {
                formApi.addHiddenFields({
                    'akamaiCountryCode': akamaiCookie[1]
                });
            }
        }

        if (typeof MktoForms2 !== 'undefined') {
            MktoForms2.whenReady(function (formApi) {
                injectAkamaiCountryField(formApi);
            });
        }
    };

    $(function () {
        ns.injectMarketoFields();
    });
})(jQuery, typeof window.STFED !== undefined ? window.STFED : window.STFED = {});

(function ($) {
    $(window).load(function () {
        if (typeof STFED !== 'undefined' && STFED.cookieFactory) {
            var label = 'Marketo lead association';
            var uniqueIdCookie = STFED.cookieFactory.get('uniqueID');
            var munchkinCookie = STFED.cookieFactory.get('_mkto_trk');
            var wasAssociated = sessionStorage.getItem('marketoLeadWasAssociated');
            var csrfToken = STUtils.getCsrfToken();
            var apiPath = '/bin/st/mkto-user-data';

            var _makeUrl = function(params, url, newBaseUrl) {
                var url = typeof newBaseUrl !== 'undefined' ? new URL(url, newBaseUrl) : new URL(url);

                for (var key in params) {
                    url.searchParams.set(key, params[key]);
                }

                return url.toString();
            }

            var makeUrl = function(params) {
                return _makeUrl(params, location.href);
            }

            var makeAEMApiUrl = function(endpoint, params) {
                return _makeUrl(params, apiPath.replace(/\/*$/, '/' + endpoint), location.href);
            }

            if (wasAssociated) {
                if (!uniqueIdCookie) {
                    sessionStorage.removeItem('marketoLeadWasAssociated');
                }

                return false;
            }

            if (!munchkinCookie) {
                console.error(label + ': munchkin cookie has not been initialized.');
                return;
            }

            if (uniqueIdCookie && csrfToken) {
                var maxTries = 5;
                var timeoutInterval = 5000;
                var tried = 0;

                setTimeout(function onTick() {
                    $.ajax({
                        url: makeAEMApiUrl('', {
                            'action': '3',
                        }),
                        data: JSON.stringify({
                            cookie: munchkinCookie
                        }),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        method: 'POST'
                    }).then(function (response, textStatus, jqXHR) {
                        if (!response || typeof response.success === 'undefined') {
                            return $.Deferred().reject(jqXHR, '', new Error(label + ': no response.'));
                        }
                        if (response.success) {
                            sessionStorage.setItem('marketoLeadWasAssociated', true);
                        } else {
                            return $.Deferred().reject(jqXHR, '', new Error(label + ': retrying.'));
                        }
                    }).fail(function (jqXHR, textStatus, error) {
                        if (error) {
                            console.error(error);
                        }
                        if (++tried >= maxTries) {
                            console.error(label + ': server error.');
                        } else {
                            setTimeout(onTick, timeoutInterval);
                        }
                    });
                }, timeoutInterval);
            }
        }
    });
})(jQuery);

(function () {
    var videoContainers = new Set(document.querySelectorAll('.s7dm-dynamic-media'));

    var attachAnalyticsToVideoElements = function (elements) {
        elements.forEach(function (element) {
            var duration;

            element.addEventListener('loadedmetadata', function () {
                duration = this.duration;
            });
            element.addEventListener('playing', function onPlaying() {
                var title = document.querySelector('.video-landing-title__text');

                window.digitalData.media = {
                    type: 'video',
                    name: title ? title.textContent : document.title,
                    videoLink: element.closest('[data-asset-name]').dataset.assetName,
                    duration: duration,
                };
                element.removeEventListener('playing', onPlaying);
                document.querySelector('body').dispatchEvent(new CustomEvent('videoViewed', {bubbles: true}));
                document.querySelector('body').dispatchEvent(new CustomEvent('video-was-viewed', {bubbles: true}));
            });
            element.addEventListener('timeupdate', function () {
                if (!this.milestone25) {
                    if (this.currentTime / duration > 0.25) {
                        document.querySelector('body').dispatchEvent(new CustomEvent('videoPlayedMilestone25', {bubbles: true}));
                        this.milestone25 = true;
                    }
                }
                if (!this.milestone50) {
                    if (this.currentTime / duration > 0.5) {
                        document.querySelector('body').dispatchEvent(new CustomEvent('videoPlayedMilestone50', {bubbles: true}));
                        this.milestone50 = true;
                    }
                }
                if (!this.milestone75) {
                    if (this.currentTime / duration > 0.75) {
                        document.querySelector('body').dispatchEvent(new CustomEvent('videoPlayedMilestone75', {bubbles: true}));
                        this.milestone75 = true;
                    }
                }
                if (!this.milestone95) {
                    if (this.currentTime / duration > 0.95) {
                        document.querySelector('body').dispatchEvent(new CustomEvent('videoPlayedMilestone95', {bubbles: true}));
                        this.milestone95 = true;
                    }
                }
            });
        });
    };

    var callback = function (mutationList, observer) {
        mutationList.forEach(function (mutation) {
            if (mutation.addedNodes) {
                var videoElements = Array.from(mutation.addedNodes)
                    .filter(function (node) {
                        return node.tagName === 'VIDEO';
                    });

                if (videoElements.length > 0) {
                    attachAnalyticsToVideoElements(videoElements);
                    videoContainers.delete(mutation.target);
                    observer.disconnect();
                }
            }
        });
    };

    var existingVideoElements = Array.from(videoContainers.values()).reduce(function (map, container) {
        var element = container.querySelector('video');

        if (element) {
            map.set(element, container);
        }

        return map;
    }, new Map());

    if (existingVideoElements.size > 0) {
        attachAnalyticsToVideoElements(Array.from(existingVideoElements.keys()));
        existingVideoElements.forEach(function (container, video) {
            videoContainers.delete(container);
            existingVideoElements.delete(video);
        });
    }

    var observer = new MutationObserver(callback);

    videoContainers.forEach(function (container) {
        observer.observe(container, { attributes: false, childList: true, subtree: true });
    });
})();

'use strict';

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/**
 * SimpleBar.js - v2.5.1
 * Scrollbars, simpler.
 * https://grsmto.github.io/simplebar/
 * 
 * Made by Adrien Grsmto from a fork by Jonathan Nicol
 * Under MIT License
 */

(function (global, factory) {
  (typeof exports === 'undefined' ? 'undefined' : _typeof(exports)) === 'object' && typeof module !== 'undefined' ? module.exports = factory() : typeof define === 'function' && define.amd ? define(factory) : global.SimpleBar = factory();
})(this, function () {
  'use strict';

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  function _defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }

  function _createClass(Constructor, protoProps, staticProps) {
    if (protoProps) _defineProperties(Constructor.prototype, protoProps);
    if (staticProps) _defineProperties(Constructor, staticProps);
    return Constructor;
  }

  // 7.1.4 ToInteger
  var ceil = Math.ceil;
  var floor = Math.floor;
  var _toInteger = function _toInteger(it) {
    return isNaN(it = +it) ? 0 : (it > 0 ? floor : ceil)(it);
  };

  // 7.2.1 RequireObjectCoercible(argument)
  var _defined = function _defined(it) {
    if (it == undefined) throw TypeError("Can't call method on  " + it);
    return it;
  };

  // true  -> String#at
  // false -> String#codePointAt
  var _stringAt = function _stringAt(TO_STRING) {
    return function (that, pos) {
      var s = String(_defined(that));
      var i = _toInteger(pos);
      var l = s.length;
      var a, b;
      if (i < 0 || i >= l) return TO_STRING ? '' : undefined;
      a = s.charCodeAt(i);
      return a < 0xd800 || a > 0xdbff || i + 1 === l || (b = s.charCodeAt(i + 1)) < 0xdc00 || b > 0xdfff ? TO_STRING ? s.charAt(i) : a : TO_STRING ? s.slice(i, i + 2) : (a - 0xd800 << 10) + (b - 0xdc00) + 0x10000;
    };
  };

  var _library = false;

  var commonjsGlobal = typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};

  function createCommonjsModule(fn, module) {
    return module = { exports: {} }, fn(module, module.exports), module.exports;
  }

  var _global = createCommonjsModule(function (module) {
    // https://github.com/zloirock/core-js/issues/86#issuecomment-115759028
    var global = module.exports = typeof window != 'undefined' && window.Math == Math ? window : typeof self != 'undefined' && self.Math == Math ? self
    // eslint-disable-next-line no-new-func
    : Function('return this')();
    if (typeof __g == 'number') __g = global; // eslint-disable-line no-undef
  });

  var _core = createCommonjsModule(function (module) {
    var core = module.exports = { version: '2.5.3' };
    if (typeof __e == 'number') __e = core; // eslint-disable-line no-undef
  });
  var _core_1 = _core.version;

  var _isObject = function _isObject(it) {
    return (typeof it === 'undefined' ? 'undefined' : _typeof(it)) === 'object' ? it !== null : typeof it === 'function';
  };

  var _anObject = function _anObject(it) {
    if (!_isObject(it)) throw TypeError(it + ' is not an object!');
    return it;
  };

  var _fails = function _fails(exec) {
    try {
      return !!exec();
    } catch (e) {
      return true;
    }
  };

  // Thank's IE8 for his funny defineProperty
  var _descriptors = !_fails(function () {
    return Object.defineProperty({}, 'a', { get: function get() {
        return 7;
      } }).a != 7;
  });

  var document$1 = _global.document;
  // typeof document.createElement is 'object' in old IE
  var is = _isObject(document$1) && _isObject(document$1.createElement);
  var _domCreate = function _domCreate(it) {
    return is ? document$1.createElement(it) : {};
  };

  var _ie8DomDefine = !_descriptors && !_fails(function () {
    return Object.defineProperty(_domCreate('div'), 'a', { get: function get() {
        return 7;
      } }).a != 7;
  });

  // 7.1.1 ToPrimitive(input [, PreferredType])

  // instead of the ES6 spec version, we didn't implement @@toPrimitive case
  // and the second argument - flag - preferred type is a string
  var _toPrimitive = function _toPrimitive(it, S) {
    if (!_isObject(it)) return it;
    var fn, val;
    if (S && typeof (fn = it.toString) == 'function' && !_isObject(val = fn.call(it))) return val;
    if (typeof (fn = it.valueOf) == 'function' && !_isObject(val = fn.call(it))) return val;
    if (!S && typeof (fn = it.toString) == 'function' && !_isObject(val = fn.call(it))) return val;
    throw TypeError("Can't convert object to primitive value");
  };

  var dP = Object.defineProperty;

  var f = _descriptors ? Object.defineProperty : function defineProperty(O, P, Attributes) {
    _anObject(O);
    P = _toPrimitive(P, true);
    _anObject(Attributes);
    if (_ie8DomDefine) try {
      return dP(O, P, Attributes);
    } catch (e) {/* empty */}
    if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported!');
    if ('value' in Attributes) O[P] = Attributes.value;
    return O;
  };

  var _objectDp = {
    f: f
  };

  var _propertyDesc = function _propertyDesc(bitmap, value) {
    return {
      enumerable: !(bitmap & 1),
      configurable: !(bitmap & 2),
      writable: !(bitmap & 4),
      value: value
    };
  };

  var _hide = _descriptors ? function (object, key, value) {
    return _objectDp.f(object, key, _propertyDesc(1, value));
  } : function (object, key, value) {
    object[key] = value;
    return object;
  };

  var hasOwnProperty = {}.hasOwnProperty;
  var _has = function _has(it, key) {
    return hasOwnProperty.call(it, key);
  };

  var id = 0;
  var px = Math.random();
  var _uid = function _uid(key) {
    return 'Symbol('.concat(key === undefined ? '' : key, ')_', (++id + px).toString(36));
  };

  var _redefine = createCommonjsModule(function (module) {
    var SRC = _uid('src');
    var TO_STRING = 'toString';
    var $toString = Function[TO_STRING];
    var TPL = ('' + $toString).split(TO_STRING);

    _core.inspectSource = function (it) {
      return $toString.call(it);
    };

    (module.exports = function (O, key, val, safe) {
      var isFunction = typeof val == 'function';
      if (isFunction) _has(val, 'name') || _hide(val, 'name', key);
      if (O[key] === val) return;
      if (isFunction) _has(val, SRC) || _hide(val, SRC, O[key] ? '' + O[key] : TPL.join(String(key)));
      if (O === _global) {
        O[key] = val;
      } else if (!safe) {
        delete O[key];
        _hide(O, key, val);
      } else if (O[key]) {
        O[key] = val;
      } else {
        _hide(O, key, val);
      }
      // add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative
    })(Function.prototype, TO_STRING, function toString() {
      return typeof this == 'function' && this[SRC] || $toString.call(this);
    });
  });

  var _aFunction = function _aFunction(it) {
    if (typeof it != 'function') throw TypeError(it + ' is not a function!');
    return it;
  };

  // optional / simple context binding

  var _ctx = function _ctx(fn, that, length) {
    _aFunction(fn);
    if (that === undefined) return fn;
    switch (length) {
      case 1:
        return function (a) {
          return fn.call(that, a);
        };
      case 2:
        return function (a, b) {
          return fn.call(that, a, b);
        };
      case 3:
        return function (a, b, c) {
          return fn.call(that, a, b, c);
        };
    }
    return function () /* ...args */{
      return fn.apply(that, arguments);
    };
  };

  var PROTOTYPE = 'prototype';

  var $export = function $export(type, name, source) {
    var IS_FORCED = type & $export.F;
    var IS_GLOBAL = type & $export.G;
    var IS_STATIC = type & $export.S;
    var IS_PROTO = type & $export.P;
    var IS_BIND = type & $export.B;
    var target = IS_GLOBAL ? _global : IS_STATIC ? _global[name] || (_global[name] = {}) : (_global[name] || {})[PROTOTYPE];
    var exports = IS_GLOBAL ? _core : _core[name] || (_core[name] = {});
    var expProto = exports[PROTOTYPE] || (exports[PROTOTYPE] = {});
    var key, own, out, exp;
    if (IS_GLOBAL) source = name;
    for (key in source) {
      // contains in native
      own = !IS_FORCED && target && target[key] !== undefined;
      // export native or passed
      out = (own ? target : source)[key];
      // bind timers to global for call from export context
      exp = IS_BIND && own ? _ctx(out, _global) : IS_PROTO && typeof out == 'function' ? _ctx(Function.call, out) : out;
      // extend global
      if (target) _redefine(target, key, out, type & $export.U);
      // export
      if (exports[key] != out) _hide(exports, key, exp);
      if (IS_PROTO && expProto[key] != out) expProto[key] = out;
    }
  };
  _global.core = _core;
  // type bitmap
  $export.F = 1; // forced
  $export.G = 2; // global
  $export.S = 4; // static
  $export.P = 8; // proto
  $export.B = 16; // bind
  $export.W = 32; // wrap
  $export.U = 64; // safe
  $export.R = 128; // real proto method for `library`
  var _export = $export;

  var _iterators = {};

  var toString = {}.toString;

  var _cof = function _cof(it) {
    return toString.call(it).slice(8, -1);
  };

  // fallback for non-array-like ES3 and non-enumerable old V8 strings

  // eslint-disable-next-line no-prototype-builtins
  var _iobject = Object('z').propertyIsEnumerable(0) ? Object : function (it) {
    return _cof(it) == 'String' ? it.split('') : Object(it);
  };

  // to indexed object, toObject with fallback for non-array-like ES3 strings


  var _toIobject = function _toIobject(it) {
    return _iobject(_defined(it));
  };

  // 7.1.15 ToLength

  var min = Math.min;
  var _toLength = function _toLength(it) {
    return it > 0 ? min(_toInteger(it), 0x1fffffffffffff) : 0; // pow(2, 53) - 1 == 9007199254740991
  };

  var max = Math.max;
  var min$1 = Math.min;
  var _toAbsoluteIndex = function _toAbsoluteIndex(index, length) {
    index = _toInteger(index);
    return index < 0 ? max(index + length, 0) : min$1(index, length);
  };

  // false -> Array#indexOf
  // true  -> Array#includes


  var _arrayIncludes = function _arrayIncludes(IS_INCLUDES) {
    return function ($this, el, fromIndex) {
      var O = _toIobject($this);
      var length = _toLength(O.length);
      var index = _toAbsoluteIndex(fromIndex, length);
      var value;
      // Array#includes uses SameValueZero equality algorithm
      // eslint-disable-next-line no-self-compare
      if (IS_INCLUDES && el != el) while (length > index) {
        value = O[index++];
        // eslint-disable-next-line no-self-compare
        if (value != value) return true;
        // Array#indexOf ignores holes, Array#includes - not
      } else for (; length > index; index++) {
        if (IS_INCLUDES || index in O) {
          if (O[index] === el) return IS_INCLUDES || index || 0;
        }
      }return !IS_INCLUDES && -1;
    };
  };

  var SHARED = '__core-js_shared__';
  var store = _global[SHARED] || (_global[SHARED] = {});
  var _shared = function _shared(key) {
    return store[key] || (store[key] = {});
  };

  var shared = _shared('keys');

  var _sharedKey = function _sharedKey(key) {
    return shared[key] || (shared[key] = _uid(key));
  };

  var arrayIndexOf = _arrayIncludes(false);
  var IE_PROTO = _sharedKey('IE_PROTO');

  var _objectKeysInternal = function _objectKeysInternal(object, names) {
    var O = _toIobject(object);
    var i = 0;
    var result = [];
    var key;
    for (key in O) {
      if (key != IE_PROTO) _has(O, key) && result.push(key);
    } // Don't enum bug & hidden keys
    while (names.length > i) {
      if (_has(O, key = names[i++])) {
        ~arrayIndexOf(result, key) || result.push(key);
      }
    }return result;
  };

  // IE 8- don't enum bug keys
  var _enumBugKeys = 'constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf'.split(',');

  // 19.1.2.14 / 15.2.3.14 Object.keys(O)


  var _objectKeys = Object.keys || function keys(O) {
    return _objectKeysInternal(O, _enumBugKeys);
  };

  var _objectDps = _descriptors ? Object.defineProperties : function defineProperties(O, Properties) {
    _anObject(O);
    var keys = _objectKeys(Properties);
    var length = keys.length;
    var i = 0;
    var P;
    while (length > i) {
      _objectDp.f(O, P = keys[i++], Properties[P]);
    }return O;
  };

  var document$2 = _global.document;
  var _html = document$2 && document$2.documentElement;

  // 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])


  var IE_PROTO$1 = _sharedKey('IE_PROTO');
  var Empty = function Empty() {/* empty */};
  var PROTOTYPE$1 = 'prototype';

  // Create object with fake `null` prototype: use iframe Object with cleared prototype
  var _createDict = function createDict() {
    // Thrash, waste and sodomy: IE GC bug
    var iframe = _domCreate('iframe');
    var i = _enumBugKeys.length;
    var lt = '<';
    var gt = '>';
    var iframeDocument;
    iframe.style.display = 'none';
    _html.appendChild(iframe);
    iframe.src = 'javascript:'; // eslint-disable-line no-script-url
    // createDict = iframe.contentWindow.Object;
    // html.removeChild(iframe);
    iframeDocument = iframe.contentWindow.document;
    iframeDocument.open();
    iframeDocument.write(lt + 'script' + gt + 'document.F=Object' + lt + '/script' + gt);
    iframeDocument.close();
    _createDict = iframeDocument.F;
    while (i--) {
      delete _createDict[PROTOTYPE$1][_enumBugKeys[i]];
    }return _createDict();
  };

  var _objectCreate = Object.create || function create(O, Properties) {
    var result;
    if (O !== null) {
      Empty[PROTOTYPE$1] = _anObject(O);
      result = new Empty();
      Empty[PROTOTYPE$1] = null;
      // add "__proto__" for Object.getPrototypeOf polyfill
      result[IE_PROTO$1] = O;
    } else result = _createDict();
    return Properties === undefined ? result : _objectDps(result, Properties);
  };

  var _wks = createCommonjsModule(function (module) {
    var store = _shared('wks');

    var _Symbol = _global.Symbol;
    var USE_SYMBOL = typeof _Symbol == 'function';

    var $exports = module.exports = function (name) {
      return store[name] || (store[name] = USE_SYMBOL && _Symbol[name] || (USE_SYMBOL ? _Symbol : _uid)('Symbol.' + name));
    };

    $exports.store = store;
  });

  var def = _objectDp.f;

  var TAG = _wks('toStringTag');

  var _setToStringTag = function _setToStringTag(it, tag, stat) {
    if (it && !_has(it = stat ? it : it.prototype, TAG)) def(it, TAG, { configurable: true, value: tag });
  };

  var IteratorPrototype = {};

  // 25.1.2.1.1 %IteratorPrototype%[@@iterator]()
  _hide(IteratorPrototype, _wks('iterator'), function () {
    return this;
  });

  var _iterCreate = function _iterCreate(Constructor, NAME, next) {
    Constructor.prototype = _objectCreate(IteratorPrototype, { next: _propertyDesc(1, next) });
    _setToStringTag(Constructor, NAME + ' Iterator');
  };

  // 7.1.13 ToObject(argument)

  var _toObject = function _toObject(it) {
    return Object(_defined(it));
  };

  // 19.1.2.9 / 15.2.3.2 Object.getPrototypeOf(O)


  var IE_PROTO$2 = _sharedKey('IE_PROTO');
  var ObjectProto = Object.prototype;

  var _objectGpo = Object.getPrototypeOf || function (O) {
    O = _toObject(O);
    if (_has(O, IE_PROTO$2)) return O[IE_PROTO$2];
    if (typeof O.constructor == 'function' && O instanceof O.constructor) {
      return O.constructor.prototype;
    }return O instanceof Object ? ObjectProto : null;
  };

  var ITERATOR = _wks('iterator');
  var BUGGY = !([].keys && 'next' in [].keys()); // Safari has buggy iterators w/o `next`
  var FF_ITERATOR = '@@iterator';
  var KEYS = 'keys';
  var VALUES = 'values';

  var returnThis = function returnThis() {
    return this;
  };

  var _iterDefine = function _iterDefine(Base, NAME, Constructor, next, DEFAULT, IS_SET, FORCED) {
    _iterCreate(Constructor, NAME, next);
    var getMethod = function getMethod(kind) {
      if (!BUGGY && kind in proto) return proto[kind];
      switch (kind) {
        case KEYS:
          return function keys() {
            return new Constructor(this, kind);
          };
        case VALUES:
          return function values() {
            return new Constructor(this, kind);
          };
      }return function entries() {
        return new Constructor(this, kind);
      };
    };
    var TAG = NAME + ' Iterator';
    var DEF_VALUES = DEFAULT == VALUES;
    var VALUES_BUG = false;
    var proto = Base.prototype;
    var $native = proto[ITERATOR] || proto[FF_ITERATOR] || DEFAULT && proto[DEFAULT];
    var $default = !BUGGY && $native || getMethod(DEFAULT);
    var $entries = DEFAULT ? !DEF_VALUES ? $default : getMethod('entries') : undefined;
    var $anyNative = NAME == 'Array' ? proto.entries || $native : $native;
    var methods, key, IteratorPrototype;
    // Fix native
    if ($anyNative) {
      IteratorPrototype = _objectGpo($anyNative.call(new Base()));
      if (IteratorPrototype !== Object.prototype && IteratorPrototype.next) {
        // Set @@toStringTag to native iterators
        _setToStringTag(IteratorPrototype, TAG, true);
        // fix for some old engines
        if (!_library && !_has(IteratorPrototype, ITERATOR)) _hide(IteratorPrototype, ITERATOR, returnThis);
      }
    }
    // fix Array#{values, @@iterator}.name in V8 / FF
    if (DEF_VALUES && $native && $native.name !== VALUES) {
      VALUES_BUG = true;
      $default = function values() {
        return $native.call(this);
      };
    }
    // Define iterator
    if ((!_library || FORCED) && (BUGGY || VALUES_BUG || !proto[ITERATOR])) {
      _hide(proto, ITERATOR, $default);
    }
    // Plug for library
    _iterators[NAME] = $default;
    _iterators[TAG] = returnThis;
    if (DEFAULT) {
      methods = {
        values: DEF_VALUES ? $default : getMethod(VALUES),
        keys: IS_SET ? $default : getMethod(KEYS),
        entries: $entries
      };
      if (FORCED) for (key in methods) {
        if (!(key in proto)) _redefine(proto, key, methods[key]);
      } else _export(_export.P + _export.F * (BUGGY || VALUES_BUG), NAME, methods);
    }
    return methods;
  };

  var $at = _stringAt(true);

  // 21.1.3.27 String.prototype[@@iterator]()
  _iterDefine(String, 'String', function (iterated) {
    this._t = String(iterated); // target
    this._i = 0; // next index
    // 21.1.5.2.1 %StringIteratorPrototype%.next()
  }, function () {
    var O = this._t;
    var index = this._i;
    var point;
    if (index >= O.length) return { value: undefined, done: true };
    point = $at(O, index);
    this._i += point.length;
    return { value: point, done: false };
  });

  // call something on iterator step with safe closing on error

  var _iterCall = function _iterCall(iterator, fn, value, entries) {
    try {
      return entries ? fn(_anObject(value)[0], value[1]) : fn(value);
      // 7.4.6 IteratorClose(iterator, completion)
    } catch (e) {
      var ret = iterator['return'];
      if (ret !== undefined) _anObject(ret.call(iterator));
      throw e;
    }
  };

  // check on default Array iterator

  var ITERATOR$1 = _wks('iterator');
  var ArrayProto = Array.prototype;

  var _isArrayIter = function _isArrayIter(it) {
    return it !== undefined && (_iterators.Array === it || ArrayProto[ITERATOR$1] === it);
  };

  var _createProperty = function _createProperty(object, index, value) {
    if (index in object) _objectDp.f(object, index, _propertyDesc(0, value));else object[index] = value;
  };

  // getting tag from 19.1.3.6 Object.prototype.toString()

  var TAG$1 = _wks('toStringTag');
  // ES3 wrong here
  var ARG = _cof(function () {
    return arguments;
  }()) == 'Arguments';

  // fallback for IE11 Script Access Denied error
  var tryGet = function tryGet(it, key) {
    try {
      return it[key];
    } catch (e) {/* empty */}
  };

  var _classof = function _classof(it) {
    var O, T, B;
    return it === undefined ? 'Undefined' : it === null ? 'Null'
    // @@toStringTag case
    : typeof (T = tryGet(O = Object(it), TAG$1)) == 'string' ? T
    // builtinTag case
    : ARG ? _cof(O)
    // ES3 arguments fallback
    : (B = _cof(O)) == 'Object' && typeof O.callee == 'function' ? 'Arguments' : B;
  };

  var ITERATOR$2 = _wks('iterator');

  var core_getIteratorMethod = _core.getIteratorMethod = function (it) {
    if (it != undefined) return it[ITERATOR$2] || it['@@iterator'] || _iterators[_classof(it)];
  };

  var ITERATOR$3 = _wks('iterator');
  var SAFE_CLOSING = false;

  try {
    var riter = [7][ITERATOR$3]();
    riter['return'] = function () {
      SAFE_CLOSING = true;
    };
  } catch (e) {/* empty */}

  var _iterDetect = function _iterDetect(exec, skipClosing) {
    if (!skipClosing && !SAFE_CLOSING) return false;
    var safe = false;
    try {
      var arr = [7];
      var iter = arr[ITERATOR$3]();
      iter.next = function () {
        return { done: safe = true };
      };
      arr[ITERATOR$3] = function () {
        return iter;
      };
      exec(arr);
    } catch (e) {/* empty */}
    return safe;
  };

  _export(_export.S + _export.F * !_iterDetect(function (iter) {}), 'Array', {
    // 22.1.2.1 Array.from(arrayLike, mapfn = undefined, thisArg = undefined)
    from: function from(arrayLike /* , mapfn = undefined, thisArg = undefined */) {
      var O = _toObject(arrayLike);
      var C = typeof this == 'function' ? this : Array;
      var aLen = arguments.length;
      var mapfn = aLen > 1 ? arguments[1] : undefined;
      var mapping = mapfn !== undefined;
      var index = 0;
      var iterFn = core_getIteratorMethod(O);
      var length, result, step, iterator;
      if (mapping) mapfn = _ctx(mapfn, aLen > 2 ? arguments[2] : undefined, 2);
      // if object isn't iterable or it's array with default iterator - use simple case
      if (iterFn != undefined && !(C == Array && _isArrayIter(iterFn))) {
        for (iterator = iterFn.call(O), result = new C(); !(step = iterator.next()).done; index++) {
          _createProperty(result, index, mapping ? _iterCall(iterator, mapfn, [step.value, index], true) : step.value);
        }
      } else {
        length = _toLength(O.length);
        for (result = new C(length); length > index; index++) {
          _createProperty(result, index, mapping ? mapfn(O[index], index) : O[index]);
        }
      }
      result.length = index;
      return result;
    }
  });

  var from = _core.Array.from;

  var scrollbarWidth = createCommonjsModule(function (module, exports) {
    /*! scrollbarWidth.js v0.1.3 | felixexter | MIT | https://github.com/felixexter/scrollbarWidth */
    (function (root, factory) {
      if (typeof undefined === 'function' && undefined.amd) {
        undefined([], factory);
      } else {
        module.exports = factory();
      }
    })(commonjsGlobal, function () {

      function scrollbarWidth() {
        if (typeof document === 'undefined') {
          return 0;
        }

        var body = document.body,
            box = document.createElement('div'),
            boxStyle = box.style,
            width;

        boxStyle.position = 'absolute';
        boxStyle.top = boxStyle.left = '-9999px';
        boxStyle.width = boxStyle.height = '100px';
        boxStyle.overflow = 'scroll';

        body.appendChild(box);

        width = box.offsetWidth - box.clientWidth;

        body.removeChild(box);

        return width;
      }

      return scrollbarWidth;
    });
  });

  /**
   * lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="npm" -o ./`
   * Copyright jQuery Foundation and other contributors <https://jquery.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   */

  /** Used as the `TypeError` message for "Functions" methods. */
  var FUNC_ERROR_TEXT = 'Expected a function';

  /** Used as references for various `Number` constants. */
  var NAN = 0 / 0;

  /** `Object#toString` result references. */
  var symbolTag = '[object Symbol]';

  /** Used to match leading and trailing whitespace. */
  var reTrim = /^\s+|\s+$/g;

  /** Used to detect bad signed hexadecimal string values. */
  var reIsBadHex = /^[-+]0x[0-9a-f]+$/i;

  /** Used to detect binary string values. */
  var reIsBinary = /^0b[01]+$/i;

  /** Used to detect octal string values. */
  var reIsOctal = /^0o[0-7]+$/i;

  /** Built-in method references without a dependency on `root`. */
  var freeParseInt = parseInt;

  /** Detect free variable `global` from Node.js. */
  var freeGlobal = (typeof commonjsGlobal === 'undefined' ? 'undefined' : _typeof(commonjsGlobal)) == 'object' && commonjsGlobal && commonjsGlobal.Object === Object && commonjsGlobal;

  /** Detect free variable `self`. */
  var freeSelf = (typeof self === 'undefined' ? 'undefined' : _typeof(self)) == 'object' && self && self.Object === Object && self;

  /** Used as a reference to the global object. */
  var root = freeGlobal || freeSelf || Function('return this')();

  /** Used for built-in method references. */
  var objectProto = Object.prototype;

  /**
   * Used to resolve the
   * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
   * of values.
   */
  var objectToString = objectProto.toString;

  /* Built-in method references for those with the same name as other `lodash` methods. */
  var nativeMax = Math.max,
      nativeMin = Math.min;

  /**
   * Gets the timestamp of the number of milliseconds that have elapsed since
   * the Unix epoch (1 January 1970 00:00:00 UTC).
   *
   * @static
   * @memberOf _
   * @since 2.4.0
   * @category Date
   * @returns {number} Returns the timestamp.
   * @example
   *
   * _.defer(function(stamp) {
   *   console.log(_.now() - stamp);
   * }, _.now());
   * // => Logs the number of milliseconds it took for the deferred invocation.
   */
  var now = function now() {
    return root.Date.now();
  };

  /**
   * Creates a debounced function that delays invoking `func` until after `wait`
   * milliseconds have elapsed since the last time the debounced function was
   * invoked. The debounced function comes with a `cancel` method to cancel
   * delayed `func` invocations and a `flush` method to immediately invoke them.
   * Provide `options` to indicate whether `func` should be invoked on the
   * leading and/or trailing edge of the `wait` timeout. The `func` is invoked
   * with the last arguments provided to the debounced function. Subsequent
   * calls to the debounced function return the result of the last `func`
   * invocation.
   *
   * **Note:** If `leading` and `trailing` options are `true`, `func` is
   * invoked on the trailing edge of the timeout only if the debounced function
   * is invoked more than once during the `wait` timeout.
   *
   * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred
   * until to the next tick, similar to `setTimeout` with a timeout of `0`.
   *
   * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)
   * for details over the differences between `_.debounce` and `_.throttle`.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Function
   * @param {Function} func The function to debounce.
   * @param {number} [wait=0] The number of milliseconds to delay.
   * @param {Object} [options={}] The options object.
   * @param {boolean} [options.leading=false]
   *  Specify invoking on the leading edge of the timeout.
   * @param {number} [options.maxWait]
   *  The maximum time `func` is allowed to be delayed before it's invoked.
   * @param {boolean} [options.trailing=true]
   *  Specify invoking on the trailing edge of the timeout.
   * @returns {Function} Returns the new debounced function.
   * @example
   *
   * // Avoid costly calculations while the window size is in flux.
   * jQuery(window).on('resize', _.debounce(calculateLayout, 150));
   *
   * // Invoke `sendMail` when clicked, debouncing subsequent calls.
   * jQuery(element).on('click', _.debounce(sendMail, 300, {
   *   'leading': true,
   *   'trailing': false
   * }));
   *
   * // Ensure `batchLog` is invoked once after 1 second of debounced calls.
   * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });
   * var source = new EventSource('/stream');
   * jQuery(source).on('message', debounced);
   *
   * // Cancel the trailing debounced invocation.
   * jQuery(window).on('popstate', debounced.cancel);
   */
  function debounce(func, wait, options) {
    var lastArgs,
        lastThis,
        maxWait,
        result,
        timerId,
        lastCallTime,
        lastInvokeTime = 0,
        leading = false,
        maxing = false,
        trailing = true;

    if (typeof func != 'function') {
      throw new TypeError(FUNC_ERROR_TEXT);
    }
    wait = toNumber(wait) || 0;
    if (isObject(options)) {
      leading = !!options.leading;
      maxing = 'maxWait' in options;
      maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;
      trailing = 'trailing' in options ? !!options.trailing : trailing;
    }

    function invokeFunc(time) {
      var args = lastArgs,
          thisArg = lastThis;

      lastArgs = lastThis = undefined;
      lastInvokeTime = time;
      result = func.apply(thisArg, args);
      return result;
    }

    function leadingEdge(time) {
      // Reset any `maxWait` timer.
      lastInvokeTime = time;
      // Start the timer for the trailing edge.
      timerId = setTimeout(timerExpired, wait);
      // Invoke the leading edge.
      return leading ? invokeFunc(time) : result;
    }

    function remainingWait(time) {
      var timeSinceLastCall = time - lastCallTime,
          timeSinceLastInvoke = time - lastInvokeTime,
          result = wait - timeSinceLastCall;

      return maxing ? nativeMin(result, maxWait - timeSinceLastInvoke) : result;
    }

    function shouldInvoke(time) {
      var timeSinceLastCall = time - lastCallTime,
          timeSinceLastInvoke = time - lastInvokeTime;

      // Either this is the first call, activity has stopped and we're at the
      // trailing edge, the system time has gone backwards and we're treating
      // it as the trailing edge, or we've hit the `maxWait` limit.
      return lastCallTime === undefined || timeSinceLastCall >= wait || timeSinceLastCall < 0 || maxing && timeSinceLastInvoke >= maxWait;
    }

    function timerExpired() {
      var time = now();
      if (shouldInvoke(time)) {
        return trailingEdge(time);
      }
      // Restart the timer.
      timerId = setTimeout(timerExpired, remainingWait(time));
    }

    function trailingEdge(time) {
      timerId = undefined;

      // Only invoke if we have `lastArgs` which means `func` has been
      // debounced at least once.
      if (trailing && lastArgs) {
        return invokeFunc(time);
      }
      lastArgs = lastThis = undefined;
      return result;
    }

    function cancel() {
      if (timerId !== undefined) {
        clearTimeout(timerId);
      }
      lastInvokeTime = 0;
      lastArgs = lastCallTime = lastThis = timerId = undefined;
    }

    function flush() {
      return timerId === undefined ? result : trailingEdge(now());
    }

    function debounced() {
      var time = now(),
          isInvoking = shouldInvoke(time);

      lastArgs = arguments;
      lastThis = this;
      lastCallTime = time;

      if (isInvoking) {
        if (timerId === undefined) {
          return leadingEdge(lastCallTime);
        }
        if (maxing) {
          // Handle invocations in a tight loop.
          timerId = setTimeout(timerExpired, wait);
          return invokeFunc(lastCallTime);
        }
      }
      if (timerId === undefined) {
        timerId = setTimeout(timerExpired, wait);
      }
      return result;
    }
    debounced.cancel = cancel;
    debounced.flush = flush;
    return debounced;
  }

  /**
   * Checks if `value` is the
   * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)
   * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an object, else `false`.
   * @example
   *
   * _.isObject({});
   * // => true
   *
   * _.isObject([1, 2, 3]);
   * // => true
   *
   * _.isObject(_.noop);
   * // => true
   *
   * _.isObject(null);
   * // => false
   */
  function isObject(value) {
    var type = typeof value === 'undefined' ? 'undefined' : _typeof(value);
    return !!value && (type == 'object' || type == 'function');
  }

  /**
   * Checks if `value` is object-like. A value is object-like if it's not `null`
   * and has a `typeof` result of "object".
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
   * @example
   *
   * _.isObjectLike({});
   * // => true
   *
   * _.isObjectLike([1, 2, 3]);
   * // => true
   *
   * _.isObjectLike(_.noop);
   * // => false
   *
   * _.isObjectLike(null);
   * // => false
   */
  function isObjectLike(value) {
    return !!value && (typeof value === 'undefined' ? 'undefined' : _typeof(value)) == 'object';
  }

  /**
   * Checks if `value` is classified as a `Symbol` primitive or object.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.
   * @example
   *
   * _.isSymbol(Symbol.iterator);
   * // => true
   *
   * _.isSymbol('abc');
   * // => false
   */
  function isSymbol(value) {
    return (typeof value === 'undefined' ? 'undefined' : _typeof(value)) == 'symbol' || isObjectLike(value) && objectToString.call(value) == symbolTag;
  }

  /**
   * Converts `value` to a number.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to process.
   * @returns {number} Returns the number.
   * @example
   *
   * _.toNumber(3.2);
   * // => 3.2
   *
   * _.toNumber(Number.MIN_VALUE);
   * // => 5e-324
   *
   * _.toNumber(Infinity);
   * // => Infinity
   *
   * _.toNumber('3.2');
   * // => 3.2
   */
  function toNumber(value) {
    if (typeof value == 'number') {
      return value;
    }
    if (isSymbol(value)) {
      return NAN;
    }
    if (isObject(value)) {
      var other = typeof value.valueOf == 'function' ? value.valueOf() : value;
      value = isObject(other) ? other + '' : other;
    }
    if (typeof value != 'string') {
      return value === 0 ? value : +value;
    }
    value = value.replace(reTrim, '');
    var isBinary = reIsBinary.test(value);
    return isBinary || reIsOctal.test(value) ? freeParseInt(value.slice(2), isBinary ? 2 : 8) : reIsBadHex.test(value) ? NAN : +value;
  }

  var lodash_debounce = debounce;

  /**
   * A collection of shims that provide minimal functionality of the ES6 collections.
   *
   * These implementations are not meant to be used outside of the ResizeObserver
   * modules as they cover only a limited range of use cases.
   */
  /* eslint-disable require-jsdoc, valid-jsdoc */
  var MapShim = function () {
    if (typeof Map !== 'undefined') {
      return Map;
    }

    /**
     * Returns index in provided array that matches the specified key.
     *
     * @param {Array<Array>} arr
     * @param {*} key
     * @returns {number}
     */
    function getIndex(arr, key) {
      var result = -1;

      arr.some(function (entry, index) {
        if (entry[0] === key) {
          result = index;

          return true;
        }

        return false;
      });

      return result;
    }

    return function () {
      function anonymous() {
        this.__entries__ = [];
      }

      var prototypeAccessors = { size: { configurable: true } };

      /**
       * @returns {boolean}
       */
      prototypeAccessors.size.get = function () {
        return this.__entries__.length;
      };

      /**
       * @param {*} key
       * @returns {*}
       */
      anonymous.prototype.get = function (key) {
        var index = getIndex(this.__entries__, key);
        var entry = this.__entries__[index];

        return entry && entry[1];
      };

      /**
       * @param {*} key
       * @param {*} value
       * @returns {void}
       */
      anonymous.prototype.set = function (key, value) {
        var index = getIndex(this.__entries__, key);

        if (~index) {
          this.__entries__[index][1] = value;
        } else {
          this.__entries__.push([key, value]);
        }
      };

      /**
       * @param {*} key
       * @returns {void}
       */
      anonymous.prototype['delete'] = function (key) {
        var entries = this.__entries__;
        var index = getIndex(entries, key);

        if (~index) {
          entries.splice(index, 1);
        }
      };

      /**
       * @param {*} key
       * @returns {void}
       */
      anonymous.prototype.has = function (key) {
        return !!~getIndex(this.__entries__, key);
      };

      /**
       * @returns {void}
       */
      anonymous.prototype.clear = function () {
        this.__entries__.splice(0);
      };

      /**
       * @param {Function} callback
       * @param {*} [ctx=null]
       * @returns {void}
       */
      anonymous.prototype.forEach = function (callback, ctx) {
        var this$1 = this;
        if (ctx === void 0) ctx = null;

        for (var i = 0, list = this$1.__entries__; i < list.length; i += 1) {
          var entry = list[i];

          callback.call(ctx, entry[1], entry[0]);
        }
      };

      Object.defineProperties(anonymous.prototype, prototypeAccessors);

      return anonymous;
    }();
  }();

  /**
   * Detects whether window and document objects are available in current environment.
   */
  var isBrowser = typeof window !== 'undefined' && typeof document !== 'undefined' && window.document === document;

  // Returns global object of a current environment.
  var global$1 = function () {
    if (typeof global !== 'undefined' && global.Math === Math) {
      return global;
    }

    if (typeof self !== 'undefined' && self.Math === Math) {
      return self;
    }

    if (typeof window !== 'undefined' && window.Math === Math) {
      return window;
    }

    // eslint-disable-next-line no-new-func
    return Function('return this')();
  }();

  /**
   * A shim for the requestAnimationFrame which falls back to the setTimeout if
   * first one is not supported.
   *
   * @returns {number} Requests' identifier.
   */
  var requestAnimationFrame$1 = function () {
    if (typeof requestAnimationFrame === 'function') {
      // It's required to use a bounded function because IE sometimes throws
      // an "Invalid calling object" error if rAF is invoked without the global
      // object on the left hand side.
      return requestAnimationFrame.bind(global$1);
    }

    return function (callback) {
      return setTimeout(function () {
        return callback(Date.now());
      }, 1000 / 60);
    };
  }();

  // Defines minimum timeout before adding a trailing call.
  var trailingTimeout = 2;

  /**
   * Creates a wrapper function which ensures that provided callback will be
   * invoked only once during the specified delay period.
   *
   * @param {Function} callback - Function to be invoked after the delay period.
   * @param {number} delay - Delay after which to invoke callback.
   * @returns {Function}
   */
  var throttle = function throttle(callback, delay) {
    var leadingCall = false,
        trailingCall = false,
        lastCallTime = 0;

    /**
     * Invokes the original callback function and schedules new invocation if
     * the "proxy" was called during current request.
     *
     * @returns {void}
     */
    function resolvePending() {
      if (leadingCall) {
        leadingCall = false;

        callback();
      }

      if (trailingCall) {
        proxy();
      }
    }

    /**
     * Callback invoked after the specified delay. It will further postpone
     * invocation of the original function delegating it to the
     * requestAnimationFrame.
     *
     * @returns {void}
     */
    function timeoutCallback() {
      requestAnimationFrame$1(resolvePending);
    }

    /**
     * Schedules invocation of the original function.
     *
     * @returns {void}
     */
    function proxy() {
      var timeStamp = Date.now();

      if (leadingCall) {
        // Reject immediately following calls.
        if (timeStamp - lastCallTime < trailingTimeout) {
          return;
        }

        // Schedule new call to be in invoked when the pending one is resolved.
        // This is important for "transitions" which never actually start
        // immediately so there is a chance that we might miss one if change
        // happens amids the pending invocation.
        trailingCall = true;
      } else {
        leadingCall = true;
        trailingCall = false;

        setTimeout(timeoutCallback, delay);
      }

      lastCallTime = timeStamp;
    }

    return proxy;
  };

  // Minimum delay before invoking the update of observers.
  var REFRESH_DELAY = 20;

  // A list of substrings of CSS properties used to find transition events that
  // might affect dimensions of observed elements.
  var transitionKeys = ['top', 'right', 'bottom', 'left', 'width', 'height', 'size', 'weight'];

  // Check if MutationObserver is available.
  var mutationObserverSupported = typeof MutationObserver !== 'undefined';

  /**
   * Singleton controller class which handles updates of ResizeObserver instances.
   */
  var ResizeObserverController = function ResizeObserverController() {
    this.connected_ = false;
    this.mutationEventsAdded_ = false;
    this.mutationsObserver_ = null;
    this.observers_ = [];

    this.onTransitionEnd_ = this.onTransitionEnd_.bind(this);
    this.refresh = throttle(this.refresh.bind(this), REFRESH_DELAY);
  };

  /**
   * Adds observer to observers list.
   *
   * @param {ResizeObserverSPI} observer - Observer to be added.
   * @returns {void}
   */

  /**
   * Holds reference to the controller's instance.
   *
   * @private {ResizeObserverController}
   */

  /**
   * Keeps reference to the instance of MutationObserver.
   *
   * @private {MutationObserver}
   */

  /**
   * Indicates whether DOM listeners have been added.
   *
   * @private {boolean}
   */
  ResizeObserverController.prototype.addObserver = function (observer) {
    if (!~this.observers_.indexOf(observer)) {
      this.observers_.push(observer);
    }

    // Add listeners if they haven't been added yet.
    if (!this.connected_) {
      this.connect_();
    }
  };

  /**
   * Removes observer from observers list.
   *
   * @param {ResizeObserverSPI} observer - Observer to be removed.
   * @returns {void}
   */
  ResizeObserverController.prototype.removeObserver = function (observer) {
    var observers = this.observers_;
    var index = observers.indexOf(observer);

    // Remove observer if it's present in registry.
    if (~index) {
      observers.splice(index, 1);
    }

    // Remove listeners if controller has no connected observers.
    if (!observers.length && this.connected_) {
      this.disconnect_();
    }
  };

  /**
   * Invokes the update of observers. It will continue running updates insofar
   * it detects changes.
   *
   * @returns {void}
   */
  ResizeObserverController.prototype.refresh = function () {
    var changesDetected = this.updateObservers_();

    // Continue running updates if changes have been detected as there might
    // be future ones caused by CSS transitions.
    if (changesDetected) {
      this.refresh();
    }
  };

  /**
   * Updates every observer from observers list and notifies them of queued
   * entries.
   *
   * @private
   * @returns {boolean} Returns "true" if any observer has detected changes in
   *  dimensions of it's elements.
   */
  ResizeObserverController.prototype.updateObservers_ = function () {
    // Collect observers that have active observations.
    var activeObservers = this.observers_.filter(function (observer) {
      return observer.gatherActive(), observer.hasActive();
    });

    // Deliver notifications in a separate cycle in order to avoid any
    // collisions between observers, e.g. when multiple instances of
    // ResizeObserver are tracking the same element and the callback of one
    // of them changes content dimensions of the observed target. Sometimes
    // this may result in notifications being blocked for the rest of observers.
    activeObservers.forEach(function (observer) {
      return observer.broadcastActive();
    });

    return activeObservers.length > 0;
  };

  /**
   * Initializes DOM listeners.
   *
   * @private
   * @returns {void}
   */
  ResizeObserverController.prototype.connect_ = function () {
    // Do nothing if running in a non-browser environment or if listeners
    // have been already added.
    if (!isBrowser || this.connected_) {
      return;
    }

    // Subscription to the "Transitionend" event is used as a workaround for
    // delayed transitions. This way it's possible to capture at least the
    // final state of an element.
    document.addEventListener('transitionend', this.onTransitionEnd_);

    window.addEventListener('resize', this.refresh);

    if (mutationObserverSupported) {
      this.mutationsObserver_ = new MutationObserver(this.refresh);

      this.mutationsObserver_.observe(document, {
        attributes: true,
        childList: true,
        characterData: true,
        subtree: true
      });
    } else {
      document.addEventListener('DOMSubtreeModified', this.refresh);

      this.mutationEventsAdded_ = true;
    }

    this.connected_ = true;
  };

  /**
   * Removes DOM listeners.
   *
   * @private
   * @returns {void}
   */
  ResizeObserverController.prototype.disconnect_ = function () {
    // Do nothing if running in a non-browser environment or if listeners
    // have been already removed.
    if (!isBrowser || !this.connected_) {
      return;
    }

    document.removeEventListener('transitionend', this.onTransitionEnd_);
    window.removeEventListener('resize', this.refresh);

    if (this.mutationsObserver_) {
      this.mutationsObserver_.disconnect();
    }

    if (this.mutationEventsAdded_) {
      document.removeEventListener('DOMSubtreeModified', this.refresh);
    }

    this.mutationsObserver_ = null;
    this.mutationEventsAdded_ = false;
    this.connected_ = false;
  };

  /**
   * "Transitionend" event handler.
   *
   * @private
   * @param {TransitionEvent} event
   * @returns {void}
   */
  ResizeObserverController.prototype.onTransitionEnd_ = function (ref) {
    var propertyName = ref.propertyName;if (propertyName === void 0) propertyName = '';

    // Detect whether transition may affect dimensions of an element.
    var isReflowProperty = transitionKeys.some(function (key) {
      return !!~propertyName.indexOf(key);
    });

    if (isReflowProperty) {
      this.refresh();
    }
  };

  /**
   * Returns instance of the ResizeObserverController.
   *
   * @returns {ResizeObserverController}
   */
  ResizeObserverController.getInstance = function () {
    if (!this.instance_) {
      this.instance_ = new ResizeObserverController();
    }

    return this.instance_;
  };

  ResizeObserverController.instance_ = null;

  /**
   * Defines non-writable/enumerable properties of the provided target object.
   *
   * @param {Object} target - Object for which to define properties.
   * @param {Object} props - Properties to be defined.
   * @returns {Object} Target object.
   */
  var defineConfigurable = function defineConfigurable(target, props) {
    for (var i = 0, list = Object.keys(props); i < list.length; i += 1) {
      var key = list[i];

      Object.defineProperty(target, key, {
        value: props[key],
        enumerable: false,
        writable: false,
        configurable: true
      });
    }

    return target;
  };

  /**
   * Returns the global object associated with provided element.
   *
   * @param {Object} target
   * @returns {Object}
   */
  var getWindowOf = function getWindowOf(target) {
    // Assume that the element is an instance of Node, which means that it
    // has the "ownerDocument" property from which we can retrieve a
    // corresponding global object.
    var ownerGlobal = target && target.ownerDocument && target.ownerDocument.defaultView;

    // Return the local global object if it's not possible extract one from
    // provided element.
    return ownerGlobal || global$1;
  };

  // Placeholder of an empty content rectangle.
  var emptyRect = createRectInit(0, 0, 0, 0);

  /**
   * Converts provided string to a number.
   *
   * @param {number|string} value
   * @returns {number}
   */
  function toFloat(value) {
    return parseFloat(value) || 0;
  }

  /**
   * Extracts borders size from provided styles.
   *
   * @param {CSSStyleDeclaration} styles
   * @param {...string} positions - Borders positions (top, right, ...)
   * @returns {number}
   */
  function getBordersSize(styles) {
    var positions = [],
        len = arguments.length - 1;
    while (len-- > 0) {
      positions[len] = arguments[len + 1];
    }return positions.reduce(function (size, position) {
      var value = styles['border-' + position + '-width'];

      return size + toFloat(value);
    }, 0);
  }

  /**
   * Extracts paddings sizes from provided styles.
   *
   * @param {CSSStyleDeclaration} styles
   * @returns {Object} Paddings box.
   */
  function getPaddings(styles) {
    var positions = ['top', 'right', 'bottom', 'left'];
    var paddings = {};

    for (var i = 0, list = positions; i < list.length; i += 1) {
      var position = list[i];

      var value = styles['padding-' + position];

      paddings[position] = toFloat(value);
    }

    return paddings;
  }

  /**
   * Calculates content rectangle of provided SVG element.
   *
   * @param {SVGGraphicsElement} target - Element content rectangle of which needs
   *      to be calculated.
   * @returns {DOMRectInit}
   */
  function getSVGContentRect(target) {
    var bbox = target.getBBox();

    return createRectInit(0, 0, bbox.width, bbox.height);
  }

  /**
   * Calculates content rectangle of provided HTMLElement.
   *
   * @param {HTMLElement} target - Element for which to calculate the content rectangle.
   * @returns {DOMRectInit}
   */
  function getHTMLElementContentRect(target) {
    // Client width & height properties can't be
    // used exclusively as they provide rounded values.
    var clientWidth = target.clientWidth;
    var clientHeight = target.clientHeight;

    // By this condition we can catch all non-replaced inline, hidden and
    // detached elements. Though elements with width & height properties less
    // than 0.5 will be discarded as well.
    //
    // Without it we would need to implement separate methods for each of
    // those cases and it's not possible to perform a precise and performance
    // effective test for hidden elements. E.g. even jQuery's ':visible' filter
    // gives wrong results for elements with width & height less than 0.5.
    if (!clientWidth && !clientHeight) {
      return emptyRect;
    }

    var styles = getWindowOf(target).getComputedStyle(target);
    var paddings = getPaddings(styles);
    var horizPad = paddings.left + paddings.right;
    var vertPad = paddings.top + paddings.bottom;

    // Computed styles of width & height are being used because they are the
    // only dimensions available to JS that contain non-rounded values. It could
    // be possible to utilize the getBoundingClientRect if only it's data wasn't
    // affected by CSS transformations let alone paddings, borders and scroll bars.
    var width = toFloat(styles.width),
        height = toFloat(styles.height);

    // Width & height include paddings and borders when the 'border-box' box
    // model is applied (except for IE).
    if (styles.boxSizing === 'border-box') {
      // Following conditions are required to handle Internet Explorer which
      // doesn't include paddings and borders to computed CSS dimensions.
      //
      // We can say that if CSS dimensions + paddings are equal to the "client"
      // properties then it's either IE, and thus we don't need to subtract
      // anything, or an element merely doesn't have paddings/borders styles.
      if (Math.round(width + horizPad) !== clientWidth) {
        width -= getBordersSize(styles, 'left', 'right') + horizPad;
      }

      if (Math.round(height + vertPad) !== clientHeight) {
        height -= getBordersSize(styles, 'top', 'bottom') + vertPad;
      }
    }

    // Following steps can't be applied to the document's root element as its
    // client[Width/Height] properties represent viewport area of the window.
    // Besides, it's as well not necessary as the <html> itself neither has
    // rendered scroll bars nor it can be clipped.
    if (!isDocumentElement(target)) {
      // In some browsers (only in Firefox, actually) CSS width & height
      // include scroll bars size which can be removed at this step as scroll
      // bars are the only difference between rounded dimensions + paddings
      // and "client" properties, though that is not always true in Chrome.
      var vertScrollbar = Math.round(width + horizPad) - clientWidth;
      var horizScrollbar = Math.round(height + vertPad) - clientHeight;

      // Chrome has a rather weird rounding of "client" properties.
      // E.g. for an element with content width of 314.2px it sometimes gives
      // the client width of 315px and for the width of 314.7px it may give
      // 314px. And it doesn't happen all the time. So just ignore this delta
      // as a non-relevant.
      if (Math.abs(vertScrollbar) !== 1) {
        width -= vertScrollbar;
      }

      if (Math.abs(horizScrollbar) !== 1) {
        height -= horizScrollbar;
      }
    }

    return createRectInit(paddings.left, paddings.top, width, height);
  }

  /**
   * Checks whether provided element is an instance of the SVGGraphicsElement.
   *
   * @param {Element} target - Element to be checked.
   * @returns {boolean}
   */
  var isSVGGraphicsElement = function () {
    // Some browsers, namely IE and Edge, don't have the SVGGraphicsElement
    // interface.
    if (typeof SVGGraphicsElement !== 'undefined') {
      return function (target) {
        return target instanceof getWindowOf(target).SVGGraphicsElement;
      };
    }

    // If it's so, then check that element is at least an instance of the
    // SVGElement and that it has the "getBBox" method.
    // eslint-disable-next-line no-extra-parens
    return function (target) {
      return target instanceof getWindowOf(target).SVGElement && typeof target.getBBox === 'function';
    };
  }();

  /**
   * Checks whether provided element is a document element (<html>).
   *
   * @param {Element} target - Element to be checked.
   * @returns {boolean}
   */
  function isDocumentElement(target) {
    return target === getWindowOf(target).document.documentElement;
  }

  /**
   * Calculates an appropriate content rectangle for provided html or svg element.
   *
   * @param {Element} target - Element content rectangle of which needs to be calculated.
   * @returns {DOMRectInit}
   */
  function getContentRect(target) {
    if (!isBrowser) {
      return emptyRect;
    }

    if (isSVGGraphicsElement(target)) {
      return getSVGContentRect(target);
    }

    return getHTMLElementContentRect(target);
  }

  /**
   * Creates rectangle with an interface of the DOMRectReadOnly.
   * Spec: https://drafts.fxtf.org/geometry/#domrectreadonly
   *
   * @param {DOMRectInit} rectInit - Object with rectangle's x/y coordinates and dimensions.
   * @returns {DOMRectReadOnly}
   */
  function createReadOnlyRect(ref) {
    var x = ref.x;
    var y = ref.y;
    var width = ref.width;
    var height = ref.height;

    // If DOMRectReadOnly is available use it as a prototype for the rectangle.
    var Constr = typeof DOMRectReadOnly !== 'undefined' ? DOMRectReadOnly : Object;
    var rect = Object.create(Constr.prototype);

    // Rectangle's properties are not writable and non-enumerable.
    defineConfigurable(rect, {
      x: x, y: y, width: width, height: height,
      top: y,
      right: x + width,
      bottom: height + y,
      left: x
    });

    return rect;
  }

  /**
   * Creates DOMRectInit object based on the provided dimensions and the x/y coordinates.
   * Spec: https://drafts.fxtf.org/geometry/#dictdef-domrectinit
   *
   * @param {number} x - X coordinate.
   * @param {number} y - Y coordinate.
   * @param {number} width - Rectangle's width.
   * @param {number} height - Rectangle's height.
   * @returns {DOMRectInit}
   */
  function createRectInit(x, y, width, height) {
    return { x: x, y: y, width: width, height: height };
  }

  /**
   * Class that is responsible for computations of the content rectangle of
   * provided DOM element and for keeping track of it's changes.
   */
  var ResizeObservation = function ResizeObservation(target) {
    this.broadcastWidth = 0;
    this.broadcastHeight = 0;
    this.contentRect_ = createRectInit(0, 0, 0, 0);

    this.target = target;
  };

  /**
   * Updates content rectangle and tells whether it's width or height properties
   * have changed since the last broadcast.
   *
   * @returns {boolean}
   */

  /**
   * Reference to the last observed content rectangle.
   *
   * @private {DOMRectInit}
   */

  /**
   * Broadcasted width of content rectangle.
   *
   * @type {number}
   */
  ResizeObservation.prototype.isActive = function () {
    var rect = getContentRect(this.target);

    this.contentRect_ = rect;

    return rect.width !== this.broadcastWidth || rect.height !== this.broadcastHeight;
  };

  /**
   * Updates 'broadcastWidth' and 'broadcastHeight' properties with a data
   * from the corresponding properties of the last observed content rectangle.
   *
   * @returns {DOMRectInit} Last observed content rectangle.
   */
  ResizeObservation.prototype.broadcastRect = function () {
    var rect = this.contentRect_;

    this.broadcastWidth = rect.width;
    this.broadcastHeight = rect.height;

    return rect;
  };

  var ResizeObserverEntry = function ResizeObserverEntry(target, rectInit) {
    var contentRect = createReadOnlyRect(rectInit);

    // According to the specification following properties are not writable
    // and are also not enumerable in the native implementation.
    //
    // Property accessors are not being used as they'd require to define a
    // private WeakMap storage which may cause memory leaks in browsers that
    // don't support this type of collections.
    defineConfigurable(this, { target: target, contentRect: contentRect });
  };

  var ResizeObserverSPI = function ResizeObserverSPI(callback, controller, callbackCtx) {
    this.activeObservations_ = [];
    this.observations_ = new MapShim();

    if (typeof callback !== 'function') {
      throw new TypeError('The callback provided as parameter 1 is not a function.');
    }

    this.callback_ = callback;
    this.controller_ = controller;
    this.callbackCtx_ = callbackCtx;
  };

  /**
   * Starts observing provided element.
   *
   * @param {Element} target - Element to be observed.
   * @returns {void}
   */

  /**
   * Registry of the ResizeObservation instances.
   *
   * @private {Map<Element, ResizeObservation>}
   */

  /**
   * Public ResizeObserver instance which will be passed to the callback
   * function and used as a value of it's "this" binding.
   *
   * @private {ResizeObserver}
   */

  /**
   * Collection of resize observations that have detected changes in dimensions
   * of elements.
   *
   * @private {Array<ResizeObservation>}
   */
  ResizeObserverSPI.prototype.observe = function (target) {
    if (!arguments.length) {
      throw new TypeError('1 argument required, but only 0 present.');
    }

    // Do nothing if current environment doesn't have the Element interface.
    if (typeof Element === 'undefined' || !(Element instanceof Object)) {
      return;
    }

    if (!(target instanceof getWindowOf(target).Element)) {
      throw new TypeError('parameter 1 is not of type "Element".');
    }

    var observations = this.observations_;

    // Do nothing if element is already being observed.
    if (observations.has(target)) {
      return;
    }

    observations.set(target, new ResizeObservation(target));

    this.controller_.addObserver(this);

    // Force the update of observations.
    this.controller_.refresh();
  };

  /**
   * Stops observing provided element.
   *
   * @param {Element} target - Element to stop observing.
   * @returns {void}
   */
  ResizeObserverSPI.prototype.unobserve = function (target) {
    if (!arguments.length) {
      throw new TypeError('1 argument required, but only 0 present.');
    }

    // Do nothing if current environment doesn't have the Element interface.
    if (typeof Element === 'undefined' || !(Element instanceof Object)) {
      return;
    }

    if (!(target instanceof getWindowOf(target).Element)) {
      throw new TypeError('parameter 1 is not of type "Element".');
    }

    var observations = this.observations_;

    // Do nothing if element is not being observed.
    if (!observations.has(target)) {
      return;
    }

    observations['delete'](target);

    if (!observations.size) {
      this.controller_.removeObserver(this);
    }
  };

  /**
   * Stops observing all elements.
   *
   * @returns {void}
   */
  ResizeObserverSPI.prototype.disconnect = function () {
    this.clearActive();
    this.observations_.clear();
    this.controller_.removeObserver(this);
  };

  /**
   * Collects observation instances the associated element of which has changed
   * it's content rectangle.
   *
   * @returns {void}
   */
  ResizeObserverSPI.prototype.gatherActive = function () {
    var this$1 = this;

    this.clearActive();

    this.observations_.forEach(function (observation) {
      if (observation.isActive()) {
        this$1.activeObservations_.push(observation);
      }
    });
  };

  /**
   * Invokes initial callback function with a list of ResizeObserverEntry
   * instances collected from active resize observations.
   *
   * @returns {void}
   */
  ResizeObserverSPI.prototype.broadcastActive = function () {
    // Do nothing if observer doesn't have active observations.
    if (!this.hasActive()) {
      return;
    }

    var ctx = this.callbackCtx_;

    // Create ResizeObserverEntry instance for every active observation.
    var entries = this.activeObservations_.map(function (observation) {
      return new ResizeObserverEntry(observation.target, observation.broadcastRect());
    });

    this.callback_.call(ctx, entries, ctx);
    this.clearActive();
  };

  /**
   * Clears the collection of active observations.
   *
   * @returns {void}
   */
  ResizeObserverSPI.prototype.clearActive = function () {
    this.activeObservations_.splice(0);
  };

  /**
   * Tells whether observer has active observations.
   *
   * @returns {boolean}
   */
  ResizeObserverSPI.prototype.hasActive = function () {
    return this.activeObservations_.length > 0;
  };

  // Registry of internal observers. If WeakMap is not available use current shim
  // for the Map collection as it has all required methods and because WeakMap
  // can't be fully polyfilled anyway.
  var observers = typeof WeakMap !== 'undefined' ? new WeakMap() : new MapShim();

  /**
   * ResizeObserver API. Encapsulates the ResizeObserver SPI implementation
   * exposing only those methods and properties that are defined in the spec.
   */
  var ResizeObserver = function ResizeObserver(callback) {
    if (!(this instanceof ResizeObserver)) {
      throw new TypeError('Cannot call a class as a function.');
    }
    if (!arguments.length) {
      throw new TypeError('1 argument required, but only 0 present.');
    }

    var controller = ResizeObserverController.getInstance();
    var observer = new ResizeObserverSPI(callback, controller, this);

    observers.set(this, observer);
  };

  // Expose public methods of ResizeObserver.
  ['observe', 'unobserve', 'disconnect'].forEach(function (method) {
    ResizeObserver.prototype[method] = function () {
      return (ref = observers.get(this))[method].apply(ref, arguments);
      var ref;
    };
  });

  var index = function () {
    // Export existing implementation if available.
    if (typeof global$1.ResizeObserver !== 'undefined') {
      return global$1.ResizeObserver;
    }

    return ResizeObserver;
  }();

  var SimpleBar =
  /*#__PURE__*/
  function () {
    function SimpleBar(element, options) {
      _classCallCheck(this, SimpleBar);

      this.el = element;
      this.flashTimeout;
      this.contentEl;
      this.scrollContentEl;
      this.dragOffset = {
        x: 0,
        y: 0
      };
      this.isVisible = {
        x: true,
        y: true
      };
      this.scrollOffsetAttr = {
        x: 'scrollLeft',
        y: 'scrollTop'
      };
      this.sizeAttr = {
        x: 'offsetWidth',
        y: 'offsetHeight'
      };
      this.scrollSizeAttr = {
        x: 'scrollWidth',
        y: 'scrollHeight'
      };
      this.offsetAttr = {
        x: 'left',
        y: 'top'
      };
      this.globalObserver;
      this.mutationObserver;
      this.resizeObserver;
      this.currentAxis;
      this.isRtl;
      this.options = _extends({}, SimpleBar.defaultOptions, options);
      this.classNames = this.options.classNames;
      this.scrollbarWidth = scrollbarWidth();
      this.offsetSize = 20;
      this.flashScrollbar = this.flashScrollbar.bind(this);
      this.onDragY = this.onDragY.bind(this);
      this.onDragX = this.onDragX.bind(this);
      this.onScrollY = this.onScrollY.bind(this);
      this.onScrollX = this.onScrollX.bind(this);
      this.drag = this.drag.bind(this);
      this.onEndDrag = this.onEndDrag.bind(this);
      this.onMouseEnter = this.onMouseEnter.bind(this);
      this.recalculate = lodash_debounce(this.recalculate, 100, {
        leading: true
      });
      this.init();
    }

    _createClass(SimpleBar, [{
      key: "init",
      value: function init() {
        // Save a reference to the instance, so we know this DOM node has already been instancied
        this.el.SimpleBar = this;
        this.initDOM();
        this.scrollbarX = this.trackX.querySelector(".".concat(this.classNames.scrollbar));
        this.scrollbarY = this.trackY.querySelector(".".concat(this.classNames.scrollbar));
        this.isRtl = getComputedStyle(this.contentEl).direction === 'rtl';
        this.scrollContentEl.style[this.isRtl ? 'paddingLeft' : 'paddingRight'] = "".concat(this.scrollbarWidth || this.offsetSize, "px");
        this.scrollContentEl.style.marginBottom = "-".concat(this.scrollbarWidth * 2 || this.offsetSize, "px");
        this.contentEl.style.paddingBottom = "".concat(this.scrollbarWidth || this.offsetSize, "px");

        if (this.scrollbarWidth !== 0) {
          this.contentEl.style[this.isRtl ? 'marginLeft' : 'marginRight'] = "-".concat(this.scrollbarWidth, "px");
        } // Calculate content size


        this.recalculate();
        this.initListeners();
      }
    }, {
      key: "initDOM",
      value: function initDOM() {
        var _this = this;

        // make sure this element doesn't have the elements yet
        if (Array.from(this.el.children).filter(function (child) {
          return child.classList.contains(_this.classNames.scrollContent);
        }).length) {
          // assume that element has his DOM already initiated
          this.trackX = this.el.querySelector(".".concat(this.classNames.track, ".horizontal"));
          this.trackY = this.el.querySelector(".".concat(this.classNames.track, ".vertical"));
          this.scrollContentEl = this.el.querySelector(".".concat(this.classNames.scrollContent));
          this.contentEl = this.el.querySelector(".".concat(this.classNames.content));
        } else {
          // Prepare DOM
          this.scrollContentEl = document.createElement('div');
          this.contentEl = document.createElement('div');
          this.scrollContentEl.classList.add(this.classNames.scrollContent);
          this.contentEl.classList.add(this.classNames.content);

          while (this.el.firstChild) {
            this.contentEl.appendChild(this.el.firstChild);
          }

          this.scrollContentEl.appendChild(this.contentEl);
          this.el.appendChild(this.scrollContentEl);
        }

        if (!this.trackX || !this.trackY) {
          var track = document.createElement('div');
          var scrollbar = document.createElement('div');
          track.classList.add(this.classNames.track);
          scrollbar.classList.add(this.classNames.scrollbar);
          track.appendChild(scrollbar);
          this.trackX = track.cloneNode(true);
          this.trackX.classList.add('horizontal');
          this.trackY = track.cloneNode(true);
          this.trackY.classList.add('vertical');
          this.el.insertBefore(this.trackX, this.el.firstChild);
          this.el.insertBefore(this.trackY, this.el.firstChild);
        }

        this.el.setAttribute('data-simplebar', 'init');
      }
    }, {
      key: "initListeners",
      value: function initListeners() {
        var _this2 = this;

        // Event listeners
        if (this.options.autoHide) {
          this.el.addEventListener('mouseenter', this.onMouseEnter);
        }

        this.scrollbarY.addEventListener('mousedown', this.onDragY);
        this.scrollbarX.addEventListener('mousedown', this.onDragX);
        this.scrollContentEl.addEventListener('scroll', this.onScrollY);
        this.contentEl.addEventListener('scroll', this.onScrollX); // MutationObserver is IE11+

        if (typeof MutationObserver !== 'undefined') {
          // create an observer instance
          this.mutationObserver = new MutationObserver(function (mutations) {
            mutations.forEach(function (mutation) {
              if (_this2.isChildNode(mutation.target) || mutation.addedNodes.length) {
                _this2.recalculate();
              }
            });
          }); // pass in the target node, as well as the observer options

          this.mutationObserver.observe(this.el, {
            attributes: true,
            childList: true,
            characterData: true,
            subtree: true
          });
        }

        this.resizeObserver = new index(this.recalculate.bind(this));
        this.resizeObserver.observe(this.el);
      }
    }, {
      key: "removeListeners",
      value: function removeListeners() {
        // Event listeners
        if (this.options.autoHide) {
          this.el.removeEventListener('mouseenter', this.onMouseEnter);
        }

        this.scrollbarX.removeEventListener('mousedown', this.onDragX);
        this.scrollbarY.removeEventListener('mousedown', this.onDragY);
        this.scrollContentEl.removeEventListener('scroll', this.onScrollY);
        this.contentEl.removeEventListener('scroll', this.onScrollX);
        this.mutationObserver.disconnect();
        this.resizeObserver.disconnect();
      }
    }, {
      key: "onDragX",
      value: function onDragX(e) {
        this.onDrag(e, 'x');
      }
    }, {
      key: "onDragY",
      value: function onDragY(e) {
        this.onDrag(e, 'y');
      }
      /**
       * on scrollbar handle drag
       */

    }, {
      key: "onDrag",
      value: function onDrag(e) {
        var axis = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'y';
        // Preventing the event's default action stops text being
        // selectable during the drag.
        e.preventDefault();
        var scrollbar = axis === 'y' ? this.scrollbarY : this.scrollbarX; // Measure how far the user's mouse is from the top of the scrollbar drag handle.

        var eventOffset = axis === 'y' ? e.pageY : e.pageX;
        this.dragOffset[axis] = eventOffset - scrollbar.getBoundingClientRect()[this.offsetAttr[axis]];
        this.currentAxis = axis;
        document.addEventListener('mousemove', this.drag);
        document.addEventListener('mouseup', this.onEndDrag);
      }
      /**
       * Drag scrollbar handle
       */

    }, {
      key: "drag",
      value: function drag(e) {
        var eventOffset, track, scrollEl;
        e.preventDefault();

        if (this.currentAxis === 'y') {
          eventOffset = e.pageY;
          track = this.trackY;
          scrollEl = this.scrollContentEl;
        } else {
          eventOffset = e.pageX;
          track = this.trackX;
          scrollEl = this.contentEl;
        } // Calculate how far the user's mouse is from the top/left of the scrollbar (minus the dragOffset).


        var dragPos = eventOffset - track.getBoundingClientRect()[this.offsetAttr[this.currentAxis]] - this.dragOffset[this.currentAxis]; // Convert the mouse position into a percentage of the scrollbar height/width.

        var dragPerc = dragPos / track[this.sizeAttr[this.currentAxis]]; // Scroll the content by the same percentage.

        var scrollPos = dragPerc * this.contentEl[this.scrollSizeAttr[this.currentAxis]];
        scrollEl[this.scrollOffsetAttr[this.currentAxis]] = scrollPos;
      }
      /**
       * End scroll handle drag
       */

    }, {
      key: "onEndDrag",
      value: function onEndDrag() {
        document.removeEventListener('mousemove', this.drag);
        document.removeEventListener('mouseup', this.onEndDrag);
      }
      /**
       * Resize scrollbar
       */

    }, {
      key: "resizeScrollbar",
      value: function resizeScrollbar() {
        var axis = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'y';
        var track;
        var scrollbar;
        var scrollOffset;
        var contentSize;
        var scrollbarSize;

        if (axis === 'x') {
          track = this.trackX;
          scrollbar = this.scrollbarX;
          scrollOffset = this.contentEl[this.scrollOffsetAttr[axis]]; // Either scrollTop() or scrollLeft().

          contentSize = this.contentSizeX;
          scrollbarSize = this.scrollbarXSize;
        } else {
          // 'y'
          track = this.trackY;
          scrollbar = this.scrollbarY;
          scrollOffset = this.scrollContentEl[this.scrollOffsetAttr[axis]]; // Either scrollTop() or scrollLeft().

          contentSize = this.contentSizeY;
          scrollbarSize = this.scrollbarYSize;
        }

        var scrollbarRatio = scrollbarSize / contentSize;
        var scrollPourcent = scrollOffset / (contentSize - scrollbarSize); // Calculate new height/position of drag handle.

        var handleSize = Math.max(~~(scrollbarRatio * scrollbarSize), this.options.scrollbarMinSize);
        var handleOffset = ~~((scrollbarSize - handleSize) * scrollPourcent); // Set isVisible to false if scrollbar is not necessary (content is shorter than wrapper)

        this.isVisible[axis] = scrollbarSize < contentSize;

        if (this.isVisible[axis]) {
          track.style.visibility = 'visible';

          if (axis === 'x') {
            scrollbar.style.left = "".concat(handleOffset, "px");
            scrollbar.style.width = "".concat(handleSize, "px");
          } else {
            scrollbar.style.top = "".concat(handleOffset, "px");
            scrollbar.style.height = "".concat(handleSize, "px");
          }
        } else {
          track.style.visibility = 'hidden';
        }
      }
      /**
       * On scroll event handling
       */

    }, {
      key: "onScrollX",
      value: function onScrollX() {
        this.flashScrollbar('x');
      }
    }, {
      key: "onScrollY",
      value: function onScrollY() {
        this.flashScrollbar('y');
      }
      /**
       * On mouseenter event handling
       */

    }, {
      key: "onMouseEnter",
      value: function onMouseEnter() {
        this.flashScrollbar('x');
        this.flashScrollbar('y');
      }
      /**
       * Flash scrollbar visibility
       */

    }, {
      key: "flashScrollbar",
      value: function flashScrollbar() {
        var axis = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'y';
        this.resizeScrollbar(axis);
        this.showScrollbar(axis);
      }
      /**
       * Show scrollbar
       */

    }, {
      key: "showScrollbar",
      value: function showScrollbar() {
        var axis = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'y';

        if (!this.isVisible[axis]) {
          return;
        }

        if (axis === 'x') {
          this.scrollbarX.classList.add('visible');
        } else {
          this.scrollbarY.classList.add('visible');
        }

        if (!this.options.autoHide) {
          return;
        }

        if (typeof this.flashTimeout === 'number') {
          window.clearTimeout(this.flashTimeout);
        }

        this.flashTimeout = window.setTimeout(this.hideScrollbar.bind(this), 1000);
      }
      /**
       * Hide Scrollbar
       */

    }, {
      key: "hideScrollbar",
      value: function hideScrollbar() {
        this.scrollbarX.classList.remove('visible');
        this.scrollbarY.classList.remove('visible');

        if (typeof this.flashTimeout === 'number') {
          window.clearTimeout(this.flashTimeout);
        }
      }
      /**
       * Recalculate scrollbar
       */

    }, {
      key: "recalculate",
      value: function recalculate() {
        this.contentSizeX = this.contentEl[this.scrollSizeAttr['x']];
        this.contentSizeY = this.contentEl[this.scrollSizeAttr['y']] - (this.scrollbarWidth || this.offsetSize);
        this.scrollbarXSize = this.trackX[this.sizeAttr['x']];
        this.scrollbarYSize = this.trackY[this.sizeAttr['y']];
        this.resizeScrollbar('x');
        this.resizeScrollbar('y');

        if (!this.options.autoHide) {
          this.showScrollbar('x');
          this.showScrollbar('y');
        }
      }
      /**
       * Getter for original scrolling element
       */

    }, {
      key: "getScrollElement",
      value: function getScrollElement() {
        var axis = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'y';
        return axis === 'y' ? this.scrollContentEl : this.contentEl;
      }
      /**
       * Getter for content element
       */

    }, {
      key: "getContentElement",
      value: function getContentElement() {
        return this.contentEl;
      }
      /**
       * UnMount mutation observer and delete SimpleBar instance from DOM element
       */

    }, {
      key: "unMount",
      value: function unMount() {
        this.removeListeners();
        this.el.SimpleBar = null;
      }
      /**
       * Recursively walks up the parent nodes looking for this.el
       */

    }, {
      key: "isChildNode",
      value: function isChildNode(el) {
        if (el === null) return false;
        if (el === this.el) return true;
        return this.isChildNode(el.parentNode);
      }
    }], [{
      key: "initHtmlApi",
      value: function initHtmlApi() {
        this.initDOMLoadedElements = this.initDOMLoadedElements.bind(this); // MutationObserver is IE11+

        if (typeof MutationObserver !== 'undefined') {
          // Mutation observer to observe dynamically added elements
          this.globalObserver = new MutationObserver(function (mutations) {
            mutations.forEach(function (mutation) {
              Array.from(mutation.addedNodes).forEach(function (addedNode) {
                if (addedNode.nodeType === 1) {
                  if (addedNode.hasAttribute('data-simplebar')) {
                    !addedNode.SimpleBar && new SimpleBar(addedNode, SimpleBar.getElOptions(addedNode));
                  } else {
                    Array.from(addedNode.querySelectorAll('[data-simplebar]')).forEach(function (el) {
                      !el.SimpleBar && new SimpleBar(el, SimpleBar.getElOptions(el));
                    });
                  }
                }
              });
              Array.from(mutation.removedNodes).forEach(function (removedNode) {
                if (removedNode.nodeType === 1) {
                  if (removedNode.hasAttribute('data-simplebar')) {
                    removedNode.SimpleBar && removedNode.SimpleBar.unMount();
                  } else {
                    Array.from(removedNode.querySelectorAll('[data-simplebar]')).forEach(function (el) {
                      el.SimpleBar && el.SimpleBar.unMount();
                    });
                  }
                }
              });
            });
          });
          this.globalObserver.observe(document, {
            childList: true,
            subtree: true
          });
        } // Taken from jQuery `ready` function
        // Instantiate elements already present on the page


        if (document.readyState === 'complete' || document.readyState !== 'loading' && !document.documentElement.doScroll) {
          // Handle it asynchronously to allow scripts the opportunity to delay init
          window.setTimeout(this.initDOMLoadedElements.bind(this));
        } else {
          document.addEventListener('DOMContentLoaded', this.initDOMLoadedElements);
          window.addEventListener('load', this.initDOMLoadedElements);
        }
      } // Helper function to retrieve options from element attributes

    }, {
      key: "getElOptions",
      value: function getElOptions(el) {
        var options = Object.keys(SimpleBar.htmlAttributes).reduce(function (acc, obj) {
          var attribute = SimpleBar.htmlAttributes[obj];

          if (el.hasAttribute(attribute)) {
            acc[obj] = JSON.parse(el.getAttribute(attribute) || true);
          }

          return acc;
        }, {});
        return options;
      }
    }, {
      key: "removeObserver",
      value: function removeObserver() {
        this.globalObserver.disconnect();
      }
    }, {
      key: "initDOMLoadedElements",
      value: function initDOMLoadedElements() {
        document.removeEventListener('DOMContentLoaded', this.initDOMLoadedElements);
        window.removeEventListener('load', this.initDOMLoadedElements);
        Array.from(document.querySelectorAll('[data-simplebar]')).forEach(function (el) {
          if (!el.SimpleBar) new SimpleBar(el, SimpleBar.getElOptions(el));
        });
      }
    }, {
      key: "defaultOptions",
      get: function get() {
        return {
          autoHide: true,
          classNames: {
            content: 'simplebar-content',
            scrollContent: 'simplebar-scroll-content',
            scrollbar: 'simplebar-scrollbar',
            track: 'simplebar-track'
          },
          scrollbarMinSize: 25
        };
      }
    }, {
      key: "htmlAttributes",
      get: function get() {
        return {
          autoHide: 'data-simplebar-auto-hide',
          scrollbarMinSize: 'data-simplebar-scrollbar-min-size'
        };
      }
    }]);

    return SimpleBar;
  }();
  SimpleBar.initHtmlApi();

  return SimpleBar;
});
//# sourceMappingURL=simplebar.umd.es5.js.map

function tooltipPosition() {
	$('.js-st-tooltip').mouseenter(function(event) {
		var $target = $(this);
		var position = $target.offset();
		var left = position.left;
		var windowWidth = $('body').outerWidth();
		var right = windowWidth - left;
        var contentWidth = $target.outerWidth();
		var contentRight = windowWidth - position.left - contentWidth;

		if ($target.is('[data-tooltip-custom-content]')) {
            tooltipReset();

            var $customContent = $target.find('.st-tooltip--content');

            if (contentRight > 299) {
                $customContent.css('left', contentWidth + 20 + 'px');
            } else {
                $customContent.css('left', (contentWidth - (300 - contentRight + 20)) + 'px');
            }
        } else if (right > 240) {
			tooltipReset();
			$target.addClass('st-tooltip--right');
		}
		else if (right < 240 && left > 240) {
			tooltipReset();
			$target.addClass('st-tooltip--left');
		}
		else {
			if (right < left) {
				tooltipReset();
				$target.addClass('st-tooltip--center-left');
			}
			else if (left < right) {
				tooltipReset();
				$target.addClass('st-tooltip--center-right');
			}
			else {
				tooltipReset();
				$target.addClass('st-tooltip--center');
			}
		}

		function tooltipReset() {
			$target.removeClass('st-tooltip--right','st-tooltip--left','st-tooltip--center', 'st-tooltip--center-left', 'st-tooltip--center-right');
		}
	});

}

tooltipPosition();

// Escluded because of ticket https://jira-st.stormreply.com/jira/browse/CXST-1335

// function productStageError() {
//     $(".js-st-product-folder-error").click(function (e) {
//         e.preventDefault();

//     });
//     $(".js-st-product-folder-error-dropdown").click(function (e) {
//         e.preventDefault();
//     });

//     $(".js-st-product-folder-error").on('click mouseover', function () {
//         var button = $(this);
//         button.addClass('st-button--error');
//         button.attr('data-toggle', 'null');
//         $(".js-st-modal-table").css('outline', '2px solid #ff0060');
//     });
//     $(".js-st-product-folder-error").on('mouseleave', function () {
//         var button = $(this);
//         button.removeClass('st-button--error');
//         button.attr('data-toggle', 'modal');
//         $(".js-st-modal-table").css('outline', 'none');
//     });

//     $(".js-st-product-folder-error-dropdown").on('click mouseover', function () {
//         var button = $(this);
//         button.addClass('st-button--error');
//         $(".js-st-modal-table").css('outline', '2px solid #ff0060');
//         return false;
//     });
//     $(".js-st-product-folder-error-dropdown").on('mouseleave', function () {
//         var button = $(this);
//         button.removeClass('st-button--error');
//         $(".js-st-modal-table").css('outline', 'none');
//     });
// }

// productStageError();

// function modalPosition() {
//     var posTop = $(".js-st-modal-table").offset().top;
//     var posWindow = $(window).scrollTop();
//     var padTop = parseInt($(".modal-content").css("padding-top"));

//     if (parseInt(window.innerWidth) <= 640) {
//         var posSet = 0;
//     }
//     else {
//         var posSet = posTop - posWindow - padTop;
//     }

//     if (parseInt(window.innerWidth) <= 1024) {
//         $(".st-modal-table > .modal-dialog").css('margin-top', 0);
//     }
//     else {
//         $(".st-modal-table > .modal-dialog").css('margin-top', posSet);
//     }
// }


// function productTable() {
//     productTableSetHeightModal();
//     productTableUpdate();
//     productTableHover();
//     productTableSticky();
//     productTableSetArrow();
//     productTableModalClose();
//     scrollTable('modal');
// }

// function productTableSetHeightModal() {
//     // add 15px for horizontal scrollbar
//     var myHeight = $(".modal .js-st-product-table").height();
//     $(".modal .js-st-product-table-outer").css('height', myHeight);
//     $(".modal .js-st-product-table-wrapper").css('height', myHeight + 16);
// }

// function productTableSetHeight() {
//     // add 15px for horizontal scrollbar
//     var myHeight = $(".js-st-product-table").height();
//     $(".js-st-product-table-outer").css('height', myHeight);
//     $(".js-st-product-table-wrapper").css('height', myHeight + 16);
// }

// function productTableUpdate() {
//     // show hidden table row on modal open
//     $(".js-st-product-table-wrapper:not(.st-table-product-folder-wrapper--selected) .js-st-product-table tr").removeClass('hidden');
//     //remove class from summary to show all buttons again
//     $('.js-st-stage-product__summary').removeClass('st-stage-product__summary--selected');
//     productTableSetHeightModal();

//     //set value to summary box
//     var outputPrice = $(".st-stage-product__price");
//     var currentPrice = outputPrice.html();
//     var sample = $(".st-stage-product__sample");
//     var sampleBtn = $(".st-stage-product__sample a");
//     var order = $(".st-stage-product__order");
//     var orderBtn = $(".st-stage-product__order a");
//     var buy = $(".st-stage-product__buy");
//     var buyBtn = $(".st-stage-product__buy a");

//     var price = $(".st-stage-product__price");
//     var priceInfo = $(".js-st-stage-product__info");
//     var priceInfoBuy = $(".js-st-stage-product__buy");
//     var message = $(".st-stage-product__message");

//     if (parseInt(window.innerWidth) > 640) {
//         if ($('.st-stage-product__buy a').hasClass("st-button--disabled") || $('.st-stage-product__buy').hasClass("hidden")) {
//             var currentDataBuy = undefined;
//         } else {
//             var currentDataBuy = true;
//         }

//         if ($('.st-stage-product__order a').hasClass("st-button--disabled") || $('.st-stage-product__order').hasClass("hidden")) {
//             var currentDataOrder = undefined;
//         } else {
//             var currentDataOrder = true;
//         }

//         if ($('.st-stage-product__sample a').hasClass("st-button--disabled") || $('.st-stage-product__sample').hasClass("hidden")) {
//             var currentDataSample = undefined;
//         } else {
//             var currentDataSample = true;
//         }
//     }


// 	$(".js-st-product-table tr:not(:first)").hover(function () {
// 		var row = $(this);
// 		var dataPrice = $(this).data("product-price");
// 		var dataSample = $(this).data("product-sample");
// 		var dataOrder = $(this).data("product-order");
// 		var dataBuy = $(this).data("product-buy");

// 		if (dataPrice) {
// 			price.html("$" + dataPrice);
// 		}
// 		else {
// 			price.html(currentPrice);
// 		}
//         STFED.productFolderHeaderTable.updateButtons(dataOrder, dataSample, dataBuy, message, sample, order, buy, priceInfoBuy, priceInfo, sampleBtn, orderBtn, buyBtn);

//     }, function () {
//         if (parseInt(window.innerWidth) > 640) {
//             $(".st-stage-product__price").html(currentPrice);
//             STFED.productFolderHeaderTable.updateButtons(currentDataOrder, currentDataSample, currentDataBuy, message, sample, order, buy, priceInfoBuy, priceInfo, sampleBtn, orderBtn, buyBtn);
//         }
//     });


//     //handle close
//     $(".modal .js-st-product-table tr:not(:first)").on("click", function (event) {
//         if (parseInt(window.innerWidth) > 640) {
//             triggerProductTable(this);
//         }
//     });

//     $(".modal .js-st-product-table tr:not(:first)").on("click touchstart tap", function (event) {
//         if (parseInt(window.innerWidth) <= 640) {
//             triggerProductTable(this);
//         }
//     });


//     function triggerProductTable(trigger) {
//         var dataPID = $(trigger).data("pid");
//         var dataINAME = $(trigger).data("iname");

//         if (dataPID) {
//             orderBtn.attr("data-pid", dataPID);
//             buyBtn.attr("data-pid", dataPID);
//         }
//         else {
//             orderBtn.attr("data-pid", "");
//             buyBtn.attr("data-pid", "");
//         }

//         if (dataINAME) {
//             sampleBtn.attr("data-iname", dataINAME);
//             sampleBtn.attr("href", sampleBtn.attr("data-href-prefix") + dataINAME);
//             orderBtn.attr("data-iname", dataINAME);
//             buyBtn.attr("data-iname", dataINAME);
//             buyBtn.attr("href", buyBtn.attr("data-href-prefix") + dataINAME);
//         }
//         else {
//             sampleBtn.attr("data-iname", "");
//             orderBtn.attr("data-iname", "");
//             buyBtn.attr("data-iname", "");
//         }

//         $(".st-table-product-folder-button .st-button").removeClass('st-table-product-folder-button--disabled');

//         var row = $(trigger);
//         var rowIndex = row.index() + 1;

//         var target = $(".st-stage-product__action");
//         target.addClass('st-stage-product__action--selected');


//         if (parseInt(window.innerWidth) <= 640) {
//             $(".modal .js-st-product-table tr").removeClass('st-table-product-folder__row--selected');
//             row.addClass('st-table-product-folder__row--selected');

//             $(".js-st-product-table-button").click(function (event) {
//                 target.empty();
//                 var partNumber = row.find("td:first-of-type").html();
//                 var partNumberText = row.parent().parent().find("th:first-of-type").html();
//                 target.html(partNumberText + ": " + partNumber);
//                 $('#genericModalNoBG').modal('hide');
//                 productTableSetHeight();
//                 $('.js-st-stage-product__summary').addClass('st-stage-product__summary--selected');
//                 $(".js-st-product-folder-error").off('click mouseover mouseleave');
//                 $(".js-st-product-folder-error-dropdown").off('click mouseover mouseleave');
//             });

//         }
//         else {
//             target.empty();
//             var myTable = $(".js-st-product-table-outer").clone();
//             myTable.find(".js-st-product-table-wrapper").addClass('st-table-product-folder-wrapper--selected');
//             myTable.find("table > tbody > tr:not(:nth-child(" + (rowIndex) + "))").addClass('hidden');

//             //set modal functionality to tr and remove from a
//             var dataContent = $(".js-st-modal-table").data('content');
//             var dataTarget = $(".js-st-modal-table").data('target');
//             var dataToggle = $(".js-st-modal-table").data('toggle');
//             myTable.find("table tr").attr({
//                 'data-content': dataContent,
//                 'data-target': dataTarget,
//                 'data-toggle': dataToggle
//             });
//             $(".js-st-modal-table").attr('data-toggle', 'null');

//             target.html(myTable);
//             $('#genericModalNoBG').modal('hide');
//             productTableSetHeight();
//             $('.js-st-stage-product__summary').addClass('st-stage-product__summary--selected');
//             scrollTable();
//             $(".js-st-product-folder-error").off('click mouseover mouseleave');
//             $(".js-st-product-folder-error-dropdown").off('click mouseover mouseleave');
//             jQuery('html,body').animate({scrollTop: 0}, 0);
//         }
//     }
// }

// Escluded bacuse of ticket https://jira-st.stormreply.com/jira/browse/CXST-1335

// function scrollTable(location) {
//     if (location === 'modal') {
//         var container = $(".modal .js-st-product-table-wrapper");
//         var tableWidth = $(".modal .js-st-product-table").width();
//         var rightArrow = $(".modal .js-st-table-sidescroll");
//         var leftArrow = $(".modal .js-st-table-sidescroll-back");
//     }
//     else {
//         var container = $(".js-st-product-table-wrapper");
//         var tableWidth = $(".js-st-product-table").width();
//         var rightArrow = $(".js-st-table-sidescroll");
//         var leftArrow = $(".js-st-table-sidescroll-back");
//     }

//     var selectedContainer = $(".st-table-product-folder-wrapper--selected");
//     var selectedContainerMgl = $(".js-st-product-table td:first").outerWidth();
//     var selectedContainerMglArrow = parseInt(selectedContainerMgl) + 48;

//     var containerWidth = container.width();
//     var scrollDist = tableWidth - containerWidth;

//     if (parseInt(window.innerWidth) > 640) {

//         //reset arrows
//         leftArrow.hide();
//         rightArrow.show();
//         selectedContainer.css('margin-right', '48px');
//         selectedContainer.css('margin-left', selectedContainerMgl);

//         rightArrow.click(function () {
//             container.animate({
//                 scrollLeft: scrollDist
//             }, "slow");

//         });

//         leftArrow.click(function () {
//             container.animate({
//                 scrollLeft: -scrollDist
//             }, "slow");

//         });

//         container.scroll(function (event) {
//             var scrollPos = container.scrollLeft();
//             //50 is set according to scroll overlay width + additional 3px for early trigger
//             if (scrollPos < 50) {
//                 leftArrow.hide();
//                 rightArrow.show();
//                 selectedContainer.css('margin-right', '48px');
//                 selectedContainer.css('margin-left', selectedContainerMgl);
//             }
//             else if (scrollPos > (scrollDist - 50)) {
//                 rightArrow.hide();
//                 leftArrow.show();
//                 selectedContainer.css('margin-right', '0px');
//                 selectedContainer.css('margin-left', selectedContainerMglArrow);

//             }
//         });
//     }
// }


// function productTableHover() {
//     if (parseInt(window.innerWidth) > 640) {
//         $(".js-st-product-table tr:not(:first) td").hover(function () {
//             var td = $(this);
//             var tdIndex = td.index() + 1;
//             $(".js-st-product-table tbody tr td:nth-child(" + (tdIndex) + ")").addClass('st-table-product-folder__hover');
//             $(".js-st-product-table thead tr th:nth-child(" + (tdIndex) + ")").addClass('st-table-product-folder__hover');
//         }, function () {
//             var td = $(this);
//             var tdIndex = td.index() + 1;
//             $(".js-st-product-table tbody tr td:nth-child(" + (tdIndex) + ")").removeClass('st-table-product-folder__hover');
//             $(".js-st-product-table thead tr th:nth-child(" + (tdIndex) + ")").removeClass('st-table-product-folder__hover');
//         });
//     }
// }


// function productTableSticky() {
//     var colWidth = 0;
//     $(".modal .js-st-product-table tr td:first").each(function () {
//         if ($(this).width() > colWidth) {
//             colWidth = $(this).width();
//         }
//     });
//     $(".modal .js-st-product-table tr td:nth-child(1)").css('width', colWidth);
//     $(".modal .js-st-product-table tr th:nth-child(1)").css('width', colWidth);
//     $(".modal .js-st-table-sidescroll-back").css('left', colWidth);
//     $(".modal .js-st-product-table-wrapper").css('margin-left', colWidth);

//     var tableH = $(".modal .js-st-product-table").height();
//     var windowH = parseInt(window.innerHeight);
//     if (tableH > windowH && parseInt(window.innerWidth) <= 640) {

//         $(".st-modal-table .modal-content").css('height', windowH);
//         $(".js-st-table-product-folder-button").addClass('st-table-product-folder-button--sticky');
//         var buttonH = $(".st-table-product-folder-button--sticky").outerHeight();
//         $(".js-st-product-table-outer").css('margin-bottom', buttonH);

//         var stickyHead = $(".js-st-product-table-outer").clone();
//         stickyHead.addClass('st-table-product-folder-outer--sticky-header').css({
//             height: '50px'
//         });


//         $(".modal-content").append(stickyHead);

//         var container = $(".js-st-product-table-wrapper");

//         container.on('scroll', function () {
//             var scrollPos = container.scrollLeft();
//             $('.st-table-product-folder-outer--sticky-header').css('left', -scrollPos);
//         });
//     }
// }

// function productTableSetArrow() {

//     var tableH = $(".modal .js-st-product-table").height();
//     var windowH = parseInt(window.innerHeight);
//     var marginT = $(".modal-dialog").css('margin-top');

//     if (tableH > windowH) {
//         $(".st-table-product-folder-scroll__arrow").css('top', '25vh');
//     }
// }

// function productTableModalClose() {
//     $(".st-modal-table").click(function (event) {
//         scrollTable();
//     });
// }

function initQuickviewButtonText(context) {
    context = context || document;

    $('.js-st-quickview-toggle', context).each(function () {
        var btnText = $('span', this).text();
        $(this).attr('data-btn-text', btnText);
    });
}

$(document).on('click', '.js-expand-all-resources', function (e) {
    e.preventDefault();

    $.each(tableSortFirst_fnArray, function(index, element){
        element();
    });

    var $target = $(e.target);
    STFED.expandOrCollapse.enable($target);
    emitCustomEvent('load-more-triggered');
});

function checkLoadMoreButtonVisibility() {
    $loadMoreButton = $('.st-link.js-expand-all-resources');
    if(!$loadMoreButton.length) return;
    $loadMoreButton.each(function(index, button){
        $(button).addClass('hidden').removeClass('st-link');
        var $wrapper = $(button).closest('.st-row');
        $tables = $wrapper.find('table');
        $tables.each(function(index2, table){
            var numRecordsInTable = $(table).find('tr').length;
            if(numRecordsInTable > 5){
                $(button).removeClass('hidden').addClass('st-link');
                return;
            }
        });

    });
}

function initLoadMoreResourceTable() {
    // Used RAF inside RAF to have synchronized frame rate with the browser's rendering cycle
    // It seems that 'checkLoadMoreButtonVisibility' trying to access button that has not yet mounted in DOM.
    // It is equal to setTimeout(()=> {...}, 16.67)
    requestAnimationFrame(() => {
        requestAnimationFrame(() => checkLoadMoreButtonVisibility())
    })

    $(document).on('click', '.js-table-resources-load-more', function (e) {
        e.preventDefault();

        var $component = $(e.target);
        loadMoreResourceTable($component);
        emitCustomEvent('load-more-triggered');
    });
}

function loadMoreResourceTable($component, action) {
    var $table = $component.closest('table');
    var $wrapper = $component.closest('.st-table-load-more');

    var $title = $table.prev('.st-table__subtitle-h3');

    if ($wrapper.length > 0) {
        $table = $wrapper.prev('.dataTables_wrapper').find('table');
    }

    if ($title.length === 0) {
        $title = $table.closest('.dataTables_wrapper').prev('.st-table__subtitle-h3');

        if ($title.length === 0) {
            $title = $table.closest('.dataTables_wrapper').prevAll('.st-table__subtitle-h3');
        }
    }

    var dt = $table.DataTable();
    var info = dt.page.info();
    var maxVisibleItems = _.defaultTo($table.data('max-visible-items'), 5);
    var loadAll = $table.data('load-all');
    var newLength;
    if (action) {
        if (action === 'expand') {
            newLength = info.recordsDisplay;
            $wrapper.addClass('hidden');
        }
        if (action === 'collapse') {
            if (info.recordsDisplay > 5) {
                newLength = 5;
                $wrapper.removeClass('hidden');
            } else {
                newLength = info.recordsDisplay;
            }
        }
    } else if (loadAll) {
        newLength = info.recordsDisplay;
    } else {
        newLength = info.length + maxVisibleItems;
    }
    var newVisibleItems = Math.min(info.end + maxVisibleItems, info.recordsDisplay);

    dt.page.len(newLength).draw();

    var titleText = $title.text().split(' (');

    if (action) {
        if (info.recordsDisplay > 5) {
            $title.text(titleText[0] + ' (' + newLength + ' of ' + info.recordsDisplay + ')');
        }
    } else {
        $title.text(titleText[0] + ' (' + newVisibleItems + ' of ' + info.recordsDisplay + ')');
        if (info.recordsDisplay <= newVisibleItems) {
            $wrapper.addClass('hidden');
        }
    }
}

function togglDistributorView(togglBtn) {
    var td = togglBtn.parent();
    var tr = td.parent();
    var table = tr.closest('table');
    if (tr.next().hasClass('js-st-row-distributor')) {
        togglBtn.closest('tr').next().remove();
    } else {
        if (tr.next().hasClass('js-st-row-quickview')) {
            togglBtn.closest('tr').next().remove();
        }
        var colspan = table.find('tbody tr')[0].cells.length;
        var content = tr.find(".js-st-table-slide-down.js-st-table-slide-down-distributor");
        var myClone = content.clone();
        myClone.addClass('st-table__slide-down--active');
        tr.after('<tr class="js-st-row-distributor"><td class="js-st-table-slide-down-content st-table__slide-down--content " colspan=" ' + colspan + ' "></td></tr>');
        tr.next().find(".js-st-table-slide-down-content").html(myClone);

        tr.next().find("table").dataTable({
            "paging": false,
            "ordering": true,
            "info": false,
            "searching": false,
            "columnDefs": [{"targets": 'js-st-table-col-no-sort', "orderable": false}],
            "order": [[0, "asc"]]
        });
    }
}

function togglDistributorViewMobile(togglBtn) {
    var itemHiddenClass = 'hide';
    var thisItem = togglBtn.closest('.st-table__item');
    var quickView = thisItem.siblings('.js-st-quickview');
    var nextItem = thisItem.siblings('.js-st-table-slide-down-button-mobile__wrapper');
    var toggleLink = $('.js-st-quickview-toggle', thisItem);
    var toggleLinkText = $('span', toggleLink);

    if (nextItem.hasClass(itemHiddenClass)) {
        nextItem.removeClass(itemHiddenClass);
        if (quickView.length > 0) {
            quickView.addClass(itemHiddenClass);
            toggleLink.removeClass('js-active');
            toggleLinkText.text(toggleLink.attr('data-btn-text'));
        }
    } else {
        nextItem.addClass(itemHiddenClass);
    }
}

function toggleButtonAvailable(btn) {
    btn.toggleClass('active');
}

function closeDistributorView(closeBtn) {
    var parentRow = closeBtn.closest('tr');
    parentRow.remove();
}

function closeDistributorViewMobile(closeBtn) {
    var itemHiddenClass = 'hide';
    var parentItem = closeBtn.closest('.js-st-table-slide-down-button-mobile__wrapper');
    parentItem.addClass(itemHiddenClass);
}

function initcloseDistributor(context) {
    context = context || document;

    $('.js-st-table-slide-down-close', context).click(function (event) {
        event.preventDefault();
        var isSmallDistributor = Boolean($(this).parents('.st-table--small').length);
        var isDesktopDistributor = Boolean($(this).parents('.st-table').length);
        toggleButtonAvailable($(this).closest('tr').prev().find('a'))
        if (isSmallDistributor) {
            closeDistributorViewMobile($(this));
        }

        if (isDesktopDistributor) {
            closeDistributorView($(this));
        }
    });
}

function setQuickviewHeight(quickView) {
    var contentHeight = quickView.find(".js-st-table-slide-down").outerHeight();
    quickView.height(contentHeight);
}

function togglQuickViewMobile(togglBtn) {
    var itemHiddenClass = 'hide';
    var thisItem = togglBtn.closest('.st-table__item');
    var distribitutorView = thisItem.siblings('.js-st-table-slide-down-button-mobile__wrapper');
    var nextItem = thisItem.siblings('.js-st-quickview');
    var togglArrowButtonBoolean = false;

    if ($('.js-st-quickview-toggle-arrow-button', thisItem).length > 0) {
        togglArrowButtonBoolean = true;
    }

    if (togglArrowButtonBoolean) {
        var togglArrowButton = $('.js-st-quickview-toggle-arrow-button', thisItem);
        var togglArrowButtonText = $('span', togglArrowButton);
    }

    if (nextItem.hasClass(itemHiddenClass)) {
        nextItem.removeClass(itemHiddenClass);
        togglArrowButton.addClass('js-active');
        togglArrowButtonText.text('Hide');
        if (distribitutorView.length > 0) {
            distribitutorView.addClass(itemHiddenClass);
        }
    } else {
        nextItem.addClass(itemHiddenClass);
        togglArrowButton.removeClass('js-active');
        togglArrowButtonText.text(togglBtn.attr('data-btn-text'));
    }
}

function togglQuickView(togglBtn) {
    var td = togglBtn.closest('td');
    var tr = td.parent();
    var table = tr.closest('table');
    var togglArrowButtonBoolean = false;

    if ($('.js-st-quickview-toggle-arrow-button', tr).length > 0) {
        togglArrowButtonBoolean = true;
    }

    if (togglArrowButtonBoolean) {
        var togglArrowButton = $('.js-st-quickview-toggle-arrow-button', tr);
        var togglArrowButtonText = $('span', togglArrowButton);
    }

    if (tr.next().hasClass('js-st-row-quickview')) {
        tr.next().remove();
        if (togglArrowButtonBoolean) {
            togglArrowButtonText.text(togglArrowButton.attr('data-btn-text'));
            togglArrowButton.removeClass('js-active');
        }
        $('body').removeClass('js-active-quickview');
    } else {
        if (tr.next().hasClass('js-st-row-distributor')) {
            togglBtn.closest('tr').next().remove();
        }
        var colspan = table.find('tbody tr')[0].cells.length;
        var content = tr.find(".js-st-table-slide-down.js-st-table-slide-down-quickview");
        var myClone = content.clone();
        if (togglArrowButtonBoolean) {
            togglArrowButton.addClass('js-active');
            togglArrowButtonText.text('Hide');
        }
        myClone.addClass('st-table__slide-down--active');
        tr.after('<tr class="js-st-row-quickview"><td class="js-st-table-slide-down-content st-table__slide-down--content " colspan=" ' + colspan + ' "></td></tr>');
        tr.next().find(".js-st-table-slide-down-content").html(myClone);

        tr.next().find("table").dataTable({
            "paging": false,
            "ordering": true,
            "info": false,
            "searching": false,
            "columnDefs": [{"targets": 'js-st-table-col-no-sort', "orderable": false}],
            "order": [[0, "asc"]]
        });
        $('body').addClass('js-active-quickview');

        if (togglBtn.hasClass('js-st-quickview-adjust-height')) {
            setQuickviewHeight(tr.next());
        }
    }
}

function togglQuickViewController(togglBtn) {
    var isSmallQuickview = Boolean(togglBtn.parents('.st-table--small').length);
    var isDesktopQuickview = Boolean(togglBtn.parents('.st-table').length);

    if (isSmallQuickview) {
        togglQuickViewMobile(togglBtn);
    }

    if (isDesktopQuickview) {
        togglQuickView(togglBtn);
    }
}

function closeQuickViewMobile(closeBtn) {
    var itemHiddenClass = 'hide';
    var togglArrowButtonBoolean = false;


    function closeQuickViewMobileHandler(row, quickviewRow) {
        if ($('.js-st-quickview-toggle-arrow-button', row).length > 0) {
            togglArrowButtonBoolean = true;
        }
        if (togglArrowButtonBoolean) {
            var togglArrowButton = $('.js-st-quickview-toggle-arrow-button', row);
            var togglArrowButtonText = $('span', togglArrowButton);
            togglArrowButtonText.text(togglArrowButton.attr('data-btn-text'));
            togglArrowButton.removeClass('js-active');
        }
        quickviewRow.addClass(itemHiddenClass);
    }

    if (closeBtn.hasClass('solutionsoftwares-softwaresbutton')) {
        var tableItem = closeBtn.closest('.st-table__item');
        var quickviewItem = tableItem.siblings('.js-st-quickview');
        if (!quickviewItem.hasClass(itemHiddenClass)) {
            closeQuickViewMobileHandler(tableItem, quickviewItem);
        }
    } else {
        var quickviewItem = closeBtn.closest('.js-st-quickview');
        var tableItem = quickviewItem.siblings('.st-table__item');
        closeQuickViewMobileHandler(tableItem, quickviewItem)
    }
}

function closeQuickView(closeBtn) {
    var parentRow = closeBtn.closest('tr');
    var prevTr = parentRow.prev();
    var nextTr = parentRow.next();
    var togglArrowButtonBoolean = false;

    function closeQuickViewHandler(row, quickviewRow) {
        if ($('.js-st-quickview-toggle-arrow-button', row).length > 0) {
            togglArrowButtonBoolean = true;
        }

        if (togglArrowButtonBoolean) {
            var togglArrowButton = $('.js-st-quickview-toggle-arrow-button', row);
            var togglArrowButtonText = $('span', togglArrowButton);
            togglArrowButton.removeClass('js-active');
            togglArrowButtonText.text(togglArrowButton.attr('data-btn-text'));
        }
        quickviewRow.remove();
    }

    if (closeBtn.hasClass('solutionsoftwares-softwaresbutton')) {
        if (nextTr.hasClass('js-st-row-quickview')) {
            closeQuickViewHandler(parentRow, nextTr);
        }
    } else {
        closeQuickViewHandler(prevTr, parentRow);
    }
}

function initcloseQuickView(context) {
    context = context || document;

    $('.js-st-quickview-close-button, .solutionsoftwares-softwaresbutton', context).click(function (event) {
        event.preventDefault();
        var closeBtn = $(this);
        var isSmallQuickview = Boolean(closeBtn.parents('.st-table--small').length);
        var isDesktopQuickview = Boolean(closeBtn.parents('.st-table').length);
        if (isSmallQuickview) {
            closeQuickViewMobile(closeBtn);
        }
        if (isDesktopQuickview) {
            closeQuickView(closeBtn);

            var quickviewCounter = function() {
                var quickviewItems = $('.js-st-row-quickview');
                if (quickviewItems.length == 0) {
                    $('body').removeClass('js-active-quickview');
                }
            }

            quickviewCounter();
        }
    });
}

function initTable(context) {
    context = context || document;

    initLoadMoreResourceTable(context);

    initQuickviewButtonText(context);
    initcloseDistributor(context);
    initcloseQuickView(context);

    $('.js-table-slide-down-button', context).click(function (event) {
        event.preventDefault();
        togglDistributorView($(this));
        initcloseDistributor(context);
        initcloseQuickView(context);
        toggleButtonAvailable($(this))
    });

    $('.js-st-table-slide-down-button-mobile', context).click(function (event) {
        event.preventDefault();
        togglDistributorViewMobile($(this));
        initcloseDistributor(context);
        initcloseQuickView(context);
    });
    $('.js-st-quickview-toggle', context).click(function (event) {
        event.preventDefault();
        togglQuickViewController($(this));
        initcloseQuickView(context);
    });
}

function resizeQuickView(context) {
    context = context || document;

    var quickviewRow = $(".js-st-row-quickview", context);

    if(quickviewRow.length > 0){
        var slideDownHeight = $(".js-st-row-quickview .js-st-table-slide-down-content", context).height();
        quickviewRow.height(slideDownHeight);
    }
}

function animateStickyTableScroll(context) {
    context = context || document;

    // Sticky table slide animation
    var animation;
    var animationStep = 4;
    var animationTime = 20;
    var showLeftButtonWidth = 200;

    var $toRightButton = $('.js-table-more-details-right', context);
    var $toLeftButton = $('.js-table-more-details-left', context);
    var $wrapper = $('.js-st-table-sticky-wrapper', context);

    $toRightButton.hover(function () {
        animation = setInterval(function () {
            $wrapper.scrollLeft($wrapper.scrollLeft() + animationStep);
        }, animationTime);
    }, function () {
        clearInterval(animation);
    });

    $toLeftButton.hover(function () {
        animation = setInterval(function () {
            $wrapper.scrollLeft($wrapper.scrollLeft() - animationStep);
        }, animationTime);
    }, function () {
        clearInterval(animation);
    });

    $wrapper.scroll(_.throttle(function () {
        if (parseInt($wrapper.scrollLeft()) > showLeftButtonWidth) {
            $toLeftButton.fadeIn();
        } else {
            $toLeftButton.fadeOut();
        }

        if ($wrapper.get(0).scrollWidth - $wrapper.outerWidth() === $wrapper.scrollLeft()) {
            $toRightButton.fadeOut();
        } else {
            $toRightButton.fadeIn();
        }
    }, 100));
}

$(function () {
    // initTable();

    // Animate table sort icon
    $(document).on('click', '.js-st-table-sort', function (event) {
        event.stopPropagation();
        event.preventDefault();

        var sortIconActive = 'st-table__sort-icon--active';

        if ($(this).hasClass(sortIconActive)) {
            $(this).removeClass(sortIconActive);
        } else {
            $(this).addClass(sortIconActive);
        }
        STFED.expandOrCollapse.enable($(this).closest('.st-row').find('.js-expand-all-resources'), 'collapse');
    });

    $(document).find('.js-st-table-sort').parent().on('click', function (event) {
        event.stopPropagation();
        STFED.expandOrCollapse.enable($(this).closest('.st-row').find('.js-expand-all-resources'), 'collapse');
    });

    animateStickyTableScroll();

    $(window).on('orientationchange', _.debounce(function () {
        setTimeout(function () {
            resizeQuickView();
        }, 250);
    }, 100));

});


//establish name space for fed functions
var STFED = STFED || {};

STFED.productFolderHeaderTable = {
    updateButtons: function (dataOrder, dataSample, dataBuy, message, sample, order, buy, priceInfoBuy, priceInfo, sampleBtn, orderBtn, buyBtn) {
        // update buttons in right info box of product folder header
        if (dataOrder === undefined && dataSample === undefined && dataBuy === undefined) {
            $(message).removeClass('hidden');
            $(sample).addClass('hidden');
            $(order).addClass('hidden');
            $(buy).addClass('hidden');
            priceInfoBuy.addClass('hidden');
            priceInfo.removeClass('hidden');
        } else {
            $(message).addClass('hidden');
            $(sample).removeClass('hidden');
            $(order).removeClass('hidden');
            $(buy).removeClass('hidden');

            if (dataSample !== undefined) {
                $(sampleBtn).removeClass('st-button--disabled');
            } else {
                $(sampleBtn).addClass('st-button--disabled');
            }

            if (dataOrder !== undefined) {
                $(orderBtn).removeClass('st-button--disabled');
                $(message).addClass('hidden');
            } else {
                $(orderBtn).addClass('st-button--disabled');
                $(message).removeClass('hidden');
            }
            if (dataBuy !== undefined) {
                $(buyBtn).removeClass('st-button--disabled');
                priceInfoBuy.removeClass('hidden');
                priceInfo.addClass('hidden');
            } else {
                $(buyBtn).addClass('st-button--disabled');
                priceInfoBuy.addClass('hidden');
                priceInfo.removeClass('hidden');
            }
        }
    }
};

STFED.expandOrCollapse = {
    enable: function ($target, action) {
        var $resourcesBlock = $target.first().closest('.js-resources-popular');
        if ($resourcesBlock.length) {
            this.init($resourcesBlock, action);
        }
    },
    init: function ($resourcesBlock, action) {
        var $expandAllLink = $resourcesBlock.find('.js-expand-all-resources');
        var $loadMoreLinks = $resourcesBlock.find('.js-table-resources-load-more');
        var dataAction = action || $expandAllLink.data('action');
        var dataText = '';
        if (!action) {
            dataText = $expandAllLink.data('action') === 'expand' ? 'collapse' : 'expand';
        }
        var dataExpandOrCollapseText = $expandAllLink.data(dataText + '-text');


        if (dataAction === 'expand') {
            $expandAllLink.html(dataExpandOrCollapseText || 'Collapse all categories').data('action', 'collapse');
        } else {
            $expandAllLink.html(dataExpandOrCollapseText || 'Expand all categories').data('action', 'expand');
        }

        $loadMoreLinks.each(function () {
            var $component = $(this);
            var $wrapper = $component.closest('.st-table-load-more');
            var $table = $wrapper.prev('table');

            if ($wrapper.length > 0) {
                $table = $wrapper.prev('.dataTables_wrapper').find('table');
            }

            if ($table.data('auto-init')) {
                if (dataAction === 'expand') {
                    loadMoreResourceTable($component, 'expand');
                } else {
                    loadMoreResourceTable($component, 'collapse');
                }
            }
        })
    }
}

initLoadMoreResourceTable();

// Tree with checkboxes


//function filterCheckboxHandler(thisList) {
//    var noCloseElement = thisList.hasClass('js-st-sidebar-checkboxes--no-close');
//    var checkedList = thisList.find('input:checked');
//    var thisListElementContainer = thisList.closest('.has-children').find('.js-st-sidebar-checkboxes-selected-elements');
//    thisListElementContainer.empty();
//
//    checkedList.each(function() {
//        var checkedText = $(this).next().text();
//        checkedText = (checkedText.lastIndexOf('(') === -1) ? checkedText : checkedText.substring(0, checkedText.lastIndexOf('(') - 1);
//        var checkedId = $(this).next().attr('for');
//        var element = '<div class="st-tree-checkboxes-selected-elements__element" data-checkbox-id="' + checkedId + '">';
//        element += (noCloseElement)? '' : '<a href="#" class="st-tree-checkboxes-selected-elements__close-element"><svg class="st-svg st-svg--close"><use xlink:href="#icon-close"></use></a>';
//        element += '<span>' +checkedText + '</span></div>';
//        thisListElementContainer.append(element);
//
//        $('.st-tree-checkboxes-selected-elements__close-element').click(function(e) {
//            e.preventDefault();
//            var element = $(this).parent();
//            var checkboxID = element.attr('data-checkbox-id');
//            $('#' + checkboxID).prop('checked', false).change();
//            element.remove();
//        });
//    });
//}
//
//function initCheckboxHandler() {
//    var list = $('.js-st-sidebar-checkboxes');
//
//    //On init
//    list.each(function(){
//        filterCheckboxHandler($(this));
//    });
//
//    //On Change
//    list.on('change', 'input', function() {
//        var thisList = $(this).parents('.js-st-sidebar-checkboxes');
//
//        filterCheckboxHandler(thisList);
//    });
//}


//function initTreeCheckbox() {
//    $('.js-st-tree-checkboxes').each(function(){
//        $(this).bonsai({
//            checkboxes: true,
//            createInputs: 'checkbox',
//            handleDuplicateCheckboxes: true,
//            expandAll: false
//        });
//
//    });
//}
//
//$(document).ready(function () {
//
//    initTreeCheckbox();
////    initCheckboxHandler();
//});


//establish name space for fed functions
var STFED = STFED || {};

//extend STFED with functions
STFED.filterTreeCheckboxes = {
    initTreeCheckbox: function (thisList) {
        $('.js-st-tree-checkboxes').each(function(){
            $(this).bonsai({
                checkboxes: true,
                createInputs: 'checkbox',
                handleDuplicateCheckboxes: true,
                expandAll: false
            });

        });
    },
    filterCheckboxHandler: function (thisList) {
        var noCloseElement = thisList.hasClass('js-st-sidebar-checkboxes--no-close');
        var checkedList = thisList.find('input:checked');
        var thisListElementContainer = thisList.closest('.has-children').find('.js-st-sidebar-checkboxes-selected-elements');
        thisListElementContainer.empty();

        checkedList.each(function() {
            var checkedText = $(this).next().text();
            checkedText = (checkedText.lastIndexOf('(') === -1) ? checkedText : checkedText.substring(0, checkedText.lastIndexOf('(') - 1);
            var checkedId = $(this).next().attr('for');
            var element = '<div class="st-tree-checkboxes-selected-elements__element" data-checkbox-id="' + checkedId + '">';
            element += (noCloseElement)? '' : '<a href="#" data-remove-filter="' + checkedId + '" class="st-tree-checkboxes-selected-elements__close-element"><svg class="st-svg st-svg--close"><use xlink:href="#icon-close"></use></a>';
            element += '<span>' +checkedText + '</span></div>';
            thisListElementContainer.append(element);
        });
    },
    init: function () {
        STFED.filterTreeCheckboxes.initTreeCheckbox();
    }
};

(function ($) {
    STFED.filterTreeCheckboxes.init();
})(jQuery);

// Sidebar Checkboxes
function sidebarClearBtnInit() {
    var categorySelectedClass = 'st-sidebar__tree-item-selected';

    function resetCheckboxes(e, clearBtn, checkboxClass, parentClass) {
        e.preventDefault();

        var parentItem = $(clearBtn).closest(parentClass);
        var list = $(checkboxClass, parentItem);
        var checkedList = list.find('input:checked');
        checkedList.each(function () {
            $(this).prop('checked', false).change();
        });
    }

    $('.js-st-sidebar-clear-sidebar-checkboxes-accordion').click(function (e) {
        resetCheckboxes(e, this, '.js-st-sidebar-checkboxes', '.has-children');
    });

    $('.js-st-sidebar-clear-sidebar-checkboxes-static').click(function (e) {
        resetCheckboxes(e, this, '.js-st-sidebar-checkboxes', '.st-sidebar__filters');
    });

    $('.js-st-sidebar-clear-tree-checkboxes').click(function (e) {
        resetCheckboxes(e, this, '.js-st-sidebar-checkboxes', '.has-children');
    });

    $('.js-st-sidebar-clear-range-slider').click(function (e) {
        e.preventDefault();
        var parent = $(this).closest('.js-st-parent-checkbox__wrapper');
        var sliderElements = parent.find('.js-st-range-slider').first();
        var options = $(sliderElements).slider( 'option' );
        $(sliderElements).slider( 'values', [ options.min, options.max ] );
        $(sliderElements).find('.js-st-range-amount-min').val(options.min);
        $(sliderElements).find('.js-st-range-amount-max').val(options.max);
        resetSliderSelected($(parent).find('.js-st-range-slider-selected-values'), $(parent).find('.js-st-sidebar-clear-range-slider'));
    });

    $('.js-st-sidebar-clear-parent').click(function (e) {
        e.preventDefault();
        var parent = $(this).closest('.js-st-parent-checkbox__wrapper');
        parent.find('.st-sidebar__filter-children').find('.st-sidebar__clear-btn').trigger('click');
        parent.find('.js-st-input input').val('').trigger('change');
    });

    $('.js-st-sidebar-clear-all').click(function (e) {
        e.preventDefault();
        var sidebarFilters = $(this).closest('.js-st-sidebar__filters');
        sidebarFilters.find('.js-st-accordion-menu .st-sidebar__clear-btn').trigger('click');
        sidebarFilters.find('.js-st-accordion-menu .js-st-input input').val('').trigger('change');
        sidebarFilters.find('.js-st-accordion-menu .js-st-select select').val('').selectric('refresh');
    });

    $('.js-st-sidebar-clear-categories').click(function (e) {
        e.preventDefault();
        $(this).closest('.st-sidebar__tree').find('.'+ categorySelectedClass).removeClass(categorySelectedClass);
    });
}

$(document).ready(function () {
    sidebarClearBtnInit();
});

$(function() {
    $(document).ready(function() {
       checkVisibilityOfClearBtn();
    });

    var clearBtnClass = '.st-sidebar__clear-btn';
    var checkboxWrappers = '.js-st-sidebar-checkboxes';
    var showClearBtnClass = 'st-sidebar__clear-btn--visible';

    function updateClearBtnVisiblity(clearBtn, clearBtnCount) {
        (clearBtnCount === 0)? clearBtn.removeClass(showClearBtnClass) : clearBtn.addClass(showClearBtnClass);

        var childrenWrapper = clearBtn.closest('.st-sidebar__filter-children');
        if(childrenWrapper.length) {
            var parent = childrenWrapper.closest('.js-st-parent-checkbox__wrapper');
            var parentClearBtn = parent.find(clearBtnClass).first();
            var parentCounter = getRelativesCount(parent);
            updateClearBtnVisiblity(parentClearBtn, parentCounter);
        }
    }

    function checkVisibilityOfClearBtn() {
        $(checkboxWrappers).each(function(){
            var clearBtnCount = 0;
            var clearBtn = $(this).prev().find(clearBtnClass);

            $(this).find('.st-checkbox > input[type="checkbox"]').each(function(){
                clearBtnCount = ($(this)[0].checked)? clearBtnCount + 1 : clearBtnCount;
            });
            clearBtn.data('visibilityCount', clearBtnCount);
            updateClearBtnVisiblity(clearBtn, clearBtnCount);
        });

        $('.js-st-sidebar__filters .js-st-input input').each(function(){
            var clearBtn = $(this).prev();
            var clearBtnCount = ($(this).val() !== '')? 1 : 0;
            clearBtn.data('visibilityCount', clearBtnCount);
            updateClearBtnVisiblity(clearBtn, clearBtnCount);
        });
    }

    function getRelativesCount(parent) {
        var count = 0;
        parent.find('.st-sidebar__clear-btn:not(:first)').each(function() {
            count += $(this).data('visibilityCount') || 0;
        });
        return count;
    }

    $(document).on('change', '.js-st-sidebar__filters .st-checkbox > input[type="checkbox"]', function() {
        var wrapper = $(this).closest(checkboxWrappers);
        var clearBtn = wrapper.prev().find(clearBtnClass);
        var clearBtnCount = clearBtn.data('visibilityCount') || 0;

        (this.checked)? clearBtnCount++ : clearBtnCount--;

        clearBtn.data('visibilityCount', clearBtnCount);
        updateClearBtnVisiblity(clearBtn, clearBtnCount);
    });

    $(document).on('keyup change', '.js-st-sidebar__filters .js-st-input input', function() {
        var clearBtn = $(this).prev();
        if($(this).val() !== '') {
            clearBtn.data('visibilityCount', 1);
            updateClearBtnVisiblity(clearBtn, 1);
        } else {
            clearBtn.data('visibilityCount', 0);
            updateClearBtnVisiblity(clearBtn, 0);
        }
    });
});

var FailedPopup;

$(document).ready(function () {
    $('#myModal, #myModal320, #genericModal, #pdpTableModal, #genericModalNoBG, #genericModalTrim, .st-modal--generic').on('show.bs.modal', function (e) {
        $(document).focus();
        var modalThis = $(this),
            relatedTarget = $(e.relatedTarget);

        // hide all other modals
        $('.st-modal').not(modalThis).modal('hide');
        modalThis.find('.modal-content').addClass('loading').empty();

        if (relatedTarget.hasClass('clickable-image')) {

            modalThis.find('.modal-content').addClass('data-image');
            modalThis.find('.modal-content').html('<img src="' + relatedTarget.attr('data-image-url') + '" >');
            modalThis.find('.modal-content').removeClass('loading');

            $('.modal').one('scroll', function () {
                modalThis.modal('handleUpdate');
            });

        } else {

            $.ajax(relatedTarget.attr('data-content'), {
                success: function (response) {
                    modalThis.find('.modal-content').html(response);

//                STFED.accordion.hideInactive('.st-accordion');
                    STFED.edesign.initTabs(modalThis);
                    STFED.foundation.init();
                    STFED.edesign.dcdcACDCInit();

                    modalThis.modal('handleUpdate');
                    modalThis.find('.modal-content').removeClass('loading');

                    modalLoaded();

                    if (relatedTarget.attr('data-solution-name')) {
                        var solutionWidgetModalResponse = modalThis.find('.modal-content').find('.solution-widget-modal');

                        if (digitalData.product && digitalData.product.length && digitalData.product[0].productInfo) {
                            modalThis.attr('data-original-product-id', digitalData.product[0].productInfo.productID);
                            modalThis.attr('data-original-product-level6', digitalData.product[0].productInfo.tree.level6);
                        }
                    }

                    $('.modal').one('scroll', function () {
                        modalThis.modal('handleUpdate');
                    });
                }
            });
        }
    });

    $(document).on('click', '#genericModal .modal-page, .st-modal--generic .modal-page', function (e) {
        e.preventDefault();
        var modalThis = $(this);
        modalThis.closest('.modal-content').css('height', modalThis.closest('.modal-content').height()).addClass('loading').empty();
        $.ajax(modalThis.attr('data-content'), {
            success: function (response) {
                $('#genericModal .modal-content, .st-modal--generic .modal-content').html(response);
                STFED.accordion.hideInactive('.st-accordion');
                STFED.foundation.init();
                $('#genericModal .modal-content, .st-modal--generic .modal-content').removeClass('loading').css('height', 'auto');
                $('#genericModal, .st-modal--generic').modal('handleUpdate');
                $('#genericModal, .st-modal--generic').focus();
            },
            error: function () {

            }
        });
    });

    $(document).on('click', '#genericModalNoBG .modal-page', function (e) {
        e.preventDefault();
        var modalThis = $(this);
        modalThis.closest('.modal-content').css('height', modalThis.closest('.modal-content').height()).addClass('loading').empty();
        $.ajax(modalThis.attr('data-content'), {
            success: function (response) {
                $('#genericModalNoBG .modal-content').html(response);
                STFED.accordion.hideInactive('.st-accordion');
                STFED.foundation.init();
                $('#genericModalNoBG .modal-content').removeClass('loading').css('height', 'auto');
                $('#genericModalNoBG').modal('handleUpdate');
            },
            error: function () {

            }
        });
    });

    $('.modal').on('hidden.bs.modal', function (e) {
        var trimModalContent = $('#genericModalTrim .modal-content');

        setTimeout(function () {
            $('a').blur();
            $(document).focus();
        }, 100);

        disableFocusSolutionWidget();

        if (trimModalContent.hasClass('data-image')) {
            trimModalContent.removeClass('data-image');
        }

        $('#genericModal .modal-content, #genericModalNoBG .modal-content, .st-modal--generic .modal-content').empty();
    });

    $('#genericModalTrim').on('hidden.bs.modal', function () { // Related to solution widget analytics
        var modalThis = $(this);

        var originalProductId = modalThis.attr('data-original-product-id');
        var originalProductLevel6 = modalThis.attr('data-original-product-level6');

        if (originalProductId) {
            digitalData.product[0].productInfo.productID = originalProductId;
            digitalData.product[0].productInfo.tree.level6 = originalProductLevel6 || '';
            modalThis.removeAttr('data-original-product-id');
            modalThis.removeAttr('data-original-product-level6');
        }
    });

    $(document).on('click', '.dismiss-modal-honor-link', function (e) {
        $('.modal').modal('hide');
    });


    function requestSoftware() {
        $('.st-re-software').hide();
        $('.st-re-software-confirmed').hide();
        $('.js-st-button--accept').click(function () {
            $('.st-agree-modal').hide();
            $('.st-re-software').show();
            $("#genericModal").animate({scrollTop: 0}, 0);
            $('#genericModal').modal('handleUpdate');
            $('#genericModal').focus();
        });

        $('#st-request-software-form').on('valid.fndtn.abide', function () {
            // Handle the submission of the form
            $('.st-re-software').hide();
            $('.st-re-software-confirmed').show();
            $("#genericModal").animate({scrollTop: 0}, 0);
            $('#genericModal').modal('handleUpdate');
            $('#genericModal').focus();
        });

        $('#st-request-software-form').on('invalid.fndtn.abide', function () {
            var invalid_fields = $(this).find('select[data-invalid]');
            invalid_fields.each(function (index, el) {
                $(this).parents(".st-select").addClass('error')
            });
        });
    }

    function getSoftware() {
        $('.st-modal-login').hide();
        $('.st-re-software-confirmed').hide();
        $('.js-st-button--accept').click(function () {
            $('.st-agree-modal').hide();
            $('.st-modal-login').show();
            $("#genericModal").animate({scrollTop: 0}, 0);
            $('#genericModal').modal('handleUpdate');
            $('#genericModal').focus();
        });

        $('#st-modal-login-form').on('valid.fndtn.abide', function () {
            // Handle the submission of the form
            $('.st-modal-login').hide();
            $('.st-re-software-confirmed').show();
            $("#genericModal").animate({scrollTop: 0}, 0);
            $('#genericModal').modal('handleUpdate');
            $('#genericModal').focus();
        });

        $('#st-modal-login-form').on('invalid.fndtn.abide', function () {
            var invalid_fields = $(this).find('select[data-invalid]');
            invalid_fields.each(function (index, el) {
                $(this).parents(".st-select").addClass('error')
            });
        });
    }


    function modalLoaded() {
        //function gets loaded after the ajax call from the modal
        if ($('.js-st-selectric-init').length > 0) {
            Foundation.libs.abide.init();
            requestSoftware();
            formSelectric();
            formInput();
        }

        if ($('.st-get-software').length > 0) {
            Foundation.libs.abide.init();
            getSoftware();
            formInput();
        }

        if ($('.st-customize-columns').length > 0) {
            customizeColumns();
        }
    }

    var scrollPos = 0;
    $(window).on('orientationchange', function (e) {
        if ($('.reveal-modal.open').length > 0) {
            var modalPos = $('.reveal-modal.open').position().top;

            setTimeout(function () {
                // if($('body').hasClass('ios-device')) {
                $('body').scrollTop(modalPos);
                // }
                // else{
                //     $(window).scrollTop(modalPos);
                // }
            }, 250);
        }

    });
// $('[data-reveal]')
//     .on('opened.fndtn.reveal', function (){
//         if($('body').hasClass('ios-device')) {
//             scrollPos = $('.reveal-modal.open').position().top;
//             $('body').css({
//                 overflow: 'hidden',
//                 position: 'fixed',
//                 top: -scrollPos
//             });
//         }
// })
// .on('closed.fndtn.reveal', function (){
//     if($('body').hasClass('ios-device')) {
//         $('body').css({
//             overflow: ''/*,
//             position: '',
//             top: ''*/
//         })/*.scrollTop(scrollPos)*/;
//     }
// });

    $('[data-reveal]').on('opened.fndtn.reveal', function () {
        var docHeight = window.innerHeight;
        var modalElements = $('.st-modal');
        STFED.viewPortHeightFix.toggleModalHeight(docHeight, modalElements);
    });
    $(document).on("touchend", ".reveal-modal.open", function (e) {
        var posTop = e.originalEvent.changedTouches[0].pageY - $(window).scrollTop();
        if (posTop < 50 && window.innerWidth < 832 && $('body').hasClass('ios-device')) {
            setTimeout(function () {
                $(window).on('resize', function () {
                    var docHeight = window.innerHeight + 50;
                    var modalElements = $('.st-modal');
                    //$(window).scrollTop($(window).scrollTop()+50);
                    STFED.viewPortHeightFix.toggleModalHeight(docHeight, modalElements, true);
                });
            }, 1000);
        }
    });
    $(window).on('orientationchange', function () {
        var docHeight = window.innerHeight;
        var modalElements = $('.st-modal');
        STFED.viewPortHeightFix.toggleModalHeight(docHeight, modalElements);
    });

// failed request modal window
    FailedPopup = function () {
        this.createModal = function ($failedPopup, res) {
            var $descriptionField = $failedPopup.find('.modal-description'),
                $emailField = $failedPopup.find('.email-field'),
                $requestStatusField = $failedPopup.find('.request-status-field'),
                $responseField = $failedPopup.find('.response-field'),
                $errorCodeField = $failedPopup.find('.error-code-field'),
                $errorMessageField = $failedPopup.find('.error-message-field');

            $descriptionField.children().each(function () {
                $(this).hide();
            });

            function changeField($field, text) {
                if (text) {
                    $field.text(text);
                } else {
                    $field.parent('p').remove();
                }
            }

            switch (res.data.errorCode) {
                case '0':
                    $descriptionField.find('#ip-failure-error-0').show();
                    break;
                default:
                    $descriptionField.find('#ip-failure-error').show();
                    changeField($emailField, res.data.email);
                    changeField($requestStatusField, res.statusCode);
                    changeField($responseField, res.errDesc);
                    changeField($errorCodeField, res.data.errorCode);
                    changeField($errorMessageField, res.data.errorMessage);
                    break;
            }
        };

        this.showModal = function (res) {
            var $failedPopup = $('.failed-popup');

            if ($failedPopup.length && res) {
                this.createModal($failedPopup, res);
                $failedPopup.modal('show');
                if (typeof decibelInsight !== "undefined") {
                    decibelInsight.sendApplicationError(res.data.errorMessage);
                }
            }
        };
    };
});

function latestFromSlick () {
    $('.js-st-latest_from_st').slick({
          speed: 300,
          slidesToScroll: 1,
          variableWidth: true,
          infinite: true,
          focusOnSelect: false,
          dots: false,
          arrows: true,
          responsive: [
            {
              breakpoint: 1026,
              settings: {
                arrows: false
              }
            }
          ]
    });
	if(STFED && STFED.dotdotdot){
    	STFED.dotdotdot.init();
	}
}

if($('.js-st-latest_from_st').isInViewport()){
	latestFromSlick();
} else {
	var latestFromSlick_initialization = _.debounce(function() {
        if($('.js-st-latest_from_st').isInViewport()){
        	latestFromSlick();
        	$(window).unbind("scroll", latestFromSlick_initialization);
        }
    }, 100, {maxWait: 100});
	$(window).bind("scroll", latestFromSlick_initialization);
}

function latestFromWidget () {
    $('.js-st-latest-from-st-widget').slick({
          speed: 300,
          slidesToScroll: 1,
          slidesToShow: 3,
          variableWidth: false,
          infinite: true,
          focusOnSelect: false,
          dots: false,
          arrows: true,
          responsive: [
            {
              breakpoint: 1026,
              settings: {
                arrows: false,
                slidesToShow: 2,
                variableWidth: true,
              }
            }
          ]
    });
	if(STFED && STFED.dotdotdot){
    	STFED.dotdotdot.init();
	}
}
if($('.js-st-latest-from-st-widget').isInViewport() && !$('.js-st-latest-from-st-widget').closest('[data-print-headline]').hasClass("st-invisible hidden")){
	latestFromWidget();
} else {
	var latestFromWidget_initialization = _.debounce(function() {
        if($('.js-st-latest-from-st-widget').isInViewport() && !$('.js-st-latest-from-st-widget').closest('[data-print-headline]').hasClass("st-invisible hidden")){
        	latestFromWidget();
        	$(window).unbind("scroll", latestFromWidget_initialization);
        }
	}, 100, {maxWait: 100});
	$(window).bind("scroll", latestFromWidget_initialization);
}

function slickInputCopy(slickWidget) {
    $(slickWidget+' input').on('keyup', function () {
        var $this = $(this);
        $(slickWidget+' input').each(function (k, val) {
            if ($this.attr('name') == val.name) {
                val.value = $this.val();
            }
        });
    });
}
slickInputCopy(".js-st-latest-from-st-widget");

function inputSlickSelect(input){
  //prevent touchstart and mousedown from firing at a slider level to freeze slider when input is focused
  $(input).on('mousedown touchstart', function(e) {
    e.stopPropagation();
  });
}

inputSlickSelect('.st-card--newsletter input');

var featuredTechnologySlick_initialization = [];

$(document).ready(function () {

    var featuredTechnologyModule = $('.js-st-featured_technology');

    function featuredTechnologySlick() {
        featuredTechnologyModule.each(function(index, element) {
            var $element = $(element);
            if ($element.find('>.st-card').length > 2) {
            	if($element.isInViewport()){
            		$element.slick({
	                    dots: true,
	                    speed: 300,
	                    slidesToShow: 1,
	                    variableWidth: true,
	                    infinite: true,
	                    arrows: false,
	                    focusOnSelect: false,
	                    centerMode: true,
	                    dotsClass: "st-card__dots"
	                });
            	} else {
            		featuredTechnologySlick_initialization[index] = _.debounce(function() {
                    	if($element.isInViewport()){
                    		$element.slick({
        	                    dots: true,
        	                    speed: 300,
        	                    slidesToShow: 1,
        	                    variableWidth: true,
        	                    infinite: true,
        	                    arrows: false,
        	                    focusOnSelect: false,
        	                    centerMode: true,
        	                    dotsClass: "st-card__dots"
        	                });
                    		$(window).unbind("scroll", featuredTechnologySlick_initialization[index]);
                    	}            			
					}, 100, {maxWait: 100});
            		$(window).bind("scroll", featuredTechnologySlick_initialization[index]);
            	}
            }
        });
    }

	// If 'js-st-featured_technology' presents on page
	if (featuredTechnologyModule.length) {

		// Initialize slider on load if window width <= 1025
		if(STFED.window.width <= STFED.breakpoint.mediumMax) {
			featuredTechnologySlick();
		}

		$(window).on('resize', function() {

			// Destroy slider if it's existed and if window width > 1025
			if(STFED.window.width >= STFED.breakpoint.largeMin && (featuredTechnologyModule.hasClass('slick-initialized'))) {
                featuredTechnologyModule.filter('.slick-initialized').slick('destroy');
			}

			// Initialize slider if it's not existed and if window width <= 1025
			else if (STFED.window.width <= STFED.breakpoint.mediumMax && (!(featuredTechnologyModule.hasClass('slick-initialized')))) {
				featuredTechnologySlick();
			}
		});
    }
});

function formSelectric() {
    $('.st-select > select').selectric({
        onChange: function () {
            var input = $(this);
            var value = $(this).val().length;

            if (value > 0) {
                input.closest('.st-select').addClass('st-select--filled').find('label.error, div.error').removeClass('error');
            } else {
                input.closest('.st-select').removeClass('st-select--filled');
            }
        },
        onOpen: function () {
            var modal = $(this).closest('.st-modal');
            if (modal.length) {
                var modalContent = modal.find('.modal-content');
                var modalHeight = modalContent.outerHeight() + modalContent.offset().top;

                var selectricWrapper = $(this).closest('.selectric-wrapper');
                var selectBottomPosition = $(this).offset().top + selectricWrapper.height();

                // 110 === dropdown height inside modals + 10 offset
                if ((modalHeight - selectBottomPosition) < 120) {
                    selectricWrapper.removeClass('selectric-below');
                    selectricWrapper.addClass('selectric-above');
                }
            }
        },
        disableOnMobile: false,
        nativeOnMobile: false
    });
}

function initDatePicker() {
    enquire
    .register(STFED.mediaQueries.mediumMin, {
        match: function () {
            $(".js-st-input--datepicker").datepicker({
                dayNamesMin: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
                showOtherMonths: true,
                selectOtherMonths: true,
                dateFormat: "M dd yy",
                nextText: "<svg class=\"st-svg st-svg--arrow-right\">\n" +
                "                    <use xlink:href=\"#icon-arrow-right\"></use>\n" +
                "                </svg>",
                prevText: "<svg class=\"st-svg st-svg--arrow-right\">\n" +
                "                    <use xlink:href=\"#icon-arrow-right\"></use>\n" +
                "                </svg>"
            });
        }
    })
    .register(STFED.mediaQueries.smallMax, {
        match: function () {
            $(".js-st-input--datepicker").datepicker("destroy").attr('type', 'date').click(function () {
                $(this).attr('placeholder', '');
            });
        }
    });
}

function formInput() {

    $(".js-st-input > input, .js-st-input > textarea").on("change paste keyup", function() {
        var input = $( this );
        var value = $( this ).val().length;

        if( value > 0){
            input.parent().addClass('st-input--filled');
        } else {
            input.parent().removeClass('st-input--filled');
        }
    });
}

function numberInput() {
    $(".js-st-input-number > input").wrap( "<div class='st-input__controls-container'></div>" );
    $('.js-st-input-number input').each(function() {
        if(!($(this).next(".st-input__controls").length)) {
            $('<div class="st-input__controls"><div class="st-input__button st-input__button--up"></div><div class="st-input__button st-input__button--down"></div></div>').insertAfter($(this));
        }
    });

    $('.js-st-input-number').each(function() {
        var spinner = $(this),
        container = spinner.find('.st-input__controls-container'),
        input = spinner.find('input[type="number"]'),
        btnUp = spinner.find('.st-input__button--up'),
        btnDown = spinner.find('.st-input__button--down'),
        min = input.attr('min'),
        max = input.attr('max');

        btnUp.click(function() {
            var oldValue = parseFloat(input.val());
            if (isNaN(oldValue)) {
                var newVal = 1;
            } else if (oldValue >= max) {
                var newVal = oldValue;
            } else {
                var newVal = oldValue + 1;
            }
            spinner.find("input").focus().val(newVal).trigger("change");
            if(container.hasClass("error")) {
               spinner.addClass("error")
            } else {
                spinner.removeClass("error")
            }
        });

        btnDown.click(function() {
            var oldValue = parseFloat(input.val());
            if (isNaN(oldValue)) {
                var newVal = 1;
            } else if (oldValue <= min) {
              var newVal = oldValue;
            } else {
              var newVal = oldValue - 1;
            }
            spinner.find("input").focus().val(newVal).trigger("change");
            if(container.hasClass("error")) {
               spinner.addClass("error")
            } else {
                spinner.removeClass("error")
            }
        });
    });
}

formInput();
numberInput();

$(document).ready(function() {
	(function($) {
		// Hide Header on on scroll down
		var didScroll, headerHeight, ismobileheader;
		var lastScrollTop = 0;
		var delta = 5;
		var main = $('.js-st-main');
		var header = $('.js-st-header');
		var headerMobile = $('.js-st-header-mobile');
		var outerHeight = header.outerHeight(true);
		var outerHeightMob = headerMobile.outerHeight(true);

		$(window).scroll(_.throttle(function(event){
			didScroll = true;
		}, 100));

		$(window).on("orientationchange resize", _.debounce(function () {
			getHeaderType();
		}, 100));

		setInterval(function() {
			if (didScroll) {
				hasScrolled();
				didScroll = false;
			}
		}, 250);

		getHeaderType();

		function getHeaderType() {
			if($(window).width() <= STFED.breakpoint.largeMin) {
			   ismobileheader = true;
				headerHeight = headerMobile.outerHeight()/2;
			} else {
				ismobileheader = false;
				headerHeight = header.outerHeight();
			}
		}

		function hasScrolled() {
			var st = $(this).scrollTop();

			// Make sure they scroll more than delta
			if(Math.abs(lastScrollTop - st) <= delta)
				return;

			// If they scrolled down and are past the header, add class .out-of-view.
			// This is necessary so you never see what is "behind" the header.
			if ( !($('body').hasClass('has-active-overlay')) ) {

				if (st > lastScrollTop && st > (headerHeight *2)){
					// Scroll Down
					handleScrollDown()

				} else {
					// Scroll Up
					if(st + $(window).height() < $(document).height()) {
						if (STFED.preventShowingHeader) {
							handleScrollDown()
						} else {
							handleScrollUp()
						}

					}
				}
			}

			lastScrollTop = st;
		}

		function handleScrollDown() {
			if(ismobileheader && !$(".off-canvas-wrap").hasClass("move-right")) {
				// headerMobile.removeClass('in-view').addClass('out-of-view');
				outerHeightMob = headerMobile.outerHeight(true);
				headerMobile.removeClass('in-view').css('top', -outerHeightMob);
			} else {
				const currentPageUrl = new URL(window.location.href);
				// header.removeClass('in-view').addClass('out-of-view');
				outerHeight = header.outerHeight(true);
				if($("#stm32cube-idebar").is(":visible")){
					outerHeight += $("#stm32cube-idebar").outerHeight(true);
				}
				else if($("#edgeAI-idebar").is(":visible")){
					outerHeight += $("#edgeAI-idebar").outerHeight(true);
				}
				else if($("#mxbar").is(":visible")){
					outerHeight += $("#mxbar").outerHeight(true);
				}
				else if($("#mcubar").is(":visible")){
					outerHeight += $("#mcubar").outerHeight(true);
				}
				else if($("#mpubar").is(":visible")){
					outerHeight += $("#mpubar").outerHeight(true);
				} else if (!currentPageUrl.pathname.endsWith("st-edge-ai-suite.html") && $("#st-edge-ai-suite-bar-container").is(":visible")) {
					outerHeight += $("#st-edge-ai-suite-bar-container").outerHeight(true);
				}
				header.removeClass('in-view').css('top', -outerHeight);
			}
			main.removeClass('js-st-header-in-view').addClass('js-st-header-out-of-view');
			emitCustomEvent('header-left-view', {
				headerHeight: outerHeight
			}, main[0]);
		}

		function handleScrollUp() {
			if(ismobileheader) {
				// headerMobile.removeClass('out-of-view').addClass('in-view');
				outerHeightMob = headerMobile.outerHeight(true);
			headerMobile.addClass('in-view').css('top', 0);
			} else {
				// header.removeClass('out-of-view').addClass('in-view');
				outerHeight = header.outerHeight(true);
			header.addClass('in-view').css('top', 0);
			}

			main.removeClass('js-st-header-out-of-view').addClass('js-st-header-in-view');
			emitCustomEvent('header-entered-view', {
				headerHeight: outerHeight
			}, main[0]);
		}

		function dispatchHeaderEvent(header, eventName) {
			if (header.length) {
				var event = document.createEvent('Event');

				event.initEvent(eventName, true, true);

				header[0].dispatchEvent(event);
			}
		}

    // accessibility CTA
    var ctaButtons = document.querySelectorAll('.js-focus-accessibilityCta');
    ctaButtons.forEach(function(ctaButton) {
        ctaButton.addEventListener('focus', function() {
            ctaButton.classList.add('visible-accessibilityCta');
            handleScrollUp();
        });

        ctaButton.addEventListener('blur', function() {
            ctaButton.classList.remove('visible-accessibilityCta');
            didScroll = true;
        });

        ctaButton.addEventListener('keydown', function(e) {
            if (e.key === "Enter" || e.keyCode === 13) {
                e.preventDefault();

                var href = ctaButton.getAttribute('href');
                window.location.href = href;

                setTimeout(function() {
                    handleScrollDown();
                }, 1000);
            }
        });
    });

	})(jQuery);
	});

$(document).ready(function () {
(function ($) {
    var key = 'horizontal-draggable-content';

    function getOrUpdateData($element, update) {
        var data = $element.data(key) || {};

        if (update) {
            for (var property in update) {
                if (update.hasOwnProperty(property)) {
                    data[property] = update[property];
                }
            }
            $element.data(key, data);
        }

        return data;
    }

    function getTouchPoint(points, kind) {
        var sortedPoints = _.sortBy(points, 'pageX');

        if (kind === 'max') {
            return sortedPoints.pop();
        }

        return sortedPoints[0];
    }

    $.fn.horizontalDraggableContent = function (action) {
        this.each(function () {
            var element = this;
            var $element = $(element);

            if (action === 'destroy') {
                $element
                    .data(key, null)
                    .off('.' + key);
            } else {
                $element.on('mousedown.' + key + ' ' + 'touchstart.' + key, function (event) {
                    if ($(this).outerWidth() === $(event.target).outerWidth()) {
                        return;
                    }

                    var pageX;

                    if (event.type === 'touchstart') {
                        pageX = getTouchPoint(event.originalEvent.changedTouches).pageX;
                    } else {
                        pageX = event.pageX;
                    }

                    getOrUpdateData($(this), {
                        isStarted: true,
                        delta: 0,
                        startX: pageX - this.offsetLeft,
                        scrollLeft: this.scrollLeft
                    });
                });

                $element.on('mouseleave.' + key + ' mouseup.' + key + ' touchend.' + key, function (event) {
                    if (event.type !== 'mouseup') {
                        getOrUpdateData($(this), {
                            isStarted: false,
                            delta: 0
                        });
                    }
                });

                $element.on('click.' + key, function (event) {
                    var data = getOrUpdateData($(this));

                    if (!data.isStarted) {
                        return;
                    }

                    if (Math.abs(data.delta) > 1) {
                        event.preventDefault();
                    }

                    getOrUpdateData($(this), {
                        isStarted: false,
                        delta: 0
                    });
                });

                $element.on('mousemove.' + key + ' touchmove.' + key, function (event) {
                    var data = getOrUpdateData($(this));

                    if (!data.isStarted) {
                        return;
                    }

                    var pageX;

                    if (event.type === 'touchmove') {
                        pageX = getTouchPoint(event.originalEvent.changedTouches).pageX;
                    } else {
                        pageX = event.pageX;
                    }

                    getOrUpdateData($(this), {
                        delta: pageX - this.offsetLeft - data.startX
                    });

                    var x = pageX - this.offsetLeft;
                    var walk = (x - data.startX) * 2;

                    this.scrollLeft = data.scrollLeft - walk;
                });
            }
        });

        return this;
    };

    var STFED = window.STFED || {};
    var scrollFn = function () {
        if (initAll()) {
            document.removeEventListener('scroll', scrollFn);
        }
    };

    function initAll() {
        var $components = $('.js-horizontal-draggable-content:not(.is-initialized)').each(function () {
            var $element = $(this);

            if ($element.isVisibleInViewport()) {
                $element.addClass('is-initialized');

                $element.horizontalDraggableContent();
            }
        });
        var nonInitializedCount = $components.filter(':not(.is-initialized)').length;

        return nonInitializedCount === 0;
    }

    STFED.initHorizontalDraggableContent = function () {
        if (!initAll()) {
            document.addEventListener('scroll', scrollFn);
        }
    };

    $(function () {
        STFED.initHorizontalDraggableContent();
    });
})(jQuery);
});

(function ($) {
    $(function () {
        var areDynamicBlocksExist = Boolean($('[id^="dynamic_include_filter_div_"]').length);

        var checkDynamicIncludeCompletedNavigationTabs = setInterval(function() {
                var slingDynamicIncludeBlocks = $('[id^="dynamic_include_filter_div_"]');
                if (slingDynamicIncludeBlocks && !slingDynamicIncludeBlocks.length) {
                    clearInterval(checkDynamicIncludeCompletedNavigationTabs);
                    initializeNavigationTabs();

                    if (areDynamicBlocksExist) {
                        emitCustomEvent('dynamicBlocksInNavTabsLoaded');
                    }
                }
        }, 100);

        var initializeNavigationTabs = function(){

            function getPageContent(context) {
                return $('[data-page-content="' + $(context).data('tab-id') + '"], [data-page-content="' + $(context).data('content') + '"]');
            }

            function isAjaxLoading(pageContent) {
                var contentUrl = $(pageContent).data('content-url');

                return typeof contentUrl != 'undefined' && contentUrl && contentUrl !== '#';
            }


            $('.js-navigation-tabs-context').each(function () {
                var $context = $(this);
                var $pageContent = getPageContent(this);

                if (!isAjaxLoading($pageContent) && $pageContent.find('[data-quicklinks-title]').length === 0 && $pageContent.find('.ng-module').length === 0) {
                    $context.addClass('is-empty');
                }
            });
        }

        $(document).on('slider-tab-changed', function (event) {
            var data = _.defaults({ sliderId: undefined, tabId: undefined }, event.originalEvent.detail);

            if (data.sliderId === 'st-nav-tabs--step-1') {
                $('.js-navigation-tabs-context:not(.is-empty)').each(function () {
                    var $context = $(this);
                    var state = $context.data('tab-id') === data.tabId || $context.data('content') === data.tabId;

                    $context.toggleClass('hidden', !state);

                    if (state) {
                        window.emitCustomEvent('context-was-switched', {
                            tabId: data.tabId
                        }, this);
                    }
                });
            }
        });
    });
})(jQuery);

(function ($) {
    $(function () {
        $('.js-tabs-search').each(function () {
            var $component = $(this);
            var $page = $component.closest('[data-page-content]');
            var tabId = $page.data('page-content');
            var $tab = $('.js-st-tab-content[data-content="' + tabId + '"]');
            var $togglers = $page.add($tab).find('.st-button-toggler');
            var $navigationSearchResults = $page.find('.js-navigation-search-results');
            var $navigationSearchResultsTable = $('.st-table--resources table', $navigationSearchResults);
            var $loadMore = $navigationSearchResults.find('.st-table-load-more');
            // searching for element in different components
            var $errorElement = $()
                .add($tab)
                .add('.js-navigation-tabs-context[data-tab-id="' + tabId + '"]')
                .find('.search-error');
            var $partnersCountrySelectorItem = $tab.find('.js-partners-country-selector')
                .closest('.st-nav-search-bar-item');
            var contextData = {
                location: null,
                hierarchyLevel: 0,
                resourceType: '',
                resourceCategory: '',
                hierarchyCategoryTitle: '',
                hierarchyCategoryValue: '',
                searchQuery: '',
                searchFilterFiletype: '',
                searchFilterUpdate: '',
                navTabContentId: '',
                productId: '',
                associatedTo: '',
                showSuppliedByST: false,
                limit: 20,
                start: 0,
                solrEndpoint: $tab.find('.st-nav-search-bar').data('solr-endpoint') || '',
                prmisId: $component.data('prmisId'),
                lazyLoad: false,
                loadedDocs: 0,
                isSearched: false
            };
            var isVisible = $page.is(':visible');
            var searching;
            var isActive = STUtils.isActiveTabLink(tabId);

            var onLazyLoadMore = _.debounce(function () {
                if (!searching) {
                    var scrollTop = $(window).scrollTop();
                    var lazyLoadOffset = $loadMore.offset().top;

                    if (scrollTop >= lazyLoadOffset || (scrollTop + $(window).height()) >= lazyLoadOffset) {
                        var $wrapper = $navigationSearchResultsTable.closest('.dataTables_wrapper');
                        $wrapper.css('min-height', $wrapper.height());
                        contextData.start += contextData.limit;
                        searching = doSearch(false);
                        searching.then(function () {
                            searching = null;
                        });
                    }
                }
            }, 100);

            $(document).on('hierarchy-category-select', function (event) {
                var detail = event.originalEvent.detail;

                setSearchErrorVisibility(false);

                if (isVisible || isActive) {
                    contextData.hierarchyLevel = detail.hierarchyLevel;
                    contextData.resourceType = detail.resourceType;
                    contextData.resourceCategory = detail.resourceCategory;
                    contextData.hierarchyCategoryTitle = detail.hierarchyCategoryTitle;
                    contextData.hierarchyCategoryValue = detail.hierarchyCategoryValue;
                    if (typeof detail.prmisId != 'undefined') {
                        contextData.prmisId = detail.prmisId;
                    }
                    if (typeof detail.productId != 'undefined') {
                        contextData.productId = detail.productId;
                    }
                    if (typeof detail.associatedTo != 'undefined') {
                        contextData.associatedTo = detail.associatedTo;
                    }
                    if (typeof detail.navTabContentId != 'undefined') {
                        contextData.navTabContentId = detail.navTabContentId;
                    }

                    $page.attr('data-hierarchy-level', contextData.hierarchyLevel);

                    if ((typeof contextData.level === 'undefined' || contextData.level === 0) && contextData.searchQuery) {
                        setTimeout(function () {
                            search().then(function () {
                                updateTableWidth();
                            });
                        }, 0);
                    }
                }
            });

            $(document).on('become-visible', function (event) {
                if ($(event.target).closest('[data-page-content]').has($component).length > 0) {
                    isVisible = true;

                    $page.attr('data-hierarchy-level', contextData.hierarchyLevel);
                    if (contextData.searchQuery) {
                        $page.attr('data-search-query', contextData.searchQuery);
                    } else {
                        $page.removeAttr('data-search-query');
                    }

                    setTimeout(function () {
                        updateTableWidth();
                    }, 0);
                } else {
                    isVisible = false;
                }
            });

            $(document).on('set-search-query', function (event) {
                if (!isVisible) {
                    return;
                }

                var searchQuery = event.originalEvent.detail.searchQuery;

                contextData.searchQuery = typeof searchQuery == 'undefined'
                   ? ''
                   : searchQuery || '';

                if (contextData.searchQuery) {
                    $page.attr('data-search-query', contextData.searchQuery);
                } else {
                    $page.removeAttr('data-search-query');
                    $page.removeAttr('data-searching');
                }
            });

            $(document).on('set-search-filter', function (event) {
                if (!isVisible) {
                    return;
                }

                var filter = event.originalEvent.detail.filter;
                var value = event.originalEvent.detail.value;

                if (typeof filter != 'undefined') {
                    contextData[filter] = typeof value == 'undefined'
                        ? ''
                        : value;
                }

                var details = {};
                Object.defineProperty(details, filter, {value: value});
                emitCustomEvent('make-search', details);
            });

            $(document).on('search make-search', function (event) {
                var detail = event.detail;
                var searchFilterFiletype = detail.searchFilterFiletype;
                var searchFilterUpdate = detail.searchFilterUpdate;
                var searchQuery = detail.searchQuery;

                var canBeSearched = searchQuery || searchFilterFiletype || searchFilterUpdate;

                if (!isVisible) {
                    return;
                } else if ($errorElement.length && contextData.searchQuery.length < 1 && !canBeSearched) {
                    setSearchErrorVisibility(true);
                    setLazyLoadMore(false);
                    if (contextData.isSearched) {
                       count();
                    }
                    return;
                }
                
                contextData.isSearched = true;
                setSearchErrorVisibility(false);
                
                if (!contextData.hierarchyLevel) {
                    contextData.hierarchyLevel = event.originalEvent.detail.hierarchyLevel || 0;
                }
                if (!contextData.resourceType) {
                    contextData.resourceType = event.originalEvent.detail.resourceType || '';
                }
                if (!contextData.searchFilterFiletype) {
                    contextData.searchFilterFiletype = event.originalEvent.detail.searchFilterFiletype || '';
                }
                if (!contextData.searchFilterUpdate) {
                    contextData.searchFilterUpdate = event.originalEvent.detail.searchFilterUpdate || '';
                }
                if (!contextData.resourceCategory) {
                    contextData.resourceCategory = event.originalEvent.detail.resourceCategory || '';
                }
                if (!contextData.hierarchyCategoryTitle) {
                    contextData.hierarchyCategoryTitle = event.originalEvent.detail.hierarchyCategoryTitle || '';
                }
                if (!contextData.hierarchyCategoryValue) {
                    contextData.hierarchyCategoryValue = event.originalEvent.detail.hierarchyCategoryValue || '';
                }
                if (event.originalEvent.detail.solrEndpoint) {
                    contextData.solrEndpoint = event.originalEvent.detail.solrEndpoint;
                }
                if (event.originalEvent.detail.prmisId) {
                    contextData.prmisId = event.originalEvent.detail.prmisId;
                }
                if (event.originalEvent.detail.navTabContentId) {
                    contextData.navTabContentId = event.originalEvent.detail.navTabContentId;
                }
                if (event.originalEvent.detail.productId) {
                    contextData.productId = event.originalEvent.detail.productId;
                }
                if (event.originalEvent.detail.associatedTo) {
                    contextData.associatedTo = event.originalEvent.detail.associatedTo;
                }
                if (event.originalEvent.detail.showSuppliedByST) {
                    contextData.showSuppliedByST = event.originalEvent.detail.showSuppliedByST;
                }

                if ((typeof contextData.level === 'undefined' || contextData.hierarchyLevel === 0) && event.type === 'search') {
                    search().then(function () {
                        updateTableWidth();
                        count();
                    });
                } else if (event.type === 'make-search') {
                    emitCustomEvent('search', [
                        'hierarchyLevel',
                        'searchFilterFiletype',
                        'searchFilterUpdate',
                        'resourceType',
                        'resourceCategory',
                        'searchQuery',
                        'solrEndpoint',
                        'prmisId',
                        'navTabContentId',
                        'productId',
                        'associatedTo',
                        'showSuppliedByST'
                    ].reduce(function (map, key) {
                        var value = contextData[key];

                        if (value) {
                            map[key] = value;
                        }

                        return map;
                    }, {}));
                }
            });

            $(window).on('resize', _.debounce(function () {
                updateTableWidth();
            }, 250));

            $(document).on('sidebar-was-opened sidebar-was-closed', function () {
                updateTableWidth();
            });

            $(document).on('make-search-reset', function (event) {
                if (!isVisible) {
                    return;
                }

                contextData.location = null;
                contextData.searchQuery = '';
                contextData.searchFilterFiletype = '';
                contextData.searchFilterUpdate = '';
                contextData.showSuppliedByST = false;
                contextData.isSearched = false;

                $togglers.attr('data-state', false);
                $page.removeAttr('data-searching');
                $page.removeAttr('data-search-query');

                setSearchErrorVisibility(false);
                updateTableWidth();

                if (event.type === 'make-search-reset') {
                    emitCustomEvent('search-reset', _.pick(contextData,
                        [
                            'prmisId',
                            'hierarchyLevel',
                            'resourceType',
                            'resourceCategory',
                            'navTabContentId',
                            'productId',
                            'associatedTo',
                            'searchFilterFiletype',
                            'searchFilterUpdate',
                            'showSuppliedByST'
                        ]
                    ));
                }
            });

            $(document).on('toggled', function (event) {
                if (!isVisible) {
                    return;
                }

                var variable = event.originalEvent.detail.variable;
                var state = event.originalEvent.detail.state;

                if (typeof variable != 'undefined') {
                    contextData[variable] = typeof state == 'undefined'
                        ? ''
                        : state || '';
                }

                if (contextData.showSuppliedByST) {
                    $page.attr('data-search-togglers', true);
                } else {
                    $page.removeAttr('data-search-togglers');
                }

                setTimeout(function () {
                    updateTableWidth();
                    emitCustomEvent('make-search');
                }, 0);
            });

            $(document).on('make-hierarchy-category-select', function (event) {
                const detail = event.originalEvent.detail;
                const datasetInfo = {
                    dataset : event.target.dataset
                };

                if (isVisible || isActive) {
                    emitCustomEvent('hierarchy-category-select',
                        _.merge({}, _.pick(contextData, [
                            'searchFilterFiletype',
                            'searchFilterUpdate',
                            'searchQuery',
                            'showSuppliedByST'
                        ]), detail, datasetInfo)
                    );
                }
            });

            $(document).on('tab-submenu-become-visible context-was-switched', function (event) {
                var detail = event.originalEvent.detail;

                isActive = typeof detail.tabId !== 'undefined' && tabId === detail.tabId;
            });

            $(document).on('partners-country-selected', function (event) {
                if (event.originalEvent.detail.tabId === undefined || event.originalEvent.detail.tabId == tabId) {
                    if (event.originalEvent.detail.prmisId) {
                        contextData.prmisId = event.originalEvent.detail.prmisId;
                    }
                    contextData.location = event.originalEvent.detail.type ? {
                        type: event.originalEvent.detail.type,
                        name: event.originalEvent.detail.name
                    } : null;

                    if (isVisible) {
                        search();
                    }
                }
            });

            function search() {
                return doSearch(true);
            }

            var originalCategories = {};

            function count() {
                var allData = {
                    q: contextData.searchQuery,
                    autosuggestion: 0,
                    lang: document.documentElement.lang || 'en',
                    limit: 999999,
                    start: contextData.start,
                    prmisId: contextData.prmisId,
                    navTabContentId: contextData.navTabContentId
                };
                var categories = {};

                if (allData.q.length) {
                    $.getJSON(contextData.solrEndpoint, allData).then(function (json) {
                        var docs = _.get(json, 'response.docs', []);
                        var found = +_.get(json, 'response.numFound', 0);

                        return [docs, found];
                    }).then(function (response) {
                        var results = response[0];
                        var found = response[1];

                        results.forEach(function (item) {
                            var category = item.taxo_class.toLowerCase().replace(' ', '_');
                            if (category in categories) {
                                categories[category] += 1;
                            } else {
                                categories[category] = 1;
                            }
                        });

                        changeCategoryCounter();
                    })
                } else {
                    changeCategoryCounter();
                }


                function changeCategoryCounter() {
                    $links = $(document).find('.st-resources-hierarchy:visible').find('.st-link');

                    $links.each(function () {
                        var $link = $(this);
                        var resourceType = $link.data('resourcetype') || undefined;

                        if (resourceType) {
                            var resourceTypeCount = categories[resourceType] || 0;

                            if (!originalCategories[resourceType]) {
                                originalCategories[resourceType] = $link.children('.st-nav-tabs__count').text();
                            }
                            if (allData.q.length) {
                                $link.children('.st-nav-tabs__count').text('(' + resourceTypeCount + ')');
                            } else {
                                $link.children('.st-nav-tabs__count').text(originalCategories[resourceType]);
                            }
                        }
                    })
                }
            }

            function doSearch(clear) {
                var $wrapper = $navigationSearchResultsTable.closest('.dataTables_wrapper');
                var data = {
                    q: contextData.searchQuery,
                    autosuggestion: 0,
                    lang: document.documentElement.lang || 'en',
                    limit: contextData.limit,
                    start: contextData.start,
                    prmisId: contextData.prmisId,
                    navTabContentId: contextData.navTabContentId
                };

                if (contextData.location) {
                    data.locationType = contextData.location.type;
                    data.manufacturer = 'ST';
                    if (contextData.location.type !== 'worldwide') {
                        data.locationName = contextData.location.name;
                    }
                }

                if (clear) {
                    data.start = contextData.loadedDocs = contextData.start = 0;
                    $(window).off('scroll', onLazyLoadMore);
                    $wrapper.css('min-height', 'auto');
                }

                if (contextData.searchQuery) {
                    $page.attr('data-search-query', contextData.searchQuery);
                } else {
                    $page.removeAttr('data-search-query');
                }

                if (contextData.showSuppliedByST) {
                    data.manufacturer = 'ST';
                }

                if (!contextData.solrEndpoint) {
                    return $.when(true);
                }

                toggleSpinner(true, contextData.loadedDocs === 0);

                $page.attr('data-searching', true);

                return $.getJSON(contextData.solrEndpoint, data).then(function (json) {
                    var docs = _.get(json, 'response.docs', []);
                    var found = +_.get(json, 'response.numFound', 0);

                    contextData.loadedDocs += docs.length;

                    setLazyLoadMore(found);

                    return [docs, found];
                }).then(function (response) {
                    var results = response[0];
                    var found = response[1];
                    var dt = $navigationSearchResultsTable.DataTable();
                    var onDraw = function () {
                        dt.off('draw', onDraw);
                        if (clear && contextData.lazyLoad) {
                            $(window).on('scroll', onLazyLoadMore);
                        }
                    };

                    if (clear) {
                        dt.clear();
                    }

                    var multipleDownload = !!results.find(function (result) {
                        return result.localized && result.localized.length > 1;
                    });

                    toggleSpinner(false);

                    dt.on('draw', onDraw);

                    dt.rows.add(results.map(function (result, idx) {
                        var localized = result.localized || [
                            {
                                link: _.get(result, 'link.0', ''),
                                title: result.doc_id || result.rpn || '',
                                desc: result.title_man || '',
                                file_id: result.id || result.file_id || idx,
                                lang: result.lang || 'en',
                                availability: result.availability || ''

                            }
                        ];
                        return {
                            'multipleDownload': multipleDownload,
                            'icon': result.file_extension === 'pdf' ? 'datasheet' : result.file_extension || '',
                            'fileType': result.file_extension || '',
                            'type': result.taxo_class || '',
                            'localized': localized,
                            'version': result.version || '',
                            'supported_devices': result.supported_devices,
                            'license_type': result.license_type || '',
                            'manufacturer': result.manufacturer || ''
                        };
                    })).draw();

                    $navigationSearchResults.find('.total .value').html(found + ' total entries' + (contextData.searchQuery ? ' <span>for ' + contextData.searchQuery + '</span>' : ''));
                }).fail(function (error) {
                    toggleSpinner(false);
                });
            }

            function toggleSpinner(state, initialLoad) {
                $navigationSearchResults.find('> .st-row')
                    .toggle(!_.defaultTo(initialLoad, false));

                if (state) {
                    $navigationSearchResults.append('<div class="st-loading-spinner"></div>');
                } else {
                    $navigationSearchResults.find('.st-loading-spinner').remove();
                }
            }

            function updateTableWidth() {
                if (isVisible && $navigationSearchResultsTable.length > 0) {
                    $navigationSearchResultsTable.attr('style', '');
                    STFED.runOnDataTableInit($navigationSearchResultsTable, function () {
                        STFED.keepPageLength($navigationSearchResultsTable,
                            $navigationSearchResultsTable.DataTable()).draw();
                    });
                }
            }

            function setLazyLoadMore(totalCount) {
                if (totalCount === false || contextData.loadedDocs >= totalCount) {
                    contextData.lazyLoad = false;
                    $(window).off('scroll', onLazyLoadMore);
                } else {
                    contextData.lazyLoad = true;
                }
                if (totalCount !== false) {
                    $loadMore.find('.count').text(contextData.loadedDocs + ' of ' + totalCount + ' files are shown');
                }
            }

            function setSearchErrorVisibility(isVisible) {
                if (isVisible) {
                    $errorElement.show()
                } else {
                    $errorElement.hide()
                }

            }

            function emptySearchQueryIsAllowed() {
                var selectorsContainerSelector = '.resource_selector_container';
                var $container = $component.parent();

                // if tab contains selectors component on particular level or globally empty search is allowed
                var $selectorsComponent = $()
                    .add($container.find('> ' + selectorsContainerSelector))
                    .add($container.find('.render-in-level[data-level' + contextData.hierarchyLevel + '] > ' + selectorsContainerSelector));

                if ($selectorsComponent.length > 0) {
                    return true;
                }

                return false;
            }
        });
    });
})(jQuery);

(function ($) {
    $(function () {
        function init(context) {
            var contextEl = typeof context == 'undefined' ? document : context;

            $('.js-tables-search:not([data-initialized])', contextEl).each(function () {
                var $component = $(this);
                var $page = $component.closest('[data-page-content]');
                var tabId = $page.data('page-content');
                var $tables = $page.find('table');
                var $tab = $('.js-st-tab-content[data-content="' + tabId + '"]');
                var $context = $('.js-navigation-tabs-context[data-tab-id="' + tabId + '"]');
                var $togglers = $page.add($tab).add($context).find('.st-button-toggler');
                var $partnersCountrySelectorItem = $context.find('.js-partners-country-selector')
                    .closest('.st-nav-search-bar-item');
                var contextData = {
                    searchQuery: '',
                    location: null,
                    searchFilterFiletype: '',
                    searchFilterUpdate: '',
                    navTabContentId: '',
                    showSuppliedByST: false
                };
                var hasYearDropdown = $(this).is('[data-update-years-dropdown="true"], [data-update-years-dropdown]');
                var isVisible = getVisibility();
                var scrollToDebounce = _.debounce(function() {scrollToPageSection($tables.get(0), true)}, 300)

                $component.attr('data-initialized', true);

                $tables.filter('.first-table').on('order.dt', function () {
                    var $self = $(this);

                    STFED.runOnDataTableInit($self, function () {
                        var dt = $self.DataTable();

                        if (dt) {
                            var order = dt.order();

                            $tables.filter('.same-order:not(.first-table)').each(function () {
                                var $other = $(this);

                                STFED.runOnDataTableInit($other, function () {
                                    var otherDt = $other.DataTable();

                                    if (otherDt) {
                                        STFED.keepPageLength($other, otherDt.order(order)).draw();
                                    }
                                });
                            });
                        }
                    });
                });

                if (hasYearDropdown) {
                    // since <select> may lie in tab content instead of context we add it to jQuery selector
                    var $listContainers = $context.add($tab);
                    var $selects = $listContainers.add(
                        $listContainers.find('.st-nav-search-bar').data('mobile-filters')
                    ).find('.js-nav-search-bar-select-latest-update select');

                    var latestUpdateYears = {};

                    $tables.find('td[data-latest-update]').each(function () {
                        latestUpdateYears[+$(this).data('latest-update')] = true;
                    });

                    $('option[value!=""]', $selects).remove();

                    _.sortBy(Object.keys(latestUpdateYears)).reverse().forEach(function (year) {
                        if (year && !isNaN(year)) {
                            $selects.append($('<option>').attr('value', year).text(year));
                        }
                    });

                    $selects.selectric('destroy');
                    $selects.selectric('init');
                }

                function convertDateFormat(dateStr) {
                    if (!dateStr || dateStr.trim() === "") return null;

                    let parts = dateStr.trim().split(" ");
                    if (parts.length !== 3) {
                        console.log(`Invalid Date Format: "${dateStr}"`);
                        return null;
                    }

                    let day = parts[0].padStart(2, "0");
                    let month = monthMap[parts[1].toLowerCase()] || null; // Ensure month exists
                    let year = parts[2];

                    if (!month) {
                        return null;
                    }

                    let formattedDate = `${year}-${month}-${day}`;
                    console.log(`Converted Date: "${dateStr}" -> "${formattedDate}"`);
                    return formattedDate;
                }

                function sortTablesByDate(descending = true, tables) {
                    /*var $component = $this;
                    var $page = $component.closest('[data-page-content]');
                    var $tables = $page.find('table');*/
                    tables.each(function () {
                        let $table = $(this).find("tbody");
                        let rows = $table.find("tr").detach().toArray();

                        rows.forEach((row, idx) => {
                            let dateText = $(row).find("td[data-custom-data-attribute]").attr("data-custom-data-attribute");
                            let convertedDate = convertDateFormat(dateText);
                        });

                        rows.sort((a, b) => {
                            let dateA = convertDateFormat($(a).find("td[data-custom-data-attribute]").attr("data-custom-data-attribute"));
                            let dateB = convertDateFormat($(b).find("td[data-custom-data-attribute]").attr("data-custom-data-attribute"));

                            if (!dateA || !dateB) {
                                return 0;
                            }

                            return descending ? new Date(dateB) - new Date(dateA) : new Date(dateA) - new Date(dateB);
                        });

                        rows.forEach((row, idx) => {
                            let dateText = $(row).find("td[data-custom-data-attribute]").attr("data-custom-data-attribute");
                            let convertedDate = convertDateFormat(dateText);
                        });

                        $table.append(rows);
                    });

                }

                const monthMap = {
                    "gen": "01", "feb": "02", "mar": "03", "apr": "04", "mag": "05", "giu": "06",
                    "lug": "07", "ago": "08", "set": "09", "ott": "10", "nov": "11", "dic": "12",
                    "jan": "01", "feb": "02", "mar": "03", "apr": "04", "may": "05", "jun": "06",
                    "jul": "07", "aug": "08", "sep": "09", "oct": "10", "nov": "11", "dec": "12"
                };

                /* STM-37024: Sort by date */
                sortTablesByDate(true, $tables);

                $(document).ready(function () {
                    // **Auto-sort on page load (Most Recent First)**
                    //sortTablesByDate(true);
                    // **Attach Sorting to a Button Click**
                    let descendingOrder = true;
                    $("#sortButton").on("click", function () {
                        descendingOrder = !descendingOrder;
                        sortTablesByDate(descendingOrder);
                    });
                });

                $(document).on('make-search-reset', function () {
                    if (isVisible) {
                        contextData.location = null;
                        contextData.showSuppliedByST = false;
                        contextData.searchQuery = '';

                        $togglers.attr('data-state', 'false');
    
                        doSearch('reset');
                    }
                });

                $(document).on('become-visible', function (event) {
                    if ($(event.target).has($component).length > 0) {
                        updateTableWidth();
                    }
                    isVisible = getVisibility();
                });

                $(document).on('context-was-switched', function (event) {
                    isVisible = getVisibility();
                });

                $(document).on('set-search-query', function (event) {
                    if (!isVisible) {
                        return;
                    }

                    var searchQuery = event.originalEvent.detail.searchQuery;

                    contextData.searchQuery = (typeof searchQuery == 'undefined'
                        ? ''
                        : searchQuery || '').toLowerCase();
                });

                $(document).on('set-search-filter', function (event) {
                    if (!isVisible) {
                        return;
                    }

                    var filter = event.originalEvent.detail.filter;
                    var value = event.originalEvent.detail.value;

                    if (typeof filter != 'undefined') {
                        contextData[filter] = typeof value == 'undefined'
                            ? ''
                            : value;
                    }

                    doSearch();
                });

                $(document).on('make-search', function (event) {
                    if (!isVisible) {
                        return;
                    }

                    var customSearch = typeof event.originalEvent.detail.customSearch != 'undefined'
                        && event.originalEvent.detail.customSearch;

                    if (!contextData.searchFilterFiletype) {
                        contextData.searchFilterFiletype = event.originalEvent.detail.searchFilterFiletype || '';
                    }
                    if (!contextData.searchFilterUpdate) {
                        contextData.searchFilterUpdate = event.originalEvent.detail.searchFilterUpdate || '';
                    }
                    if (event.originalEvent.detail.navTabContentId) {
                        contextData.navTabContentId = event.originalEvent.detail.navTabContentId;
                    }

                    if (customSearch) {
                        doSearch();
                    }
                });

                $(document).on('toggled', function (event) {
                    if (!isVisible) {
                        return;
                    }

                    var variable = event.originalEvent.detail.variable;
                    var state = event.originalEvent.detail.state;
                    var customSearch = typeof event.originalEvent.detail.customSearch != 'undefined'
                        && event.originalEvent.detail.customSearch;

                    if (typeof variable != 'undefined') {
                        contextData[variable] = typeof state == 'undefined'
                            ? ''
                            : state || '';
                    }

                    if (contextData.showSuppliedByST) {
                        contextData.location = null;
                    }

                    if (customSearch) {
                        doSearch();
                    }
                });

                function doSearch(mode) {
                    var deffereds = [];

                    $tables.each(function () {
                        var $table = $(this);
                        var dt = $(this).DataTable();
                        var maxVisibleItems = _.defaultTo($table.data('max-visible-items'), false);

                        //show spinner effect
                        STFED.preloader.show($table);

                        if (typeof dt != 'undefined' && dt) {
                            var deferred = $.Deferred();

                            deffereds.push(deferred);

                            var onDraw = function () {
                                dt.off('draw', onDraw);

                                var info = dt.page.info();
                                var $wrapper = $table.closest('.dataTables_wrapper');
                                var $title = $wrapper.prevAll('.st-table__subtitle-h3').first();
                                var $loadMoreWrapper = $wrapper.next('.st-table-load-more');
                                var totalRows = info.recordsDisplay;
                                var $accordionItem = $table.closest('li.has-children');
                                var $accordionItemLabel = $accordionItem.find('> label');

                                var titleText = $title.text().split(' (');

                                if (maxVisibleItems !== false) {
                                    var isAllDataVisible = maxVisibleItems > 0 && totalRows <= info.end;
                                    $title.text(titleText[0] + ' (' +
                                        (isAllDataVisible ? '' : info.end + ' of ') + totalRows + ')');
                                    $loadMoreWrapper.toggleClass('hidden', isAllDataVisible);
                                } else {
                                    $title.text(titleText[0] + ' (' + totalRows + ')');
                                    $loadMoreWrapper.addClass('hidden');
                                }

                                deferred.resolve(totalRows > 0, $table.closest('.dataTables_wrapper'), $title,
                                    $accordionItem, $accordionItemLabel);
                            };
                            dt.on('draw', onDraw);
                            $table.data('location', contextData.location);
                            $table.data('search-filter-filetype', contextData.searchFilterFiletype);
                            $table.data('search-filter-update', contextData.searchFilterUpdate);
                            $table.data('search-query', contextData.searchQuery);
                            $table.data('show-supplied-by-st', contextData.showSuppliedByST);
                            dt.page.len(maxVisibleItems !== false ? maxVisibleItems : -1).draw();
                        }

                        //remove spinner effect
                        STFED.preloader.hide($table);
                    });
    
                    STFED.expandOrCollapse.enable($tables, mode === 'reset' ? 'collapse' : 'expand');

                    $.when.apply($, deffereds).done(function () {
                        hasNoResults = true;

                       _.forEach(arguments, function (tableData) {
                          var hasRows = tableData[0];
                          var $table = $(tableData[1]);
                          var $title = $(tableData[2]);
                          var $accordionItem = $(tableData[3]);
                          var $accordionItemLabel = $(tableData[4]);

                          if (hasRows) {
                              hasNoResults = false;
                          }
                          if ($table.children('table:not(.has-header-button)').length){
                              $table.add($title).add($accordionItem).add($accordionItemLabel).toggle(hasRows);
                          }
                          $accordionItemLabel.toggleClass('label-in-empty-resultset', !hasRows);
                          $accordionItem.toggleClass('js-st-accordion-expanded', hasRows)
                              .find('input[type="checkbox"]').prop('checked', true);
                       });

                       if (hasNoResults) {
                           $(arguments[0][1]).add(arguments[0][3]).toggle(true);
                       }

                        updateTableWidth();
                    });

                    var checked = $tables.find('.js-tables-multiple-download-checkbox:checked').length;

                    $page.find('.js-tables-multiple-download-button').find('button').html('Download (' + checked + ')');

                    scrollToDebounce()
                }

                function updateTableWidth() {
                    if (isVisible) {
                        $tables.each(function () {
                            var $table = $(this);

                            $table.attr('style', '');
                            STFED.runOnDataTableInit($table, function () {
                                STFED.keepPageLength($table,
                                    $table.DataTable().columns.adjust()).draw();
                            });
                        });
                    }
                }

                function getVisibility() {
                    if ($context.length > 0) {
                        var $activeTab = $('.js-st-tabs [data-nav-tab-id].js-st-active .st-tabs-tab');

                        return $activeTab.length > 0 && $context.data('tab-id') === $activeTab.data('tab');
                    } else {
                        return $page.is(':visible');
                    }
                }

                $context.on('partners-country-selected', function (event) {
                    if (event.originalEvent.detail.tabId === undefined || event.originalEvent.detail.tabId == tabId) {
                        contextData.location = event.originalEvent.detail.type ? {
                            type: event.originalEvent.detail.type,
                            name: event.originalEvent.detail.name
                        } : null;

                        if (isVisible) {
                            doSearch();
                        }
                    }
                });

                $(document).on('sidebar-was-opened sidebar-was-closed', function () {
                    updateTableWidth();
                });

                enquire.register(STFED.mediaQueries.mediumMax, {
                    match : function() {
                        updateTableWidth();
                    },
                    unmatch : function() {
                        updateTableWidth();
                    }
                });
            });
        }

        init();

        $(document).on('become-visible', function (event) {
           init(event.target);
        });
    });
})(jQuery);

$(function() {

    $(document).ready(function(){
        var checkDynamicIncludeCompletedMobileNavigation = setInterval(function(){
            var slingDynamicIncludeBlocks = $('[id^="dynamic_include_filter_div_"]');
            if (slingDynamicIncludeBlocks && !slingDynamicIncludeBlocks.length) {
                setupMobileNavigation();
                clearInterval(checkDynamicIncludeCompletedMobileNavigation);
            }
        }, 300);
    });

    var setupMobileNavigation = function(){
        window.STFED = STFED || {};
            STFED.preventIOsScrollingUnorderedLists = $();
            var navigationElements = $('.st-side-navigation');

            $('.js-nav-bottom-off-canvas-toggle').click(function(event) {
                currenScrollPosition();
                var docHeight = window.innerHeight;
                var target = $(this).data("target");
                var navContentEl = $('.st-side-navigation--bottom[data-target-nav='+target+']');
                jQuery('html,body').animate({scrollTop:0},0);
                navContentEl.addClass('st-side-navigation--bottom-active').find('ul.st-inactive').removeClass('st-inactive');
                STFED.viewPortHeightFix.toggleElementHeight(docHeight, navigationElements);
                $('body').addClass('noscroll');

                if (navigator.userAgent.match(/(iPod|iPhone|iPad)/)) {
                    STFED.preventIOsScrollingUnorderedLists = navContentEl.find(' > ul').add(navContentEl.find('li.has-submenu > ul'));
                    //For iOs only when scrolling reaches the top/bottom end of scrollable element and user still keeps swiping - scrolling might be locked while user is still swiping and ~2-3s after the last swipe
                    /*
                    preventScrollLockIOs();
                    */
                }
                // Close to prevent conflicts in scrolling
                closeMobileSearch();
            });

            $('.js-nav-bottom-off-canvas-close').click(function(event) {
                var docHeight = window.innerHeight;
                closeNavBottom();
                STFED.viewPortHeightFix.toggleElementHeight(docHeight, navigationElements);
                keepScrollPosition();
            });

            $('.has-submenu a').click(function(event) {
                jQuery('.off-canvas-list').animate({scrollTop:0},0);
            });

            //close nav menu on bottom when menu on the right opens
            $(document).on('open.fndtn.offcanvas', '[data-offcanvas]', function () {
                if($('.st-side-navigation--bottom-active').length) {
                    closeNavBottom();
                }
            });

            $('.js-st-search-toggle, .st-nav--small').click(function() {
                if($(".off-canvas-wrap").hasClass("move-right")) {
                    $('.off-canvas-wrap').find('.left-off-canvas-toggle').click();
                }
            });

            $(".st-side-navigation--bottom li span, .st-off-canvas-fixed li span").click(function(e){
                if($(e.target).closest("li").length){
                    if(!$(e.target).closest("li").hasClass("back")){
                        var nestedSubMenu = $($(e.target).closest("li").find("ul")[0]);
                        nestedSubMenu.css("display", "block");
                        if (nestedSubMenu.length)  {
                            $(e.target).closest("ul").addClass("st-inactive")[0].scrollTop = 0;;
                        }
                        setTimeout(function(){
                            nestedSubMenu.addClass("move-right-withdisplaynone");
                        }, 0);
                    } else {
                        var closestSubMenu = $(e.target).closest("ul");
                        closestSubMenu.removeClass("move-right-withdisplaynone").parents('ul').first().removeClass('st-inactive');
                        setTimeout(function(){
                            closestSubMenu.css("display", "none");
                        }, 500);
                    }
                }
            });
        }
});

function preventScrollLockIOs() {
    STFED.preventIOsScrollingUnorderedLists.each(function(i, el) {
        //if called twice - prevent extra event handlers from being added
        el.removeScrollListeners && el.removeScrollListeners();

        var touch = {ts: 0, tm: 0};
        var touchStartElListener = function(e) {
            touch.ts = e.touches[0].clientY;
            e.stopPropagation();
        }
        var touchMoveElListener = function(e) {
            var $el = $(e.currentTarget);
            touch.tm = e.touches[0].clientY;
            if (touch.tm - touch.ts > 0) {
                if ($(e.currentTarget).scrollTop() == 0) {
                    e.preventDefault();
                    return;
                }
            }
            if (touch.tm - touch.ts < 0) {
                //swipe down -> up
                if (el.scrollHeight - $el.scrollTop() - $el.height() <= 1) {
                    e.preventDefault();
                }
            }
            e.stopPropagation();
        }

        el.addEventListener('touchstart', touchStartElListener, {passive: false});
        el.addEventListener('touchmove', touchMoveElListener, {passive: false});

        el.removeScrollListeners = function() {
            el.removeEventListener('touchstart', touchStartElListener, {passive: false});
            el.removeEventListener('touchmove', touchMoveElListener, {passive: false});
            el.removeScrollListeners = null;
        }
    });
}

function closeNavBottom() {
    $('.st-side-navigation--bottom').removeClass('st-side-navigation--bottom-active');
    $('body').removeClass('noscroll');

    //remove tocuhstart/touchend listeners from scrollable lists once it is hidden
    if(STFED.preventIOsScrollingUnorderedLists !== null && STFED.preventIOsScrollingUnorderedLists !== undefined) {
        STFED.preventIOsScrollingUnorderedLists.each(function(i, el) {
            el.removeScrollListeners && el.removeScrollListeners();
        });
        STFED.preventIOsScrollingUnorderedLists = $();
    }
}

var currentScrollPosition = 0;

function currenScrollPosition() {
    currentScrollPosition =  $(window).scrollTop();
}

function keepScrollPosition() {
    $(window).scrollTop(currentScrollPosition);
}

var STFED = STFED || {};

STFED.nghScope = {};
STFED.nghAsideScope = {};

STFED.toggleDevZoneSubpanelMenu = function(event){
	$(event.target).closest(".st-nav__menu-link-devzone").toggleClass("devzone-submenu-opened");
}

STFED.toggleAsideMenu = function(){
	$(".st-header--mobile .st-svg--burger-js").hide();
	$("body").addClass("noscroll");
	$(".st-header--mobile .st-header__inner .st-svg--close-js").show();
	$(".st-crew-aside-main").addClass("st-side-navigation--bottom-active");
	$(".stcrew-aside-language-menu-mobile").addClass("aside-expanded");
}

document.querySelectorAll('.js-nav-bottom-off-canvas-toggle').forEach(el => {
    el.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            STFED.toggleAsideMenu();
            STFED.runNgHeader();
            setTimeout(() => {
                attivaAccessFocus();
            }, 200);
        }
    });
});

document.querySelectorAll('.js-nav-bottom-off-canvas-close').forEach(el => {
    el.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {

            const backAsideSelector = '.back.st-side-submenu__back.st-crew-back-aside .focusSpan_2';

            if ($(backAsideSelector).is(':visible')) {
                $(backAsideSelector).click();
            }

            const selectors = [
                '.back.st-side-submenu__back .focusSpanSecTy_4',
                '.back.st-side-submenu__back .focusSpanSecTy_3',
                '.back.st-side-submenu__back .focusSpanSecTy_2'
            ];

            selectors.forEach((selector, index) => {
                if ($(selector).is(':visible')) {
                    for (let i = index; i < selectors.length; i++) {
                        $(selectors[i]).click();
                    }
                    return false;
                }
            });

            $(".st-header--mobile .st-svg--burger-js").show();
            $("body").removeClass("noscroll");
            $(".st-header--mobile .st-header__inner .st-svg--close-js").hide();
            $(".st-crew-aside-main").removeClass("st-side-navigation--bottom-active");
            $(".stcrew-aside-language-menu-mobile").removeClass("aside-expanded");
            document.querySelectorAll('ul#languagemenu_aside a.st-header-menu__link')
                .forEach(link => {
                    link.setAttribute('tabindex', '-1');
                    link.setAttribute('aria-hidden', 'true');
            });

            $(".st-svg--close-js.js-nav-bottom-off-canvas-close")
                 .attr('tabindex', '-1');
            $(".st-nav__item.js-nav-bottom-off-canvas-toggle")
                .focus()
                .attr('tabindex', '0')
                .attr('aria-expanded', 'false');

            $('span[class*="focusSpan_"]').each(function() {
                let $this = $(this);
                $this.attr('aria-hidden', 'true')
                    .removeAttr('tabindex')
                    .removeClass(function(index, className) {
                        return (className.match(/focusSpan_\d+/g) || []).join(' ');
                    });
            });

            $('span[class*="focusSpanSecTy_"]').each(function() {
                let $this = $(this);
                $this.attr('aria-hidden', 'true')
                    .removeAttr('tabindex')
                    .removeClass(function(index, className) {
                        return (className.match(/focusSpanSecTy_\d+/g) || []).join(' ');
                    });
            });
        }
    });
});

$(document).on('click', '.js-nav-bottom-off-canvas-close', function () {
    $(".st-svg--close-js.js-nav-bottom-off-canvas-close").attr('tabindex', '-1');
    $(".st-nav__item.js-nav-bottom-off-canvas-toggle").attr('tabindex', '0').attr('aria-expanded', 'false');;
});


//ACCESSIBILITY FOCUS HAMBURGER MENU MOBILE
function setupInitialFocus() {
    $(".st-nav__item.js-nav-bottom-off-canvas-toggle").attr('tabindex', '-1').attr('aria-expanded', 'true');;
    $(".js-nav-bottom-off-canvas-close").attr('tabindex', '0');

    document.querySelectorAll('ul#languagemenu__static a')
        .forEach(link => {
            link.setAttribute('tabindex', '-1');
            link.setAttribute('aria-hidden', 'true');
    });

    document.querySelectorAll('ul#languagemenu_aside a.st-header-menu__link')
        .forEach(link => {
            link.setAttribute('tabindex', '0');
            link.setAttribute('aria-hidden', 'false');
    });
}

function attivaAccessFocus() {
    setupInitialFocus();
    enableAccessSpans();
    enableAccessSpansSecTy();
}

function enableAccessSpans() {
    const accessSpans = document.querySelectorAll('li.js-accessFocusTabIndex > span');
    const accessSpansSecInLev = document.querySelectorAll('li.js-js-accessFocusTabIndexSecondLev > span');

    accessSpans.forEach(span => {
        let baseUl = span.closest('ul');

        let depth = 1;
        let parent = baseUl.parentElement;

        while (parent) {
            if (parent.tagName.toLowerCase() === 'ul') {
                depth++;
            }
            parent = parent.parentElement;
        }

        span.setAttribute('tabindex', '0');
        span.setAttribute('aria-hidden', 'false');
        span.classList.add(`focusSpan_${depth}`);
    });

    accessSpansSecInLev.forEach(span => {
        let baseUl = span.closest('ul');

        let depth = 1;
        let parent = baseUl.parentElement;

        while (parent) {
            if (parent.tagName.toLowerCase() === 'ul') {
                depth++;
            }
            parent = parent.parentElement;
        }

        span.setAttribute('tabindex', '0');
        span.setAttribute('aria-hidden', 'false');
        span.classList.add(`focusSpanSecLev_${depth}`);
    });

    if (accessSpansSecInLev.length > 0) {
        accessSpansSecInLev[0].focus();
    }

    if (accessSpans.length > 0) {
        accessSpans[0].focus();
    }
}

function enableAccessSpansSecTy() {
    const accessSpansSecTy = document.querySelectorAll('li.js-accessFocusTabIndexSecondLev > span');

    accessSpansSecTy.forEach(span => {
        let baseUl = span.closest('ul');

        let depth = 1;
        let parent = baseUl.parentElement;

        while (parent) {
            if (parent.tagName.toLowerCase() === 'ul') {
                depth++;
            }
            parent = parent.parentElement;
        }

        span.setAttribute('tabindex', '0');
        span.setAttribute('aria-hidden', 'false');
        span.classList.add(`focusSpanSecTy_${depth}`);
    });
}

document.addEventListener('keydown', function (e) {
    if (e.key !== 'Enter') return;

    const activeElement = e.target;

    // focusSpan_1
    if (activeElement.classList.contains('focusSpan_1')) {
        activeElement.click();
        document.querySelectorAll('span.focusSpan_1').forEach(span => {
            span.removeAttribute('tabindex');
            span.setAttribute('aria-hidden', 'true');
        });
        document.querySelectorAll('span.focusSpanSecTy_1').forEach(span => {
            span.removeAttribute('tabindex');
            span.setAttribute('aria-hidden', 'true');
        });

        setTimeout(() => {
            let containerUL = findClosestValidAncestorUl(activeElement);
            if (containerUL) {
                const subUL = activeElement.parentElement.querySelector('ul');
                if (subUL) assignFocusSpanLevels(subUL);
            }

            const accessSpansLiv2 = document.querySelectorAll('span.focusSpan_2');
            lastFocusedSpan_1 = activeElement;
            if (accessSpansLiv2.length > 0) {
                accessSpansLiv2[1].focus();
            }
        }, 350);
    }

    // focusSpanSecTy_1
    else if (activeElement.classList.contains('focusSpanSecTy_1')) {
        activeElement.click();
        document.querySelectorAll('span.focusSpanSecTy_1').forEach(span => {
            span.removeAttribute('tabindex');
            span.setAttribute('aria-hidden', 'true');
        });
        document.querySelectorAll('span.focusSpan_1').forEach(span => {
            span.removeAttribute('tabindex');
            span.setAttribute('aria-hidden', 'true');
        });

        setTimeout(() => {
            let containerUL = findClosestValidAncestorUl(activeElement);
            if (containerUL) {
                const subUL = activeElement.parentElement.querySelector('ul');
                if (subUL) assignFocusSpanLevelsSecTy(subUL);
            }

            const accessSpansLiv2SecTy = document.querySelectorAll('span.focusSpanSecTy_2');
            lastFocusedSpanSecTy_1 = activeElement;
            if (accessSpansLiv2SecTy.length > 1) {
                accessSpansLiv2SecTy[1].focus();
            }
        }, 350);
    }

    // focusSpan_2
    else if (activeElement.classList.contains('focusSpan_2')) {
        const parentLi = activeElement.closest('li.back.st-side-submenu__back.st-crew-back-aside');
        if (parentLi) {
            document.querySelectorAll('li.submenu-to-expand.productlist-opened span.focusSpan_3').forEach(span => span.click());
            document.querySelectorAll('span.focusSpan_4').forEach(span => {
                span.removeAttribute('tabindex');
                span.setAttribute('aria-hidden', 'true');
                span.classList.remove('focusSpan_4');
            });
            document.querySelectorAll('li.productlist-opened span.focusSpan_2').forEach(span => span.click());
            document.querySelectorAll('span.focusSpan_3').forEach(span => {
                span.removeAttribute('tabindex');
                span.setAttribute('aria-hidden', 'true');
                span.classList.remove('focusSpan_3');
            });
            document.querySelectorAll('span.focusSpan_2').forEach(span => span.removeAttribute('tabindex'));
            const back = document.querySelector('li.back.st-side-submenu__back.st-crew-back-aside span.focusSpan_2');
            if (back) back.click();
            document.querySelectorAll('span.focusSpan_2').forEach(span => span.classList.remove('focusSpan_2'));
            document.querySelectorAll('span.focusSpan_1').forEach(span => {
                span.setAttribute('tabindex', '0');
                span.setAttribute('aria-hidden', 'false');
            });
            document.querySelectorAll('span.focusSpanSecTy_1').forEach(span => {
                span.setAttribute('tabindex', '0');
                span.setAttribute('aria-hidden', 'false');
            });
            if (lastFocusedSpan_1) {
                lastFocusedSpan_1.focus();
            }
        } else {
            const parentLi = activeElement.closest('li');
            const nestedUL = parentLi ? parentLi.querySelector('ul') : null;
            if (nestedUL) {
                const focusSpan3 = nestedUL.querySelectorAll('span.focusSpan_3');
                if (focusSpan3.length > 0 && focusSpan3[0].hasAttribute('tabindex')) {
                    const opened = Array.from(focusSpan3).map(span => span.closest('li.submenu-to-expand.productlist-opened')).find(li => li);
                    if (opened) {
                        const spanToClick = opened.querySelector('span.focusSpan_3');
                        if (spanToClick) {
                            spanToClick.click();
                            opened.querySelectorAll('span.focusSpan_4').forEach(span => {
                                span.removeAttribute('tabindex');
                                span.setAttribute('aria-hidden', 'true');
                            });
                        }
                    }
                    focusSpan3.forEach(span => {
                        span.removeAttribute('tabindex');
                        span.setAttribute('aria-hidden', 'true');
                    });
                    activeElement.click();
                    activeElement.focus();
                } else {
                    activeElement.click();
                    focusSpan3.forEach(span => {
                        span.setAttribute('tabindex', '0');
                        span.setAttribute('aria-hidden', 'false');
                    });
                    if (focusSpan3.length > 0) focusSpan3[0].focus();
                }
            }
        }
    }

    // focusSpanSecTy_2
    else if (activeElement.classList.contains('focusSpanSecTy_2')) {
        const isBack = activeElement.closest('li.back.st-side-submenu__back');
        if (isBack) {
            document.querySelectorAll('span.focusSpanSecTy_3, span.focusSpanSecTy_2').forEach(span => {
                span.removeAttribute('tabindex');
                span.setAttribute('aria-hidden', 'true');
            });
            const back = document.querySelector('li.back.st-side-submenu__back span.focusSpanSecTy_2');
            if (back) back.click();
            document.querySelectorAll('span.focusSpanSecTy_2').forEach(span => span.classList.remove('focusSpanSecTy_2'));
            document.querySelectorAll('span.focusSpanSecTy_3').forEach(span => span.classList.remove('focusSpanSecTy_3'));
            document.querySelectorAll('span.focusSpanSecTy_1').forEach(span => {
                span.setAttribute('tabindex', '0');
                span.setAttribute('aria-hidden', 'false');
            });

            document.querySelectorAll('span.focusSpan_1').forEach(span => {
                span.setAttribute('tabindex', '0');
                span.setAttribute('aria-hidden', 'false');
            });
            if (lastFocusedSpanSecTy_1) {
                lastFocusedSpanSecTy_1.focus();
            }
        } else {
            const parentLi = activeElement.closest('li');
            const nestedUL = parentLi ? parentLi.querySelector('ul') : null;
            activeElement.click();
            setTimeout(() => {
                document.querySelectorAll('span.focusSpanSecTy_2').forEach(span => {
                    span.removeAttribute('tabindex');
                    span.setAttribute('aria-hidden', 'true');
                });
                if (!nestedUL) return;
                const focusSpan3 = nestedUL.querySelectorAll('span.focusSpanSecTy_3');
                lastFocusedSpanSecTy_2 = activeElement;
                focusSpan3.forEach(span => {
                    span.setAttribute('tabindex', '0');
                    span.setAttribute('aria-hidden', 'false');
                });
                if (focusSpan3.length > 0) focusSpan3[0].focus();
            }, 100);
        }
    }

    // focusSpan_3
    else if (activeElement.classList.contains('focusSpan_3')) {
        const parentLi = activeElement.closest('li');
        const nestedUL = parentLi ? parentLi.querySelector('ul') : null;
        if (nestedUL) {
            const focusSpan4 = nestedUL.querySelectorAll('span.focusSpan_4');
            if (focusSpan4.length > 0) {
                if (focusSpan4[0].hasAttribute('tabindex')) {
                    focusSpan4.forEach(span => {
                        span.removeAttribute('tabindex');
                        span.setAttribute('aria-hidden', 'true');
                    });
                    activeElement.click();
                    activeElement.focus();
                } else {
                    activeElement.click();
                    focusSpan4.forEach(span => {
                        span.setAttribute('tabindex', '0');
                        span.setAttribute('aria-hidden', 'false');
                    });
                    focusSpan4[0].focus();
                }
            } else {
                activeElement.click();
            }
        } else {
            activeElement.click();
        }
    }

    // focusSpanSecTy_3
    else if (activeElement.classList.contains('focusSpanSecTy_3')) {
        const isBack = activeElement.closest('li.back.st-side-submenu__back');
        if (isBack) {
            document.querySelectorAll('span.focusSpanSecTy_3').forEach(span => {
                span.removeAttribute('tabindex');
                span.setAttribute('aria-hidden', 'true');
            });
            const back = activeElement.closest('ul')?.parentElement?.querySelector('li.back span.focusSpanSecTy_3');
            if (back) back.click();
            document.querySelectorAll('span.focusSpanSecTy_2').forEach(span => {
                span.setAttribute('tabindex', '0');
                span.setAttribute('aria-hidden', 'false');
            });
            if (lastFocusedSpanSecTy_2) {
                lastFocusedSpanSecTy_2.focus();
            }
        }
        else {
            activeElement.click();
            setTimeout(() => {
                document.querySelectorAll('span.focusSpanSecTy_3').forEach(span => {
                    span.removeAttribute('tabindex');
                    span.setAttribute('aria-hidden', 'true');
                });
                const parentLi = activeElement.closest('li');
                const nestedUL = parentLi ? parentLi.querySelector('ul') : null;
                if (nestedUL) {
                    assignFocusSpanLevelsSecTy(nestedUL, 3);
                    lastFocusedSpanSecTy_3 = activeElement;
                    const focusSpan4 = nestedUL.querySelectorAll('span.focusSpanSecTy_4');

                    document.querySelectorAll('span.focusSpanSecTy_4').forEach(span => {
                        span.setAttribute('tabindex', '0');
                        span.setAttribute('aria-hidden', 'false');
                    });
                    if (focusSpan4.length > 0) focusSpan4[0].focus();
                }
            }, 100);
        }
    }

    // focusSpan_4
    else if (activeElement.classList.contains('focusSpan_4')) {
        activeElement.click();

    }

    // focusSpanSecTy_4
    else if (activeElement.classList.contains('focusSpanSecTy_4')) {
        const isBack = activeElement.closest('li.back.st-side-submenu__back');
        if (isBack) {
            const back = activeElement.closest('ul')?.parentElement?.querySelector('li.back span.focusSpanSecTy_4');
            if (back) back.click();
            document.querySelectorAll('span.focusSpanSecTy_4').forEach(span => {
                span.removeAttribute('tabindex');
                span.setAttribute('aria-hidden', 'true');
                span.classList.remove('focusSpanSecTy_4');
            });
            document.querySelectorAll('span.focusSpanSecTy_3').forEach(span => {
                span.setAttribute('tabindex', '0');
                span.setAttribute('aria-hidden', 'false');
            });
            if (lastFocusedSpanSecTy_3) {
                lastFocusedSpanSecTy_3.focus();
            }
        }
        else {
            activeElement.click();

        }
    }
});

document.addEventListener('keydown', function (e) {
    if (e.key !== 'Escape') return;

    const activeElement = e.target;

    const resetSpanList = (selector, classPattern) => {
        document.querySelectorAll(selector).forEach(span => {
            span.removeAttribute('tabindex');
            span.setAttribute('aria-hidden', 'true');
            span.className = span.className.replace(classPattern, '');
        });
    };

    // focusSpan_1
    if (activeElement.classList.contains('focusSpan_1')) {
        resetSpanList('li.js-accessFocusTabIndex > span', /focusSpan_\d+/g);
        $(".st-header--mobile .st-svg--burger-js").show();
        $("body").removeClass("noscroll");
        $(".st-header--mobile .st-header__inner .st-svg--close-js").hide();
        $(".st-crew-aside-main").removeClass("st-side-navigation--bottom-active");
        $(".stcrew-aside-language-menu-mobile").removeClass("aside-expanded");
        $(".st-svg--close-js.js-nav-bottom-off-canvas-close").attr('tabindex', '-1');
        $(".st-nav__item.js-nav-bottom-off-canvas-toggle").attr('tabindex', '0').attr('aria-expanded', 'false').focus();
        document.querySelectorAll('ul#languagemenu_aside a.st-header-menu__link')
            .forEach(link => {
                link.setAttribute('tabindex', '-1');
                link.setAttribute('aria-hidden', 'true');
        });
        lastFocusedSpan_1 = activeElement;
    }

    // focusSpanSecTy_1
    else if (activeElement.classList.contains('focusSpanSecTy_1')) {
        resetSpanList('li.js-accessFocusTabIndexSecondLev > span', /focusSpanSecTy_\d+/g);
        $(".st-header--mobile .st-svg--burger-js").show();
        $("body").removeClass("noscroll");
        $(".st-header--mobile .st-header__inner .st-svg--close-js").hide();
        $(".st-crew-aside-main").removeClass("st-side-navigation--bottom-active");
        $(".stcrew-aside-language-menu-mobile").removeClass("aside-expanded");
        $(".st-svg--close-js.js-nav-bottom-off-canvas-close").attr('tabindex', '-1');
        $(".st-nav__item.js-nav-bottom-off-canvas-toggle").attr('tabindex', '0').attr('aria-expanded', 'false').focus();
        document.querySelectorAll('ul#languagemenu_aside a.st-header-menu__link')
            .forEach(link => {
                link.setAttribute('tabindex', '-1');
                link.setAttribute('aria-hidden', 'true');
        });
        lastFocusedSpanSecTy_1 = activeElement;
    }

    // focusSpan_2
    else if (activeElement.classList.contains('focusSpan_2')) {
        document.querySelectorAll('li.submenu-to-expand.productlist-opened span.focusSpan_3').forEach(span => span.click());
        document.querySelectorAll('span.focusSpan_4').forEach(span => {
            span.removeAttribute('tabindex');
            span.setAttribute('aria-hidden', 'true');
            span.classList.remove('focusSpan_4');
        });
        document.querySelectorAll('li.productlist-opened span.focusSpan_2').forEach(span => span.click());
        document.querySelectorAll('span.focusSpan_3').forEach(span => {
            span.removeAttribute('tabindex');
            span.setAttribute('aria-hidden', 'true');
            span.classList.remove('focusSpan_3');
        });
        document.querySelectorAll('span.focusSpan_2').forEach(span => {
            span.removeAttribute('tabindex');
            span.setAttribute('aria-hidden', 'true');
        });
        const back = document.querySelector('li.back.st-side-submenu__back.st-crew-back-aside span.focusSpan_2');
        if (back) back.click();
        document.querySelectorAll('span.focusSpan_2').forEach(span => span.classList.remove('focusSpan_2'));
        document.querySelectorAll('span.focusSpan_1').forEach(span => {
            span.setAttribute('tabindex', '0');
            span.setAttribute('aria-hidden', 'false');
        });
        document.querySelectorAll('span.focusSpanSecTy_1').forEach(span => {
            span.setAttribute('tabindex', '0');
            span.setAttribute('aria-hidden', 'false');
        });
        if (lastFocusedSpan_1) {
            lastFocusedSpan_1.focus();
        }
    }

    // focusSpanSecTy_2
    else if (activeElement.classList.contains('focusSpanSecTy_2')) {
        document.querySelectorAll('span.focusSpanSecTy_3, span.focusSpanSecTy_2').forEach(span => {
            span.removeAttribute('tabindex');
            span.setAttribute('aria-hidden', 'true');
        });
        const back = document.querySelector('li.back.st-side-submenu__back span.focusSpanSecTy_2');
        lastFocusedSpanSecTy_2 = activeElement;
        if (back) back.click();
        document.querySelectorAll('span.focusSpanSecTy_2').forEach(span => span.classList.remove('focusSpanSecTy_2'));
        document.querySelectorAll('span.focusSpanSecTy_3').forEach(span => span.classList.remove('focusSpanSecTy_3'));
        document.querySelectorAll('span.focusSpan_1').forEach(span => {
            span.setAttribute('tabindex', '0');
            span.setAttribute('aria-hidden', 'false');
        });
        document.querySelectorAll('span.focusSpanSecTy_1').forEach(span => {
            span.setAttribute('tabindex', '0');
            span.setAttribute('aria-hidden', 'false');
        });
        if (lastFocusedSpanSecTy_1) {
            lastFocusedSpanSecTy_1.focus();
        }
    }

    // focusSpan_3
    else if (activeElement.classList.contains('focusSpan_3')) {
        const liAncestor = activeElement.closest('li.submenu-to-expand');
        if (liAncestor && liAncestor.classList.contains('productlist-opened')) {
            activeElement.click();
            document.querySelectorAll('span.focusSpan_4').forEach(span => {
                span.removeAttribute('tabindex');
                span.setAttribute('aria-hidden', 'true');
            });
            activeElement.focus();
        } else {
            const span2 = activeElement.closest('ul')?.previousElementSibling;
            if (span2 && span2.classList.contains('focusSpan_2')) {
                document.querySelectorAll('span.focusSpan_3').forEach(span => {
                    span.removeAttribute('tabindex');
                    span.setAttribute('aria-hidden', 'true');
                });
                span2.click();
                span2.focus();
            }
        }
    }

    // focusSpanSecTy_3
    else if (activeElement.classList.contains('focusSpanSecTy_3')) {
        document.querySelectorAll('span.focusSpanSecTy_3').forEach(span => {
            span.removeAttribute('tabindex');
            span.setAttribute('aria-hidden', 'true');
        });
        const back = activeElement.closest('ul')?.parentElement?.querySelector('li.back span.focusSpanSecTy_3');
        lastFocusedSpanSecTy_3 = activeElement;
        if (back) back.click();
        document.querySelectorAll('span.focusSpanSecTy_2').forEach(span => {
            span.setAttribute('tabindex', '0');
            span.setAttribute('aria-hidden', 'false');
        });
        if (lastFocusedSpanSecTy_2) {
            lastFocusedSpanSecTy_2.focus();
        }
    }

    // focusSpan_4
    else if (activeElement.classList.contains('focusSpan_4')) {
        let parent = activeElement.parentElement;
        let span3 = null;
        while (parent && !span3) {
            span3 = parent.querySelector('span.focusSpan_3');
            parent = parent.parentElement;
        }
        if (span3) {
            const liAncestor = span3.closest('li.submenu-to-expand');
            if (liAncestor && liAncestor.classList.contains('productlist-opened')) {
                span3.click();
                document.querySelectorAll('span.focusSpan_4').forEach(span => {
                    span.removeAttribute('tabindex');
                    span.setAttribute('aria-hidden', 'true');
                });
            }
            span3.focus();
        }
    }

    // focusSpanSecTy_4
    else if (activeElement.classList.contains('focusSpanSecTy_4')) {
        const back = activeElement.closest('ul')?.parentElement?.querySelector('li.back span.focusSpanSecTy_4');
        if (back) back.click();
        document.querySelectorAll('span.focusSpanSecTy_4').forEach(span => {
            span.removeAttribute('tabindex');
            span.setAttribute('aria-hidden', 'true');
            span.classList.remove('focusSpanSecTy_4');
        });
        document.querySelectorAll('span.focusSpanSecTy_3').forEach(span => {
            span.setAttribute('tabindex', '0');
            span.setAttribute('aria-hidden', 'false');
        });
        if (lastFocusedSpanSecTy_3) {
            lastFocusedSpanSecTy_3.focus();
        }
    }
});

function findClosestValidAncestorUl(startElement) {
    let current = startElement.parentElement;

    while (current) {
        if (current.tagName.toLowerCase() === 'ul') return current;
        if (!['li', 'span'].includes(current.tagName.toLowerCase())) break;
        current = current.parentElement;
    }

    return null;
}

function assignFocusSpanLevels(baseUL, currentLevel = 1) {
    const listItems = baseUL.querySelectorAll(':scope > li');

    listItems.forEach(li => {
        const spans = Array.from(li.children)
            .flatMap(child => {
                if (child.tagName.toLowerCase() === 'span') {
                    return [child];
                } else if (child.tagName.toLowerCase() === 'label') {

                    return Array.from(child.querySelectorAll('span'));
                }
                return [];
            });

        spans.forEach(span => {
            span.classList.add(`focusSpan_${currentLevel + 1}`);
            if (currentLevel + 1 === 2) {
                span.setAttribute('tabindex', '0');
                span.setAttribute('aria-hidden', 'false');
            }
        });

        const nestedUL = Array.from(li.children).find(child => child.tagName.toLowerCase() === 'ul');
        if (nestedUL) {
            assignFocusSpanLevels(nestedUL, currentLevel + 1);
        }
    });
}

function assignFocusSpanLevelsSecTy(baseUL, currentLevel = 1) {
    const listItems = baseUL.querySelectorAll(':scope > li');

    listItems.forEach(li => {
        const spans = Array.from(li.children)
            .flatMap(child => {
                if (child.tagName.toLowerCase() === 'span') {
                    return [child];
                } else if (child.tagName.toLowerCase() === 'label') {
                    return Array.from(child.querySelectorAll('span'));
                }
                return [];
            });

        spans.forEach(span => {
            span.classList.add(`focusSpanSecTy_${currentLevel + 1}`);
            if (currentLevel + 1 === 2) {
                span.setAttribute('tabindex', '0');
                span.setAttribute('aria-hidden', 'false');
            }
        });

        const nestedUL = Array.from(li.children).find(child => child.tagName.toLowerCase() === 'ul');
        if (nestedUL) {
            assignFocusSpanLevelsSecTy(nestedUL, currentLevel + 1);
        }
    });
}

document.addEventListener('keydown', function (e) {
    const languageMenus = Array.from(document.querySelectorAll('#languagemenu_aside a.st-header-menu__link'));
    const firstLanguageMenu = languageMenus[0];
    const lastLanguageMenu = languageMenus[languageMenus.length - 1];

    if (e.key === 'Tab' && e.shiftKey && document.activeElement === firstLanguageMenu) {
        e.preventDefault();

        const allSpans = Array.from(document.querySelectorAll(
            'span.focusSpanSecTy_1[tabindex="0"], ' +
            'span.focusSpanSecTy_2[tabindex="0"], ' +
            'span.focusSpanSecTy_3[tabindex="0"], ' +
            'span.focusSpanSecTy_4[tabindex="0"], ' +
            'span.focusSpan_2[tabindex="0"], ' +
            'span.focusSpan_3[tabindex="0"], ' +
            'span.focusSpan_4[tabindex="0"]'
        )).filter(el => el.offsetParent !== null);

        const lastSpan = allSpans[allSpans.length - 1];
        if (lastSpan) lastSpan.focus();

        return;
    }

    if (e.key === 'Tab' && e.shiftKey) {
        const allSpans = Array.from(document.querySelectorAll(
            'span.focusSpan_1[tabindex="0"], ' +
            'span.focusSpanSecTy_2[tabindex="0"], ' +
            'span.focusSpanSecTy_3[tabindex="0"], ' +
            'span.focusSpanSecTy_4[tabindex="0"], ' +
            'span.focusSpan_2[tabindex="0"], ' +
            'span.focusSpan_3[tabindex="0"], ' +
            'span.focusSpan_4[tabindex="0"]'
        )).filter(el => el.offsetParent !== null);

        if (allSpans.length > 0 && document.activeElement === allSpans[0]) {
            e.preventDefault();
            const widgetSearch = document.querySelector('#widgetSearchBarMobile');
            if (widgetSearch) widgetSearch.focus();
            return;
        }
    }

    if (e.key === 'Tab' && !e.shiftKey && document.activeElement === lastLanguageMenu) {
        e.preventDefault();
        return;
    }

    const focusGroups = [
        'focusSpanSecTy_1',
        'focusSpan_2',
        'focusSpan_3',
        'focusSpan_4',
        'focusSpanSecTy_2[tabindex="0"]',
        'focusSpanSecTy_3[tabindex="0"]',
        'focusSpanSecTy_4[tabindex="0"]',
    ];

    if (e.key === 'Tab' && !e.shiftKey) {
        for (const selector of focusGroups) {
            const elements = Array.from(document.querySelectorAll(`span.${selector}`));
            if (elements.length > 0) {
                const last = elements[elements.length - 1];
                if (document.activeElement === last) {
                    e.preventDefault();
                    if (firstLanguageMenu) firstLanguageMenu.focus();
                    return;
                }
            }
        }
    }
});

function colorDevZoneTab(tab) {
    if(window.innerWidth > 1024) {
       if(AreInPage("stm32-mcu-developer-zone")  || AreInPage("stm32-mpu-developer-zone")  ||
              AreInPage("stm32cubemx")  || AreInPage("stm32cubeide") || AreInPage("st-edge-ai-suite") ) {
			$(".st-header-menu__link-with-submenu.st-nav__menu-item-devzone.ng-scope").css("background", "#ffd200")
			$(".st-header-menu__link-with-submenu.st-nav__menu-item-devzone.ng-scope").css("border-radius", "0 20px 0px 0px")
			var devZoneClassicContainers = $(".classic-container")
			console.log(devZoneClassicContainers)
            for(i = 0; i < devZoneClassicContainers.length; i++) {
                if(AreInPage("stm32-mcu-developer-zone") ) {
                    if((tab !== undefined && tab[0].id === "Top_Menu_About_Us") || devZoneClassicContainers[0].style.display === "none") {
						devZoneClassicContainers[0].style.display = "flex"
					}
                } else if(AreInPage("stm32-mpu-developer-zone") )  {
                    if((tab !== undefined && tab[0].id === "Top_Menu_About_Us") || devZoneClassicContainers[1].style.display === "none") {
						devZoneClassicContainers[1].style.display = "flex"
					}
                } else if(AreInPage("stm32cubemx") )  {
                    if((tab !== undefined && tab[0].id === "Top_Menu_About_Us") || devZoneClassicContainers[2].style.display === "none") {
						devZoneClassicContainers[2].style.display = "flex"
					}
                } else if(AreInPage("stm32cubeide") )  {
                   if((tab !== undefined && tab[0].id === "Top_Menu_About_Us") || devZoneClassicContainers[3].style.display === "none") {
						devZoneClassicContainers[3].style.display = "flex"
					}
				} else if(AreInPage("st-edge-ai-suite") )  {
					if((tab !== undefined && tab[0].id === "Top_Menu_About_Us") || devZoneClassicContainers[3].style.display === "none") {
						devZoneClassicContainers[3].style.display = "flex"
					}
				}
			}

		}
	}
}

function unsetDevZoneTab(tab) {
    if(window.innerWidth > 1024) {
        if(AreInPage("stm32-mcu-developer-zone")  || AreInPage("stm32-mpu-developer-zone")  ||
		   AreInPage("stm32cubemx")  || AreInPage("stm32cubeide") || AreInPage("st-edge-ai-suite")) {
			$(".st-header-menu__link-with-submenu.st-nav__menu-item-devzone.ng-scope").css("background", "unset")
			$(".st-header-menu__link-with-submenu.st-nav__menu-item-devzone.ng-scope").css("border-radius", "unset")
			var devZoneClassicContainers = $(".classic-container")
			console.log(devZoneClassicContainers)
            if(tab !== undefined && tab[0].id === "Top_Menu_About_Us") {
                for(i = 0; i < devZoneClassicContainers.length; i++) {
                    if(AreInPage("stm32-mcu-developer-zone") ) {
						devZoneClassicContainers[0].style.display = "none"
                    } else if(AreInPage("stm32-mpu-developer-zone") )  {
						devZoneClassicContainers[1].style.display = "none"
                    } else if(AreInPage("stm32cubemx") )  {
						devZoneClassicContainers[2].style.display = "none"
                    } else if(AreInPage("stm32cubeide") )  {
						devZoneClassicContainers[3].style.display = "none"
					} else if(AreInPage("st-edge-ai-suite") )  {
						devZoneClassicContainers[3].style.display = "none"
					}
				}
			}

		}
	}
}

STFED.angularInitializedDesktop = false;
STFED.angularInitializedMobile = false;

STFED.runHeaderController = function(){
	if(window.innerWidth <= 1024){

		STFED.stHeaderAppHeaderAsideControllerFn = function($scope, $filter, $timeout, $compile, $location) {
			STFED.nghAsideScope = $scope;
			$scope.ngMenuAside = [{'icon': 'menu-fill', 'htmlId': 'Top_Menu', 'activityMapRegion': 'Top_Menu', 'target_nav': 'st-menu', 'children':  []}];

			$scope.extractSecondaryNavigationLevelFromDOM = function(){
				$(".st-header-mobile__nav-links .st-header-menu > li.st-header-menu__item:not(.has-submenu):not(.st-header-menu__item_cart_wrap)").each(function(){
					var url = $(this).find(".st-header-menu__link").attr('href');
					var title = $(this).find(".st-header-menu__link span").text().trim();
					var selectorCSS = 'stcrew-nav-secondarylevels';
					var children = [];
					if($(this).find(".st-header-menu__st-submenu").length){
						$(this).find(".st-header-menu__st-submenu li").each(function(){
							var title = $(this).find(".st-nav__submenu-link").text().trim();
							var url = $(this).find(".st-nav__submenu-link").attr("href");
							children.push({'title': title, 'url': url});
						})
					}
					const titleExist = $scope.ngMenuAside[0].children.some(child => child.title === title);
					const isTablet = window.matchMedia("(max-width: 1024px)").matches;

					if (!titleExist && isTablet) {
						$scope.ngMenuAside[0].children.push({'title': title, 'url': url, 'children': children, 'selectorCSS': selectorCSS});
					}
				})
			}


			$scope.toggleSubNavAccordion = function(event){
				var hiddenPanel = $(event.target).parent().find("> .crew-asideaccordions-submenulist")[0];
				$(event.target).parent().toggleClass("productlist-opened");
				if (hiddenPanel.style.maxHeight) {
					hiddenPanel.style.maxHeight = null;
				} else {
					hiddenPanel.style.maxHeight = hiddenPanel.scrollHeight + "px";
					var parentHiddenPanel = $(hiddenPanel).closest(".crew-asideaccordions-submenulist")[0];
					var topParentHiddenPanels = $(hiddenPanel).closest(".crew-asideaccordions-submenulist").parent().closest(".crew-asideaccordions-submenulist")[0];
			    	if(topParentHiddenPanels){
						topParentHiddenPanels.style.height = "auto";
						topParentHiddenPanels.style.maxHeight = "100%";
					} else {
						parentHiddenPanel.style.maxHeight = parseInt(parentHiddenPanel.style.maxHeight) + hiddenPanel.scrollHeight + "px";
					}
				}
			}

			$scope.getSubLevelForAside = function(menuItem, $event){
				var needEvalAsync = false;
				if(!menuItem.levs || !menuItem.levs.length){
					needEvalAsync = true;
					menuItem.levs = [];
					_.forEach(menuItem.children, function(level){
						var lev = {title: level.title, titleEn: level.titleEn, url: level.url, children: level.children};
						menuItem.levs.push(lev);
					});
					if(!menuItem.children || !menuItem.children.length){
						s_objectID=$event.target.dataset['activitymapText'];
					}
				}
				_.forEach(menuItem.levs, function(lev){
					if(lev.children && lev.children.length && (!lev.levs || !lev.levs.length)){
						needEvalAsync = true;
						lev.levs = [];
						_.forEach(lev.children, function(sublevel){
							lev.levs.push({title: sublevel.title, titleEn: sublevel.titleEn, url: sublevel.url, children: sublevel.children});
						});
					}
				});
				if(needEvalAsync){
					$scope.$evalAsync();
					$timeout(function(){
						var submenuToClick;
						if($event){
							submenuToClick = $event.target;
						}
						$scope.initMenu(submenuToClick);
					}, 0, false);
				}
			};

			$scope.initMenu = function(element){
				$(".st-side-navigation--bottom li span, .st-off-canvas-fixed li span").click(function(e){
			        if($(e.target).closest("li").length){
			            if(!$(e.target).closest("li").hasClass("back")){
							var nestedSubMenu = $($(e.target).closest("li").find("ul")[0]);
							nestedSubMenu.css("display", "block");
			                if (nestedSubMenu.length)  {
								$(e.target).closest("ul").addClass("st-inactive")[0].scrollTop = 0;;
							}
			                setTimeout(function(){
								nestedSubMenu.addClass("move-right-withdisplaynone");
							}, 0);
						} else {
							var closestSubMenu = $(e.target).closest("ul");
							closestSubMenu.removeClass("move-right-withdisplaynone").parents('ul').first().removeClass('st-inactive');
			                setTimeout(function(){
								closestSubMenu.css("display", "none");
							}, 500);
						}
					}
				});

			    $('.js-nav-bottom-off-canvas-close:not(.init-ng)').click(function(event) {
					var docHeight = window.innerHeight;
					closeNavBottom();
					STFED.viewPortHeightFix.toggleElementHeight(docHeight, $('.st-side-navigation'));
					keepScrollPosition();
				});
			    $('.js-nav-bottom-off-canvas-close:not(.init-ng)').each(function(){
					$(this).addClass("init-ng");
				});

			    if(element){
			    	$timeout(function(){
						$(element).click();
					}, 0, false);
				}
			};

			_.forEach(STFED.menuTree, function(item){
				$scope.ngMenuAside[0].children.push(item);
				$("[data-target='st-menu']").click(function(){
					$scope.getSubLevelForAside($(this));
				});
			});

			$scope.extractSecondaryNavigationLevelFromDOM();

			$timeout(function(){
				var closeAccountAsideMenuButton = $("[data-target-nav='account'] .js-nav-bottom-off-canvas-close");
				var closeAccountAsideMenuButtonEvents = $._data(closeAccountAsideMenuButton[0], "events");
				if(closeAccountAsideMenuButtonEvents){
					if(closeAccountAsideMenuButtonEvents.click && closeAccountAsideMenuButtonEvents.click.length){
						_.forEach(closeAccountAsideMenuButtonEvents.click, function(clickEvent){
							$('.ngHeaderAsideApp .js-nav-bottom-off-canvas-close').click(function(event){
								clickEvent.handler(event);
							});
						});
					}
				}
			}, 0, false);

		};
		STFED.stHeaderAppHeaderAsideControllerFn.$inject = ["$scope", "$filter", "$timeout", "$compile", "$location"];

		STFED.stHeaderApp.controller('headerAsideController', STFED.stHeaderAppHeaderAsideControllerFn);
		angular.bootstrap($(".ngHeaderAsideApp"), ['stHeaderApp']);
		STFED.angularInitializedMobile = true;
		removeTab();
	} else {

		STFED.stHeaderAppHeaderControllerFn = function($scope, $filter, $timeout, $compile, $location) {

			STFED.nghScope = $scope;

			$scope.ngMenu = [];

			_.forEach(STFED.menuTree, function(item){
				$scope.ngMenu.push({title: item.title, icon: item.icon, htmlId: item.htmlId, activityMapRegion: item.activityMapRegion, tabUrl: item.tabUrl});
			});

			$scope.getLevels = function(menuItem, $event){
				if(!menuItem.children){
					var secondLevel = $($($event.target).closest(".st-nav__menu-item").find("ul")[0]);
					var foundMenuItemByTitle = _.find(STFED.menuTree, {title: menuItem.title});
					menuItem.children = foundMenuItemByTitle.children;
					if(foundMenuItemByTitle.browseAllBtnLink){
						menuItem.browseAllBtnLink = foundMenuItemByTitle.browseAllBtnLink;
						menuItem.browseAllBtnText = foundMenuItemByTitle.browseAllBtnText;
						menuItem.browseAllBtnTextEn = foundMenuItemByTitle.browseAllBtnTextEn;
					}

					$scope.$evalAsync();
					secondLevel.addClass("st-nav__submenu-list").addClass("js-st-nav-submenu");
				}
			};

			$scope.toggleAboutUsSubPanel = function(event){
				var elemId = $(event.target).closest(".st-nav__submenu-item").attr("data-nav-item-menu-id");
				var closestWrapperSubMenu = $(event.target).closest(".st-nav__submenu-list-container");
				var aboutusSubPanel = closestWrapperSubMenu.find("[data-nav-item-submenu-id='" + elemId + "']");
				var leftPositionElement = $(event.target).closest(".st-nav__submenu-item").offset().left;
				$("[data-nav-item-submenu-id]").not(aboutusSubPanel).hide();
				aboutusSubPanel.css("left", leftPositionElement);
				aboutusSubPanel.toggle();
			}
		};
		STFED.stHeaderAppHeaderControllerFn.$inject = ["$scope", "$filter", "$timeout", "$compile", "$location"];

		STFED.stHeaderApp.controller('headerController', STFED.stHeaderAppHeaderControllerFn);
		angular.bootstrap($(".ngHeaderApp"), ['stHeaderApp']);
		STFED.angularInitializedDesktop = true;
		addTab(document.documentElement.lang);
		removeTab();
	}
};

function removeTab(){
	if ($('#Top_Menu_ST')){
		if (window.innerWidth > 1024 && $('#Top_Menu_ST')[0] != undefined && $('#Top_Menu_ST')[0].style != undefined && $('#Top_Menu_ST')[0].style.display != 'none'){
			$('#Top_Menu_ST')[0].style.display = 'none';
		}
		else if(window.innerWidth <= 1024 && $('#Top_Menu_ST')[0] != undefined && $('#Top_Menu_ST')[0].style != undefined && $('#Top_Menu_ST')[0].style.display == 'none'){
			$('#Top_Menu_ST')[0].style.display = 'block';
		}
	}
}

STFED.runNgHeader = function(event){
	STFED.ngAsideMenuTabs.unbind("touchstart mouseover mousedown", STFED.runNgHeader);
	STFED.ngMenuTabs.unbind("touchstart mouseover mousedown", STFED.runNgHeader);

	STFED.runNgHeaderInterval = setInterval(function(){
		if(typeof _ !== "undefined" && typeof angular !== "undefined"){
			clearInterval(STFED.runNgHeaderInterval);

			STFED.stHeaderApp = angular.module('stHeaderApp', ["ngSanitize"]);

			STFED.stHeaderAppConfigFn = function ($httpProvider) {
				$httpProvider.defaults.cache = true;
			};
			STFED.stHeaderAppConfigFn.$inject = ["$httpProvider"];
			STFED.stHeaderApp.config(['$httpProvider', STFED.stHeaderAppConfigFn]);

			STFED.stHeaderApp.config(["$provide", function($provide){
				$provide.decorator("$browser", ["$delegate", "$window", function($delegate, $window){
					$delegate.onUrlChange = function(){};
					var previousUrl = null;
					$delegate.url = function(url){
						if(!!url){
							previousUrl = url;
							return $delegate;
						} else {
							return !!previousUrl ? previousUrl : $window.location.href;
						}
					};
					return $delegate;
				}])
			}]);

			STFED.stHeaderAppRunFn = function($rootScope, $location, $timeout){
				STFED.nghRootScope = $rootScope;
				STFED.nghLocation = $location;

			    $rootScope.$on('$locationChangeStart', function($event, next, current) {
			    });
			};
			STFED.stHeaderAppRunFn.$inject = ["$rootScope", "$location", "$timeout"];
			STFED.stHeaderApp.run(STFED.stHeaderAppRunFn);
			STFED.runHeaderController();
		}
	}, 50);
};

STFED.getMenuTreeIfStillNotLoaded = function(){
	STFED.ngMenuTabs.unbind("touchstart mouseover mousedown", STFED.getMenuTreeIfStillNotLoaded);
	STFED.ngAsideMenuTabs.unbind("touchstart mouseover mousedown", STFED.getMenuTreeIfStillNotLoaded);
	STFED.getMenuTreeAndBindNgHeaderEvents();
};

STFED.bindNgHeaderEvents = function(){
	STFED.ngMenuTabs.bind("touchstart mouseover mousedown", STFED.runNgHeader);
	STFED.ngAsideMenuTabs.bind("touchstart mouseover mousedown", STFED.runNgHeader);
};

STFED.getMenuTreeAndBindNgHeaderEvents = function(){
	var productsTitle = $(".st-nav__menu-link-products").text() || "Products";
	var toolsTitle = $(".st-nav__menu-link-tools").text() || "Tools & Software";
	var applicationsTitle = $(".st-nav__menu-link-applications").text() || "Applications";
	var solutionsTitle = $(".st-nav__menu-link-solutions").text() || "Solutions";
	var aboutTitle = $(".st-nav__menu-link-about").text() || "About ST";
	var languagePage = document.documentElement.lang || 'en';

	// Fallback to identity mapping
	let i18n = f => f;

	try {
		const locale = window.digitalData.page.attributes.language;

		if (locale) {
			window.Granite.I18n.setLocale(locale);

			// If we have everything we need, replace the dummy mapping with the
			// real i18n function
			i18n = window.Granite.I18n.get;
		}
		else {
			console.error("Failed to setup i18n mapping function");
		}

	}
	catch (_) {
		console.error("Failed to setup i18n mapping function");
	}


	var stm32Title = i18n("ST Developer Zone");
	var mcuChildren = [];
	var mpuChildren = [];
	var stm32items = [];
	var mcuChildren = [{titleEn: 'MCU Home', children: Array(0), title: 'MCU Home', url: '/content/st_com/'+languagePage+'/stm32-mcu-developer-zone.html'},
					   {titleEn: 'Jump start', children: Array(0), title: 'Jump start', url: '/content/st_com/'+languagePage+'/stm32-mcu-developer-zone/start-a-project-with-an-mcu.html'},
					   {titleEn: 'MCU Portfolio', children: Array(0), title: 'MCU Portfolio', url: '/content/st_com/'+languagePage+'/stm32-mcu-developer-zone/mcu-portfolio.html'},
					   {titleEn: 'Boards and Hardware tools', children: Array(0), title: 'Boards and Hardware tools', url: '/content/st_com/'+languagePage+'/stm32-mcu-developer-zone/boards-and-hardware-tools.html'},
					   {titleEn: 'Software development tools', children: Array(0), title: 'Software development tools', url: '/content/st_com/'+languagePage+'/stm32-mcu-developer-zone/software-development-tools.html'},
					   {titleEn: 'Embedded software', children: Array(0), title: 'Embedded software', url: '/content/st_com/'+languagePage+'/stm32-mcu-developer-zone/embedded-software.html'},
					   {titleEn: 'Solutions', children: Array(0), title: 'Solutions', url: '/content/st_com/'+languagePage+'/stm32-mcu-developer-zone/solutions.html'},
					   {titleEn: 'Developer resources', children: Array(0), title: 'Developer resources', url: '/content/st_com/'+languagePage+'/stm32-mcu-developer-zone/developer-resources.html'},
					   {titleEn: 'MCU Community', children: Array(0), title: 'MCU Community', url: 'https://community.st.com/s/topic/0TO0X000000BSqSWAW/stm32-mcus'}];
	var mpuChildren = [{titleEn: 'MPU Home', children: Array(0), title: 'MPU Home', url: '/content/st_com/'+languagePage+'/stm32-mpu-developer-zone.html'},
		{ titleEn: 'MPU Portfolio', children: Array(0), title: 'MPU Portfolio', url: '/'+languagePage +'/microcontrollers-microprocessors/stm32-arm-cortex-mpus/products.html'},
					   {titleEn: 'Boards and Hardware tools', children: Array(0), title: 'Boards and Hardware tools', url: '/content/st_com/'+languagePage+'/stm32-mpu-developer-zone/boards-and-hardware-tools.html'},
					   {titleEn: 'Embedded software', children: Array(0), title: 'Embedded software', url: '/content/st_com/'+languagePage+'/stm32-mpu-developer-zone/embedded-software.html'},
					   {titleEn: 'Software development tools', children: Array(0), title: 'Software development tools', url: '/content/st_com/'+languagePage+'/stm32-mpu-developer-zone/software-development-tools.html'},
					   {titleEn: 'Solutions', children: Array(0), title: 'Solutions', url: '/content/st_com/'+languagePage+'/stm32-mpu-developer-zone/solutions.html'},
					   {titleEn: 'Developer resources', children: Array(0), title: 'Developer resources', url: '/content/st_com/'+languagePage+'/stm32-mpu-developer-zone/developer-resources.html'},
					   {titleEn: 'MPU Community', children: Array(0), title: 'MPU Community', url: 'https://community.st.com/s/topic/0TO0X0000003u2AWAQ/stm32-mpus'}];
	var edgeAiSuiteChildren = [
		{titleEn: 'Home', children: Array(0), title: 'Home', url: '/content/st_com/'+languagePage+'/st-edge-ai-suite.html'},
		{titleEn: 'Case studies', children: Array(0), title: 'Case studies', url: '/content/st_com/'+languagePage+'/st-edge-ai-suite/case-studies.html'},
		{titleEn: 'Tools', children: Array(0), title: 'Tools', url: '/content/st_com/'+languagePage+'/st-edge-ai-suite/tools.html'},
		{titleEn: 'Community', children: Array(0), title: 'Community', url: languagePage === 'zh' ? 'https://shequ.stmicroelectronics.cn/' : 'https://community.st.com/t5/edge-ai/bd-p/edge-ai'}
	];

	var stm32items = [
		{titleEn: 'STM32 MCU Developer Zone', children: mcuChildren, title: 'STM32 MCU Developer Zone', url: '/content/st_com/'+languagePage+'/stm32-mcu-developer-zone.html'},
		{titleEn: 'STM32 MPU Developer Zone', children: mpuChildren, title: 'STM32 MPU Developer Zone', url: '/content/st_com/'+languagePage+'/stm32-mpu-developer-zone.html'},
        {titleEn: 'ST Edge AI Suite', children: edgeAiSuiteChildren, title: 'ST Edge AI Suite', url: '/content/st_com/'+languagePage+'/st-edge-ai-suite.html'},
		{titleEn: 'OUR FLAGSHIP DEVELOPMENT TOOLS', children: Array(0), title: 'OUR FLAGSHIP DEVELOPMENT TOOLS', url: ''},
		{titleEn: 'STM32CubeMX', children: Array(0), title: 'STM32CubeMX', url: '/content/st_com/'+languagePage+'/stm32cubemx.html'},
		{titleEn: 'STM32CubeIDE', children: Array(0), title: 'STM32CubeIDE', url: '/content/st_com/'+languagePage+'/stm32cubeide.html'}
    ];

	$.ajax({
		url: "/bin/st/top_menu." + languagePage + ".json",
		cache: true,
		success: function(data) {
			STFED.menuTree = [];
			STFED.menuTree.push({title: productsTitle, startAsideChildrenRepeat: false, icon: "all-products", target_nav: "products", htmlId: "Top_Menu_Products", activityMapRegion: "Products",
				children: data.products.items});
			STFED.menuTree.push({title: toolsTitle, icon: "tools", target_nav: "tools", startAsideChildrenRepeat: false, htmlId: "Top_Menu_Tools_and_Software", activityMapRegion: "Tools_and_Software",
				children: data.tools_and_software.items});
			STFED.menuTree.push({title: applicationsTitle, icon: "applications", target_nav: "applications", startAsideChildrenRepeat: false, htmlId: "Top_Menu_Applications", activityMapRegion: "Applications",
				children: data.applications.items});
			STFED.menuTree.push({title: solutionsTitle, icon: "edit", target_nav: "solutions", startAsideChildrenRepeat: false, htmlId: "Top_Menu_Solutions", activityMapRegion: "Solutions", children: data.solutions.items,
				browseAllBtnLink: data.solutions.browseAllBtnLink, browseAllBtnText: data.solutions.browseAllBtnText, browseAllBtnTextEn: data.solutions.browseAllBtnTextEn});
			if(window.innerWidth <= 1024){
				console.log("add tab mobile");
				STFED.menuTree.push({title: stm32Title, icon: "edit", htmlId: "Top_Menu_ST Developer Zone", activityMapRegion: "ST Developer Zone", children: stm32items, url: "/content/st_com/"+languagePage+"/stm32-mcu-developer-zone.html"});
			}
			if(window.innerWidth > 1024){
				console.log("add tab desktop");
				STFED.menuTree.push({title: stm32Title, target_nav: "devzone", icon: "butterfly-2", htmlId: "Top_Menu_ST Developer Zone",
				activityMapRegion: "ST Developer Zone", tabUrl: "/content/st_com/" + languagePage.toLowerCase() + "/stm32-mcu-developer-zone.html",
				url: "/content/st_com/" + languagePage.toLowerCase() + "/stm32-mcu-developer-zone.html"});
			}
			var eventSubMenu = _.find(data.about.items, {titleEn: "Events"});
			if(eventSubMenu && eventSubMenu.children){
				eventSubMenu.children = _.filter(eventSubMenu.children, function(o){ return o.titleEn != "" && o.titleEn != "events"});
			}
			STFED.menuTree.push({title: aboutTitle, icon: "about-us", htmlId: "Top_Menu_About_Us", activityMapRegion: "About_Us",
				children: data.about.items});
			STFED.bindNgHeaderEvents();
		},
		error: function(data) {
			console.log("There was an error getting the header menu");
		}
	});
};


var handleDynamicNavigation = function(el, event) {
    event.preventDefault();
    event.stopPropagation();

    var url = el.dataset.url;
    var title = el.dataset.title;
    var activitymapText = el.dataset.activitymapText;

    if (!url || title === 'OUR FLAGSHIP DEVELOPMENT TOOLS') return;

    if (activitymapText) {
        s_objectID = activitymapText;
    }

    window.location.href = url;
};

var removeBodyOverlay = function(tab){
	$("." + STFED.menuActiveClass).removeClass(STFED.menuActiveClass);
	$(".stm32-dropdown").removeClass("stm32-dropdown--active");
	$('.st-main__overlay').removeClass('st-main__overlay--active');
	$('body').removeClass('has-active-overlay');
	colorDevZoneTab(tab);
}

var toggleHeaderSubEntries = function(e){
	e.stopPropagation();
	removeBodyOverlay();
	var targetSubListWrapper = $(e.target).closest(".st-header-menu__link-with-submenu");
	$(".st-header-menu__link-with-submenu").not(targetSubListWrapper[0]).removeClass("submenu-opened");
	if(targetSubListWrapper.hasClass("submenu-opened")){
		targetSubListWrapper.removeClass("submenu-opened");
		$('.st-main__overlay').removeClass('st-main__overlay--active');
		$('body').removeClass('has-active-overlay');
	} else {
		targetSubListWrapper.addClass("submenu-opened");
		$('.st-main__overlay').addClass('st-main__overlay--active');
		$('body').addClass('has-active-overlay');
	}
}

document.addEventListener("DOMContentLoaded", function () {
	var headerMobileAuthElem = document.querySelector(".new-header #headerMobilePersonalized");

	if (headerMobileAuthElem) {
		headerMobileAuthElem.addEventListener("click", function () {
			var accountNav = document.querySelector("[data-target-nav='account']");

			if (accountNav) {
				accountNav.classList.remove("hidden");
				accountNav.classList.add("st-side-navigation--bottom-active");
				accountNav.style.top = "0";
			}
		});
	}
});

$(document).ready(function(){
	if(!STFED.menuTree && STFED.ngMenuTabs && STFED.ngMenuTabs.length){
		STFED.getMenuTreeAndBindNgHeaderEvents();
	}
	STFED.addTrackingClickHandlers();

	$(".fixed.st-off-canvas-fixed").append($(".stcrew-aside-language-menu-mobile"));

	$(".st-header__nav-links, .st-header__search, .st-header__quick, .st-main__overlay").click(function(){
		removeBodyOverlay();
		$("li.st-nav__menu_top_about_us [data-nav-item-submenu-id]").hide();
	})

	$("body").click(function(){
		$(".st-header-menu__link-with-submenu").removeClass("submenu-opened");
		$(".st-nav__menu-item--logged-in").find(".st-nav__submenu--small").hide();
	})

	$("#headerMobilePersonalized").click(function(e){
		e.stopPropagation();
		$("[data-target-nav='account']").removeClass("hidden");
		$("[data-target-nav='account']").addClass("st-side-navigation--bottom-active");
	})

    $("[data-target-nav='account'] .js-nav-bottom-off-canvas-close").click(function(){
		$("[data-target-nav='account']").addClass("hidden");
		$("[data-target-nav='account']").removeClass("st-side-navigation--bottom-active");
	})

	$(".st-nheader-search-icon-wrap").click(function(){
		$(this).closest(".st-header__search-wrap").addClass("st-search-activated");
        $('.st-nheader-search-icon-wrap').addClass('hidden').attr('tabindex', '-1');
        $('.st-nheader-search-icon-wrap-label').removeClass('hidden');
        document.querySelectorAll('.accessibilityFocusSearchMenu').forEach(el => {
          el.setAttribute('tabindex', '0');
          el.setAttribute('aria-hidden', 'false');
        });
		$("#widgetSearchBar").focus();
	});

    $('.st-nheader-search-icon-wrap').on('keydown', function(e) {
        if (e.key === 'Enter' || e.keyCode === 13) {
            $('.st-header__search-wrap').addClass('st-search-activated');
            $('.st-nheader-search-icon-wrap').addClass('hidden').attr('tabindex', '-1');
            $('.st-nheader-search-icon-wrap-label').removeClass('hidden');
            document.querySelectorAll('.accessibilityFocusSearchMenu').forEach(el => {
              el.setAttribute('tabindex', '0');
              el.setAttribute('aria-hidden', 'false');
            });
            setTimeout(updateBottomMenuTabIndexes, 100);
            setTimeout(updateSubmenuTabIndexes, 100);
            setTimeout(function() {
                $("#widgetSearchBar").focus();
            }, 200);
        }
    });

	$(".st-search-closeicon-wrap").click(function(){
		$(".st-search-activated").removeClass("st-search-activated");
        $('.st-nheader-search-icon-wrap-label').addClass('hidden');
        $('a.st-nheader-search-icon-wrap').removeClass('hidden').attr('tabindex', '0');
        document.querySelectorAll('.accessibilityFocusSearchMenu').forEach(el => {
          el.setAttribute('tabindex', '-1');
          el.setAttribute('aria-hidden', 'true');
        });
        setTimeout(updateBottomMenuTabIndexes, 100);
        setTimeout(updateSubmenuTabIndexes, 100);
	});

    $('.st-search-closeicon-wrap').on('keydown', function(e) {
        if (e.key === 'Enter' || e.keyCode === 13) {
            $('.st-search-activated').removeClass("st-search-activated");
            $('.st-nheader-search-icon-wrap-label').addClass('hidden');
            document.querySelectorAll('.accessibilityFocusSearchMenu').forEach(el => {
              el.setAttribute('tabindex', '-1');
              el.setAttribute('aria-hidden', 'true');
            });
            $('a.st-nheader-search-icon-wrap').removeClass('hidden').attr('tabindex', '0').focus();
            setTimeout(updateBottomMenuTabIndexes, 100);
            setTimeout(updateSubmenuTabIndexes, 100);
        }
    });

    document.querySelectorAll('.accessibilityFocusSearchMenu').forEach(el => {
        el.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' || event.key === 'Esc') {
                document.querySelectorAll('.accessibilityFocusSearchMenu').forEach(item => {
                    item.setAttribute('aria-hidden', 'true');
                    item.setAttribute('tabindex', '-1');
                });
                $('.st-search-activated').removeClass("st-search-activated");
                $('.st-nheader-search-icon-wrap-label').addClass('hidden');
                document.querySelectorAll('.st-search__dropdown.js-search-dropdown-main.open').forEach(dropdown => {
                    dropdown.setAttribute('aria-expanded', 'false');
                });
                $('a.st-nheader-search-icon-wrap').removeClass('hidden').attr('tabindex', '0').focus();
            }
        });
    });

	$(".st-header--mobile .st-header__inner .st-svg--close-js").click(function(){
		$(".st-header--mobile .st-svg--burger-js").show();
		$("aside#Top_Menu").removeClass("st-side-navigation--bottom-active");
		$(".stcrew-aside-language-menu-mobile").removeClass("aside-expanded");
		$(this).hide();
		$("body").removeClass("noscroll");
		$(".off-canvas-list.st-inactive").removeClass("st-inactive")
		$("ul.left-submenu.st-side-submenu").removeClass("move-right");
		$("ul.left-submenu.st-side-submenu").removeClass("move-right-withdisplaynone")
	})

	var currentWidth = window.innerWidth;

	var portrait = window.matchMedia("(orientation: portrait)");
	portrait.addEventListener("change", function(e) {

		// Avoid reload loop in AEM author mode

		var isAuthorIframe = window.top &&
			window.top.CQ &&
			window.top.CQ.WCM;

		if(currentWidth >= 1024 && !isAuthorIframe){
			window.location.reload();
		}
	});

	setTimeout(function(){
		if(window.matchMedia("(any-pointer:coarse)").matches && window.innerWidth > 1024){
			STFED.runNgHeader();
		}
	},2000);

    $('.st-header-menu__link-with-submenu > a').on('click', function(e) {
        handleSubmenuToggle();
    });

    setTimeout(() => {
        let ngHeaderRunOnce = false;
        $('.st-header-menu__link-with-submenu > a').on('keydown', function(e) {
            if (!ngHeaderRunOnce && e.key === 'Tab') {
                STFED.runNgHeader();
                ngHeaderRunOnce = true;
            }
            if (e.key === 'Enter' || e.key === ' ') {
                handleSubmenuToggle();
            }
        });
    }, 2000);

    if ($('div.sub-header-devzone').css('display') === 'none') {
        $('div.sub-header-devzone a').attr('tabindex', '-1').attr('aria-hidden', 'true');}
    else {accessibilityStm32();}

    $(document).on('keydown', 'li.st-nav__menu-item.js-st-crewmenu-nav-menu-item.js-ngheader-menu-template a.st-nav__menu-link', function (e) {
        const currentElement = $(this);
        const parentLi = currentElement.closest('li.st-nav__menu-item.js-st-crewmenu-nav-menu-item.js-ngheader-menu-template');
        const parentId = parentLi.attr('id');
        const isActive = parentLi.hasClass('st-nav__menu-item--active');
        const allowedIds = [
            'Top_Menu_Solutions',
            'Top_Menu_Applications',
            'Top_Menu_Tools_and_Software',
            'Top_Menu_Products'
        ];

        const isEnterOnInactive = e.key === 'Enter' && !isActive;
        const isTabOnActive = e.key === 'Tab' && !e.shiftKey && isActive;

        if (isEnterOnInactive) {
            currentElement.click();
        }

        if (isEnterOnInactive || isTabOnActive) {
            if (allowedIds.includes(parentId)) {
                const rootMenuItem = currentElement.closest('li.st-nav__menu-item');
                setTimeout(() => {
                    const submenuLinks = rootMenuItem.find('li.st-nav__submenu-item.js-st-crewnav-submenu-item .st-nav__submenu-link');
                    const browseButtonSubmenuLink = rootMenuItem.find('div.browse-all-button a.st-button.browse-all-button-solution');
                    if (submenuLinks.length) {
                        submenuLinks.attr('tabindex', '0').attr('aria-hidden', 'false');

                        const visibleSubsubmenu = $('div.st-nav__subsubmenu.js-st-nav-subsubmenu').filter(function () {
                            return $(this).css('display') === 'block';
                        });
                        const subsubmenuLinks = visibleSubsubmenu.find('a');
                        subsubmenuLinks.attr('tabindex', '-1').attr('aria-hidden', 'true');

                        if (browseButtonSubmenuLink.length) {
                            browseButtonSubmenuLink.attr('tabindex', '0').attr('aria-hidden', 'false');
                            browseButtonSubmenuLink.focus();
                        } else {
                            submenuLinks.first().focus();
                        }
                        handleSubmenuLinks(submenuLinks);
                    }
                }, 100);
            } else if (parentId === 'Top_Menu_About_Us') {
                const rootMenuItem = currentElement.closest('li.st-nav__menu-item');
                setTimeout(() => {
                    const submenuLinks = rootMenuItem.find('li.st-nav__submenu-item.js-st-crewnav-submenu-item .st-nav__submenu-link');
                    if (submenuLinks.length) {
                        submenuLinks.attr('tabindex', '0').attr('aria-hidden', 'false');
                        submenuLinks.first().focus();
                        submenuLinks.off('keydown');
                        handleAboutUsSubmenuLinks(submenuLinks);
                    }
                }, 100);
            }
        }

        else if (e.key === 'Enter' && isActive) {
            const rootMenuItem = currentElement.closest('li.st-nav__menu-item');

            if (allowedIds.includes(parentId) || parentId === 'Top_Menu_About_Us') {
                const submenuLinks = rootMenuItem.find('li.st-nav__submenu-item.js-st-crewnav-submenu-item .st-nav__submenu-link');
                if (submenuLinks.length) {
                    submenuLinks.attr('tabindex', '-1').attr('aria-hidden', 'true');
                    const visibleSubsubmenu = $('div.st-nav__subsubmenu.js-st-nav-subsubmenu').filter(function () {
                        return $(this).css('display') === 'block';
                    });
                    const subsubmenuLinks = visibleSubsubmenu.find('a');
                    subsubmenuLinks.attr('tabindex', '-1').attr('aria-hidden', 'true');
                }
            }
        }
    });

    $(document).on('keydown', function(e) {
        handleEscapeKey(e);
        handleEscapeKeyBottomMenu(e);
        handleEscapeKeySubMenu(e);
    });

    $(document).on('focusout', '.st-header-menu__item.st-header-menu__link-with-submenu', function () {
        handleSubmenuFocusOut($(this), 'ul.st-header-menu__st-submenu li.st-nav__submenu-item a.st-nav__submenu-link');
    });

    $(document).on('focusout', '.st-header-menu__link-with-submenu.st-nav__menu-item-devzone', function () {
        handleSubmenuFocusOut($(this), 'ul.st-header-menu__st-submenu.st-header-menu__st-submenu-devzone a.st-nav__submenu-link');
    });

    $(document).on('focusout', '.st-nav__menu-item.js-st-crewmenu-nav-menu-item.js-ngheader-menu-template', function () {
        handleSubmenuFocusOut($(this), '.st-nav__submenu-container a');
    });

    document.querySelectorAll(
        '.st-header-menu__item.st-header-menu__link-with-submenu, ' +
        '.st-nav__menu-item.js-st-crewmenu-nav-menu-item.js-ngheader-menu-template, ' +
        '.st-header-menu__link-with-submenu.st-nav__menu-item-devzone'
    ).forEach(el => observeMenuElements(el));
    updateSubmenuTabIndexes();
    setupGlobalObserver();
    accessibilityStDevZone();
    $('div.classic-container.header-fixed-parent').each(function() {
        if ($(this).css('display') === 'flex') {
            accessibilityStm32Desk(this);
        }
    });
});

// Optimize hover behavior for submenu
$(function() {
	STFED.menuActiveClass = 'st-nav__menu-item--active';
	STFED.subMenuActiveClass = 'st-nav__submenu-item--active';
	STFED.subsubMenuActiveClass = 'st-nav__subsubmenu--active';

	STFED.snbPopupAsyncSimplebar_fnarray = [];

	STFED.setSimpleScrollbar_initialization = [];
	STFED.setSimpleScrollbarSecondLevel_initialization = [];
	STFED.setSimpleScrollbarSecondLevel_interval = [];
	STFED.activeSubMenu_timeout;
	STFED.subMenuSwitching_timeout;
	STFED.subMenuHeaderSwitching_timeout;
	STFED.subMenuSwitching_flag;
	STFED.subMenuLeaving_index;
	STFED.subMenuContainerHovering_flag;

STFED.browserScrollWidthForSimpleBar = window.innerWidth - $(document).width() != 0 ? window.innerWidth - $(document).width() : 17 ;
	STFED.simpleBarDragging = 0;
	STFED.simpleBarLastScroll = 0;
	STFED.submenuJObjCurrentClicked = {};
	STFED.submenuJObjCurrentScrollFn = {};

var setSimpleBarHeight =  function(submenuJObj, percentage){
		var __submenuContentHeight = submenuJObj.find(".simplebar-scroll-content").height();
		submenuJObj.find(".simplebar-scrollbar").css("height", (__submenuContentHeight * percentage) + "px")
	};

var setSimpleBarScrollable =  function(submenuJObj, percentage){
	submenuJObj.find(".simplebar-scroll-content").on("scroll update.arrows", function(){
			var arrowSide = "left";
			var menuItem = $(this).closest(".st-nav__submenu-container");
        var bottomOffset = 10;//distance in px from the exact scrolling to bottom position when the arrow should disappear
		if ($(this).closest(".st-nav__subsubmenu-container").length){
				arrowSide = "right";
				menuItem = $(this).closest(".st-nav__subsubmenu-container");
			}

			if (parseInt($(this).scrollTop() + $(this).height()) >= ($(this).find('.simplebar-content').height() - bottomOffset)) {
				menuItem.find('.st-nav__submenu-icon-' + arrowSide).addClass('st-nav__submenu-icon--hidden');
			} else {
				menuItem.find('.st-nav__submenu-icon-' + arrowSide).removeClass('st-nav__submenu-icon--hidden');
			}
			submenuJObj.find(".simplebar-scrollbar").css("top", ($(this).scrollTop() * percentage) + "px");
		});
	};

var setSimpleBarScrollableByDragAndDrop =  function(submenuJObj, percentage){
	submenuJObj.find(".simplebar-scrollbar").mousedown(function(event) {
			event.preventDefault();
			STFED.simpleBarDragging = event.pageY;
			STFED.submenuJObjCurrentClicked = $(event.target);
			var submenuToScroll = $(STFED.submenuJObjCurrentClicked.closest(".st-nav__submenu-container").find(".simplebar-scroll-content")[0])
		if(STFED.submenuJObjCurrentClicked.closest(".st-nav__subsubmenu-container").length){
				submenuToScroll = $(STFED.submenuJObjCurrentClicked.closest(".st-nav__subsubmenu-container").find(".simplebar-scroll-content")[0])
			}
			STFED.simpleBarLastScroll = submenuToScroll.scrollTop();
		STFED.submenuJObjCurrentScrollFn = function(e){
				if (STFED.simpleBarDragging) {
					e.preventDefault();
					var __y;
					var submenuToScroll = $(STFED.submenuJObjCurrentClicked.closest(".st-nav__submenu-container").find(".simplebar-scroll-content")[0])
				if(STFED.submenuJObjCurrentClicked.closest(".st-nav__subsubmenu-container").length){
						submenuToScroll = $(STFED.submenuJObjCurrentClicked.closest(".st-nav__subsubmenu-container").find(".simplebar-scroll-content")[0])
					}
				if(event.pageY > STFED.simpleBarDragging){
					__y = (e.pageY - STFED.simpleBarDragging) * (1/percentage);
						submenuToScroll.scrollTop(STFED.simpleBarLastScroll + __y);
					} else {
					__y = (STFED.simpleBarDragging - e.pageY) * (1/percentage);
						submenuToScroll.scrollTop(STFED.simpleBarLastScroll - __y);
					}
				}
			};
		$("body").bind("mousemove", function(e){
				STFED.submenuJObjCurrentScrollFn(e);
			});
		});

	$("body").mouseup(function() {
		if(STFED.simpleBarDragging){
				$("body").unbind("mousemove", STFED.submenuJObjCurrentScrollFn(event));
			}
			STFED.simpleBarDragging = 0;
			STFED.submenuJObjCurrentClicked = {};
		});
	};

STFED.setSimpleScrollbarOnSubMenuPanels = function(index, element){
		STFED.setSimpleScrollbar_logical($(element));
	};

STFED.setSimpleScrollbar = function(index, element){

	if(STFED.menuTree){
			STFED.setSimpleScrollbarOnSubMenuPanels(index, element);
		} else {
		STFED.setSimpleScrollbar_initialization[index] = _.debounce(function(){
				$(element).closest(".st-nav__menu-item").unbind("mouseover", STFED.setSimpleScrollbar_initialization[index]);
				STFED.setSimpleScrollbarOnSubMenuPanels(index, element);
			}, 100);
			$(element).closest(".st-nav__menu-item").bind("mouseover", STFED.setSimpleScrollbar_initialization[index]);
		}

	};

STFED.setSimpleScrollbar_logical = function(element){
	if(!element.hasClass("st-nav__simplebar-setting-initialized")){
			element.closest(".st-nav__submenu").attr("style", "display: block; visibility: hidden;");
		if(element.closest(".st-nav__subsubmenu").length){
				element.closest(".st-nav__subsubmenu").attr("style", "display: block; visibility: hidden;");
			}

			element.html('<div class="st-nav__simplebar-setting--tempwrap">' + element.html() + '</div>');
			var actualSubmenuContentHeight = element.find(".st-nav__simplebar-setting--tempwrap").height();
			var submenuContentHeight = element.height();

			if (actualSubmenuContentHeight > submenuContentHeight) {
				element.html('<div class="simplebar-track vertical"> <div class="simplebar-scrollbar visible"></div> ' +
					'</div> <div class="simplebar-scroll-content"> <div class="simplebar-content">' +
					element.find(".st-nav__simplebar-setting--tempwrap").html() + '</div> </div>');
				element.attr("data-customsimplebar", "init");
				element.find(".simplebar-scroll-content").css("padding-right", STFED.browserScrollWidthForSimpleBar + "px");
				var simpleBarHeightAccordingToContentHeightPercentage = submenuContentHeight / actualSubmenuContentHeight;
				setSimpleBarHeight(element, simpleBarHeightAccordingToContentHeightPercentage);
				setSimpleBarScrollable(element, simpleBarHeightAccordingToContentHeightPercentage);
				setSimpleBarScrollableByDragAndDrop(element, simpleBarHeightAccordingToContentHeightPercentage);
			} else {
				element.html(element.find(".st-nav__simplebar-setting--tempwrap").html());
			}

			element.closest(".st-nav__submenu").attr("style", "");
		if(element.closest(".st-nav__subsubmenu").length){
				element.closest(".st-nav__subsubmenu").attr("style", "");
			}
			element.addClass("st-nav__simplebar-setting-initialized");
		}
		element.addClass("st-nav__simplebar-setting-checked");
	};

STFED.getScrollBarWidth = function() {
		$("body").append('<div class="st-boundary-width-container" style="visibility: hidden; width: 100px; overflow: scroll"><div class="st-boundary-width-scroll" style="width: 100%"></div></div>');
		var boundaryScrollWidth = $('.st-boundary-width-scroll')[0].getBoundingClientRect().width;
		$(".st-boundary-width-container").remove();
		return 100 - boundaryScrollWidth;
	};

STFED.showMainScrollPlaceholderIfNeeded = function(){
	if(!$(".st-mainscroll-overlay-shift-style").length && window.navigator.userAgent.indexOf("Mac") == -1){
			var scrollBarWidth = STFED.getScrollBarWidth();
			STFED.mainscrollOverlayHeaderRightShift = scrollBarWidth;
    	STFED.mainscrollOverlaySearchLeftShift = (8.5*scrollBarWidth)/17;
    	STFED.mainscrollOverlaySearchWidthResize = (6.4*scrollBarWidth)/17;
			STFED.mainscrollOverlayMedalliaRightShift = parseFloat(STFED.mainscrollOverlayHeaderRightShift + 10);
    	$("head").append('<div class="st-mainscroll-overlay-shift-style"><style>.kampyle_vertical_button { transition:none; } .has-active-overlay .kampyle_vertical_button { margin-right: ' + STFED.mainscrollOverlayMedalliaRightShift + 'px; transition: unset; } .has-active-overlay.has-scrollbar main, .has-active-overlay.has-scrollbar header{padding-right:' + STFED.mainscrollOverlayHeaderRightShift + 'px;} .has-active-overlay.has-scrollbar .st-header-menu {right: ' + STFED.mainscrollOverlayHeaderRightShift + 'px;} .has-active-overlay.has-scrollbar .st-header__search {left: calc(50% - ' + STFED.mainscrollOverlaySearchLeftShift + 'px); width: calc(40% - '+ STFED.mainscrollOverlaySearchWidthResize + 'px);}</style></div>');
		}
		$(".st-language-banner-adding-style").remove();
		var languageBannerHeight = $(".st-language-banner").length ? $(".st-language-banner").css("height") : 0;
		$("head").append('<style class="st-language-banner-adding-style">.has-active-overlay .st-language-banner-header-translation{margin-top:' + languageBannerHeight + ';}</style>');

	if($("body")[0].scrollHeight > $("body")[0].clientHeight){
			$("body").addClass("has-scrollbar");
		} else {
			$("body").removeClass("has-scrollbar");
		}
    if($(".st-language-banner").is(":visible")){
			$(".st-header__search").addClass("st-language-banner-header-translation");
			$(".st-header-menu").addClass("st-language-banner-header-translation");
		} else {
			$(".st-header__search").removeClass("st-language-banner-header-translation");
			$(".st-header-menu").removeClass("st-language-banner-header-translation");
		}
	};

	enquire.register(STFED.mediaQueries.largeMin, {
		match: function () {
			var menuTimeout;
			var openLevel1Menu = function($this){
				var menuItem = $this;
				if(!menuItem.closest("[ng-if=false]").length){
						$("." + STFED.menuActiveClass).removeClass(STFED.menuActiveClass);
					menuItem.addClass(STFED.menuActiveClass);
                    setTimeout(updateSubmenuTabIndexes, 100);
                    setTimeout(updateBottomMenuTabIndexes, 100);
					$('.st-main__overlay').addClass('st-main__overlay--active');
					$('body').addClass('has-active-overlay');

					if(!menuItem.find(".st-nav__submenu-list").hasClass("st-nav__submenu-list-item-initialized") &&
							menuItem.attr("id") != "Top_Menu_About_Us"){
						appendOnClickOnEachLevel1Item(menuItem);
					}

					colorDevZoneTab()
					unsetDevZoneTab()
				}
			};


            var appendOnClickOnEachLevel1Item = function(menuItem){
                var submenuItems = menuItem.find(".js-st-crewnav-submenu-item");

                submenuItems.click(function(){
                    var subSubMenuPanel = $(this).closest(".st-nav__submenu-list-container")
                        .find("[data-nav-item-submenu-id=" + $(this).attr("data-nav-item-menu-id") + "]");
                    menuItem.find(".st-nav__menu-item-selected").removeClass("st-nav__menu-item-selected");
                    menuItem.find("[data-nav-item-submenu-id]").hide();
                    $(this).addClass("st-nav__menu-item-selected");
                    subSubMenuPanel.show();
                });

                submenuItems.keydown(function(e){
                    if (e.key === "Enter" || e.keyCode === 13) {
                        e.preventDefault();
                        $(this).click();
                    }
                });

                $(submenuItems[0]).click();
            }

			$('.st-nav__menu-container').off('click').on({
				click: function () {
					var $this = $(this).closest(".js-st-crewmenu-nav-menu-item");
					$(".st-nav__subsubmenu.js-st-nav-subsubmenu").hide();
					if($this.hasClass("st-nav__menu-item--active")) {
						removeBodyOverlay($this);
					} else {
						unsetDevZoneTab($this)
						openLevel1Menu($this);
					}
				}
			}, '.js-st-crewmenu-nav-menu-item[ng-repeat] > .st-nav__menu-link');
			STFED.tabMenuClickEventInitialized = true;

			$(".off-canvas-wrap").append("<div class='mainscroll-placeholder'></div>");

			$("#section-sample-and-buy [data-async-simplebar]").each(function(index, element){
				var targeEventtElement = $(element).closest(".st-popover");
                STFED.snbPopupAsyncSimplebar_fnarray[index] = function(){
					targeEventtElement.unbind("click", STFED.snbPopupAsyncSimplebar_fnarray[index]);
					var simplebar = new SimpleBar(element);
				}
				targeEventtElement.bind("click", STFED.snbPopupAsyncSimplebar_fnarray[index]);
			});

		}
	});
});

var addTabFlag = false;
function addTab(language){

	//aggiungi condizione solo per funzionare all'interno del dev zone

	if (addTabFlag){
		return;
	}
	addTabFlag = true;
	var text = '';

	var inDeveloperZone = AreInPage('stm32-mcu-developer-zone') || AreInPage('stm32-mpu-developer-zone') || AreInPage('stm32cubemx') || AreInPage('stm32cubeide') || AreInPage("st-edge-ai-suite");

	// Fallback to identity mapping
	let i18n = f => f;

	try {
		const locale = window.digitalData.page.attributes.language;

		if (locale) {
			window.Granite.I18n.setLocale(locale);

			// If we have everything we need, replace the dummy mapping with the
			// real i18n function
			i18n = window.Granite.I18n.get;
		}
		else {
			console.error("Failed to setup i18n mapping function");
		}

	}
	catch (_) {
		console.error("Failed to setup i18n mapping function");
	}

    text += '<li>';
    text += '<div class="st-header-menu__link-with-submenu st-nav__menu-item-devzone ng-scope"';

    if(inDeveloperZone){
        text += 'style="background: #ffd200; border-radius: 0 20px 0px 0px;"}>';
    }
    text += '<div class="st-nav__menu-link-devzone" style="padding: 0;">';
    text += '<div'+ (!inDeveloperZone ? ' onclick="toggleHeaderSubEntries(event)"' : ' onclick="removeBodyOverlay()"')  +' id="STM32TAB">';
    text += '<i class="fa fa-ellipsis-v" aria-hidden="true" style="display: none;"></i>';
    text += `<a class="st-nav__menu-link" ${!inDeveloperZone ? 'role="button" aria-haspopup="true" aria-controls="STM32TAB" aria-expanded="false"' : ''} tabindex="0">${i18n("ST Developer Zone")}</a>`;
    text += '</div>';
    text += '<ul id="Top_Menu_ST Developer Zone" class="st-header-menu__st-submenu st-header-menu__st-submenu-devzone" style="pointer-events: none;'+(window.width <= 1024 ? 'display:none;' : '')+'">' ;
    text += '<li class="st-nav__submenu-item"  style="padding-top: 25px; height: fit-content;">';
    text += '<a tabindex="-1" aria-hidden="true" href="/content/st_com/'+language+'/stm32-mcu-developer-zone.html" class="st-nav__submenu-link">';
    text += `<span>${i18n("STM32 MCU Developer Zone")}</span>`;
    text += '</a>';
    text += '</li>';
    text += '<li class="st-nav__submenu-item" style="height: fit-content;">';
    text += '<a tabindex="-1" aria-hidden="true" href="/content/st_com/'+language+'/stm32-mpu-developer-zone.html" class="st-nav__submenu-link">';
    text += `<span>${i18n("STM32 MPU Developer Zone")}</span>`;
    text += '</a>';
    text += '</li>';

    text += '<li class="st-nav__submenu-item" style="padding-bottom: 45px; box-shadow: inset 0px -1.5px #03234b;">';
    text += '<a tabindex="-1" aria-hidden="true" href="/content/st_com/'+language+'/st-edge-ai-suite.html" class="st-nav__submenu-link" >';
    text += `<span>${i18n("ST Edge AI Suite")}</span>`;
    text += '</a>';
    text += '</li>';

    text += '<li class="no-click-container" style="padding:0;">';
    text += `<span>${i18n("OUR FLAGSHIP SOFTWARE TOOLS")}</span>`;
    text += '</li>';
    text += '<li class="st-nav__submenu-item" style="height: fit-content;">';
    text += '<a tabindex="-1" aria-hidden="true" href="/content/st_com/'+language+'/stm32cubemx.html" class="st-nav__submenu-link">';
    text +=`<span>${i18n("STM32CubeMX")}</span>`;
    text +='</a>';
    text +='</li>';

    text +='<li class="st-nav__submenu-item">';
    text +='<a tabindex="-1" aria-hidden="true" href="/content/st_com/'+language+'/stm32cubeide.html" class="st-nav__submenu-link">';
    text +=`<span>${i18n("STM32CubeIDE")}</span>`;
    text +='</a>';
    text +='</li>';
    text +='</ul>';
    text +='</div>';
    text +='</div>';
    text +='</li>';
    $('.st-header #Top_Menu_Solutions').after(text);
    updateBottomMenuTabIndexes();
}

STFED.addTrackingClickHandlers = function() {
	if (window.location.href.includes("stm32-online-training")) {
		var links = document.querySelectorAll('a[href$=".mp4"], a[href$="index.html"]');
		links.forEach(function(link) {
			link.addEventListener("click", function(e) {
				var row = this.closest("tr");
				var nameElement = row.querySelector("td:first-child a") || row.querySelector("td:first-child");
				var name = nameElement.textContent.trim();

				digitalData.media = {
					type: this.getAttribute("href").endsWith(".mp4") ? "video" : "e-presentation",
					name: name,
					videoLink: this.getAttribute("href"),
					duration: 0
				};

				var event = new CustomEvent("videoViewed", {
					bubbles: true
				});
				document.querySelector("body").dispatchEvent(event);
				console.log(digitalData.media);
			});
		});
	}
};

// Accessibility focus management
function handleSubmenuLinks(submenuLinks) {
    updateAriaExpanded(submenuLinks);

    submenuLinks.on('keydown', function (event) {
        const currentLink = $(this);

        const selectedSubmenuDiv = submenuLinks.filter(function () {
            return $(this).closest('li').hasClass('st-nav__menu-item-selected');
        });

        const nextSubmenuDiv = selectedSubmenuDiv.parent().next().find('.st-nav__submenu-link');

        if (event.key === 'Tab' && !event.shiftKey && currentLink.is(selectedSubmenuDiv)) {
            const visibleSubsubmenu = $('div.st-nav__subsubmenu.js-st-nav-subsubmenu').filter(function () {
                return $(this).css('display') === 'block';
            });

            const subsubmenuLinks = visibleSubsubmenu.find('a');
            const firstSubsubmenuLink = subsubmenuLinks.filter('.white-on-focus').first();
            const lastSubsubmenuLink = subsubmenuLinks.last();

            subsubmenuLinks.attr('tabindex', '0').attr('aria-hidden', 'false');
            submenuLinks.attr('tabindex', '-1').attr('aria-hidden', 'true');

            setTimeout(() => { firstSubsubmenuLink.focus(); }, 0);

            firstSubsubmenuLink.on('keydown', function (event) {
                if (event.key === 'Tab' && event.shiftKey) {
                    event.preventDefault();
                    submenuLinks.attr('tabindex', '0').attr('aria-hidden', 'false');
                    subsubmenuLinks.attr('tabindex', '-1').attr('aria-hidden', 'true');
                    setTimeout(() => {
                        selectedSubmenuDiv.focus();
                    }, 0);
                }
            });

            lastSubsubmenuLink.on('keydown', function (event) {
                if (event.key === 'Tab' && !event.shiftKey) {
                    event.preventDefault();
                    submenuLinks.attr('tabindex', '0').attr('aria-hidden', 'false');
                    setTimeout(() => {
                        if (nextSubmenuDiv && nextSubmenuDiv.length > 0) {
                            subsubmenuLinks.attr('tabindex', '-1').attr('aria-hidden', 'true');
                            nextSubmenuDiv.focus();
                        }
                        else {
                            const activeItem = $('li.st-nav__menu-item.js-st-crewmenu-nav-menu-item.js-ngheader-menu-template.st-nav__menu-item--active');

                            let fallbackTarget;

                            if (activeItem.attr('id') === 'Top_Menu_Solutions') {
                                fallbackTarget = $('div.st-header-menu__link-with-submenu.st-nav__menu-item-devzone a.st-nav__menu-link').first();
                            }
                            else {
                                fallbackTarget = activeItem
                                    .nextAll('li.st-nav__menu-item.js-st-crewmenu-nav-menu-item.js-ngheader-menu-template')
                                    .find('a.st-nav__menu-link')
                                    .first();
                            }

                            if (fallbackTarget && fallbackTarget.length) {
                                fallbackTarget.focus();
                            }
                        }
                    }, 0);
                }
            });
        }

        if (event.key === 'Tab' && event.shiftKey) {
            const isNext = currentLink.is(nextSubmenuDiv);

            if (isNext) {
                const visibleSubsubmenu = $('div.st-nav__subsubmenu.js-st-nav-subsubmenu').filter(function () {
                    return $(this).css('display') === 'block';
                });

                const subsubmenuLinks = visibleSubsubmenu.find('a');
                const lastSubsubmenuLink = subsubmenuLinks.last();
                const firstSubsubmenuLink = subsubmenuLinks.filter('.white-on-focus').first();

                submenuLinks.attr('tabindex', '-1').attr('aria-hidden', 'true');
                subsubmenuLinks.attr('tabindex', '0').attr('aria-hidden', 'false');

                setTimeout(() => { lastSubsubmenuLink.focus(); }, 0);

                lastSubsubmenuLink.on('keydown', function (event) {
                    if (event.key === 'Tab' && !event.shiftKey) {
                        event.preventDefault();
                        submenuLinks.attr('tabindex', '0').attr('aria-hidden', 'false');
                        subsubmenuLinks.attr('tabindex', '-1').attr('aria-hidden', 'true');
                        setTimeout(() => {
                            nextSubmenuDiv.focus();
                        }, 10);
                    }
                });

                firstSubsubmenuLink.on('keydown', function (event) {
                    if (event.key === 'Tab' && event.shiftKey) {
                        submenuLinks.attr('tabindex', '0').attr('aria-hidden', 'false');
                        subsubmenuLinks.attr('tabindex', '-1').attr('aria-hidden', 'true');
                        setTimeout(() => {
                            selectedSubmenuDiv.focus();
                        }, 10);
                    }
                });
            }
        }

        if (event.key === 'Enter') {
            setTimeout(() => {
                updateAriaExpanded(submenuLinks);
            }, 0);
        }

    });
}

function updateAriaExpanded(submenuLinks) {
    submenuLinks.each(function () {
        const link = $(this);
        const parentLi = link.closest('li');

        link.attr('aria-expanded', parentLi.hasClass('st-nav__menu-item-selected') ? 'true' : 'false');
    });
}

function handleAboutUsSubmenuLinks(submenuLinks) {
    submenuLinks.on('keydown', function (e) {
        const currentElement = $(this);
        const currentIndex = submenuLinks.index(currentElement);
        const nextElement = submenuLinks.eq(currentIndex + 1);
        const prevElement = submenuLinks.eq(currentIndex - 1);
        const parentLi = currentElement.closest('li');
        if (e.key === 'Enter' && !parentLi.hasClass('parent--active')) {
            currentElement.click();
            setTimeout(() => {
                const visibleSubSubmenus = $('div.st-nav__subsubmenu.js-st-nav-subsubmenu').filter(function () {
                    return $(this).css('display') === 'block';
                });

                const submenuTitles = visibleSubSubmenus.find('a.st-nav__blockmenu-title');
                const firstTitle = submenuTitles.first();
                const lastTitle = submenuTitles.last();
                submenuLinks.attr('tabindex', '-1').attr('aria-hidden', 'true');
                submenuTitles.attr('tabindex', '0').attr('aria-hidden', 'false');

                setTimeout(() => {firstTitle.focus();}, 10);
                submenuTitles.off('keydown');

                firstTitle.on('keydown', function (event) {
                    if (event.key === 'Tab' && event.shiftKey) {
                        visibleSubSubmenus.css('display', 'none');
                        $('li.parent--active').removeClass('parent--active');
                        submenuLinks.attr('tabindex', '0').attr('aria-hidden', 'false');
                        submenuTitles.attr('tabindex', '-1').attr('aria-hidden', 'true');
                        setTimeout(() => {currentElement.focus();}, 10);
                    }
                });

                lastTitle.on('keydown', function (event) {
                    if (event.key === 'Tab' && !event.shiftKey) {
                        event.preventDefault();
                        submenuLinks.attr('tabindex', '0').attr('aria-hidden', 'false');
                        submenuTitles.attr('tabindex', '-1').attr('aria-hidden', 'true');
                        setTimeout(() => {nextElement.focus();}, 10);
                        setTimeout(() => {
                            visibleSubSubmenus.css('display', 'none');
                            $('li.parent--active').removeClass('parent--active');
                        }, 100);
                    }
                });

                submenuTitles.on('keydown', function (event) {
                    if (event.key === 'Escape') {
                        submenuLinks.attr('tabindex', '0').attr('aria-hidden', 'false');
                        submenuTitles.attr('tabindex', '-1').attr('aria-hidden', 'true');
                        visibleSubSubmenus.css('display', 'none');
                        $('li.parent--active').removeClass('parent--active');
                        setTimeout(() => {currentElement.focus();}, 10);
                    }
                });
            }, 100);
        }
    });
}

function handleSubmenuFocusOut($submenu, submenuSelector) {
    setTimeout(() => {
        const active = document.activeElement;
        if (!$submenu[0].contains(active)) {
            $submenu.removeClass('submenu-opened submenu-opened-devzone st-nav__menu-item--active');

            const overlay = document.querySelector('.st-main__overlay');
            if (overlay && overlay.classList.contains('st-main__overlay--active')) {
                overlay.classList.remove('st-main__overlay--active');
            }

            $submenu.find(submenuSelector).each(function () {
                $(this).attr('tabindex', '-1');
                $(this).attr('aria-hidden', 'true');
            });
        }
    }, 0);
}

function updateSubmenuTabIndexes() {
  document.querySelectorAll('.st-header-menu__item.st-header-menu__link-with-submenu').forEach(item => {
    const submenuLinks = item.querySelectorAll('.st-header-menu__st-submenu a');
    submenuLinks.forEach(link => {
      if (item.classList.contains('submenu-opened')) {
        link.removeAttribute('tabindex');
        link.removeAttribute('aria-hidden');
      } else {
        link.setAttribute('tabindex', '-1');
        link.setAttribute('aria-hidden', 'true');
      }
    });
  });
}

function updateBottomMenuTabIndexes() {
  document.querySelectorAll('div.st-header-menu__link-with-submenu.st-nav__menu-item-devzone').forEach(item => {
    const submenuLinks = item.querySelectorAll('ul.st-header-menu__st-submenu.st-header-menu__st-submenu-devzone a');
    submenuLinks.forEach(link => {
      if (item.classList.contains('submenu-opened')) {
        link.removeAttribute('tabindex');
        link.removeAttribute('aria-hidden');
      } else {
        link.setAttribute('tabindex', '-1');
        link.setAttribute('aria-hidden', 'true');
      }
    });
  });
}

function handleSubmenuToggle() {
  setTimeout(updateSubmenuTabIndexes, 100);
  setTimeout(updateBottomMenuTabIndexes, 100);
}

function handleEscapeKeyFactory({
  selector,
  overlaySelector = 'div.st-main__overlay',
  activeClass,
  updateTabIndexesFn,
  focusSelector,
}) {
  return function (e) {
    if (e.key === 'Escape' || e.key === 'Esc') {
      const openElement = document.querySelector(selector);
      const overlay = document.querySelector(overlaySelector);

      if (openElement) {
        openElement.classList.remove(activeClass);
        if (overlay) {
          overlay.classList.remove('st-main__overlay--active');
        }

        if (typeof updateTabIndexesFn === 'function') {
          updateTabIndexesFn();
        }

        const trigger = focusSelector ? openElement.querySelector(focusSelector) : null;
        if (trigger) {
          trigger.focus();
        }
      }
    }
  };
}

function handleEscapeKeySubMenu(e) {
  if (e.key === 'Escape' || e.key === 'Esc') {
    const openElement = document.querySelector('li.st-nav__menu-item.js-st-crewmenu-nav-menu-item.st-nav__menu-item--active');
    if (!openElement) return;

    const visibleSubsubmenu = document.querySelector('div.st-nav__subsubmenu.js-st-nav-subsubmenu[style*="display: block"]');
    if (visibleSubsubmenu) {
      const focusedElement = document.activeElement;
      const subsubmenuLinks = visibleSubsubmenu.querySelectorAll('a');
      const isFocusedInSubsubmenu = Array.from(subsubmenuLinks).some(link => link === focusedElement);

      if (isFocusedInSubsubmenu) {
        const openMenu = document.querySelector('li.st-nav__menu-item.js-st-crewmenu-nav-menu-item.st-nav__menu-item--active');
        const selectedSubmenuLink = openMenu?.querySelector('li.st-nav__submenu-item.js-st-crewnav-submenu-item.st-nav__menu-item-selected .st-nav__submenu-link');
        const selectedSubmenuItem = selectedSubmenuLink?.closest('li');
        const nextSubmenuItem = selectedSubmenuItem?.nextElementSibling;
        const nextSubmenuDiv = nextSubmenuItem?.querySelector('.st-nav__submenu-link');
        const activeMenuItems = document.querySelectorAll(
          'li.st-nav__menu-item.js-st-crewmenu-nav-menu-item.js-ngheader-menu-template.st-nav__menu-item--active .st-nav__submenu-link'
        );

        activeMenuItems.forEach(item => {
          item.setAttribute('tabindex', '0');
          item.setAttribute('aria-hidden', 'false');
        });

        if (nextSubmenuDiv) {
            subsubmenuLinks.forEach(item => {
             item.setAttribute('tabindex', '-1');
             item.setAttribute('aria-hidden', 'true');
            });
          nextSubmenuDiv.focus();
          return;
        } else {
          if (selectedSubmenuLink) {
            selectedSubmenuLink.focus();
            return;
          }
        }
      }
    }
    openElement.classList.remove('st-nav__menu-item--active');
    $('li.parent--active').removeClass('parent--active');

    const trigger = openElement.querySelector('.st-nav__menu-item.js-st-crewmenu-nav-menu-item a.st-nav__menu-link');
    if (trigger) {
      trigger.focus();
      const overlay = document.querySelector("div.st-main__overlay");
      if (overlay) {
        overlay.classList.remove('st-main__overlay--active');
      }
    }
  }
}

function accessibilityStm32() {
    const devzone = document.querySelector(".sub-header-devzone");
    if (!devzone || window.getComputedStyle(devzone).display !== "block") return;
    const bar = devzone.querySelector(".sub-header-devzone__bar");
    bar.setAttribute("aria-expanded", "false");
    bar.setAttribute("role", "button");
    bar.setAttribute("aria-haspopup", "true");
    const overlay = devzone.querySelector(".sub-header-devzone__overlay");

    if (!bar || !overlay) return;

    const setLinksAccessibility = (links, tabIndex, ariaHidden) => {
        links.forEach(link => {
            link.setAttribute("tabindex", tabIndex);
            link.setAttribute("aria-hidden", ariaHidden);
        });
    };

    const handleTabExitOnLastElement = (lastLink, callback) => {
        if (!lastLink.classList.contains("tab-exit-listener-added")) {
            lastLink.classList.add("tab-exit-listener-added");
            lastLink.addEventListener("keydown", function(e) {
                if (e.key === "Tab" && !e.shiftKey) {
                    e.preventDefault();
                    callback();
                }
            });
        }
    };

    const allOverlayLinks = overlay.querySelectorAll("a");
    setLinksAccessibility(allOverlayLinks, "-1", "true");

    bar.setAttribute("tabindex", "0");
    bar.setAttribute("aria-hidden", "false");

    bar.addEventListener("click", function(e) {
        const isBarExpanded = bar.getAttribute("aria-expanded") === 'true';//overlay.classList.contains("active");
        bar.setAttribute("aria-expanded", "true");


        setTimeout(() => {
            const firstLevelLinks = overlay.querySelectorAll(":scope > div > ul > li:not(.d-none) a");
            const secondLevelLinks = overlay.querySelectorAll(":scope > div div.sub-header-devzone__submenu a");
            const firstLevelWithSubmenu = overlay.querySelectorAll(":scope > div > ul > li.has-submenu:not(.d-none) a");
            if (!isBarExpanded) {
                setLinksAccessibility(firstLevelLinks, "0", "false");
                setLinksAccessibility(secondLevelLinks, "-1", "true");
                firstLevelLinks.forEach(link => {
                    if (!link.classList.contains("listener-added")) {
                        link.classList.add("listener-added");
                        link.addEventListener("keydown", function (e) {
                            if (e.key === "Escape") {
                                setLinksAccessibility(firstLevelLinks, "-1", "true");
                                bar.click();
                                bar.focus();
                                bar.setAttribute("aria-expanded", "false");
                            }
                        });
                    }
                });
                if (firstLevelLinks.length > 0) {
                    handleTabExitOnLastElement(firstLevelLinks[firstLevelLinks.length - 1], () => {
                        bar.click();
                        setLinksAccessibility(firstLevelLinks, "-1", "true");
                        bar.focus();
                        bar.setAttribute("aria-expanded", "false");
                    });
                }
                firstLevelWithSubmenu.forEach(link => {
                    link.addEventListener("keydown", function (e) {
                        if (e.key === "Enter") {
                            this.click();
                            const activeSecondLevel = overlay.querySelectorAll(":scope > div div.sub-header-devzone__submenu.active a");
                            setLinksAccessibility(firstLevelLinks, "-1", "true");
                            setLinksAccessibility(activeSecondLevel, "0", "false");
                            activeSecondLevel.forEach(link => {
                                link.addEventListener("keydown", function (e) {
                                    if (e.key === "Escape") {
                                        const backLink = overlay.querySelector(".sub-header-devzone__back-button a");
                                        if (backLink) backLink.click();
                                        setLinksAccessibility(activeSecondLevel, "-1", "true");
                                        setLinksAccessibility(firstLevelLinks, "0", "false");
                                        firstLevelLinks[0]?.focus();
                                    }
                                });
                            });
                            if (activeSecondLevel.length > 0) {
                                handleTabExitOnLastElement(activeSecondLevel[activeSecondLevel.length - 1], () => {
                                    const backLink = overlay.querySelector(".sub-header-devzone__back-button a");
                                    if (backLink) backLink.click();
                                    bar.click();
                                    setLinksAccessibility(activeSecondLevel, "-1", "true");
                                    setLinksAccessibility(firstLevelLinks, "-1", "true");
                                    bar.setAttribute("aria-expanded", "false");
                                    bar.focus();
                                });
                                const backButtonDiv = activeSecondLevel[0].closest(".sub-header-devzone__back-button");
                                if (backButtonDiv && !activeSecondLevel[0].classList.contains("back-enter-listener-added")) {
                                    activeSecondLevel[0].classList.add("back-enter-listener-added");
                                    activeSecondLevel[0].addEventListener("keydown", function (e) {
                                        if (e.key === "Enter") {
                                            this.click();
                                            setLinksAccessibility(activeSecondLevel, "-1", "true");
                                            setLinksAccessibility(firstLevelLinks, "0", "false");
                                            firstLevelLinks[0].focus();
                                        }
                                    });
                                }
                                activeSecondLevel[0].focus();
                            }
                        }
                    });
                });
                firstLevelLinks[0]?.focus();
            }
            else {
                const backButtonStm = document.querySelector(".sub-header-devzone__back-button");
                if (backButtonStm) backButtonStm.click();
                setLinksAccessibility(allOverlayLinks, "-1", "true");
                bar.setAttribute("aria-expanded", "false");
                bar.focus();
            }
        }, 100);
    })

    bar.addEventListener("keydown", function (e) {
        const isBarExpanded = bar.getAttribute("aria-expanded") === 'true';

        if (e.key === "Enter") {
            bar.click();
            
        }
        else if (e.key === "Tab" && e.shiftKey && isBarExpanded) {

            const activeSecondLevel = overlay.querySelectorAll(":scope > div div.sub-header-devzone__submenu.active a");

            if (activeSecondLevel.length > 0) {
                const backLink = overlay.querySelector(".sub-header-devzone__back-button a");
                if (backLink) {
                    backLink.click();
                    setTimeout(() => {
                        bar.setAttribute("aria-expanded", "false");
                        bar.click();
                        const allLinks = overlay.querySelectorAll("a");
                        setLinksAccessibility(allLinks, "-1", "true");
                    }, 100);
                }
            } else {
                bar.setAttribute("aria-expanded", "false");
                bar.click();
                const allLinks = overlay.querySelectorAll("a");
                setLinksAccessibility(allLinks, "-1", "true");
            }
        }
    });
}

function accessibilityStDevZone() {
    const observer = new MutationObserver((mutations, obs) => {
        const $targetLink = $('#STM32TAB .st-nav__menu-link');

        if ($targetLink.length > 0) {
            $targetLink.off('keydown.accessibility')
                       .on('keydown.accessibility', function (e) {
                if (e.key === 'Enter') {
                    $(this).click();
                }
            });
        }
    });

    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
}

function accessibilityStm32Desk(container) {
    const observer = new MutationObserver((mutations, obs) => {
        const $targetLink = $('#STM32TAB .st-nav__menu-link');
        if ($targetLink.length) {
            $targetLink.attr('aria-expanded', 'true');
            $targetLink.on('keydown', function (e) {
                if (e.key === 'Enter' || (e.key === 'Tab' && !e.shiftKey)) {
                    $targetLink.click();
                    const $focusables = $(container).find('.js-stm32-accessibilityFocus');

                    if ($focusables.length > 0) {
                        e.preventDefault();
                        const $firstFocusable = $focusables.first();
                        $firstFocusable.focus();

                        $focusables.off('keydown.accessibility');

                        $firstFocusable.on('keydown.accessibility', function (ev) {
                            if (ev.key === 'Tab' && ev.shiftKey) {
                                ev.preventDefault();
                                $targetLink.focus();
                            }
                        });

                        $firstFocusable.on('keydown.accessibility', function (ev) {
                            const $dropdowns = $(container).find('[id^="dropdownmenu"]');

                            if (ev.key === 'Enter' && !$dropdowns.hasClass('stm32-dropdown--active')) {
                                $firstFocusable.click();
                                if ($dropdowns.is('#dropdownmenuEdgeAISuite')) {
                                    $dropdowns.addClass('stm32-dropdown--active');
                                }
                                $(container).find('.js-stm32-accessibilityFocus').attr('aria-expanded', 'true');
                                const $links = $dropdowns.find('div.stm32-tab-dropdown a');
                                if ($links.length > 0) {
                                    setTimeout(() => {
                                            const $firstFocusableSubLink = $links.first();
                                            $firstFocusableSubLink.focus();
                                            const $lastFocusableSubLink = $links.last();
                                            $firstFocusableSubLink.on('keydown.accessibility', function (ev) {
                                                if (ev.key === 'Tab' && ev.shiftKey) {
                                                    ev.preventDefault();
                                                    $dropdowns.removeClass('stm32-dropdown--active');
                                                    $(container).find('.js-stm32-accessibilityFocus').attr('aria-expanded', 'false');
                                                    const overlay = document.querySelector('.st-main__overlay');
                                                    if (overlay.classList.contains('st-main__overlay--active')) {
                                                      overlay.classList.remove('st-main__overlay--active');
                                                    }

                                                    setTimeout(() => {
                                                        $firstFocusable.focus();
                                                    }, 100);
                                                }
                                            });

                                            $links.on('keydown.accessibility', function (ev) {
                                                if (ev.key === 'Escape') {
                                                    $firstFocusable.click();
                                                    $(container).find('.js-stm32-accessibilityFocus').attr('aria-expanded', 'false');
                                                    $dropdowns.removeClass('stm32-dropdown--active');
                                                    const overlay = document.querySelector('.st-main__overlay');
                                                    if (overlay.classList.contains('st-main__overlay--active')) {
                                                      overlay.classList.remove('st-main__overlay--active');
                                                    }
                                                    setTimeout(() => {
                                                        $firstFocusable.focus();
                                                    }, 100);
                                                }
                                            });

                                            $lastFocusableSubLink.on('keydown.accessibility', function (ev) {
                                                if (ev.key === 'Tab' && !ev.shiftKey) {
                                                    ev.preventDefault();
                                                    const $activeDropdown = $dropdowns.filter('.stm32-dropdown--active');
                                                    const dropdownId = $activeDropdown.attr('id') || '';
                                                    if (['dropdownmenuMCU', 'dropdownmenuMPU', 'dropdownmenuEdgeAISuite'].includes(dropdownId)) {
                                                        $(container).find('.js-stm32-accessibilityFocus').attr('aria-expanded', 'false');
                                                        $activeDropdown.removeClass('stm32-dropdown--active');
                                                        const $nextTabLink = $(container)
                                                            .find('.stm32-tab a, .stm32-tab-icon a')
                                                            .filter(':visible')
                                                            .filter(function () {
                                                                return $(this)[0] !== $firstFocusable[0];
                                                            })
                                                            .first();

                                                        if ($nextTabLink.length) {
                                                            setTimeout(() => {
                                                                const overlay = document.querySelector('.st-main__overlay');
                                                                if (overlay.classList.contains('st-main__overlay--active')) {
                                                                  overlay.classList.remove('st-main__overlay--active');
                                                                }
                                                                $nextTabLink.focus();
                                                            }, 100);
                                                        }
                                                    }
                                                    else if (['dropdownmenuCubeMX', 'dropdownmenuCubeIDE'].includes(dropdownId)) {
                                                        $(container).find('.js-stm32-accessibilityFocus').attr('aria-expanded', 'false');
                                                        $activeDropdown.removeClass('stm32-dropdown--active');
                                                        const overlay = document.querySelector('.st-main__overlay');
                                                        if (overlay.classList.contains('st-main__overlay--active')) {
                                                          overlay.classList.remove('st-main__overlay--active');
                                                        }
                                                        const $target = $('#Top_Menu_About_Us a.st-nav__menu-link');
                                                        if ($target.length) {
                                                            $(container).find('div.stm32-tab a, .stm32-tab-icon a')
                                                                .attr('tabindex', '-1')
                                                                .attr('aria-hidden', 'true');
                                                            $target.focus();
                                                        }
                                                    }
                                                }
                                            });
                                    }, 200);
                                }
                            }
                        });
                    }

                    const $allLinks = $(container).find('div.stm32-tab a, .stm32-tab-icon a');
                    if ($allLinks.length > 0) {
                        const $lastLink = $allLinks.last();
                        $lastLink.on('keydown.accessibility', function (ev) {
                            if (ev.key === 'Tab' && !ev.shiftKey) {
                                ev.preventDefault();
                                const $target = $('#Top_Menu_About_Us a.st-nav__menu-link');
                                const overlay = document.querySelector('.st-main__overlay');
                                if (overlay.classList.contains('st-main__overlay--active')) {
                                    overlay.classList.remove('st-main__overlay--active');
                                }
                                if ($target.length) {
                                    $('div.stm32-tab a, .stm32-tab-icon a')
                                        .attr('tabindex', '-1')
                                        .attr('aria-hidden', 'true');
                                    $target.focus();
                                }
                            }
                        });

                        const $targetBack = $('#Top_Menu_About_Us a.st-nav__menu-link');
                        if ($targetBack.length) {
                            $targetBack.off('keydown.accessibility');

                            $targetBack.on('keydown.accessibility', function (ev) {
                                if (ev.key === 'Tab' && ev.shiftKey) {
                                    ev.preventDefault();
                                    $('div.stm32-tab a, .stm32-tab-icon a')
                                        .attr('tabindex', '0')
                                        .attr('aria-hidden', 'false');
                                    $lastLink.focus();
                                }
                            });
                        }
                        const $lastLinkSuite = $(container).find('div.stm32-tab.contact-us-tab a');
                        if ($lastLinkSuite.length > 0) {
                            $lastLinkSuite.on('keydown.accessibility', function (ev) {
                                if (ev.key === 'Enter') {
                                   $lastLinkSuite.click();
                                }
                            });
                        }
                    }
                }
            });
            obs.disconnect();
        }
    });
    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
}

function updateAriaExpandedForElement(element) {
    const link = element.querySelector('a');
    if (!link) return;

    const isOpen = element.classList.contains('submenu-opened') || element.classList.contains('st-nav__menu-item--active') || element.classList.contains('parent--active');
    link.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
}

function observeMenuElements(element) {
    updateAriaExpandedForElement(element);
    const observer = new MutationObserver(mutations => {
        mutations.forEach(mutation => {
            if (mutation.attributeName === 'class') {
                updateAriaExpandedForElement(element);
            }
        });
    });

    observer.observe(element, { attributes: true });
}

function setupGlobalObserver() {
    const config = { childList: true, subtree: true };

    const globalObserver = new MutationObserver((mutations) => {
        mutations.forEach(mutation => {
            mutation.addedNodes.forEach(node => {
                if (!(node instanceof HTMLElement)) return;

                const elements = node.matches
                    ? [node]
                    : [];
                elements.push(...node.querySelectorAll(
                    '.st-header-menu__item.st-header-menu__link-with-submenu, ' +
                    '.st-nav__menu-item.js-st-crewmenu-nav-menu-item.js-ngheader-menu-template, ' +
                    '.st-nav__submenu-item.js-st-crewnav-submenu-item, ' +
                    '.st-header-menu__link-with-submenu.st-nav__menu-item-devzone'
                ));

                elements.forEach(el => observeMenuElements(el));
            });
        });
    });

    globalObserver.observe(document.body, config);
}

const handleEscapeKey = handleEscapeKeyFactory({
  selector: '.st-header-menu__item.st-header-menu__link-with-submenu.submenu-opened',
  activeClass: 'submenu-opened',
  updateTabIndexesFn: updateSubmenuTabIndexes,
  focusSelector: 'a.st-header-menu__link'
});

const handleEscapeKeyBottomMenu = handleEscapeKeyFactory({
  selector: 'div.st-header-menu__link-with-submenu.st-nav__menu-item-devzone.submenu-opened',
  activeClass: 'submenu-opened',
  updateTabIndexesFn: updateBottomMenuTabIndexes,
  focusSelector: '.st-header-menu__link-with-submenu.st-nav__menu-item-devzone a.st-nav__menu-link'
});


document.addEventListener('keydown', function(event) {
  const devZoneToggle = event.target.closest('.st-header-menu__link-with-submenu.st-nav__menu-item-devzone div');
  if (devZoneToggle && (event.key === 'Enter' || event.keyCode === 13)) {
    setTimeout(updateBottomMenuTabIndexes, 100);
    setTimeout(updateSubmenuTabIndexes, 100);
  }
});
(function ($) {
    window.STFED = window.STFED || {};

    var phoneBreakpoint = STFED.mediaQueries.smallMax + ', screen and (orientation:landscape) and (max-height: 450px)';
    var mobileBreakpoint = STFED.mediaQueries.mediumMax;
    var MIN_VISIBLE_HEIGHT = 100;

    function StickyBlock($element, parentStickyBlock, options) {
        this.top = null;
        this.options = typeof options === 'undefined' ? {} : options;
        this.height = 0;
        this._$element = $element;
        this._$spacer = $();
        this._parentStickyBlock = parentStickyBlock;
        this._isMobile = false;
        this._isPhone = false;
        this._isStuck = false;
        this._onScroll = this._onScroll.bind(this);
        this._onWindowResize = _.throttle(this._onWindowResize.bind(this), 100);
        this._onLayoutChange = this._onLayoutChange.bind(this);
        this._enquirePhoneHandler = {
            match: this._onPhoneBreakpointChange.bind(this, true),
            unmatch: this._onPhoneBreakpointChange.bind(this, false)
        };
        this._enquireHandler = {
            match: this._onMobileBreakpointChange.bind(this, true),
            unmatch: this._onMobileBreakpointChange.bind(this, false)
        };
        this._minStartOffset = this._$element.offset().top;
    }

    StickyBlock.prototype.hasClass = function (className) {
        return this._$element.hasClass(className);
    };

    StickyBlock.prototype.enable = function () {
        this._startOffset = Math.max(this._$element.offset().top, this._minStartOffset);
        if (this._startOffset > this._minStartOffset) {
            this._minStartOffset = this._startOffset;
        }

        $(window).on('scroll', this._onScroll);
        $(window).on('resize', this._onWindowResize);
        $(document).on('header-left-view header-entered-view simple-accordion-was-toggled make-hierarchy-category-select',
            this._onLayoutChange);
        if (this._$spacer.length === 0) {
            if (!(typeof this.options.noSpacer !== 'undefined' && this.options.noSpacer)) {
                (this._$spacer = $('<div class="sticky-block-spacer">').hide())
                .insertBefore(this._$element);
            }
        }
        this._updateAll();
        enquire.register(phoneBreakpoint, this._enquirePhoneHandler);
        enquire.register(mobileBreakpoint, this._enquireHandler);
    };

    StickyBlock.prototype.disable = function () {
        enquire.unregister(phoneBreakpoint, this._enquirePhoneHandler);
        enquire.unregister(mobileBreakpoint, this._enquireHandler);
        $(window).off('scroll', this._onScroll);
        $(window).off('resize', this._onWindowResize);
        $(document).off('header-left-view header-entered-view simple-accordion-was-toggled make-hierarchy-category-select',
            this._onLayoutChange);
        if (this._$spacer.length) {
            this._$spacer.remove();
            this._$spacer = $();
        }
    };

    StickyBlock.prototype._updateAll = function () {
        this._updateTop();
        this._updateHeight();
        this._update();
    };

    StickyBlock.prototype._update = function () {
        var scrollTop = $(window).scrollTop();
        var $footer = $('.st-footer.hide-for-print');
        var footerTop = $footer.length ? $footer.offset().top : null;
        var stickyHeight = this._$element.outerHeight(true);
        var parentTop = this._$element.parent().offset().top;
        var maxScroll = footerTop !== null ? footerTop - stickyHeight : null;
        var tableIsVisible = true;

        if (this._$element.hasClass('st-sticky--longevity')) {
            setFooterOverlap(this._$element);
            tableIsVisible = $(window).height() - stickyHeight >= MIN_VISIBLE_HEIGHT;
        }

        this._$spacer.css({
            height: this.height + 'px'
        });

        if (
            ((this.options.mobile && this._isMobile) || (!this.options.mobile && !this._isPhone))
            && scrollTop >= this._startOffset && tableIsVisible
        ) {
            if (footerTop !== null && scrollTop >= maxScroll) {
                this._isStuck = false;
                this._$spacer.show();
                this._$element
                    .removeClass('is-fixed')
                    .css({
                        position: 'absolute',
                        top: (maxScroll - parentTop) + 'px',
                        width: '100%'
                    });
            } else {
                if (!this._isStuck) {
                    this._isStuck = true;
                    this._$spacer.show();
                    this._$element.addClass('is-fixed').removeClass('at-top');
                }
                this._$element.css({
                    position: '',
                    top: '',
                    width: ''
                });
                this._updateTop();
            }
        } else {
            this._$spacer.hide();
            this._$element.css({
                top: '',
                position: '',
                width: ''
            }).removeClass('is-fixed').removeClass('at-top');
            this._isStuck = false;
        }
    };

    StickyBlock.prototype._updateTop = function () {
        if (typeof this._parentStickyBlock !== 'undefined' && this._parentStickyBlock) {
            this.top = this._parentStickyBlock.top + this._parentStickyBlock.height;
        } else {
            var $main = $('main');
            var $header = $('.js-st-header');
            var $headerMobile = $('.js-st-header-mobile');
            var $footer = $('.st-footer.hide-for-print');
            var footerTop = $footer.length ? $footer.offset().top : null;
            var stickyHeight = this._$element.outerHeight(true);
            var scrollTop = $(window).scrollTop();

            if (footerTop !== null) {
                var maxScroll = footerTop - stickyHeight;
                if (scrollTop >= maxScroll) {
                    this.top = maxScroll - this._$element.parent().offset().top;
                    this._$element.css({
                        position: 'absolute',
                        top: this.top + 'px',
                        width: '100%'
                    });
                    return;
                }
            }
            if ($main.hasClass('js-st-header-in-view')) {
                this.top = this._isMobile ? $headerMobile.outerHeight(true) : $header.outerHeight(true);
            } else {
                this.top = 0;
            }
            this._$element.css({
                position: '',
                width: ''
            });
        }

        if (this._isStuck) {
            this._$element.css('top', this.top + 'px');
        }
    };

    StickyBlock.prototype._updateHeight = function () {
        if (typeof this.options.getHeight !== 'undefined') {
            this.height = this.options.getHeight(this._$element);
        } else {
            this.height = this._$element.outerHeight(true);
        }
    };

    StickyBlock.prototype._onScroll = function () {
        this._update();
    };

    StickyBlock.prototype._onScroll = _.debounce(function () {
        this._update();
    }, 50);

    StickyBlock.prototype._onWindowResize = function () {
        this._updateAll();
    };

    StickyBlock.prototype._onLayoutChange = function (event) {
        if (event.type === 'header-left-view') {
            if (this._isStuck) {
                this._$element.addClass('at-top');
            }
        } else if (event.type === 'header-entered-view') {
            if (this._isStuck) {
                this._$element.removeClass('at-top');
            }
        }
        this._updateAll();
    };

    StickyBlock.prototype._onPhoneBreakpointChange = function (isPhone) {
        this._isPhone = isPhone;
        this._updateAll();
    };

    StickyBlock.prototype._onMobileBreakpointChange = function (isMobile) {
        this._isMobile = isMobile;
        this._updateAll();
    };

    function setFooterOverlap(element) {
        const $footer = $('.st-footer');
        if ($footer.length) {
            $footer.toggleClass( "st-footer--overlap", element.hasClass('is-fixed') )
        }
    }

    window.STFED.StickyBlock = StickyBlock;
})(jQuery);

//SNK JS-File

$(".js-st-support-widget--open").click(function (e) {
    $(".st-support-widget").removeClass('st-support-widget--closed');
    e.stopPropagation();
});

$('.js-st-support-widget--close').on('click tap', function () {
    $('.st-support-widget').addClass('st-support-widget--closed');
});

$(".st-support-widget").click(function (e) {
    e.stopPropagation();
});

$(document).click(function () {
    $(".st-support-widget").addClass('st-support-widget--closed');
});

$(function () {
    function init() {
        $('.js-simple-accordion-toggler').each(function () {
            var toggler = this;
            var $toggler = $(toggler);
            var icon = $toggler.data('icon');
            var html = '<svg class="st-svg st-svg--arrow-right"><use xlink:href="#' + (icon || 'icon-arrow-right') + '"></use></svg>';

            $toggler.find('.st-svg').remove();

            if ($toggler.is("[data-toggler]")) {
              return;
            }
            
            $toggler.html($toggler.is('.is-left') ? html + $toggler.html() : $toggler.html() + html);

            if ($toggler.is('[data-icon-wrap]')) {
                $toggler.find('.st-svg').wrap('<div class="svg-wrap">');
            }

            $toggler.data('toggleAccordion', function (state) {
                toggle(toggler, state);
            });
        });
    }

    function dispatchToggleEvent(toggler) {
        emitCustomEvent('simple-accordion-was-toggled', {}, toggler);
    }

    function toggle(toggler, state) {
        var $accordion = $(toggler).closest('.js-simple-accordion');
        var currentState = $accordion.is('.is-expanded');

        $accordion.toggleClass('is-expanded', typeof state === 'undefined' ? !currentState : state);
        dispatchToggleEvent(toggler);
    }

    $(document).on('become-visible', function (event) {
        if ($(event.target).has('.js-simple-accordion-toggler').length) {
            init();
        }
    });

    $(document).on('click', '.js-simple-accordion-toggler:not([data-manual-triggered])', function (event) {
        toggle(event.target);
    });

    init();
});

(function ($) {
    var stickyBlocksPerTab = {};

    function getNavigationContext($tab) {
        return $('.js-navigation-tabs-context[data-tab-id="' + $tab.data('tab') + '"]');
    }

    function initStickyBlockForNavigationTabsContext($tab, blocks) {
        var $context = getNavigationContext($tab);

        if ($context.length !== 0) {
            var block = new STFED.StickyBlock($context);

            if (!block.hasClass('hidden')) {
                block.enable();
            }

            blocks.push(block);

            return block;
        }
    }

    function initStickyBlockForTabsContentMenu($tab, blocks) {
        var $content = $('.st-tabs-content--submenu-wrapper');

        if ($content.length !== 0 && $content.children().length > 0) {
            var block = new STFED.StickyBlock($content, undefined, {
                getHeight: function ($element) {
                    return $element.find('.st-tabs-content--submenu').outerHeight(true);
                }
            });

            block.enable();

            blocks.push(block);

            return block;
        }
    }

    function initStickyBlockForSecondaryTabs($tab, blocks) {
        var $content = $('[data-page-content="' + $tab.data('tab') + '"]');
        var $secondaryTabs = $content.find('.js-secondary-nav-tabs--sticky');

        if ($secondaryTabs.length !== 0) {
            var block = new STFED.StickyBlock($secondaryTabs);

            block.enable();

            blocks.push(block);

            return block;
        }
    }

    function configureForPageTabs() {
        if ($('.js-st-tabs-tab').length === 0) {
            return;
        }

        function init() {
            var $tab = $('.js-st-tabs-tab.js-st-active');

            if ($tab.length === 0) {
                return;
            }

            var tabId = $tab.data('tab');

            Object.keys(stickyBlocksPerTab).filter(function (id) { return tabId !== id; })
                .forEach(function (id) {
                    stickyBlocksPerTab[id].forEach(function (block) {
                        block.disable();
                    });
                });

            if ($tab.hasClass('is-sticky')) {
                if (typeof stickyBlocksPerTab[tabId] !== 'undefined') {
                    stickyBlocksPerTab[tabId].forEach(function (block) {
                        block.enable();
                    });
                } else {
                    var blocks = (stickyBlocksPerTab[tabId] = []);
                    var parent;

                    parent = initStickyBlockForTabsContentMenu($tab, blocks);
                    parent = initStickyBlockForNavigationTabsContext($tab, blocks, parent);
                    initStickyBlockForSecondaryTabs($tab, blocks, parent);
                }
            }
        }

        $(document).on('become-visible slider-tab-changed', function () {
            init();
        });

        init();
    }

    function configureForLongevityPage() {
        var $breadcrumbs = $('.st-sticky--breadcrumbs');
        var $headerBlock = $('.st-sticky--longevity');

        if ($breadcrumbs.length === 0 && $headerBlock.length === 0) {
            return;
        }

        var parentBlock;

        if ($breadcrumbs.length !== 0) {
            parentBlock = new STFED.StickyBlock($breadcrumbs);

            parentBlock.enable();
        }

        if ($headerBlock.length !== 0) {
            var headerBlock = new STFED.StickyBlock($headerBlock, parentBlock);

            headerBlock.enable();
        }
    }

    $(function () {
       configureForPageTabs();
       configureForLongevityPage();
    });
})(jQuery);

window.STFED = window.STFED || {};

var tableSortFirst_initialization = [];
var tableSortFirst_fnArray = [];
var tableSortFirst_fnObject = {};
var indicator = 0;

(function () {
    var self = window.STFED.TabActions = {
        actionOnDocumentReady: function (context) {
            context = context || document;

            self.putLinksIntoContainers(context);
            self.initSectionHeaders(context);
            self.initLinksCollapsing(context);
            self.initDataTable(context);
        },

        backToTop: function () {
            $('html, body').animate({scrollTop: 1}, 600);
            $('html, body').animate({scrollTop: 0}, 600);
        },

        loadRSSFeed: function () {
            var idsForRSS = {
                "list-btn-1": "/content/st_misc/new-products/new-products-rss-1.xml",
                "list-btn-3": "/content/st_misc/new-products/new-products-rss-3.xml",
                "list-btn-6": "/content/st_misc/new-products/new-products-rss-6.xml"
            };
            var idForCurrentRange = $(".active").children('a').attr("id");

            window.open(idsForRSS[idForCurrentRange], '_blank');
        },

        putLinksIntoContainers: function (context) {
            var selector = '.st-quicklinks';
            var linksContainer;
            if (typeof context !== 'undefined' && context !== document) {
                linksContainer = context.querySelector(selector);
            } else {
                linksContainer = document.querySelector(selector);
            }
            if (linksContainer === null || linksContainer.classList.contains('js-quicklinks-initialized')) {
                return
            }
            var htmlLinks = linksContainer.cloneNode(true).children;
            var links = [].slice.call(htmlLinks);
            var containers = [];
            for (var i = 0; i < 3; i++) {
                var div = document.createElement('div');
                div.classList.add('columns');
                div.classList.add('medium-4');
                div.classList.add('st-quicklinks__column');
                containers.push(div);
            }
            while (linksContainer.firstChild) {
                linksContainer.removeChild(linksContainer.firstChild);
            }
            var leftOver = links.length % 3;
            var chunkSize = Math.floor(links.length / 3);
            var targetSize;
            var linksNodes = [];

            for (var j = 0; j < 3; j++) {
                if (leftOver > 0) {
                    leftOver--;
                    targetSize = chunkSize + 1;
                } else {
                    targetSize = chunkSize;
                }
                links.splice(0, Math.min(links.length, targetSize)).forEach(function (link) {
                    containers[j].appendChild(link);
                    linksNodes.push(link);
                });
            }

            containers.forEach(function (container) {
                linksContainer.appendChild(container)
            });

            linksContainer.classList.add('js-quicklinks-initialized');
            $(linksNodes).each(function () {
                var $link = $(this);
                var $linkage = $link.closest('[data-tab-linkage]');

                if ($linkage.length > 0) {
                    var $tab = $('#' + $linkage.data('tab-linkage'));
                    var directLink = $tab.data('direct-link');

                    if (directLink) {
                        $link.addClass('js-prevent js-direct-link');
                        $link.prop('href', '#' + directLink + '&section=' + $link.data('href'));
                    }
                }
            });
        },

        addMaxVisibleItemsBehaviour: function ($element, options) {
            var maxVisibleItems = _.defaultTo(parseInt($element.data('max-visible-items'), 10), false);

            if (maxVisibleItems !== false) {
                options.pageLength = maxVisibleItems;
                options.paging = true;
            }

            return options;
        },

    initDataTable: function (contextArg) {
            var context = typeof contextArg !== 'undefined' ? contextArg : document;

			tableSortFirst_fnObject[indicator] = [];
            $('.js-st-table-sort-first', context).each(function (index, element) {
                var $table = $(this);

                if($table.is("#DataTables_Table_sample_and_buy")) {
                    return;
                }

                tableSortFirst_fnObject[indicator][index] = function () {
                    if (!$.fn.DataTable.isDataTable($table)) {
                        $table.dataTable(window.STFED.TabActions.addMaxVisibleItemsBehaviour($table, {
                            autoWidth: false,
                            paging: false,
                            ordering: true,
                            info: false,
                            initComplete: resetToggleBtnText,
                            searching: false,
                            columnDefs: [
                                {
                                    targets: 'js-st-table-col-no-sort',
                                    orderable: false
                                },
                                {
                                    targets: 'js-st-table-sorter--with-divisor',
                                    type: 'with-divisor'
                                },
                                {
                                    targets: 'js-st-table-sorter--by-date',
                                    type: 'by-date'
                                },
                                {
                                    targets: 'js-st-table-sorter--by-version',
                                    type: 'by-customversion'
                                }
                            ],
                            order: [[0, 'asc']]
                        }));
                    }
                };

                if ($table.hasClass('first-table') && !$table.data('tableSortInit')) {
                    var tableSortControls = $table.find('thead th:has(div.js-st-table-sort)');

                    $table.data('tableSortInit', true);

                    if (tableSortControls.length) {
                        tableSortControls.on('click', function () {
                            var clickedContextWrapper = $(this).closest('div.js-tables-multiple-download');
                            var clickedTitle = $(this).text();
                            var clickedControls = $('th:contains("' + clickedTitle + '")', clickedContextWrapper).not($(this));

                            if (clickedControls.length) {
                                clickedControls.click();
                            }
                        })
                    }
                }

                if($table.isInViewport()){
                    tableSortFirst_fnObject[indicator][index]();
                } else {
                    tableSortFirst_initialization[index] = _.debounce(function() {
                        if($table.isInViewport()){
                            tableSortFirst_fnObject[indicator][index]();
                            $(window).unbind("scroll", tableSortFirst_fnObject[indicator][index]);
                        }
                    }, 100, {maxWait: 100});
                    $(window).bind("scroll", tableSortFirst_fnObject[indicator][index]);
                }

            });
			indicator++;
            function resetToggleBtnText(context) {
                if ($(".js-st-quickview-toggle").length > 0) {
                    $(".sorting, .sorting_asc, .sorting_desc", context).click(function () {
                        var a = $(this).parents("table");
                        $(".js-st-quickview-toggle", a).each(function () {
                            $(this).removeClass("js-active");
                            $("span", $(this)).text($(this).attr("data-btn-text"));
                        });
                    });
                }
            }
        },

        initLinksCollapsing: function (contextArg) {
            var context = typeof contextArg !== 'undefined' ? contextArg : document;

            $('.js-st-collapse', context).each(function (index, el) {
                var maxItems = $(this).data('collapse-items');
                var hideItems = maxItems - 1;
                var textOpen = $(this).data('collapse-open');

                var items = $(this).find("a").length;
                $(this).find(".st-collapse-list__item:last-child").addClass("st-collapse-list__item--last");

                if (maxItems < 1) {
                    hideItems = 0;
                    $(this).find("a").eq(0).hide();
                }

                if (items > maxItems) {
                    $(this).find("a:gt(" + hideItems + ")").hide();
                    $(this).find(".js-st-collapse-open").remove();
                    $(this).append('<a class="st-collapse-list__trigger js-st-collapse-item js-st-collapse-open">' + textOpen + '</a>');
                }
            })
        },

        initSectionHeaders: function (contextArg) {
            var context = typeof contextArg !== 'undefined' ? contextArg : document;

            if (context === document) {
                context = $('.dynamic-content [data-tab-linkage]');
            }

            $('h2[id]', context).each(function () {
                var attributes = [].concat
                    .apply([], this.attributes)
                    .reduce(function (obj, attribute) {
                        obj[attribute.name] = attribute.value;
                        return obj;
                    }, {});
                var $link = $('<a>');
                var tab = $('#' + $(this).closest('[data-tab-linkage]').data('tab-linkage')).data('direct-link');

                $link.attr(attributes);
                $link.attr('href', '#' + tab + '&section=' + this.id);
                $link.addClass('st-longevity-section-header');
                $link.html($(this).html());

                $(this).replaceWith($link);
            });
        }
    };

    $(document).ready(function () {
        self.actionOnDocumentReady();
    });
})();

window.STFED = window.STFED || {};

(function () {
    var self = window.STFED.PreloadTabs = {
        deferreds: [],

        // For longevity tabs, creates container divs for tabs, downloads data, populates tables, disables loading animation on success, error message on error
        establishPreloadTabContent: function() {
            $('.js-preload-tab').each(function (index) {
                var $this = $(this);
                var $thisID = $this.attr('id');
                var url = $this.data('current-node-path');
                var $tabContainer = $('.dynamic-content');

                $this.data('order', index);

                self.deferreds[index] = $.Deferred();

                if (!$this.is('.is-preloaded') && url !== '#') {
                    var $wrapper = $('<div class="hidden dynamic-content-wrapper" data-tab-linkage="' + $thisID + '" />');

                    $tabContainer.append($wrapper);

                    $wrapper.append('<div class="st-loading-spinner" />');

                    $.ajax({
                        url: url,
                        cache: true,
                        dataType: 'html',
                        success: function (data) {
                            if (data) {
                                var $domData = $(data);
                                var dispatchableElements = [$wrapper[0]];

                                $firstBlock = $domData.filter('.js-first-block');
                                if ($firstBlock.length) {
                                    var $accordionWrapper = $('<div class="st-preload-accordion" data-tab-linkage="' + $thisID + '" />');

                                    $accordionWrapper.html($firstBlock[0].outerHTML);
                                    if ($this.closest('.st-longevity-tab').is('.active')) {
                                        $accordionWrapper.addClass('is-active');
                                    }
                                    $('.st-preload-accordions').append($accordionWrapper);
                                    dispatchableElements.push($accordionWrapper[0]);
                                }
                                $wrapper.html('');
                                $domData.filter(':not(.js-first-block)').appendTo($wrapper);
                                window.STFED.navigationTabs.dispatchBecomeVisibleEvent(dispatchableElements);
                                window.STFED.TabActions.actionOnDocumentReady($wrapper[0]);
                                self.deferreds[index].resolve(true);
                            }
                        },
                        error: function(data){
                            $tabContainer.find('[data-tab-linkage="' + $thisID + '"]').html('<p>Error loading data</p>');
                        }
                    });
                }
            });

            // add click handler
            $('.js-preload-tab').on('click', function () {
                self.preloadChangeTab(this);
            });
        },
        // For longevity tabs, changes tab, and handles button
        preloadChangeTab: function(el, isTriggered) {
            var $button = $(el);
            var $tabContainer = $('.dynamic-content');
            var badgeUrl = $button.data('badge-url');

            if ($button.hasClass('active')) {
                if (isTriggered === false) {
                    self.tryToScrollToSection();
                }
                return;
            }

            $('.st-longevity-tab').removeClass('active');
            $button.closest('.st-longevity-tab').addClass('active');

            $tabContainer.find('[data-tab-linkage]').addClass('hidden');
            $tabContainer.find('[data-tab-linkage="' + $button.attr('id') + '"]').removeClass('hidden');
            var $accordion = $('.st-preload-accordion').removeClass('is-active').filter('[data-tab-linkage="' + $button.attr('id') + '"]');
            $accordion.addClass('is-active');
            if ($accordion.length) {
                window.STFED.navigationTabs.dispatchBecomeVisibleEvent($accordion[0]);
            }

            window.STFED.TabActions.backToTop();

            if (isTriggered === undefined || isTriggered === true) {
                location.hash = $(el).data('direct-link') || '';
            }

            if (isTriggered === false) {
                self.deferreds[+$button.data('order')]
                    .promise()
                    .then(function () {
                        self.tryToScrollToSection();
                    });
            }

            if (badgeUrl) {
                var $badge = $('.st-stage__badge');
                $badge.find('img').remove();
                $badge.append($('<img>').attr('src', badgeUrl));
            }
        },
        tryToScrollToSection: function () {
            var sectionPos = location.hash.indexOf('&section=');

            if (sectionPos > 0) {
                var section = location.hash.substr(sectionPos + 9).split('&')[0];

                $('html, body').animate({
                    scrollTop: $('#' + section).offset().top
                }, 300);
            }
        }
    };

    $(function () {
        var STFED = window.STFED || {};

        self.establishPreloadTabContent();

        var $activeBtn = $('[data-direct-link="' + location.hash.substr(1).split('&')[0] + '"]');

        if ($activeBtn.length) {
            self.preloadChangeTab($activeBtn, false);
        } else {
            self.tryToScrollToSection();
        }

        enquire.register(STFED.mediaQueries.mediumMax, {
            match: function() {
                $('.st-stage-product__tags a').removeAttr('data-tooltip');
            },
            unmatch: function() {
                $('.st-stage-product__tags a').attr('data-tooltip', true);
            }
        });
    });
})();

$(function() {

    var popoverActiveClass = 'st-popover--active';
    var popoverRightAlignClass = 'st-popover__wrapper--right';
    var scrollTop;

    $(document).on('click', '.js-st-popover', function(event) {
        event.preventDefault();
        var $popoverLink = $(this);
        var $popover = $popoverLink.closest('.st-popover');
        var $popoverClose = $popover.closest('.js-st-popover-close');

        if($popover.hasClass(popoverActiveClass)) {
            // Close popover
            $popover.removeClass(popoverActiveClass);
        } else {
            if($popoverLink.data("show-results")!==1 && $popoverLink.parents().hasClass('st-search-results-nav')){
                var wrapper = $popover.children(".st-popover__wrapper");
                wrapper.find(".st-popover__title").text($popoverLink.data("login-message-header"));
                wrapper.find(".st-popover__content").html('<p class="st-font-size--xs">'+ $popoverLink.data("login-message-content") +'</p>')
                wrapper.find(".st-popover__footer").hide();
            }
            if(!($popoverLink.data("show-results")==1 && $popoverLink.hasClass('js-st-toggle-star'))) {
                // necessary for popovers with search field
                $('.st-popover').removeClass(popoverActiveClass);
                // increase z index of table with an open popover to overlay other tables
                var zIndexClass = 'js-st-table--zindex';
                $('.st-table--search').removeClass(zIndexClass);
                $popover.closest('.st-table--search').addClass(zIndexClass);
                // Open popover
                $popover.addClass(popoverActiveClass);
            }
        }

        var wrapper = $(this).parent().find(".st-popover__wrapper");
        var leftPos = $popoverLink.offset().left;

        if(wrapper.css('position')=='fixed'){
            wrapper.css('top', $popover.offset().top - $(window).scrollTop()+20);
            wrapper.css('left', leftPos);
        }
        if (parseInt(window.innerWidth) - leftPos <= 180) {
            wrapper.css('left', 'auto');
            wrapper.css('right', 0);
        }
        if (parseInt(window.innerWidth) - leftPos <= 210 && !(wrapper.hasClass("st-popover__wrapper--share"))) {
            wrapper.css('left', 'auto');
            wrapper.css('right', 0);
            if (wrapper.children('.arrow').length > 0 && parseInt(window.innerWidth) > 640) {
                wrapper.addClass(popoverRightAlignClass);
            }
        }
        scrollTop = $(window).scrollTop();
    });
    $(window).on('resize', function(){
        closePopover();
        if( parseInt(window.innerWidth) <= 1024){
	    	$(".js-st-popover").each(function(index, el) {
	    		var here = $(this);
	    		var leftPos = here.offset().left;
                var wrapper = $(this).parent().find(".st-popover__wrapper");
                wrapper.css({'top':'','left':'', 'right':''});
                if(parseInt(window.innerWidth)-leftPos<=180){
                    here.css('left', 'auto');
                    here.css('right', 0);
                }
	    	});
		}
		else{
            $(".st-popover__wrapper").each(function(index, el) {
                var here = $(this);
                here.css('left', '');
                here.css('right', '');
                here.css('top', '');
            });
        }
	});

    function closePopover() {
        $('.st-popover').each(function() {
            $(this).removeClass(popoverActiveClass);
        });
        $('.st-popover__wrapper').removeClass('st-popover__wrapper--right');
        $(".st-table--sample-buy").removeAttr("style");
	}

    $(window).on("touchmove scroll", function() {
        var scrollCount=$(window).scrollTop() - scrollTop;
        if( parseInt(window.innerWidth) <= 1024 && (scrollCount > 250 || scrollCount < -200) ){
            closePopover();
        }
    });

    $('.js-st-popover-close').on('click', function(event) {
        event.preventDefault();
        closePopover();
    });

    $('body').on('click', function(event) {
        closePopover();
    });

    $('.st-popover__wrapper').on('click', function(event) {
        event.stopPropagation();
    });

});




function selectNavTabsLayers(hasChangePageContentTabs, submenuSelector) {
    var submenuSelector = submenuSelector;

    var displayLayerOne;
    var displayLayerTwo;
    var displayLayerThree;

    var layerOne = $('div[data-tabs-layer1-id]', submenuSelector);
    var layerOneItem = $('.js-st-nav-tabs__item--layer1', submenuSelector);
    var layerTwo = $('div[data-tabs-layer2-id]', submenuSelector);
    var layerTwoItem = $('.js-st-nav-tabs__item--layer2', submenuSelector);
    var layerThree = $('div[data-tabs-layer3-id]', submenuSelector);
    var layerThreeItem = $('.js-st-nav-tabs__item--layer3', submenuSelector);
    var layerOneCrumb = $('.js-st-nav-tabs__breadcrumb-layer1', submenuSelector);
    var layerTwoCrumb = $('.js-st-nav-tabs__breadcrumb-layer2', submenuSelector);
    var layerTwoCrumbName = $('.st-breadcrumbs__name', layerTwoCrumb);
    var layerThreeCrumb = $('.js-st-nav-tabs__breadcrumb-layer3', submenuSelector);
    var layerThreeCrumbName = $('.st-breadcrumbs__name', layerThreeCrumb);
    var breadcrumbs = $('.st-breadcrumbs', submenuSelector);
    var breadcrumbList = $('.st-breadcrumbs__list li', submenuSelector);
    var newName;

    // if there are navigation tabs that change the page content
    if ($('.js-st-page-content').length) {
        hasChangePageContentTabs = true;
        var currentPage;
    }

    setLayerOne();
    tabController();
    bcrumbsController();

    function setLayerOne() {
        displayLayerOne = true;
        displayLayerTwo = false;
        displayLayerThree = false;
    }

    function setLayerTwo() {
        displayLayerOne = false;
        displayLayerTwo = true;
        displayLayerThree = false;
    }

    function setLayerThree() {
        displayLayerOne = false;
        displayLayerTwo = false;
        displayLayerThree = true;
    }

    function resetActiveClasses() {
        layerTwoItem.removeClass("st-link--active");
        layerThreeItem.removeClass("st-link--active");
    }

    function hideSelectorTable(){
        $('.stsel-selector-ctn').addClass('is-hidden')
    }

    function tabController(layerID) {
        if (displayLayerOne) {
            layerOne.show();
        } else {
            layerOne.hide();
        }

        if (displayLayerTwo) {
            $('div[data-tabs-layer="2"][data-tabs-layer2-id="'+layerID+'"]').show();
        } else {
            layerTwo.hide();
        }

        if (displayLayerThree) {
            $('div[data-tabs-layer="3"][data-tabs-layer3-id="'+layerID+'"]').show();
        } else {
            layerThree.hide();
        }
    }

    function bcrumbsController() {
        if (displayLayerOne) {
            breadcrumbs.hide();
        }
        else {
            breadcrumbs.show();
        }

        if (displayLayerTwo) {
            $(breadcrumbList[2]).hide();
            if (window.innerWidth < 642) {
                $(breadcrumbList[0]).hide();
            }
            $(window).resize(_.debounce(function () {
                if (window.innerWidth < 642) {
                    $(breadcrumbList[0]).hide();
                    $(breadcrumbList[1]).css('display', 'inline-block');
                } else {
                    $(breadcrumbList[0]).css('display', 'inline-block');
                }
            }, 100));
        }

        if (displayLayerThree) {
            $(breadcrumbList[2]).css('display', 'inline-block');
            if (window.innerWidth < 642) {
                $(breadcrumbList[1]).hide();
            }
            $(window).resize(_.debounce(function () {
                if (window.innerWidth < 642) {
                    $(breadcrumbList[0]).hide();
                    $(breadcrumbList[1]).hide();
                } else {
                    $(breadcrumbList[0]).css('display', 'inline-block');
                    $(breadcrumbList[1]).css('display', 'inline-block');
                }
            }, 100));
        }
    }


    layerOneItem.on('click', function (e) {
        e.preventDefault();
        resetActiveClasses();
        setLayerTwo();
        newName = $('.js-st-use-for-breadcrumb', this).text();
        layerID = $(this).attr("data-tabs-layer2-id");
        layerTwoCrumbName.text(newName);
        layerTwoCrumbName.parent().attr('data-tabs-layer2-id', layerID);
        tabController(layerID);
        bcrumbsController();

        if (hasChangePageContentTabs) {
            var newPage = $(this);
            if (currentPage) {
                if (newPage[0] === currentPage[0]) {
                    return;
                }
            }
            currentPage = newPage;
            STFED.navigationTabs.openPageTab(currentPage.data("pageNav"));
        }
    });

    layerTwoItem.on('click', function (e) {
        e.preventDefault();
        resetActiveClasses();
        if($(this).attr("data-tabs-layer3-id")) {
            layerID = $(this).attr("data-tabs-layer3-id");
            setLayerThree();
        } else {
            layerID = $(this).closest(".st-nav-tabs-content__layer2").attr("data-tabs-layer2-id");
            setLayerTwo();
            $(this).addClass("st-link--active");
        }

        newName = $('.js-st-use-for-breadcrumb', this).text();
        layerThreeCrumbName.text(newName);
        layerThreeCrumbName.parent().attr('data-tabs-layer3-id', layerID);

        tabController(layerID);
        bcrumbsController();

        if (hasChangePageContentTabs) {
            var newPage = $(this);
            if (currentPage) {
                if (newPage[0] === currentPage[0]) {
                    return;
                }
            }
            currentPage = newPage;
            STFED.navigationTabs.openPageTab(currentPage.data("pageNav"));
        }
    });

    layerThreeItem.on('click', function (e) {
        e.preventDefault();
        resetActiveClasses();
        $(this).addClass("st-link--active");

        if (hasChangePageContentTabs) {
            var newPage = $(this);
            if (currentPage) {
                if (newPage[0] === currentPage[0]) {
                    return;
                }
            }
            currentPage = newPage;
            STFED.navigationTabs.openPageTab(currentPage.data("pageNav"));
        }
    });

    layerOneCrumb.on('click', function (e) {
        e.preventDefault();
        hideSelectorTable();
        resetActiveClasses();
        setLayerOne();
        tabController();
        bcrumbsController();

        if (hasChangePageContentTabs) {
            var newPage = $(this);
            if (currentPage) {
                if (newPage[0] === currentPage[0]) {
                    return;
                }
            }
            currentPage = newPage;
            STFED.navigationTabs.openPageTab(currentPage.data("pageNav"));
        }
    });

    layerTwoCrumb.on('click', function (e) {
        e.preventDefault();
        hideSelectorTable();
        resetActiveClasses();
        setLayerTwo();
        if (window.innerWidth < 642) {
            setLayerOne();
        }
        layerID = $(this).find('.st-breadcrumbs__link').attr("data-tabs-layer2-id");
        tabController(layerID);
        bcrumbsController();

        if (hasChangePageContentTabs) {
            var newPage = $(this);
            if (currentPage) {
                if (newPage[0] === currentPage[0]) {
                    return;
                }
            }
            currentPage = newPage;
            STFED.navigationTabs.openPageTab(currentPage.data("pageNav"));
        }
    });

    layerThreeCrumb.on('click', function (e) {
        e.preventDefault();
        resetActiveClasses();
        setLayerThree();
        if (window.innerWidth < 642) {
            setLayerTwo();
            $(breadcrumbList[1]).show();
        }
        layerID = $(this).find('.st-breadcrumbs__link').attr("data-tabs-layer3-id");
        tabController(layerID);
        bcrumbsController();

        if (hasChangePageContentTabs) {
            var newPage = $(this);
            if (currentPage) {
                if (newPage[0] === currentPage[0]) {
                    return;
                }
            }
            currentPage = newPage;
            STFED.navigationTabs.openPageTab(currentPage.data("pageNav"));
        }
    });
}

//Sidebar
var STFED = STFED || {};
STFED.sidebar = STFED.sidebar || {};
STFED.sidebar.collapsibleInitializedState = 0;

function scrollToTop(e) {
    if (e !== undefined) {
        e.preventDefault();
    }
    $('html, body').animate({
        scrollTop: 0
    }, 150);
}

function closeSidebar(e) {
    if (e) {
        e.preventDefault();
    }
    $('.js-st-micro').removeClass('js-st-sidebar-active');
    $('.js-st-sidebar').removeClass('js-st-sidebar-active');
    $('.js-st-micro').addClass('js-st-sidebar-closed');
    $(".js-st-sidebar, .js-st-micro").one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd", function () {
        $('.js-st-widget, .auto-resizable-slider').each(function () {
            var $element = $(this);

            if ($element.hasClass('slick-initialized')) {
                $element.slick('refresh');
            }
        });

    });
    STFED.dotdotdot.init();
    STFED.sidebar.emitEvent(false);
}

function closeFilter(e) {
    if (e) {
        e.preventDefault();
    }
    $('.js-st-micro').removeClass('js-st-filter-active');
    $('.js-st-sidebar--filter').removeClass('js-st-filter-active');
    $(".js-st-sidebar, .js-st-micro").one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd", function () {
        $('.js-st-widget, .auto-resizable-slider').each(function () {
            var $element = $(this);

            if ($element.hasClass('slick-initialized')) {
                $element.slick('refresh');
            }
        });
    });
    STFED.dotdotdot.init();
    STFED.sidebar.emitEvent(false);
}

function sidebarOnTransition() {
    $(".js-st-sidebar, .js-st-micro").one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd", function () {
        resizeQuickView();
    });
}

function closeSidebarOnClickShadow(e) {
    $(".js-st-micro.js-st-sidebar-active").unbind();
    $(".js-st-micro.js-st-sidebar-active").click(function (e) {
        if ($(".js-st-micro.js-st-sidebar-active").length > 0) {
            if (STFED.window.width <= STFED.breakpoint.mediumMax) {
                closeSidebar(e);
                sidebarOnTransition();
            }
        }
    });
}

function closeFilterOnClickShadow(e) {
    $(".js-st-micro.js-st-filter-active").unbind();
    $(".js-st-micro.js-st-filter-active").click(function (e) {
        if ($(".js-st-micro.js-st-filter-active").length > 0) {
            if (STFED.window.width <= STFED.breakpoint.mediumMax) {
                closeFilter();
            }
        }
    });
}

function openSidebarSearch(e) {
    if (e) {
        e.preventDefault();
        e.stopPropagation();
    }
    // $('.js-st-main').removeClass('js-st-sidebar-active--filter js-st-sidebar-active--tree');
    // $('.js-st-main').addClass('js-st-sidebar-active--filter');
    $('.js-st-micro').addClass('js-st-sidebar-active');
    $('.js-st-sidebar-search').addClass('js-st-sidebar-active');
    closeFilterOnClickShadow();
    STFED.sidebar.emitEvent(true);
}

function sidebarInit() {
    function openSidebarTree(e) {
        if (e !== undefined) {
            e.preventDefault();
            e.stopPropagation();
        }
        $('.js-st-micro').removeClass('js-st-sidebar-closed');
        $('.js-st-main').removeClass('js-st-sidebar-active--filter js-st-sidebar-active--tree');
        $('.js-st-main').addClass('js-st-sidebar-active--tree');
        $('.js-st-micro').addClass('js-st-sidebar-active');
        $('.js-st-sidebar--tree').addClass('js-st-sidebar-active');
        closeSidebarOnClickShadow();

        STFED.sidebar.emitEvent(true);
    }

    function openSidebarFilter(e) {
        if (e !== undefined) {
            e.preventDefault();
            e.stopPropagation();
        }
        $('.js-st-micro').removeClass('js-st-sidebar-closed');
        $('.js-st-main').removeClass('js-st-sidebar-active--filter js-st-sidebar-active--tree');
        $('.js-st-main').addClass('js-st-sidebar-active--filter');
        $('.js-st-micro').addClass('js-st-sidebar-active');
        $('.js-st-sidebar--filter').addClass('js-st-sidebar-active');
        closeSidebarOnClickShadow();
    }

    function openFilter(e) {
        if (e !== undefined) {
            e.preventDefault();
            e.stopPropagation();
        }
        $('.js-st-micro').addClass('js-st-filter-active');
        $('.js-st-sidebar--filter').addClass('js-st-filter-active');
        closeFilterOnClickShadow();
        STFED.sidebar.emitEvent(true);
    }

    $(document).on('click', '.st-sidebar__clear-filter', function (e) {
        e.preventDefault();
    });

    //Handler
    $(document).on('click', '.js-st-sidebar-close, .js-st-sidebar-cancel, .js-st-sidebar-button-confirm', function (e) {
        closeSidebar();
        sidebarOnTransition();
    });

    $(document).on('click', '.js-st-filter-cancel', function (e) {
        closeFilter();
    });

    $(document).ready(closeSidebarOnClickShadow);
    $(window).resize(_.debounce(closeSidebarOnClickShadow, 100));

    $(document).on('click', '.js-st-sidebar-open--tree', function (e) {

        var isOpened = $('.js-st-micro').hasClass('js-st-sidebar-active') && $('.js-st-sidebar--tree').hasClass('js-st-sidebar-active');

        if (!window.lateralMenuInjected && window.isProductMenu){
            replaceSidebar();
            $( document ).trigger("lateral_menu_container_loaded");
        }

        openSidebarTree(e);
        sidebarOnTransition();

        if (!isOpened) {
            scrollToTop(e);
        }
    });

    $(document).on('click', '.js-st-sidebar-open--filter', function (e) {
        openSidebarFilter(e);
        sidebarOnTransition();
        scrollToTop(e);
    });

    $(document).on('show-side-bar-filters', function() {
        openSidebarFilter();
        sidebarOnTransition();
        scrollToTop();
    });

    $(document).on('click', '.js-st-filter-open', function (e) {
        if (STFED.window.width <= STFED.breakpoint.mediumMax) {
            openFilter(e);
            scrollToTop(e);
        }
    });

    $(document).on('click', '.js-st-sidebar-open--search', function (e) {
        openSidebarSearch(e);
        scrollToTop(e);
    });

    $(document).on('click', '.js-st-scroll-to-filters', function (e) {
        $('html, body').animate({
            scrollTop: $('.st-sidebar--tree.st-sidebar--tree-filter .st-sidebar__filters:not(.hidden)').last().offset().top
        }, 'slow');
        e.preventDefault();
    });
}

//extend STFED with functions
STFED.sidebar = (function () {
    var $toggler = $('.js-st-sidebar__category-toggle');
    var $activeLayerItems = $('.st-sidebar__tree-item.js-st-active');

    var activeLayer1Item = $activeLayerItems.parents('.js-st-sidebar--layer1-item')[0];
    var activeLayer2Item = $activeLayerItems.parents('.js-st-sidebar--layer2-item')[0];
    var activeLayer3Item = $activeLayerItems.parents('.js-st-sidebar--layer3-item')[0];
    var activeLayer4Item = $activeLayerItems.parents('.js-st-sidebar--layer4-item')[0];

    return {
        isCategoryHidden: false,
        isCollapsed: $toggler.data('is-collapsed') == true,
        toggleCategoryBtn: $toggler,
        toggleTextState1: $toggler.data("toggle-text-state1"),
        toggleTextState2: $toggler.data("toggle-text-state2"),
        layer1Items: $('.js-st-sidebar--layer1-item'),
        layer2Items: $('.js-st-sidebar--layer2-item'),
        layer3Items: $('.js-st-sidebar--layer3-item'),
        layer4Items: $('.js-st-sidebar--layer4-item'),



        minimizeCategoryTree: function () {

            var toggleCategoryBtn = $('.js-st-sidebar__category-toggle');
            var toggleTextState1 = toggleCategoryBtn.data("toggle-text-state1"),
                toggleTextState2 = toggleCategoryBtn.data("toggle-text-state2");

            var $activeLayerItems = $('.st-sidebar__tree-item.js-st-active');
            var activeLayer1Item = $activeLayerItems.parents('.js-st-sidebar--layer1-item')[0];
            var activeLayer2Item = $activeLayerItems.parents('.js-st-sidebar--layer2-item')[0];
            var activeLayer3Item = $activeLayerItems.parents('.js-st-sidebar--layer3-item')[0];
            var activeLayer4Item = $activeLayerItems.parents('.js-st-sidebar--layer4-item')[0];
            var layer1Items = $('.js-st-sidebar--layer1-item'),
             layer2Items = $('.js-st-sidebar--layer2-item'),
             layer3Items = $('.js-st-sidebar--layer3-item'),
             layer4Items = $('.js-st-sidebar--layer4-item');


            layer1Items.each(function () {
                if ($(this)[0] !== activeLayer1Item && !($(this).hasClass("js-st-active"))) {
                    $(this).hide();
                }
            });
            layer2Items.each(function () {
                if ($(this)[0] !== activeLayer2Item && !($(this).parent().prev().hasClass("js-st-active")) && !($(this).hasClass("js-st-active"))) {
                    $(this).hide();
                }
            });
            layer3Items.each(function () {
                if ($(this)[0] !== activeLayer3Item && !($(this).parent().prev().hasClass("js-st-active")) && !($(this).hasClass("js-st-active"))) {
                    $(this).hide();
                }
            });
            layer4Items.each(function () {
                if ($(this)[0] !== activeLayer4Item && !($(this).parent().prev().hasClass("js-st-active")) && !($(this).hasClass("js-st-active"))) {
                    $(this).hide();
                }
            });
            if (toggleTextState2 && toggleTextState2 !== "") {
                toggleCategoryBtn.html(toggleTextState2);
            } else {
                toggleCategoryBtn.html("Expand menu");
            }
            this.isCategoryHidden = true;
        },

        expandCategoryTree: function () {

            var layer1Items = $('.js-st-sidebar--layer1-item'),
                layer2Items = $('.js-st-sidebar--layer2-item'),
                layer3Items = $('.js-st-sidebar--layer3-item'),
                layer4Items = $('.js-st-sidebar--layer4-item');


            layer1Items.show();
            layer2Items.show();
            layer3Items.show();
            layer4Items.show();

            if (this.toggleTextState1 && this.toggleTextState1 !== "") {
                this.toggleCategoryBtn.html(this.toggleTextState1);
            } else {
                this.toggleCategoryBtn.html("Minimize menu");
            }
            this.isCategoryHidden = false;
        },

        expandProductTree: function () {
            var layer4Items = $('.js-st-sidebar--layer4-item');

            layer4Items.show();
        },

        toggleMenu: function() {
            var $layerItems = $().add(this.layer1Items);

            $layerItems.find('.st-sidebar--layer2').css('display', '');

            if (this.isCollapsed) {
                $layerItems
                    .filter('.has-children')
                    .addClass('js-st-accordion-expanded')
                    .find('input[type="checkbox"]:first')
                    .prop('checked', true);
            } else {
                $layerItems
                    .filter('.has-children')
                    .removeClass('js-st-accordion-expanded')
                    .find('input[type="checkbox"]:first')
                    .prop('checked', false);
            }

            this.isCollapsed = !this.isCollapsed;

            this.toggleMenuTogglerState(this.isCollapsed);
        },

        toggleMenuTogglerState: function (state) {
            if (state) {
                if (this.toggleTextState2) {
                    this.toggleCategoryBtn.html(this.toggleTextState2);
                } else {
                    this.toggleCategoryBtn.html('Expand menu');
                }
            } else {
                if (this.toggleTextState1) {
                    this.toggleCategoryBtn.html(this.toggleTextState1);
                } else {
                    this.toggleCategoryBtn.html('Minimize menu');
                }
            }
        },

        toggleCategoryTree: function () {
            var self = this;

            var toggle = document
                .querySelector('.js-st-sidebar__category-toggle');

            if(toggle) {
                toggle.addEventListener('click', function (e) {
                    if (this.classList.contains('toggler')) {
                        self.toggleMenu();
                    } else {
                        if (self.isCategoryHidden) {
                            self.expandCategoryTree();
                        } else {
                            self.minimizeCategoryTree();
                        }
                    }
                });
            }



            this.layer1Items.eq(0).parent().on('click', this.layer1Items.find('> input[type="checkbox"]'), function (event) {
                self.isCollapsed = self.layer1Items.find('> input[type="checkbox"]:checked').length === 0;
                self.toggleMenuTogglerState(self.isCollapsed);
            });
        },

        emitEvent: function (state) {
            var event = document.createEvent('Event');

            event.initEvent(state ? 'sidebar-was-opened' : 'sidebar-was-closed', true, false);

            document.dispatchEvent(event);
        },

        initCategoriesSidebar: function () {
            var $sidebarToggler = $('.js-st-sidebar-open--tree');
            var $modalSidebar = $('.js-st-sidebar--tree');

            var onToggle = function () {
                window.emitCustomEvent('body-locked');
                $modalSidebar.toggleClass('show');
            };

            $modalSidebar.on('click', '.js-st-sidebar-cancel', function () {
                $modalSidebar.toggleClass('show', false);
                window.emitCustomEvent('body-unlocked');
            });

            enquire.register(STFED.mediaQueries.smallMax, {
                match: function() {
                    $sidebarToggler.on('click', onToggle);
                    $sidebarToggler.data('custom-toggle', true);
                },
                unmatch: function() {
                    $sidebarToggler.off('click', onToggle);
                    $sidebarToggler.data('custom-toggle', false);
                }
            });
        },

        init: function () {
            STFED.sidebar.initCategoriesSidebar();
            STFED.sidebar.toggleCategoryTree();
        }
    };
})();

document.addEventListener('DOMContentLoaded', function(){
    const sidebarCloseBtn = document.querySelector('.js-st-sidebar-close');
    const sidebarOpenBtn = document.querySelector('.js-st-sidebar-open--tree');
    const closeMobileSidebar = document.querySelector('.js-st-sidebar-cancel');

    if (sidebarCloseBtn) {
        sidebarCloseBtn.addEventListener('click', closeSidebar);
    }

    if (closeMobileSidebar) {
        closeMobileSidebar.addEventListener('click', closeSidebar);
    }

    if (sidebarOpenBtn) {
        sidebarOpenBtn.addEventListener('click', (e) => {
            e.preventDefault();
            let contentContainer = document.querySelector('.js-st-micro');
            let sidebar = document.querySelector('.st-sidebar');

            if (contentContainer) {
                if (contentContainer.classList.contains('js-st-sidebar-closed')) {
                    contentContainer.classList.remove('js-st-sidebar-closed');
                }

                if (!contentContainer.classList.contains('js-st-sidebar-active')) {
                    contentContainer.classList.add('js-st-sidebar-active');
                }

                if (sidebar && !sidebar.classList.contains('js-st-sidebar-active')) {
                    sidebar.classList.add('js-st-sidebar-active');
                }
            }
        });
    }

    (function ($) {
        $(function () {
        if (window.isProductMenu || window.isApplicationMenu){
            $(document).on('lateral_menu_container_loaded', function (e) {
                sidebarInit();
                STFED.sidebar.init();
            });
        } else {
            sidebarInit();
            STFED.sidebar.init();
        }

        });
    })(jQuery);

    setTimeout(function(){
        if(typeof productHierarchy !== "undefined"){
            if (STFED.sidebar.collapsibleInitializedState === 0) {
                STFED.accordions.collapsiblePanels();
                console.log("Failed event but lateral menu initialized");
            }
        }
    }, 100)
})

//Scroll Widgets
function scrollFilterBtn () {
    var filterSidebar = $('.st-sidebar__filters');
    filterSidebar.each(function() {
        var thisSidebar = $(this),
            thisSidebarHeight = thisSidebar.outerHeight(),
            thisSidebarOffset = thisSidebar.offset().top + thisSidebarHeight,
            fixedButton = $('.js-st-sidebar-button-confirm', thisSidebar),
            fixedButtonHeight = fixedButton.outerHeight(),
            fixedButtonOffset = fixedButton.offset().top + fixedButtonHeight;

        var windowScroll = $(window).scrollTop() + $(window).height() - 10;
        if (fixedButtonOffset >= thisSidebarOffset) {
            fixedButton.addClass('js-st-absolute');
        }
        if (fixedButtonOffset > windowScroll) {
            fixedButton.removeClass('js-st-absolute');
        }
    });
}

$(document).ready(function(){
	if($('.js-st-sidebar-button-confirm').length > 0) {
		$(document).scroll(scrollFilterBtn).resize(scrollFilterBtn).ready(scrollFilterBtn);
		$('.js-st-sidebar-open--search').click(scrollFilterBtn);
	}
});


//establish name space for fed functions
var STFED = STFED || {};

//extend STFED with functions
STFED.scrollFunctions = {
    scrollSelectedFiles: function (e) {
        var sectionAccordeon = $('.js-st-accordion-table-main');
        sectionAccordeon.each(function() {
            var thisSectionAccordeon = $(this),
                thisSectionAccordeonOffset = thisSectionAccordeon.offset().top,
                selectedFiles = $('.js-st-selected-files-overlay', thisSectionAccordeon),
                rightPosition = ($(window).width() - ($('.st-row--content-width:first').offset().left + $('.st-row--content-width:first').outerWidth())),
                windowScroll = $(window).scrollTop();
            if (windowScroll > thisSectionAccordeonOffset) {
                selectedFiles.addClass('js-st-fixed');
                selectedFiles.css("right", rightPosition);
            }
            if (windowScroll < thisSectionAccordeonOffset) {
                selectedFiles.removeClass('js-st-fixed');
                selectedFiles.css("right", '');
            }
        });
    },
    init: function () {
        enquire.register(STFED.mediaQueries.mediumMin, {
            match : function() {
                STFED.scrollFunctions.scrollSelectedFiles();
                $(window).scroll(STFED.scrollFunctions.scrollSelectedFiles).on("orientationchange", STFED.scrollFunctions.scrollSelectedFiles);

            },
            unmatch : function() {
                $(window).off("scroll orientationchange", STFED.scrollFunctions.scrollSelectedFiles);
            }
		});
    }
};

(function ($) {
    STFED.scrollFunctions.init();
})(jQuery);

$('.js-st-table-hover-active td:not(.st-table__cell--fixed)').hover(function() {
    $this = $(this);
    var index = this.cellIndex;
    var $tableRow = $(this).closest('tr');

    $tableRow.addClass('st-table__row--hover');
    $tableCells = $tableRow.siblings('tr').find('td');
    $tableHeads = $(this).closest('.st-table').find('th');

    $tableCells.each(function() {
        if(this.cellIndex === index) {
            $(this).addClass('st-table__cell--hover');
        }
    });

    $tableHeads.each(function() {
        if(this.cellIndex === index) {
            if($(this).find('span').length) {
                $(this).addClass('st-table__head-item--hover');
                $(this).find('span:nth-child(2)').addClass('js-st-active');
            } else {
                $(this).addClass('st-table__head-item--hover');
            }
        }

        if((this.cellIndex === (index - 1)) && $(this).find('span').length) {
            $(this).addClass('st-table__head-item--hover');
            $(this).find('span:nth-child(3)').addClass('js-st-active');
        }
    });
}, function() {
    $this = $(this);
    var index = this.cellIndex;
    var $tableRow = $(this).closest('tr');

    $tableRow.removeClass('st-table__row--hover');
    $tableCells = $tableRow.siblings('tr').find('td');
    $tableHeads = $(this).closest('.st-table').find('th');

    $tableCells.each(function() {
        if(this.cellIndex === index) {
            $(this).removeClass('st-table__cell--hover');
        }
    });

    $tableHeads.each(function() {
        if(this.cellIndex === index) {
            if($(this).find('span').length) {
                $(this).removeClass('st-table__head-item--hover');
                $(this).find('span:nth-child(2)').removeClass('js-st-active');


            } else {
                $(this).removeClass('st-table__head-item--hover');
            }
        }

        if((this.cellIndex === (index - 1)) && $(this).find('span').length) {
            $(this).removeClass('st-table__head-item--hover');
            $(this).find('span:nth-child(3)').removeClass('js-st-active');

        }
    });
});


// Workaround for table in table (e.g. resource table)
//$('.js-st-table-sub-hover-active').hover(function() {
//    $this = $(this);
//    var index = this.cellIndex;
//    var $deepTableRow = $(this).closest('table').find('tr');
//    var $tableRow = $(this).parents('tr').parents('tr');
//
//    $deepTableRow.addClass('st-table__row--hover');
//    $tableRow.addClass('st-table__row--hover');
//    $tableCells = $tableRow.siblings('tr').find('td');
//
//    $tableCells.each(function() {
//        if(this.cellIndex === index) {
//            $(this).addClass('st-table__cell--hover');
//        }
//    });
//}, function() {
//    $this = $(this);
//    var index = this.cellIndex;
//    var $deepTableRow = $(this).closest('table').find('tr');
//    var $tableRow = $(this).parents('tr').parents('tr');
//
//    $deepTableRow.removeClass('st-table__row--hover');
//    $tableRow.removeClass('st-table__row--hover');
//    $tableCells = $tableRow.siblings('tr').find('td');
//
//    $tableCells.each(function() {
//        if(this.cellIndex === index) {
//            $(this).removeClass('st-table__cell--hover');
//        }
//    });
//});

$(function () {
    var i = 0;

    $(document).on('change', '.js-st-checkbox-all', function () {
        if (this.checked) {
            $(this).closest('thead').next('tbody').find('input[type=checkbox]').prop('checked', true);
            i = $(this).closest('thead').next('tbody').find('input[type=checkbox]').length;

            $('.js-st-checkbox-download').addClass('st-table__head-item--download-active');
        } else {
            $(this).closest('thead').next('tbody').find('input[type=checkbox]').prop('checked', false);
            i = 0;

            $('.js-st-checkbox-download').removeClass('st-table__head-item--download-active');
        }
    });

    $(document).on('change', '.js-st-checkbox', function () {
        var $parent = $(this).closest('.st-checkbox');
        var $row = $(this).closest('tr');
        var $container = $parent.parent();
        var checkboxCount = $(this).closest('.js-st-checkbox-table').children('tbody').find('input[type=checkbox]').length;

        $row.toggleClass('active');

        if (this.checked) {
            i++;
            if (i === 2) {
                $('.js-st-checkbox-download').addClass('st-table__head-item--download-active');
                $(this).closest('.js-st-checkbox-table').find('.js-st-checkbox-all').closest('.st-checkbox').addClass('st-checkbox--half-checked');
            }

            if (i === checkboxCount) {
                $(this).closest('.js-st-checkbox-table').find('.js-st-checkbox-all').prop('checked', true);
                $(this).closest('.js-st-checkbox-table').find('.js-st-checkbox-all').closest('.st-checkbox').removeClass('st-checkbox--half-checked');
            }
        } else {
            i--;

            if (i === 1) {
                $('.js-st-checkbox-download').removeClass('st-table__head-item--download-active');
                $(this).closest('.js-st-checkbox-table').find('.js-st-checkbox-all').closest('.st-checkbox').removeClass('st-checkbox--half-checked');
            }

            if (i < checkboxCount) {
                $(this).closest('.js-st-checkbox-table').find('.js-st-checkbox-all').prop('checked', false);
                $(this).closest('.js-st-checkbox-table').find('.js-st-checkbox-all').closest('.st-checkbox').addClass('st-checkbox--half-checked');
            }
        }

        if ($parent.length > 0) {
            var $table = $container.closest('table');
            var toggled = $table.find('input[type="checkbox"]:checked').length;

            $table.toggleClass(
                'has-toggled',
                toggled > 0
            ).find('.download-selected-btn button').html('Download (' + toggled + ')');
        }
    });

    $(document).ready(function() {
        initProductSelectors();
    });

    var processedTables = [];

    processTables();

    STFED.checkboxFunctions.processTables = processTables

    $(document).on('dynamicBlocksInNavTabsLoaded', processTables);

    function processTables() {
        $('.js-tables-multiple-download').each(function () {
            var $multipleDownload = $(this);
            var $checkboxes = $('.js-tables-multiple-download-checkbox', this);

            if (processedTables.includes($multipleDownload)) {
                return;
            }

            var downloadLimit = Number($multipleDownload.attr('data-download-limit')) || 15;
            var warningText = $multipleDownload.attr('data-disabled-text') || 'Max 15 downloads at once';
            var items = [];
            var checked = 0;

            $checkboxes.each(function () {
                var $checkbox = $(this);
                var isDisabled = $checkbox.data('init-disabled');
                if (isDisabled) {
                    $checkbox.prop('disabled', true);
                }
            })

            function showTooltip(state) {
                function removeTooltip($label) {
                    $label.removeAttr('data-tooltip').removeAttr('data-haspopup');
                    setTimeout(function () {
                        $('span.tooltip.documentation-table').hide();
                    }, 200);
                }

                $multipleDownload.find('.js-tables-multiple-download-checkbox:not(:checked)').each(function () {
                    var isDisabled = $(this).data('init-disabled');
                    var $label = $(this).siblings('label');
                    if (state) {
                        $(this).attr('disabled', true);
                        $label.attr({
                            'data-tooltip': '',
                            'data-haspopup': '',
                        });
                    } else if (!isDisabled) {
                        $(this).removeAttr('disabled');
                        removeTooltip($label);
                    } else if (isDisabled) {
                        removeTooltip($label);
                    }
                });

                $multipleDownload.foundation({
                    tooltip: {
                        tip_template: function (selector) {
                            return '<span data-selector="' + selector + '" id="' + selector + '" class="st-custom-tooltip-appearance documentation-table '
                                + Foundation.libs.tooltip.settings.tooltip_class.substring(1)
                                + '" role="tooltip">' + warningText + '<span class="nub"></span></span>';
                        }
                    }
                }, 'reflow');
            }

            function state() {
                var state = true;
                return function (isDownloadable, ignoreState) {
                    var mode = isDownloadable ? false : true;
                    if (state !== isDownloadable || ignoreState) {
                        showTooltip(mode);
                        state = isDownloadable;
                    }
                    return state;
                }
            }

            var downloadableState = state();

            $(document).on('load-more-triggered', function () {
                var $button = $multipleDownload.find('.js-tables-multiple-download-button').find('button');
                var isDownloadable = (checked < downloadLimit);

                $button.html(Granite.I18n.get('Download') + ' (' + checked + ')');
                setTimeout(function () {
                    downloadableState(isDownloadable, true);
                }, 0);
            });

            $multipleDownload.on('change', '.js-tables-multiple-download-checkbox', function (e) {
                var $checkbox = $(this);
                var $parent = $checkbox.closest('.st-checkbox');
                var $row = $checkbox.closest('tr');
                var $container = $checkbox.closest('.js-tables-multiple-download');
                var $button = $container.find('.js-tables-multiple-download-button').find('button');
                var $firstTable = $container.find('table.first-table');
                var id = $checkbox.val();
                var isDownloadable = (checked <= downloadLimit);

                if (!isDownloadable) {
                    this.checked = false;
                    e.preventDefault();

                } else {
                    if (this.checked && isDownloadable) {
                        $row.toggleClass('active', true);
                        if (STFED && STFED.CustomDataLayer) {
                            STFED.CustomDataLayer.setMultipleDownloadFile(id);
                        }
                        items.push($checkbox[0]);
                    } else {
                        $row.toggleClass('active', false);
                        if (STFED && STFED.CustomDataLayer) {
                            STFED.CustomDataLayer.setMultipleDownloadFile(id, true);
                        }
                        items = items.filter(function (el) {
                            return el !== $checkbox[0];
                        });
                    }

                    checked = items.length;

                    if ($parent.length > 0) {
                        if (checked > 1 && isDownloadable) {
                            $button.removeAttr('disabled');
                        } else {
                            $button.attr('disabled', 'disabled');
                        }
                        $button.html(Granite.I18n.get('Download') + ' (' + checked + ')');
                    }
                }

                downloadableState(checked < downloadLimit, false);
            });

            function makeMultipleDownload(context) {
                var $context = $(context);
                var $checkboxes = items;

                var ids = $checkboxes.map(function (item) {
                    return item.value;
                });

                var $form = $('<form target="_blank"></form>');

                $('body').append($form);

                if ($checkboxes.length === 1) {
                    $form.attr('action', $($checkboxes[0]).data('link'));
                    STFED.getResource.markAsDownloaded(
                      $($checkboxes[0]).data("link"),
                      $($checkboxes[0]).data("link-title")
                    );
                } else {
                    $form.attr('action', $context.data('download-selected-endpoint'));
                    ids.forEach(function (id) {
                        $form.append('<input name="assetPath" type="hidden" value="' + id + '">');
                    });
                    STFED.getResource.markAsDownloaded(
                      "Multiple resources download",
                      "Multiple resources download"
                    );
                }

                $form.submit();

                setTimeout(function () {
                    $form.remove();
                }, 0);
            }

            $multipleDownload.on('click', '.download-selected-btn button', function (event) {
                makeMultipleDownload($(event.target).closest('table'));
            });

            $multipleDownload.on('click', '.js-tables-multiple-download-button button', function (event) {
                event.preventDefault();
                makeMultipleDownload($(event.target).closest('.js-tables-multiple-download'));
            });

            processedTables.push($multipleDownload);
        });
    }
});


//establish name space for fed functions
var STFED = STFED || {};

//extend STFED with functions
STFED.checkboxFunctions = {

    compareCount: 0,
    selectCount: 0,
    mobileCount: 0,
    nonMobileCount: 0,

    handleCompareCounter: function (clickedCheckbox, compareButton) {
        if(clickedCheckbox.checked) {
            this.compareCount++;
            if(this.compareCount >= 2) {
                compareButton.removeClass('st-button--disabled').find('.js-st-checkbox-table-compare-count').html('&nbsp;(' + this.compareCount + ')');
            }
        } else {
            this.compareCount--;
            compareButton.find('.js-st-checkbox-table-compare-count').html('&nbsp;(' + this.compareCount + ')');

            if(this.compareCount < 2) {
                compareButton.addClass('st-button--disabled').find('.js-st-checkbox-table-compare-count').empty();
            }
        }
    },

    compareProducts: function () {
        $(document).on('change', '.js-st-checkbox-compare', function() {
            var checkboxCountCompare = $(this).closest('.js-st-checkbox-table-compare').children('tbody').find('input[type=checkbox]').length;
            var allowedCount = ($(window).width() < 640)? 2 : 4;
            var isMobileTable = $(this).closest('.st-table--small').length;
            var parentTable = isMobileTable? $(this).closest('.st-table--small') : $(this).closest('.st-table');
            var compareButton = isMobileTable? $('.js-st-compare-btn.show-for-small') : parentTable.find('.js-st-compare-btn');
            STFED.checkboxFunctions.compareCount = isMobileTable? STFED.checkboxFunctions.mobileCount : STFED.checkboxFunctions.nonMobileCount;
            STFED.checkboxFunctions.handleCompareCounter(this, compareButton);

            if(STFED.checkboxFunctions.compareCount >= allowedCount){
                parentTable.find("input.js-st-checkbox-compare:not(:checked)").attr("disabled", true);
            } else {
                parentTable.find(".js-st-checkbox-compare").attr("disabled", false);
            }

            isMobileTable? STFED.checkboxFunctions.mobileCount = STFED.checkboxFunctions.compareCount : STFED.checkboxFunctions.nonMobileCount = STFED.checkboxFunctions.compareCount;
        });
    },

    selectFilesForDownload: function () {
        $(document).on('change', '.js-st-checkbox-pf-tools', function() {
            var checkboxCountCompare = $(this).closest('.js-st-checkbox-table-compare').children('tbody').find('input[type=checkbox]').length;
            var allowedCount = ($(window).width() < 640)? 2 : 4;

            if(this.checked) {
                if (STFED && STFED.CustomDataLayer) {
                    STFED.CustomDataLayer.setMultipleDownloadFile(this.value);
                }
                STFED.checkboxFunctions.selectCount++;
                if(STFED.checkboxFunctions.selectCount < 10) {
                    $('.js-st-selected-files-overlay-counter').html('0' + STFED.checkboxFunctions.selectCount);
                }
                else {
                    $('.js-st-selected-files-overlay-counter').html(STFED.checkboxFunctions.selectCount);
                }
            } else {
                if (STFED && STFED.CustomDataLayer) {
                    STFED.CustomDataLayer.setMultipleDownloadFile(this.value, true);
                }
                STFED.checkboxFunctions.selectCount--;

                if(STFED.checkboxFunctions.selectCount < 10) {
                    $('.js-st-selected-files-overlay-counter').html('0' + STFED.checkboxFunctions.selectCount);
                }
                else {
                    $('.js-st-selected-files-overlay-counter').html(STFED.checkboxFunctions.selectCount);
                }
            }
            if(STFED.checkboxFunctions.selectCount >= allowedCount){
                $("input.js-st-checkbox-compare:not(:checked)").attr("disabled", true);
            } else {
                $(".js-st-checkbox-compare").attr("disabled", false);
            }
        });
    },

    init: function () {
        STFED.checkboxFunctions.compareProducts();
        STFED.checkboxFunctions.selectFilesForDownload();
    }
};

(function ($) {
    STFED.checkboxFunctions.init();
})(jQuery);

function initProductSelectors(context) {
    context = context || document;

    $('.st-table--boxed table .st-checkbox', context).each(function(){
        var _checkbox = $(this).children('input:checkbox'),
            _this = $(this);

        $(this).parents('tr').first().on('click', function(e){
            if(
                e.target.nodeName.toLowerCase() != 'input' &&
                e.target.nodeName.toLowerCase() != 'textarea' &&
                _this.html() != $(e.target).parent().html() &&
                e.target.nodeName.toLowerCase() != 'a' &&
                $(e.target).parents('a').length < 1
            ){
               _checkbox.trigger('click');
            }
       });
    });
}

// Disabling child checkboxes, inputs, content with parent checkbox
$(function() {
    var overlay = 'js-st-parent-checkbox__overlay';
    var labelClass = '.js-sidebar-filter-label';
    var overlayShowClass = 'js-st-parent-checkbox--not-checked';

    $(document).on('change', '.js-st-parent-checkbox--disabling', function() {
        var wrapper = $(this).closest('.js-st-parent-checkbox__wrapper');

        if(this.checked) {
            wrapper.removeClass(overlayShowClass);
            wrapper.find('.' + overlay).remove();

        } else {
            wrapper.addClass(overlayShowClass);
            var label = wrapper.find(labelClass);
            wrapper.append('<div class="' + overlay + '" style="top:' + label.height() + 'px"></div>');
        }
    });
});

/*!
 * jQuery UI Touch Punch 0.2.3
 *
 * Copyright 2011–2014, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
!function(a){function f(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var e,b=a.ui.mouse.prototype,c=b._mouseInit,d=b._mouseDestroy;b._touchStart=function(a){var b=this;!e&&b._mouseCapture(a.originalEvent.changedTouches[0])&&(e=!0,b._touchMoved=!1,f(a,"mouseover"),f(a,"mousemove"),f(a,"mousedown"))},b._touchMove=function(a){e&&(this._touchMoved=!0,f(a,"mousemove"))},b._touchEnd=function(a){e&&(f(a,"mouseup"),f(a,"mouseout"),this._touchMoved||f(a,"click"),e=!1)},b._mouseInit=function(){var b=this;b.element.bind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),c.call(b)},b._mouseDestroy=function(){var b=this;b.element.unbind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),d.call(b)}}}(jQuery);

function customizeColumns() {
	customizeColumnsSortable()
	customizeColumnsCheckbox ()
}

function customizeColumnsSortable() {
    $('.js-st-customize_columns-select').each(function() {
	    new SimpleBar($(this)[0], {
	        autoHide: false
	    });
    });
    
    $( ".simplebar-content").sortable({
      cancel: ".st-customize_columns__select--disabled",
      handle: ".js-st-customize-columns-handle",
      items: "> li:not(:first)"
    });

}

function customizeColumnsCheckbox() {

	var checkParentInput = $(".js-checkbox-multi-parent input:checkbox");
	var checkChildInput = $(".js-checkbox-multi-child input:checkbox");

    checkParentInput.change(function(event) {
    	var ischecked= $(this).is(':checked');
	    if(!ischecked) {
	    	checkChildInput.prop('checked', false);
	    }
	    if(ischecked) {
	    	checkChildInput.prop('checked', true);
	    }

    });
    checkChildInput.change(function(event) {
    	var ischecked= $(this).is(':checked');
	    if(!ischecked) {
    		var sibling = $(this).parent().parent().siblings('li').children().children().is(':checked');
		      if(!sibling) {
    			checkParentInput.prop('checked', false);
		    }	
	    }
	    if(ischecked) {
	    	checkParentInput.prop('checked', true);
	    }
    });




}


window.STFED = window.STFED || {};

var checkBackToTopVisibility;
$(document).ready(function() {
$(document).on("click",".js-back-to-top-btn", function () {
    $('html, body').animate({
        scrollTop: 0
    }, 500);
});

// inital check if button should be shown
var backToTopBtn = $('.js-back-to-top-btn');
var backToTopToggleClass = 'back-to-top-btn--hidden';

if (backToTopBtn.length > 0) {
    if(ContentIsBigger() && !notOnTopOfPage()) {
        backToTopBtn.removeClass(backToTopToggleClass)
    }

    $(window).scroll(function() {
        if(notOnTopOfPage()) {
            backToTopBtn.addClass(backToTopToggleClass)
        } else {
            backToTopBtn.removeClass(backToTopToggleClass)
        }
    });
}

function notOnTopOfPage() {
    return window.pageYOffset <= 245;
}
function ContentIsBigger() {
    return $('.off-canvas-wrap').height() > $(window).height();
}

// check if button should be shown after accordion opened
checkBackToTopVisibility = function () {
    if (backToTopBtn.length > 0 && ContentIsBigger() && !notOnTopOfPage()) {
        backToTopBtn.removeClass(backToTopToggleClass);
    } else {
        backToTopBtn.addClass(backToTopToggleClass);
    }
}

STFED.backToTop = function() {
    $('html, body').animate({scrollTop: 0}, 600);
};
});

(function ($) {
    $(function () {
       $('.st-button-toggler').on('click', function () {
           var $button = $(this);
           var variable = $button.data('variable');
           var customSearch = $button.data('custom-search');
           var isMobile = $button.data('is-mobile');
           var state = $button.attr('data-state') === 'true';

           $button.attr('data-state', !state);
           emitCustomEvent('toggled', {
               variable: variable,
               state: !state,
               customSearch: customSearch,
               isMobile: isMobile
           });
       });
    });
})(jQuery);

function compareView() {

	var compareTable = $(".js-st-compare-view-table");
	var compareCount = $(".js-st-compare-view-close").length;

	if(compareCount === 3){
		compareTable.find("tr ").append('<td class="st-compare-view__empty"></td>');
	}	
	if(compareCount === 2){
		compareTable.find("tr ").append('<td class="st-compare-view__empty"></td><td class="st-compare-view__empty"></td>');
		$(".js-st-compare-view-close").hide();
	}	

	$(".js-st-compare-view-close").click(function(event) {
		var compareItem = $( this );
		var compareColumn = compareItem.parent().index();

		compareTable.find("tr td:nth-child(" + (compareColumn + 1) + ")").hide();
		compareTable.find("tr ").append('<td class="st-compare-view__empty"></td>');

		compareCount--;
		if(compareCount < 3){
			$(".js-st-compare-view-close").hide();
		}

	});
}

compareView()
$(".js-st-toggle-star").on("click", function() {
    var icon=$(this).find("use");
    if($(this).data("show-results")==1 || $(this).data("show-results")!=="") {
        if (icon.attr("xlink:href") == "#icon-bookmark") {
            icon.attr("xlink:href", "#icon-bookmark-active");
        }
        else {
            icon.attr("xlink:href", "#icon-bookmark");
        }
    }
});

(function ($) {
    $(function () {
        var $components = $('.js-partners-search');

        $components.find('select').each(function () {
            var $select = $(this);
            var instance = $select.data('selectric');

            if (instance && instance.disableOnMobile === false && instance.nativeOnMobile === false) {
                $select.selectric('init');
            } else {
                if (instance) {
                    instance.destroy();
                }
                $select.selectric({
                    disableOnMobile: false,
                    nativeOnMobile: false
                });
            }
        });

        if ($components.length > 0) {
            var geoPartnerProducts = $.getJSON(
                window.geoPartnerProductsUrl || '/etc/staticjson/geo-partner-products.json'
            );

            $components.each(function () {
                var $component = $(this);
                var $breadcrumbs = $component.find('nav.st-breadcrumbs');
                var $noResults = $component.find('.st-nav-tabs-content__layer--no-results');
                var tabId = $component.data('content');

                if (tabId) {
                    $component.find('.js-partners-country-selector select').attr('data-tab-id', tabId);
                }

                $(this).on('partners-country-selected', function (event) {
                    var associationType = event.originalEvent.detail.type;
                    var associationName = event.originalEvent.detail.name;

                    geoPartnerProducts.then(function (data) {
                        $component.find('.js-st-nav-tabs__item--layer1').each(function () {
                            var $layer1 = $(this);
                            var hasVisibleLayers = false;
                            var layer2Id = this.dataset.tabsLayer2Id;

                            $component.find('div[data-tabs-layer2-id="' + layer2Id + '"] .js-st-nav-tabs__item--layer2')
                                .each(function () {
                                    var $layer2 = $(this);
                                    var $count = $layer2.find('.st-nav-tabs__count');
                                    var productId = this.dataset.productid;
                                    var association = data.find(function (item) {
                                        return !associationType || (item.associatedTo[productId] &&
                                            associationType === item.associationType &&
                                            (associationType === 'worldwide' || associationName === item.name));
                                    });

                                    if (!this.dataset.defaultCount) {
                                        this.dataset.defaultCount = parseInt($count.text().trim().substr(1));
                                    }

                                    if (association) {
                                        hasVisibleLayers = true;
                                        $layer2.show();
                                        $count.html('(' +
                                            (associationType ? association.associatedTo[productId] :
                                                this.dataset.defaultCount) + ')');
                                    } else {
                                        $layer2.hide();
                                    }
                                });

                            $layer1.toggle(hasVisibleLayers);
                        });
                    });

                    toggleNoResults();
                });

                // $('li:not(.js-st-nav-tabs__breadcrumb-layer3) > a', this).on('click', function () {
                //     $search.show();
                // });

                // $('a.js-st-nav-tabs__item--layer2', this).on('click', function () {
                //     $search.hide();
                // });

                function toggleNoResults() {
                    if (!$breadcrumbs.is(':visible')) {
                        $noResults.toggle($component.find('.js-st-nav-tabs__item--layer1:visible').length === 0);
                    }
                    if ($breadcrumbs.find('.js-st-nav-tabs__breadcrumb-layer3:visible').length > 0) {
                        return $noResults.hide();
                    }
                    if ($breadcrumbs.find('.js-st-nav-tabs__breadcrumb-layer2:visible').length > 0) {
                        $noResults.toggle($component.find('.js-st-nav-tabs__item--layer2:visible').length === 0);
                    }
                }
            });
        }

        $(document).on('change selectric-change', '.js-partners-country-selector select', function (event) {
            var $select = $(event.target);

            var option = $select[0].selectedOptions[0];

            window.emitCustomEvent('partners-country-selected', {
                type: option.dataset.type,
                name: option.textContent.trim(),
                tabId: $select.attr('data-tab-id'),
                prmisId: $select.attr('data-prmis-id')
            }, event.target);
        });
    });
})(jQuery);

function reloadTabs() {
	$('.js-st-nav-tabs--search .slick-track').attr("data-tab", '');
	$(document).foundation('tab', 'reflow');
}

function searchSidebar() {
	var windowWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
	if (windowWidth >= 1024) {
		if ($(".js-st-search-tab-content").children(".js-st-sidebar-search").length > 0) {
		}
		else {
			$(".js-st-sidebar-search").detach().prependTo('.js-st-search-tab-content');
			$(".js-st-micro").removeClass('js-st-sidebar-active');
		}
	}
	else {
		if ($(".js-st-main").children(".js-st-sidebar-search").length > 0) {
		}
		else {
			$(".js-st-sidebar-search").detach().prependTo('.js-st-main');
		}
	}
}

function searchSidebarContentHandler() {
	// searchSide.children('.st-sidebar--search__content').removeClass('st-sidebar--search__content-active');
	var searchTabContent = $('.js-st-search-tab-content'),
		setSearchSidebar = function(sid){
			var searchSide = $('.js-st-sidebar-search');
			searchSide.children('.st-sidebar--search__content-active').removeClass('st-sidebar--search__content-active');
			searchSide.children("[data-tab-id='" + sid + "']").addClass('st-sidebar--search__content-active');
			if(searchSide.children('.st-sidebar--search__content-active').length > 0){
				searchSide.addClass('st-sidebar--active');
				searchTabContent.addClass('st-search-tab-content__sidebar');
			}else{
				searchSide.removeClass('st-sidebar--active');
				searchTabContent.removeClass('st-search-tab-content__sidebar');
			}
		};
	if( searchTabContent.attr('data-tab-id') && searchTabContent.attr('data-tab-id').length > 0 ){
		setSearchSidebar( searchTabContent.attr('data-tab-id'));
	}

	$('.js-st-tabs-tab').click(function (e) {
		var ref = $(this).attr('href');
		if(ref != null && ref.indexOf('#') == 0){
			ref = ref.substring(1, ref.length);
			searchTabContent.attr('data-tab-id', ref);
			setSearchSidebar(ref);
		}
	});
}
$(document).on('click','.js-st-accordion-menu.st-sidebar__category-tree .st-sidebar__tree-item > a, .js-st-accordion-menu.st-sidebar__category-tree .st-sidebar__tree-item > span', function(){
    $(this).parents('.js-st-accordion-menu.st-sidebar__category-tree').first().find('.st-sidebar__tree-item').removeClass('js-st-active').removeClass('st-sidebar__tree-item-selected');
    $(this).parents('.st-sidebar__tree-item').addClass('st-sidebar__tree-item-selected').addClass('js-st-active');
});

$(document).ready(function () {
	if ($(".js-st-sidebar-search").length > 0) {
		searchSidebar();
		$(window).resize(searchSidebar);
	}
	$(window).resize(reloadTabs);
	$(document).ready(reloadTabs);
	$(document).ready(searchSidebarContentHandler);

	var resizeTimer;
	$(window).on('resize', function(){
		clearTimeout(resizeTimer);
  		resizeTimer = setTimeout(function() {
    		STFED.dotdotdotVideoItems.init();           
  		}, 250);
    });

    $('.js-st-nav-tabs--search .js-st-tabs-tab').on('click', function (e) {
        var tabName = $(this).attr('href');
        if (tabName == "#panel4") {
            setTimeout(function () {
				STFED.dotdotdotVideoItems.init();
			}, 10);
        }
    });
});

//establish name space for fed functions
var STFED = STFED || {};

//extend STFED with dotdotdotVideoItems function
STFED.dotdotdotVideoItems = {
    init: function(){
        if ($('.dotdotdot-append-text:visible').length) {
            //only apply dot dot dots to visible items
            $('.dotdotdot-append-text').each(function(e){
				var API = $(this).dotdotdot({
					keep: ".read-more",
					height: ($(window).width() > 1026 ? 70 : 50)
				}).data( "dotdotdot" );
				API.truncate();
			});
        }
	}
};

$(document).on("click", ".st-featured-video__wrapper .dotdotdot-append-text .read-more", function(e) {
	var API = $(this).parents('.dotdotdot-append-text').data( "dotdotdot" );
	e.preventDefault();
	API.restore();
});

(function($) {
	STFED.dotdotdotVideoItems.init();
})(jQuery);

$(".js-st-collapse").each(function(index, el) {
	var maxItems = $(this).data('collapse-items');
	var hideItems = maxItems -1;
	var textOpen = $(this).data('collapse-open');
	var textClose = $(this).data('collapse-close');

	var items = $(this).find("a").length;
    $(this).find(".st-collapse-list__item:last-child").addClass("st-collapse-list__item--last");

    if(maxItems<1) {
        hideItems = 0;
        $(this).find("a").eq(0).hide();
    }

    if (items > maxItems) {
        $(this).find("a:gt(" + hideItems + ")").hide();
        $(this).append('<a class="st-collapse-list__trigger js-st-collapse-item js-st-collapse-open">' + textOpen + '</a>');
    }
});

$(document).on('click', '.js-st-collapse-open', function(event) {
	var parent = $(this).parent();
	var maxItems = parent.data('collapse-items');
	var hideItems = maxItems -1;
	var textOpen = parent.data('collapse-open');
	var textClose = parent.data('collapse-close');
	var item = parent.find(".js-st-collapse-item");

	parent.find("a").show();
	item.text(textClose);
	item.removeClass('js-st-collapse-open');
	item.addClass('js-st-collapse-close');
});

$(document).on('click', '.js-st-collapse-close', function(event) {
	var parent = $(this).parent();
	var maxItems = parent.data('collapse-items');
	var hideItems = maxItems -1;
	var textOpen = parent.data('collapse-open');
	var textClose = parent.data('collapse-close');
	var item = parent.find(".js-st-collapse-item");
    if(maxItems<1) {
        hideItems = 0;
        parent.find("a").eq(0).hide();
    }
	parent.find("a:gt(" + hideItems + ")").hide();
	parent.find(".js-st-collapse-item").show();
	item.text(textOpen);
	item.removeClass('js-st-collapse-close');
	item.addClass('js-st-collapse-open');
});

(function ($) {
    var STFED = window.STFED || {};
    var isPhone = false;

    STFED.initCollapseToggler = function () {
        $('.js-collapse-toggler[data-collapse-target]:not(.is-initialized)').each(function () {
           var $toggler = $(this);
           var $otherTogglers = $toggler.parent().find('.js-collapse-toggler').not($toggler);
           var $target = $toggler.data('collapse-target');
           var toggleFn = function (state) {
               $toggler.add($target).toggleClass('is-revealed', !state);
           };
           var forSmall = $toggler.is('.for-small');

           if ($target.length) {
                $toggler.addClass('is-initialized');
                if ($otherTogglers.length) {
                    $toggler.data('toggle', toggleFn);
                    $toggler.append($('<div class="collapse-toggler-icon"><svg class="st-svg"><use xlink:href="#icon-arrow-up-filled"></use></svg></div>'));
                    $toggler.on('click', function (event) {
                        if (forSmall && !isPhone) {
                            return;
                        }

                        event.preventDefault();

                        var state = $toggler.is('.is-revealed');

                        toggleFn(state);

                        if (!state) {
                            var isiphone = $('body').hasClass('ios-iphone');

                            $otherTogglers.filter('.is-initialized').each(function () {
                                var $otherToggler = $(this);
                                var $otherTarget = $($otherToggler.data('collapse-target'));
                                var scrollTo;

                                if (isiphone && $otherToggler.is('.is-revealed')) {
                                    if (window.scrollY > $otherTarget.offset().top) {
                                        scrollTo = window.scrollY - $otherTarget.outerHeight(true);
                                    }
                                }

                                $otherToggler.data('toggle')(true);

                                if (scrollTo) {
                                    window.scrollTo(window.scrollX, scrollTo);
                                }
                            });
                        }
                    });
                } else {
                    $target.addClass('is-revealed');
                }
           }
        });
    };

    enquire.register(STFED.mediaQueries.smallMax, {
        match: function() {
            isPhone = true;
        },
        unmatch: function() {
            isPhone = false;
        }
    });

    $(function () {
       STFED.initCollapseToggler();
    });
})(jQuery);


function loadCards() {
    if ($('.st-application-catalog > .st-application-catalog-card').length < 5) {
        $('.st-application-catalog-card').addClass("st-application-catalog-card--small");
    }

    $('.st-application-catalog-card').each(function() {
    	if($(this).width() < 335 && $(this).find('.st-application-catalog-card__content-mobile--title').height() > 110) {
    		$('.st-application-catalog-card__content-mobile--title', this).addClass('st-application-catalog-card__content-mobile--title-small').dotdotdot();
		}
    });
}

$(document).ready(loadCards);

$(document).ready(function () {
    $(".st-main").on("click", ".st-nav-tabs-content__product-tools a, .js-st-quicklink", function (event) {
        var $link = $(this);
        var targetElem = $('[id="' + $link.attr('data-href') + '"]').first();
        var scrollTopOffset = targetElem.offset().top;

        if ($link.hasClass('js-direct-link')) {
            location.hash = '#' + $link[0].href.split('#')[1];
        }

        if ($('.dynamic-content').length) {
            scrollTopOffset -= parseInt(window.getComputedStyle($('.dynamic-content')[0]).marginTop);
        }

        var $navigationContext = $link.closest('.js-navigation-tabs-context');

        if ($navigationContext.length > 0) {
            var $navTabsWrapper = $('.st-nav-tabs-wrapper');
            var tabId = $navigationContext.data('tab-id');
            var isAssociatedTabSticky = $('.js-st-tabs-tab[data-tab="' + tabId + '"]').length > 0;

            if (isAssociatedTabSticky) {
                scrollTopOffset -= $navigationContext.outerHeight(true) + $navTabsWrapper.height();
            }
        }

        $('html, body').animate({
            scrollTop: scrollTopOffset
        }, 300);

        // if elem is an accordion open it
        var isAccordion = targetElem.parent().parent().hasClass('js-st-accordion-menu');
        var closed = !targetElem.parent().hasClass('js-st-accordion-expanded');
        if(isAccordion && closed) {
            targetElem.next().trigger('click');
        }

        if ($link.hasClass('js-prevent')) {
            event.preventDefault();
        }
    });
});

(function ($) {
    $(function () {
        function addQuickLinks(component, container, content) {
            var $component = $(component);
            var $content = $(content);
            var $container = $(container);

            var $links = $content.find('[data-quicklinks-title]');

            var $quickLinks = $links.map(function (i, link) {
                var $link = $(link);

                return $('<a>')
                    .text($link.text().split(/\([^\(]+$/)[0])
                    .attr('href', '#')
                    .attr('data-href', $link.attr('id'))
                    .addClass('st-link js-st-quicklink');
            }).toArray();

            $container.html('').append($quickLinks);

            if ($quickLinks.length > 0) {
                $component.show();
            } else {
                $component.hide();
            }
        }

        function init() {
                $('.js-quicklinks-widget').each(function () {
                    var $component = $(this);

                    var $context = $component.closest('.js-navigation-tabs-context, .js-st-tab-content');
                    var $content = $('[data-page-content="' + $context.data('content') + '"], [data-page-content="' + $context.data('tab-id') + '"]');
                    var $container = $component.find('.links');

                    if ($content.length > 0) {
                        addQuickLinks(this, $container, $content);
                    }
                });

        }

        window.initQuickLinksFromSSIComponent = init;

        init();

        $(document).on('become-visible context-was-switched', function () {
            init();
        });
    });
})(jQuery);

if( parseInt(window.innerWidth) < 640){
	$(".js-st-breadcrumb").animate({scrollLeft:'+=15000'},1);
}

$(document).on("click",".js-st-show-more-list-cta", function (e){
	e.preventDefault();
	var list = $(this).parent().parent().find('.js-st-show-more-list');
	var items = list.find('li');

	if(items.hasClass('hidden')) {
		items.removeClass('hidden');
		$(this).hide();
        if($(this).data('show-less-text')){
            $(this).text($(this).data('show-less-text'));
            $(this).show();
        }
	}else if($(this).data('show-less-text')== $(this).text()){
        showMoreHideItems();
        $(this).text($(this).data('show-more-text'));
    }
    if($(this).hasClass('js-st-quickview-adjust-height')) {
        setQuickviewHeight($(this).parents('.js-st-row-quickview'));
    }
	
});
function showMoreHideItems() {
    $(".js-st-show-more-list").each(function (index, el) {
        var container = $(this);
        if(!container.is('ul')){
            container = container.find('ul');
        }
        var items = container.children('li').length;
        var maxItems = $(this).data('show-more-items');
        if (items > maxItems) {
            container.children('li:gt(' + (maxItems - 1) + ')').addClass('hidden');
        }
    });
}
showMoreHideItems();

$(document).ready(function(){
    $('.js-st-qrcode-link').each(function () {
        var qrLink = $(this).attr('href');
        var qrIdentity = $(this).attr('data-qr');
        $('.js-st-qrcode[data-qr="' + qrIdentity + '"]').qrcode(qrLink);
    });
});

$(document).on("click", ".js-st-show-more-text-cta", function (e) {
    e.preventDefault();
    $(this).closest('.js-st-quickview-text-hidden').find('.hidden').removeClass('hidden');
    $(this).hide();
    if($(this).hasClass('js-st-quickview-adjust-height')) {
        setQuickviewHeight($(this).parents('.js-st-row-quickview'));
    }
});


var STFED = STFED || {};
var dotdotdot_components_initialized_fns = [];
//extend namespace for dotdotdot method
STFED.dotdotdot = {
    init: function (context) {
        context = context || document;

        for (var i = 0; i < dotdotdot_components_initialized_fns.length; i++) {
            $(window).unbind("scroll click touchstart", dotdotdot_components_initialized_fns[i]);
        }

        $(".js-st-dotdotdot:not([data-dotdotdot_components_initialized])", context).each(function (index) {
            var this_dot = this,
                maxLines = $(this_dot).data('max-lines');

            (function () {
                var fn;
                var cb = function () {
                    $(window).bind("scroll click touchstart", fn);
                };

                fn = dotdotdot_components_initialized_fns[index] = _.debounce(function () {
                    if (!$(this_dot).attr("data-dotdotdot_components_initialized") && $(this_dot).isInViewport()) {
                        $(this_dot).attr("data-dotdotdot_components_initialized", index);
                        $(this_dot).data('dot', $(this_dot).dotdotdot({
                            truncate: "word",
                            height: maxLines ? getMaxHeight(this_dot, maxLines) : "watch",
                            watch: true
                        }));
                        $(window).unbind("scroll click touchstart", fn);
                    } else {
                        cb();
                    }
                }, 100, {
                    leading: true,
                    trailing: false
                });
                fn();
            })();
        });

        function getMaxHeight(this_dot, maxLines) {
            var itemLineHeight = parseInt(window.getComputedStyle(this_dot).lineHeight);
            var maxHeight = itemLineHeight * maxLines;

            return maxHeight;
        }
    }
};

jQuery(document).ready(function ($) {
    STFED.dotdotdot.init();
});

// show loading spinner as soon as the login form is valid and the user clicks the submit btn
$(document).ready(function() {
    $('#st-login-form').on('valid.fndtn.abide', function () {
        $('.js-loading-spinner--full-page').removeClass('st-loading-spinner--hide');
        bodyScrollLock.disableBodyScroll();
    });
});

(function ($) {
    $(function () {
        $('.js-nav-search-bar-input').each(function () {
            var hasSelectorValues = false;
            var initialValues = STFED.parseSelectorsUrl();
            var initialValuesLength = Object.keys(initialValues).length;
            var level = 0;
            var resourceType = '';
            var resourceCategory = '';
            var filterFileType = '';
            var filterUpdate = '';
            var searchQuery = '';
            var visible = true;
            var hidden = false;
            var contextData = {
                showSuppliedByST: false
            };

            var $searchInput = $(this);
            var $bar = $searchInput.closest('.st-nav-search-bar');
            var $container = $searchInput.closest('.js-navigation-tabs-context, .js-st-tab-content');
            var $searchSelectFileType = $('.js-nav-search-bar-select-file-type select', $container);
            var $searchSelectLatestUpdate = $('.js-nav-search-bar-select-latest-update select', $container);
            var $suggestionsDropdown = $searchInput.siblings('.st-nav-search-bar-suggestions');
            var tabId = $container.data('content') || $container.data('tab-id');
            var $tabContent = $('[data-page-content="' + tabId + '"]');
            var $mobileComponent = $bar.find('.st-nav-search-bar-mobile');
            var $partnersCountrySelectors = $container.find('.js-partners-country-selector select');
            var $desktopPartnerCountrySelector = $partnersCountrySelectors.first();
            var $desktopPartnerCountryItem = $desktopPartnerCountrySelector.closest('.st-nav-search-bar-item');
            var navTabContentId = $tabContent.data('nav-tab-content-id');
            var customSearch = $bar.data('custom-search');
            var solrEndpoint = $bar.data('solr-endpoint');
            var prmisId = $bar.data('prmis-id');
            var isActive = STUtils.isActiveTabLink(tabId);
            var isMobile = false;

            var $togglers = $bar.add($mobileComponent).find('.st-button-toggler');
            var togglersAndDefaults = $togglers.map(function () {
                var $toggler = $(this);
                var defaultValue = $toggler.data('default-value') || $toggler.data('state');
                return {$toggler: $toggler, defaultValue: defaultValue};
            });

            $partnersCountrySelectors.attr({
                'data-tab-id': tabId,
                'data-prmis-id': prmisId
            });

            if (typeof navTabContentId != 'undefined') {
                navTabContentId = navTabContentId.slice(1);
            } else {
                navTabContentId = '';
            }

            if (isActive && initialValuesLength) {
                if (typeof initialValues.title !== 'undefined') {
                    hasSelectorValues = true;
                    $searchInput.val(initialValues.title);
                    searchQuery = initialValues.title;
                }

                if (typeof initialValues.fileType !== 'undefined') {
                    hasSelectorValues = true;
                    $searchSelectFileType.val(initialValues.fileType);
                    $searchSelectFileType.selectric('init');
                    filterFileType = initialValues.fileType;
                }

                if (typeof initialValues.latestUpdate !== 'undefined') {
                    hasSelectorValues = true;
                    $searchSelectLatestUpdate.val(initialValues.latestUpdate);
                    $searchSelectLatestUpdate.selectric('init');
                    filterUpdate = initialValues.latestUpdate;
                }

                if (typeof initialValues.resourceCategory !== 'undefined') {
                    hasSelectorValues = true;
                    var $resourceHierarchy = $('.st-resources-hierarchy');
                    var selector = '.js-simple-accordion-toggler[data-hierarchy-category="' + initialValues.resourceCategory + '"]';
                    var $link;

                    if (($link = $('[data-level="0"] ' + selector, $resourceHierarchy)).length > 0) {
                        level = 1;
                    } else if (($link = $('[data-level="1"] ' + selector, $resourceHierarchy)).length > 0) {
                        level = 2;
                    }

                    if ($link.length > 0) {
                        resourceCategory = $link.data('resourcecategory');
                        resourceType = $link.data('resourcetype');
                    }
                }

                if (typeof initialValues.resourceType !== 'undefined') {
                    resourceType = initialValues.resourceType;
                }
            }

            if (hasSelectorValues) {
                updateBarClasses();

                emitCustomEvent('make-search', {
                    hierarchyLevel: level,
                    resourceType: resourceType,
                    resourceCategory: resourceCategory,
                    searchQuery: searchQuery,
                    searchFilterFiletype: filterFileType,
                    searchFilterUpdate: filterUpdate,
                    solrEndpoint: solrEndpoint,
                    prmisId: prmisId,
                    navTabContentId: navTabContentId
                });
            }

            function toggleAutosuggestion(state) {
                emitCustomEvent(state ? 'layer-opened' : 'layer-closed');

                $suggestionsDropdown.toggleClass('open', state);
            }

            function getSuggestions(q) {
                return $.getJSON(solrEndpoint, { 'autosuggestion': 1, 'q': q, 'lang': document.documentElement.lang || 'en', 'prmisId': prmisId, 'navTabContentId' : navTabContentId }).then(function (json) {
                    return _.get(json, 'response.docs', []);
                });
            }

            function requestSearch(q) {
                searchQuery = q;

                emitCustomEvent('make-search', {
                    customSearch: customSearch,
                    searchQuery: searchQuery,
                    searchFilterFiletype: filterFileType,
                    searchFilterUpdate: filterUpdate,
                    prmisId: prmisId,
                    solrEndpoint: solrEndpoint,
                    navTabContentId: navTabContentId
                });
            }

            function renderSuggestions(items) {
                $suggestionsDropdown.html('');

                var $items = items.slice(0, 10).map(function (doc) {
                    return $('<p class="st-copy"><a href="' + _.get(doc, 'link.0', '#') + '" target="_blank">' + doc.title_man + '</a></p>');
                });

                $suggestionsDropdown.append($('<h5 class="st-h5 st-margin--all-b-2 st-font--natural-case">Keywords</h5>'));
                $suggestionsDropdown.append($items);

                return $items;
            }

            var autoSuggest = _.debounce(function (q) {
                getSuggestions(q)
                    .then(renderSuggestions)
                    .then(function (items) {
                        return toggleAutosuggestion(items.length > 0);
                    });
            }, 250);

            $suggestionsDropdown.on('click', 'a[data-q]', function (event) {
                var q = $(this).data('q');

                event.preventDefault();

                $searchInput.val($(this).data('q'));
                toggleAutosuggestion(false);
                requestSearch(q);
            });

            $searchInput.on('focus input', function (event) {
                if (customSearch) {
                  return;
                }

                var value = event.target.value.trim().replace(/^\s+|\s+$/, '');

                if (value.length >= 3) {
                    //Autosugesstion feature disabled based on STM-18664
                    /* autoSuggest(value) */
                } else {
                    toggleAutosuggestion(false);
                }
            });

            $searchInput.on('keyup', function (event) {
                if (event.key === 'Escape') {
                    toggleAutosuggestion(false);
                }

                if (event.key === 'Enter') {
                    requestSearch(event.target.value);
                    toggleAutosuggestion(false);
                }

                emitCustomEvent('set-search-query', {
                    searchQuery: event.target.value
                });
            });

            $(document).on('click', function (event) {
                var $target = $(event.target);

                if (!$target.is($searchInput) &&
                    !$target.is($suggestionsDropdown) &&
                    $searchInput.has($target).length === 0 &&
                    $suggestionsDropdown.has($target).length === 0) {
                    toggleAutosuggestion(false);
                }
            });

            $(document).on('hierarchy-category-select', function (event) {
                if (isActive) {
                    var category = event.originalEvent.detail.hierarchyCategoryTitle;

                    if (event.originalEvent.detail.hierarchyLevel) {
                        level = event.originalEvent.detail.hierarchyLevel;
                        $bar.attr('data-hierarchy-level', event.originalEvent.detail.hierarchyLevel);
                    } else {
                        level = 0;
                        $bar.removeAttr('data-hierarchy-level');
                    }

                    $searchInput.attr('placeholder', category ? 'Search ' + category.trim() : $searchInput.data('default-placeholder'));

                    $mobileComponent.attr('data-hierarchy-level', event.originalEvent.detail.hierarchyLevel);

                    updateBarClasses();
                }
            });

            $(document).on('tab-submenu-become-visible context-was-switched', function (event) {
               var detail = event.originalEvent.detail;

               isActive = typeof detail.tabId !== 'undefined' && tabId === detail.tabId;
            });

            $container.on('click', '.st-nav-search-bar-reset-button', function (event) {
                event.preventDefault();

                $searchInput.val('');

                contextData.showSuppliedByST = false;
                searchQuery = '';
                filterFileType = '';
                filterUpdate = '';

                Object.keys(contextData).forEach(function (key) {
                    $bar.removeAttr('data-' + _.kebabCase(key));
                });

                updatePartnersCountrySelector(true);

                $searchSelectFileType.val('');
                $searchSelectFileType.selectric('init');
                emitCustomEvent('set-search-filter', {
                    filter: 'searchFilterFiletype',
                    value: ''
                });

                $searchSelectLatestUpdate.val('');
                $searchSelectLatestUpdate.selectric('init');
                emitCustomEvent('set-search-filter', {
                    filter: 'searchFilterUpdate',
                    value: ''
                });

                emitCustomEvent('make-search-reset');

                togglersAndDefaults.each(function () {
                    this.$toggler.attr('data-state', this.defaultValue);
                });

                updateBarClasses();
            });

            $container.on('click', '.st-nav-search-bar-browse-all-button', function () {
                emitCustomEvent('toggle-mobile-resources-hierarchy', {},
                    $container.find('.st-resources-hierarchy')[0]);
            });

            $container.on('click', '.st-nav-search-bar-icon-search', function () {
                requestSearch($searchInput.val());
                toggleAutosuggestion(false);
            });

            $searchSelectFileType.on('change', function(event) {
                filterFileType = $(this).val();

                emitCustomEvent('set-search-filter', {
                    filter: 'searchFilterFiletype',
                    value: filterFileType,
                    customSearch: customSearch,
                    isMobile: $mobileComponent.has(this).length > 0
                });

                syncSelectricSelects($searchSelectFileType, this, filterFileType);
            });

            $searchSelectLatestUpdate.on('change', function(event) {
                filterUpdate = $(this).val();

                emitCustomEvent('set-search-filter', {
                    filter: 'searchFilterUpdate',
                    value: filterUpdate,
                    customSearch: customSearch,
                    isMobile: $mobileComponent.has(this).length > 0
                });

                syncSelectricSelects($searchSelectLatestUpdate, this, filterUpdate);
            });

            $bar.on('click', '.st-nav-search-bar-filters-button', function (event) {
                event.preventDefault();
                event.stopPropagation();

                var hierarchy = $bar.attr('data-hierarchy-level');
                
                if (hierarchy && hierarchy >= 1) {
                    window.emitCustomEvent('show-side-bar-filters');
                } else {
                    openMobileFilters();
                }
            });

            $mobileComponent.on('click', '.js-close, .st-link', function () {
                hideMobileFilters();
            });

            $(document).on('scrolled-to-section', function () {
                hideMobileFilters();
            });

            $(document).on('toggled', function (event) {
                contextData[event.originalEvent.detail.variable] = event.originalEvent.detail.state;
                $bar.add($tabContent).add($mobileComponent)
                    .find('.st-button-toggler[data-variable="' + event.originalEvent.detail.variable + '"]')
                    .attr('data-state', event.originalEvent.detail.state);
                if (event.originalEvent.detail.state) {
                    $bar.add($mobileComponent).attr('data-' + _.kebabCase(event.originalEvent.detail.variable), true);
                } else {
                    $bar.add($mobileComponent).removeAttr('data-' + _.kebabCase(event.originalEvent.detail.variable));
                }
                updatePartnersCountrySelector();
            });

            $container.add($mobileComponent).on('partners-country-selected', function (event) {
                syncSelectricSelects($partnersCountrySelectors, event.target, event.target.value);
            });

            function updateBarClasses() {
                if($tabContent.find('.stsel-selector-ctn').toArray().length > 0) {
                    updateToolsBarClasses();
                    return;
                }

                $bar.toggleClass('has-selectors', !!$tabContent.find('.resource_selector_container').toArray().find(function (element) {
                    var $selectorsContainer = $(element);
                    var $renderContainer = $selectorsContainer.closest('.render-in-level');

                    return $renderContainer.length === 0 || $renderContainer.is('[data-level' + level + ']');
                }));
            }

            function updateToolsBarClasses(){
                $bar.toggleClass('has-selectors', !!$tabContent.find('.stsel-selector-ctn').toArray().find(function (element) {
                    var $selectorsContainer = $(element);
                    var $renderContainer = $selectorsContainer.closest('.render-in-level');
                    
                    return $renderContainer.length === 0 || $renderContainer.is('[data-level' + level + ']');
                }));
            }

            function openMobileFilters() {
                if (typeof window.emitCustomEvent !== 'undefined') {
                    window.emitCustomEvent('body-locked', {
                        savePosition: true
                    });
                }
                $mobileComponent.toggleClass('hidden', false);
            }

            function syncSelectricSelects($selects, current, selectedVal) {
                reinitSelectricSelects($selects.not(current), selectedVal);
            }

            function reinitSelectricSelects($selects, selectedVal) {
                $selects.closest('.st-select').removeClass('st-select--filled');
                $selects
                    .selectric('destroy')
                    .val(selectedVal)
                    .selectric('init');
            }

            function updatePartnersCountrySelector(reset) {
                var state = contextData.showSuppliedByST;

                if (state || reset) {
                    reinitSelectricSelects($partnersCountrySelectors, '');

                    window.emitCustomEvent('partners-country-selected', {
                        type: '',
                        tabId: tabId
                    }, $partnersCountrySelectors[0]);
                }
                
                $partnersCountrySelectors.each(function () {
                    var $item = $(this).closest('.st-nav-search-bar-item, .item');

                    if (state) {
                        // third-party JS might put explicit display style
                        STUtils.jQuery.resetInlineDisplay($item);
                        $item.addClass('hide');
                    } else if (level != 2) {
                        STUtils.jQuery.resetInlineDisplay($item);
                        $item.removeClass('hide');
                    }
                });
            }

            function onSelectricToggle(state) {
                $('.st-nav-tabs').toggleClass('has-dropdown-open', state === true);
            }

            function setResultsCountVisibility(isVisible) {
                var tabIdSelector = '[data-content='+tabId+']'
                $(tabIdSelector + ' .st-nav-tabs__count').each(function () {
                    if (isVisible) {
                        $(this).show()
                    } else {
                        $(this).hide()
                    }

                })
            }

            function controllItemsCountVisibility() {
                $(document).on('make-search', function() {
                    setResultsCountVisibility(hidden)
                })

                $(document).on('make-search-reset', function() {
                    setResultsCountVisibility(visible)
                })
            }

            function hideMobileFilters() {
                if (isMobile && typeof window.emitCustomEvent !== 'undefined') {
                    window.emitCustomEvent('body-unlocked', {
                        restorePosition: true
                    });
                }

                $mobileComponent.toggleClass('hidden', true);
            }

            $searchSelectFileType.add($searchSelectLatestUpdate).add($desktopPartnerCountrySelector)
                .on('selectric-open', onSelectricToggle.bind(this, true))
                .on('selectric-close', onSelectricToggle);

            $searchSelectFileType.selectric('init');
            $searchSelectLatestUpdate.selectric('init');

            controllItemsCountVisibility()

            $bar.data('mobile-filters', $mobileComponent);
            $('body').append($mobileComponent);

            enquire.register(STFED.mediaQueries.smallMax, {
                match: function () {
                    isMobile = true;

                    // adds both selectors to selection
                    var $selects = $()
                        .add($searchSelectFileType)
                        .add($searchSelectLatestUpdate);

                    $selects.selectric('destroy');
                    $selects.selectric('init');
                },
                unmatch: function () {
                    isMobile = false;
                }
            });
        });
    });
})(jQuery);

$(function () {
    var $container = $('.js-resources-popular');
    var $fileTypeFilter = $container.find('select[name="filter-fileType"]');
    var $latestUpdateFilter = $container.find('select[name="filter-latestUpdate"]');
    var $sorter = $container.find('select[name="sorter"]');
    var $table = $container.find('.st-table--resources table:first');
    var $page = $(this).closest('[data-page-content]');
    var isVisible = $page.is(':visible');

    $fileTypeFilter.on('selectric-select', function (event) {
        $table.DataTable().columns(0).search(event.target.value).draw();
    });
    $latestUpdateFilter.on('selectric-select', function (event) {
        $table.DataTable().columns(3).search(event.target.value).draw();
    });
    $sorter.on('selectric-select', function (event) {
        $table.DataTable()
            .order([+event.target.value, 'asc'])
            .draw();
    });

    $(window).on('resize', _.debounce(function () {
        updateTableWidth();
    }, 250));

    function updateTableWidth() {
        if (isVisible && $table.length > 0) {
            $table.attr('style', '');
            STFED.runOnDataTableInit($table, function () {
                STFED.keepPageLength($table,
                    $table.DataTable().columns.adjust()).draw();
            });
        }
    }

    $(document).on('sidebar-was-opened sidebar-was-closed', function () {
        updateTableWidth();
    });

    function init() {
        STFED.bindPageLengthUpdateOnDataTable($table);

        if(!$.fn.DataTable.isDataTable($table)) {
            $table.dataTable(STFED.addMaxVisibleItemsBehaviour($table, {
                "paging": false,
                "ordering": true,
                "info": false,
                "searching": true,
                "order": [[0, "asc"]]
            }));
        }
    }

    if(!$table.closest("[data-page-content]").length){
        init();
    }

    $(document).on('search-reset', function () {
        updateTableWidth();
    });

    $(document).on('hierarchy-category-select', function () {
        var query = $('html').attr('data-search-query');
        var level = +($('html').attr('data-hierarchy-level') || '');

        if (level === 0 && !query) {
            setTimeout(function () {
                updateTableWidth();
            }, 0);
        }
    });

    enquire.register(STFED.mediaQueries.largeMin, {
        match: function() {
	        if(!$table.closest("[data-page-content]").length){
				STFED.keepPageLength($table, $table.DataTable()
					.order($table.data('previous-order') || []))
					.draw();
			}
        },
        unmatch: function() {
	        if(!$table.closest("[data-page-content]").length){
				$table.data('previous-order', $table.DataTable().order());
				$sorter.val(3);
			}
        }
    });
});

(function ($) {

    var renderHierarchy_i18n = {};
    renderHierarchy_i18n.expandAll = $("[data-i18n-expand-all]").attr("data-i18n-expand-all") || "Expand all";
    renderHierarchy_i18n.minify = $("[data-i18n-minify]").attr("data-i18n-minify") || "Minify";

    var renderHierarchy = _.template(
        '<% _.forEach(items, function(item, key) { %>' +
        '<% if (key === 0) { %>' +
        '<div class="st-flex st-flex-items--all-center item<% if (selected === key) { %> is-current<% } %>">' +
        '<span class="item-label"><%= item %></span>' +
        '<a class="st-link expand<% if (isExpanded) { %> is-expanded<% } %>" href="#" data-expand-text="' + renderHierarchy_i18n.expandAll + '" data-collapse-text="' + renderHierarchy_i18n.minify + '"><% if (isExpanded) { %>' + renderHierarchy_i18n.minify + '<% } else { %>' + renderHierarchy_i18n.expandAll + '<% } %></a>' +
        '</div>' +
        '<% } else { %>' +
        '<div class="st-flex item<% if (selected === key) { %> is-current<% } %>">' +
        '<span class="separator">' +
        '<svg>' +
        '<use xlink:href="#icon-arrow-right-filled"></use>' +
        '</svg>' +
        '</span>' +
        '<span class="item-label"><%= item %></span>' +
        '</div>' +
        '<% } %>' +
        '<% }) %>'
    );

    function initializeResourceHierarchy () {
        $('.st-resources-hierarchy').each(function () {
            var $component = $(this);
            var $container = $component.closest('.js-navigation-tabs-context, .js-st-tab-content');
            var $mobileComponent = $component.find('.st-resources-hierarchy-mobile');
            var $hierarchy = $component.find('.hierarchy');
            var tabId = $container.data('content') || $container.data('tab-id');
            var $tabContent = $('[data-page-content="' + tabId + '"]');
            var navTabContentId = $tabContent.data('nav-tab-content-id');
            var hierarchy = [$component.data('main-item') || 'All resource types'];
            var selected = 0;
            var isExpanded = true;
            var selectedCategory;
            var prmisId = $component.data('prmis-id');
            var isActive = STUtils.isActiveTabLink(tabId);


            if (typeof navTabContentId != 'undefined') {
                navTabContentId = navTabContentId.slice(1);
            } else {
                navTabContentId = '';
            }

            $component.on('click', '.expand', function (event) {
                event.preventDefault();

                isExpanded = !isExpanded;

                toggleExpander(isExpanded);

                $component.find('[data-level="0"] .js-simple-accordion-toggler').each(function () {
                    var toggleFunction = $(this).data('toggleAccordion');

                    if (toggleFunction) {
                        toggleFunction(isExpanded);
                    }
                });
            });

            $hierarchy.on('click', '.item:first .item-label', function (event) {
                goToRoot();
            });

            $hierarchy.on('click', '.item:eq(1) .item-label', function (event) {
                event.preventDefault();
                var $resource = $('[data-level="1"]:visible .resource', $component)
                    .removeClass('is-active hidden');
                var $link;

                if ($resource.length === 0) {
                    $link = $component.find('[data-level="0"] .st-simple-accordion-toggler[data-hierarchy-category="' + selectedCategory + '"]');
                } else {
                    $link = $component.find('[data-level="0"] .st-simple-accordion-toggler[data-hierarchy-category="' + $resource.closest('[data-level]').data('level-hierarchy-category') + '"]');
                }

                $link.click();
            });

            $hierarchy.on('click', '.item:eq(2) .item-label', function (event) {
                event.preventDefault();

                if (hierarchy.length === 4) {
                    var $link = $component.find('[data-level="1"] .js-simple-accordion:has(.st-link[data-hierarchy-category="' + selectedCategory + '"]) .js-simple-accordion-toggler');

                    $link.click();
                }

            });

            $component.add($mobileComponent).on('click', '[data-level="0"] .js-simple-accordion-toggler, .st-simple-accordion-content > .st-link[data-hierarchy-level="1"].toggler', function (event) {
                event.preventDefault();

                var $toggler;

                if ($(this).is('.st-link')) {
                    $toggler = $component.find('[data-level="0"] .js-simple-accordion-toggler[data-hierarchy-category="' + $(this).data('hierarchy-category') + '"]').first();
                } else {
                    $toggler = $(this);
                }

                var category = $toggler.data('hierarchy-category');
                var $resourceContainer = $toggler.closest('.resource');
                var toggleFunction = $toggler.data('toggleAccordion');

                if (toggleFunction) {
                    if ($(event.target).is('.svg-wrap')) {
                        toggleFunction(!$resourceContainer.hasClass('is-expanded'));
                        return;
                    }
                }

                var $level = $('[data-level-hierarchy-category="' + category + '"]', $component);

                $level
                    .show()
                    .siblings('[data-level]')
                    .hide();

                $level
                    .find('.resource')
                    .removeClass('is-active hidden');

                hierarchy.splice(1, hierarchy.length - 1, $toggler.text());
                selected = 1;
                selectedCategory = category;
                updateHierarchy();
                emitCategorySelect($toggler.text(), category, 1, getSelectorsContext($toggler));
            });

            $component.add($mobileComponent).on('click', '[data-level="0"] .st-simple-accordion-content .st-link, .st-simple-accordion-content > .st-link[data-hierarchy-level="2"]', function (event) {
                event.preventDefault();

                var $link = $(this);

                if ($link.closest($mobileComponent).length > 0) {
                    $link = $component.find('[data-level="0"] .st-simple-accordion-content .st-link[data-hierarchy-category="' + $(this).data('hierarchy-category') + '"][data-resourcetype="' + $(this).data('resourcetype') + '"]').first();
                }

                var $toggler = $link.closest('.resource').find('.js-simple-accordion-toggler');
                var category = $link.data('hierarchy-category');
                var $resource = $('[data-level="1"] .resource:has(a[data-hierarchy-category="' + category + '"])', $component);
                var $level = $resource.closest('[data-level]');

                $level
                    .show()
                    .siblings('[data-level]')
                    .hide();

                if ($level.is('.single-level')) {
                    $resource
                        .removeClass('hidden is-active');
                } else {
                    $resource
                        .removeClass('hidden')
                        .addClass('is-active')
                        .siblings() // next calls set class "hidden" on other resources excepting current
                        .removeClass('is-active')
                        .addClass('hidden');
                }

                hierarchy.splice(1, hierarchy.length - 1, $toggler.text(), $link.find('.st-nav-tabs__text').text());
                selected = 2;
                selectedCategory = category;
                updateHierarchy();
                emitCategorySelect($link.find('.st-nav-tabs__text').text(), category, 2, getSelectorsContext($link));
            });

            $component.add($mobileComponent).on('click', '[data-level="1"] .st-simple-accordion-content .st-link, .st-simple-accordion-content > .st-link[data-hierarchy-level="3"]', function (event) {
                event.preventDefault();

                var $link = $(this);

                if ($link.closest($mobileComponent).length > 0) {
                    $link = $component.find('[data-level="1"] .st-simple-accordion-content .st-link[data-hierarchy-category="' + $(this).data('hierarchy-category') + '"]').first();
                }

                var $toggler = $link.closest('.st-simple-accordion-content').prev('.js-simple-accordion-toggler');
                var title = $link.find('.st-nav-tabs__text').text();
                var category = $link.data('hierarchy-category');
                var $resourceContainer = $toggler.closest('.resource');
                var toggleFunction = $toggler.data('toggleAccordion');

                if (toggleFunction) {
                    if ($(event.target).is('.svg-wrap')) {
                        toggleFunction(!$resourceContainer.hasClass('is-expanded'));
                        return;
                    }
                }

                var $level = $resourceContainer.closest('[data-level]');

                $level
                    .show()
                    .siblings('[data-level]')
                    .hide();

                $resourceContainer
                    .removeClass('hidden')
                    .addClass('is-active')
                    .siblings() // next calls set class "hidden" on other resources excepting current
                    .removeClass('is-active')
                    .addClass('hidden');

                hierarchy.splice(1, hierarchy.length - 1, $level.data('hierarchy-title'), $toggler.text(), title);
                selected = 3;
                selectedCategory = category;
                updateHierarchy();
                emitCategorySelect(title, category, 3, getSelectorsContext($(this)));
            });

            $component.add($mobileComponent).on('click', '[data-level="1"] .js-simple-accordion-toggler, .st-simple-accordion-content > .st-link[data-hierarchy-level="2"].toggler', function (event) {
                event.preventDefault();

                var $toggler;

                if ($(this).is('.st-link')) {
                    $toggler = $component.find('[data-level="1"] .js-simple-accordion-toggler[data-hierarchy-category="' + $(this).data('hierarchy-category') + '"]').first();
                } else {
                    $toggler = $(this);
                }

                var category = $toggler.data('hierarchy-category');
                var $resourceContainer = $toggler.closest('.resource');
                var toggleFunction = $toggler.data('toggleAccordion');

                if (toggleFunction) {
                    if ($(event.target).is('.svg-wrap')) {
                        toggleFunction(!$resourceContainer.hasClass('is-expanded'));
                        return;
                    }
                }

                var $level = $resourceContainer.closest('[data-level]');

                $level
                    .show()
                    .siblings('[data-level]')
                    .hide();

                $resourceContainer
                    .removeClass('hidden')
                    .addClass('is-active')
                    .siblings() // next calls set class "hidden" on other resources excepting current
                    .removeClass('is-active')
                    .addClass('hidden');

                hierarchy.splice(1, hierarchy.length - 1, $level.data('hierarchy-title'), $toggler.text());
                selected = 2;
                selectedCategory = category;
                updateHierarchy();
                emitCategorySelect($toggler.text(), category, 2, getSelectorsContext($toggler));
            });

            $component.on('click', '[data-level="1"].single-level .resource:not(.js-simple-accordion) .st-link', function (event) {
                event.preventDefault();
                var $link = $(this);
                var text = $link.find('.st-nav-tabs__text').text();
                var category = $link.data('hierarchy-category');

                hierarchy.splice(2, hierarchy.length - 2, text);
                selected = 2;
                selectedCategory = category;
                updateHierarchy();
                emitCategorySelect(text, category, 2, getSelectorsContext($link));
            });

            $component.on('toggle-mobile-resources-hierarchy', function () {
                emitCustomEvent('body-locked', {
                    savePosition: true
                });

                setHeightContentMobileHierarchy($mobileComponent)

                $mobileComponent.toggleClass('hidden', false);

            });

            $mobileComponent.on('click', '.st-nav-search-bar-all-hierarchy', function () {
                emitCustomEvent('body-unlocked', {
                    restorePosition: true
                });

                $mobileComponent.toggleClass('hidden', true);
                goToRoot();
            });

            $mobileComponent.on('click', '.js-close, .st-link', function () {
                emitCustomEvent('body-unlocked', {
                    restorePosition: true
                });

                $mobileComponent.toggleClass('hidden', true);
            });

            $(document).on('tab-submenu-become-visible context-was-switched', function (event) {
                var detail = event.originalEvent.detail;

                isActive = typeof detail.tabId !== 'undefined' && tabId === detail.tabId;

                if(tabId === detail.tabId)
                    activateMainResourceSelector();
            });

            function setHeightContentMobileHierarchy() {
                $wrapper = $mobileComponent.find('.wrapper')
                $header = $mobileComponent.find('.header')
                $content = $mobileComponent.find('.content')

                $content.height(screen.availHeight - $header.outerHeight() - parseInt($wrapper.css('padding-top')))

                $(window).resize(_.debounce(setHeightContentMobileHierarchy, 100))
            }

            function goToRoot() {
                event.preventDefault();
                $('[data-level="0"]', $component)
                    .show()
                    .siblings('[data-level]')
                    .hide();
                $('[data-level="1"] .resource', $component)
                    .removeClass('is-active hidden');
                hierarchy.splice(1);
                selected = 0;
                selectedCategory = '';
                updateHierarchy();
                activateMainResourceSelector();
            }

            function toggleExpander(state) {
                var $expander = $hierarchy.find('.expand');

                $expander.toggleClass('is-expanded', state);

                if (state) {
                    $expander.html($expander.data('collapse-text'));
                } else {
                    $expander.html($expander.data('expand-text'));
                }
            }

            function updateHierarchy() {
                $hierarchy.html(renderHierarchy({
                    'items': hierarchy,
                    'selected': selected,
                    'isExpanded': isExpanded
                }));
            }

            function emitCategorySelect(title, value, level, contextData) {
                var eventDetail = {
                    hierarchyLevel: typeof level !== 'undefined' ? +level : 0
                };

                if (typeof contextData != 'undefined') {
                    eventDetail.resourceType = contextData.resourceType;
                    eventDetail.resourceCategory = contextData.resourceCategory;
                    if (typeof contextData.productId != 'undefined') {
                        eventDetail.productId = contextData.productId;
                    }
                    if (typeof contextData.associatedTo != 'undefined') {
                        eventDetail.associatedTo = contextData.associatedTo;
                    }
                }

                if (typeof value !== 'undefined' && value) {
                    eventDetail.hierarchyCategoryTitle = title;
                    eventDetail.hierarchyCategoryValue = value;
                }

                if (prmisId) {
                    eventDetail.prmisId = prmisId;
                }

                if (navTabContentId) {
                    eventDetail.navTabContentId = navTabContentId;
                }

                emitCustomEvent('make-hierarchy-category-select', eventDetail, $component[0]);
            }

            function getSelectorsContext(element) {
                var data = $(element).data();
                var context = {
                    resourceCategory: data.resourcecategory,
                    resourceType: data.resourcetype
                };

                var productId = data.productId;
                var associatedTo = data.associatedTo;

                if (typeof productId != 'undefined') {
                    context.productId = productId;
                }
                if (typeof associatedTo != 'undefined') {
                    context.associatedTo = associatedTo;
                }

                return context;
            }

            updateHierarchy();

            var initialValues = STFED.parseSelectorsUrl();
            var initialValuesLength = Object.keys(initialValues).length;

            function goToHierarchy() {
                var dataAtrSearch = [];

                for (var i = 0, max = arguments.length; i < max; i++) {
                    dataAtrSearch.push('[' + arguments[i].name + '="' + arguments[i].value + '"]')
                }

                if (typeof arguments[0].value !== 'undefined') {
                    var $link = $component.find('.js-simple-accordion-toggler' + dataAtrSearch.join(''));

                    if ($link.length === 0) {
                        $link = $component.find('.st-link' + dataAtrSearch.join(''));
                    }

                    $link.trigger('click');
                }
            }

            function activateMainResourceSelector() {
                //Initialize selector
                var text = "";
                var resourceCategory = $component.data('resourcecategory');
                if (resourceCategory)
                    emitCategorySelect(text, resourceCategory, 0, getSelectorsContext($component));
            }

            if (isActive && initialValuesLength !== 0) {
                goToHierarchy({
                    value: initialValues.resourceCategory,
                    name: 'data-hierarchy-category'
                });

                goToHierarchy({
                    value: initialValues.resourceType,
                    name: 'data-resourcetype'
                });

                goToHierarchy({
                    value: initialValues.productId,
                    name: 'data-product-id'
                }, {
                    value: initialValues.associatedTo,
                    name: 'data-associated-to'
                });
            } else {
                var checkActiveTabInterval = setInterval(function () {
                    if (STUtils.getActiveTab()) {
                        clearInterval(checkActiveTabInterval);
                        if (STUtils.isTabActive(tabId)) {
                            //If url does not contain any hash and tab is selected, init resource selector
                            activateMainResourceSelector();
                        }
                    }
                }, 50);
            }

            $('body').append($mobileComponent);
        });

        //Event in order to manage hierarchy update
        $(document).on('hierarchy-category-update', function (event) {
            var detail = event.originalEvent.detail;
            var $components = $('.st-resources-hierarchy');
            var resourceType = detail.resourceType;
            var resourceCategory = detail.resourceCategory;

            $components.each(function () {
                var $component = $(this);
                var $container = $component.closest('.js-navigation-tabs-context, .js-st-tab-content');

                if ($container) {
                    var tabId = $container.data('content') || $container.data('tab-id');

                    if (STUtils.isTabActive(tabId)) {

                        var $link;
                        var linkSelectorQuery = '[data-level=0] a';

                        if(resourceCategory) {
                            if(resourceCategory !== 'all'){
                                linkSelectorQuery += '[data-resourcecategory=' + resourceCategory + ']';
                            }
                        }

                        if(!resourceType && resourceCategory === 'all'){
                            //if both resource type and resource category are undefined, go to root element
                            linkSelectorQuery = '.hierarchy .item:first .item-label';
                        } else if (resourceType) {
                            linkSelectorQuery += '[data-resourcetype=' + resourceType + ']';
                        }else if (resourceType===undefined){
                            linkSelectorQuery += ':not([data-resourcetype])';
                        }

                        $link = $component.find(linkSelectorQuery);

                        if ($link) {
                            $link.click();
                        }

                    }
                }


            });

        });
    }

    $(window).load(function () {
        // We need to run the above code (`initializeResourceHierarchy`)
        // strictly after `initAllSliders` to avoid a race condition
        (window.STFED.initAllSlidersRan || Promise.resolve())
            .then(initializeResourceHierarchy);
    });
})(jQuery);

$(function () {
    var $container = $('.js-resources-search-results');
    var $fileTypeFilter = $container.find('select[name="filter-fileType"]');
    var $sorter = $container.find('select[name="sorter"]');
    var $table = $container.find('.st-table--resources table:first');
    var titleColumnRender = _.template(
        '<% _.forEach(localized, function (item, idx) { %>' +
            '<div class="item">' +
                '<% if (typeof multipleDownload != "undefined" && multipleDownload) { %>' +
                    '<div class="st-checkbox">' +
                        '<input type="checkbox" class="js-st-checkbox" name="download-checkbox-{{ key }}-{{ idx }}" id="download-checkbox-<%= key %>-<%= idx %>" value="<% if (typeof item["file_id"] != "undefined") { %><%= item["file_id"] %><% } %>" data-link="<% if (typeof item["link"] != "undefined") { %><%= item["link"] %><% } %>">' +
                        '<label for="download-checkbox-{{ key }}-{{ idx }}"></label>' +
                    '</div>' +
                '<% } %>' +
                '<a class="st-link st-link--grey with-icon" href="<% if (typeof item["link"] != "undefined") { %><%= item["link"] %><% } %>" target="_blank">' +
                    '<div class="file-type">' +
                        '<% if (idx == 0) { %>' +
                            '<svg class="st-svg st-svg--file-type">' +
                                '<use xlink:href="#icon-<% if (typeof icon != "undefined") { %><%= icon %><% } %>"></use>' +
                            '</svg>' +
                        '<% } %>' +
                    '</div>' +
                    '<div class="title-description">' +
                        '<div class="item">' +
                            '<a download class="st-link st-link--grey js-show-did-you-know-modal" href="<% if (typeof item["link"] != "undefined") { %><%= item["link"] %><% } %>" target="_blank">' +
                                '<% if (typeof item["title"] != "undefined") { %>' +
                                    '<span class="st-font--bold st-margin--all-r-1"><%= item["title"] %></span>' +
                                '<% } %>' +
                                '<% if (typeof item["lang"] != "undefined" && item["lang"] != "en") { %>' +
                                    '<span class="st-flag">' +
                                        '<img src="/etc/clientlibs/st-site-cx/media/app/images/flag-<%= item["lang"] %>.png">' +
                                    '</span>' +
                                '<% } %>' +
                                '<span class="st-margin--all-r-1"><% if (typeof item["desc"] != "undefined") { %><%= item["desc"] %><% } %></span>' +
                                '<% if (typeof item["version"] != "undefined") { %><%= item["version"] %><% } %>' +
                            '</a>' +
                        '</div>' +
                    '</div>' +
                '</a>' +
            '</div>' +
        '<% }) %>'
    );

    var mobileColumnRender = _.template(
        '<div class="medium-info">' +
            '<span class="value"><% if (typeof type != "undefined") { %><%= type %><% } %></span>' +
        '</div>' +
        '<% _.forEach(localized, function (item, idx) { %>' +
            '<div class="medium-details">' +
                '<a download href="<% if (typeof link != "undefined") { %><%= link %><% } %>" target="_blank" class="st-link st-link--grey">' +
                    '<svg class="st-svg st-svg--file-type">' +
                        '<use xlink:href="#icon-<% if (typeof icon != "undefined") { %><%= icon %><% } %>"></use>' +
                    '</svg>' +
                    '<div class="description">' +
                        '<span class="value st-font--bold"><% if (typeof item["title"] != "undefined") { %><%= item["title"] %><% } %></span>' +
                        '<% if (typeof item["lang"] != "undefined" && item["lang"] != "en") { %>' +
                            '<span class="st-flag">' +
                                '<img src="/etc/clientlibs/st-site-cx/media/app/images/flag-<% item["lang"] %>.png">' +
                            '</span>' +
                        '<% } %>' +
                        '<span class="value"><% if (typeof item["desc"] != "undefined") { %><%= item["desc"] %><% } %></span>' +
                        '<span class="value st-font-size--xs-smallest"><% if (typeof item["version"] != "undefined") { %><%= item["version"] %><% } %></span>' +
                    '</div>' +
                '</a>' +
            '</div>' +
        '<% }) %>'
    );

    var columnDefs = [
        {
            targets: 0,
            data: null,
            className: 'hidden',
            render: function ( data, type, row, meta ) {
                return '<span class="hidden">' + data.fileType + '</span>';
            }
        },
        {
            targets: 1,
            data: null,
            className: 'st-table__cell--align-top visible-on-desktop-only',
            render: function ( data, type, row, meta ) {
                return titleColumnRender(_.merge({}, data, {
                    key: row
                }));
            }
        },
        {
            targets: 2,
            data: null,
            className: 'st-table__cell--align-top visible-on-desktop-only',
            render: function ( data, type, row, meta ) {
                return data.type || '';
            }
        },
        {
            targets: 3,
            data: null,
            className: 'visible-on-medium-down',
            render: function ( data, type, row, meta ) {
                return mobileColumnRender(data);
            }
        }
    ];

    $fileTypeFilter.on('selectric-select', function (event) {
        $table.DataTable().columns(0).search(event.target.value).draw();
    });

    $sorter.on('selectric-select', function (event) {
        $table.DataTable()
            .order([+event.target.value, 'asc'])
            .draw();
    });

    function initTable() {
        if (!$.fn.DataTable.isDataTable($table)) {
            $table.dataTable(STFED.addMaxVisibleItemsBehaviour($table, {
                "autoWidth": false,
                "paging": false,
                "ordering": true,
                "info": false,
                "searching": true,
                "columnDefs": columnDefs,
                "order": [[0, "asc"]]
            }));
        }
    }

    initTable();

    enquire.register(STFED.mediaQueries.largeMin, {
        match: function() {
            $table.DataTable()
                .order($table.data('previous-order') || [])
                .draw();
        },
        unmatch: function() {
            $table.data('previous-order', $table.DataTable().order());
            $sorter.val(3);
        }
    });
});

$(function () {
    var $container = $('.js-application-search-results'); // this class refers the table to the search
    var $page = $container.closest('[data-page-content]');
    var isVisible = $page.is(':visible');
    var $tables = $container.find('table');
    var accordionsMenu = $page.find('.js-st-accordion-menu');

    function expandAll() {
        //extend STFED with initAccordions function
        accordionsMenu.each(function () {
            var accordion = $(this);
            $('input[type="checkbox"]:not(.js-st-not-collapsible)', accordion).each(function () {
                var $this = $(this);
                $this.prop('checked', true);
                $this.siblings('ul').show();
            });
        });
        scrollToPageSection($tables.get(0));
    }

    $(document).on('make-search', function (event) {
        if (!isVisible) {
            return;
        }
        var detail = event.originalEvent.detail;
        var value = detail.searchQuery;
        $tables.DataTable().search(value).draw(); //rerender dataTables

        // expand all accordion tables if exist
        if (accordionsMenu.length) {
            expandAll();
        }
    })

    function initApplicationTable() {
        if (!$.fn.DataTable.isDataTable($tables)) {
            $tables.dataTable(STFED.addMaxVisibleItemsBehaviour($tables, {
                "paging": false,
                "ordering": true,
                "info": false,
                "searching": true,
                "order": [[0, "asc"]]
            }));
        }
    }

    initApplicationTable();
});

$(function () {
    var $container = $('.js-tools-and-software-search-results');
    var $table = $container.find('.st-table--resources table:first');

    var tableToolsColTitle = _.template(
        '<% _.forEach(localized, function (item, idx) { %>' +
            '<a href="<%= item["link"] %>" target="_blank" class="item st-flex">' +
                '<h3 class="st-text-color--light-blue"> <%= item["title"] %> </h3>' +
                '<% if ( item["availability"] == "Active" ) { %>' +
                    '<div class="st-badge st-tooltip st-tooltip--badge js-st-tooltip st-tooltip--right" data-tooltip-text="Product is in volume production">ACTIVE</div>' +
                '<% } %>' +
            '</a>' +
        '<% }) %>'
    );

    var tableToolsColDesc = _.template(
        '<% _.forEach(localized, function (item, idx) { %>' +
            '<p> <%= item["desc"] %> </p>' +
        '<% }) %>'
    );

    var tableToolsColMobile = _.template(
        '<% _.forEach(localized, function (item, idx) { %>' +
            '<a href="<%= item["link"] %>" target="_blank" class="item st-flex">' +
                '<h3 class="st-text-color--light-blue"> <%= item["title"] %> </h3>' +
                '<% if ( item["availability"] == "Active" ) { %>' +
                    '<div class="st-badge st-tooltip st-tooltip--badge js-st-tooltip st-tooltip--right" data-tooltip-text="Product is in volume production">ACTIVE</div>' +
                '<% } %>' +
            '</a>' +

            '<p> <%= item["desc"] %> </p>' +
        '<% }) %>'
    );

    var columnDefs = [
        {
            targets: 0,
            data: null,
            className: 'hidden',
        },
        {
            targets: 1,
            data: null,
            className: 'st-table__cell--align-top visible-on-desktop-only',
            render: function ( data, type, row, meta ) {
                return tableToolsColTitle(data)
            }
        },
        {
            targets: 2,
            data: null,
            className: 'st-table__cell--align-top visible-on-desktop-only',
            render: function ( data, type, row, meta ) {
                return tableToolsColDesc(data)
            }
        },
        {
            targets: 3,
            data: null,
            className: 'hidden',
        },
        {
            targets: 4,
            data: null,
            className: 'st-table__cell--align-top visible-on-desktop-only',
            render: function ( data, type, row, meta ) {
                return data.manufacturer ? data.manufacturer : ''
            }
        },
        {
            targets: 5,
            data: null,
            className: 'st-table__cell--align-top visible-on-desktop-only',
            render: function ( data, type, row, meta ) {
                return data.licence_type ? data.licence_type : 'Free'
            }
        },
        {
            targets: 6,
            data: null,
            className: 'hidden',
        },
        {
            targets: 7,
            data: null,
            className: 'st-table__cell--align-top visible-on-desktop-only',
            render: function ( data, type, row, meta ) {
                return data.supported_devices ? data.supported_devices.join(', ') : ''
            }
        },
        {
            targets: 8,
            data: null,
            className: 'visible-on-medium-down',
            render: function ( data, type, row, meta ) {
                return tableToolsColMobile(data)
            }
        }
    ];

    function initTable() {
        STFED.bindPageLengthUpdateOnDataTable($table);

        if (!$.fn.DataTable.isDataTable($table)) {
            $table.dataTable(STFED.addMaxVisibleItemsBehaviour($table, {
                "autoWidth": false,
                "paging": false,
                "ordering": true,
                "info": false,
                "searching": true,
                "columnDefs": columnDefs,
                "order": [[0, "asc"]]
            }));
        }
    }

    initTable();
});

//establish name space for fed functions
var STFED = STFED || {};

//extend STFED with functions
STFED.navigationTabs = {
    openPageTab: function (pageId, filterSidebar) {
        filterSidebar = filterSidebar || false;
        var $selectedSection = $('div[data-page-content="' + pageId + '"]');
        if(!$selectedSection.length){
			$selectedSection = $('div[data-page-content="overview"]');
        }

        $("div[data-page-content]").addClass("st-invisible hidden");

        $selectedSection.removeClass("st-invisible hidden");

        if (
            $selectedSection.data('contentUrl') &&
            !(
                $selectedSection.hasClass('is-loaded') ||
                $selectedSection.hasClass('is-loading')
            )
        ) {
            var $spinner = $('<div class="st-loading-spinner"></div>');

            $selectedSection
                .addClass('is-loading')
                .append($spinner);

            $.ajax($selectedSection.data('contentUrl').trim(), {})
                .done(function (data, textStatus, jqXHR) {
                    $spinner.remove();

                    $selectedSection.html(data);

                    initContent($selectedSection[0]);

                    $selectedSection
                        .removeClass('is-loading')
                        .addClass('is-loaded')
                        .trigger('loaded');
                }).fail(function (jqXHR, textStatus, errorThrown) {
                    console.log(errorThrown);
                });
        } else {
            if ($selectedSection.length) {
                STFED.navigationTabs.dispatchBecomeVisibleEvent($selectedSection[0]);
                if(!$selectedSection.data("datatableInitialized")){
                	$selectedSection.data("datatableInitialized", true);
                	$(".st-tab-content-style-temp").remove();
                	STFED.TabActions.initDataTable($selectedSection[0]);
                }
            }
        }

        if(filterSidebar) {
            $(".js-st-sidebar__filters").addClass("st-sidebar__filters--visible");
        } else {
            $(".js-st-sidebar__filters").removeClass("st-sidebar__filters--visible");
        }

        if ($selectedSection.length) {
            //force all tables inside to recaclulate since those might be initialized when tab was hidden and as a result got wrong width
            $selectedSection.find('.dt-responsive').trigger('table.recalculate');
        }

        function initContent(context) {
            context = context || document;

            var $context = $(context);

            try {
                if ($context.foundation) $context.foundation();
                if (initReadMoreAccordion) initReadMoreAccordion(context);
                if (initProductSelectors) initProductSelectors(context);
                if (initAllDataTables) initAllDataTables(context);
                if (STFED.tableInit) STFED.tableInit(context);
                if (initTable) initTable(context);
                if (animateStickyTableScroll) animateStickyTableScroll(context);
                if (initAllSliders) initAllSliders(context);
                if (formSelectric) formSelectric(context);
                if (formInput) formInput(context);
                if (numberInput) numberInput(context);
                if (initDatePicker) initDatePicker(context);
                if (initTableHighlighting) initTableHighlighting(context);
                if (compareView) compareView(context);
                if (STFED.widgetSlider) STFED.widgetSlider.init(context);
                if (STFED.edesign) {
                    // init edesign
                    // we don't want to use edesign.init because we don't want to duplicate the event handlers
                    STFED.edesign.dcdcACDCInit(context);
                    STFED.edesign.initTabs($('.st-edesign', context));
                }
                if (STFED.scrollableTables) STFED.scrollableTables.init(context);
                if (STFED.resImageMap) STFED.resImageMap.init(context);
                if (STFED.dotdotdot) STFED.dotdotdot.init(context);
                if (STFED.accordions) STFED.accordions.init(context);
                //force all tables inside to recaclulate once async content has come and is displayed
                $context.find('.dt-responsive').trigger('table.recalculate');
                STFED.navigationTabs.dispatchBecomeVisibleEvent(context);
            } catch (err) {
                console.log(err);
            }
        }
    },

    dispatchBecomeVisibleEvent: function (tab) {
        var event = document.createEvent('Event');
        var dispatch = function (element) {
            element.dispatchEvent(event);
        };

        event.initEvent('become-visible', true, true);

        if (Object.prototype.toString.call(tab).indexOf('Array') > -1) {
            tab.forEach(function (element) {
                dispatch(element);
            });
        } else {
            dispatch(tab);
        }
    },

    tooltipPositions: [],

    pushTooltipPositions: function(tooltipInfo) {
        var tooltipPositions = STFED.navigationTabs.tooltipPositions;

        // check of unique info
        for(i = 0, max = tooltipPositions.length; i < max; i++) {
            if (tooltipPositions[i].id === tooltipInfo['id-tooltip']) {
                return;
            }
        }

        STFED.navigationTabs.tooltipPositions.push({
            "id": tooltipInfo['id-tooltip'],
            "$tab": tooltipInfo.$tab,
            "$container": tooltipInfo.$container,
            "$tooltip": tooltipInfo.$tooltip,
            "$": tooltipInfo.$tooltip
        });
    },

    fitExpandWidth: function (previousTab, leftOffset) {
        var availableWidth = (leftOffset - previousTab.right) / 2;
        var fitWidth = STFED.navigationTabs.addMarginsToExpandWidth(Math.min(previousTab.expandWidth, availableWidth), 10);

        previousTab.expandWidth = fitWidth;

        return fitWidth;
    },

    addMarginsToExpandWidth: function(width, margin) {
        var result = width - margin;

        return result > 0 ? result : width;
    },

    updateTooltipsPosition: function () {
        if (STFED.navigationTabs.tooltipPositions.length === 0) {
            return;
        }

        var $tabsContainer = $('.st-nav-tabs');
        var $tooltipWrapper = $('.st-nav-tabs__tooltip--wrapper');
        var tooltipWrapperLeftMargin = parseInt(window.getComputedStyle($tooltipWrapper[0], null).getPropertyValue('margin-left'));
        var tabsLeftOffsetAgainstTooltips = $tabsContainer.offset().left - ($tooltipWrapper.offset().left - tooltipWrapperLeftMargin);
        var tooltipSizesAndOffsets = STFED.navigationTabs.tooltipPositions.reduce(function (list, data, i) {
            var tabLeft = data.$tab.position().left;
            var tooltipLeftOffset = tabsLeftOffsetAgainstTooltips + tabLeft;
            var tooltipRightOffset = tooltipLeftOffset + data.$tab.outerWidth();

            return list.concat({
                $container: data.$container,
                $tooltip: data.$tooltip,
                expandWidth: i ?
                    STFED.navigationTabs.fitExpandWidth(list[i - 1], tooltipLeftOffset) :
                    STFED.navigationTabs.addMarginsToExpandWidth(tabLeft - tabsLeftOffsetAgainstTooltips, 10),
                left: tooltipLeftOffset,
                right: tooltipRightOffset,
                width: tooltipRightOffset - tooltipLeftOffset
            });
        }, []);
        tooltipSizesAndOffsets.forEach(function (data) {
            data.$container.css({
                opacity: 1,
                top: '10px',
                left: (data.left - data.expandWidth) + 'px',
                width: (data.width + data.expandWidth * 2) + 'px'
            });
        });
    },

    initTabTooltip: function () {
        var self = this;
        var $tabs = $('.js-st-tabs-tab-products, .js-st-tab-pf-cad-resources, .js-st-tabs-tab-online-design');

        if ($('.st-nav-tabs__tooltip--wrapper').length === 0) {
            $tabs.closest(".st-nav-tabs").after('<div class="st-nav-tabs__tooltip--wrapper hidden" />');
        } else {
            $('.st-nav-tabs__tooltip--wrapper').addClass('hidden');
        }

        $tabs.each(function(indx, tab){
            var $tab = $(tab);
            var siteTabId = $tab.data('page-nav');

            enquire.register(STFED.mediaQueries.largeMin, {
                match : function() {
                    if ($('.js-st-tabs-tab-overview').length != 0 && $tab.length != 0) {
                        var tooltipClass = $tab.attr('data-tooltip-class') || '';
                        var tooltipText = $tab.attr("data-tooltip-text") || '';
                        $('.st-nav-tabs__tooltip--wrapper').removeClass('hidden').append('<div class="st-nav-tabs__tooltip--container"><a href="#' + siteTabId + '" class="st-nav-tabs__tooltip js-st-tabs-tab-tooltip-' + indx + ' ' + tooltipClass + '">' + tooltipText + '</a></div>');

                        var $tooltip = $('.js-st-tabs-tab-tooltip-' + indx);

                        STFED.navigationTabs.pushTooltipPositions({
                            "id-tooltip": indx,
                            "$container": $tooltip.parent(),
                            "$tooltip": $tooltip,
                            "$tab": $tab
                        });

                        STFED.navigationTabs.updateTooltipsPosition();

                        var $tabsWrapper = $tab.parents('.js-st-tabs');
                        if (tooltipText && !$tabsWrapper.hasClass('active-messaging')) {
                            $tabsWrapper.addClass('active-messaging');
                        }

                        $('.js-st-tabs-tab-tooltip-' + indx + ' ').click(function (e) {
                            var tabsWrapper = $(this).parents('.js-st-tabs');

                            tabsWrapper.removeClass('active-messaging');

                            if(STFED.sidebar && !STFED.sidebar.isCategoryHidden) {
                                STFED.sidebar.minimizeCategoryTree();
                            }

                            self.removeTabTooltip();

                            $tab.click();
                        });
                    }
                }
            });
        });
    },

    removeTabTooltip: function () {
        enquire.register(STFED.mediaQueries.largeMin, {
            match : function() {
                $('[class *= "js-st-tabs-tab-tooltip-"]').fadeOut(100);
                $('.st-nav-tabs.active-messaging').removeClass('active-messaging');
                $('[class *= "st-nav-tabs__tooltip--container"]').remove();
                $('.st-nav-tabs__tooltip--wrapper').addClass('hidden');
                STFED.navigationTabs.tooltipPositions = [];
            }
        });
    },

    init: function () {
        $(window).on('resize', _.debounce(function () {
            if (STFED.navigationTabs.tooltipPositions.length > 0) {
                STFED.navigationTabs.updateTooltipsPosition();
            }
        }, 100));

        $(document).on('layer-opened', function () {
            $('.st-nav-tabs').addClass('has-dropdown-open');
        });

        $(document).on('layer-closed', function () {
            $('.st-nav-tabs').removeClass('has-dropdown-open');
        });

        $(document).on('sidebar-was-opened sidebar-was-closed', function () {
            STFED.navigationTabs.updateTooltipsPosition();
        });
    }
};

$(document).ready(function () {
    (function ($) {
        var styleTmp = $('.st-tab-content-style-temp');
        if (!styleTmp.length) {
            return;
        }

        var head = $('head')[0];

        var callback = function(mutationsList, observer) {
            mutationsList.forEach(function (mutation) {
                if (mutation.type === 'childList') {
                    var temp = $('.st-tab-content-style-temp');

                    if (!temp.length) {
                        emitCustomEvent('tabs-were-displayed');

                        observer.disconnect();
                    }
                }
            });
        };

        var observer = new MutationObserver(callback);

        observer.observe(head, {
            childList: true
        });
    })(jQuery);

    (function ($) {
        STFED.navigationTabs.init();

        $('.st-main').on('click', '.slick-next', function () {
            STFED.navigationTabs.removeTabTooltip();
        });
    })(jQuery);
});
//establish name space for fed functions
var STFED = STFED || {};

//extend namespace for video method
STFED.viewPortHeightFix = {

    init: function () {
        var navigationElements = $('.st-side-navigation');
        $(window).on('resize orientationchange', _.debounce(function () {
            STFED.viewPortHeightFix.toggleElementHeight(window.innerHeight, navigationElements);
        }, 100));

        var modalElements = $('.st-modal');
        $(window).on('resize', STFED.viewPortHeightFix.toggleModalHeight(window.innerHeight, modalElements));

        // setInterval(function () {
        //     // $(window).scrollTop(-1);
        //     if (window.innerHeight != docHeight) {
        //         docHeight = window.innerHeight;
        //         STFED.viewPortHeightFix.toggleElementHeight(docHeight, navigationElements);
        //     }
        // }, 500);
    },

    toggleElementHeight: function (docHeight, navigationElements) {
        navigationElements.each(function () {
            if ($(this).hasClass('st-side-navigation')) {
                $('.off-canvas-list ', this).css({height: docHeight});
                $('.st-side-submenu ', this).css({height: docHeight});
            }
            else {
                $('.st-side-submenu ', this).css({height: 'auto'});
                $('.off-canvas-list ', this).css({height: 'auto'});
            }
        });
    },
    toggleModalHeight: function (docHeight, modalElements, paddingTop) {
        modalElements.each(function () {
            if ($(this).hasClass('in') || $(this).hasClass('open')) {
                $('.st-modal--inside', this).css({'max-height': docHeight });
                if(paddingTop){
                    $('.st-modal--inside', this).css({'padding-top': 50 });
                }
                else{
                    $('.st-modal--inside', this).css({'padding-top': '' });
                }
            }
        });
    }
};


$(function() {
    STFED.viewPortHeightFix.init();
});

//establish name space for fed functions
var STFED = STFED || {};

//extend STFED with foundation function
STFED.foundation = {
    init: function(){
        Foundation.global.namespace = '';
        $(document)
            .foundation({
                abide : {
                    patterns: {
                        //taken from curent st.com codebase
                        international_phone: /^[ ]*[\+]?[0-9\- ]*$/,
                        whole_positive_number: /^0*[1-9]\d*$/
                    },
                    validators: {
                        checkbox_group: function(el, required, parent) {
                            var group = parent.closest('.checkbox-group');
                            var min = group.attr('data-abide-validator-min');
                            var checked = group.find(':checked').length;
                            if (checked >= min) {
                                group.find('small.error').hide();
                                return true;
                            } else {
                                group.find('small.error').css({
                                    display: 'block'
                                });
                                return false;
                            }
                        },
                        //greater than (or equal to) another input test, via ID, used on edesign
                        greater_than_equal_to: function(el, required, parent) {

                            var fromID = $(el).data('greater-than'),
                                from  = $('#'+fromID).val(),
                                to    = el.value,
                                valid = (parseFloat(from) <= parseFloat(to));
                                if (valid){
                                    $('#'+fromID).closest('.error').removeClass('error');
                                }
                            return valid;
                        },
                        //less than (or equal to) another input test, via ID, used on edesign
                        less_than_equal_to: function(el, required, parent) {
                            var fromID = $(el).data('less-than'),
                                from  = $('#'+fromID).val(),
                                to    = el.value,
                                valid = (parseFloat(from) >= parseFloat(to));

                            if ( valid ){
                                $('#'+fromID).closest('.error').removeClass('error');
                            }
                            if ($('#'+fromID).val() == ""){
                                valid = true;
                            }
                            return valid;
                        },
                        number_range: function(el, required, parent) {
                            var fromMin = $(el).data('min-number'),
                                fromMax = $(el).data('max-number'),
                                to    = el.value,
                                valid = ((parseFloat(fromMin) <= parseFloat(to)) && (parseFloat(fromMax) >= parseFloat(to)));
                            return valid;
                        },
                        image_size: function(el, required, parent) {

                            var $this = $(el);
                            var thisEvent = $this.data('image-event') || false;
                            if (thisEvent != false){
                                thisEvent = $this.data('image-event').target;
                                var thisEventFiles = thisEvent.files[0];
                            }
                            if (thisEvent.files && thisEventFiles) {
                                // Only process image files.
                                if (thisEventFiles.type.match('image.*') && thisEventFiles.size < $this.data('max-image-size')) {
                                    var reader = new FileReader();
                                    reader.onload = function (e) {
                                        $this.closest('.columns').find('.image-display .image-preview').css('background-image', 'url(' + e.target.result + ')');
                                        $this.closest('.columns').find('.image-display').slideDown();
                                    };
                                    reader.readAsDataURL(thisEventFiles);
                                    valid = true;
                                }
                                else {
                                    valid = false;
                                    $this.closest('.columns').find('.image-display').hide();
                                }
                            }
                            else {
                                if (required) {
                                    valid = false;
                                }
                                else {
                                    valid = true;
                                }
                            }

                            return valid;
                        }
                    }
                }
            });
    }
};

$(document).ready(function() {
    (function($) {
        STFED.foundation.init();
    })(jQuery);
});

(function ($) {
    var isMobile = false;
    var arrow = '<svg class="st-svg st-svg--arrow-right"><use xlink:href="#icon-arrow-right"></use></svg>';

    enquire.register(STFED.mediaQueries.smallMax, {
        match: function() {
            isMobile = true;
            init();
        },
        unmatch: function() {
            isMobile = false;
            init();
        }
    });

    function waitForImageBeingLoaded(img) {
        if (img.complete) {
            return $.when();
        }

        var deferred = $.Deferred();

        img.onerror = img.onload = function () {
            deferred.resolve();
        };

        return deferred.promise();
    }

    function getCollapsibleHeight(element) {
        var $element = $(element);

        if (isMobile) {
            var height = getCollapsibleHeightFromData($element[0]);

            return $.when(height != 0 && $element.height() > height ? height : 0);
        } else {
            var $target = $(document.getElementById($element.data('wrapped-show-more-for')));
            var promise;

            if ($target.has('img').length) {
                promise = waitForImageBeingLoaded($target.find('img:first')[0]);
            } else {
                promise = $.when();
            }

            return promise.then(function () {
                var targetBoundary = $target.offset().top + $target.height();
                var elementBottom = $element.offset().top + $element.height();
    
                return elementBottom > targetBoundary ? targetBoundary - $element.offset().top : 0;
            });
        }
    }

    function init() {
        $('[data-wrapped-show-more-for]').each(function () {
            var $element = $(this);

            $element.css('height', '');

            $element.addClass('wrapped-show-more-element');
            $element.data('wrapped-show-more-height', '');
            $element.removeClass('is-collapsible');
            $element.find('.overlay, .toggler').remove();

            getCollapsibleHeight(this).then(function (collapsibleHeight) {
                var isBlock = false;

                if (collapsibleHeight < 50) {
                    isBlock = true;
                    collapsibleHeight = getCollapsibleHeightFromData($element[0]);
                }

                if (collapsibleHeight != 0) {
                    $element.addClass('is-collapsible');
                    $element.append($('<div class="overlay" />'));
                    $element.append($('<div class="toggler" />'));

                    if (isBlock) {
                        $element.addClass('is-wrapped');
                    }

                    $element.data('wrapped-show-more-height', collapsibleHeight);

                    collapse($element);
                }
            });
        });
    }

    function getCollapsibleHeightFromData(element) {
        var $element = $(element);
        var collapsibleHeight = +$element.data('wrapped-show-more-min-height');
        var maxLines = +$element.data('wrapped-show-more-max-lines');

        if (!isNaN(maxLines)) {
            var lineHeight = parseInt(window.getComputedStyle(element).lineHeight);

            return lineHeight * maxLines;
        } else if (isNaN(collapsibleHeight)) {
            collapsibleHeight = 300;
        }

        if ($element.height() <= collapsibleHeight) {
            return 0;
        }

        return collapsibleHeight;
    }

    function collapse(element) {
        var $element = $(element);

        $element.css('height', $element.data('wrapped-show-more-height'));
        $element.addClass('is-collapsed');
        $element.find('.toggler').html('<a href="#">' + ($element.data('wrapped-show-more-default-text') || 'Read more') + arrow + '</a>');
    }

    function showAll(element) {
        var $element = $(element);

        $element.css('height', '');
        $element.removeClass('is-collapsed');
        $element.find('.toggler').html('<a href="#">' + ($element.data('wrapped-show-more-collapsed-text') || 'Read less') + arrow + '</a>');
    }

    $(document).on('become-visible', function (event) {
        if ($(event.target).has('[data-wrapped-show-more-for]').length) {
            init();
        }
    });

    $(function () {
        $(document).on('click', '.wrapped-show-more-element .toggler a', function (event) {
            event.preventDefault();

            var $element = $(event.target).closest('.wrapped-show-more-element');

            if ($element.is('.is-collapsed')) {
                showAll($element);
            } else {
                collapse($element);
            }
        });

        init();
    });
})(jQuery);
var STFED = STFED || {};
STFED.showLngBanner = STFED.showLngBanner || {};
var STFEDlink = STFED.showLngBanner.link || {};

STFED.showLngBanner = {
    init: function (banner) {
        banner && this.enable(banner)
    },
    enable: function (banner){
        var self = this,
            language = (navigator.language || navigator.userLanguage).toLowerCase(),
            languageButton = banner.find('#lb-language').length === 0 ? banner.find('#lb-language-mob') : banner.find('#lb-language'),
            userLang;

        (language === 'zh' || language === 'zh-cn' || language === 'zh-chs' || language === 'zh-sg') && (
            userLang = 'chinese'
        );

        (language === 'ja' || language === 'ja-jp') && (
            userLang = 'japanese'
        );

        function createLink() {
            var link = String(window.location);

            if (typeof _satellite !== 'undefined') {
                _satellite.track('dcLangChangeClick', {lang: this.language.toUpperCase()});
            }

            var newLink = link.replace("/en", "/" + this.language);
            window.location = newLink;
        }

        function showBanner(text) {
            if (text) { languageButton.html(text) }
            banner.removeClass('hidden');
            self.headerFix();
        }

        try {
            if (typeof userLang !== "undefined") {
                banner.find('.' + userLang).removeAttr('hidden');
                switch (userLang) {
                    case "chinese":
                        showBanner();
                        var redirect = createLink.bind({ language: 'zh' });
                        break;
                    case "japanese":
                        showBanner();
                        var redirect = createLink.bind({ language: 'ja' });
                        break;
                    default:
                        break;
                }
            }
        } catch (e) {}

        languageButton.on('click', function () {
            redirect();
        });
    },
    headerFix: function(){
        var self = this,
            mobView = ($(window).width() <= STFED.breakpoint.largeMin),
            main = $('.js-st-main'),
            outerHeight = $('.js-st-header').outerHeight(true),
            outerHeightMob = $('.js-st-header-mobile').outerHeight(true);

        if (mobView) {
            main.css('margin-top', outerHeightMob)
        } else {
            main.css('margin-top', outerHeight)
        }

        $(window).on('resize', _.debounce(function () {
            self.headerFix()
        }, 100));
    }
};

var locale = document.documentElement.lang.toLowerCase();
var languageBanner = $('.js-language-banner');
var languageBannerMob = $('.js-language-banner-mob');

if (locale === 'en') {
    languageBanner && STFED.showLngBanner.init(languageBanner);
    languageBannerMob && STFED.showLngBanner.init(languageBannerMob);
}

if (languageBanner && languageBannerMob) {
    languageBanner.find('#lb-close').on('click', function () {
        hideBanner()
    })
    languageBannerMob.find('#lb-close-mob').on('click', function () {
        hideBanner()
    })
}

function hideBanner() {
    languageBanner.addClass('hidden');
    languageBannerMob.addClass('hidden');
    $('.js-st-main').css('margin-top', '');
}
$(document).ready(function(){
    window.onhashchange = onHashChangeFunction;

    function onHashChangeFunction() {
        processLinks()
    }

    processLinks()

    window.addEventListener('onstatechange', function () { processLinks(); });

    function processLinks() {
        var urlHash = window.location.hash;
        var links = document.querySelectorAll('#languagemenu a.st-header-menu__link, #languagemenu_aside a.st-header-menu__link, #languagemenu__static a.st-header-menu__link, aside.st-side-navigation > ul > li:last-child > ul > li > a')
        if (!links || !links.length) {
            return;
        }
        links.forEach(function (link) {
            var href = window.location.href;
            var existingHref = link.href;
            if (existingHref) {
                if (existingHref.includes('?')) {
                    existingHref = existingHref.split('?')[0]
                }
                existingHref = existingHref.split('#')[0]
                var params = window.location.search
                if (href.includes('#')) {
                    var existingHash = href.split('#')[1]
                    if (!existingHash.includes('?')) {
                        params = params.split('#')[0];
                    }
                }
                var parent = link.parentNode
                if(parent.classList.contains('back')) {
                    return;
                } else {
                    link.setAttribute('href', existingHref + (params !== '' ? params : '') + urlHash);
                }
            }
        });
    }
});

var STFED = STFED || {};

STFED.ECADModels = {
    init: function () {
        this.eventHandlers();
    },
    eventHandlers: function(){
        var self = this;

        this.marketoTrackingEnabled = new Promise(function (resolve) {
            if (document.documentElement.dataset.isMktoTrackingConfigLoaded) {
                resolve();
            } else {
                document.documentElement.addEventListener('mktoTrackingConfigLoaded', function () {
                    resolve();
                });
            }
        }).then(function () {
            try {
                return STFED.Marketo.trackingConfig.legacyEda;
            } catch (e) {
                console.error(e);
            }
        });


        $(document).on('click', '.js-widget-click', function (e) {
            e.preventDefault();
            var $control = $(this);

            self.marketoTrackingEnabled.then(function (isEnabled) {
                if (isEnabled) {
                    self.trackMarketingActivities($control);
                }
            });

            self.toggleWidgetView(true, $(e.target));
        });
        $(document).on('click', '.js-widget-back', function (e) {
            e.preventDefault();
            self.toggleWidgetView(false, $(e.target));
        });
    },

    toggleWidgetView: function(showWidget, $target) {
        let self = this;
        const $widgetWrapper = $target.closest('.st-accordion-table-wrapper');
        const $cadWidget = $widgetWrapper.find('.cad-widget');
        const $iframe = $widgetWrapper.find('iframe');
        const $backButton = $widgetWrapper.find('.js-widget-back');

        if (showWidget) {
            const $cadWidgetElement = $target.closest('.cad-widget-element');
            self.iframeInit($cadWidgetElement, $cadWidget);
            $cadWidget.hide();
            $backButton.show();
        } else {
            $iframe.remove();
            $cadWidget.show();
            $backButton.hide();
        }
    },
    trackMarketingActivities: function ($link) {
        if (typeof Munchkin !== 'undefined') {
            var prmisID = digitalData?.product?.[0]?.productInfo?.prmisID || '';
            var title = window?.digitalData?.product?.[0]?.productInfo?.productName || window?.digitalData?.page?.pageInfo?.titleEn || '';
            var strings = [$link.data('name'), title, prmisID];
            var limit = 255;

            limit -= (location.hostname.length + 1); // Marketo adds hostname to resulting string; we add separator.
            limit -= 2 * strings.length; // Marketo counts k= type parameters as well.
            limit -= (strings.length - 1); // Every parameter uses & as separator

            var truncatedValues = STFED.Marketo.truncateStrings(
                strings,
                limit,
                [[150, 200], [60, 150], [15, 20]]
            );

            Munchkin.munchkinFunction('visitWebPage', {
                    'url': '&' + new URLSearchParams({
                        t: STFED.Marketo.truncateUndefined(truncatedValues[0]),
                        n: STFED.Marketo.truncateUndefined(truncatedValues[1]),
                        i: STFED.Marketo.truncateUndefined(truncatedValues[2])
                    }).toString(),
                    'params': 'SFDC activity: EDA Model download'
                }
            );
        }
    },
    iframeInit: function($cadWidgetElement, $cadWidget) {
        const link = $cadWidgetElement.data('link');
        const elementClass = $cadWidgetElement.data('ulProduct') ? 'ul' : 'ecad';
        $('<iframe>', {
            'src': link,
            'class': 'st-'+elementClass+'-widget-iframe'
        }).insertBefore($cadWidget);
    },
};

(function($) {
    STFED.ECADModels.init();
})(jQuery);

var comboSliders_initialization = [];

$(document).ready(function () {
(function ($) {
    var $comboSliders = $('.js-combo-sliders');

    document.addEventListener('become-visible', () => {
        var $comboSlidersNew = $('.js-combo-sliders');

        if ($comboSlidersNew.length && $comboSlidersNew.length !== $comboSliders.length ) {
            $.each( $comboSlidersNew, function( key, value ) {
                var index = $.inArray( value, $comboSliders );
                if( index === -1 ) {
                    comboSlick($(value))
                }
            });
        }
    }, { once: true });

    if ($comboSliders.length) {
        comboEnable();
    }

    function comboEnable() {
        $comboSliders.each(function (index) {
            var $element = $(this);
            var $page = $element.closest('[data-page-content]');

            if ($page.length) {
                $(document).on('become-visible', function (event) {
                    if ($(event.target).closest('[data-page-content]').has($element).length > 0) {
                        comboInitialization($element, index);
                    }
                })
            } else {
                comboInitialization($element, index);
            }

            $(document).on('sidebar-was-closed', function () {
                comboInitialization($element, index);
            });
        })
    }

    function comboInitialization($element, index) {
        var unslickFrom = $element.data('unslick-from');
        var unslickTo = $element.data('unslick-to');

        if($element.isInViewport() && !unslickFrom && !unslickTo){
            comboSlick($element);
        } else {
            comboSliders_initialization[index] = _.debounce(function () {
                if (unslickFrom || unslickTo) {
                    unslick($element, unslickFrom, unslickTo);
                } else {
                    comboSlick($element);
                }
                $(window).off('scroll', comboSliders_initialization[index]);
            }, 150);
            $(window).on('resize scroll', comboSliders_initialization[index]);
        }
    }

    function unslick($element, unslickFrom, unslickTo) {
        var $windowWidth = $(window).width();
        var isUnslickFrom = $windowWidth > unslickFrom;
        var isUnslickTo = $windowWidth < unslickTo;

        if (isUnslickFrom || isUnslickTo) {
            if ($element.hasClass('slick-initialized')) {
                $element.slick("unslick");
            }
        } else {
            comboSlick($element);
        }
    }

    function comboSlick($element) {
        if ($element.hasClass('slick-initialized')) {
            var slickListWidth = $element.find('.slick-list').width();
            var slickTrackWidth = $element.find('.slick-track').width();

            if (slickTrackWidth < slickListWidth || slickTrackWidth === 0){
                $element.slick('refresh');
            }
        } else {
            $element.slick({
                speed: 300,
                variableWidth: false,
                infinite: false,
                focusOnSelect: false,
                dots: false,
                arrows: true,
                responsive: [{
                    breakpoint: 1026,
                    settings: {
                        arrows: false,
                        slidesToShow: 1,
                        dots: true,
                    }
                }]
            });
        }
    }
})(jQuery);
});
var STFED = STFED || {};
var read_more_components_initialized_fns = [];
//extend namespace for dotdotdot method
STFED.readMoreDotdotdot = {
    settings: {
        'readMoreText': 'Read more',
        'readLessText': 'Read less',
    },
    init: function (context) {
        context = context || document;
        var self = this;

        $(".st-read-more:visible", context).each(function (index) {
            var item = this;
            var maxLines = $(this).data('max-lines');

            var itemLineHeight = parseInt(window.getComputedStyle(item).lineHeight);
            var itemLines = $(item).height() / itemLineHeight;

            var $readMore = $(item).find('a.read-more');

            self.settings.readMoreText = $readMore.data('read-more') || self.settings.readMoreText;
            self.settings.readLessText = $readMore.data('read-less') || self.settings.readLessText;

            $readMore.text(self.settings.readMoreText);

            if (maxLines < itemLines) {
                var maxHeight = itemLineHeight * maxLines;
                self.enable(item, index, maxHeight, $readMore);
            }
        });

    },
    _dotdotdotCallback: function (isTruncated) {
        var item = this.item,
            text = this.text;

        if (isTruncated) {
            $("a.read-more", item).text(text);
        }
    },
    _enableReadMore: function (item, index, maxHeight) {
        var $this_dot = $(item);
        var self = this;

        if ($this_dot.isInViewport()) {
            $this_dot.attr("data-read-more_components_initialized", index);
            $this_dot.dotdotdot({
                truncate: "word",
                height: maxHeight,
                keep: '.read-more',
                tolerance: 0,
                callback: self._dotdotdotCallback.bind({item: $this_dot, text: self.settings.readMoreText})
            });
            $(window).unbind("scroll", read_more_components_initialized_fns[index]);

            return true;
        }
    },
    enable: function (item, index, maxHeight, $readMore) {
        var self = this;
        if ($readMore.length !== 0) {
            var readMoreWidth = $readMore.width() + 1; // get original width for new read-more button
            $readMore.text(self.settings.readLessText).width(readMoreWidth);
        }

        if (this.validate(item)){
            read_more_components_initialized_fns[index] = _.debounce(function () {
                self._enableReadMore(item, index, maxHeight);
            }, 100, {
                leading: true,
                trailing: false
            });
            if (self._enableReadMore(item, index, maxHeight) !== true) {
                $(window).bind("scroll", read_more_components_initialized_fns[index]);
            }

            $(item).on('click', '.read-more', function (event) {
                var parents = $(this).parents('.st-read-more');
                var isTruncated = parents.hasClass('ddd-truncated');
                var instance = parents.data('dotdotdot');

                event.preventDefault();

                if (isTruncated) {
                    instance && instance.restore();
                } else {
                    self._enableReadMore(item, index, maxHeight);
                }
            });
        }
    },
    validate: function(item) {
        var itemText = $(item).find('.text-block').html();
        var locale = document.documentElement.lang.toLowerCase();
        // check if the text contains '。' char
        if (locale === 'zh' || locale === 'ja') {
            //replace zh/ja chars with same char + space, to separate words
            var newText = itemText.replace(/。/g, '。 ').replace(/、/g, '、 ').replace(/，/g, '， ');
            // set new text
            $(item).find('.text-block').html(newText);
        }
        return true
    }
};

$(function () {
    STFED.readMoreDotdotdot.init();
});
var STFED = STFED || {};
STFED.productPreference = STFED.productPreference || {};

STFED.productPreference = {
    init: function () {
        this.loading();
        this.eventHandlers();
    },
    loading: function(){
        var $selectedTable = $('.js-preference-product');
        $selectedTable.find('tbody').removeClass('hidden');
    },
    eventHandlers: function(){
        $(document).on('click', '.js-preference-remove', function () {
            var id = $(this).data('id');
            var elements = $('.js-preference-product').find("[data-product='"+id+"']");
            elements.each(function(){$(this).remove()});
        })
    }
};

(function($) {
    $(function() {
        STFED.productPreference.init();
    });
})(jQuery);
var STFED = STFED || {};

STFED.preloader = {
    show: function (context) {
        var place = context || $("body");
        this.spinnerEffect(true, place, context ? true : false);
    },
    hide: function (context) {
        var place = context || $("body");
        this.spinnerEffect(false, place, context ? true : false);
    },
    spinnerEffect: function (show, place, local) {
        var spinner = place.parent().find('.spinner-preloader');
        if (show) {
            if (spinner.length === 0) {
                place.after('<div class="' + (local ? "spinner-preloader" : "spinner-preloader st-loading-spinner--full-page") + '"><div class="st-loading-spinner"></div></div>')
            }
        } else {
            if (spinner.length > 0) {
                spinner.remove()
            }
        }
    }
};

$(function () {
    $('.js-init-preloader').on('click', function(){
        STFED.preloader.init();
    })
});

var STFED = STFED || {};

STFED.ecosystem = {
    contentActiveClass: 'active',
    contentLoadingClass: 'loading',
    contentLoadedClass: 'loaded',
    showContent: function (targetId, $contents, tabsEndpointUrl) {
        var self = this;
        var $content = $contents.filter('[id="' + targetId + '"]');

        $contents.hide();
        $content.show();

        if (tabsEndpointUrl && !$content.hasClass(self.contentLoadingClass) &&
            !$content.hasClass(self.contentLoadedClass)) {
            var $spinner = $('<div class="st-loading-spinner" />');

            $content.addClass(self.contentLoadingClass).empty().append($spinner);

            $.get(tabsEndpointUrl.replace('{id}', targetId))
                .then(function (html) {
                    $content.addClass(self.contentLoadedClass);
                    $content.html(html);
                    self.initComponents($content);
                })
                .fail(function (error) {
                    console.error(error);
                })
                .always(function () {
                    $content.removeClass(self.contentLoadingClass);
                    $spinner.remove();
                });
        } else {
            this.initComponents($content);
        }
    },
    activateTab: function ($tab, $ecosystem) {
        var self = this;
        var target = $tab.children('a').attr('href').substr(1);
        var $contents = $ecosystem.find('.eco-content > .content');
        var isActive = $tab.hasClass(this.contentActiveClass);

        if (!isActive) {
            $tab.siblings().removeClass(this.contentActiveClass);
            $tab.addClass(this.contentActiveClass);
        }

        self.showContent(target, $contents, $ecosystem.data('tabs-endpoint-url'));
    },
    enable: function ($ecosystem) {
        var self = this;
        var $tabs = $ecosystem.find('.eco-navigation > .eco-tab');
        var $firstTab = $($tabs[0]);

        self.activateTab($firstTab, $ecosystem);

        $tabs.on('click', function (e) {
            e.preventDefault();

            var $tab = $(this);

            self.activateTab($tab, $ecosystem);
        });
    },
    initMobileSlider: function ($element) {
        if ($element.isVisibleInViewport()) {
            $element.addClass('is-initialized');

            var options = {
                variableWidth: true,
                infinite: false,
                focusOnSelect: false,
                dots: true,
                arrows: false,
                outerEdgeLimit: true,
                responsive: [
                    {
                        breakpoint: Infinity,
                        settings: 'unslick'
                    },
                    {
                        breakpoint: STFED.breakpoint.smallMax,
                        settings: {}
                    }
                ]
            };

            enquire.register(STFED.mediaQueries.smallMax, {
                match: function () {
                    $element.slick(options);
                },
                unmatch: function () {
                }
            });

            return true;
        }

        return false;
    },
    initTabletSlider: function ($element) {
        if ($element.isVisibleInViewport()) {
            $element.addClass('is-initialized');

            var options = _.mergeWith({
                    variableWidth: false,
                    infinite: false,
                    focusOnSelect: false,
                    dots: true,
                    arrows: false,
                    responsive: [
                        {
                            breakpoint: Infinity,
                            settings: 'unslick'
                        },
                        {
                            breakpoint: STFED.breakpoint.mediumMax,
                            settings: {
                                slidesToShow: 2.33
                            }
                        }
                    ]
                }, $element.data('slick-options') || {},
                function (srcValue, destValue, key) {
                    if (key === 'responsive' && destValue) {
                        destValue.forEach(function (item) {
                            var defaultItem = srcValue.find(function (candidate) {
                                return candidate.breakpoint === item.breakpoint;
                            });

                            if (defaultItem) {
                                _.extend(defaultItem, item);
                            } else {
                                srcValue.push(item);
                            }
                        });

                        return srcValue;
                    }
                }
            );

            $element.slick(options);

            enquire.register(STFED.mediaQueries.largeMin, {
                match: function () {
                },
                unmatch: function () {
                    $element.slick(options);
                }
            });

            return true;
        }

        return false;
    },
    initComponents: function ($content) {
        var self = this;
        var initializers = [];

        if (STFED && STFED.initCollapseToggler) {
            STFED.initCollapseToggler();
        }

        if (STFED && STFED.initHorizontalDraggableContent) {
            STFED.initHorizontalDraggableContent();
        }

        $content.find('.js-mobile-slider:not(.is-initialized)').each(function () {
            var $element = $(this);

            if (!self.initMobileSlider($element)) {
                initializers.push(function () {
                    return self.initMobileSlider($element);
                });
            }
        });

        $content.find('.js-tablet-slider:not(.is-initialized)').each(function () {
            var $element = $(this);

            if (!self.initTabletSlider($element)) {
                initializers.push(function () {
                    return self.initTabletSlider($element);
                });
            }
        });

        if (initializers.length > 0) {
            var $window = $(window);

            var handler = function () {
                initializers.forEach(function (initializer) {
                    if (initializer()) {
                        initializers.splice(initializers.indexOf(initializer), 1);
                    }
                });

                if (initializers.length === 0) {
                    $window.off('scroll', handler);
                }
            };

            $window.off('scroll', this.onScrollInitializer);

            this.onScrollInitializer = handler;

            $window.on('scroll', this.onScrollInitializer);
        }


        emitCustomEvent('ecosystems-tab-loaded', {
            tabId: $content[0].id,
        });
    },
    init: function (context) {
        context = context || document;
        var self = this;

        $('.st-ecosystem', context).each(function () {
            self.enable($(this));
        });

        if($('.st-ecosystem').length == 1){
        	$("[data-page-content='1']").append($("#recommended-for-you").closest("[class*='st-container']"));
        	$("[data-page-content='1'] [class*='st-container']:nth-child(3)").after($(".st-ecosystem").closest("[class*='st-container']"));
        }
        
    }
};

$(function () {
    STFED.ecosystem.init();
});

// tabs logic
$(document).ready(function () {
    $(function () {
        var locale = $('meta[name=Content-Language]').attr('content') || 'en';

        function initTrainings() {
            var $trainingsTab = $('.js-eco-trainings');
            if (!$trainingsTab.length) {
                return;
            }

            var $upcomingEvents = $('.js-eco-trainings-upcoming-events', $trainingsTab);
            var $pastWebinars = $('.js-eco-trainings-past-webinars', $trainingsTab);

            load($upcomingEvents, parseEventsToHTML);
            load($pastWebinars, parseWebinarsToHTML);
        }

        function load($block, parseFn) {
            var url = $block.data('load-address');
            if (!url) {
                return;
            }

            var $wrapper = $('.eco-trainings-wrapper', $block);
            if ($wrapper.hasClass(STFED.ecosystem.contentLoadingClass) || $wrapper.hasClass(STFED.ecosystem.contentLoadedClass)) {
                return;
            }

            var $spinner = $('<div class="st-loading-spinner" />');

            $wrapper.addClass(STFED.ecosystem.contentLoadingClass).append($spinner);

            $.get(url + '?locale=' + locale)
                .then(function (json) {
                    $wrapper.addClass(STFED.ecosystem.contentLoadedClass);
                    var elements = parseFn(json);
                    $wrapper.append(elements.join(''));
                })
                .fail(function (error) {
                    console.error(error);
                })
                .always(function () {
                    $wrapper.removeClass(STFED.ecosystem.contentLoadingClass);
                    $spinner.remove();
                });
        }

        function parseEventsToHTML(json) {
            var allEvents = _.values(json);
            if(typeof stm32EcosystemPage !== "undefined"){
                allEvents = allEvents.filter(function (event) {
                	if(typeof stm32EcosystemPage.parentFamilyName !== "undefined"){
                		if(event.tags.includes(stm32EcosystemPage.parentFamilyName)){
                            return event;    
                        }
                	}
                    
                })
            }
            var lastEvents = allEvents
                .slice()
                .sort(function (a, b) {
                    if (a.startdate > b.startdate) {
                        return -1;
                    } else if (a.startdate < b.startdate) {
                        return 1;
                    }
                    return 0;
                })
                .slice(0, 4);

            return lastEvents.map(function (item) {
                var date = getEventDate(new Date(item.startdate), new Date(item.enddate));
                var place = (item.city ? (item.city) : '');
                place += (place ? ', ' : '') + (item.country ? item.country : '');
                place = place ? (' | ' + place) : '';

                // @formatter:off
                return '' +
                    '<p class="st-font-size--s">' +
                        (item.online ? '<span class="st-marker">ONLINE</span>' : '') +
                        '<a class="st-font--bold" href="' + item.detailPagePath + '" target="_blank">' +
                            item.eventTitle +
                        '</a> ' +
                        date + (item.online ? '' : place) +
                    '</p>';
                // @formatter:on
            });

            function getEventDate(startDate, endDate) {
                var startDay = new Intl.DateTimeFormat(locale, {
                    day: '2-digit',
                }).format(startDate);

                var endDay = new Intl.DateTimeFormat(locale, {
                    day: 'numeric',
                }).format(endDate);

                var startMonth = new Intl.DateTimeFormat(locale, {
                    month: 'short',
                }).format(startDate);

                var endMonth = new Intl.DateTimeFormat(locale, {
                    month: 'short',
                }).format(endDate);

                var startYear = new Intl.DateTimeFormat(locale, {
                    year: locale == 'ja' ? 'numeric' : '2-digit',
                }).format(startDate);

                var endYear = new Intl.DateTimeFormat(locale, {
                    year: locale == 'ja' ? 'numeric' : '2-digit',
                }).format(endDate);

                if(locale == 'ja'){
                	return startYear + ' ' + startMonth + ' ' + startDay + ' - ' + endYear + ' ' + endMonth + ' ' + endDay;
                } else {
                	return startDay + ' ' + startMonth + ' ' + startYear + ' - ' + endDay + ' ' + endMonth + ' ' + endYear;
                }
            }
        }

        function parseWebinarsToHTML(json) {
            var allEvents = _.values(json);
            var lastWebinars = allEvents
            if(typeof stm32EcosystemPage !== "undefined"){
                allEvents = allEvents.filter(function (event) {
                	if(typeof stm32EcosystemPage.parentFamilyName !== "undefined"){
                		if(event.tags.includes(stm32EcosystemPage.parentFamilyName)){
                            return event;    
                        }
                	}
                    
                })
            }
            var lastWebinars = allEvents
                .slice()
                .filter(function (item) {
                    return item.eventType === 'Webinars';
                })
                .sort(function (a, b) {
                    if (a.enddate > b.enddate) {
                        return -1;
                    } else if (a.enddate < b.enddate) {
                        return 1;
                    }
                    return 0;
                })
                .slice(0, 4);

            return lastWebinars.map(function (item) {
                var date = getWebinarDate(new Date(item.enddate));
                var isSquare = Boolean(item.sessionsnumber && item.sessionsnumber > 1);

                // @formatter:off
                    return '' +
                        '<p class="st-font-size--s">\n'+
                            '<svg class="st-svg st-svg--playbutton-blue st-svg-valign--text-bottom">\n'+
                                '<use xlink:href="#icon-playbutton-blue' + (isSquare ? '-square' : '') + '"></use>\n'+
                            '</svg>\n'+
                            '<a class="st-font--bold" href="' + item.detailPagePath + '" target="_blank">\n' +
                                item.eventTitle +
                            '</a>\n' +
                            ' ' + date +
                        '</p>\n';
                    // @formatter:on
            });

            function getWebinarDate(date) {
                date.toString();
                return getTimePassed(+date);

                function toUTC(dateTime) {
                    var getUTC = dateTime.getTime();
                    var offset = dateTime.getTimezoneOffset() * 60000;
                    return getUTC - offset;
                }

                function getTimePassed(timeStamp) {
                    var minute = (60 * 1000);
                    var hour = 60 * minute;
                    var day = 24 * hour;

                    var timeFrom = new Date(toUTC(new Date(timeStamp))).getTime();
                    var timeTo = new Date().getTime();

                    var passedTime = timeTo - timeFrom;

                    if (passedTime < hour) {
                        var minutes = Math.round(passedTime / minute);
                        return minutes + ' min ago';
                    } else if (passedTime < day) {
                        var hours = Math.round(passedTime / hour);
                        return hours + (hours === 1 ? 'hour ago' : ' hours ago');
                    } else {
                        var days = Math.round(passedTime / day);
                        return days === 1 ? ('yesterday') : (days + ' days ago');
                    }
                }
            }
        }

        $(document).on('ecosystems-tab-loaded', function (event) {
            var tabId = event.originalEvent.detail.tabId;
            if (tabId === 'step4') {
                initTrainings();
            }
        });
    });
});

$(document).ready(function () {
    (function ($) {
        var isPhone = false;
        var isTablet = false;
        var renderMarkup = _.template(
            '<% _.forEach(sections, function(section) { %>' +
            '<div class="section">' +
            '<div class="caption" data-number="<%= section.number %>"><%= section.caption %></div>' +
            '<div class="item leading"></div>' +
            '<% _.forEach(section.subsections, function(subsection) { %>' +
            '<div class="item subsection"><%= subsection %></div>' +
            '<% }) %>' +
            '<div class="item ending"></div>' +
            '</div>' +
            '<% }) %>'
        );

        function GettingStartedNavigation($container, $element) {
            this.$parentContainer = $container.find('.getting-started');
            this.$container = $container;
            this.$element = $element;
            this.$spacer = $();
            this.topOffset = 0;
            this.top = $element.offset().top;
            this._onToggleExpander = this.onToggleExpander.bind(this);
            this._onScroll = this.update.bind(this);
            this._onResize = _.debounce(this.update.bind(this), 100);
            this._onStepChange = this.onStepChange.bind(this);
            this._onSectionClick = this.onSectionClick.bind(this);
            this._onSubSectionClick = this.onSubSectionClick.bind(this);
            this._onModalOpen = this.onModalOpen.bind(this);
            this._onModalClose = this.onModalClose.bind(this);

            if ($element.hasClass('side-floating')) {
                this.topOffset = 30;
                this.top = $container.offset().top + 50;
            }

            this.generateMarkup();
            this.enable(true);
        }

        GettingStartedNavigation.prototype.generateMarkup = function () {
            var sections = [];
            var section;

            this.$container.find('.step:not(.is-disabled) .step-section, .step:not(.is-disabled) .step-subsection').each(function () {
                var $element = $(this);

                if ($element.is('.step-section')) {
                    section = {
                        number: sections.length + 1,
                        caption: $element.find('.text').html(),
                        subsections: []
                    };
                    sections.push(section);
                } else {
                    section.subsections.push($element.find('.text').html());
                }
            });

            this.$element.find('.content').html(renderMarkup({
                'sections': sections
            }));
            if (this.$element.hasClass('content-floating')) {
                this.$spacer = $('<div class="js-getting-started-navigation-spacer getting-started-navigation-spacer"></div>');
                this.$spacer.insertBefore(this.$element);
            }

            var $mobileModal = this.$element.closest('.getting-started-navigation-mobile');

            if ($mobileModal.length !== 0) {
                this.$element.data('modal', $mobileModal);
                $('body').append($mobileModal);
            }
        };

        GettingStartedNavigation.prototype.enable = function (activate) {
            var $modal = this.$element.data('modal');

            $(window).off('scroll', this._onScroll);
            $(window).off('resize', this._onResize);
            $(document).off('header-left-view header-entered-view', this._onScroll);
            $(document).off('getting-started-navigation-modal', this._onModalOpen);
            this.$element.off('click', '.section', this._onSectionClick);
            this.$element.off('click', '.subsection', this._onSubSectionClick);
            this.$element.off('click', '.expander', this._onToggleExpander);
            this.$container.off('getting-started-step', this._onStepChange);

            if ($modal) {
                $modal.off('click', '.js-close', this._onModalClose);
            }

            if (activate) {
                $(window).on('scroll', this._onScroll);
                $(window).on('resize', this._onResize);
                $(document).on('header-left-view header-entered-view', this._onScroll);
                $(document).on('getting-started-navigation-modal', this._onModalOpen);
                this.$element.on('click', '.section', this._onSectionClick);
                this.$element.on('click', '.subsection', this._onSubSectionClick);
                this.$element.on('click', '.expander', this._onToggleExpander);
                this.$container.on('getting-started-step', this._onStepChange);

                if ($modal) {
                    $modal.on('click', '.js-close', this._onModalClose);
                }
            }

            this.update();
        };

        GettingStartedNavigation.prototype.update = function () {
            var $main = $('main');
            var $header = $('.js-st-header');
            var $headerMobile = $('.js-st-header-mobile');
            var scrolled = window.scrollY;
            var headerOffset = 0;
            var height = this.$element.outerHeight(true);
            var isMobile = false;
            var isSideFloating = this.$element.hasClass('side-floating');

            this.top = this.$element.offset().top;

            if ((isPhone || isTablet) && ($main.hasClass('js-st-header-in-view') || $headerMobile.hasClass('in-view'))) {
                headerOffset = $headerMobile.outerHeight(true);
                isMobile = true;
            } else if (!(isPhone || isTablet) && ($main.hasClass('js-st-header-in-view') || $header.hasClass('in-view'))) {
                headerOffset = $header.outerHeight(true);
                isMobile = false;
            }

            this.$spacer.css('height', height);

            var overscrolled = (scrolled + height + headerOffset) - (this.$container.offset().top + this.$container.height());

            var isHeaderAtTop = parseInt(isMobile ? $headerMobile.css('top') : $header.css('top')) === 0;
            var extraTop = isHeaderAtTop ? (this.top - headerOffset) : this.top;
            var wrapperTopOffset = $('.floating-nav-wrapper')[0].getBoundingClientRect().y || 0;
            var actualTop = 0;

            if (scrolled >= extraTop) {
                this.$element.addClass('is-fixed');
                this.$spacer.addClass('show');
            } else {
                 if (wrapperTopOffset > headerOffset) {
                    this.$element.removeClass('is-fixed');
                    this.$spacer.removeClass('show');
                }
            }

            if (overscrolled > 0) {
                actualTop = -overscrolled + headerOffset;
            } else {
                actualTop = this.topOffset + headerOffset;
            }

            this.$element.css('top', actualTop);

            if (wrapperTopOffset > 0) {
                if (!isSideFloating) {
                    this.$element.css('top', wrapperTopOffset - parseInt(actualTop || headerOffset));
                }
            } else {
                this.$element.css('top', parseInt(actualTop));
            }
        };

        GettingStartedNavigation.prototype.onSectionClick = function (event) {
            var $section = $(event.currentTarget);
            var number = $section.index() + 1;

            if (!$section.is('.active')) {
                this.changeStep($section);
                emitCustomEvent('getting-started-goto', {
                    number: number
                }, this.$parentContainer.get(0));
                this.scrollToSection(number);
            }
        };

        GettingStartedNavigation.prototype.onSubSectionClick = function (event) {
            this.scrollToSection($(event.currentTarget).parent().find('.subsection').index(event.currentTarget) + 1, true);
            this.$element.toggleClass('expanded');
        };

        GettingStartedNavigation.prototype.scrollToSection = function (number, isSubSection) {
            var self = this;
            var $modal = this.$element.data('modal');

            function emit(additionalScroll) {
                emitCustomEvent('getting-started-scrollto', {
                    number: number,
                    additionalScroll: additionalScroll,
                    isSubSection: isSubSection
                }, self.$parentContainer.get(0));
            }

            if (isPhone && $modal) {
                this.closeModal();
                setTimeout(function () {
                    emit(self.$parentContainer.find('.js-getting-started-navigation .expander').height());
                }, 0);
            } else {
                emit();
            }
        };

        GettingStartedNavigation.prototype.onStepChange = function (event) {
            var $sections = this.$element.find('.section');
            var number = event.originalEvent.detail.number;
            var $section = $sections.eq(number - 1);

            this.$element.find('.expander span').html('Step ' + number + ' of ' + $sections.length + ': ' + $section.find('.caption').html());

            this.changeStep($section);
            this.$element.removeClass('expanded');
        };

        GettingStartedNavigation.prototype.onToggleExpander = function (event) {
            if (isPhone) {
                emitCustomEvent('getting-started-navigation-modal');
            } else {
                this.$element.toggleClass('expanded');
            }
        };

        GettingStartedNavigation.prototype.onModalOpen = function (event) {
            if (isPhone) {
                var $modal = this.$element.data('modal');

                if ($modal) {
                    window.emitCustomEvent('body-locked', {
                        savePosition: true
                    });

                    $modal.toggleClass('hidden', false);
                }
            }
        };

        GettingStartedNavigation.prototype.onModalClose = function (event) {
            this.closeModal(true);
        };

        GettingStartedNavigation.prototype.changeStep = function ($section) {
            var $sections = this.$element.find('.section');

            $sections.removeClass('active prev');
            $section.addClass('active').prevAll().addClass('prev').slice(1).addClass('passed');
        };

        GettingStartedNavigation.prototype.closeModal = function (restorePosition) {
            var $modal = this.$element.closest('.getting-started-navigation-mobile');

            window.emitCustomEvent('body-unlocked', {
                'restorePosition': restorePosition
            });

            $modal.toggleClass('hidden', true);
        };

        $(function () {
            function init() {
                $('.js-getting-started-navigation').each(function () {
                    var $element = $(this);
                    var instance = $element.data('nav');
                    var $tab = instance ? instance.$container : $element.closest('[data-page-content]');
                    var isInTab = $tab.is(':visible');

                    $('.off-canvas-wrap').css('overflow-x', 'initial');

                    if ($element.hasClass('is-initialized')) {
                        $element.data('nav').enable(isInTab);
                    } else if (isInTab) {
                        $element.addClass('is-initialized');

                        $element.data('nav', new GettingStartedNavigation($tab, $element));
                    }
                });
            }

            //init();

            enquire.register('screen and (max-width: 1450px)', function () {
                init();
            });

            enquire.register('screen and (min-width: 1450px)', function () {
                init();
            });

            enquire.register(STFED.mediaQueries.smallMax, {
                match: function () {
                    isPhone = true;
                    init();
                },
                unmatch: function () {
                    isPhone = false;
                    init();
                }
            });
            enquire.register(STFED.mediaQueries.mediumMax, {
                match: function () {
                    isTablet = true;
                    init();
                },
                unmatch: function () {
                    isTablet = false;
                    init();
                }
            });

            $(document).on('become-visible tabs-were-displayed', function (event) {
                init();
            });
        });
    })(jQuery);
});

$(document).ready(function () {
    (function ($) {
        var STFED = window.STFED || {};

        STFED.gettingStarted = {
            stepHiddenClass: 'is-hidden',
            activateStep: function ($step, $container, noScroll) {
                var selector = '.step:not(.is-disabled)';
                var $steps = $container.find(selector);

                $steps.addClass(this.stepHiddenClass);
                $step.removeClass(this.stepHiddenClass);

                var $buttons = $container.find('.page-bottom-buttons');
                var $prevStep = $step.prev(selector);
                var $nextStep = $step.next(selector);

                $buttons.toggleClass('has-left-button', $prevStep.length > 0);
                $buttons.toggleClass('has-right-button', $nextStep.length > 0);

                if ($prevStep.length > 0) {
                    $buttons.find('.left-button span').html($prevStep.find('.step-section .text').html());
                }
                if ($nextStep.length > 0) {
                    $buttons.find('.right-button span').html($nextStep.find('.step-section .text').html());
                }

                this.initComponents($step);

                emitCustomEvent('getting-started-step', {
                    number: $step.attr('data-number')
                }, $container.get(0));
            },
            enable: function ($container) {
                var self = this;
                var selector = '.step:not(.is-disabled)';
                var $buttons = $container.find('.page-bottom-buttons');
                var isContainerEnabled = $container.hasClass("js-getting-started-container-enabled")
                var $steps = $container.find(selector).map(function (i, el) {
                    return $(this).attr('data-number', i + 1).get(0);
                });
                var $firstStep = $steps.filter(':not(.is-hidden)').first();
                if (!isContainerEnabled) {
                    $steps.each(function () {
                        var $step = $(this);

                        $step.find('.step-section').each(function (i) {
                            $(this).prepend($('<span>' + $step.attr('data-number') + '. </span>'));
                        });

                        $step.find('.step-subsection').each(function (i) {
                            $(this).prepend($('<span>' + $step.attr('data-number') + '.' + (i + 1) + '. </span>'));
                        });
                    });

                    this.activateStep($firstStep, $container);

                    $buttons.on('click', '.left-button, .right-button', function (e) {
                        e.preventDefault();

                        var $button = $(this);
                        var $currentStep = $steps.filter(':not(.is-hidden)').first();
                        var $step = $button.is('.left-button') ? $currentStep.prev(selector) : $currentStep.next(selector);

                        self.activateStep($step, $container);
                        emitCustomEvent('getting-started-scrollto', {
                            number: $step.attr('data-number')
                        }, $container.get(0));
                    });

                    $(document).on('tabs-were-displayed', function (event) {
                        self.activateStep($firstStep, $container);
                    });

                    $container.on('getting-started-goto', function (event) {
                        self.activateStep($steps.filter('[data-number="' + event.originalEvent.detail.number + '"]'), $container);
                    });

                    $container.on('getting-started-scrollto', function (event) {
                        var $currentStep = $steps.filter(':not(.is-hidden)').first();
                        var additionalScroll = event.originalEvent.detail.additionalScroll || 0;
                        var offset = 0;

                        if (event.originalEvent.detail.isSubSection) {
                            offset = $currentStep.find('.step-subsection').eq(event.originalEvent.detail.number - 1).offset().top;
                        } else {
                            offset = $container.find('.step[data-number="' + event.originalEvent.detail.number + '"]').offset().top;
                        }

                        if (window.scrollY > offset) {
                            offset = Math.max(0, offset - self.getHeaderHeight());
                        }

                        if ($('.js-getting-started-navigation.side-floating').is(':visible')) {
                            additionalScroll += 30;
                        }
                        if ($('.js-getting-started-navigation.content-floating').is(':visible')) {
                            additionalScroll += $('.js-getting-started-navigation.content-floating .expander').height() + 10;
                        }

                        $('html, body').animate({
                            scrollTop: offset - additionalScroll
                        }, 300);
                    });
                    $container.addClass("js-getting-started-container-enabled")
                }
            },
            initTabletSlider: function ($element) {
                if ($element.isVisibleInViewport()) {
                    $element.addClass('is-initialized');

                    var options = {
                        variableWidth: true,
                        infinite: false,
                        focusOnSelect: false,
                        dots: true,
                        arrows: false,
                        outerEdgeLimit: true,
                        responsive: [
                            {
                                breakpoint: Infinity,
                                settings: 'unslick'
                            },
                            {
                                breakpoint: STFED.breakpoint.mediumMax,
                                settings: {}
                            }
                        ]
                    };

                    enquire.register(STFED.mediaQueries.mediumMax, {
                        match: function () {
                            $element.slick(options);
                        },
                        unmatch: function () {
                        }
                    });

                    return true;
                }

                return false;
            },
            initComponents: function ($content) {
                var self = this;
                var initializers = [];

                $content.find('.js-tablet-slider:not(.is-initialized)').each(function () {
                    var $element = $(this);

                    if (!self.initTabletSlider($element)) {
                        initializers.push(function () {
                            return self.initTabletSlider($element);
                        });
                    }
                });

                if (initializers.length > 0) {
                    var $window = $(window);

                    var handler = function () {
                        initializers.forEach(function (initializer) {
                            if (initializer()) {
                                initializers.splice(initializers.indexOf(initializer), 1);
                            }
                        });

                        if (initializers.length === 0) {
                            $window.off('scroll', handler);
                        }
                    };

                    $window.off('scroll', this.onScrollInitializer);

                    this.onScrollInitializer = handler;

                    $window.on('scroll', this.onScrollInitializer);
                }
            },
            getHeaderHeight: function () {
                var $header = $('header.js-st-header');
                var $mobileHeader = $('header.js-st-header-mobile');

                return $header.is(':visible') ? $header.outerHeight(true) : $mobileHeader.outerHeight(true);
            },
            init: function (context) {
                context = context || document;
                var self = this;

                $('.getting-started', context).each(function () {
                    var $container = $(this);
                    var $tab = $(this).closest('[data-page-content]');
                    var isInTab = $tab.is(':visible');

                    if (isInTab) {
                        self.enable($container);
                    }

                    $(document).on('become-visible', function () {
                        self.enable($container);
                    });
                });
            }
        };

        $(function () {
            STFED.gettingStarted.init();
        });
    })(jQuery);
});
(function ($) {
    var isPhone = false;
    var phoneBreakpointCallbacks = $.Callbacks();

    enquire.register(STFED.mediaQueries.smallMax, {
        match: function() {
            isPhone = true;
            phoneBreakpointCallbacks.fire();
        },
        unmatch: function() {
            isPhone = false;
        }
    });

    $.fn.viewGallery = function () {
        this.each(function () {
            var $element = $(this);
            var image = this.querySelector('.view img');
            var $thumbnails = $element.find('.view-thumbnails');
            var initSlick = function () {
                $thumbnails.slick({
                    initialSlide: $thumbnails.children('.active').first().index(),
                    variableWidth: true,
                    infinite: false,
                    focusOnSelect: false,
                    dots: true,
                    arrows: false,
                    outerEdgeLimit: true,
                    responsive: [
                        {
                            breakpoint: Infinity,
                            settings: 'unslick'
                        },
                        {
                            breakpoint: STFED.breakpoint.smallMax,
                            settings: {
                            }
                        }
                    ]
                });

                $thumbnails.on('afterChange', function (event, slick, currentSlide) {
                    slick.$slides.eq(currentSlide).addClass('active').siblings().removeClass('active');
                });
            };

            $element.addClass('is-initialized');

            $thumbnails.children().first().addClass('active');

            $thumbnails.on('click', 'a', function (event) {
               event.preventDefault();

               if (!isPhone) {
                   image.src = this.querySelector('img').src;
               }

               $(this).addClass('active').siblings().removeClass('active');
            });

            if (isPhone) {
                initSlick();
            }

            phoneBreakpointCallbacks.add(initSlick);
        });

        return this;
    };

    $(function () {
        var selector = '.js-view-gallery';

        function init() {
            $(selector + ':not(.is-initialized)').each(function () {
                $(this).viewGallery();
            });
        }

        init();

        $(document).on('become-visible', function (event) {
            init();
        });
    });
})(jQuery);

(function ($) {
    function initPeriodSelect($wrapper) {
        var $select = $wrapper.find('select');
        
        $wrapper.addClass('is-initialized');
        $select.removeAttr('disabled').selectric({
            arrowButtonMarkup: ''
        });        
    }

    function init() {
        $('.js-events-tiles').each(function () {
            initPeriodSelect($(this).find('.js-period-select'));
        });
    }

    $(function () {
        init();
    });
})(jQuery);

(function ($) {
    STFED.Events = STFED.Events || {Events: {}};
    STFED.LearningResults = STFED.LearningResults || {Results: {}};
    STFED.LearningResults.loadedResults = STFED.LearningResults.loadedResults || {};
    var locale = $('meta[name=Content-Language]').attr("content") || "en";

    STFED.Events.loadUpcomingEvents = function (dataURL, renderEventsCallback, tableName) {
        return loadEvents(dataURL, renderEventsCallback, tableName, true);
    };
    STFED.Events.loadPastEvents = function (dataURL, renderEventsCallback, tableName) {
        return loadEvents(dataURL, renderEventsCallback, tableName, false);
    };

    function loadEvents(dataURL, renderEventsCallback, tableName, isUpcomingEvents) {
        return $.ajax(dataURL).done(function (eventsJSON) {
            var parsedEvents = parseEvents(eventsJSON, isUpcomingEvents);
            setSeoEvents(parsedEvents);
            renderEventsCallback(parsedEvents);

            STFED.LearningResults.loadedResults[tableName] = parsedEvents;
            emitCustomEvent('learning-results-changed', {
                tableName: tableName,
                mode: isUpcomingEvents ? "upcoming" : "past"
            });
        });
    }

    function setSeoEvents(parsedEvents) {
        console.log(parsedEvents);
        parsedEvents.forEach(function(event) {
            var script = document.createElement('script');
            script.setAttribute('type', 'application/ld+json');
            structuredDataText = {"@context": "https://schema.org",
             "@type" : "Event"
             };
            structuredDataText.eventStatus = "https://schema.org/EventScheduled";
            if(event.online == true) {
                structuredDataText.eventAttendanceMode = "https://schema.org/OnlineEventAttendanceMode";
            } else {
                structuredDataText.eventAttendanceMode = "https://schema.org/OfflineEventAttendanceMode";
            }
            if(event.description != null) {
                structuredDataText.name = event.description;
                structuredDataText.description = event.description;
            }
            if(event.eventImagePath != null) {
                structuredDataText.image = event.eventImagePath;
            }
            structuredDataText.startDate = event.startdate;
            structuredDataText.endDate = event.enddate;
            structuredDataText.organizer = event.organizer;
            var organization = {"@type" : "Organization"};
            organization.name = event.organizer;
            organization.alternateName = "ST";
            organization.description = event.description
            organization.logo = "https://www.st.com/etc/clientlibs/st-site-cx/media/app/images/st-logo.svg";
            //TO DO. Add data to the json
            organization.url = "";
            organization.sameAs = ["https://en.wikipedia.org/wiki/STMicroelectronics", "https://twitter.com/st_world", "https://www.facebook.com/STMicroelectronics.NV",
            "https://www.linkedin.com/company/stmicroelectronics", "https://www.youtube.com/user/STonlineMedia", "https://www.instagram.com/stmicroelectronics.nv/"];
            structuredDataText.performer = organization;
            var offers = {"@type" : "Offer"}
            //TO DO. Add data to the json
            offers.url = "";
            offers.price = "0";
            offers.priceCurrency = "USD";
            //TO DO. Add data to the json
            offers.validFrom = "";
            offers.availability = "http://schema.org/InStock";
            structuredDataText.offers = offers;
            structuredDataText.location = event.location;
            script.textContent = JSON.stringify(structuredDataText);
            console.log(structuredDataText);
            document.head.appendChild(script);
        });
    }

    function parseEvents(eventsJSON, isUpcomingEvents) {
        var eventsArray = _.values(eventsJSON);
        var eventsTable = _.map(eventsArray, function (eventObject) {
            return composeEventRowData(
                _.assign(
                    {
                        isUpcomingEvents: isUpcomingEvents,
                    },
                    eventObject
                )
            );
        });
        eventsTable = _.sortBy(eventsTable, function (eventObject) {
            return eventObject.startDate.getTime();
        });
        if (!isUpcomingEvents) {
            eventsTable = _.reverse(eventsTable);
        }
        return eventsTable;
    }

    function composeEventRowData(eventObject) {
        var startDate = new Date(eventObject.startdate);
        var endDate = new Date(eventObject.enddate);

        var location = [eventObject.region, eventObject.country, eventObject.city]
            .filter(function (el) {
                return el;
            })
            .join(", ");

        return _.assign(
            {
                title: eventObject.eventTitle,
                isUpcomingEvents: eventObject.isUpcomingEvents,
                startDate: startDate,
                endDate: endDate,
                eventDateString: composeEventDateString(startDate, endDate, eventObject.showtime, eventObject.isUpcomingEvents),
                groupId: composeGroupID(startDate),
                location: location
            },
            eventObject
        );
    }

    function composeEventDateString(startDate, endDate, showtime, isUpcomingEvents) {
        var startDayOfMonth = new Intl.DateTimeFormat(locale, {
            day: "numeric",
        }).format(startDate);

        var endDayOfMonth = new Intl.DateTimeFormat(locale, {
            day: "numeric",
        }).format(endDate);

        var startMonthStr = new Intl.DateTimeFormat(locale, {
            month: "short",
        }).format(startDate);

        var endMonthStr = new Intl.DateTimeFormat(locale, {
            month: "short",
        }).format(endDate);

        var startTimeHour = new Intl.DateTimeFormat(locale, {
            hour: "numeric",
            minute: "2-digit",
            hour12: true,
        }).format(startDate);

        var endTimeHour = new Intl.DateTimeFormat(locale, {
            hour: "numeric",
            minute: "2-digit",
            hour12: true,
        }).format(endDate);

        var timeZone = new Date(startDate).getTimezoneOffset();
        timeZone = 'GMT' + (timeZone > 0 ? '-' : '+') + Math.abs(timeZone / 60);
        endTimeHour += ' (' + timeZone + ')';

        var isOneDayEvent = endDate.toDateString() === startDate.toDateString();
        var isSameMonth = endDate.getMonth() === startDate.getMonth();

        var eventDateStr = "";

        var isChinesePage = (document.documentElement.lang === "zh");

        if (isOneDayEvent) {
            //For china convention is mm/dd
            var dayAndMonth;

            if(isChinesePage)
                dayAndMonth = startMonthStr + " " + startDayOfMonth;
            else
                dayAndMonth = startDayOfMonth + " " + startMonthStr;

            eventDateStr = dayAndMonth +
                (isUpcomingEvents ? (showtime ? " at " + startTimeHour + " - " + endTimeHour : "") : (", " + startDate.getFullYear()));



        } else if (isSameMonth) {
            if(isChinesePage)
                eventDateStr =
                    startMonthStr + " " + startDayOfMonth + " - " + endDayOfMonth +
                    (isUpcomingEvents ? (showtime ? " " + startTimeHour + " - " + endTimeHour : "") : (", " + startDate.getFullYear()));
            else
                eventDateStr =
                    startDayOfMonth + " - " + endDayOfMonth + " " + startMonthStr +
                    (isUpcomingEvents ? (showtime ? " at " + startTimeHour + " - " + endTimeHour : "") : (", " + startDate.getFullYear()));
        } else {
            var startDayAndMonth, endDayAndMonth;

            //For china convention is mm/dd
            if(isChinesePage){
                startDayAndMonth = startMonthStr + " " + startDayOfMonth;
                endDayAndMonth =  endMonthStr + " " + endDayOfMonth;
            }
            else{
                startDayAndMonth = startDayOfMonth + " " + startMonthStr;
                endDayAndMonth =  endDayOfMonth + " " + endMonthStr;
            }


            eventDateStr =
                startDayAndMonth +
                " - " +
                endDayAndMonth +
                (isUpcomingEvents ? "" : ", " + startDate.getFullYear());
        }
        return eventDateStr;
    }

    function composeGroupID(startDate) {
        var monthAndYear = new Intl.DateTimeFormat(locale, {
            month: "long",
            year: "numeric",
        }).format(startDate);
        return monthAndYear;
    }
})(jQuery);

(function ($) {

    var timeColumn = _.template(
        `<td class="tile-info">
            <div class="item">
                <svg class="st-svg st-svg-color--dark-blue calendar">
                    <use xlink:href="#icon-events-date"></use>
                </svg>
                <span><%- event.eventDateString  %></span>
            </div>
            <% if (event.sessionsnumber > 1) { %><div class="item-add">+ <%- event.sessionsnumber %> sessions</div><%}  %>
            <div class="item">
                <% if (event.online || event.location) { %>
                <svg class="st-svg st-svg-color--dark-blue <%- event.online?" antenna":" gps" %>">
                    <use xlink:href="#icon-events-<%-event.online?"online":"location" %>"></use>
                </svg>
                <% } %>
                <span><%- event.online? "Online": event.location %></span>
            </div>
        </td>`
    );

    var detailsColumn = _.template(
        `<td class="tile-details">
            <div class="wrapper <%- event.featured ? " featured":" " %>">
                <div class="wrapper-content">
                    <div class="title item">
                        <% if (event.featured) { %> <span class="featured">Featured</span> <%}  %>
                        <h3>
                           <a class="st-link st-font-size--l" onclick="s_objectID=\'<% if (event.featured) { %>Featured - <%}  %><%- event.eventTitle %>\';" href="<%- event.detailPagePath %>" target="_blank"><%- event.eventTitle %></a>
                        </h3>
                    </div>
                    <% if (event.description) { %> <div class="desc item"><%- event.description %></div><%}%>
                    <div class="tags item">
                        <% if (event.organizedByST) {%>
                            <svg class="st-svg st-svg-color--dark-blue">
                                <use xlink:href="#icon-st-logo"></use>
                            </svg>
                        <%} %>
                        <span class="strong"><%- event.organizer %></span>
                        <% if (event.eventType) {%>
                            <span class="strong"><%- Granite.I18n.get(event.eventType, null, 'events') || event.eventType %></span>
                        <%} %>
                        <% if (event.language) {%>
                            <span class="strong"><%- Granite.I18n.get(event.language, null, 'events') || event.language %></span>
                        <%} %>
                    </div>
                </div>
                <% if (event.eventImagePath) {%><img class="side-image" src="<%- event.eventImagePath %>" alt="<%- event.eventTitle %>"><%} %>
            </div>
        </td>`
    );

    var columnDefs = [
        {
            targets: 0,
            data: null,
            className: "tile-info",
            render: function (data, type, row, meta) {
                return timeColumn({event: data});
            },
        },
        {
            targets: 1,
            data: null,
            className: "tile-details",
            render: function (data, type, row, meta) {
                return detailsColumn({event: data});
            },
        },
    ];

    var resultsPerPage = 10;

    $(function () {
        $(".js-events-table-2").each(function () {
            var $table = $(this);
            var dataURL = $table.data("learning-results");
            var isUpcoming = $table.hasClass("upcoming");

            var $periodFilter = $('.js-period-select').find('select');
            var $tableInfo = $table.siblings('.table-info');

            var $summary = $table.siblings('.summary');
            var $loadMoreBtn = $summary.find('.summary__btn');
            resultsPerPage = $table.data('results-per-page') || resultsPerPage;
            var tableName = $table.data('learning-table-name') || 'events' + (isUpcoming ? 'Upcoming' : 'Past');
            var lastParsedResults;
            var paging = new Paging(!!$loadMoreBtn.length);

            var spinner = getSpinner();
            spinner.add();

            initPeriodSelect();

            dataURL = dataURL + '.' + ($('meta[name=Content-Language]').attr("content") || "en") + '.';
            var csrfToken = STUtils.getCsrfToken();
            dataURL = csrfToken ? dataURL + '?rand=' + Date.now() : dataURL + 'json';

            if (window.location.search.includes('prod=true')) {
                if (dataURL.includes('?')) {
                    dataURL += '&prod=true';
                } else {
                    dataURL += '?prod=true';
                }
            }

            if (isUpcoming) {
                STFED.Events.loadUpcomingEvents(dataURL, renderEventsCallback, tableName)
                    .always(spinner.remove);
            } else {
                STFED.Events.loadPastEvents(dataURL, renderEventsCallback, tableName)
                    .always(spinner.remove);
            }

            $loadMoreBtn.on('click', function () {
                paging.currentPage++;
                loadEvents();
            });

            $periodFilter.on('change', function () {
                paging.pastDays = $periodFilter.val();
                paging.resetCurrentPage();
                loadEvents();
            });

            function getSpinner() {
                var $wrapper = $table.parent();

                var $spinner = $('<div class="st-loading-spinner" />');

                var spinner = {
                    $element: $spinner,
                    add: function() {
                        if ($wrapper.hasClass('loading') || $wrapper.hasClass('loaded')) {
                            return;
                        }
                        $wrapper.addClass('loading').append($spinner);
                    },
                    remove: function() {
                        $wrapper.removeClass('loading').addClass('loaded');
                        $spinner.remove();
                    }
                }
                return spinner;
            }

            function loadEvents() {
                $table.DataTable().clear().destroy();
                renderEventsCallback();
            }

            function initPeriodSelect() {
                var $wrapper = $periodFilter.parent('.select-wrapper');

                $wrapper.addClass('is-initialized');
                $periodFilter.removeAttr('disabled').selectric({
                    arrowButtonMarkup: ''
                });
            }

            function renderEventsCallback(parsedResults) {
                parsedResults = parsedResults || lastParsedResults;

                if (!$.fn.DataTable.isDataTable($table)) {
                    var currentCount;
                    var countForPeriod;
                    var allCount;

                    lastParsedResults = parsedResults.slice();
                    allCount = lastParsedResults.length;

                    var dateOffset = (24 * 60 * 60 * 1000) * paging.pastDays;
                    var periodBeginning = new Date().getTime() - dateOffset;
                    var dataForPeriod = (isUpcoming)
                        ? lastParsedResults
                        : lastParsedResults.filter(function (row) {
                            return row.startDate.getTime() > periodBeginning;
                        });
                    countForPeriod = dataForPeriod.length;

                    var dataToDraw = paging.currentPage
                        ? dataForPeriod.slice(0, paging.currentPage * resultsPerPage)
                        : dataForPeriod.slice(0);

                    currentCount = dataToDraw.length;

                    createEventsTable(dataToDraw);
                    styleTableContainer();
                    redrawTable();

                    updateInfo(currentCount, countForPeriod, allCount);
                }
            }

            function redrawTable() {
                $table.DataTable().draw();
            }

            function createEventsTable(data) {
                var aaRegion = $table.data('activitymap-region') || 'Events list';
                var emptyTableTranslation = Granite.I18n.get('No data available in table', null, 'events') || 'No data available in table';
                $table.DataTable({
                    data: data,
                    paging: false,
                    ordering: false,
                    info: false,
                    searching: false,
                    columnDefs: columnDefs,
                    autoWidth: false,
                    createdRow: onCreateRow,
                    drawCallback: isUpcoming && drawGroupHeaders,
                    language: {
                        "emptyTable": emptyTableTranslation
                    }
                });
                $table.children('tbody').attr('id', aaRegion);
            }

            function styleTableContainer() {
                $($table.DataTable().table().container()).addClass(
                    "events-tiles"
                );
            }

            function onCreateRow(row, data, index) {
                $(row).addClass("event-row");
            }

            function drawGroupHeaders(settings) {
                var api = this.api();
                var rows = api.rows({page: "current"}).nodes();
                var last = null;
                api.column(0, {page: "current"})
                    .data()
                    .each(function (columnData, i) {
                        if (last !== columnData.groupId) {
                            $(rows)
                                .eq(i)
                                .before(
                                    '<tr class="tile-group">' +
                                        '<td colspan="2">' +
                                            '<h2 class="st-font-size--l">' +
                                                columnData.groupId +
                                            '</h2>' +
                                        '</td>' +
                                    '</tr>'
                                );
                            last = columnData.groupId;
                        }
                    });
            }

            function updateInfo(currentCount, countForPeriod, allCount) {
                updateTableInfo(allCount);
                updateSummary(currentCount, countForPeriod, allCount);

                function updateTableInfo(count) {
                    var totalEntriesSentence = Granite.I18n.get(' total entries', null, 'events') || ' total entries';
                    if (count) {
                        var $count = $tableInfo.find('.count');
                        $count.text(count + totalEntriesSentence);
                    }
                }

                function updateSummary(count, countForPeriod, allCount) {
                    var info = $summary.find('.summary__info');
                    var spacedOfLabel = Granite.I18n.get(' of ', null, 'events') || ' of ';
                    var upcomingLabel = Granite.I18n.get('upcoming', null, 'events') || 'upcoming';
                    var pastLabel = Granite.I18n.get('past', null, 'events') || 'past';
                    var restOfInfoSentence = Granite.I18n.get(' events, seminars & webinars are shown', null, 'events') || ' events, seminars & webinars are shown';

                    info.text(count + spacedOfLabel + allCount + '' + (isUpcoming ? upcomingLabel : pastLabel) + restOfInfoSentence);

                    if (!count
                        || !allCount
                        || !countForPeriod
                        || count === countForPeriod
                        || count === allCount) {
                        $loadMoreBtn.addClass('hidden');
                    } else {
                        $loadMoreBtn.removeClass('hidden');
                    }
                }
            }

            $(window).on('update-learning-results-table', function (res) {
                paging.resetCurrentPage();
                var details = res.originalEvent.detail;
                $table.DataTable().clear().destroy();
                renderEventsCallback(details.data);
            });
        });
    });

    function Paging(hasPaging) {
        var paging = {
            currentPage: hasPaging ? 1 : 0,
            pastDays: 30,
        };
        paging.resetCurrentPage = function () {
            paging.currentPage = hasPaging ? 1 : 0;
        };

        return paging;
    }
})(jQuery);

(function ($) {
    $(function () {
        function init() {
            $('.js-explore-list:not(.is-initialized)').each(function () {
                var $component = $(this);

                $component.addClass('is-initialized');

                $component.find('.list-title').each(function () {
                    var $item = $(this);
                    var $content = $item.next('.list-content');

                    if ($content.length === 0) {
                        $content = $('<div class="st-explore-list-l1 content list-content">');
                        $content.insertAfter($item);
                    }

                    if ($content.children().length === 0) {
                        $component.append($item.add($content));
                    }
                });

                var desktopColumn = 1;
                var desktopRow = 0;
                var tabletColumn = 1;
                var tabletRow = 0;

                $component.find('.list-title').each(function (idx) {
                    var currentDesktopRow = desktopRow * 2 + 1;
                    var currentTabletRow = tabletRow * 2 + 1;

                    var titleStyle = this.style;

                    titleStyle.setProperty('--grid-column-lg', desktopColumn);
                    titleStyle.setProperty('--grid-row-lg', currentDesktopRow);
                    titleStyle.setProperty('--grid-column-md', tabletColumn);
                    titleStyle.setProperty('--grid-row-md', currentTabletRow);

                    var contentStyle = $(this).next('.list-content').get(0).style;

                    contentStyle.setProperty('--grid-column-lg', desktopColumn);
                    contentStyle.setProperty('--grid-row-lg', currentDesktopRow + 1);
                    contentStyle.setProperty('--grid-column-md', tabletColumn);
                    contentStyle.setProperty('--grid-row-md', currentTabletRow + 1);

                    desktopColumn++;
                    tabletColumn++;

                    if (desktopColumn > 3) {
                        desktopRow++;
                        desktopColumn = 1;
                    }
                    if (tabletColumn > 2) {
                        tabletRow++;
                        tabletColumn = 1;
                    }
                });
            });
        }

        init();

        $(document).on('become-visible', function () {
            init();
        });
    });
})(jQuery);

(function ($) {
    var dataInited = {};    // needed for tabs, data should be initialized one time

    // update count of suitable objects for each filter
    // mutate filtersData
    // (resultRow: object, filtersData: FiltersData) => void
    var updateFiltersData;
    // check filter value (checkbox), if it is available for one row
    // (resultRow: object,
    //  filterType: string,
    //  filter: string,
    //  togglers: [{togglerName: boolean}]) => boolean
    var isFilterAvailable;
    // check result row, if it fits for filter
    // (resultRow: object,
    //  filterType: string,
    //  value: object (string) resultRow checked for this value,
    //  mainValue: object? (string), used for subFilters to check as value
    // ) => boolean
    var checkByType;
    // check result row, if it fits for toggler
    // (resultRow: object, togglerType: string, togglerValue: boolean) => boolean
    var checkByToggler;

    function init() {
        //#region filter dependent code
        var filtersType;
        var $table = $('.learning-results-table');
        if (!$table || !$table.length) {
            return;
        }
        if ($table.hasClass('past')) {
            filtersType = 'eventsPast';
        } else if ($table.hasClass('upcoming')) {
            filtersType = 'eventsUpcoming';
        } else if ($table.hasClass('partners')) {
            filtersType = 'partners';
        } else {
            filtersType = 'learning';
        }

        if (filtersType === 'learning') {
            updateFiltersData = function (result, filtersData, noSubs) {
                var catalog = result.catalog;
                var category = result.category;
                var type = result.type;
                var level = result.level;
                var languages = result.languages;
                var supplier = result.supplier;
                var isTraining = result['st-trainings'];
                var ST_TRAININGS = 'ST trainings';

                if (filtersData.topics) {
                    if (!noSubs || !noSubs.topics) {
                        if (!filtersData.topics[catalog]) {
                            filtersData.topics[catalog] = {count: 0};
                        }
                        filtersData.topics[catalog].count++;

                        if (category) {
                            if (!filtersData.topics[catalog].subs) {
                                filtersData.topics[catalog].subs = {};
                            }
                            if (!filtersData.topics[catalog].subs[category]) {
                                filtersData.topics[catalog].subs[category] = {count: 0};
                            }
                            filtersData.topics[catalog].subs[category].count++;
                        }
                    } else {
                        if (!filtersData.topics[category]) {
                            filtersData.topics[category] = {count: 0};
                        }
                        filtersData.topics[category].count++;
                    }
                }

                if (filtersData.types) {
                    if (isTraining) {
                        if (!filtersData.types[ST_TRAININGS]) {
                            filtersData.types[ST_TRAININGS] = filtersData.types[ST_TRAININGS] || {subs: {}, count: 0};
                        }
                        if (!filtersData.types[ST_TRAININGS].subs[type]) {
                            filtersData.types[ST_TRAININGS].subs[type] = {count: 0};
                        }
                        filtersData.types[ST_TRAININGS].count++;
                        filtersData.types[ST_TRAININGS].subs[type].count++;
                    } else {
                        if (!filtersData.types[type]) {
                            filtersData.types[type] = {count: 0};
                        }
                        filtersData.types[type].count++;
                    }
                }

                if (filtersData.levels) {
                    if (level) {
                        if (!filtersData.levels[level]) {
                            filtersData.levels[level] = {count: 0};
                        }
                        filtersData.levels[level].count++;
                    }
                }

                if (filtersData.languages) {
                    if (languages) {
                        languages.forEach(function (language) {
                            if (!filtersData.languages[language]) {
                                filtersData.languages[language] = {count: 0};
                            }
                            filtersData.languages[language].count++;
                        });
                    }
                }

                if (filtersData.suppliers) {
                    if (supplier) {
                        if (!filtersData.suppliers[supplier]) {
                            filtersData.suppliers[supplier] = {count: 0};
                        }
                        filtersData.suppliers[supplier].count++;
                    }
                }
            };

            isFilterAvailable = function (resultRow, filterType, filter) {
                var result = true;
                switch (filterType) {
                    case 'topics':
                        result = resultRow.category === filter;
                        break;
                    case 'types':
                        result = resultRow.type === filter;
                        break;
                    case 'levels':
                        result = resultRow.level === filter;
                        break;
                    case 'languages':
                        result = resultRow.languages.includes(filter);
                        break;
                    case 'suppliers':
                        result = resultRow.supplier === filter;
                        break;
                }

                return result;
            };

            checkByType = function (resultRow, filterType, value, mainValue, noSubs) {
                switch (filterType) {
                    case 'topics':
                        if (!noSubs || !noSubs.topics) {
                            return (
                                resultRow.category === value
                                && (mainValue ? resultRow.catalog === mainValue : true)
                            );
                        } else {
                            return resultRow.category === value;
                        }
                    case 'types':
                        return (resultRow.type === value);
                    case 'levels':
                        return (resultRow.level === value);
                    case 'languages':
                        return (resultRow.languages.includes(value));
                    case 'suppliers':
                        return (resultRow.supplier === value);
                }
            };

            checkByToggler = function (resultRow, togglerType, togglerValue) {
                // should there be error or just empty function?
                console.error('There no togglers for learning!');
            };
        } else if (filtersType === 'eventsPast' || filtersType === 'eventsUpcoming') {
            updateFiltersData = function (result, filtersData) {
                var isOnline = result.online;
                var region = result.region;
                var tags = result.tags;
                var type = result.eventType;

                if (filtersData.locations) {
                    if (!isOnline && region) {
                        if (!filtersData.locations[region]) {
                            filtersData.locations[region] = {count: 0};
                        }
                        filtersData.locations[region].count++;
                    }
                }

                if (filtersData.topics) {
                    if (tags.length) {
                        tags.forEach(function (tag) {
                            if (!filtersData.topics[tag]) {
                                filtersData.topics[tag] = {count: 0};
                            }
                            filtersData.topics[tag].count++;
                        });
                    }
                }

                if (filtersData.types) {
                    if (type) {
                        if (!filtersData.types[type]) {
                            filtersData.types[type] = {count: 0};
                        }
                        filtersData.types[type].count++;
                    }
                }
            };

            checkByType = function (resultRow, filterType, value, mainValue) {
                var result;
                switch (filterType) {
                    case 'locations':
                        result = !resultRow.online && resultRow.region === value;
                        break;
                    case 'topics':
                        result = resultRow.tags.includes(value);
                        break;
                    case 'types':
                        result = resultRow.eventType === value;
                        break;
                }

                return result;
            };

            isFilterAvailable = function (resultRow, filterType, value, togglers) {
                var result;
                if (togglers['online'] !== undefined && togglers['online']) {
                    if (!resultRow.online) {
                        result = false;
                    } else {
                        result = check();
                    }
                } else {
                    result = check();
                }

                return result;

                function check() {
                    var r = false;
                    switch (filterType) {
                        case 'locations':
                            r = !resultRow.online && resultRow.region === value;
                            break;
                        case 'topics':
                            r = resultRow.tags.includes(value);
                            break;
                        case 'types':
                            r = resultRow.eventType === value;
                            break;
                    }

                    return r;
                }
            };

            checkByToggler = function (resultRow, togglerType, value) {
                var result;

                switch (togglerType) {
                    // only if toggled should be checked on online
                    case 'online':
                        if (value) {
                            result = resultRow.online === value;
                        } else {
                            result = true;
                        }
                        break;
                }

                return result;
            };
        } else if (filtersType === 'partners') {
            updateFiltersData = function (result, filtersData) {
                var offers = result.products;
                var regions = result.regions;

                if (filtersData.offers) {
                    if (offers) {
                        offers.forEach(function (offer) {
                            if (!filtersData.offers[offer]) {
                                filtersData.offers[offer] = {count: 0};
                            }
                            filtersData.offers[offer].count++;
                        });
                    }
                }

                if (filtersData.regions) {
                    if (regions) {
                        regions.forEach(function (region) {
                            if (!filtersData.regions[region]) {
                                filtersData.regions[region] = {count: 0};
                            }
                            filtersData.regions[region].count++;
                        });
                    }
                }
            };

            isFilterAvailable = function (resultRow, filterType, filter) {
                var result = true;
                switch (filterType) {
                    case 'offers':
                        result = resultRow.products.includes(filter);
                        break;
                    case 'regions':
                        result = resultRow.regions.includes(filter);
                        break;
                }

                return result;
            };

            checkByType = function (resultRow, filterType, value, mainValue) {
                switch (filterType) {
                    case 'offers':
                        return (resultRow.products.includes(value));
                    case 'regions':
                        return (resultRow.regions.includes(value));
                }
            };

            checkByToggler = function (resultRow, togglerType, togglerValue) {
                // should there be error or just empty function?
                console.error('There no togglers for partners!');
            };
        } else {
            return;
        }
        //#endregion

        // { filterType1: resultRow.fieldName1, ... }
        var filtersAndResults = {};
        var MORE_FILTERS = 'MORE_FILTERS';
        var moreFilters = [];

        var $filterBlocks = $('.learning-filters');
        var filtersData = $filterBlocks.data('learning-results');
        var searchPage = $filterBlocks.data('search-page');
        var isFiltersOnly = !(!filtersData || filtersData.length === 0);

        // different logic for clear filters in mobile
        var isMobile;
        setIsMobile();

        var noSubs = {};

        // not tested with several filter blocks
        $filterBlocks.each(function (filterIndex) {
            var $filterBlock = $(this);
            var $filterBoxes = $filterBlock.find('.js-filter-box');
            var filters = {};   // {Filter(), Filter(), ...}
            var togglers = {};  // {togglerName1: state, ...}
            var mobileFilters;
            var originalData = [];
            var filteredData = [];
            var $filterApplyButtons = $filterBlock.find('.js-filter-apply');
            var $checkedLists = $filterBoxes.find('.checked-list');
            var $resetAllBtn = $filterBlock.find('.reset-all');
            var $mobileFiltersButton = $filterBlock.find('.js-mobile-filters');
            var $mobileFiltersModal = $filterBlock.find('.modal-filters');
            var $mobileFiltersModalCloseButton = $mobileFiltersModal.find('.filter-close');
            var $mobileFiltersModalApplyButton = $mobileFiltersModal.find('.tablet-mobile-only > .js-filter-apply');
            var $allCheckBoxesMore = $filterBlock.find('.filter-checkboxes-more');
            var needInteractToURL = $filterBlock.data('url-needed') || false;
            var tableName = $filterBlock.data('learning-table-name') || 'learningResults';
            var $togglers = $filterBlock.find('.st-filter-toggler');

            if (!dataInited[tableName]) {
                dataInited[tableName] = true;
            } else {
                return;
            }

            $filterBoxes.each(function () {
                var $filterBox = $(this);
                var $selectBox = $filterBox.find('.filter-select-box');
                var $selectBoxesMoreMobile = $filterBox.find('.filter-select-box.tablet-mobile-only');
                var $checkBoxArea = $filterBox.find('.filter-checkboxes');
                var $closeButton = $checkBoxArea.find('.filter-close');
                var $resetButton = $filterBox.find('.filter-reset');
                var $filterApplyButton = $checkBoxArea.find('.js-filter-apply');
                var $checkedList = $filterBox.find('.checked-list');
                var filterType = $filterBox.attr('data-type');
                var boxNoSubs = Boolean($filterBox.attr('data-no-subs'));

                if (filterType === MORE_FILTERS) {
                    var $moreSelects = $filterBox.find('.filter-select-box__more');
                    $moreSelects.each(function () {
                        var $moreFilter = $(this);
                        var type = $moreFilter.data('type');

                        updateMoreFilters(type);
                        updateFiltersAndResults(type, $moreFilter);
                        updateFilters(type);
                    });

                    moreFilters.forEach(function (filter) {
                        setCheckedList(filter, $checkedList);
                    });
                } else {
                    updateFiltersAndResults();
                    updateFilters();

                    setCheckedList(filterType, $checkedList);
                }

                if (boxNoSubs) {
                    noSubs[filterType] = boxNoSubs;
                }

                $selectBox.on('click', function (e) {
                    e.stopPropagation();

                    if (isMobile && filterType === MORE_FILTERS) {
                        return;
                    }
                    showHideBox();
                });
                $closeButton.on('click', function () {
                    showHideBox();
                });
                $resetButton.on('click', function (e) {
                    e.stopPropagation();
                    resetFilter();
                });
                $filterApplyButton.on('click', submit);

                $selectBoxesMoreMobile.each(function () {
                    var $selectBoxMoreMobile = $(this);

                    $selectBoxMoreMobile.on('click', function () {
                        var $filterCheckbox = $selectBoxMoreMobile.next('.filter-checkboxes-more');
                        var isExpanded = $filterCheckbox.hasClass('filter-open');

                        hideFilterBoxes();
                        hideMobileMoreFilterBoxes();

                        if (!isExpanded) {
                            $filterCheckbox.addClass('filter-open');
                            $selectBoxMoreMobile.addClass('filter-active');
                            $selectBoxMoreMobile.addClass('mobile-filter-open');
                        }
                    });
                });

                function updateFiltersAndResults(type, $context) {
                    type = type || filterType;
                    $context = $context || $filterBox;

                    if (!filtersAndResults[type]) {
                        filtersAndResults[type] = $context.data('result-field');
                    }
                }

                function updateMoreFilters(type) {
                    if (!moreFilters.includes(type)) {
                        moreFilters.push(type);
                    }
                }

                function updateFilters(type) {
                    type = type || filterType;
                    filters[type] = new Filter();
                }

                function setCheckedList(filterType, $checkedList) {
                    filters[filterType].checkedList = $checkedList;
                }

                function showHideBox() {
                    var isExpanded = $filterBox.hasClass('filter-open');

                    hideFilterBoxes();
                    hideMobileMoreFilterBoxes();

                    if (!isExpanded && (filterType !== MORE_FILTERS || !isMobile)) {
                        updateApplyButtons();
                        openCheckboxes();
                    }

                    function openCheckboxes() {
                        $filterBox.addClass('filter-open');

                        if (filterType === MORE_FILTERS) {
                            moreFilters.forEach(function (filter) {
                                markSingleCheckboxes(filter);
                            });
                        } else {
                            markSingleCheckboxes(filterType);

                            var $mainStCheckboxes = $filterBox.find('.st-checkbox__sub-categories-main');
                            $mainStCheckboxes.each(function () {
                                var $mainStCheckbox = $(this);
                                var $mainCheckbox = $mainStCheckbox.find('input[type="checkbox"]');
                                $mainStCheckbox.prop('checked', false);
                                $mainStCheckbox.removeClass('st-checkbox--half-checked');

                                var $subCategories = $mainStCheckbox.siblings('.sub-category');
                                var all = true;
                                var any = false;
                                $subCategories.each(function () {
                                    var $subCategory = $(this);
                                    var $checkbox = $subCategory.find('input[type="checkbox"]');
                                    if ($checkbox.prop('checked')) {
                                        any = true;
                                    } else {
                                        all = false;
                                    }
                                });
                                if (any && !all) {
                                    $mainStCheckbox.addClass('st-checkbox--half-checked');
                                } else if (all) {
                                    $mainCheckbox.prop('checked', true);
                                }
                            });
                        }
                    }
                }

                function hideFilterBoxes() {
                    $filterBoxes.each(function () {
                        var $filterBox = $(this);
                        $filterBox.removeClass('filter-open');
                    });
                }

                function markSingleCheckboxes(filterType) {
                    var $stCheckboxes = $filterBox.find('.st-checkbox');
                    var $checkboxes = $stCheckboxes.find('input[type="checkbox"]');

                    var thisFilters = isMobile ? mobileFilters : filters;

                    var idsToCheck = thisFilters[filterType].list.map(function (item) {
                        return item.id;
                    });
                    $checkboxes.each(function () {
                        $(this).prop('checked', false);
                    });
                    idsToCheck.forEach(function (id) {
                        var $checkbox = $filterBox.find('#' + id);
                        $checkbox.prop('checked', true);
                    });
                }

                function submit() {
                    updateFilter($filterBox);
                    showHideBox();

                    tryRedirectToSearchPage();
                }

                function resetFilter() {
                    updateFilter($filterBox, true);
                    showHideBox();
                }
            });

            $resetAllBtn.on('click', function () {
                $filterBoxes.each(function () {
                    var $this = $(this);

                    updateFilter($this, true);
                });

                $togglers.each(function () {
                    var $this = $(this);
                    var $button = $this.find('button');
                    $button.attr('data-state', false);
                    var togglerType = $this.data('type');

                    toggleToggler(togglerType, false);
                });

                $mobileFiltersModal.removeClass('show');
            });

            $checkedLists.on('click', function (e) {
                e.stopPropagation();
                e.preventDefault();

                var id = e.target.getAttribute('for');
                var $filterBox = $(e.target).closest('.st-filter-box');
                var type = $filterBox.data('type');

                if (type !== MORE_FILTERS) {
                    var filter = _.assign({}, filters[type]);
                    removeFilterValue(filter, type, id);
                } else {
                    moreFilters.forEach(function (moreFilterName) {
                        var filter = filters[moreFilterName];
                        var index = _.findIndex(filter.list, function (item) {
                            return item.id === id;
                        });
                        if (index >= 0) {
                            removeFilterValue(filter, moreFilterName, id);
                        }
                    });
                }
            });

            $mobileFiltersButton.on('click', function () {
                toggleMobileFiltersModal(true);
            });
            $mobileFiltersModalCloseButton.on('click', function () {
                toggleMobileFiltersModal(false);
            });
            $mobileFiltersModalApplyButton.on('click', function () {
                updateFilters(mobileFilters);

                tryRedirectToSearchPage();
                toggleMobileFiltersModal(false);
            });

            $(document).on('learning-results-changed', function (event) {
                if (tableName === event.originalEvent.detail.tableName) {
                    updateFiltersBoxes();
                }
            });

            $togglers.each(function () {
                var $toggler = $(this);
                var $button = $toggler.find('button');
                $button.attr('data-state', false);
                var togglerType = $toggler.data('type');
                togglers[togglerType] = false;

                $button.on('click', function () {
                    toggleToggler(togglerType);
                });
            });

            function removeFilterValue(filter, type, id) {
                _.remove(filter.list, function (item) {
                    return item.id === id;
                });
                filter.all = filter.list ? !!!filter.list.length : true;

                setFilter(type, filter);
            }

            // update and rerender checkboxes in filter boxes
            function updateFiltersBoxes(incomingData) {
                var results = incomingData || STFED.LearningResults.loadedResults[tableName];
                var filtersData;
                var firstUpdate = !!!(incomingData !== undefined || (filteredData && filteredData.length));

                if (!firstUpdate) {
                    filtersData = {};

                    Object.keys(filters).forEach(function (filterNotToCheck) {
                        var filtersToCheck = _.assign({}, filters);
                        delete filtersToCheck[filterNotToCheck];

                        var filteredData = getFilteredData(filtersToCheck);

                        var curFiltersData = new FiltersData();

                        filteredData.forEach(function (result) {
                            updateFiltersData(result, curFiltersData, noSubs);
                        });

                        filtersData[filterNotToCheck] = _.assign({}, curFiltersData[filterNotToCheck]);
                    });
                } else {
                    filtersData = new FiltersData();

                    results.forEach(function (result) {
                        updateFiltersData(result, filtersData, noSubs);
                    });
                }

                Object.keys(filtersData).forEach(function (filterName) {
                    var $targetFilter = $filterBlock.find('.js-filter-area[data-type=' + filterName + ']');
                    var targetContent = filtersData[filterName];

                    if (firstUpdate) {
                        initFiltersContent($targetFilter, targetContent);
                    } else {
                        renderFiltersContent($targetFilter, targetContent);
                    }
                });

                // should be min checkbox count for more filters, if there no filters, remove it
                if (firstUpdate) {
                    var $checkboxesToRemove = {};
                    $allCheckBoxesMore.each(function () {
                        var $checkBox = $(this);
                        var $selectBox = $checkBox.parent();
                        var minFilter = $selectBox.data('min-filter');
                        var type = $selectBox.data('type');

                        if (!minFilter) {
                            return;
                        }

                        var $stCheckboxes = $checkBox.find('.st-checkbox');
                        if ($stCheckboxes.length < minFilter) {
                            $checkboxesToRemove[type] = $checkBox;
                        }
                    });

                    if (!Object.keys($checkboxesToRemove).length) {
                        return;
                    }

                    Object.keys($checkboxesToRemove).forEach(function (type) {
                        $checkboxesToRemove[type].remove();
                        delete filters[type];
                        delete filtersData[type];
                        delete filtersAndResults[type];
                    });

                    $allCheckBoxesMore = $filterBlock.find('.filter-checkboxes-more');

                    if (!$allCheckBoxesMore.length) {
                        var $moreSelect = $('.st-filter-box__more', $filterBlock);
                        $moreSelect.remove();
                    }
                }

                if (firstUpdate && needInteractToURL) {
                    fillFiltersFromURL();
                }
            }

            function initFiltersContent($targetFilter, targetContent) {
                originalData = STFED.LearningResults.loadedResults[tableName];
                var checkboxes = '';

                var sort = $targetFilter.data('sort');
                var sortSub = $targetFilter.data('sort-sub');
                var customSort = $targetFilter.data('custom-sort');

                var _filtersData = {};
                if (sort === 'alphabet') {
                    _filtersData = Object.keys(targetContent)
                        .sort(function (a, b) {
                            if (!customSort || !customSort.length) {
                                return alphabetSort(a, b);
                            }

                            var isA = customSort.includes(a);
                            var isB = customSort.includes(b);
                            if (!isA && !isB) {
                                return alphabetSort(a, b);
                            } else if (isA && !isB) {
                                return -1;
                            } else if (isB && !isA) {
                                return 1;
                            } else if (a === b) {
                                return 0;
                            }

                            var aNum = customSort.indexOf(a);
                            var bNum = customSort.indexOf(b);
                            return alphabetSort(aNum, bNum);
                        })
                        .reduce(function (o, k) {
                            o[k] = _.assign({}, targetContent[k]);

                            if (o[k].subs && sortSub) {
                                //o[k].subs =
                                o[k].subs = Object.keys(o[k].subs)
                                    .sort()
                                    .reduce(function (so, sk) {
                                        so[sk] = _.assign({}, o[k].subs[sk]);
                                        return so;
                                    }, {});
                            }
                            return o;
                        }, {});
                } else {
                    _filtersData = targetContent;
                }

                var $checkBoxes = $targetFilter.find('.checkboxes');
                $checkBoxes.children('.st-checkbox').remove();

                Object.keys(_filtersData).forEach(function (key) {
                    var id = key.toString().replace(/[^A-Z0-9]/ig, '').toLowerCase() + filterIndex;
                    var currentCheckboxes;
                    if (_filtersData[key].hasOwnProperty('subs')) {
                        // @formatter:off
                        currentCheckboxes =
                            '<div class="st-checkbox__sub-categories">' +
                            '<div class="st-checkbox st-checkbox__sub-categories-main">' +
                            '<div class="filter-fold filter-fold_expanded">' +
                            '<svg class="st-svg--toggle-tree">' +
                            '<use xlink:href="#icon-arrow-up-filled"></use>' +
                            '</svg>' +
                            '</div>' +
                            '<input type="checkbox" id="' + id + '" value="' + key + '">' +
                            '<label for="' + id + '">' + key + ' ' +
                            '<span>(' + _filtersData[key].count + ')</span>' +
                            '</label>' +
                            '</div>';
                        // @formatter:on
                        Object.keys(_filtersData[key].subs).forEach(function (subKey) {
                            var subId = subKey.toString().replaceAll(' ', '').toLowerCase() + filterIndex;
                            // @formatter:off
                            currentCheckboxes +=
                                '<div class="st-checkbox sub-category">' +
                                '<input type="checkbox" id="' + id + subId + '"' + ' value="' + subKey + '">' +
                                '<label for="' + id + subId + '">' + subKey + ' ' +
                                '<span>(' + _filtersData[key].subs[subKey].count + ')</span>' +
                                '</label>' +
                                '</div>';
                            // @formatter:on
                        });
                        // @formatter:off
                        currentCheckboxes +=
                            '</div>';
                        // @formatter:on
                    } else {

                        // @formatter:off
                        currentCheckboxes =
                            '<div class="st-checkbox">' +
                                '<input type="checkbox" id="' + id + '" value="' + key + '">' +
                                '<label for="' + id + '">' + (location.href.includes('events/') ? (Granite.I18n.get(key, null, 'events') || key) : key) + ' ' +
                                    '<span>(' + _filtersData[key].count + ')</span>' +
                                '</label>' +
                            '</div>';
                        // @formatter:on
                    }
                    checkboxes += currentCheckboxes;
                });
                $checkBoxes.append(checkboxes);

                addCheckboxListeners($targetFilter);

                addMoreFiltersListeners($targetFilter);

                function addCheckboxListeners($targetFilter) {
                    var $stCheckboxes = $targetFilter.find('.st-checkbox');
                    $stCheckboxes.each(function () {
                        var $stCheckbox = $(this);
                        var $checkbox = $('input[type="checkbox"]', $stCheckbox);
                        var $foldArrow = $stCheckbox.find('.filter-fold');

                        $checkbox.on('change', function (e) {
                            var $subStCheckboxes;
                            if ($stCheckbox.hasClass('st-checkbox__sub-categories-main')) {
                                $subStCheckboxes = $stCheckbox.siblings('.sub-category');

                                $subStCheckboxes.each(function () {
                                    var $curStCheckbox = $(this);
                                    var $subCheckbox = $('input[type="checkbox"]', $curStCheckbox);
                                    $subCheckbox.prop('checked', $checkbox.prop('checked'));
                                });

                                $stCheckbox.removeClass('st-checkbox--half-checked');
                            }

                            var parentCheckboxId;
                            if ($stCheckbox.hasClass('sub-category')) {
                                var id = $checkbox.attr('id');
                                parentCheckboxId = id.match(/[a-zA-Z]+/g)[0] + id.match(/\d+/g)[0];
                                var $parentCheckbox = $('#' + parentCheckboxId, $targetFilter);
                                var $parentStCheckbox = $parentCheckbox.parent('.st-checkbox');

                                $subStCheckboxes = $stCheckbox.siblings('.sub-category').addBack();
                                var checkedCount = {
                                    checked: 0,
                                    count: 0,
                                };

                                $subStCheckboxes.each(function () {
                                    var $curStCheckbox = $(this);
                                    var $subCheckbox = $('input[type="checkbox"]', $curStCheckbox);

                                    if ($subCheckbox.prop('checked')) {
                                        checkedCount.checked++;
                                    }
                                    checkedCount.count++;
                                });

                                if (checkedCount.checked === 0) {
                                    $parentStCheckbox.removeClass('st-checkbox--half-checked');
                                    $parentCheckbox.prop('checked', false);
                                } else if (checkedCount.checked === checkedCount.count) {
                                    $parentStCheckbox.removeClass('st-checkbox--half-checked');
                                    $parentCheckbox.prop('checked', true);
                                } else {
                                    $parentStCheckbox.addClass('st-checkbox--half-checked');
                                    $parentCheckbox.prop('checked', false);
                                }
                            }

                            var filterType = $targetFilter.data('type');
                            var filter = getNewFilterByArea($targetFilter);

                            if (isMobile) {
                                mobileFilters[filterType] = filter;
                                var tmpFilteredData = getFilteredData(mobileFilters);
                                updateFiltersBoxes(tmpFilteredData);
                            }

                            updateApplyButtons(filterType, filter);

                            if (e.submit) {
                                var $filter;
                                if ($targetFilter.hasClass('filter-select-box__more')) {
                                    $filter = $targetFilter.parents('.st-filter-box__more');
                                } else {
                                    $filter = $targetFilter;
                                }

                                updateFilter($filter);
                            }
                        });

                        $foldArrow.on('click', (function () {
                            var $subStCheckboxes = $stCheckbox.siblings('.sub-category');

                            $subStCheckboxes.each(function () {
                                var $curStCheckbox = $(this);

                                if ($foldArrow.hasClass('filter-fold_expanded')) {
                                    $curStCheckbox.addClass('sub-category_hidden');
                                } else {
                                    $curStCheckbox.removeClass('sub-category_hidden');
                                }
                            });

                            $foldArrow.toggleClass('filter-fold_expanded');
                        }));
                    });
                }

                function addMoreFiltersListeners($targetFilter) {
                    if (!$targetFilter.hasClass('filter-select-box__more')) {
                        return;
                    }

                    var $subheader = $targetFilter.find('.filter-subheader');
                    var $foldArrow = $subheader.find('.filter-fold');

                    $foldArrow.on('click', function () {
                        var $this = $(this);
                        var $checkboxes = $subheader.siblings('.checkboxes');
                        if ($checkboxes.hasClass('hidden')) {
                            $checkboxes.removeClass('hidden');
                        } else {
                            $checkboxes.addClass('hidden');
                        }
                        $this.toggleClass('filter-fold_expanded');
                    });
                }

                function alphabetSort(a, b) {
                    if (a > b) {
                        return 1;
                    } else if (a < b) {
                        return -1;
                    } else {
                        return 0;
                    }
                }
            }

            function updateApplyButtons(filterType, newFilter) {
                var count = getShowResultsCount(filterType, newFilter, isMobile ? mobileFilters : filters);
                var showResultsTextLocalized = Granite.I18n.get('Show {0} results', [count], 'events') || "Show " + count + " results";
                $filterApplyButtons.text(showResultsTextLocalized);
            }

            function getShowResultsCount(filterType, newFilter, _filters) {
                var thisFilters = _.assign({}, _filters || filters);
                if (filterType && newFilter) {
                    thisFilters[filterType] = _.assign({}, newFilter);
                }

                var filtered = getFilteredData(thisFilters);
                return filtered.length;
            }

            function renderFiltersContent($targetFilter, targetContent) {
                var $checkBoxBlock = $targetFilter.find('.checkboxes');
                var $stCheckboxes = $('.st-checkbox', $checkBoxBlock);

                if (!$checkBoxBlock.is(':visible')) {
                    $stCheckboxes.find('label > span').text('(0)');
                    $stCheckboxes.find('input').addClass('disabled');
                }

                Object.keys(targetContent).forEach(function (item) {
                    if (targetContent[item].subs) {
                        var mainId = getId(item);

                        Object.keys(targetContent[item].subs).forEach(function (sub) {
                            var id = mainId + getId(sub);
                            var count = targetContent[item].subs[sub].count;

                            setItemCount(id, count);
                        });

                        var $thisMainCheckbox = $('#' + mainId, $targetFilter);
                        var $thisMainStCheckbox = $thisMainCheckbox.parent('.st-checkbox');
                        var $subStCheckboxes = $thisMainStCheckbox.siblings('.sub-category');
                        var mainCount = 0;
                        $subStCheckboxes.each(function () {
                            var $stCheckbox = $(this);
                            var count = +($stCheckbox.find('label > span').text().match(/\d+/g))[0];

                            mainCount += count;
                        });

                        setItemCount(mainId, mainCount);
                    } else {
                        var id = getId(item);
                        var count = targetContent[item].count;
                        setItemCount(id, count);
                    }
                });

                makeFilterBoxActive($targetFilter);

                function getId(item) {
                    var id = item.toString().replace(/[^A-Z0-9]/ig, '').toLowerCase() + filterIndex;
                    return id;
                }

                function setItemCount(id, count) {
                    var $checkbox = $checkBoxBlock.find('input#' + id);
                    var $stCheckbox = $checkbox.closest('.st-checkbox');
                    $stCheckbox.find('input').removeClass('disabled');
                    $stCheckbox.find('label > span').text('(' + count + ')');
                }
            }

            function makeFilterBoxActive($targetFilter) {
                var filterType = $targetFilter.data('type');

                var isActive = !!filters[filterType].list.length;

                if (isMobile && _.includes(moreFilters, filterType)) {
                    makeMobileMoreFiltersActive();
                } else if (isActive) {
                    $targetFilter.addClass('filter-active');
                } else {
                    $targetFilter.removeClass('filter-active');
                }

                function makeMobileMoreFiltersActive() {
                    var $selectBox = $targetFilter.children('.filter-select-box');
                    if (isActive) {
                        $selectBox.addClass('filter-active');
                    } else {
                        $selectBox.removeClass('filter-active');
                    }
                }
            }

            function updateFilter($targetFilter, reset) {
                if (!$targetFilter.hasClass('st-filter-box__more') && !$targetFilter.hasClass('filter-select-box__more')) {
                    update($targetFilter);
                } else {
                    var $filters = $targetFilter.find('.filter-select-box__more');
                    $filters.each(function () {
                        var $this = $(this);
                        update($this);
                    });
                }

                function update($targetFilterArea) {
                    var filterType = $targetFilterArea.data('type');
                    var filter = getNewFilterByArea($targetFilterArea, reset);

                    setFilter(filterType, filter);
                }
            }

            function getNewFilterByArea($targetFilterArea, reset) {
                var $stCheckboxes = $targetFilterArea
                    .find('.st-checkbox:not(.st-checkbox__sub-categories-main) > input[type="checkbox"]');
                var $enabledCheckboxes = $stCheckboxes.not('.disabled');
                var $checkedCheckboxes = $enabledCheckboxes.filter(':checked');

                var filter = new Filter();

                if ($enabledCheckboxes.length < 1) {
                    filter.all = false;
                    filter.list = [];
                } else if ($checkedCheckboxes.length < 1) {
                    filter.all = true;
                    filter.list = [];
                } else if (reset) {
                    filter.all = true;
                    filter.list = [];

                    $checkedCheckboxes.each(function () {
                        var $checkbox = $(this);
                        $checkbox.prop('checked', false);
                    });
                } else {
                    filter.all = false;
                    filter.list = [];

                    $checkedCheckboxes.each(function () {
                        var $checkbox = $(this);
                        var $label = $checkbox.siblings('label');
                        var value = $label.text().split(' (')[0];
                        var id = $checkbox.attr('id');

                        var $stCheckbox = $checkbox.parent();
                        var mainValue;
                        if ($stCheckbox.hasClass('sub-category')) {
                            var $mainStCheckbox = $stCheckbox.siblings('.st-checkbox__sub-categories-main');
                            mainValue = $('input[type="checkbox"]', $mainStCheckbox).val();
                        }

                        filter.list.push({
                            id: id,
                            value: value,
                            mainValue: mainValue,
                        });
                    });
                }

                return filter;
            }

            function filterData(_filters, _togglers) {
                filteredData = getFilteredData(_filters, _togglers);
            }

            function getFilteredData(_filters, _togglers) {
                _filters = _filters || filters;
                _togglers = _togglers || togglers;

                var data = STFED.LearningResults.loadedResults[tableName];
                var newData = [];

                var filtersLength = Object.keys(_filters).reduce(function (acc, filter) {
                    return acc + _filters[filter].list.length;
                }, 0);
                var togglersLength = Object.keys(_togglers).length;

                if (!filtersLength && !togglersLength) {
                    newData = data;
                } else {
                    var toggledData = [];

                    if (togglersLength) {
                        Object.keys(_togglers).forEach(function (toggler) {
                            var _toggledData = data.filter(function (stResult) {
                                return checkByToggler(stResult, toggler, _togglers[toggler]);
                            });

                            _toggledData.forEach(function (stResult) {
                                if (!toggledData.includes(stResult)) {
                                    toggledData.push(stResult);
                                }
                            });
                        });
                    } else {
                        toggledData = data;
                    }

                    if (filtersLength) {
                        Object.keys(_filters).forEach(function (filterType) {
                            var filteredData = toggledData.filter(function (stResult) {
                                if (!checkFilters(stResult, filterType, _filters)) {
                                    return false;
                                }

                                var list = _filters[filterType].list;
                                for (var i = 0; i < list.length; i++) {
                                    if (checkByType(stResult, filterType, list[i].value, list[i].mainValue, noSubs)) {
                                        return true;
                                    }
                                }

                                return false;
                            });

                            filteredData.forEach(function (stResult) {
                                if (!newData.includes(stResult)) {
                                    newData.push(stResult);
                                }
                            });
                        });
                    } else {
                        newData = toggledData;
                    }

                }

                return newData;
            }

            function setFilterWithoutUpdate(filterType, newFilter, newFilters) {
                newFilters = newFilters || filters;

                newFilters[filterType].all = newFilter.all;
                newFilters[filterType].list = _.slice(newFilter.list);

                return newFilters;
            }

            function setFilter(filterType, newFilter) {
                filters = setFilterWithoutUpdate(filterType, newFilter);

                filterData(filters);
                clearUnavailableFilters();
                updateFiltersBoxes(filteredData);
                renderCheckedList(filterType);
                updateContent();
                updateApplyButtons();
                updateMobileFiltersButton();
                tryChangeURL();
            }

            function toggleToggler(togglerType, state) {
                togglers[togglerType] = state !== undefined ? state : !togglers[togglerType];

                filterData();
                clearUnavailableFilters();
                updateFiltersBoxes(filteredData);
                updateContent();
                updateApplyButtons();
            }

            function updateMobileFiltersButton() {
                var $count = $mobileFiltersButton.find('.chosen-filters-count');

                var count = 0;
                Object.keys(filters).forEach(function (filter) {
                    var l = filters[filter].list.length;
                    if (l) {
                        count += l;
                    }
                });

                if (count) {
                    $count.text(count);
                } else {
                    $count.empty();
                }
            }

            // Removes filter values, which not affect on current data:
            // no one row in filteredData contains value.
            // Should be called after filters changed.
            function clearUnavailableFilters() {
                Object.keys(filters).forEach(function (filterType) {
                    if (filters[filterType].all) {
                        return;
                    }

                    var valuesToRemove = [];

                    filters[filterType].list.forEach(function (filterValue) {
                        var remove = true;
                        filteredData.forEach(function (row) {
                            if (isFilterAvailable(row, filterType, filterValue.value, togglers)) {
                                remove = false;
                            }
                        });

                        if (remove) {
                            valuesToRemove.push(filterValue);
                        }
                    });

                    if (!valuesToRemove.length) {
                        return;
                    }

                    valuesToRemove.forEach(function (filterValue) {
                        removeFilterValue(filters[filterType], filterType, filterValue.id);
                    });
                });
            }

            function updateFilters(newFilters) {
                Object.keys(newFilters).forEach(function (filterType) {
                    setFilter(filterType, newFilters[filterType]);
                });
            }

            function renderCheckedList(filterType) {
                if (filterType === MORE_FILTERS) {
                    return;
                }

                var $checkedList = filters[filterType].checkedList;
                $checkedList.empty();

                if (filterType !== MORE_FILTERS) {
                    filters[filterType].list.forEach(function (item) {
                        appendElement(item);
                    });
                }

                function appendElement(item) {
                    // @formatter:off
                    var element =
                        '<label id="list-' + item.id + '" for="' + item.id + '">' +
                        '<svg class="st-link__icon-flex st-link__icon--arrow-small">' +
                        '<use xlink:href="#icon-close"></use>' +
                        '</svg>' +
                        item.value +
                        '</label>';
                    // @formatter:on
                    $checkedList.append(element);
                }
            }

            function updateContent(incomingData) {
                incomingData = incomingData || filteredData || originalData;

                emitCustomEvent('update-learning-results-table', {
                    data: incomingData
                });
            }

            function checkFilters(result, filterNotToCheck, _filters) {
                _filters = _filters || filters;
                var keys = Object.keys(_filters);

                for (var i = 0; i < keys.length; i++) {
                    var filter = keys[i];

                    if (filter === filterNotToCheck) {
                        continue;
                    }

                    var field = filtersAndResults[filter];

                    var filterValues = _filters[filter].list.map(function (item) {
                        return item.value;
                    });

                    var res = check(field, filterValues, _filters[filter].all);
                    if (res === false) {
                        return false;
                    }
                }

                return true;


                function check(field, filterValues, all) {
                    if (all) {
                        return;
                    }
                    if (!Array.isArray(result[field]) && filterValues.includes(result[field])) {
                        return;
                    }
                    if (Array.isArray(result[field])) {
                        var intersection = _.intersection(result[field], filterValues);

                        if (intersection.length > 0) {
                            return;
                        }
                    }

                    return false;
                }
            }

            function makeUrlParams() {
                var filterTypes = Object.keys(filters);

                var params = {};
                for (var i = 0; i < filterTypes.length; i++) {
                    var type = filterTypes[i];
                    if (type !== MORE_FILTERS) {
                        if (filters[type].list.length) {
                            params[type] = filters[type].list
                                .map(function (item) {
                                    return item.id;
                                });
                        }
                    }
                }

                return new URLSearchParams(params).toString();
            }

            function fillFiltersFromURL() {
                var urlString = window.location.href;
                var url = new URL(urlString);

                var filterKeys = Object.keys(filters);
                for (var i = 0; i < filterKeys.length; i++) {
                    var params = url.searchParams.get(filterKeys[i]);
                    if (params && params.length) {
                        var paramsArray = params.split(',');
                        var list = paramsArray.map(function (id) {
                            var $checkbox = $('#' + id);
                            var $stCheckbox = $checkbox.parent('.st-checkbox');
                            var mainValue;
                            var value;
                            if ($stCheckbox.hasClass('sub-category')) {
                                var $parentStCheckbox = $stCheckbox.siblings('.st-checkbox__sub-categories-main');
                                var $parentCheckbox = $parentStCheckbox.find('input[type="checkbox"]');
                                mainValue = $parentCheckbox.val();
                            }
                            value = $checkbox.val();
                            return {
                                id: id,
                                value: value,
                                mainValue: mainValue,
                            };
                        });
                        var newFilter = new Filter();
                        newFilter.all = false;
                        newFilter.list = list;

                        setFilter(filterKeys[i], newFilter);
                    }
                }
            }

            function tryChangeURL() {
                if (!needInteractToURL) {
                    return;
                }

                var id = Math.floor(Math.random() * 10);
                var title = document.title;
                var urlString = window.location.origin + window.location.pathname;
                var params = makeUrlParams();
                if (params) {
                    urlString += '?' + params;
                }

                window.history.pushState({id: id}, title, urlString);
            }

            function tryRedirectToSearchPage() {
                if (isFiltersOnly && needInteractToURL) {
                    var params = makeUrlParams();

                    window.location.replace(searchPage + (params ? '?' + params : ''));
                }
            }

            function hideMobileMoreFilterBoxes() {
                if (!isMobile) {
                    return;
                }

                $allCheckBoxesMore.each(function () {
                    var $this = $(this);
                    $this.removeClass('filter-open');
                    makeFilterBoxActive($this.parent('.filter-select-box__more'));
                    var $button = $this.prev('.filter-select-box');
                    $button.removeClass('mobile-filter-open');
                });
            }

            function toggleMobileFiltersModal(show) {
                if (show) {
                    mobileFilters = _.assign({}, filters);
                    $mobileFiltersModal.addClass('show');
                } else {
                    $filterBoxes.removeClass('filter-open');
                    $allCheckBoxesMore.removeClass('filter-open');

                    $mobileFiltersModal.removeClass('show');
                    hideMobileMoreFilterBoxes();
                }
            }
        });

        $(window).on('resize', _.debounce(function () {
            setIsMobile();

        }, 100));

        function setIsMobile() {
            isMobile = $(window).width() <= 1024;
        }

        function Filter() {
            // list items: {
            //      id: string (input id)
            //      value: string (input value)
            //      mainValue: string (input value of main sub category)
            // }
            return {
                all: true,
                list: [],
            };
        }

        // for checkboxes
        function FiltersData() {
            // without subcategory:
            // 'filterType': {
            //      'categoryName': {
            //          count: resultsCount
            //      }
            //  }

            // with subcategory:
            // 'filterType': {
            //      'categoryName': {
            //          count: resultsCountInSubCategories,
            //          subs: {
            //              'subName': {
            //                  count: resultsCount
            //              }
            //          }
            //      }
            //  }

            var filtersData = {};
            Object.keys(filtersAndResults).forEach(function (k) {
                filtersData[k] = {};
            });

            return filtersData;
        }
    }

    $(document).ready(function () {
        init();
    });

    $(document).on('become-visible', function () {
        init();
    });
})(jQuery);

var initializeSideBar = function(){
    if (window.documentReady && window.sidebarAjaxCallComplete){
       requestAnimationFrame(function() {
            $(document).trigger("lateral_menu_container_loaded");
        });
    }
}

$(function () {
    $( document ).ready(function() {
        window.documentReady = true;
        initializeSideBar();
    });
});

(function ($) {
    var dataInited = {};

    //#region topics templates
    // @formatter:off
    var topicCol = _.template(
        '<td>' +
            '<div class="learning-table__row-wrapper">' +
                '<div class="learning-result__img-wrapper learning-table_1">' +
                '<a href="<%- topic.link %>">' +
                    '<img src="<%- topic.image %>" alt="<%- topic.imageAlt %>">' +
                '</a>' +
                '</div>' +
                '<a class="learning-result__title learning-table_2" href="<%- topic.link %>">' +
                    '<%- topic.name %>' +
                '</a>' +
                '<p class="learning-result__description learning-table_3 st-read-more" ' +
                    'data-max-lines="<%= getRowSettings(\'maxLines\') %>">' +
                    '<%- topic.description %>' +
                    '<a class="read-more" ' +
                        'data-read-more="<%= getRowSettings(\'readMore\') %>" ' +
                        'data-read-less="<%= getRowSettings(\'readLess\') %>" ' +
                    '></a>' +
                '</p>' +
                '<div class="learning-result__info learning-table_4">' +
                    '<div class="learning-result__info-item">' +
                        '<% if (getTypeIcon(topic.type)) { %>' +
                            '<svg class="icon <%= getTypeIcon(topic.type) %>">' +
                                '<use xlink:href="#<%= getTypeIcon(topic.type) %>"></use>' +
                            '</svg>' +
                        '<% } %>' +
                        '<span>' +
                            '<%- topic.type %>' +
                        '</span>' +
                    '</div>' +
                    '<% if(topic.requiredTime) { %>' +
                        '<div class="learning-result__info-item">' +
                            '<svg class="icon <%= getIcon(\'time\') %>">' +
                                '<use xlink:href="#<%= getIcon(\'time\') %>"></use>' +
                            '</svg>' +
                            '<span>' +
                                '<%- topic.requiredTime %>' +
                            '</span>' +
                        '</div>'+
                    '<% } %>' +
                    '<% if(topic.level) { %>' +
                        '<div class="learning-result__info-item">' +
                            '<% if(getLevelIcon(topic.level)) { %>' +
                                '<svg class="icon <%= getLevelIcon(topic.level) %>">' +
                                    '<use xlink:href="#<%= getLevelIcon(topic.level) %>"></use>' +
                                '</svg>' +
                            '<% } %>' +
                            '<span>' +
                                '<%- topic.level %>' +
                            '</span>' +
                        '</div>'+
                    '<% } %>' +
                    '<% if(topic.rate) { %>' +
                        '<div class="learning-result__info-item">' +
                            '<div>' +
                                '<%- getRateIcon(topic.rate) %>' +
                            '</div>' +
                            '<div>' +
                                '<%- topic.rate %>' +
                            '</div>' +
                        '</div>'+
                    '<% } %>' +
                '</div>' +
            '</div>' +
        '</td>'
    );
    // @formatter:on
    // @formatter:off
    var textBookCol = _.template(
        '<td>' +
            '<div class="learning-table__row-wrapper learning-table__row-wrapper_textbook">' +
                '<div class="learning-result__img-wrapper learning-table_1">' +
                    '<a href="<%- topic.link %>">' +
                        '<img src="<%- topic.image %>" alt="<%- topic.imageAlt %>">' +
                    '</a>' +
                '</div>' +
                '<span class="learning-result__title learning-result__title_textbook learning-table_2">' +
                    '<%- topic.name %>' +
                '</span>' +
                '<% if (topic.bookAuthor || topic.publishHouse || topic.publishYear) { %>' +
                    '<div class="learning-result__textbook-info learning-table_3">' +
                        '<% if (topic.author) { %>' +
                            '<span class="learning-result__textbook-info-author"><%- topic.author %></span>' +
                        '<% } %>' +
                        '<% if (topic.publishHouse) { %>' +
                            '<span><%- topic.publishHouse %></span>' +
                        '<% } %>' +
                        '<% if (topic.publishYear) { %>' +
                            '<span><%- topic.publishYear %></span>' +
                        '<% } %>' +
                    '</div>' +
                '<% } %>' +
                '<p class="st-read-more learning-result__description learning-table_4" data-max-lines="<%= getRowSettings(\'maxLines\') %>">' +
                    '<%- topic.description %>' +
                    '<a class="read-more" ' +
                        'data-read-more="<%= getRowSettings(\'readMore\') %>" ' +
                        'data-read-less="<%= getRowSettings(\'readLess\') %>" ' +
                    '></a>' +
                '</p>' +
                '<div class="learning-result__info learning-table_5">' +
                    '<div class="learning-result__info-item">' +
                        '<% if (getTypeIcon(topic.type)) { %>' +
                            '<svg class="icon <%= getTypeIcon(topic.type) %>">' +
                                '<use xlink:href="#<%= getTypeIcon(topic.type) %>"></use>' +
                            '</svg>' +
                        '<% } %>' +
                        '<span>' +
                            '<%- topic.type %>' +
                        '</span>' +

                        '<% if(topic.level) { %>' +
                            '<div class="learning-result__info-item">' +
                                '<% if(getLevelIcon(topic.level)) { %>' +
                                    '<svg class="icon <%= getLevelIcon(topic.level) %>">' +
                                        '<use xlink:href="#<%= getLevelIcon(topic.level) %>"></use>' +
                                    '</svg>' +
                                '<% } %>' +
                                '<span>' +
                                    '<%- topic.level %>' +
                                '</span>' +
                            '</div>'+
                        '<% } %>' +

                    '</div>' +
                '</div>' +
                '<div class="learning-result__textbook-order learning-table_6">' +
                    '<a href="<%- topic.link %>" ' +
                        'class="st-button st-button--primary btn learning-result__textbook-order-btn">' +
                        'Order the book' +
                        '<svg class="icon <%= getIcon(\'arrow\') %>">' +
                            '<use xlink:href="#<%= getIcon(\'arrow\') %>"></use>' +
                        '</svg>' +
                    '</a>' +
                    '<div class="learning-result__textbook-order-shop">' +
                        '<span>' +
                            'You will be redirected to' +
                        '</span>' +
                        '<span>' +
                            ' <%- topic.supplier %>' +
                        '</span>' +
                    '</div>' +
                '</div>' +
            '</div>' +
        '</td>'
    );
    // @formatter:on
    //#endregion

    //#region partners templates
    // @formatter:off
    var partnerCol = _.template(
        '<td>' +
            '<div class="learning-table__row-wrapper learning-table__row-wrapper_partner">' +
                '<div class="learning-result__img-wrapper learning-table_1">' +
                    '<a href="<%- partner.link %>">' +
                        '<img src="<%- partner.logo %>" alt="<%- partner.title %>">' +
                    '</a>' +
                '</div>' +
                '<a class="learning-result__title learning-table_2" href="<%- partner.link %>">' +
                    '<%- partner.title %>' +
                '</a>' +
                '<p class="learning-result__description learning-table_3 st-read-more" ' +
                    'data-max-lines="<%= getRowSettings(\'maxLines\') %>">' +
                        '<%- partner.description %>' +
                        '<a class="read-more" ' +
                            'data-read-more="<%= getRowSettings(\'readMore\') %>" ' +
                            'data-read-less="<%= getRowSettings(\'readLess\') %>" ' +
                        '>' +
                        '</a>' +
                '</p>' +
            '</div>' +
        '</td>'
    );
    // @formatter:on
    //#endregion

    // this may not work correct if there several tables on the page
    var resultsPerPage = 10;
    var rowSettings = {
        maxLines: 3,
        readMore: 'read more',
        readLess: 'read less',
    };

    function getLevelIcon(level) {
        var icons = {
            'All experience levels': 'icon-level-3',
            'Intermediate': 'icon-level-2',
            'Beginner': 'icon-level-1',
        };
        return icons[level];
    }

    function getTypeIcon(type) {
        var icons = {
            'recorded webinar': 'icon-playbutton-colorless',
            'e-learning journeys': 'icon-list-2',
            'partner training': 'icon-handshake',
            'course': 'icon-playbutton-colorless-square',
            'st moocs': 'icon-playbutton-colorless-square',
            'text book': 'icon-book',
            'quiz': 'icon-datasheet-2',
        };

        return icons[type.toLowerCase()];
    }

    function getIcon(type) {
        var icons = {
            'arrow': 'icon-arrow-right-thin-colorless',
            'time': 'icon-time',
        };
        return icons[type];
    }

    function getRowSettings(setting) {
        return rowSettings[setting];
    }

    var columnTopicDefs = [
        {
            targets: 0,
            data: null,
            className: 'learning-table__row',
            render: function (data) {
                var options = {
                    topic: data,
                    getLevelIcon: getLevelIcon,
                    getTypeIcon: getTypeIcon,
                    getIcon: getIcon,
                    getRowSettings: getRowSettings,
                };

                return data.type.toLowerCase() === 'text book' ?
                    textBookCol(options) : topicCol(options);
            }
        },
    ];

    var columnPartnerDefs = [
        {
            targets: 0,
            data: null,
            className: 'learning-table__row',
            title: 'Partner name',
            render: function (data) {
                var options = {
                    partner: data,
                    getRowSettings: getRowSettings,
                };

                return partnerCol(options);
            }
        },
    ];


    tableInit();

    $(document).on('become-visible', function () {
        tableInit();
    });

    function tableInit() {
        $(function () {
            $('.js-learning-results-table').each(function () {
                var $table = $(this);
                var $tableInfo = $table.siblings('.table-info');
                var $summary = $table.siblings('.summary');
                var $loadMoreBtn = $summary.find('.summary__btn');

                var dataURL = $table.data('learning-results');
                var tableName = $table.data('learning-table-name') || 'learningResults';
                var parser = $table.data('parser');
                var isSummaryNeeded = $table.data('summary-needed');

                var lastParsedResults;
                resultsPerPage = $table.data('results-per-page') || resultsPerPage;
                rowSettings.maxLines = $table.data('max-lines-in-row') || rowSettings.maxLines;
                rowSettings.readMore = $table.data('show-more-text') || STFED.readMoreDotdotdot.settings.readMoreText;
                // extra space needed
                rowSettings.readLess = '&nbsp;' + $table.data('show-less-text') || STFED.readMoreDotdotdot.settings.readLessText;

                var table;

                if (!dataInited[tableName]) {
                    dataInited[tableName] = true;
                } else {
                    return;
                }

                var createTableFun;
                var summaryLabel;
                var columnDefs;
                switch (parser) {
                    case 'partners':
                        createTableFun = createTable;
                        summaryLabel = 'partners are shown';
                        columnDefs = columnPartnerDefs;
                        break;
                    default:
                        createTableFun = createTable;
                        summaryLabel = 'training are shown';
                        columnDefs = columnTopicDefs;
                }

                STFED.LearningResults.loadResults(dataURL, renderCallback, tableName, parser);

                $loadMoreBtn.on('click', function () {
                    table.page.len(table.page.len() + resultsPerPage);
                    redrawTable();
                });

                $(window).on('update-learning-results-table', function (result) {
                    var details = result.originalEvent.detail;
                    table.clear().destroy();
                    renderCallback(details.data);
                });


                function renderCallback(parsedResults) {
                    parsedResults = parsedResults || lastParsedResults;

                    if (!$.fn.DataTable.isDataTable($table)) {
                        lastParsedResults = parsedResults.slice();
                        var dataToDraw = parsedResults.slice(0);

                        createTableFun(dataToDraw);
                        redrawTable();

                        updateInfo(parsedResults.length);
                    }
                }

                function createTable(data) {
                    var region = $table.data('activitymap-region') || 'Learning partners results';
                    table = $table.DataTable({
                        data: data,
                        order: [],
                        searching: false,
                        columnDefs: columnDefs,
                        autoWidth: false,

                        paging: !!$loadMoreBtn.length,
                        pageLength: 10,
                        createdRow: onCreateRow,

                        info: isSummaryNeeded,
                        infoCallback: function(settings, start, end, max, total, pre) {
                            tryHideOrShowShowMoreBtn(end, total);
                            return end + ' of ' + total + ' ' + summaryLabel;
                        },
                    });
                    $table.children('tbody').attr('id', region);
                }

                function redrawTable() {
                    table.draw();
                    STFED.readMoreDotdotdot.init($table);
                }

                function onCreateRow(row) {
                    $(row).addClass('learning-row');
                }

                function updateInfo(allCount) {
                    updateTableInfo(allCount);

                    function updateTableInfo(count) {
                        if (count) {
                            var $count = $tableInfo.find('.count');
                            $count.text(count + ' total entries');
                        }
                    }
                }

                function tryHideOrShowShowMoreBtn(count, total) {
                    if (!$loadMoreBtn) {
                        return;
                    }

                    if (count >= total) {
                        $loadMoreBtn.addClass('hidden');
                    } else {
                        $loadMoreBtn.removeClass('hidden');
                    }
                }
            });
        });
    }
})(jQuery);

(
    function ($) {
        STFED.LearningResults = STFED.LearningResults || {Results: {}};
        STFED.LearningResults.loadedResults = STFED.LearningResults.loadedResults || {};
        var locale = $('meta[name=Content-Language]').attr('content') || 'en';

        STFED.LearningResults.loadResults = function (dataURL, renderCallback, tableName, parser) {
            loadResults(dataURL, renderCallback, tableName, parser);
        };

        function loadResults(dataURL, renderCallback, tableName, parser) {
            return $.ajax(dataURL + '?locale=' + locale)
                .done(function (resultsJSON) {
                    var parsedResults;
                    switch (parser) {
                        case 'partners':
                            parsedResults = parsePartners(resultsJSON);
                            break;
                        default:
                            parsedResults = parseResults(resultsJSON);
                    }

                    renderCallback(parsedResults);
                    STFED.LearningResults.loadedResults[tableName] = parsedResults;
                    emitCustomEvent('learning-results-changed', {tableName: tableName});
                });
        }

        function parseResults(resultsJSON) {
            var results = _.values(resultsJSON);
            var topics = [];
            var id = 0;
            $.each(results, function (i, catalog) {
                var catalogName = catalog.catalog;
                var categories = catalog.categories;

                $.each(categories, function (i, category) {
                    var categoryName = category.category;

                    $.each(category.topics, function (i, topic) {
                        topics.push(
                            _.assign(
                                {
                                    id: id++,
                                    catalog: catalogName,
                                    category: categoryName
                                },
                                topic
                            )
                        );
                    });
                });
            });

            return topics;
        }

        function parsePartners(resultsJSON) {
            var results = _.values(resultsJSON);
            var partners = [];
            var id = 0;
            $.each(results, function (i, partner) {
                var regions = partner.regions.map(function (region) {
                    var dashIndex = region.lastIndexOf('-');
                    if (dashIndex > 0) {
                        region = region.slice(0, dashIndex);
                    }
                    return region;
                });

                var newPartner = _.assign({id: id++}, partner);
                newPartner.regions = regions;

                partners.push(newPartner);
            });

            return partners;
        }
    }
)(jQuery);

(function ($) {
    //#region level 1
    var $catalog = $('.st-learning__catalog');
    var $showMore = $('.st-learning__catalog-show-more_more');
    var $showLess = $('.st-learning__catalog-show-more_less');
    var $filtersData = $('.learning-filters');

    if ($filtersData && $filtersData.data('learning-results')) {
        var tableName = $filtersData.data('learning-table-name') || 'learningResults';
        var renderCallback = function(parsedResults) {
        }

        STFED.LearningResults.loadResults($filtersData.data('learning-results'), renderCallback, tableName);
    }

    function hideCatalog() {
        $catalog.addClass('st-learning__catalog_extra-hidden');
        $showLess.addClass('st-learning__catalog-show-more_hidden');
        $showMore.removeClass('st-learning__catalog-show-more_hidden');
    }

    $showMore.on('click', function () {
        $catalog.removeClass('st-learning__catalog_extra-hidden');
        $showLess.removeClass('st-learning__catalog-show-more_hidden');
        $showMore.addClass('st-learning__catalog-show-more_hidden');
    });

    $showLess.on('click', function () {
        hideCatalog();
    });

    $(window).on('resize', _.debounce(function () {
        if ($(window).width() > 1024) {
            hideCatalog();
        }
    }, 100));

    var $stLearning = $('.st-learning');
    var $homeElements = $('.learning-home', $stLearning);
    var $searchElements = $('.learning-home-search', $stLearning);
    var $backLink = $('.js-learning-back', $stLearning);
    $backLink.on('click', function(e) {
        e.preventDefault();
        var $resetBtn = $('.learning-btn_reset.reset-all', $stLearning);
        $resetBtn.trigger('click');

        $homeElements.removeClass('hidden');
        $searchElements.addClass('hidden');
    });
    var $filterBtns = $('.js-filter-apply.st-button', $stLearning);
    $filterBtns.on('click', function() {
        $homeElements.addClass('hidden');
        $searchElements.removeClass('hidden');
    });
    //#endregion

    //#region level 2
    // categories
    function initCategories() {
        var MAX_CARDS_ON_LOAD = 6;

        var $categoryCards = $('.st-card-categories-wrapper');

        $categoryCards.each(function () {
            var $cardsWrapper = $(this);
            var $showMoreWrapper = $cardsWrapper.next('.count-wrapper');
            var $shownCountCurrent = $showMoreWrapper.find('.shown-count-current');
            var $shownCountAll = $showMoreWrapper.find('.shown-count-all');
            var $showAllBtn = $showMoreWrapper.find('.show-btn.more');
            var $showLessBtn = $showMoreWrapper.find('.show-btn.less');
            var $cards = $cardsWrapper.find('.st-card-categories');
            var $allResultsLink = $('.all-results-link');

            if ($cards.length > MAX_CARDS_ON_LOAD) {
                showFirstNCards();
            } else {
                $showAllBtn.addClass('is-hidden');
            }

            $showAllBtn.on('click', function () {
                $cards.each(function () {
                    $(this).removeClass('is-hidden');
                });

                setShownCounts();
                toggleBtns();
            });

            $showLessBtn.on('click', function () {
                showFirstNCards();
                setShownCounts();
                toggleBtns();
                scrollToEndOfElement($cardsWrapper);
            });

            $allResultsLink.on('click', function (e) {
                e.preventDefault();
                var tabNum = $allResultsLink.data('all-results-tab');
                changeTab(tabNum);
            });

            setShownCounts();


            function showFirstNCards() {
                $cards.each(function (i) {
                    var $card = $(this);
                    if (i >= MAX_CARDS_ON_LOAD) {
                        $card.addClass('is-hidden');
                    }
                });
            }

            function setShownCounts() {
                var shown = 0;
                $cards.each(function () {
                    if (!$(this).hasClass('is-hidden')) {
                        shown++;
                    }
                });

                $shownCountCurrent.text(shown);
                $shownCountAll.text($cards.length);
            }

            function toggleBtns() {
                $showAllBtn.toggleClass('is-hidden');
                $showLessBtn.toggleClass('is-hidden');
            }

            function scrollToEndOfElement($element) {
                $([document.documentElement, document.body]).animate({
                    scrollTop: $element.offset().top + $element.height()
                }, 500);
            }
        });
    }

    //#endregion

    //#region level3
    // topics (mb will be in separate file)
    initTopics();

    function initTopics() {
        var $topicsWrapper = $('.learning-topics-wrapper');
        $topicsWrapper.each(function () {
            var $wrapper = $(this);
            var $topicSectionHeaders = $('.learning-topic-list-section > .section-header');
            $topicSectionHeaders.each(function () {
                var $header = $(this);
                var num = $header.data('section-num');
                if (num !== undefined) {
                    $header.attr('data-before', num);
                }
            });

            var $topicCount = $wrapper.find('.topics-count');
            var $sections = $wrapper.find('.learning-topic-list-section');
            var count = 0;
            $sections.each(function () {
                var $section = $(this);
                var $topics = $section.find('.learning-table__row-wrapper');
                count += $topics.length;
            });
            $topicCount.text(count);

            var $viewAllBtn = $('button.view-all');
            $viewAllBtn.on('click', function (e) {
                e.preventDefault();
                var tabNum = $viewAllBtn.data('further-learning-tab');
                changeTab(tabNum);
            });
        });
    }

    // partner trainings
    var $hideMenus = $('.st-learning .hide-menu');
    $hideMenus.each(function() {
        var $menu = $(this);
        var $header = $menu.find('.menu-header');
        var $text = $menu.find('.menu-text');

        $header.on('click', function() {
            $header.toggleClass('is-opened');
            $text.toggleClass('is-hidden');
        });
    });
    //#endregion

    function changeTab(tabNum) {
        var $tabs = $('.js-st-tabs .slick-slide');

        $tabs.each(function () {
            var $tab = $(this);
            if ($tab.data('nav-tab-id') === tabNum) {
                $('html, body').animate({
                    scrollTop: 0
                }, 500, function() {
                    $tab.click();
                });
            }
        });
    }

    $(document).on('become-visible', function () {
        initCategories();
        initTopics();
    });
})(jQuery);

$(document).ready(function () {
    (function ($) {

        var $form

        switch ($('.fv-form.fv-form-foundation').attr("data-st-tracking-formname")) {
            case "user-password-forgotten-request-page":
                $form = $('form[data-st-tracking-formname="user-password-forgotten-request-page"]')
                break;
            case "user-password-forgotten-reset-page":
                $form = $('form[data-st-tracking-formname="user-password-forgotten-reset-page"]')
                break;
            case "user-password-change-page":
                $form = $('form[data-st-tracking-formname="user-password-change-page"]')
                break;
            case "user-registration-page":
                $form = $('form[data-st-tracking-formname="user-registration-page"]')
                break;
            case "user-validation-page":
                $form = $('form[data-st-tracking-formname="user-validation-page"]')
                break;
            default:
                break;
        }

        function addAnalytics () {
            var formEvents = 'click change keyup';
            var formControlSelector = 'select, input, button';

            $form.on(formEvents, formControlSelector, function onFormChange() {
                _satellite.track('track_registration');

                $form.off(formEvents, formControlSelector, onFormChange);
            });
        }
        if ($form) {
            addAnalytics()
        }
    })(jQuery);
});
if (!document.querySelector('#s7video_div')) {
    var modal = document.createElement('div');
    modal.className = 'modal modal-video';
    modal.id = 'modalVideo';
    modal.innerHTML = '<div class="modal-content"><span class="close">&times;</span><div id="s7video_div"></div></div>';
    document.querySelector('body').append(modal);
}

var videosArray = [
    {id: 'videos', className: '.videos-item', selector: 'a', attr: 'data-video-source'},
    {id: 'Featured Videos', className: '.st-featured-video__item', selector: 'img', attr: 'data-video-path'},
    {id: 'videos-grid', className: '.st-featured-video__item', selector: 'a', attr: 'data-video-source'},
    {id: 'videos', className: '.videos-item', selector: 'a', attr: 'data-iframe-video-source'},
]

var findedArray = videosArray.filter(function (obj) {
    return document.getElementById(obj.id)
})
if (findedArray.length) {
    findedArray.forEach(function (findedObject) {
        document.getElementById(findedObject.id).addEventListener('click', function (event) {
            var ele = event.target.closest(findedObject.className);

            if (!ele) {
                return;
            }

            event.preventDefault();

            var dataVideoPath = ele
                .querySelector(findedObject.selector)
                .getAttribute(findedObject.attr);

            if (dataVideoPath) {
                if (!dataVideoPath.includes("/content/")) {
                    return;
                }

                buildPopup(dataVideoPath, ele);
            }
        });
    })
}

function buildPopup(dataVideoPath, ele) {
    var newPath = dataVideoPath + '/jcr:content/metadata.json';

    var url = dataVideoPath.startsWith('/content/') ? window.location.protocol +
        '//' +
        window.location.hostname +
        (window.location.port ? ':' + window.location.port : '') +
        newPath : newPath;
    console.log(url);
    // Get the modal
    var modal = document.getElementById('modalVideo');
    var span = document.querySelector('#modalVideo .close');
    modal.style.display = 'block';

    document.addEventListener('keydown', function (evt) {
        if (evt.key === 'Escape') {
            const body = document.querySelector('body');
            if (body && body.style.overflow === 'hidden') {
                body.style.overflow = 'auto';
                const fullScreenBtn = document.querySelector('.s7fullscreenbutton');
                if (fullScreenBtn) {
                    fullScreenBtn.click();
                }
            }
            modal.innerHTML = '<div class="modal-content"><span class="close">&times;</span><div id="s7video_div"></div></div>';
            modal.style.display = 'none';
        }
    });

    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
        const body = document.querySelector('body');
        if (body && body.style.overflow === 'hidden') {
            body.style.overflow = 'auto';
            const fullScreenBtn = document.querySelector('.s7fullscreenbutton');
            if (fullScreenBtn) {
                fullScreenBtn.click();
            }
        }

        modal.innerHTML = '<div class="modal-content"><span class="close">&times;</span><div id="s7video_div"></div></div>';
        modal.style.display = 'none';
    };

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function (event) {
        if (event.target == modal) {
            const body = document.querySelector('body');
            if (body && body.style.overflow === 'hidden') {
                body.style.overflow = 'auto';
                const fullScreenBtn = document.querySelector('.s7fullscreenbutton');
                if (fullScreenBtn) {
                    fullScreenBtn.click();
                }
            }
            modal.innerHTML = '<div class="modal-content"><span class="close">&times;</span><div id="s7video_div"></div></div>';
            modal.style.display = 'none';
        }
    };
    fetch(url)
        .then(function (res) {
            return res.json();
        })
        .then(function (data) {
            var dmTitle;
            var dmInstance = data['dam:scene7File'].split('/')[0];
            var dmDomain = data['dam:scene7Domain'];
            var dmAVS = data['dam:scene7FileAvs'];

            if (window.location.pathname === '/content/st_com/en/search.html' ||
                window.location.pathname === '/content/st_com_cx/en/search.html' ||
                window.location.pathname === '/content/st_com/zh/search.html' ||
                window.location.pathname === '/content/st_com_cx/zh/search.html' ||
                window.location.pathname === '/content/st_com/ja/search.html' ||
                window.location.pathname === '/content/st_com_cx/ja/search.html') {
                dmTitle = ele.target.dataset['modalTitle'];
            } else {
                if (ele.querySelector('a[data-modal-title]')) {
                    dmTitle = ele.querySelector('a[data-modal-title]').getAttribute('data-modal-title');
                }
            }

            var title = document.createElement("div");
            title.className = "title"
            title.innerHTML = dmTitle
            document.querySelector("#modalVideo .modal-content").append(title);

            var scriptLoaded = new Promise(function (resolve, reject) {
                if (!document.querySelector('#VideoViewer')) {
                    var s = document.createElement('script');
                    s.type = 'text/javascript';
                    s.id = 'VideoViewer';
                    s.addEventListener('load', function () {
                        resolve();
                    });
                    s.src = data['dam:scene7Domain'] + 's7viewers/html5/js/VideoViewer.js';
                    document.getElementsByTagName('head')[0].appendChild(s);
                } else {
                    resolve();
                }
            });

            scriptLoaded.then(function () {
                var played = false;
                var videoDuration = 0;
                var timestampVideo = 0;

                var s7videoviewer = new s7viewers.VideoViewer({
                    "containerId": "s7video_div",
                    "params": {
                        "serverurl": dmDomain + "is/image/",
                        "contenturl": dmDomain + "is/content/",
                        "config": dmInstance + getViewer(),
                        "posterimage": dmAVS,
                        "videoserverurl": dmDomain + "is/content/",
                        "asset": dmAVS
                    },
                    "handlers": {
                        "trackEvent": function (objID, compClass, instName, timeStamp, eventInfo) {
                            //identify event type
                            var eventType = eventInfo.includes("MILESTONE") ? eventInfo : eventInfo.split(",")[0];
                            timestampVideo = eventInfo.includes("CURRENT_TIME") ? eventInfo.split(",")[1] : timestampVideo;
                            videoDuration = eventInfo.includes("METADATA") && videoDuration === 0 ? eventInfo.split(",")[2] : videoDuration;
                            digitalData = window.digitalData || {};
                            digitalData.media = {
                                type: 'video',
                                name: dmTitle || document.title,
                                videoLink: dataVideoPath,
                                duration: videoDuration,
                            };
                            digitalData.media.duration = timeStamp;

                            if (parseInt(timestampVideo) + 5000 > videoDuration && videoDuration !== 0) {
                                eventType = "MILESTONE,95";
                            }

                            switch (eventType) {
                                case "LOAD":
                                    // Insert duration
                                    digitalData.media.duration = 0;
                                    break;
                                case "PLAY":
                                    if (!played) {
                                        var videoViewedEvent = new CustomEvent('videoViewed', {bubbles: true});
                                        var videoWasViewedEvent = new CustomEvent('video-was-viewed', {bubbles: true});
                                        document.querySelector('body').dispatchEvent(videoViewedEvent);
                                        document.querySelector('body').dispatchEvent(videoWasViewedEvent);
                                        played = true;
                                    }
                                    break;
                                case "MILESTONE,25":
                                    var event = new CustomEvent('videoPlayedMilestone25', {bubbles: true});
                                    document.querySelector('body').dispatchEvent(event);
                                    break;
                                case "MILESTONE,50":
                                    var event = new CustomEvent('videoPlayedMilestone50', {bubbles: true});
                                    document.querySelector('body').dispatchEvent(event);
                                    break;
                                case "MILESTONE,75":
                                    var event = new CustomEvent('videoPlayedMilestone75', {bubbles: true});
                                    document.querySelector('body').dispatchEvent(event);
                                    break;
                                case "MILESTONE,95":
                                    var event = new CustomEvent('videoPlayedMilestone95', {bubbles: true});
                                    document.querySelector('body').dispatchEvent(event);
                                    break;
                            }
                        }
                    }
                });

                s7videoviewer.init();
            });
        })
        .catch(function (err) {
            console.error(err);
        });
}

function getViewer() {
    var meta = document.querySelector("meta[name='environment']");
    var qaEnv = meta ? meta.getAttribute('content') : undefined;
    var videoConfig = '/in_page_full_video_auto';
    return qaEnv ? videoConfig + '-1' : videoConfig;
}

// Get the registration completion date from the "reg_cmpl_date" cookie
var registrationCompletionDate = STUtils.getCookieByName("reg_cmpl_date");

let pageDomain = window.location.hostname;

// Logic added for ticket STM-32541
function hideMedalliaFeedbackWhenFound(selector) {
    const element = $(selector);

    if (element.length) {
        element.remove();
    } else {
        setTimeout(() => hideMedalliaFeedbackWhenFound(selector), 5);
    }
}

if (pageDomain.includes("preprod")) {
    $(document).ready(function () {
        hideMedalliaFeedbackWhenFound('#kampyleButtonContainer');
    })
}

// Calculate the number of days since the registration completion date
window.daysSinceCompletion = registrationCompletionDate
    ? Math.round((new Date() - new Date(registrationCompletionDate)) / (1000 * 60 * 60 * 24))
    : null;

function checkDOMBeforeRendered() {
    var locale = window.locale
    var pageDomain = window.location.hostname;
    if (locale === "ko") {
        return;
    }
    else if (pageDomain.includes("localhost") || !(pageDomain.includes("preprod-www") || pageDomain.includes("qa-www") || pageDomain.includes("www.st.com"))) {
        console.log("No Cookies")
        waitForElm('body').then((body) => {
            if (!body.hasAttribute("data-ab-test-experience")) {
                body.setAttribute("data-ab-test-experience", "b")
            }
        })
    } else if (locale === "en") {
        waitFor(() => window.hasOwnProperty('OnetrustActiveGroups'), () => {
            if (window.OnetrustActiveGroups !== ",C0001," && window.OnetrustActiveGroups !== ",," && window.OnetrustActiveGroups !== ",0_151807,1,0_150044,0_223751,") {
                if (!window.OnetrustActiveGroups.includes("C0004")) {
                    console.log("Tracking Disabled -> " + window.OnetrustActiveGroups)
                    waitForElm('body').then((body) => {
                        if (!body.hasAttribute("data-ab-test-experience")) {
                            body.setAttribute("data-ab-test-experience", "b")
                        }
                    })
                } else {
                    console.log("Target Enabled -> " + window.OnetrustActiveGroups)
                    waitForElm('body').then((body) => {
                        body.setAttribute("data-cookie", "true")
                    })
                }
            } else {
                console.log("Target Disabled -> " + window.OnetrustActiveGroups)
                waitForElm('body').then((body) => {
                    if (!body.hasAttribute("data-ab-test-experience")) {
                        body.setAttribute("data-ab-test-experience", "b")
                    }
                })
            }
        });
    } else {
        waitForElm('body').then((body) => {
            if (!body.hasAttribute("data-ab-test-experience") && locale !== "ko") {
                body.setAttribute("data-ab-test-experience", "b")
            }
        })
    }

    waitForElm('body[data-ab-test-experience]').then((elm) => {
        var experience = elm.getAttribute("data-ab-test-experience");
        if (elm.hasAttribute("data-cookie") && digitalData !== null && digitalData !== undefined) {
            if (digitalData.search === null || digitalData.search === undefined) {
                digitalData.search = {}
                digitalData.search.target = {}
                digitalData.search.target.experienceName = "Search Target Activity Experience " + experience.toUpperCase() + " " + window.locale
            } else if (digitalData.search.target === null || digitalData.search.target === undefined) {
                digitalData.search.target = {}
                digitalData.search.target.experienceName = "Search Target Activity Experience " + experience.toUpperCase() + " " + window.locale
            } else {
                digitalData.search.target.experienceName = "Search Target Activity Experience " + experience.toUpperCase() + " " + window.locale
            }
            if (typeof _satellite !== "undefined"/* && !window.location.pathname.endsWith(window.locale + ".html")*/) {
                console.log('searchTargetExperienceSet');
                _satellite.track('searchTargetExperienceSet');
            }
        }
        var selector = "";
        if (experience === "b") {
            if (window.innerWidth < 1025) {
                selector = ".st-header--mobile .old-header";
                document.querySelector(".st-header--mobile .new-header .loader").style.display = "none";
                document.querySelector(".st-header .new-header .loader").style.display = "none";
                document.querySelector(".st-header .old-header .loader").style.display = "none";
            } else {
                selector = ".st-header .old-header";
                document.querySelector(".st-header--mobile .new-header .loader").style.display = "none";
                document.querySelector(".st-header .new-header .loader").style.display = "none";
                document.querySelector(".st-header--mobile .old-header .loader").style.display = "none";
            }
            waitForElm(selector).then((header) => {
                header.style.display = "flex"
                header.nextElementSibling.style.display = "none"
                waitForElm('.st-header__nav-tabs').then((navTabs) => {
                    if (navTabs.parentNode.parentNode.className.includes("new-header")) {
                        var searchWrap = header.querySelector(".st-header__search-wrap");
                        searchWrap.after(document.querySelector(".new-header .st-header__nav-tabs"));
                        searchWrap.style.visibility = "visible";
                    }
                    header.querySelector('.loader').style.display = "none";
                    navTabs.style.opacity = 1;
                })
            })
        } else if (experience === "a") {
            if (window.innerWidth < 1025) {
                selector = ".st-header--mobile .new-header";
                document.querySelector(".st-header .new-header .loader").style.display = "none";
                document.querySelector(".st-header--mobile .old-header .loader").style.display = "none";
                document.querySelector(".st-header .old-header .loader").style.display = "none";
            } else {
                selector = ".st-header .new-header";
                document.querySelector(".st-header--mobile .new-header .loader").style.display = "none";
                document.querySelector(".st-header--mobile .old-header .loader").style.display = "none";
                document.querySelector(".st-header .old-header .loader").style.display = "none";
            }
            waitForElm(selector).then((header) => {
                header.style.display = "flex"
                header.previousElementSibling.style.display = "none"
                waitForElm('.st-header__nav-tabs').then((navTabs) => {
                    if (navTabs.parentNode.parentNode.className.includes("old-header") && window.innerWidth > 1024) {
                        var headerLogo = header.querySelector(".bottom-header .st-header__logo");
                        headerLogo.after(document.querySelector(".old-header .st-header__nav-tabs"));
                    }
                    document.querySelector('#widget-search').style.visibility = "visible"
                    header.querySelector('.loader').style.display = "none";
                    navTabs.style.opacity = 1
                })
            })
        }
    });
}

function waitForElm(selector, timeout = 5000) {
    return new Promise((resolve, reject) => {
        if (document.querySelector(selector)) {
            return resolve(document.querySelector(selector));
        }

        const observer = new MutationObserver(() => {
            const el = document.querySelector(selector);
            if (el) {
                resolve(el);
                observer.disconnect();
            }
        });

        observer.observe(document.body, { childList: true, subtree: true });

        if (timeout) {
            setTimeout(() => {
                observer.disconnect();
                reject(new Error(`Element "${selector}" not found during ${timeout} ms`));
            }, timeout);
        }
    });
}

function waitFor(condition, callback) {
    if (!condition()) {
        console.log('waiting');
        window.setTimeout(waitFor.bind(null, condition, callback), 100);
    } else {
        console.log('done');
        callback();
    }
}


(function ($) {
    checkDOMBeforeRendered()

    $(document).ready(function () {
        let widgetDomain = "dev-search.st.com";
        let pageDomain = window.location.hostname;
        if (pageDomain.includes("localhost") || pageDomain.includes("preprod-www") || pageDomain.includes("qa-www")) {
            widgetDomain = "qa-search.st.com";
        } else {
            widgetDomain = "search.st.com";
        }

        let link = document.createElement('link');
        link.setAttribute("href", "https://" + widgetDomain + "/widgets/searchbox/index.css");
        link.setAttribute("rel", "stylesheet");
        document.getElementsByTagName('head')[0].append(link);

        changeHeader();

        manageNewSearchWidget();
    });

    window.onload = setTimeout(function () {
        let body = document.querySelector("body")
        if (!body.hasAttribute("data-ab-test-experience")) {
            body.setAttribute("data-ab-test-experience", "b")
        }
        console.log("Page Loaded")
    }, 6000);


    function changeHeader() {

        checkExperience();

        var observer = new MutationObserver(function (mutations) {
            mutations.forEach(function (mutation) {
                if (mutation.type === "attributes") {
                    console.log("attributes changed");
                    checkExperience();

                    window.changeHeaderCompleted = true;
                    setTimeout(() => {
                        let customEvent = new CustomEvent("changeHeaderCompleted");
                        document.dispatchEvent(customEvent);
                    }, 1000)
                }
            });
        });

        observer.observe(document.getElementsByTagName("body")[0], {
            attributeFilter: ["data-ab-test-experience"],
        });
    }

    function manageNewSearchWidget() {
        // Listen for the custom 'searchboxFocusChange' event
        const widgetSearch = document.getElementById('widget-search');
        const stMainContainer = document.getElementsByClassName('js-st-micro')[0];
        const shadowContainer = document.createElement("div");
        shadowContainer.classList.add("shadowContainer");

        if (widgetSearch) {
            if (window.innerWidth < 1025) {
                $("#widget-search").appendTo(".bottom-header-mobile");
            }

            visualViewport.onresize = () => {
                if (window.innerWidth < 1025) {
                    if ($(".st-header--mobile #widget-search").length === 0) {
                        $("#widget-search").appendTo(".st-header--mobile .bottom-header-mobile");
                    }
                } else {
                    if ($(".st-header-container #widget-search").length === 0) {
                        $("#widget-search").insertBefore(".st-header-container .st-header__quick");
                    }
                }
            }

            widgetSearch.addEventListener('searchboxFocusChange', (event) => {
                // Check the event detail to determine if the search box has focus
                var navTabs = document.getElementsByClassName("st-header__nav-tabs");
                if (event.detail === 'focus') {
                    if (window.innerWidth > 1024) {
                        widgetSearch.style.marginLeft = '26px';
                        if (/about/.test(window.location.href)) {
                            stMainContainer.style.marginTop = "122px";
                        }
                        navTabs[0].style.display = 'none';
                    }
                    document.body.style.overflowY = 'hidden';
                    stMainContainer.append(shadowContainer);
                } else if (event.detail === 'blur') {
                    shadowContainer.remove();
                    setTimeout(function () {
                        if (window.innerWidth > 1024) {
                            widgetSearch.style.marginLeft = 'unset';
                            if (/about/.test(window.location.href)) {
                                stMainContainer.style.marginTop = "175px";
                            }
                            navTabs[0].style.display = 'flex';
                        }
                        document.body.style.overflowY = 'auto';
                    }, 300);
                }
            });
        }
    }

    function checkExperience() {
        var experience = document.getElementsByTagName("body")[0].getAttribute("data-ab-test-experience");
        var oldHeader = document.querySelectorAll("header .old-header")
        var newHeader = document.querySelector("header .st-header-container.new-header");
        var newHeaderMobile = document.querySelector("header.st-header--mobile .new-header");
        var navTabs = document.getElementsByClassName("st-header__nav-tabs");

        if (experience === "b") {
            if (oldHeader.length > 0 && oldHeader[0]) { oldHeader[0].style.display = "flex"; }
            if (oldHeader.length > 1 && oldHeader[1]) { oldHeader[1].style.display = "flex"; }
            if (newHeader) { newHeader.style.display = "none"; }
            if (newHeaderMobile) { newHeaderMobile.style.display = "none"; }
            if (navTabs.length === 1) {
                var searchWrap = document.querySelector("header .old-header .st-header__search-wrap");
                searchWrap.style.visibility = "visible";
                searchWrap.after(navTabs[0]);
            } else {
                navTabs[0].replaceWith(navTabs[1]);
            }
        } else if (experience === "a") {
            if (oldHeader.length > 0 && oldHeader[0]) { oldHeader[0].style.display = "none"; }
            if (oldHeader.length > 1 && oldHeader[1]) { oldHeader[1].style.display = "none"; }
            if (newHeader) { newHeader.style.display = "flex"; }
            if (newHeaderMobile) { newHeaderMobile.style.display = "flex"; }
            if (navTabs.length === 1) {
                document.querySelector("#widget-search").style.visibility = "visible";
                var headerLogo = document.querySelector("header .new-header .bottom-header .st-header__logo");
                headerLogo.after(navTabs[0]);
            } else {
                navTabs[1].replaceWith(navTabs[0]);
            }
        }

        if (newHeaderMobile && window.getComputedStyle(newHeaderMobile).display !== "none") {
            document.getElementsByTagName("body")[0].setAttribute("data-selected-header", "new-mobile-header");
        } else {
            if (document.getElementsByTagName("body")[0].hasAttribute("data-selected-header")) {
                document.getElementsByTagName("body")[0].removeAttribute("data-selected-header");
            }
        }
    }

})(jQuery);

$(document).ready(function () {
  CQ.I18n.setLocale(document.documentElement.lang);
  videojs.addLanguage("st", {
	    Play: $("[data-i18n-videojs-play]").attr("data-i18n-videojs-play") || CQ.I18n.getMessage("Play"),
	    Pause: $("[data-i18n-videojs-pause]").attr("data-i18n-videojs-pause") || CQ.I18n.getMessage("Pause"),
	    "Current Time": $("[data-i18n-videojs-current-time]").attr("data-i18n-videojs-current-time") || CQ.I18n.getMessage("Current Time"),
	    "Duration Time": $("[data-i18n-videojs-duration-time]").attr("data-i18n-videojs-duration-time") || CQ.I18n.getMessage("Duration Time"),
	    "Remaining Time": $("[data-i18n-videojs-remaining-time]").attr("data-i18n-videojs-remaining-time") || CQ.I18n.getMessage("Remaining Time"),
	    "Stream Type": $("[data-i18n-videojs-stream-type]").attr("data-i18n-videojs-stream-type") || CQ.I18n.getMessage("Stream Type"),
	    LIVE: $("[data-i18n-videojs-live]").attr("data-i18n-videojs-live") || CQ.I18n.getMessage("LIVE"),
	    Loaded: $("[data-i18n-videojs-loaded]").attr("data-i18n-videojs-loaded") || CQ.I18n.getMessage("Loaded"),
	    Progress: $("[data-i18n-videojs-progress]").attr("data-i18n-videojs-progress") || CQ.I18n.getMessage("Progress"),
	    Fullscreen: $("[data-i18n-videojs-fullscreen]").attr("data-i18n-videojs-fullscreen") || CQ.I18n.getMessage("Fullscreen"),
	    "Non-Fullscreen": $("[data-i18n-videojs-non-fullscreen]").attr("data-i18n-videojs-non-fullscreen") || CQ.I18n.getMessage("Non-Fullscreen"),
	    Mute: $("[data-i18n-videojs-mute]").attr("data-i18n-videojs-mute") || CQ.I18n.getMessage("Mute"),
	    Unmuted: $("[data-i18n-videojs-unmuted]").attr("data-i18n-videojs-unmuted") || CQ.I18n.getMessage("Unmuted"),
	    "Playback Rate": $("[data-i18n-videojs-playback-rate]").attr("data-i18n-videojs-playback-rate") || CQ.I18n.getMessage("Playback Rate"),
	    Subtitles: $("[data-i18n-videojs-subtitles]").attr("data-i18n-videojs-subtitles") || CQ.I18n.getMessage("Subtitles"),
	    "subtitles off": $("[data-i18n-videojs-subtitles-off]").attr("data-i18n-videojs-subtitles-off") || CQ.I18n.getMessage("subtitles off"),
	    Captions: $("[data-i18n-videojs-captions]").attr("data-i18n-videojs-captions") || CQ.I18n.getMessage("Captions"),
	    "captions off": $("[data-i18n-videojs-captions-off]").attr("data-i18n-videojs-captions-off") || CQ.I18n.getMessage("captions off"),
	    Chapters: $("[data-i18n-videojs-chapters]").attr("data-i18n-videojs-chapters") || CQ.I18n.getMessage("Chapters"),
	    "You aborted the video playback": $("[data-i18n-videojs-aborted-error]").attr("data-i18n-videojs-aborted-error") || CQ.I18n.getMessage("The video could not be loaded, either because the server or network failed or because the format is not supported."),
	    "A network error caused the video download to fail part-way.": $("[data-i18n-videojs-network-error]").attr("data-i18n-videojs-network-error") || CQ.I18n.getMessage("The video could not be loaded, either because the server or network failed or because the format is not supported."),
	    "The video could not be loaded, either because the server or network failed or because the format is not supported.": $("[data-i18n-videojs-format-error]").attr("data-i18n-videojs-format-error") || CQ.I18n.getMessage("The video could not be loaded, either because the server or network failed or because the format is not supported."),
	    "The video playback was aborted due to a corruption problem or because the video used features your browser did not support.": $("[data-i18n-videojs-browser-error]").attr("data-i18n-videojs-browser-error") || CQ.I18n.getMessage("The video could not be loaded, either because the server or network failed or because the format is not supported."),
	    "No compatible source was found for this video.": $("[data-i18n-videojs-compatible-error]").attr("data-i18n-videojs-compatible-error") || CQ.I18n.getMessage("The video could not be loaded, either because the server or network failed or because the format is not supported.")
	});
});
$(function() {
    $('.st-download-multiple-resources').each(function() {
        var linkEl = $(this);
        var formID = '#' + linkEl.attr('data-form-id');
        var form = $(formID);
        var maxMultipleDownloads = Number(linkEl.attr('data-max-multiple-downloads') || 15);
        var checkedInputs = {};
        var tooltipInitTimeout;

        var downloadLinksSelector = form.find('.js-st-checkbox-pf-tools').map(function() {
            return 'a[href="' + $(this).attr('value') + '"]';
        }).get().join(', ');

        form.find(downloadLinksSelector).on('click', function() {
            showDidYouKnowPopup();
        });

        form.on('change', '.js-st-checkbox-pf-tools', function() {
            checkedInputs = $('input[name="assetPath"]:checked', form);
            if (checkedInputs.length == 1) {
                window.singleDownloadFileSelection = true;
                linkEl.attr('href', checkedInputs[0].value);
            } else {
                window.singleDownloadFileSelection = false;
                linkEl.removeAttr('href');
            }
            handleMultipleDownloadsLimit();
        });

        form.find('tr').on('click', function(e) {
            if ($(this).hasClass('st-disable-check-on-click')) {
                e.stopImmediatePropagation();
            }
        });

        $('body').on('mouseenter.fndtn.tooltip', '[data-tooltip]', function (event) {
            $('[data-tooltip]', form).not(event.target).each(function () {
                tooltipPopupHide(this);
            });
        });

        $('body').on('mouseleave.fndtn.tooltip', '[data-tooltip]', function () {
            $('[data-tooltip]', form).each(function () {
                tooltipPopupHide(this);
            });
        });

        $(window).on('scroll', function () {
            if ($('[data-tooltip]:hover', form).length === 0) {
                $('[data-tooltip]', form).each(function () {
                    tooltipPopupHide(this);
                });
            }
        });

        linkEl.on('click', function() {
            checkedInputs = $('input[name="assetPath"]:checked', form);
            var modalLoader = $('.st-multiple-download-form .modal-loader');

            if (checkedInputs.length > 1) {
                modalLoader.fadeIn(300);
                linkEl.addClass('disabled');
                form.addClass('show-loader');
                downloadBlob(form.attr('action') + '?' + form.serialize(), {'x-content': 'abc'}, "resources.zip").then(function() {
                    showDidYouKnowPopup();
                }).always(function() {
                    modalLoader.fadeOut(300, function() {
                        linkEl.removeClass('disabled');
                        form.removeClass('show-loader');
                    });
                });
            } else if($(this).is('[href]') && checkedInputs.length === 1) {
                showDidYouKnowPopup();
            }
        });

        function tooltipPopupHide(element) {
            $(element).foundation('hide');
            $('#' + $(element).data('selector')).hide();
        }

        function handleMultipleDownloadsLimit() {
            clearTimeout(tooltipInitTimeout);
            if (checkedInputs.length >= maxMultipleDownloads) {
                form.addClass('st-max-downloads-reached');
                form.find('.js-st-checkbox-pf-tools:not(:checked)').each(function() {
                    var warningText = $(this).attr('data-disabled-text') || 'Max 15 downloads at once';
                    var warningTooltipEl = $('<div />', {
                        'data-tooltip': '',
                        'data-haspopup': '',
                        'title': warningText,
                        'class': 'max-downloads-warning radius'
                    });
                    $(this).attr('disabled', 'disabled').closest('.st-checkbox').append(warningTooltipEl);
                    $(this).closest('tr').addClass('st-disable-check-on-click');
                });
                tooltipInitTimeout = setTimeout(handleToolTipInit, 250);
            } else if ($(formID).hasClass('st-max-downloads-reached')) {
                $(formID).removeClass('st-max-downloads-reached');
                $(formID + ' .st-disable-check-on-click .max-downloads-warning').remove();
                $(formID + ' .st-disable-check-on-click').removeClass('st-disable-check-on-click');
                $(formID + ' input[type="checkbox"]:disabled').removeAttr('disabled');
            }
        }

        function handleToolTipInit(){
            var tooltipInitialTpl = Foundation.libs.tooltip.settings.tip_template;
            Foundation.libs.tooltip.settings.tip_template = function (selector, content) {
                return '<span data-selector="' + selector + '" id="' + selector + '" class="st-custom-tooltip-appearance '
                    + Foundation.libs.tooltip.settings.tooltip_class.substring(1)
                    + '" role="tooltip">' + content + '<span class="nub"></span></span>';
            };
            form.foundation();
            Foundation.libs.tooltip.settings.tip_template = tooltipInitialTpl;
        }
    });
});

//returns promise that allows to download blobs via ajax
function downloadBlob(url, headers, filename) {
    var defer = new $.Deferred;
    function handleFile(data) {
        var file = URL.createObjectURL(this.response || data);
        filename = filename || url.split("/").pop();
        var a = document.createElement("a");
        // if 'a' element has 'download' property
        if ("download" in a) {
            a.href = file;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        } else if (window.navigator && window.navigator.msSaveOrOpenBlob) {
            //a special Blob is needed for resource download in ie11
            window.navigator.msSaveOrOpenBlob(new Blob([this.response]), filename);
        } else {
            // use 'window.open()' as a fallback
            window.open(file);
        }
        defer.resolve();
    }
    function onError(error) {
        defer.reject(error);
    }

    var request = new XMLHttpRequest();
    request.onloadstart = function(ev) {
        request.responseType = "blob";
    }
    request.onload = handleFile;
    request.onerror = onError;
    request.open("GET", url);
    for (var prop in headers) {
        request.setRequestHeader(prop, headers[prop]);
    }

    request.send();
    return defer;
}

//call this function whenever you need to show did you know popup. If cookies were not previously set - it will be shown
function showDidYouKnowPopup(delay) {
    delay = delay || 200;
    //release DOM and add some delay before popup will show up
    setTimeout(function() {
    	if (window.STFED.didYouKnowModal) {
			try {
				window.STFED.didYouKnowModal.showModal();
			} catch (e) {
				console.warn('Please check did you know popup');
			}
        }
    }, delay);
}

document.addEventListener("DOMContentLoaded", addQuickLinks(".resource-table-label", "documentation", "SPAN"));
document.addEventListener("DOMContentLoaded", addQuickLinks(".tools-software-table-label", "tools-software", "SPAN"));
document.addEventListener("DOMContentLoaded", addQuickLinks(".solutions-widget-label", "solutions", "H2"));

function addQuickLinks(titleSource, category, tag) {
    var contentTab = document.querySelector('div[data-nav-tab-content-id="#' + category + '"]');
    if (!contentTab) {
        return;
    }
    var dataContentIndex = contentTab.getAttribute("data-page-content");
    var subTab = document.querySelector(".st-nav-tabs-content__quicklinks--only");

    if (subTab) {
        var parent = subTab.parentNode;
        var isFirstTab = true;

        if (subTab.hasAttribute("data-content")) {
            subTab = subTab.cloneNode(true);
            clearSubTab(subTab);
            isFirstTab = false;
        }

        subTab.setAttribute("data-content", dataContentIndex);

        var containers = createContainers();
        var tables = document.querySelectorAll(titleSource);
        var quickLinks = [];
        for (var i = 0; i < tables.length; i++) {
            var table = tables[i];
            var anchor = document.createElement("a");
            for (var j = 0; j < table.childNodes.length; j++) {
                if (table.childNodes[j].tagName == tag) {
                    anchor.innerText = table.childNodes[j].textContent;
                    break;
                }
            }
            anchor.setAttribute("href", "#");
            anchor.setAttribute("data-href", table.getAttribute("for"));
            anchor.classList.add("st-link");
            anchor.classList.add("js-st-quicklink");

            quickLinks.push(anchor)
        }

        if (quickLinks.length !== 0) {
            for (var i = 0, length = quickLinks.length; i < length; i++) {
                var index = i % 3;
                containers[index].appendChild(quickLinks[i])
            }
        } else {
            parent.setAttribute("display", "none");
            return;
        }

        for (var i = 0; i < containers.length; i++) {
            subTab.firstElementChild.appendChild(containers[i]);
        }

        if (!isFirstTab) {
            parent.appendChild(subTab);
        }
    }
}

function createContainers() {
    var containers = [];
    for (var i = 0; i < 3; i++) {
        var div = document.createElement('div');
        div.classList.add("columns");
        div.classList.add("medium-4");
        div.classList.add("st-nav-tabs__text-block");
        containers.push(div);
    }

    return containers;
}

function clearSubTab(subTab) {
    var divs = subTab.querySelectorAll("div.medium-4");
    for (var i = 0; i < divs.length; i++) {
        divs[i].parentNode.removeChild(divs[i]);
    }
}
